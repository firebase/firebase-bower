!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(vm){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(vm),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}var a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&a)<<2|c>>6,c=63&c;u||(c=64,s||(h=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[h],n[c])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i,u="FirebaseError",c=(n(l,i=Error),l);function l(t,e,n){e=i.call(this,e)||this;return e.code=t,e.customData=n,e.name=u,Object.setPrototypeOf(e,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,f.prototype.create),e}var f=(d.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(m,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new c(o,t,i)},d);function d(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var p,m=/\{\$([^}]+)}/g;function v(t){return t&&t._delegate?t._delegate:t}(_e=p=p||{})[_e.DEBUG=0]="DEBUG",_e[_e.VERBOSE=1]="VERBOSE",_e[_e.INFO=2]="INFO",_e[_e.WARN=3]="WARN",_e[_e.ERROR=4]="ERROR",_e[_e.SILENT=5]="SILENT";function b(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=T[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var w={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},E=p.INFO,T=((Se={})[p.DEBUG]="log",Se[p.VERBOSE]="log",Se[p.INFO]="info",Se[p.WARN]="warn",Se[p.ERROR]="error",Se),I=(Object.defineProperty(_.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),_.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?w[t]:t},Object.defineProperty(_.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),_.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.DEBUG],t)),this._logHandler.apply(this,s([this,p.DEBUG],t))},_.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.VERBOSE],t)),this._logHandler.apply(this,s([this,p.VERBOSE],t))},_.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.INFO],t)),this._logHandler.apply(this,s([this,p.INFO],t))},_.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.WARN],t)),this._logHandler.apply(this,s([this,p.WARN],t))},_.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.ERROR],t)),this._logHandler.apply(this,s([this,p.ERROR],t))},_);function _(t){this.name=t,this._logLevel=E,this._logHandler=b,this._userLogHandler=null}var S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C={},k=D||self;function R(){}function x(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function F(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:F).apply(null,arguments)}function U(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(){return Date.now()}function B(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Pb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.ka=function(){var t;!this.j&&(this.j=!0,this.H(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++P))},j.prototype.H=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var K=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Q(){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var W,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var J=k.navigator;if(J){J=J.userAgent;if(J){W=J;break t}}W=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tt(t){var e,n={};for(e in t)n[e]=t[e];return n}var et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<et.length;i++)e=et[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function rt(t){return rt[" "](t),t}rt[" "]=R;var it,ot=X(W,"Opera"),st=X(W,"Trident")||X(W,"MSIE"),at=X(W,"Edge"),ut=at||st,ct=X(W,"Gecko")&&!(X(W.toLowerCase(),"webkit")&&!X(W,"Edge"))&&!(X(W,"Trident")||X(W,"MSIE"))&&!X(W,"Edge"),ht=X(W.toLowerCase(),"webkit")&&!X(W,"Edge");function lt(){var t=k.document;return t?t.documentMode:void 0}t:{var ft="",dt=(dt=W,ct?/rv:([^\);]+)(\)|;)/.exec(dt):at?/Edge\/([\d\.]+)/.exec(dt):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(dt):ht?/WebKit\/(\S+)/.exec(dt):ot?/(?:Version)[ \/]?(\S+)/.exec(dt):void 0);if(dt&&(ft=dt?dt[1]:""),st){dt=lt();if(null!=dt&&dt>parseFloat(ft)){it=String(dt);break t}}it=ft}var pt={};function yt(a){return t=a,e=function(){for(var t=0,e=Y(String(it)).split("."),n=Y(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=$(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||$(0==o[2].length,0==s[2].length)||$(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=pt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var gt=k.document&&st&&(lt()||parseInt(it,10))||void 0,mt=!st||9<=Number(gt),vt=st&&!yt("9"),bt=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",R,e),k.removeEventListener("test",R,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Et(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ct){t:{try{rt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Tt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},B(Et,wt);var Tt={2:"touch",3:"pen",4:"mouse"};Et.prototype.b=function(){Et.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,vt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var It="closure_listenable_"+(1e6*Math.random()|0),_t=0;function St(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++_t,this.Y=this.Z=!1}function At(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Nt(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=K(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(At(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Ct(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Nt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ct(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new St(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var kt="closure_lm_"+(1e6*Math.random()|0),Rt={};function xt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=qt(r);return e&&e[It]?e.xa(n,r,O(i)?!!i.capture:!!i,o):Ot(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=qt(n),t&&t[It]?t.wa(e,n,O(r)?!!r.capture:!!r,i):Ot(t,e,n,!1,r,i)}function Ot(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!mt)return null;var a,u,c=Vt(t);if(c||(t[kt]=c=new Nt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=Ft,u=mt?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r=u).src=t,r.listener=n,t.addEventListener)void 0===(i=!bt?s:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[It]?Dt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Vt(e))?(Dt(n,t),0==n.b&&(n.src=null,e[kt]=null)):At(t)))}function Pt(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Lt(t),n.call(r,e)}function Ft(t,e){if(t.Y)return!0;if(mt)return Mt(t,new Et(e,this));if(!e)t:{e=["window","event"];for(var n=k,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Et(e,this))}function Vt(t){return(t=t[kt])instanceof Nt?t:null}var Ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function qt(e){return"function"==typeof e?e:(e[Ut]||(e[Ut]=function(t){return e.handleEvent(t)}),e[Ut])}function Bt(){j.call(this),this.c=new Nt(this),(this.J=this).D=null}function jt(t,e){var n,r=t.D;if(r)for(n=[];r;r=r.D)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new wt(e,t):e instanceof wt?e.target=e.target||t:(s=e,nt(e=new wt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Kt(o,r,!0,e)&&s;if(s=Kt(o=e.a=t,r,!0,e)&&s,s=Kt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Kt(o=e.a=n[i],r,!1,e)&&s}function Kt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.da||u.src,u.Z&&Dt(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}B(Bt,j),Bt.prototype[It]=!0,(N=Bt.prototype).addEventListener=function(t,e,n,r){xt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=qt(r),e&&e[It]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ct(s=e.a[n],r,i,o))&&(At(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Vt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?Ct(n,r,i,o):e)?n[e]:null)&&Lt(r))}(this,t,e,n,r)},N.H=function(){if(Bt.X.H.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)At(n[r]);delete e.a[t],e.b--}}this.D=null},N.wa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.xa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Gt=k.JSON.stringify;function Qt(){this.b=this.a=null}var Ht,zt=(Wt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Wt(function(){return new Yt},function(t){t.reset()}));function Wt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Xt(t,e){var n;Ht||(n=k.Promise.resolve(void 0),Ht=function(){n.then(Zt)}),$t||(Ht(),$t=!0),Jt.add(t,e)}Qt.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var $t=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),Jt=new Qt;function Zt(){for(var t;e=t=void 0,e=null,(t=Jt).a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),t=e;){try{t.a.call(t.b)}catch(t){!function(t){k.setTimeout(function(){throw t},0)}(t)}var e=zt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}$t=!1}function te(t,e){Bt.call(this),this.b=t||1,this.a=e||k,this.f=V(this.eb,this),this.g=q()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}B(te,Bt),(N=te.prototype).aa=!1,N.M=null,N.eb=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),jt(this,"tick"),this.aa&&(ee(this),this.start())))},N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},N.H=function(){te.X.H.call(this),ee(this),delete this.a};var re,ie,oe,se=(S(ie=ue,oe=re=j),ie.prototype=null===oe?Object.create(oe):(ae.prototype=oe.prototype,new ae),ue.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ne(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ue.prototype.H=function(){re.prototype.H.call(this),this.a&&(k.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ue);function ae(){this.constructor=ie}function ue(t,e){var n=re.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ce(t){j.call(this),this.b=t,this.a={}}B(ce,j);var he=[];function le(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=xt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){Z(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function de(){this.a=!0}function pe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Gt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ce.prototype.H=function(){ce.X.H.call(this),fe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},de.prototype.info=function(){};var ye={},ge=null;function me(){return ge=ge||new Bt}function ve(t){wt.call(this,ye.Ga,t)}function be(){var t=me();jt(t,new ve(t))}function we(t,e){wt.call(this,ye.STAT_EVENT,t),this.stat=e}function Ee(t){var e=me();jt(e,new we(e,t))}function Te(t){wt.call(this,ye.Ha,t)}function Ie(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){t()},e)}ye.Ga="serverreachability",B(ve,wt),ye.STAT_EVENT="statevent",B(we,wt),ye.Ha="timingevent",B(Te,wt);var _e={NO_ERROR:0,fb:1,sb:2,rb:3,mb:4,qb:5,tb:6,Ea:7,TIMEOUT:8,wb:9},Se={kb:"complete",Gb:"success",Fa:"error",Ea:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",nb:"downloadprogress",Ob:"uploadprogress"};function Ae(){}function Ne(t){return t.b||(t.b=t.c())}function De(){}Ae.prototype.b=null;D={OPEN:"a",jb:"b",Fa:"c",vb:"d"};function Ce(){wt.call(this,"d")}function ke(){wt.call(this,"c")}function Re(){}function xe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ce(this),this.P=Le,this.R=new te(t=ut?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}B(Ce,wt),B(ke,wt),B(Re,Ae),Re.prototype.a=function(){return new XMLHttpRequest},Re.prototype.c=function(){return{}};var Oe=new Re,Le=45e3,Pe={},Me={};function Fe(t,e,n){t.G=1,t.i=on(Je(e)),t.j=n,t.I=!0,Ve(t,null)}function Ve(t,e){t.u=q(),qe(t),t.l=Je(t.i);var s,a,u,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.D=0,t.a=fr(t.g,t.g.C?e:null),0<t.O&&(t.F=new se(V(t.Da,t,t.a),t.O)),le(t.J,t.a,"readystatechange",t.bb),e=t.B?tt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),be(),s=t.c,a=t.m,u=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function Ue(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=i=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Me:(i=Number(a.substring(i,o)),isNaN(i)?Pe:(o+=1)+i>a.length?Me:(a=a.substr(o,i),r.D=o+i,a)));if(a==Me){4==e&&(t.h=4,Ee(14),s=!1),pe(t.c,t.f,null,"[Incomplete Response]");break}if(a==Pe){t.h=4,Ee(15),pe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}pe(t.c,t.f,a,null),Qe(t,a)}4==e&&0==n.length&&(t.h=1,Ee(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),ir(e),e.F=!0,Ee(11))):(pe(t.c,t.f,n,"[Invalid Chunked Response]"),Ge(t),Ke(t))}function qe(t){t.T=q()+t.P,Be(t,t.P)}function Be(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ie(V(t.$a,t),e)}function je(t){t.o&&(k.clearTimeout(t.o),t.o=null)}function Ke(t){0==t.g.v||t.A||ar(t.g,t)}function Ge(t){je(t);var e=t.F;e&&"function"==typeof e.ka&&e.ka(),t.F=null,ee(t.R),fe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ka())}function Qe(t,e){try{var n,r,i,o,s,a,u,c,h,l,f,d=t.g;if(0!=d.v&&(d.a==t||Sn(d.b,t)))if(d.I=t.N,!t.C&&Sn(d.b,t)&&3==d.v){try{var p=d.la.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var y=p;if(0==y[0]){t:if(!d.j){if(d.a){if(!(d.a.u+3e3<t.u))break t;sr(d),Yn(d)}rr(d),Ee(18)}}else d.pa=y[1],0<d.pa-d.P&&y[2]<37500&&d.G&&0==d.o&&!d.m&&(d.m=Ie(V(d.Xa,d),6e3));if(_n(d.b)<=1&&d.fa){try{d.fa()}catch(t){}d.fa=void 0}}else cr(d,11)}else if(!t.C&&d.a!=t||sr(d),!z(e))for(e=p=d.la.a.parse(e),p=0;p<e.length;p++)y=e[p],d.P=y[0],y=y[1],2==d.v?"c"==y[0]?(d.J=y[1],d.ha=y[2],null!=(n=y[3])&&(d.ia=n,d.c.info("VER="+d.ia)),null!=(r=y[4])&&(d.qa=r,d.c.info("SVER="+d.qa)),null!=(i=y[5])&&"number"==typeof i&&0<i&&(o=1.5*i,d.D=o,d.c.info("backChannelRequestTimeoutMs_="+o)),o=d,(s=t.a)&&(!(a=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=o.b).a&&(X(a,"spdy")||X(a,"quic")||X(a,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(An(u,u.b),u.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.oa=c,rn(o.B,o.A,c))),d.v=3,d.f&&d.f.ua(),d.U&&(d.N=q()-t.u,d.c.info("Handshake RTT: "+d.N+"ms")),h=t,(o=d).ma=lr(o,o.C?o.ha:null,o.ga),h.C?(Nn(o.b,h),l=h,(f=o.D)&&l.setTimeout(f),l.o&&(je(l),qe(l)),o.a=h):nr(o),0<d.g.length&&Jn(d)):"stop"!=y[0]&&"close"!=y[0]||cr(d,7):3==d.v&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?cr(d,7):Wn(d):"noop"!=y[0]&&d.f&&d.f.ta(y),d.o=0);be()}catch(t){}}function He(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(x(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ye(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ye(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ye(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=xe.prototype).setTimeout=function(t){this.P=t},N.bb=function(t){t=t.target;var e=this.F;e&&3==Gn(t)?e.f():this.Da(t)},N.Da=function(t){try{if(t==this.a)t:{var e=Gn(this.a),n=this.a.va();this.a.W();if(!(e<3||3==e&&!ut&&!this.a.$())){this.A||4!=e||7==n||be(),je(this);var r=this.a.W();this.N=r;var i=this.a.$();if(this.b=200==r,u=this.c,c=this.m,h=this.l,l=this.f,f=this.S,d=e,p=r,u.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+f+"]: "+c+"\n"+h+"\n"+d+" "+p}),this.b){if(this.U&&!this.C){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(o)){var a=o;break e}}a=null}if(!a){this.b=!1,this.h=3,Ee(12),Ge(this),Ke(this);break t}pe(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Qe(this,a)}this.I?(Ue(this,e,i),ut&&this.b&&3==e&&(le(this.J,this.R,"tick",this.ab),this.R.start())):(pe(this.c,this.f,i,null),Qe(this,i)),4==e&&Ge(this),this.b&&!this.A&&(4==e?ar(this.g,this):(this.b=!1,qe(this)))}else 400==r&&0<i.indexOf("Unknown SID")?(this.h=3,Ee(12)):(this.h=0,Ee(13)),Ge(this),Ke(this)}}}catch(t){}var u,c,h,l,f,d,p},N.ab=function(){var t,e;this.a&&(t=Gn(this.a),e=this.a.$(),this.D<e.length&&(je(this),Ue(this,t,e),this.b&&4!=t&&qe(this)))},N.cancel=function(){this.A=!0,Ge(this)},N.$a=function(){this.o=null;var t,e,n=q();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.G&&(be(),Ee(17)),Ge(this),this.h=2,Ke(this)):Be(this,this.T-n)},(N=ze.prototype).K=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.L=function(){return We(this),this.a.concat()},N.get=function(t,e){return Ye(this.b,t)?this.b[t]:e},N.set=function(t,e){Ye(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof $e?(this.a=void 0!==e?e:t.a,Ze(this,t.f),this.j=t.j,tn(this,t.c),en(this,t.h),this.g=t.g,e=t.b,(n=new pn).c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),nn(this,n),this.i=t.i):t&&(n=String(t).match(Xe))?(this.a=!!e,Ze(this,n[1]||"",!0),this.j=sn(n[2]||""),tn(this,n[3]||"",!0),en(this,n[4]),this.g=sn(n[5]||"",!0),nn(this,n[6]||"",!0),this.i=sn(n[7]||"")):(this.a=!!e,this.b=new pn(null,this.a))}function Je(t){return new $e(t)}function Ze(t,e,n){t.f=n?sn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function tn(t,e,n){t.c=n?sn(e,!0):e}function en(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function nn(t,e,n){var r,i;e instanceof pn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(yn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),vn(this,n,t))},r)),r.f=i):(n||(e=an(e,fn)),t.b=new pn(e,t.a))}function rn(t,e,n){t.b.set(e,n)}function on(t){return rn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function sn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function an(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,un),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(an(e,cn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(an(e,cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(an(n,"/"==n.charAt(0)?ln:hn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",an(n,dn)),t.join("")};var cn=/[#\/\?@]/g,hn=/[#\?:]/g,ln=/[#\?]/g,fn=/[#\?@]/g,dn=/#/g;function pn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function yn(n){n.a||(n.a=new ze,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){yn(t),e=bn(t,e),Ye(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ye((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function mn(t,e){return yn(t),e=bn(t,e),Ye(t.a.b,e)}function vn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(bn(t,e),H(n)),t.b+=n.length)}function bn(t,e){return e=String(e),e=t.f?e.toLowerCase():e}(N=pn.prototype).add=function(t,e){yn(this),this.c=null,t=bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){yn(this),this.a.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},N.L=function(){yn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.K=function(t){yn(this);var e=[];if("string"==typeof t)mn(this,t)&&(e=Q(e,this.a.get(bn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=Q(e,t[n])}return e},N.set=function(t,e){return yn(this),this.c=null,mn(this,t=bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var wn=function(t,e){this.b=t,this.a=e};function En(t){this.g=t||Tn,t=k.PerformanceNavigationTiming?0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(k.ja&&k.ja.za&&k.ja.za()&&k.ja.za().Qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Tn=10;function In(t){return t.b||t.a&&t.a.size>=t.f}function _n(t){return t.b?1:t.a?t.a.size:0}function Sn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function An(t,e){t.a?t.a.add(e):t.b=e}function Nn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return H(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Cn(){}function kn(){this.a=new Cn}function Rn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}En.prototype.cancel=function(){var e,t;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Cn.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return k.JSON.parse(t,void 0)};var xn=k.JSON.parse;function On(t){Bt.call(this),this.headers=new ze,this.l=t||null,this.b=!1,this.u=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.m=this.A=!1,this.s=0,this.o=null,this.I=Pn,this.F=this.G=!1}B(On,Bt);var Ln,Pn="",Mn=/^https?$/i,Fn=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function Un(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qn(t),jn(t)}function qn(t){t.A||(t.A=!0,jt(t,"complete"),jt(t,"error"))}function Bn(t){if(t.b&&void 0!==C&&(!t.u[1]||4!=Gn(t)||2!=t.W()))if(t.m&&4==Gn(t))ne(t.Aa,0,t);else if(jt(t,"readystatechange"),4==Gn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.C).match(Xe)[1]||null)&&k.self&&k.self.location&&(i=(r=k.self.location.protocol).substr(0,r.length-1)),n=!Mn.test(i?i.toLowerCase():"")),e=n),e)jt(t,"complete"),jt(t,"success");else{t.h=6;try{var a=2<Gn(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",qn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Kn(t);var n=t.a,r=t.u[0]?R:null;t.a=null,t.u=null,e||jt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Kn(t){t.a&&t.F&&(t.a.ontimeout=null),t.o&&(k.clearTimeout(t.o),t.o=null)}function Gn(t){return t.a?t.a.readyState:0}function Qn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Z(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):rn(t,e,n))}function Hn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zn(t){this.qa=0,this.g=[],this.c=new de,this.ha=this.ma=this.B=this.ga=this.a=this.oa=this.A=this.V=this.i=this.O=this.l=null,this.Pa=this.R=0,this.Ma=Hn("failFast",!1,t),this.G=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.pa=this.P=-1,this.T=this.o=this.u=0,this.Ia=Hn("baseRetryDelayMs",5e3,t),this.Sa=Hn("retryDelaySeedMs",1e4,t),this.Na=Hn("forwardChannelMaxRetries",2,t),this.na=Hn("forwardChannelRequestTimeoutMs",2e4,t),this.Oa=t&&t.xmlHttpFactory||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new En(t&&t.concurrentRequestLimit),this.la=new kn,this.ea=t&&t.fastHandshake||!1,this.Ja=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.ea&&this.S&&t&&t.detectBufferingProxy||!1,this.fa=void 0,this.N=0,this.F=!1,this.s=null,(this.La=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Wn(t){var e,n;Xn(t),3==t.v&&(e=t.R++,rn(n=Je(t.B),"SID",t.J),rn(n,"RID",e),rn(n,"TYPE","terminate"),tr(t,n),(e=new xe(t,t.c,e,void 0)).G=2,e.i=on(Je(n)),n=!1,!(n=k.navigator&&k.navigator.sendBeacon?k.navigator.sendBeacon(e.i.toString(),""):n)&&k.Image&&((new Image).src=e.i,n=!0),n||(e.a=fr(e.g,null),e.a.ba(e.i)),e.u=q(),qe(e)),hr(t)}function Yn(t){t.a&&(ir(t),t.a.cancel(),t.a=null)}function Xn(t){Yn(t),t.j&&(k.clearTimeout(t.j),t.j=null),sr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&k.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new wn(t.Pa++,e)),3==t.v&&Jn(t)}function Jn(t){In(t.b)||t.h||(t.h=!0,Xt(t.Ca,t),t.u=0)}function Zn(t,e){var n=e?e.f:t.R++,r=Je(t.B);rn(r,"SID",t.J),rn(r,"RID",n),rn(r,"AID",t.P),tr(t,r),t.i&&t.l&&Qn(r,t.i,t.l),n=new xe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=er(t,n,1e3),n.setTimeout(Math.round(.5*t.na)+Math.round(.5*t.na*Math.random())),An(t.b,n),Fe(n,r,e)}function tr(t,n){t.f&&He({},function(t,e){rn(n,e,t)})}function er(t,e,n){n=Math.min(t.g.length,n);var r=t.f?V(t.f.Ka,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,r,e){var i=e||"";try{He(t,function(t,e){var n=t;O(t)&&(n=Gt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function nr(t){t.a||t.j||(t.T=1,Xt(t.Ba,t),t.o=0)}function rr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Ie(V(t.Ba,t),ur(t,t.o)),t.o++,1)}function ir(t){null!=t.s&&(k.clearTimeout(t.s),t.s=null)}function or(t){t.a=new xe(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Je(t.ma);rn(e,"RID","rpc"),rn(e,"SID",t.J),rn(e,"CI",t.G?"0":"1"),rn(e,"AID",t.P),tr(t,e),rn(e,"TYPE","xmlhttp"),t.i&&t.l&&Qn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ha,n.G=1,n.i=on(Je(e)),n.j=null,n.I=!0,Ve(n,t)}function sr(t){null!=t.m&&(k.clearTimeout(t.m),t.m=null)}function ar(t,e){var n,r,i,o=null;if(t.a==e){sr(t),ir(t),t.a=null;var s=2}else{if(!Sn(t.b,e))return;o=e.s,Nn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=q()-e.u,n=t.u,jt(s=me(),new Te(s)),Jn(t)):nr(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,_n((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.Ma?0:r.Na)||(r.h=Ie(V(r.Ca,r,i),ur(r,r.u)),r.u++,0))))&&(2!=s||!rr(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:cr(t,5);break;case 4:cr(t,10);break;case 3:cr(t,6);break;default:cr(t,2)}}function ur(t,e){var n=t.Ia+Math.floor(Math.random()*t.Sa);return t.f||(n*=2),n*e}function cr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=V(t.cb,t),r||(r=new $e("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Ze(r,"https"),on(r)),n=r.toString(),r=o,o=new de,k.Image?((i=new Image).onload=U(Rn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=U(Rn,o,i,"TestLoadImage: error",!1,r),i.onabort=U(Rn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=U(Rn,o,i,"TestLoadImage: timeout",!1,r),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):Ee(2),t.v=0,t.f&&t.f.sa(e),hr(t),Xn(t)}function hr(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,H(t.g),t.g.length=0),t.f.ra())}function lr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof $e?Je(s):new $e(s,void 0);return""!=u.c?(e&&tn(u,e+"."+u.c),en(u,u.h)):(a=k.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new $e(null,void 0),r&&Ze(a,r),i&&tn(a,i),o&&en(a,o),s&&(a.g=s),u=a),t.V&&Z(t.V,function(t,e){rn(u,e,t)}),e=t.A,n=t.oa,e&&n&&rn(u,e,n),rn(u,"VER",t.ia),tr(t,u),u}function fr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new On(t.Oa)).G=t.C,e}function dr(){}function pr(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function yr(t,e){Bt.call(this),this.a=new zn(e),this.g=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.i=t),this.o=e&&e.supportsCrossDomainXhr||!1,this.m=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new vr(this)}function gr(t){Ce.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function mr(){ke.call(this),this.status=1}function vr(t){this.a=t}function br(t){this.f=t}function wr(t){Bt.call(this),this.u=t,this.h=void 0,this.readyState=Er,this.status=0,this.responseType=this.responseText=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.o="",this.a=!1,this.m=this.f=this.g=null}(N=On.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=(this.l||Oe).a(),this.u=this.l?Ne(this.l):Ne(Oe),this.a.onreadystatechange=V(this.Aa,this);try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(t){return void Un(this,t)}t=n||"";var i,o=new ze(this.headers);r&&He(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=k.FormData&&t instanceof k.FormData,0<=K(Fn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{Kn(this),0<this.s&&((this.F=(i=this.a,st&&yt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.s,this.a.ontimeout=V(this.ya,this)):this.o=ne(this.ya,this.s,this)),this.m=!0,this.a.send(t),this.m=!1}catch(t){Un(this,t)}},N.ya=function(){void 0!==C&&this.a&&(this.f="Timed out after "+this.s+"ms, aborting",this.h=8,jt(this,"timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,jt(this,"complete"),jt(this,"abort"),jn(this))},N.H=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),On.X.H.call(this)},N.Aa=function(){this.j||(this.B||this.m||this.g?Bn(this):this.Za())},N.Za=function(){Bn(this)},N.W=function(){try{return 2<Gn(this)?this.a.status:-1}catch(t){return-1}},N.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Qa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},N.va=function(){return this.h},N.Ra=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=zn.prototype).ia=8,N.v=1,N.Ca=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new xe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?nt(r=tt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.ea)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=er(this,n,e),rn(i=Je(this.B),"RID",t),rn(i,"CVER",22),this.A&&rn(i,"X-HTTP-Session-Id",this.A),tr(this,i),this.i&&r&&Qn(i,this.i,r),An(this.b,n),this.Ja&&rn(i,"TYPE","init"),this.ea?(rn(i,"$req",e),rn(i,"SID","null"),n.U=!0,Fe(n,i,null)):Fe(n,i,e),this.v=2}}else 3==this.v&&(t?Zn(this,t):0==this.g.length||In(this.b)||Zn(this))},N.Ba=function(){var t;this.j=null,or(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ie(V(this.Ya,this),t))},N.Ya=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.F=!0,Ee(10),Yn(this),or(this))},N.Xa=function(){null!=this.m&&(this.m=null,Yn(this),rr(this),Ee(19))},N.cb=function(t){t?(this.c.info("Successfully pinged google.com"),Ee(2)):(this.c.info("Failed to ping google.com"),Ee(1))},(N=dr.prototype).ua=function(){},N.ta=function(){},N.sa=function(){},N.ra=function(){},N.Ka=function(){},pr.prototype.a=function(t,e){return new yr(t,e)},B(yr,Bt),yr.prototype.h=function(){this.a.f=this.f,this.o&&(this.a.C=!0);var t=this.a,e=this.g,n=this.b||void 0;Ee(0),t.ga=e,t.V=n||{},t.G=t.S,t.B=lr(t,null,t.ga),Jn(t)},yr.prototype.close=function(){Wn(this.a)},yr.prototype.l=function(t){var e;"string"==typeof t?((e={}).__data__=t,$n(this.a,e)):this.m?((e={}).__data__=Gt(t),$n(this.a,e)):$n(this.a,t)},yr.prototype.H=function(){this.a.f=null,delete this.f,Wn(this.a),delete this.a,yr.X.H.call(this)},B(gr,Ce),B(mr,ke),B(vr,dr),vr.prototype.ua=function(){jt(this.a,"a")},vr.prototype.ta=function(t){jt(this.a,new gr(t))},vr.prototype.sa=function(t){jt(this.a,new mr)},vr.prototype.ra=function(){jt(this.a,"b")},B(br,Ae),br.prototype.a=function(){return new wr(this.f)},br.prototype.c=(Ln={},function(){return Ln}),B(wr,Bt);var Er=0;function Tr(t){t.f.read().then(t.Ta.bind(t)).catch(t.ca.bind(t))}function Ir(t){t.readyState=4,t.g=null,t.f=null,t.m=null,_r(t)}function _r(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(N=wr.prototype).open=function(t,e){if(this.readyState!=Er)throw this.abort(),Error("Error reopening a connection");this.s=t,this.o=e,this.readyState=1,_r(this)},N.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.l,method:this.s,credentials:this.h,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.o,e)).then(this.Wa.bind(this),this.ca.bind(this))},N.abort=function(){this.responseText="",this.l=new Headers,this.status=0,this.f&&this.f.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Ir(this)),this.readyState=Er},N.Wa=function(t){this.a&&(this.g=t,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=t.headers,this.readyState=2,_r(this)),this.a&&(this.readyState=3,_r(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.Ua.bind(this),this.ca.bind(this)):void 0!==k.ReadableStream&&"body"in t?(this.responseText="",this.f=t.body.getReader(),this.m=new TextDecoder,Tr(this)):t.text().then(this.Va.bind(this),this.ca.bind(this)))))},N.Ta=function(t){var e;this.a&&((e=this.m.decode(t.value||new Uint8Array(0),{stream:!t.done}))&&(this.responseText+=e),(t.done?Ir:_r)(this),3==this.readyState&&Tr(this))},N.Va=function(t){this.a&&(this.responseText=t,Ir(this))},N.Ua=function(){this.a&&Ir(this)},N.ca=function(){this.a&&Ir(this)},N.setRequestHeader=function(t,e){this.l.append(t,e)},N.getResponseHeader=function(t){return this.b&&this.b.get(t.toLowerCase())||""},N.getAllResponseHeaders=function(){if(!this.b)return"";for(var t=[],e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(wr.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(t){this.h=t?"include":"same-origin"}}),pr.prototype.createWebChannel=pr.prototype.a,yr.prototype.send=yr.prototype.l,yr.prototype.open=yr.prototype.h,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,Se.COMPLETE="complete",(De.EventType=D).OPEN="a",D.CLOSE="b",D.ERROR="c",D.MESSAGE="d",Bt.prototype.listen=Bt.prototype.wa,On.prototype.listenOnce=On.prototype.xa,On.prototype.getLastError=On.prototype.Ra,On.prototype.getLastErrorCode=On.prototype.va,On.prototype.getStatus=On.prototype.W,On.prototype.getResponseJson=On.prototype.Qa,On.prototype.getResponseText=On.prototype.$,On.prototype.send=On.prototype.ba;var Sr=me,Ar=_e,Nr=Se,Dr=ye,Cr=10,kr=11,Rr=br,xr=De,Or=On,Lr=(Pr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Pr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Pr);function Pr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Lr.o=-1;var Mr,Fr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=(n(qr,Mr=Error),qr),Ur=new I("@firebase/firestore");function qr(t,e){var n=this;return(n=Mr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Br(){return Ur.logLevel}function jr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=p.DEBUG&&(e=n.map(Qr),Ur.debug.apply(Ur,s(["Firestore (8.6.4): "+t],e)))}function Kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=p.ERROR&&(e=n.map(Qr),Ur.error.apply(Ur,s(["Firestore (8.6.4): "+t],e)))}function Gr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=p.WARN&&(e=n.map(Qr),Ur.warn.apply(Ur,s(["Firestore (8.6.4): "+t],e)))}function Qr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Hr(t){t="FIRESTORE (8.6.4) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Kr(t),new Error(t)}function zr(t){t||Hr()}var Wr=(Yr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Yr);function Yr(){}function Xr(t,e){return t<e?-1:e<t?1:0}function $r(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Jr(t){return t+"\0"}var Zr=(ni.now=function(){return ni.fromMillis(Date.now())},ni.fromDate=function(t){return ni.fromMillis(t.getTime())},ni.fromMillis=function(t){var e=Math.floor(t/1e3);return new ni(e,Math.floor(1e6*(t-1e3*e)))},ni.prototype.toDate=function(){return new Date(this.toMillis())},ni.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ni.prototype._compareTo=function(t){return this.seconds===t.seconds?Xr(this.nanoseconds,t.nanoseconds):Xr(this.seconds,t.seconds)},ni.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ni.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ni.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ni.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ni),ti=(ei.fromTimestamp=function(t){return new ei(t)},ei.min=function(){return new ei(new Zr(0,0))},ei.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},ei.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ei.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ei.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ei.prototype.toTimestamp=function(){return this.timestamp},ei);function ei(t){this.timestamp=t}function ni(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ri(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function ii(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function oi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var si,ai,Se=(Object.defineProperty(mi.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),mi.prototype.isEqual=function(t){return 0===mi.comparator(this,t)},mi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof mi?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},mi.prototype.limit=function(){return this.offset+this.length},mi.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},mi.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},mi.prototype.firstSegment=function(){return this.segments[this.offset]},mi.prototype.lastSegment=function(){return this.get(this.length-1)},mi.prototype.get=function(t){return this.segments[this.offset+t]},mi.prototype.isEmpty=function(){return 0===this.length},mi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},mi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},mi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},mi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},mi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},mi),ui=(n(gi,ai=Se),gi.prototype.construct=function(t,e,n){return new gi(t,e,n)},gi.prototype.canonicalString=function(){return this.toArray().join("/")},gi.prototype.toString=function(){return this.canonicalString()},gi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new gi(n)},gi.emptyPath=function(){return new gi([])},gi),ci=/^[_a-zA-Z][_a-zA-Z0-9]*$/,hi=(n(yi,si=Se),yi.prototype.construct=function(t,e,n){return new yi(t,e,n)},yi.isValidIdentifier=function(t){return ci.test(t)},yi.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!yi.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},yi.prototype.toString=function(){return this.canonicalString()},yi.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},yi.keyField=function(){return new yi(["__name__"])},yi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Vr(Fr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Vr(Fr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Vr(Fr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new yi(e)},yi.emptyPath=function(){return new yi([])},yi),li=(pi.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},pi.prototype.isEqual=function(t){return $r(this.fields,t.fields,function(t,e){return t.isEqual(e)})},pi),fi=(di.fromBase64String=function(t){return new di(atob(t))},di.fromUint8Array=function(t){return new di(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},di.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},di.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},di.prototype.approximateByteSize=function(){return 2*this.binaryString.length},di.prototype.compareTo=function(t){return Xr(this.binaryString,t.binaryString)},di.prototype.isEqual=function(t){return this.binaryString===t.binaryString},di);function di(t){this.binaryString=t}function pi(t){(this.fields=t).sort(hi.comparator)}function yi(){return null!==si&&si.apply(this,arguments)||this}function gi(){return null!==ai&&ai.apply(this,arguments)||this}function mi(t,e,n){void 0===e?e=0:e>t.length&&Hr(),void 0===n?n=t.length-e:n>t.length-e&&Hr(),this.segments=t,this.offset=e,this.len=n}fi.EMPTY_BYTE_STRING=new fi("");var vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bi(t){if(zr(!!t),"string"!=typeof t)return{seconds:wi(t.seconds),nanos:wi(t.nanos)};var e=0,n=vi.exec(t);zr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function wi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ei(t){return"string"==typeof t?fi.fromBase64String(t):fi.fromUint8Array(t)}function Ti(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ii(t){t=bi(t.mapValue.fields.__local_write_time__.timestampValue);return new Zr(t.seconds,t.nanos)}function _i(t){return null==t}function Si(t){return 0===t&&1/t==-1/0}function Ai(t){return"number"==typeof t&&Number.isInteger(t)&&!Si(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ni=(Di.fromPath=function(t){return new Di(ui.fromString(t))},Di.fromName=function(t){return new Di(ui.fromString(t).popFirst(5))},Di.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Di.prototype.isEqual=function(t){return null!==t&&0===ui.comparator(this.path,t.path)},Di.prototype.toString=function(){return this.path.toString()},Di.comparator=function(t,e){return ui.comparator(t.path,e.path)},Di.isDocumentKey=function(t){return t.length%2==0},Di.fromSegments=function(t){return new Di(new ui(t.slice()))},Di);function Di(t){this.path=t}function Ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ti(t)?4:10:Hr()}function ki(r,i){var t,e,n=Ci(r);if(n!==Ci(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Ii(r).isEqual(Ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=bi(r.timestampValue),t=bi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,Ei(r.bytesValue).isEqual(Ei(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,wi((e=r).geoPointValue.latitude)===wi(t.geoPointValue.latitude)&&wi(e.geoPointValue.longitude)===wi(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return wi(t.integerValue)===wi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=wi(t.doubleValue),e=wi(e.doubleValue);return t===e?Si(t)===Si(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return $r(r.arrayValue.values||[],i.arrayValue.values||[],ki);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(ri(e)!==ri(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!ki(e[t],n[t])))return!1;return!0}();default:return Hr()}}function Ri(t,e){return void 0!==(t.values||[]).find(function(t){return ki(t,e)})}function xi(t,e){var n,r,i,o=Ci(t),s=Ci(e);if(o!==s)return Xr(o,s);switch(o){case 0:return 0;case 1:return Xr(t.booleanValue,e.booleanValue);case 2:return r=e,i=wi(t.integerValue||t.doubleValue),r=wi(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return Oi(t.timestampValue,e.timestampValue);case 4:return Oi(Ii(t),Ii(e));case 5:return Xr(t.stringValue,e.stringValue);case 6:return function(t,e){t=Ei(t),e=Ei(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Xr(n[i],r[i]);if(0!==o)return o}return Xr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Xr(wi(n.latitude),wi(i.latitude)))?r:Xr(wi(n.longitude),wi(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=xi(n[i],r[i]);if(o)return o}return Xr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Xr(r[s],o[s]);if(0!==a)return a;a=xi(n[r[s]],i[o[s]]);if(0!==a)return a}return Xr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Hr()}}function Oi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Xr(t,e);var n=bi(t),t=bi(e),e=Xr(n.seconds,t.seconds);return 0!==e?e:Xr(n.nanos,t.nanos)}function Li(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){t=bi(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ei(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Ni.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Hr();var e}(t)}function Pi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Mi(t){return t&&"integerValue"in t}function Fi(t){return!!t&&"arrayValue"in t}function Vi(t){return t&&"nullValue"in t}function Ui(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function qi(t){return t&&"mapValue"in t}function Bi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},bi(t.timestampValue))};if(t.mapValue){var n={mapValue:{fields:{}}};return ii(t.mapValue.fields,function(t,e){return n.mapValue.fields[t]=Bi(e)}),n}if(t.arrayValue){for(var e={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Bi(t.arrayValue.values[r]);return e}return Object.assign({},t)}var ji=(Ki.empty=function(){return new Ki({mapValue:{}})},Ki.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!qi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},Ki.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bi(e)},Ki.prototype.setAll=function(t){var r=this,i=hi.emptyPath(),o={},s=[];t.forEach(function(t,e){var n;i.isImmediateParentOf(e)||(n=r.getFieldsMap(i),r.applyChanges(n,o,s),o={},s=[],i=e.popLast()),t?o[e.lastSegment()]=Bi(t):s.push(e.lastSegment())});t=this.getFieldsMap(i);this.applyChanges(t,o,s)},Ki.prototype.delete=function(t){var e=this.field(t.popLast());qi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},Ki.prototype.isEqual=function(t){return ki(this.value,t.value)},Ki.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];qi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},Ki.prototype.applyChanges=function(n,t,e){ii(t,function(t,e){return n[t]=e});for(var r=0,i=e;r<i.length;r++){var o=i[r];delete n[o]}},Ki.prototype.clone=function(){return new Ki(Bi(this.value))},Ki);function Ki(t){this.value=t}var Gi=(Hi.newInvalidDocument=function(t){return new Hi(t,0,ti.min(),ji.empty(),0)},Hi.newFoundDocument=function(t,e,n){return new Hi(t,1,e,n,0)},Hi.newNoDocument=function(t,e){return new Hi(t,2,e,ji.empty(),0)},Hi.newUnknownDocument=function(t,e){return new Hi(t,3,e,ji.empty(),2)},Hi.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Hi.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ji.empty(),this.documentState=0,this},Hi.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ji.empty(),this.documentState=2,this},Hi.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Hi.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Hi.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Hi.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Hi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Hi.prototype.isValidDocument=function(){return 0!==this.documentType},Hi.prototype.isFoundDocument=function(){return 1===this.documentType},Hi.prototype.isNoDocument=function(){return 2===this.documentType},Hi.prototype.isUnknownDocument=function(){return 3===this.documentType},Hi.prototype.isEqual=function(t){return t instanceof Hi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Hi.prototype.clone=function(){return new Hi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Hi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Hi),Qi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Hi(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function zi(t,e,n,r,i,o,s){return new Qi(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Wi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+Li(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),_i(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=_o(e.startAt)),e.endAt&&(t+="|ub:",t+=_o(e.endAt)),e.h=t),e.h}function Yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!ki(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!No(t.startAt,e.startAt)&&No(t.endAt,e.endAt)}function Xi(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var $i,Ji=(n(Zi,$i=function(){}),Zi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new ro(t,e,n):"array-contains"===e?new yo(t,n):"in"===e?new go(t,n):"not-in"===e?new mo(t,n):"array-contains-any"===e?new vo(t,n):new Zi(t,e,n)},Zi.l=function(t,e,n){return new("in"===e?io:oo)(t,n)},Zi.prototype.matches=function(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.m(xi(t,this.value)):null!==t&&Ci(this.value)===Ci(t)&&this.m(xi(t,this.value))},Zi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Hr()}},Zi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Zi);function Zi(t,e,n){var r=this;return(r=$i.call(this)||this).field=t,r.op=e,r.value=n,r}var to,eo,no,ro=(n(uo,no=Ji),uo.prototype.matches=function(t){t=Ni.comparator(t.key,this.key);return this.m(t)},uo),io=(n(ao,eo=Ji),ao.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},ao),oo=(n(so,to=Ji),so.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},so);function so(t,e){var n=this;return(n=to.call(this,t,"not-in",e)||this).keys=co(0,e),n}function ao(t,e){var n=this;return(n=eo.call(this,t,"in",e)||this).keys=co(0,e),n}function uo(t,e,n){var r=this;return(r=no.call(this,t,e,n)||this).key=Ni.fromName(n.referenceValue),r}function co(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Ni.fromName(t.referenceValue)})}var ho,lo,fo,po,yo=(n(Io,po=Ji),Io.prototype.matches=function(t){t=t.data.field(this.field);return Fi(t)&&Ri(t.arrayValue,this.value)},Io),go=(n(To,fo=Ji),To.prototype.matches=function(t){t=t.data.field(this.field);return null!==t&&Ri(this.value.arrayValue,t)},To),mo=(n(Eo,lo=Ji),Eo.prototype.matches=function(t){if(Ri(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!Ri(this.value.arrayValue,t)},Eo),vo=(n(wo,ho=Ji),wo.prototype.matches=function(t){var e=this,t=t.data.field(this.field);return!(!Fi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Ri(e.value.arrayValue,t)})},wo),bo=function(t,e){this.position=t,this.before=e};function wo(t,e){return ho.call(this,t,"array-contains-any",e)||this}function Eo(t,e){return lo.call(this,t,"not-in",e)||this}function To(t,e){return fo.call(this,t,"in",e)||this}function Io(t,e){return po.call(this,t,"array-contains",e)||this}function _o(t){return(t.before?"b":"a")+":"+t.position.map(Li).join(",")}var So=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ao(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?Ni.comparator(Ni.fromName(s.referenceValue),n.key):xi(s,n.data.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function No(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ki(t.position[n],e.position[n]))return!1;return!0}var Do=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Co(t,e,n,r,i,o,s,a){return new Do(t,e,n,r,i,o,s,a)}function ko(t){return new Do(t)}function Ro(t){return!_i(t.limit)&&"F"===t.limitType}function xo(t){return!_i(t.limit)&&"L"===t.limitType}function Oo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Lo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Po(t){return null!==t.collectionGroup}function Mo(t){var e=t;if(null===e.p){e.p=[];var n=Lo(e),t=Oo(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new So(n)),e.p.push(new So(hi.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new So(hi.keyField(),n)))}}return e.p}function Fo(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=zi(e.path,e.collectionGroup,Mo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Mo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new So(o.field,s))}var a=e.endAt?new bo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new bo(e.startAt.position,!e.startAt.before):null;e.T=zi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Vo(t,e,n){return new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Uo(t,e){return Yi(Fo(t),Fo(e))&&t.limitType===e.limitType}function qo(t){return Wi(Fo(t))+"|lt:"+t.limitType}function Bo(t){return"Query(target="+(e=Fo(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Li(t.value)}).join(", ")+"]"),_i(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+_o(e.startAt)),e.endAt&&(n+=", endAt: "+_o(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function jo(i,t){return t.isFoundDocument()&&(e=i,n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ni.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Ao(t.startAt,Mo(t),n))&&(!t.endAt||!Ao(t.endAt,Mo(t),n)));var e,n}function Ko(a){return function(t,e){for(var n=!1,r=0,i=Mo(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?Ni.comparator(r.key,e.key):function(t,e){var n=r.data.field(t),t=e.data.field(t);return null!==n&&null!==t?xi(n,t):Hr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Hr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function Go(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Si(e)?"-0":e}}function Qo(t){return{integerValue:""+t}}function Ho(t,e){return Ai(e)?Qo(e):Go(t,e)}I=function(){this._=void 0};function zo(t,e){return t instanceof ss?Mi(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Wo,Yo,Xo=(n(Zo,Yo=I),Zo),$o=(n(Jo,Wo=I),Jo);function Jo(t){var e=this;return(e=Wo.call(this)||this).elements=t,e}function Zo(){return null!==Yo&&Yo.apply(this,arguments)||this}function ts(t,e){for(var n=cs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return ki(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var es,ns=(n(rs,es=I),rs);function rs(t){var e=this;return(e=es.call(this)||this).elements=t,e}function is(t,e){for(var n=cs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!ki(t,e)})}(i[r]);return{arrayValue:{values:n}}}var os,ss=(n(as,os=I),as);function as(t,e){var n=this;return(n=os.call(this)||this).R=t,n.A=e,n}function us(t){return wi(t.integerValue||t.doubleValue)}function cs(t){return Fi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function hs(t,e){this.version=t,this.transformResults=e}var ls=function(t,e){this.field=t,this.transform=e},fs=(ds.none=function(){return new ds},ds.exists=function(t){return new ds(void 0,t)},ds.updateTime=function(t){return new ds(t)},Object.defineProperty(ds.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),ds.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},ds);function ds(t,e){this.updateTime=t,this.exists=e}function ps(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}Se=function(){};function ys(t,e,n){var r,i,o,s;t instanceof ws?(i=e,o=n,ps((r=t).precondition,i)&&(s=r.value.clone(),o=As(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(ms(i),s).setHasLocalMutations())):t instanceof Es?(o=e,i=n,ps((s=t).precondition,o)&&(n=As(s.fieldTransforms,i,o),(i=o.data).setAll(_s(s)),i.setAll(n),o.convertToFoundDocument(ms(o),i).setHasLocalMutations())):(e=e,ps(t.precondition,e)&&e.convertToNoDocument(ti.min()))}function gs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&$r(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof $o&&e instanceof $o||t instanceof ns&&e instanceof ns?$r(t.elements,e.elements,ki):t instanceof ss&&e instanceof ss?ki(t.A,e.A):t instanceof Xo&&e instanceof Xo)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ms(t){return t.isFoundDocument()?t.version:ti.min()}var vs,bs,ws=(n(Is,bs=Se),Is),Es=(n(Ts,vs=Se),Ts);function Ts(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=vs.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function Is(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=bs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function _s(n){var r=new Map;return n.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function Ss(t,e,n){var r=new Map;zr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof $o?ts(o,s):o instanceof ns?is(o,s):a))}return r}function As(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof Xo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof $o?ts(u,r):u instanceof ns?is(u,r):(u=zo(c=u,r),r=us(u)+us(c.A),Mi(u)&&Mi(c.A)?Qo(r):Go(c.R,r))))}return i}function Ns(t){this.count=t}var Ds,Cs,ks,Rs=(n(Ls,ks=Se),Ls),xs=(n(Os,Cs=Se),Os);function Os(t,e){var n=this;return(n=Cs.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Ls(t,e){var n=this;return(n=ks.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Ps(t){switch(t){case Fr.OK:return Hr(),0;case Fr.CANCELLED:case Fr.UNKNOWN:case Fr.DEADLINE_EXCEEDED:case Fr.RESOURCE_EXHAUSTED:case Fr.INTERNAL:case Fr.UNAVAILABLE:case Fr.UNAUTHENTICATED:return;case Fr.INVALID_ARGUMENT:case Fr.NOT_FOUND:case Fr.ALREADY_EXISTS:case Fr.PERMISSION_DENIED:case Fr.FAILED_PRECONDITION:case Fr.ABORTED:case Fr.OUT_OF_RANGE:case Fr.UNIMPLEMENTED:case Fr.DATA_LOSS:return 1;default:return Hr(),0}}function Ms(t){if(void 0===t)return Kr("GRPC error has no .code"),Fr.UNKNOWN;switch(t){case Ds.OK:return Fr.OK;case Ds.CANCELLED:return Fr.CANCELLED;case Ds.UNKNOWN:return Fr.UNKNOWN;case Ds.DEADLINE_EXCEEDED:return Fr.DEADLINE_EXCEEDED;case Ds.RESOURCE_EXHAUSTED:return Fr.RESOURCE_EXHAUSTED;case Ds.INTERNAL:return Fr.INTERNAL;case Ds.UNAVAILABLE:return Fr.UNAVAILABLE;case Ds.UNAUTHENTICATED:return Fr.UNAUTHENTICATED;case Ds.INVALID_ARGUMENT:return Fr.INVALID_ARGUMENT;case Ds.NOT_FOUND:return Fr.NOT_FOUND;case Ds.ALREADY_EXISTS:return Fr.ALREADY_EXISTS;case Ds.PERMISSION_DENIED:return Fr.PERMISSION_DENIED;case Ds.FAILED_PRECONDITION:return Fr.FAILED_PRECONDITION;case Ds.ABORTED:return Fr.ABORTED;case Ds.OUT_OF_RANGE:return Fr.OUT_OF_RANGE;case Ds.UNIMPLEMENTED:return Fr.UNIMPLEMENTED;case Ds.DATA_LOSS:return Fr.DATA_LOSS;default:return Hr()}}(I=Ds=Ds||{})[I.OK=0]="OK",I[I.CANCELLED=1]="CANCELLED",I[I.UNKNOWN=2]="UNKNOWN",I[I.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",I[I.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",I[I.NOT_FOUND=5]="NOT_FOUND",I[I.ALREADY_EXISTS=6]="ALREADY_EXISTS",I[I.PERMISSION_DENIED=7]="PERMISSION_DENIED",I[I.UNAUTHENTICATED=16]="UNAUTHENTICATED",I[I.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",I[I.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",I[I.ABORTED=10]="ABORTED",I[I.OUT_OF_RANGE=11]="OUT_OF_RANGE",I[I.UNIMPLEMENTED=12]="UNIMPLEMENTED",I[I.INTERNAL=13]="INTERNAL",I[I.UNAVAILABLE=14]="UNAVAILABLE",I[I.DATA_LOSS=15]="DATA_LOSS";var Fs=(js.prototype.insert=function(t,e){return new js(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Us.BLACK,null,null))},js.prototype.remove=function(t){return new js(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Us.BLACK,null,null))},js.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},js.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},js.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(js.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),js.prototype.minKey=function(){return this.root.minKey()},js.prototype.maxKey=function(){return this.root.maxKey()},js.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},js.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},js.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},js.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},js.prototype.getIterator=function(){return new Vs(this.root,null,this.comparator,!1)},js.prototype.getIteratorFrom=function(t){return new Vs(this.root,t,this.comparator,!1)},js.prototype.getReverseIterator=function(){return new Vs(this.root,null,this.comparator,!0)},js.prototype.getReverseIteratorFrom=function(t){return new Vs(this.root,t,this.comparator,!0)},js),Vs=(Bs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Bs.prototype.hasNext=function(){return 0<this.nodeStack.length},Bs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Bs),Us=(qs.prototype.copy=function(t,e,n,r,i){return new qs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},qs.prototype.isEmpty=function(){return!1},qs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},qs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},qs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},qs.prototype.minKey=function(){return this.min().key},qs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},qs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},qs.prototype.removeMin=function(){if(this.left.isEmpty())return qs.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},qs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return qs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},qs.prototype.isRed=function(){return this.color},qs.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},qs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},qs.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},qs.prototype.rotateLeft=function(){var t=this.copy(null,null,qs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},qs.prototype.rotateRight=function(){var t=this.copy(null,null,qs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},qs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},qs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},qs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Hr();if(this.right.isRed())throw Hr();var t=this.left.check();if(t!==this.right.check())throw Hr();return t+(this.isRed()?0:1)},qs);function qs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:qs.RED,this.left=null!=r?r:qs.EMPTY,this.right=null!=i?i:qs.EMPTY,this.size=this.left.size+1+this.right.size}function Bs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function js(t,e){this.comparator=t,this.root=e||Us.EMPTY}function Ks(){this.size=0}Us.EMPTY=null,Us.RED=!0,Us.BLACK=!1,Us.EMPTY=(Object.defineProperty(Ks.prototype,"key",{get:function(){throw Hr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ks.prototype,"value",{get:function(){throw Hr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ks.prototype,"color",{get:function(){throw Hr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ks.prototype,"left",{get:function(){throw Hr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ks.prototype,"right",{get:function(){throw Hr()},enumerable:!1,configurable:!0}),Ks.prototype.copy=function(t,e,n,r,i){return this},Ks.prototype.insert=function(t,e,n){return new Us(t,e)},Ks.prototype.remove=function(t,e){return this},Ks.prototype.isEmpty=function(){return!0},Ks.prototype.inorderTraversal=function(t){return!1},Ks.prototype.reverseTraversal=function(t){return!1},Ks.prototype.minKey=function(){return null},Ks.prototype.maxKey=function(){return null},Ks.prototype.isRed=function(){return!1},Ks.prototype.checkMaxDepth=function(){return!0},Ks.prototype.check=function(){return 0},new Ks);var Gs=(Ws.prototype.has=function(t){return null!==this.data.get(t)},Ws.prototype.first=function(){return this.data.minKey()},Ws.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Ws.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Ws.prototype.indexOf=function(t){return this.data.indexOf(t)},Ws.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Ws.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Ws.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Ws.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Ws.prototype.getIterator=function(){return new Qs(this.data.getIterator())},Ws.prototype.getIteratorFrom=function(t){return new Qs(this.data.getIteratorFrom(t))},Ws.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Ws.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Ws.prototype.isEmpty=function(){return this.data.isEmpty()},Ws.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Ws.prototype.isEqual=function(t){if(!(t instanceof Ws))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Ws.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Ws.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Ws.prototype.copy=function(t){var e=new Ws(this.comparator);return e.data=t,e},Ws),Qs=(zs.prototype.getNext=function(){return this.iter.getNext().key},zs.prototype.hasNext=function(){return this.iter.hasNext()},zs),Hs=new Fs(Ni.comparator);function zs(t){this.iter=t}function Ws(t){this.comparator=t,this.data=new Fs(this.comparator)}var Ys=new Fs(Ni.comparator);var Xs=new Fs(Ni.comparator);var $s=new Gs(Ni.comparator);function Js(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=$s,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Zs=new Gs(Xr);var ta=(ha.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,ea.createSynthesizedTargetChangeForCurrentChange(t,e)),new ha(ti.min(),n,Zs,Hs,Js())},ha),ea=(ca.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new ca(fi.EMPTY_BYTE_STRING,e,Js(),Js(),Js())},ca),na=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ra=function(t,e){this.targetId=t,this.V=e},ia=function(t,e,n,r){void 0===n&&(n=fi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},oa=(Object.defineProperty(ua.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),ua.prototype.O=function(t){0<t.approximateByteSize()&&(this.F=!0,this.C=t)},ua.prototype.M=function(){var n=Js(),r=Js(),i=Js();return this.D.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Hr()}}),new ea(this.C,this.N,n,r,i)},ua.prototype.L=function(){this.F=!1,this.D=fa()},ua.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},ua.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},ua.prototype.U=function(){this.S+=1},ua.prototype.K=function(){--this.S},ua.prototype.j=function(){this.F=!0,this.N=!0},ua),sa=(aa.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},aa.prototype.et=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.nt(t);switch(n.state){case 0:r.st(t)&&e.O(n.resumeToken);break;case 1:e.K(),e.k||e.L(),e.O(n.resumeToken);break;case 2:e.K(),e.k||r.removeTarget(t);break;case 3:r.st(t)&&(e.j(),e.O(n.resumeToken));break;case 4:r.st(t)&&(r.it(t),e.O(n.resumeToken));break;default:Hr()}})},aa.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach(function(t,e){r.st(e)&&n(e)})},aa.prototype.rt=function(t){var e=t.targetId,n=t.V.count,t=this.ot(e);t&&(Xi(t=t.target)?0===n?(t=new Ni(t.path),this.tt(e,t,Gi.newNoDocument(t,ti.min()))):zr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},aa.prototype.ut=function(r){var i=this,o=new Map;this.G.forEach(function(t,e){var n=i.ot(e);n&&(t.current&&Xi(n.target)&&(n=new Ni(n.target.path),null!==i.H.get(n)||i.at(e,n)||i.tt(e,n,Gi.newNoDocument(n,r))),t.$&&(o.set(e,t.M()),t.L()))});var s=Js();this.J.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.ot(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new ta(r,o,this.Y,this.H,s);return this.H=Hs,this.J=la(),this.Y=new Gs(Xr),t},aa.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},aa.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},aa.prototype.removeTarget=function(t){this.G.delete(t)},aa.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},aa.prototype.U=function(t){this.nt(t).U()},aa.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new oa,this.G.set(t,e)),e},aa.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Gs(Xr),this.J=this.J.insert(t,e)),e},aa.prototype.st=function(t){var e=null!==this.ot(t);return e||jr("WatchChangeAggregator","Detected inactive target",t),e},aa.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},aa.prototype.it=function(e){var n=this;this.G.set(e,new oa),this.W.getRemoteKeysForTarget(e).forEach(function(t){n.tt(e,t,null)})},aa.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},aa);function aa(t){this.W=t,this.G=new Map,this.H=Hs,this.J=la(),this.Y=new Gs(Xr)}function ua(){this.S=0,this.D=fa(),this.C=fi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}function ca(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function ha(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function la(){return new Fs(Ni.comparator)}function fa(){return new Fs(Ni.comparator)}var da={asc:"ASCENDING",desc:"DESCENDING"},pa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ya=function(t,e){this.databaseId=t,this.I=e};function ga(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ma(t,e){return t.I?e.toBase64():e.toUint8Array()}function va(t){return zr(!!t),ti.fromTimestamp((t=bi(t),new Zr(t.seconds,t.nanos)))}function ba(t,e){return new ui(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function wa(t){t=ui.fromString(t);return zr(qa(t)),t}function Ea(t,e){return ba(t.databaseId,e.path)}function Ta(t,e){e=wa(e);if(e.get(1)!==t.databaseId.projectId)throw new Vr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Vr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Ni(Aa(e))}function Ia(t,e){return ba(t.databaseId,e)}function _a(t){t=wa(t);return 4===t.length?ui.emptyPath():Aa(t)}function Sa(t){return new ui(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Aa(t){return zr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Na(t,e,n){return{name:Ea(t,e),fields:n.value.mapValue.fields}}function Da(t,e,n){var r=Ta(t,e.name),t=va(e.updateTime),e=new ji({mapValue:{fields:e.fields}}),e=Gi.newFoundDocument(r,t,e);return n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function Ca(t,e){var n,r,i;if(e instanceof ws)n={update:Na(t,e.key,e.value)};else if(e instanceof Rs)n={delete:Ea(t,e.key)};else if(e instanceof Es)n={update:Na(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach(function(t){return i.push(t.canonicalString())}),{fieldPaths:i})};else{if(!(e instanceof xs))return Hr();n={verify:Ea(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Xo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof $o)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof ns)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof ss)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Hr()})),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:ga(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Hr()),n}function ka(e,t){var n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?fs.updateTime(va(s.updateTime)):void 0!==s.exists?fs.exists(s.exists):fs.none():fs.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(zr("REQUEST_TIME"===e.setToServerValue),r=new Xo):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new $o(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new ns(n)):"increment"in e?r=new ss(t,e.increment):Hr();e=hi.fromServerFormat(e.fieldPath);return new ls(e,r)}(e,t)}):[];if(t.update){t.update.name;var i=Ta(e,t.update.name),o=new ji({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new li(s.map(function(t){return hi.fromServerFormat(t)})));return new Es(i,o,s,n,r)}return new ws(i,o,n,r)}if(t.delete){r=Ta(e,t.delete);return new Rs(r,n)}if(t.verify){t=Ta(e,t.verify);return new xs(t,n)}return Hr()}function Ra(t,e){return{documents:[Ia(t,e.path)]}}function xa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ia(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ia(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Ui(t.value))return{unaryFilter:{field:Ma(t.field),op:"IS_NAN"}};if(Vi(t.value))return{unaryFilter:{field:Ma(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ui(t.value))return{unaryFilter:{field:Ma(t.field),op:"IS_NOT_NAN"}};if(Vi(t.value))return{unaryFilter:{field:Ma(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ma(t.field),op:(e=t.op,pa[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Ma((t=t).field),direction:(t=t.dir,da[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.I||_i(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=La(e.startAt)),e.endAt&&(n.structuredQuery.endAt=La(e.endAt)),n}function Oa(t){var e=_a(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(zr(1===r),(a=n.from[0]).allDescendants?i=a.collectionId:e=e.child(a.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[Ua(t)]:void 0!==t.fieldFilter?[Va(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Hr():[]}(n.where));var s=[],t=null,r=null,a=null;return Co(e,i,s=n.orderBy?n.orderBy.map(function(t){return new So(Fa((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}):s,o,t=n.limit?_i(o="object"==typeof(o=n.limit)?o.value:o)?null:o:t,"F",r=n.startAt?Pa(n.startAt):r,a=n.endAt?Pa(n.endAt):a)}function La(t){return{before:t.before,values:t.position}}function Pa(t){var e=!!t.before,t=t.values||[];return new bo(t,e)}function Ma(t){return{fieldPath:t.canonicalString()}}function Fa(t){return hi.fromServerFormat(t.fieldPath)}function Va(t){return Ji.create(Fa(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Hr()}}(),t.fieldFilter.value)}function Ua(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Fa(t.unaryFilter.field);return Ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Fa(t.unaryFilter.field);return Ji.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Fa(t.unaryFilter.field);return Ji.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Fa(t.unaryFilter.field);return Ji.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Hr()}}function qa(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ba(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=ja(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return ja(e)}function ja(t){return t+"\x01\x01"}function Ka(t){var e=t.length;if(zr(2<=e),2===e)return zr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ui.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&Hr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Hr()}o=s+2}return new ui(r)}function Ga(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Qa=function(t,e){this.seconds=t,this.nanoseconds=e};Ga.store="owner",Ga.key="owner";function Ha(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}Ha.store="mutationQueues",Ha.keyPath="userId";function za(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}za.store="mutations",za.keyPath="batchId",za.userMutationsIndex="userMutationsIndex",za.userMutationsKeyPath=["userId","batchId"];var Wa=(Ya.prefixForUser=function(t){return[t]},Ya.prefixForPath=function(t,e){return[t,Ba(e)]},Ya.key=function(t,e,n){return[t,Ba(e),n]},Ya);function Ya(){}Wa.store="documentMutations",Wa.PLACEHOLDER=new Wa;function Xa(t,e){this.path=t,this.readTime=e}function $a(t,e){this.path=t,this.version=e}var Ja=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ja.store="remoteDocuments",Ja.readTimeIndex="readTimeIndex",Ja.readTimeIndexPath="readTime",Ja.collectionReadTimeIndex="collectionReadTimeIndex",Ja.collectionReadTimeIndexPath=["parentPath","readTime"];function Za(t){this.byteSize=t}Za.store="remoteDocumentGlobal",Za.key="remoteDocumentGlobalKey";function tu(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}tu.store="targets",tu.keyPath="targetId",tu.queryTargetsIndexName="queryTargetsIndex",tu.queryTargetsKeyPath=["canonicalId","targetId"];var eu=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};eu.store="targetDocuments",eu.keyPath=["targetId","path"],eu.documentTargetsIndex="documentTargetsIndex",eu.documentTargetsKeyPath=["path","targetId"];function nu(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}nu.key="targetGlobalKey",nu.store="targetGlobal";function ru(t,e){this.collectionId=t,this.parent=e}ru.store="collectionParents",ru.keyPath=["collectionId","parent"];function iu(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}iu.store="clientMetadata",iu.keyPath="clientId";function ou(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}ou.store="bundles",ou.keyPath="bundleId";function su(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}su.store="namedQueries",su.keyPath="name";var au,uu=s(s([],s(s([],s(s([],s(s([],[Ha.store,za.store,Wa.store,Ja.store,tu.store,Ga.store,nu.store,eu.store]),[iu.store])),[Za.store])),[ru.store])),[ou.store,su.store]),cu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Se=(Eu.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Eu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Eu),hu=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},lu=(wu.prototype.catch=function(t){return this.next(void 0,t)},wu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Hr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new wu(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},wu.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},wu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof wu?e:wu.resolve(e)}catch(t){return wu.reject(t)}},wu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):wu.resolve(e)},wu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):wu.reject(e)},wu.resolve=function(n){return new wu(function(t,e){t(n)})},wu.reject=function(n){return new wu(function(t,e){e(n)})},wu.waitFor=function(t){return new wu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},wu.or=function(t){for(var n=wu.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?wu.resolve(t):e()})}(r[e]);return n},wu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},wu),fu=(bu.open=function(t,e,n,r){try{return new bu(e,t.transaction(r,n))}catch(t){throw new yu(e,t)}},Object.defineProperty(bu.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),bu.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(jr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},bu.prototype.store=function(t){t=this.transaction.objectStore(t);return new Iu(t)},bu),du=(vu.delete=function(t){return jr("SimpleDb","Removing database:",t),Su(window.indexedDB.deleteDatabase(t)).toPromise()},vu.yt=function(){if("undefined"==typeof indexedDB)return!1;if(vu.gt())return!0;var t=h(),e=vu._t(t),n=0<e&&e<10,e=vu.Et(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},vu.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},vu.It=function(t,e){return t.store(e)},vu._t=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},vu.Et=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},vu.prototype.At=function(o){return y(this,void 0,void 0,function(){var e,i=this;return g(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(jr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new yu(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new Vr(Fr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new yu(o,t))},r.onupgradeneeded=function(t){jr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.wt.Rt(e,r.transaction,t.oldVersion,i.version).next(function(){jr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return i.bt(t)}),this.db)]}})})},vu.prototype.vt=function(e){this.bt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},vu.prototype.runTransaction=function(a,n,u,c){return y(this,void 0,void 0,function(){var i,o,s,e;return g(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.At(a)];case 2:return s.db=t.sent(),e=fu.open(s.db,a,i?"readonly":"readwrite",u),n=c(e).catch(function(t){return e.abort(t),lu.reject(t)}).toPromise(),r={},n.catch(function(){}),[4,e.dt];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,jr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},vu.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},vu),pu=(Object.defineProperty(mu.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(mu.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(mu.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),mu.prototype.done=function(){this.Vt=!0},mu.prototype.Ct=function(t){this.St=t},mu.prototype.delete=function(){return Su(this.Pt.delete())},mu),yu=(n(gu,au=Vr),gu);function gu(t,e){var n=this;return(n=au.call(this,Fr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function mu(t){this.Pt=t,this.Vt=!1,this.St=null}function vu(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===vu._t(h())&&Kr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function bu(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.ft=new hu,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){t.error?n.ft.reject(new yu(e,t.error)):n.ft.resolve()},this.transaction.onerror=function(t){t=Nu(t.target.error);n.ft.reject(new yu(e,t))}}function wu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function Eu(){this.onCommittedListeners=[]}function Tu(t){return"IndexedDbTransactionError"===t.name}var Iu=(_u.prototype.put=function(t,e){t=void 0!==e?(jr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(jr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Su(t)},_u.prototype.add=function(t){return jr("SimpleDb","ADD",this.store.name,t,t),Su(this.store.add(t))},_u.prototype.get=function(e){var n=this;return Su(this.store.get(e)).next(function(t){return jr("SimpleDb","GET",n.store.name,e,t=void 0===t?null:t),t})},_u.prototype.delete=function(t){return jr("SimpleDb","DELETE",this.store.name,t),Su(this.store.delete(t))},_u.prototype.count=function(){return jr("SimpleDb","COUNT",this.store.name),Su(this.store.count())},_u.prototype.Nt=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.xt(e,function(t,e){n.push(e)}).next(function(){return n})},_u.prototype.Ft=function(t,e){jr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.kt=!1;e=this.cursor(e);return this.xt(e,function(t,e,n){return n.delete()})},_u.prototype.$t=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.xt(n,e)},_u.prototype.Ot=function(r){var t=this.cursor({});return new lu(function(n,e){t.onerror=function(t){t=Nu(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},_u.prototype.xt=function(t,i){var o=[];return new lu(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new pu(n),(t=i(n.primaryKey,n.value,e))instanceof lu&&(t=t.catch(function(t){return e.done(),lu.reject(t)}),o.push(t)),e.isDone?r():null===e.Dt?n.continue():n.continue(e.Dt)):r()}}).next(function(){return lu.waitFor(o)})},_u.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},_u.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},_u);function _u(t){this.store=t}function Su(t){return new lu(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Nu(t.target.error);n(t)}})}var Au=!1;function Nu(t){var e=du._t(h());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new Vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Au||(Au=!0,setTimeout(function(){throw n},0)),n}}return t}var Du,Cu=(n(ku,Du=Se),ku);function ku(t,e){var n=this;return(n=Du.call(this)||this).Mt=t,n.currentSequenceNumber=e,n}function Ru(t,e){return du.It(t.Mt,e)}var xu=(Vu.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof ws?(s=r,a=i,h=(o=n).value.clone(),o=Ss(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof Es?(o=r,s=i,ps((a=n).precondition,o)?(h=Ss(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(_s(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Vu.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&ys(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&ys(r,t,this.localWriteTime)},Vu.prototype.applyToLocalDocumentSet=function(n){var r=this;this.mutations.forEach(function(t){var e=n.get(t.key),t=e;r.applyToLocalView(t),e.isValidDocument()||t.convertToNoDocument(ti.min())})},Vu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Js())},Vu.prototype.isEqual=function(t){return this.batchId===t.batchId&&$r(this.mutations,t.mutations,gs)&&$r(this.baseMutations,t.baseMutations,gs)},Vu),Ou=(Fu.from=function(t,e,n){zr(t.mutations.length===n.length);for(var r=Xs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Fu(t,e,n,r)},Fu),Lu=(Mu.prototype.withSequenceNumber=function(t){return new Mu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Mu.prototype.withResumeToken=function(t,e){return new Mu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Mu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Mu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Mu),Pu=function(t){this.Lt=t};function Mu(t,e,n,r,i,o,s){void 0===i&&(i=ti.min()),void 0===o&&(o=ti.min()),void 0===s&&(s=fi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Fu(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Vu(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Uu(t,e){if(e.document)return Da(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ni.fromSegments(e.noDocument.path),r=Gu(e.noDocument.readTime),n=Gi.newNoDocument(n,r);return e.hasCommittedMutations?n.setHasCommittedMutations():n}if(e.unknownDocument){n=Ni.fromSegments(e.unknownDocument.path),r=Gu(e.unknownDocument.version);return Gi.newUnknownDocument(n,r)}return Hr()}function qu(t,e,n){var r=Bu(n),n=e.key.path.popLast().toArray();if(e.isFoundDocument()){var i={name:Ea(o=t.Lt,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:ga(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new Ja(null,null,i,o,r,n)}if(e.isNoDocument()){var s=e.key.path.toArray(),i=Ku(e.version),o=e.hasCommittedMutations;return new Ja(null,new Xa(s,i),null,o,r,n)}if(e.isUnknownDocument()){o=e.key.path.toArray(),e=Ku(e.version);return new Ja(new $a(o,e),null,null,!0,r,n)}return Hr()}function Bu(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function ju(t){t=new Zr(t[0],t[1]);return ti.fromTimestamp(t)}function Ku(t){t=t.toTimestamp();return new Qa(t.seconds,t.nanoseconds)}function Gu(t){t=new Zr(t.seconds,t.nanoseconds);return ti.fromTimestamp(t)}function Qu(e,t){for(var n=(t.baseMutations||[]).map(function(t){return ka(e.Lt,t)}),r=0;r<t.mutations.length-1;++r){var i,o=t.mutations[r];r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform&&(i=t.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r+1,1),++r)}var s=t.mutations.map(function(t){return ka(e.Lt,t)}),a=Zr.fromMillis(t.localWriteTimeMs);return new xu(t.batchId,a,n,s)}function Hu(t){var e=Gu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Gu(t.lastLimboFreeSnapshotVersion):ti.min(),r=void 0!==t.query.documents?(zr(1===(r=t.query).documents.length),Fo(ko(_a(r.documents[0])))):Fo(Oa(t.query));return new Lu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,fi.fromBase64String(t.resumeToken))}function zu(t,e){var n=Ku(e.snapshotVersion),r=Ku(e.lastLimboFreeSnapshotVersion),i=(Xi(e.target)?Ra:xa)(t.Lt,e.target),t=e.resumeToken.toBase64();return new tu(e.targetId,Wi(e.target),n,t,e.sequenceNumber,r,i)}function Wu(t){var e=Oa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Vo(e,e.limit,"L"):e}var Yu=(Xu.prototype.getBundleMetadata=function(t,e){return $u(t).get(e).next(function(t){if(t)return{id:(t=t).bundleId,createTime:Gu(t.createTime),version:t.version}})},Xu.prototype.saveBundleMetadata=function(t,e){return $u(t).put({bundleId:(e=e).id,createTime:Ku(va(e.createTime)),version:e.version})},Xu.prototype.getNamedQuery=function(t,e){return Ju(t).get(e).next(function(t){if(t)return{name:(t=t).name,query:Wu(t.bundledQuery),readTime:Gu(t.readTime)}})},Xu.prototype.saveNamedQuery=function(t,e){return Ju(t).put({name:(e=e).name,readTime:Ku(va(e.readTime)),bundledQuery:e.bundledQuery})},Xu);function Xu(){}function $u(t){return Ru(t,ou.store)}function Ju(t){return Ru(t,su.store)}var Zu=(ic.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),lu.resolve()},ic.prototype.getCollectionParents=function(t,e){return lu.resolve(this.Bt.getEntries(e))},ic),tc=(rc.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Gs(ui.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},rc.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},rc.prototype.getEntries=function(t){return(this.index[t]||new Gs(ui.comparator)).toArray()},rc),ec=(nc.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.qt.has(e))return lu.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});i={collectionId:r,parent:Ba(i)};return oc(t).put(i)},nc.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Jr(i),""],!1,!0);return oc(t).Nt(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ka(r.parent))}return o})},nc);function nc(){this.qt=new tc}function rc(){this.index={}}function ic(){this.Bt=new tc}function oc(t){return Ru(t,ru.store)}var sc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ac=(uc.withCacheSize=function(t){return new uc(t,uc.DEFAULT_COLLECTION_PERCENTILE,uc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},uc);function uc(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function cc(t,e,n){var r=t.store(za.store),i=t.store(Wa.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.$t({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){zr(1===s)}));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Wa.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return lu.waitFor(o).next(function(){return a})}function hc(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Hr();e=t.noDocument}return JSON.stringify(e).length}ac.DEFAULT_COLLECTION_PERCENTILE=10,ac.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ac.DEFAULT=new ac(41943040,ac.DEFAULT_COLLECTION_PERCENTILE,ac.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ac.DISABLED=new ac(-1,0,0);var lc=(fc.Kt=function(t,e,n,r){return zr(""!==t.uid),new fc(t.isAuthenticated()?t.uid:"",e,n,r)},fc.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pc(t).$t({index:za.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},fc.prototype.addMutationBatch=function(p,y,g,m){var v=this,b=yc(p),w=pc(p);return w.add({}).next(function(t){zr("number"==typeof t);for(var e,n,r,i,o,s=new xu(t,y,g,m),a=(e=v.R,n=v.userId,i=(r=s).baseMutations.map(function(t){return Ca(e.Lt,t)}),o=r.mutations.map(function(t){return Ca(e.Lt,t)}),new za(n,r.batchId,r.localWriteTime.toMillis(),i,o)),u=[],c=new Gs(function(t,e){return Xr(t.canonicalString(),e.canonicalString())}),h=0,l=m;h<l.length;h++){var f=l[h],d=Wa.key(v.userId,f.key.path,t),c=c.add(f.key.path.popLast());u.push(w.put(a)),u.push(b.put(d,Wa.PLACEHOLDER))}return c.forEach(function(t){u.push(v.Ut.addToCollectionParentIndex(p,t))}),p.addOnCommittedListener(function(){v.Qt[t]=s.keys()}),lu.waitFor(u).next(function(){return s})})},fc.prototype.lookupMutationBatch=function(t,e){var n=this;return pc(t).get(e).next(function(t){return t?(zr(t.userId===n.userId),Qu(n.R,t)):null})},fc.prototype.jt=function(t,e){var n=this;return this.Qt[e]?lu.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){t=t.keys();return n.Qt[e]=t}return null})},fc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return pc(t).$t({index:za.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(zr(e.batchId>=i),o=Qu(r.R,e)),n.done()}).next(function(){return o})},fc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return pc(t).$t({index:za.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},fc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return pc(t).Nt(za.userMutationsIndex,n).next(function(t){return t.map(function(t){return Qu(e.R,t)})})},fc.prototype.getAllMutationBatchesAffectingDocumentKey=function(o,s){var a=this,t=Wa.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),u=[];return yc(o).$t({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ka(i);if(r===a.userId&&s.path.isEqual(i))return pc(o).get(t).next(function(t){if(!t)throw Hr();zr(t.userId===a.userId),u.push(Qu(a.R,t))});n.done()}).next(function(){return u})},fc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var s=this,a=new Gs(Xr),n=[];return t.forEach(function(o){var t=Wa.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=yc(e).$t({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ka(i);r===s.userId&&o.path.isEqual(i)?a=a.add(t):n.done()});n.push(t)}),lu.waitFor(n).next(function(){return s.Wt(e,a)})},fc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var o=this,s=e.path,a=s.length+1,e=Wa.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),u=new Gs(Xr);return yc(t).$t({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ka(i);r===o.userId&&s.isPrefixOf(i)?i.length===a&&(u=u.add(t)):n.done()}).next(function(){return o.Wt(t,u)})},fc.prototype.Wt=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(pc(e).get(t).next(function(t){if(null===t)throw Hr();zr(t.userId===n.userId),r.push(Qu(n.R,t))}))}),lu.waitFor(i).next(function(){return r})},fc.prototype.removeMutationBatch=function(e,n){var r=this;return cc(e.Mt,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.Gt(n.batchId)}),lu.forEach(t,function(t){return r.referenceDelegate.markPotentiallyOrphaned(e,t)})})},fc.prototype.Gt=function(t){delete this.Qt[t]},fc.prototype.performConsistencyCheck=function(e){var i=this;return this.checkEmpty(e).next(function(t){if(!t)return lu.resolve();var t=IDBKeyRange.lowerBound(Wa.prefixForUser(i.userId)),r=[];return yc(e).$t({range:t},function(t,e,n){t[0]===i.userId?(t=Ka(t[1]),r.push(t)):n.done()}).next(function(){zr(0===r.length)})})},fc.prototype.containsKey=function(t,e){return dc(t,this.userId,e)},fc.prototype.zt=function(t){var e=this;return gc(t).get(this.userId).next(function(t){return t||new Ha(e.userId,-1,"")})},fc);function fc(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}function dc(t,o,e){var e=Wa.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),a=!1;return yc(t).$t({range:e,kt:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function pc(t){return Ru(t,za.store)}function yc(t){return Ru(t,Wa.store)}function gc(t){return Ru(t,Ha.store)}var mc=(wc.prototype.next=function(){return this.Ht+=2,this.Ht},wc.Jt=function(){return new wc(0)},wc.Yt=function(){return new wc(-1)},wc),vc=(bc.prototype.allocateTargetId=function(n){var r=this;return this.Xt(n).next(function(t){var e=new mc(t.highestTargetId);return t.highestTargetId=e.next(),r.Zt(n,t).next(function(){return t.highestTargetId})})},bc.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return ti.fromTimestamp(new Zr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},bc.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},bc.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.Xt(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Zt(e,t)})},bc.prototype.addTargetData=function(e,n){var r=this;return this.te(e,n).next(function(){return r.Xt(e).next(function(t){return t.targetCount+=1,r.ee(n,t),r.Zt(e,t)})})},bc.prototype.updateTargetData=function(t,e){return this.te(t,e)},bc.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Ec(e).delete(t.targetId)}).next(function(){return n.Xt(e)}).next(function(t){return zr(0<t.targetCount),--t.targetCount,n.Zt(e,t)})},bc.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return Ec(n).$t(function(t,e){e=Hu(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,a.push(o.removeTargetData(n,e)))}).next(function(){return lu.waitFor(a)}).next(function(){return s})},bc.prototype.forEachTarget=function(t,n){return Ec(t).$t(function(t,e){e=Hu(e);n(e)})},bc.prototype.Xt=function(t){return Tc(t).get(nu.key).next(function(t){return zr(null!==t),t})},bc.prototype.Zt=function(t,e){return Tc(t).put(nu.key,e)},bc.prototype.te=function(t,e){return Ec(t).put(zu(this.R,e))},bc.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},bc.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},bc.prototype.getTargetData=function(t,r){var e=Wi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return Ec(t).$t({range:e,index:tu.queryTargetsIndexName},function(t,e,n){e=Hu(e);Yi(r,e.target)&&(i=e,n.done())}).next(function(){return i})},bc.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],s=Ic(n);return t.forEach(function(t){var e=Ba(t.path);o.push(s.put(new eu(r,e))),o.push(i.referenceDelegate.addReference(n,r,t))}),lu.waitFor(o)},bc.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=Ic(n);return lu.forEach(t,function(t){var e=Ba(t.path);return lu.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,r,t)])})},bc.prototype.removeMatchingKeysForTargetId=function(t,e){t=Ic(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},bc.prototype.getMatchingKeysForTargetId=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Ic(t),r=Js();return t.$t({range:e,kt:!0},function(t,e,n){t=Ka(t[1]),t=new Ni(t);r=r.add(t)}).next(function(){return r})},bc.prototype.containsKey=function(t,e){var e=Ba(e.path),e=IDBKeyRange.bound([e],[Jr(e)],!1,!0),i=0;return Ic(t).$t({index:eu.documentTargetsIndex,kt:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},bc.prototype.lt=function(t,e){return Ec(t).get(e).next(function(t){return t?Hu(t):null})},bc);function bc(t,e){this.referenceDelegate=t,this.R=e}function wc(t){this.Ht=t}function Ec(t){return Ru(t,tu.store)}function Tc(t){return Ru(t,nu.store)}function Ic(t){return Ru(t,eu.store)}function _c(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Fr.FAILED_PRECONDITION||e.message!==cu)throw e;return jr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Sc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Xr(n,t);return 0===t?Xr(r,e):t}var Ac=(Oc.prototype.ie=function(){return++this.se},Oc.prototype.re=function(t){var e=[t,this.ie()];this.buffer.size<this.ne?this.buffer=this.buffer.add(e):Sc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Oc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Oc),Nc=(xc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},xc.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(xc.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),xc.prototype.ue=function(n){var t=this,e=this.oe?3e5:6e4;jr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:this.ce=null,this.oe=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.collectGarbage(this.garbageCollector)];case 2:return t.sent(),[3,7];case 3:return Tu(e=t.sent())?(jr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,_c(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.ue(n)];case 8:return t.sent(),[2]}})})})},xc),Dc=(Rc.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},Rc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return lu.resolve(Lr.o);var r=new Ac(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},Rc.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},Rc.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},Rc.prototype.collect=function(e,n){var r=this;return-1===this.params.cacheSizeCollectionThreshold?(jr("LruGarbageCollector","Garbage collection skipped; disabled"),lu.resolve(sc)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(jr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),sc):r.fe(e,n)})},Rc.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},Rc.prototype.fe=function(e,n){var r,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(jr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,s=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,a=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Br()<=p.DEBUG&&jr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),lu.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},Rc),Cc=(kc.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},kc.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},kc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},kc.prototype.le=function(t,n){return this.we(t,function(t,e){return n(e)})},kc.prototype.addReference=function(t,e,n){return Lc(t,n)},kc.prototype.removeReference=function(t,e,n){return Lc(t,n)},kc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},kc.prototype.markPotentiallyOrphaned=Lc,kc.prototype._e=function(t,e){return r=e,i=!1,gc(n=t).Ot(function(t){return dc(n,t,r).next(function(t){return t&&(i=!0),lu.resolve(!t)})}).next(function(){return i});var n,r,i},kc.prototype.removeOrphanedDocuments=function(n,r){var i=this,o=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.we(n,function(e,t){t<=r&&(t=i._e(n,e).next(function(t){if(!t)return a++,o.getEntry(n,e).next(function(){return o.removeEntry(e),Ic(n).delete([0,Ba(e.path)])})}),s.push(t))}).next(function(){return lu.waitFor(s)}).next(function(){return o.apply(n)}).next(function(){return a})},kc.prototype.removeTarget=function(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)},kc.prototype.updateLimboDocument=Lc,kc.prototype.we=function(t,r){var i,t=Ic(t),o=Lr.o;return t.$t({index:eu.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Lr.o&&r(new Ni(Ka(i)),o),o=e,i=t):o=Lr.o}).next(function(){o!==Lr.o&&r(new Ni(Ka(i)),o)})},kc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},kc);function kc(t,e){this.db=t,this.garbageCollector=new Dc(this,e)}function Rc(t,e){this.ae=t,this.params=e}function xc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}function Oc(t){this.ne=t,this.buffer=new Gs(Sc),this.se=0}function Lc(t,e){return Ic(t).put((t=t.currentSequenceNumber,new eu(0,Ba(e.path),t)))}var Pc,Mc=(jc.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},jc.prototype.has=function(t){return void 0!==this.get(t)},jc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},jc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},jc.prototype.forEach=function(s){ii(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},jc.prototype.isEmpty=function(){return oi(this.inner)},jc),I=(Bc.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:ti.min()},Bc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},Bc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Gi.newInvalidDocument(t),readTime:e})},Bc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?lu.resolve(n.document):this.getFromCache(t,e)},Bc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Bc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Bc.prototype.assertNotApplied=function(){},Bc),Fc=(qc.prototype.addEntry=function(t,e,n){return Gc(t).put(Qc(e),n)},qc.prototype.removeEntry=function(t,e){t=Gc(t),e=Qc(e);return t.delete(e)},qc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.me(e,t)})},qc.prototype.getEntry=function(t,e){var n=this;return Gc(t).get(Qc(e)).next(function(t){return n.ye(e,t)})},qc.prototype.ge=function(t,e){var n=this;return Gc(t).get(Qc(e)).next(function(t){return{document:n.ye(e,t),size:hc(t)}})},qc.prototype.getEntries=function(t,e){var n=this,r=Hs;return this.pe(t,e,function(t,e){e=n.ye(t,e);r=r.insert(t,e)}).next(function(){return r})},qc.prototype.Ee=function(t,e){var r=this,i=Hs,o=new Fs(Ni.comparator);return this.pe(t,e,function(t,e){var n=r.ye(t,e);i=i.insert(t,n),o=o.insert(t,hc(e))}).next(function(){return{documents:i,Te:o}})},qc.prototype.pe=function(t,e,i){if(e.isEmpty())return lu.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),s=o.getNext();return Gc(t).$t({range:n},function(t,e,n){for(var r=Ni.fromSegments(t);s&&Ni.comparator(s,r)<0;)i(s,null),s=o.getNext();s&&s.isEqual(r)&&(i(s,e),s=o.hasNext()?o.getNext():null),s?n.Ct(s.path.toArray()):n.done()}).next(function(){for(;s;)i(s,null),s=o.hasNext()?o.getNext():null})},qc.prototype.getDocumentsMatchingQuery=function(t,r,e){var n,i=this,o=Hs,s=r.path.length+1,a={};return e.isEqual(ti.min())?(n=r.path.toArray(),a.range=IDBKeyRange.lowerBound(n)):(n=r.path.toArray(),e=Bu(e),a.range=IDBKeyRange.lowerBound([n,e],!0),a.index=Ja.collectionReadTimeIndex),Gc(t).$t(a,function(t,e,n){t.length===s&&(e=Uu(i.R,e),r.path.isPrefixOf(e.key.path)?jo(r,e)&&(o=o.insert(e.key,e)):n.done())}).next(function(){return o})},qc.prototype.newChangeBuffer=function(t){return new Vc(this,!!t&&t.trackRemovals)},qc.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},qc.prototype.getMetadata=function(t){return Kc(t).get(Za.key).next(function(t){return zr(!!t),t})},qc.prototype.me=function(t,e){return Kc(t).put(Za.key,e)},qc.prototype.ye=function(t,e){if(e){e=Uu(this.R,e);if(!e.isNoDocument()||!e.version.isEqual(ti.min()))return e}return Gi.newInvalidDocument(t)},qc),Vc=(n(Uc,Pc=I),Uc.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new Gs(function(t,e){return Xr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n,r=o.Ae.get(t);e.document.isValidDocument()?(n=qu(o.Ie.R,e.document,o.getReadTime(t)),u=u.add(t.path.popLast()),e=hc(n),a+=e-r,s.push(o.Ie.addEntry(i,t,n))):(a-=r,o.trackRemovals?(r=qu(o.Ie.R,Gi.newNoDocument(t,ti.min()),o.getReadTime(t)),s.push(o.Ie.addEntry(i,t,r))):s.push(o.Ie.removeEntry(i,t)))}),u.forEach(function(t){s.push(o.Ie.Ut.addToCollectionParentIndex(i,t))}),s.push(this.Ie.updateMetadata(i,a)),lu.waitFor(s)},Uc.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},Uc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},Uc);function Uc(t,e){var n=this;return(n=Pc.call(this)||this).Ie=t,n.trackRemovals=e,n.Ae=new Mc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function qc(t,e){this.R=t,this.Ut=e}function Bc(){this.changes=new Mc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function jc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function Kc(t){return Ru(t,Za.store)}function Gc(t){return Ru(t,Ja.store)}function Qc(t){return t.path.toArray()}var Hc=(zc.prototype.Rt=function(e,n,t,r){var i=this;zr(t<r&&0<=t&&r<=11);var o=new fu("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Ga.store),(s=e).createObjectStore(Ha.store,{keyPath:Ha.keyPath}),s.createObjectStore(za.store,{keyPath:za.keyPath,autoIncrement:!0}).createIndex(za.userMutationsIndex,za.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Wa.store),Wc(e),e.createObjectStore(Ja.store));var s,a=lu.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(eu.store),s.deleteObjectStore(tu.store),s.deleteObjectStore(nu.store),Wc(e)),a=a.next(function(){return t=o.store(nu.store),e=new nu(0,0,ti.min().toTimestamp(),0),t.put(nu.key,e);var t,e})),t<4&&4<=r&&(a=(a=0!==t?a.next(function(){return n=e,(r=o).store(za.store).Nt().next(function(t){n.deleteObjectStore(za.store),n.createObjectStore(za.store,{keyPath:za.keyPath,autoIncrement:!0}).createIndex(za.userMutationsIndex,za.userMutationsKeyPath,{unique:!0});var e=r.store(za.store),t=t.map(function(t){return e.put(t)});return lu.waitFor(t)});var n,r}):a).next(function(){e.createObjectStore(iu.store,{keyPath:iu.keyPath})})),t<5&&5<=r&&(a=a.next(function(){return i.Re(o)})),t<6&&6<=r&&(a=a.next(function(){return e.createObjectStore(Za.store),i.be(o)})),t<7&&7<=r&&(a=a.next(function(){return i.ve(o)})),t<8&&8<=r&&(a=a.next(function(){return i.Pe(e,o)})),t<9&&9<=r&&(a=a.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Ja.store)).createIndex(Ja.readTimeIndex,Ja.readTimeIndexPath,{unique:!1}),t.createIndex(Ja.collectionReadTimeIndex,Ja.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(a=a.next(function(){return i.Ve(o)})),a=t<11&&11<=r?a.next(function(){e.createObjectStore(ou.store,{keyPath:ou.keyPath}),e.createObjectStore(su.store,{keyPath:su.keyPath})}):a},zc.prototype.be=function(e){var n=0;return e.store(Ja.store).$t(function(t,e){n+=hc(e)}).next(function(){var t=new Za(n);return e.store(Za.store).put(Za.key,t)})},zc.prototype.Re=function(n){var r=this,t=n.store(Ha.store),i=n.store(za.store);return t.Nt().next(function(t){return lu.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.Nt(za.userMutationsIndex,t).next(function(t){return lu.forEach(t,function(t){zr(t.userId===e.userId);t=Qu(r.R,t);return cc(n,e.userId,t).next(function(){})})})})})},zc.prototype.ve=function(t){var o=t.store(eu.store),e=t.store(Ja.store);return t.store(nu.store).get(nu.key).next(function(r){var i=[];return e.$t(function(t,e){var n=new ui(t),t=[0,Ba(n)];i.push(o.get(t).next(function(t){return t?lu.resolve():o.put(new eu(0,Ba(n),r.highestListenSequenceNumber))}))}).next(function(){return lu.waitFor(i)})})},zc.prototype.Pe=function(t,e){t.createObjectStore(ru.store,{keyPath:ru.keyPath});function r(t){if(i.add(t)){var e=t.lastSegment(),t=t.popLast();return n.put({collectionId:e,parent:Ba(t)})}}var n=e.store(ru.store),i=new tc;return e.store(Ja.store).$t({kt:!0},function(t,e){t=new ui(t);return r(t.popLast())}).next(function(){return e.store(Wa.store).$t({kt:!0},function(t,e){t[0];var n=t[1],n=(t[2],Ka(n));return r(n.popLast())})})},zc.prototype.Ve=function(t){var n=this,r=t.store(tu.store);return r.$t(function(t,e){e=Hu(e),e=zu(n.R,e);return r.put(e)})},zc);function zc(t){this.R=t}function Wc(t){t.createObjectStore(eu.store,{keyPath:eu.keyPath}).createIndex(eu.documentTargetsIndex,eu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(tu.store,{keyPath:tu.keyPath}).createIndex(tu.queryTargetsIndexName,tu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(nu.store)}var Yc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Xc=($c.prototype.start=function(){var e=this;return this.je().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Vr(Fr.FAILED_PRECONDITION,Yc);return e.We(),e.Ge(),e.ze(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.qe.getHighestSequenceNumber(t)})}).then(function(t){e.Ne=new Lr(t,e.De)}).then(function(){e.xe=!0}).catch(function(t){return e.Be&&e.Be.close(),Promise.reject(t)})},$c.prototype.He=function(n){var t=this;return this.Me=function(e){return y(t,void 0,void 0,function(){return g(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},$c.prototype.setDatabaseDeletedListener=function(n){var t=this;this.Be.vt(function(e){return y(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},$c.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},$c.prototype.je=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Zc(e).put(new iu(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Je(e).next(function(t){t||(n.isPrimary=!1,n.Se.enqueueRetryable(function(){return n.Me(!1)}))})}).next(function(){return n.Ye(e)}).next(function(t){return n.isPrimary&&!t?n.Xe(e).next(function(){return!1}):!!t&&n.Ze(e).next(function(){return!0})})}).catch(function(t){if(Tu(t))return jr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return jr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Se.enqueueRetryable(function(){return n.Me(t)}),n.isPrimary=t})},$c.prototype.Je=function(t){var e=this;return Jc(t).get(Ga.key).next(function(t){return lu.resolve(e.tn(t))})},$c.prototype.en=function(t){return Zc(t).delete(this.clientId)},$c.prototype.nn=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return g(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Ru(t,iu.store);return r.Nt().next(function(t){var e=o.rn(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return lu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Ke)for(n=0,r=e;n<r.length;n++)i=r[n],this.Ke.removeItem(this.on(i.clientId));t.label=2;case 2:return[2]}})})},$c.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},$c.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},$c.prototype.Ye=function(e){var r=this;return this.Ce?lu.resolve(!0):Jc(e).get(Ga.key).next(function(t){if(null!==t&&r.sn(t.leaseTimestampMs,5e3)&&!r.cn(t.ownerId)){if(r.tn(t)&&r.networkEnabled)return!0;if(!r.tn(t)){if(!t.allowTabSynchronization)throw new Vr(Fr.FAILED_PRECONDITION,Yc);return!1}}return!(!r.networkEnabled||!r.inForeground)||Zc(e).Nt().next(function(t){return void 0===r.rn(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&jr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},$c.prototype.shutdown=function(){return y(this,void 0,void 0,function(){var n=this;return g(this,function(t){switch(t.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ga.store,iu.store],function(t){var e=new Cu(t,Lr.o);return n.Xe(e).next(function(){return n.en(e)})})];case 1:return t.sent(),this.Be.close(),this.ln(),[2]}})})},$c.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},$c.prototype.fn=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Zc(t).Nt().next(function(t){return e.rn(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty($c.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),$c.prototype.getMutationQueue=function(t){return lc.Kt(t,this.R,this.Ut,this.referenceDelegate)},$c.prototype.getTargetCache=function(){return this.qe},$c.prototype.getRemoteDocumentCache=function(){return this.Ue},$c.prototype.getIndexManager=function(){return this.Ut},$c.prototype.getBundleCache=function(){return this.Qe},$c.prototype.runTransaction=function(e,n,r){var i,o=this;return jr("IndexedDbPersistence","Starting transaction:",e),this.Be.runTransaction(e,"readonly"===n?"readonly":"readwrite",uu,function(t){return i=new Cu(t,o.Ne?o.Ne.next():Lr.o),"readwrite-primary"===n?o.Je(i).next(function(t){return!!t||o.Ye(i)}).next(function(t){if(!t)throw Kr("Failed to obtain primary lease for action '"+e+"'."),o.isPrimary=!1,o.Se.enqueueRetryable(function(){return o.Me(!1)}),new Vr(Fr.FAILED_PRECONDITION,cu);return r(i)}).next(function(t){return o.Ze(i).next(function(){return t})}):o.dn(i).next(function(){return r(i)})}).then(function(t){return i.raiseOnCommittedEvent(),t})},$c.prototype.dn=function(t){var e=this;return Jc(t).get(Ga.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Vr(Fr.FAILED_PRECONDITION,Yc)})},$c.prototype.Ze=function(t){var e=new Ga(this.clientId,this.allowTabSynchronization,Date.now());return Jc(t).put(Ga.key,e)},$c.yt=function(){return du.yt()},$c.prototype.Xe=function(t){var e=this,n=Jc(t);return n.get(Ga.key).next(function(t){return e.tn(t)?(jr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ga.key)):lu.resolve()})},$c.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Kr("Detected an update time that is in the future: "+t+" > "+n),1))},$c.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},$c.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},$c.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},$c.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},$c.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return jr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Kr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},$c.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Kr("Failed to set zombie client id.",t)}},$c.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},$c.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},$c);function $c(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=i,this.window=o,this.document=s,this.De=u,this.Ce=c,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!$c.yt())throw new Vr(Fr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cc(this,r),this.Le=e+"main",this.R=new Pu(a),this.Be=new du(this.Le,11,new Hc(this.R)),this.qe=new vc(this.referenceDelegate,this.R),this.Ut=new ec,this.Ue=(e=this.R,a=this.Ut,new Fc(e,a)),this.Qe=new Yu,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===c&&Kr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Jc(t){return Ru(t,Ga.store)}function Zc(t){return Ru(t,iu.store)}function th(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function eh(t,e){this.progress=t,this.wn=e}var nh=(ch.prototype.mn=function(e,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.yn(e,n,t)})},ch.prototype.yn=function(t,e,r){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,n=r;e<n.length;e++)n[e].applyToLocalView(t);return t})},ch.prototype.gn=function(t,i){t.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)})},ch.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},ch.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},ch.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Ni.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Po(e)?this.In(t,e,n):this.An(t,e,n);var r},ch.prototype.Tn=function(t,e){return this.mn(t,new Ni(e)).next(function(t){var e=Ys;return e=t.isFoundDocument()?e.insert(t.key,t):e})},ch.prototype.In=function(n,r,i){var o=this,s=r.collectionGroup,a=Ys;return this.Ut.getCollectionParents(n,s).next(function(t){return lu.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Do(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.An(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},ch.prototype.An=function(e,n,t){var c,h,r=this;return this.Ue.getDocumentsMatchingQuery(e,n,t).next(function(t){return c=t,r._n.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return h=t,r.Rn(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a);null==u&&(u=Gi.newInvalidDocument(a),c=c.insert(a,u)),ys(s,u,r.localWriteTime),u.isFoundDocument()||(c=c.remove(a))}})}).next(function(){return c.forEach(function(t,e){jo(n,e)||(c=c.remove(t))}),c})},ch.prototype.Rn=function(t,e,n){for(var r=Js(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Es&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},ch),rh=(uh.Pn=function(t,e){for(var n=Js(),r=Js(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new uh(t,e.fromCache,n,r)},uh),ih=(ah.prototype.Vn=function(t){this.Sn=t},ah.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(ti.min())?this.Dn(e,r):this.Sn.pn(e,o).next(function(t){var n=s.Cn(r,t);return(Ro(r)||xo(r))&&s.Nn(r.limitType,n,o,i)?s.Dn(e,r):(Br()<=p.DEBUG&&jr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Bo(r)),s.Sn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},ah.prototype.Cn=function(n,t){var r=new Gs(Ko(n));return t.forEach(function(t,e){jo(n,e)&&(r=r.add(e))}),r},ah.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},ah.prototype.Dn=function(t,e){return Br()<=p.DEBUG&&jr("QueryEngine","Using full collection scan to execute query:",Bo(e)),this.Sn.getDocumentsMatchingQuery(t,e,ti.min())},ah),oh=(sh.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Fn)})},sh);function sh(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Fs(Xr),this.kn=new Mc(Wi,Yi),this.$n=ti.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new nh(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}function ah(){}function uh(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function ch(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function hh(t,e,n,r){return new oh(t,e,n,r)}function lh(i,o){return y(this,void 0,void 0,function(){var e,n,v,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i)._n,v=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var m;return e._n.getAllMutationBatches(g).next(function(t){return m=t,n=e.persistence.getMutationQueue(o),v=new nh(e.On,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Js(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var d=0,p=f.mutations;d<p.length;d++){var y=p[d];r=r.add(y.key)}}return v.pn(g,r).next(function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e._n=n,e.Mn=v,e.xn.Vn(e.Mn),r)]}})})}function fh(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.On.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=lu.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=i.docVersions.get(n);zr(null!==e),t.version.compareTo(e)<0&&(s.applyToRemoteDocument(t,i),t.isValidDocument()&&o.addEntry(t,i.commitVersion))})}),a.next(function(){return e._n.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l._n.performConsistencyCheck(t)}).next(function(){return l.Mn.pn(t,u)})})}function dh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function ph(t,r){var u=t,c=r.snapshotVersion,h=u.Fn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.On.newChangeBuffer({trackRemovals:!0});h=u.Fn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,zr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,n))))});var e,n=Hs;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(yh(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(ti.min())||(e=u.qe.getLastRemoteSnapshotVersion(s).next(function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),lu.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Mn.En(s,n)}).next(function(){return n})}).then(function(t){return u.Fn=h,t})}function yh(t,s,e,a,u){var n=Js();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Hs;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e.isNoDocument()&&e.version.isEqual(ti.min())?(s.removeEntry(t,r),o=o.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):jr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function gh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qe.getTargetData(e,r).next(function(t){return t?(n=t,lu.resolve(n)):i.qe.allocateTargetId(e).next(function(t){return n=new Lu(r,t,0,e.currentSequenceNumber),i.qe.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Fn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Fn=i.Fn.insert(t.targetId,t),i.kn.set(r,t.targetId)),t})}function mh(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Fn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Tu(r=t.sent()))throw r;return jr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Fn=e.Fn.remove(o),e.kn.delete(n.target),[2]}})})}function vh(t,o,s){var a=t,u=ti.min(),c=Js();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Fo(o),(void 0!==(t=(i=t).kn.get(r))?lu.resolve(i.Fn.get(t)):i.qe.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.xn.getDocumentsMatchingQuery(e,o,s?u:ti.min(),s?c:Js())}).next(function(t){return{documents:t,Bn:c}});var t,n,r,i})}function bh(t,e){var n=t,r=n.qe,t=n.Fn.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function wh(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.On,n=t,t=s.$n,r=e,i=Hs,o=Bu(t),t=Gc(n),n=IDBKeyRange.lowerBound(o,!0),t.$t({index:Ja.readTimeIndex,range:n},function(t,e){var n=Uu(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:ju(o)}});var e,n,r,i,o}).then(function(t){var e=t.wn,t=t.readTime;return s.$n=t,e})}function Eh(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Gc(t),r=ti.min(),t.$t({index:Ja.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=ju(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.$n=t})]})})}var Th,Ih,_h=(Qh.prototype.getBundleMetadata=function(t,e){return lu.resolve(this.Kn.get(e))},Qh.prototype.saveBundleMetadata=function(t,e){return this.Kn.set(e.id,{id:e.id,version:e.version,createTime:va(e.createTime)}),lu.resolve()},Qh.prototype.getNamedQuery=function(t,e){return lu.resolve(this.jn.get(e))},Qh.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:Wu(e.bundledQuery),readTime:va(e.readTime)}),lu.resolve()},Qh),Sh=(Gh.prototype.isEmpty=function(){return this.Wn.isEmpty()},Gh.prototype.addReference=function(t,e){e=new Ah(t,e);this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},Gh.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},Gh.prototype.removeReference=function(t,e){this.Yn(new Ah(t,e))},Gh.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},Gh.prototype.Zn=function(t){var e=this,n=new Ni(new ui([])),r=new Ah(n,t),t=new Ah(n,t+1),i=[];return this.zn.forEachInRange([r,t],function(t){e.Yn(t),i.push(t.key)}),i},Gh.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},Gh.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},Gh.prototype.es=function(t){var e=new Ni(new ui([])),n=new Ah(e,t),t=new Ah(e,t+1),r=Js();return this.zn.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},Gh.prototype.containsKey=function(t){var e=new Ah(t,0),e=this.Wn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},Gh),Ah=(Kh.Gn=function(t,e){return Ni.comparator(t.key,e.key)||Xr(t.ns,e.ns)},Kh.Hn=function(t,e){return Xr(t.ns,e.ns)||Ni.comparator(t.key,e.key)},Kh),Nh=(jh.prototype.checkEmpty=function(t){return lu.resolve(0===this._n.length)},jh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new xu(i,e,n,r);this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new Ah(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return lu.resolve(n)},jh.prototype.lookupMutationBatch=function(t,e){return lu.resolve(this.os(e))},jh.prototype.getNextMutationBatchAfterBatchId=function(t,e){e=this.cs(e+1),e=e<0?0:e;return lu.resolve(this._n.length>e?this._n[e]:null)},jh.prototype.getHighestUnacknowledgedBatchId=function(){return lu.resolve(0===this._n.length?-1:this.ss-1)},jh.prototype.getAllMutationBatches=function(t){return lu.resolve(this._n.slice())},jh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ah(e,0),e=new Ah(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([r,e],function(t){t=n.os(t.ns);i.push(t)}),lu.resolve(i)},jh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Gs(Xr);return e.forEach(function(t){var e=new Ah(t,0),t=new Ah(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,t],function(t){r=r.add(t.ns)})}),lu.resolve(this.us(r))},jh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;Ni.isDocumentKey(e)||(e=e.child(""));var e=new Ah(new Ni(e),0),i=new Gs(Xr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),lu.resolve(this.us(i))},jh.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){t=e.os(t);null!==t&&n.push(t)}),n},jh.prototype.removeMutationBatch=function(n,r){var i=this;zr(0===this.hs(r.batchId,"removed")),this._n.shift();var o=this.rs;return lu.forEach(r.mutations,function(t){var e=new Ah(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.rs=o})},jh.prototype.Gt=function(t){},jh.prototype.containsKey=function(t,e){var n=new Ah(e,0),n=this.rs.firstAfterOrEqual(n);return lu.resolve(e.isEqual(n&&n.key))},jh.prototype.performConsistencyCheck=function(t){return this._n.length,lu.resolve()},jh.prototype.hs=function(t,e){return this.cs(t)},jh.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},jh.prototype.os=function(t){t=this.cs(t);return t<0||t>=this._n.length?null:this._n[t]},jh),Dh=(Bh.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:i,readTime:n}),this.size+=i-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Bh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Bh.prototype.getEntry=function(t,e){var n=this.docs.get(e);return lu.resolve(n?n.document.clone():Gi.newInvalidDocument(e))},Bh.prototype.getEntries=function(t,e){var n=this,r=Hs;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Gi.newInvalidDocument(t))}),lu.resolve(r)},Bh.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Hs,i=new Ni(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.document,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||jo(e,s)&&(r=r.insert(s.key,s.clone()))}return lu.resolve(r)},Bh.prototype.fs=function(t,e){return lu.forEach(this.docs,function(t){return e(t)})},Bh.prototype.newChangeBuffer=function(t){return new Ch(this)},Bh.prototype.getSize=function(t){return lu.resolve(this.size)},Bh),Ch=(n(qh,Ih=I),qh.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e.document.isValidDocument()?i.push(r.Ie.addEntry(n,e.document,r.getReadTime(t))):r.Ie.removeEntry(t)}),lu.waitFor(i)},qh.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},qh.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},qh),kh=(Uh.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(t,e){return n(e)}),lu.resolve()},Uh.prototype.getLastRemoteSnapshotVersion=function(t){return lu.resolve(this.lastRemoteSnapshotVersion)},Uh.prototype.getHighestSequenceNumber=function(t){return lu.resolve(this.ws)},Uh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),lu.resolve(this.highestTargetId)},Uh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),lu.resolve()},Uh.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new mc(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},Uh.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,lu.resolve()},Uh.prototype.updateTargetData=function(t,e){return this.te(e),lu.resolve()},Uh.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,lu.resolve()},Uh.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.ds.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.ds.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),lu.waitFor(a).next(function(){return s})},Uh.prototype.getTargetCount=function(t){return lu.resolve(this.targetCount)},Uh.prototype.getTargetData=function(t,e){e=this.ds.get(e)||null;return lu.resolve(e)},Uh.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),lu.resolve()},Uh.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),lu.waitFor(i)},Uh.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),lu.resolve()},Uh.prototype.getMatchingKeysForTargetId=function(t,e){e=this._s.es(e);return lu.resolve(e)},Uh.prototype.containsKey=function(t,e){return lu.resolve(this._s.containsKey(e))},Uh),Rh=(Vh.prototype.start=function(){return Promise.resolve()},Vh.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Vh.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Vh.prototype.setDatabaseDeletedListener=function(){},Vh.prototype.setNetworkEnabled=function(){},Vh.prototype.getIndexManager=function(){return this.Ut},Vh.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Nh(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Vh.prototype.getTargetCache=function(){return this.qe},Vh.prototype.getRemoteDocumentCache=function(){return this.Ue},Vh.prototype.getBundleCache=function(){return this.Qe},Vh.prototype.runTransaction=function(t,e,n){var r=this;jr("MemoryPersistence","Starting transaction:",t);var i=new xh(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Vh.prototype.Is=function(e,n){return lu.or(Object.values(this.gs).map(function(t){return function(){return t.containsKey(e,n)}}))},Vh),xh=(n(Fh,Th=Se),Fh),Oh=(Mh.bs=function(t){return new Mh(t)},Object.defineProperty(Mh.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Hr()},enumerable:!1,configurable:!0}),Mh.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),lu.resolve()},Mh.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),lu.resolve()},Mh.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),lu.resolve()},Mh.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Mh.prototype.Es=function(){this.Rs=new Set},Mh.prototype.Ts=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return lu.forEach(this.vs,function(t){var e=Ni.fromPath(t);return r.Ps(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Rs=null,i.apply(n)})},Mh.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},Mh.prototype.ps=function(t){return 0},Mh.prototype.Ps=function(t,e){var n=this;return lu.or([function(){return lu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Mh),Lh=(Ph.prototype.isAuthenticated=function(){return null!=this.uid},Ph.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Ph.prototype.isEqual=function(t){return t.uid===this.uid},Ph);function Ph(t){this.uid=t}function Mh(t){this.persistence=t,this.As=new Sh,this.Rs=null}function Fh(t){var e=this;return(e=Th.call(this)||this).currentSequenceNumber=t,e}function Vh(t,e){var n=this;this.gs={},this.Ne=new Lr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new kh(this),this.Ut=new Zu,this.Ue=(t=this.Ut,new Dh(t,function(t){return n.referenceDelegate.ps(t)})),this.R=new Pu(e),this.Qe=new _h(this.R)}function Uh(t){this.persistence=t,this.ds=new Mc(Wi,Yi),this.lastRemoteSnapshotVersion=ti.min(),this.highestTargetId=0,this.ws=0,this._s=new Sh,this.targetCount=0,this.ys=mc.Jt()}function qh(t){var e=this;return(e=Ih.call(this)||this).Ie=t,e}function Bh(t,e){this.Ut=t,this.ls=e,this.docs=new Fs(Ni.comparator),this.size=0}function jh(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Gs(Ah.Gn)}function Kh(t,e){this.key=t,this.ns=e}function Gh(){this.Wn=new Gs(Ah.Gn),this.zn=new Gs(Ah.Hn)}function Qh(t){this.R=t,this.Kn=new Map,this.jn=new Map}function Hh(t,e){return"firestore_clients_"+t+"_"+e}function zh(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(n+="_"+e.uid),n}function Wh(t,e){return"firestore_targets_"+t+"_"+e}Lh.UNAUTHENTICATED=new Lh(null),Lh.GOOGLE_CREDENTIALS=new Lh("google-credentials-uid"),Lh.FIRST_PARTY=new Lh("first-party-uid");var Yh,Xh=(bl.Vs=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Vr(i.error.code,i.error.message)),o?new bl(t,e,i.state,r):(Kr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},bl.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bl),$h=(vl.Vs=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Vr(r.error.code,r.error.message)),i?new vl(t,r.state,n):(Kr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},vl.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},vl),Jh=(ml.Vs=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Zs,o=0;r&&o<n.activeTargetIds.length;++o)r=Ai(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new ml(t,i):(Kr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},ml),Zh=(gl.Vs=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gl(e.clientId,e.onlineState):(Kr("SharedClientState","Failed to parse online state: "+t),null)},gl),tl=(yl.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},yl.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},yl.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},yl),el=(pl.yt=function(t){return!(!t||!t.localStorage)},pl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l=this;return g(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.fn()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Hh(this.persistenceKey,r)))&&(o=Jh.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)h=c[u],this.Fs(h);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},pl.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},pl.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},pl.prototype.isActiveQueryTarget=function(n){var r=!1;return this.ks.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},pl.prototype.addPendingMutation=function(t){this.zs(t,"pending")},pl.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},pl.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Wh(this.persistenceKey,t)))||(e=$h.Vs(t,e))&&(n=e.state)),this.Js.Ds(t),this.Ks(),n},pl.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},pl.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},pl.prototype.clearQueryState=function(t){this.removeItem(Wh(this.persistenceKey,t))},pl.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},pl.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},pl.prototype.setOnlineState=function(t){this.Xs(t)},pl.prototype.notifyBundleLoaded=function(){this.Zs()},pl.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},pl.prototype.getItem=function(t){var e=this.storage.getItem(t);return jr("SharedClientState","READ",t,e),e},pl.prototype.setItem=function(t,e){jr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},pl.prototype.removeItem=function(t){jr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},pl.prototype.Fs=function(t){var e=this,o=t;o.storageArea===this.storage&&(jr("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.Os?this.Se.enqueueRetryable(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){if(this.started){if(null!==o.key)if(this.Ls.test(o.key)){if(null==o.newValue)return e=this.ti(o.key),[2,this.ei(e,null)];if(e=this.ni(o.key,o.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(o.key)){if(null!==o.newValue&&(n=this.si(o.key,o.newValue)))return[2,this.ii(n)]}else if(this.qs.test(o.key)){if(null!==o.newValue&&(r=this.ri(o.key,o.newValue)))return[2,this.oi(r)]}else if(o.key===this.Us){if(null!==o.newValue&&(i=this.js(o.newValue)))return[2,this.Ws(i)]}else if(o.key===this.Ms)(i=function(t){var e=Lr.o;if(null!=t)try{var n=JSON.parse(t);zr("number"==typeof n),e=n}catch(t){Kr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==Lr.o&&this.sequenceNumberHandler(i);else if(o.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(o);return[2]})})}):Kr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(pl.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),pl.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},pl.prototype.zs=function(t,e,n){n=new Xh(this.currentUser,t,e,n),t=zh(this.persistenceKey,this.currentUser,t);this.setItem(t,n.Ss())},pl.prototype.Hs=function(t){t=zh(this.persistenceKey,this.currentUser,t);this.removeItem(t)},pl.prototype.Xs=function(t){t={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(t))},pl.prototype.Ys=function(t,e,n){var r=Wh(this.persistenceKey,t),n=new $h(t,e,n);this.setItem(r,n.Ss())},pl.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},pl.prototype.ti=function(t){t=this.Ls.exec(t);return t?t[1]:null},pl.prototype.ni=function(t,e){t=this.ti(t);return Jh.Vs(t,e)},pl.prototype.si=function(t,e){var n=this.Bs.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Xh.Vs(new Lh(n),t,e)},pl.prototype.ri=function(t,e){t=this.qs.exec(t),t=Number(t[1]);return $h.Vs(t,e)},pl.prototype.js=function(t){return Zh.Vs(t)},pl.prototype.ii=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(e.batchId,e.state,e.error)]:(jr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},pl.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},pl.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},pl.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},pl.prototype.Gs=function(t){var n=Zs;return t.forEach(function(t,e){n=n.unionWith(e.activeTargetIds)}),n},pl),nl=(dl.prototype.addPendingMutation=function(t){},dl.prototype.updateMutationState=function(t,e,n){},dl.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},dl.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},dl.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},dl.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},dl.prototype.clearQueryState=function(t){delete this.fi[t]},dl.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},dl.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},dl.prototype.start=function(){return this.li=new tl,Promise.resolve()},dl.prototype.handleUserChange=function(t,e,n){},dl.prototype.setOnlineState=function(t){},dl.prototype.shutdown=function(){},dl.prototype.writeSequenceNumber=function(t){},dl.prototype.notifyBundleLoaded=function(){},dl),rl=(fl.prototype.di=function(t){},fl.prototype.shutdown=function(){},fl),il=(ll.prototype.di=function(t){this.gi.push(t)},ll.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},ll.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},ll.prototype._i=function(){jr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},ll.prototype.yi=function(){jr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},ll.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ll),ol={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},sl=(hl.prototype.Ii=function(t){this.Ai=t},hl.prototype.Ri=function(t){this.bi=t},hl.prototype.onMessage=function(t){this.vi=t},hl.prototype.close=function(){this.Ti()},hl.prototype.send=function(t){this.Ei(t)},hl.prototype.Pi=function(){this.Ai()},hl.prototype.Vi=function(t){this.bi(t)},hl.prototype.Si=function(t){this.vi(t)},hl),al=(cl.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);jr("RestConnection","Sending: ",i,n);t={};return this.Fi(t,r),this.ki(e,i,t,n).then(function(t){return jr("RestConnection","Received: ",t),t},function(t){throw Gr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},cl.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},cl.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.4",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},cl.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+ol[t]},n(ul,Yh=cl),ul.prototype.ki=function(u,e,n,r){return new Promise(function(o,s){var a=new Or;a.listenOnce(Nr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Ar.NO_ERROR:var t=a.getResponseJson();jr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Ar.TIMEOUT:jr("Connection",'RPC "'+u+'" timed out'),s(new Vr(Fr.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:var e,n,r=a.getStatus();jr("Connection",'RPC "'+u+'" failed with status:',r,"response text:",a.getResponseText()),0<r?(e=a.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(Fr).indexOf(i)?i:Fr.UNKNOWN,s(new Vr(n,e.message))):s(new Vr(Fr.UNKNOWN,"Server responded with status "+a.getStatus())):s(new Vr(Fr.UNAVAILABLE,"Connection failed."));break;default:Hr()}}finally{jr("Connection",'RPC "'+u+'" completed.')}var i});var t=JSON.stringify(r);a.send(e,"POST",t,n,15)})},ul.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new pr,o=Sr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(t.xmlHttpFactory=new Rr({})),this.Fi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=h().indexOf("Electron/")||(0<=(n=h()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=h().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");jr("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new sl({Ei:function(t){u?jr("Connection","Not sending because WebChannel is closed:",t):(a||(jr("Connection","Opening WebChannel transport."),s.open(),a=!0),jr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,xr.EventType.OPEN,function(){u||jr("Connection","WebChannel transport opened.")}),t(s,xr.EventType.CLOSE,function(){u||(u=!0,jr("Connection","WebChannel transport closed"),c.Vi())}),t(s,xr.EventType.ERROR,function(t){u||(u=!0,Gr("Connection","WebChannel transport errored:",t),c.Vi(new Vr(Fr.UNAVAILABLE,"The operation could not be completed")))}),t(s,xr.EventType.MESSAGE,function(t){var e,n,r,i;u||(zr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(jr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ds[r];if(void 0!==t)return Ms(t)}(),i=n.message,void 0===t&&(t=Fr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Vr(t,i)),s.close()):(jr("Connection","WebChannel received:",e),c.Si(e)))}),t(o,Dr.STAT_EVENT,function(t){t.stat===Cr?jr("Connection","Detected buffering proxy"):t.stat===kr&&jr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Pi()},0),c},ul);function ul(t){var e=this;return(e=Yh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function cl(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function hl(t){this.Ei=t.Ei,this.Ti=t.Ti}function ll(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function fl(){}function dl(){this.li=new tl,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function pl(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Fs(Xr),this.started=!1,this.$s=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Hh(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new tl),this.Ls=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Qs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}function yl(){this.activeTargetIds=Zs}function gl(t,e){this.clientId=t,this.onlineState=e}function ml(t,e){this.clientId=t,this.activeTargetIds=e}function vl(t,e,n){this.targetId=t,this.state=e,this.error=n}function bl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function wl(){return"undefined"!=typeof window?window:null}function El(){return"undefined"!=typeof document?document:null}function Tl(t){return new ya(t,!0)}function Il(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Hl(this)?(jr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(4),[4,Ul(e)];case 1:return t.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Vl(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Rl(n,r)}var _l,Sl,Al,Nl=(Fl.prototype.reset=function(){this.qi=0},Fl.prototype.Ki=function(){this.qi=this.Bi},Fl.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);0<i&&jr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},Fl.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},Fl.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},Fl.prototype.Wi=function(){return(Math.random()-.5)*this.qi},Fl),I=(Ml.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},Ml.prototype.er=function(){return 2===this.state},Ml.prototype.start=function(){3!==this.state?this.auth():this.nr()},Ml.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ml.prototype.sr=function(){this.state=0,this.Zi.reset()},Ml.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},Ml.prototype.cr=function(t){this.ur(),this.stream.send(t)},Ml.prototype.rr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},Ml.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Ml.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():n&&n.code===Fr.RESOURCE_EXHAUSTED?(Kr(n.toString()),Kr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):n&&n.code===Fr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(n)];case 1:return t.sent(),[2]}})})},Ml.prototype.ar=function(){},Ml.prototype.auth=function(){var n=this;this.state=1;var t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(function(t){n.Yi===e&&n.lr(t)},function(e){t(function(){var t=new Vr(Fr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.dr(t)})})},Ml.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Ml.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},Ml.prototype.dr=function(t){return jr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Ml.prototype.hr=function(e){var n=this;return function(t){n.Se.enqueueAndForget(function(){return n.Yi===e?t():(jr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Ml),Dl=(n(Pl,Al=I),Pl.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},Pl.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Hr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(zr(void 0===s||"string"==typeof s),fi.fromBase64String(s||"")):(zr(void 0===s||s instanceof Uint8Array),fi.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Fr.UNKNOWN:Ms(c.code),new Vr(u,c.message||"")),s=new ia(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=Ta(t,n.document.name),i=va(n.document.updateTime),a=new ji({mapValue:{fields:n.document.fields}}),u=(o=Gi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new na(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=Ta(t,n.document),i=n.readTime?va(n.readTime):ti.min(),a=Gi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new na([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=Ta(t,n.document),i=n.removedTargetIds||[],s=new na([],i,r,null);else{if(!("filter"in e))return Hr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Ns(n),i=e.targetId,s=new ra(i,r)}return s}(this.R,t),t=function(t){if(!("targetChange"in t))return ti.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?va(t.readTime):ti.min()}(t);return this.listener._r(e,t)},Pl.prototype.mr=function(t){var e,n,r,i={};i.database=Sa(this.R),i.addTarget=(e=this.R,(r=Xi(r=(n=t).target)?{documents:Ra(e,r)}:{query:xa(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ma(e,n.resumeToken):0<n.snapshotVersion.compareTo(ti.min())&&(r.readTime=ga(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.R,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Hr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.cr(i)},Pl.prototype.yr=function(t){var e={};e.database=Sa(this.R),e.removeTarget=t,this.cr(e)},Pl),Cl=(n(Ll,Sl=I),Object.defineProperty(Ll.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),Ll.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,Sl.prototype.start.call(this)},Ll.prototype.ar=function(){this.gr&&this.Er([])},Ll.prototype.wr=function(t){return this.Hi.Oi("Write",t)},Ll.prototype.onMessage=function(t){if(zr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(zr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?va(e.updateTime):va(n)).isEqual(ti.min())&&(t=va(n)),new hs(t,e.transformResults||[]);var e,n})):[]),n=va(t.commitTime);return this.listener.Tr(n,e)}var n,r;return zr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},Ll.prototype.Ar=function(){var t={};t.database=Sa(this.R),this.cr(t)},Ll.prototype.Er=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ca(e.R,t)})};this.cr(t)},Ll),kl=(n(Ol,_l=function(){}),Ol.prototype.br=function(){if(this.Rr)throw new Vr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")},Ol.prototype.Ni=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Ni(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Fr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Vr(Fr.UNKNOWN,t.toString())})},Ol.prototype.$i=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.$i(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Fr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Vr(Fr.UNKNOWN,t.toString())})},Ol.prototype.terminate=function(){this.Rr=!0},Ol),Rl=(xl.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},xl.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},xl.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},xl.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},xl.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Kr(t),this.Vr=!1):jr("OnlineStateTracker",t)},xl.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},xl);function xl(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function Ol(t,e,n){var r=this;return(r=_l.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function Ll(t,e,n,r,i){var o=this;return(o=Sl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function Pl(t,e,n,r,i){var o=this;return(o=Al.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function Ml(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Nl(t,e)}function Fl(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}function Vl(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Hl(r))return[3,4];e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ul(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ql(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),Ql(t)?Gl(t):ef(t).er()&&jl(t,e))}function Bl(t,e){var n=t,t=ef(n);n.$r.delete(e),t.er()&&Kl(n,e),0===n.$r.size&&(t.er()?t.ir():Hl(n)&&n.Br.set("Unknown"))}function jl(t,e){t.qr.U(e.targetId),ef(t).mr(e)}function Kl(t,e){t.qr.U(e),ef(t).yr(e)}function Gl(e){e.qr=new sa({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),ef(e).start(),e.Br.Sr()}function Ql(t){return Hl(t)&&!ef(t).tr()&&0<t.$r.size}function Hl(t){return 0===t.Or.size}function zl(t){t.qr=void 0}function Wl(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.Br.set("Online"),!(a instanceof ia&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.$r.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.$r.delete(i),o.qr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),jr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Yl(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof na?s.qr.X(a):a instanceof ra?s.qr.rt(a):s.qr.et(a),u.isEqual(ti.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,dh(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).qr.ut(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.$r.get(e))&&r.$r.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.$r.get(t);e&&(r.$r.set(t,e.withResumeToken(fi.EMPTY_BYTE_STRING,e.snapshotVersion)),Kl(r,t),e=new Lu(e.target,t,1,e.sequenceNumber),jl(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return jr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Yl(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Yl(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!Tu(r))throw r;return n.Or.add(1),[4,Ul(n)];case 1:return t.sent(),n.Br.set("Offline"),i=i||function(){return dh(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return jr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Or.delete(1),[4,Vl(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Xl(e,n){return n().catch(function(t){return Yl(e,t,n)})}function $l(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=nf(i=u),s=0<i.kr.length?i.kr[i.kr.length-1].batchId:-1,t.label=1;case 1:if(!(Hl(i)&&i.kr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r._n.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.kr.length&&o.ir(),[3,7]):(s=a.batchId,function(t,e){t.kr.push(e);t=nf(t);t.er()&&t.pr&&t.Er(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,Yl(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Jl(i)&&Zl(i),[2]}var e,n,r})})}function Jl(t){return Hl(t)&&!nf(t).tr()&&0<t.kr.length}function Zl(t){nf(t).start()}function tf(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Or.delete(2),[4,Vl(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Or.add(2),[4,Ul(e)]);case 3:t.sent(),e.Br.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function ef(n){var t,e,r,i=this;return n.Ur||(n.Ur=(t=n.datastore,e=n.asyncQueue,r={Ii:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.$r.forEach(function(t,e){jl(n,t)}),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return zl(e),Ql(e)?(e.Br.Nr(n),Gl(e)):e.Br.set("Unknown"),[2]})})}.bind(null,n),_r:Wl.bind(null,n)},t.br(),new Dl(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Ur.sr(),Ql(n)?Gl(n):n.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Ur.stop()];case 2:t.sent(),zl(n),t.label=3;case 3:return[2]}})})})),n.Ur}function nf(n){var t,e,r,i=this;return n.Qr||(n.Qr=(t=n.datastore,e=n.asyncQueue,r={Ii:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return nf(e).Ar(),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&nf(e).pr?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Ps(n=i.code)&&n!==Fr.ABORTED?(e=r.kr.shift(),nf(r).sr(),[4,Xl(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,$l(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Jl(e)&&Zl(e),[2]}})})}.bind(null,n),Ir:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=nf(o),n=0,r=o.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}.bind(null,n),Tr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.kr.shift(),n=Ou.from(e,i,o),[4,Xl(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,$l(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.br(),new Cl(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Qr.sr(),[4,$l(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Qr.stop()];case 3:t.sent(),0<n.kr.length&&(jr("RemoteStore","Stopping write stream with "+n.kr.length+" pending writes"),n.kr=[]),t.label=4;case 4:return[2]}})})})),n.Qr}var rf=(of.createAndSchedule=function(t,e,n,r,i){i=new of(t,e,Date.now()+n,r,i);return i.start(n),i},of.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},of.prototype.skipDelay=function(){return this.handleDelayElapsed()},of.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Vr(Fr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},of.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},of.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},of);function of(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new hu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function sf(t,e){if(Kr("AsyncQueue",e+": "+t),Tu(t))return new Vr(Fr.UNAVAILABLE,e+": "+t);throw t}function af(){this.queries=new Mc(qo,Uo),this.onlineState="Unknown",this.Gr=new Set}var uf=(pf.emptySet=function(t){return new pf(t.comparator)},pf.prototype.has=function(t){return null!=this.keyedMap.get(t)},pf.prototype.get=function(t){return this.keyedMap.get(t)},pf.prototype.first=function(){return this.sortedSet.minKey()},pf.prototype.last=function(){return this.sortedSet.maxKey()},pf.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},pf.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(pf.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),pf.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},pf.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},pf.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},pf.prototype.isEqual=function(t){if(!(t instanceof pf))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},pf.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},pf.prototype.copy=function(t,e){var n=new pf;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},pf),cf=(df.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);!n||0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Hr()},df.prototype.jr=function(){var n=[];return this.Kr.inorderTraversal(function(t,e){n.push(e)}),n},df),hf=(ff.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new ff(t,e,uf.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(ff.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),ff.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Uo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},ff),lf=function(){this.Wr=void 0,this.listeners=[]};function ff(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function df(){this.Kr=new Fs(Ni.comparator)}function pf(n){this.comparator=n?function(t,e){return n(t,e)||Ni.comparator(t.key,e.key)}:function(t,e){return Ni.comparator(t.key,e.key)},this.keyedMap=Ys,this.sortedSet=new Fs(this.comparator)}function yf(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new lf),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Wr=t.sent(),[3,4];case 3:return o=t.sent(),o=sf(o,"Initialization of query '"+Bo(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.zr(e.onlineState),i.Wr&&a.Hr(i.Wr)&&mf(e),[2]}})})}function gf(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function mf(t){t.Gr.forEach(function(t){t.next()})}var vf=(Sf.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new hf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},Sf.prototype.onError=function(t){this.Jr.error(t)},Sf.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},Sf.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},Sf.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},Sf.prototype.no=function(t){t=hf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},Sf),bf=(_f.prototype.io=function(){return"metadata"in this.payload},_f),wf=(If.prototype.qn=function(t){return Ta(this.R,t)},If.prototype.Un=function(t){return t.metadata.exists?Da(this.R,t.document,!1):Gi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},If.prototype.Qn=va,If),Ef=(Tf.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Tf.prototype.co=function(t){for(var e=new Map,n=new wf(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Js()).add(s);e.set(c,h)}}return e},Tf.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,d,p){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Js(),i=Hs,o=Xs,e=0,s=d;e<s.length;e++)a=s[e],u=f.qn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.Un(a)),o=o.insert(u,f.Qn(a.metadata.readTime));return c=n.On.newChangeBuffer({trackRemovals:!0}),[4,gh(n,Fo(ko(ui.fromString("__bundle__/docs/"+p))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return yh(e,c,i,ti.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.qe.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.qe.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Mn.En(e,t)}).next(function(){return t})})})]}})})}(this.localStore,new wf(this.R),this.documents,this.ro.id)];case 1:e=t.sent(),n=this.co(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Js()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,gh(e,Fo(Wu(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=va(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.Qe.saveNamedQuery(t,i);e=n.withResumeToken(fi.EMPTY_BYTE_STRING,e);return r.Fn=r.Fn.insert(e.targetId,e),r.qe.updateTargetData(t,e).next(function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.qe.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.Qe.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new eh(Object.assign({},this.progress),e))]}})})},Tf);function Tf(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Af(t)}function If(t){this.R=t}function _f(t,e){this.payload=t,this.byteLength=e}function Sf(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function Af(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Nf=function(t){this.key=t},Df=function(t){this.key=t},Cf=(Object.defineProperty(Lf.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),Lf.prototype._o=function(t,e){var s=this,a=e?e.mo:new cf,u=(e||this).fo,c=(e||this).mutatedKeys,h=u,l=!1,f=Ro(this.query)&&u.size===this.query.limit?u.last():null,d=xo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=jo(s.query,e)?e:null,i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(a.track({type:3,doc:r}),e=!0):s.yo(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.lo(r,f)||d&&s.lo(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||d)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),Ro(this.query)||xo(this.query))for(;h.size>this.query.limit;){var n=Ro(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{fo:h,mo:a,Nn:l,mutatedKeys:c}},Lf.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},Lf.prototype.applyChanges=function(t,e,n){var o=this,r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Hr()}}var r,i}),this.po(n);var s=e?this.Eo():[],n=0===this.ho.size&&this.current?1:0,e=n!==this.ao;return this.ao=n,0!==i.length||e?{snapshot:new hf(this.query,t.fo,r,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},Lf.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new cf,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},Lf.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},Lf.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},Lf.prototype.Eo=function(){var e=this;if(!this.current)return[];var n=this.ho;this.ho=Js(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var r=[];return n.forEach(function(t){e.ho.has(t)||r.push(new Df(t))}),this.ho.forEach(function(t){n.has(t)||r.push(new Nf(t))}),r},Lf.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Js();t=this._o(t.documents);return this.applyChanges(t,!0)},Lf.prototype.Ro=function(){return hf.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},Lf),kf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Rf=function(t){this.key=t,this.bo=!1},xf=(Object.defineProperty(Of.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),Of);function Of(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Mc(qo,Uo),this.Vo=new Map,this.So=new Set,this.Do=new Fs(Ni.comparator),this.Co=new Map,this.No=new Sh,this.xo={},this.Fo=new Map,this.ko=mc.Yt(),this.onlineState="Unknown",this.$o=void 0}function Lf(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Js(),this.mutatedKeys=Js(),this.lo=Ko(t),this.fo=new uf(this.lo)}function Pf(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Oo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view._o(o)).Nn?[4,vh(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view._o(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Qf(r,i.targetId,n.To),n.snapshot)]}})})}(i,t,e,n)},[4,vh(i.localStore,o,!0)];case 1:return n=t.sent(),r=new Cf(o,n.Bn),e=r._o(n.documents),n=ea.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Qf(i,s,n.To),r=new kf(o,s,r),[2,(i.Po.set(o,r),i.Vo.has(s)?i.Vo.get(s).push(o):i.Vo.set(s,[o]),n.snapshot)]}})})}function Mf(f,d,p){return y(this,void 0,void 0,function(){var s,l;return g(this,function(t){switch(t.label){case 0:l=td(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=l.localStore,a=d,c=i,h=Zr.now(),o=a.reduce(function(t,e){return t.add(e.key)},Js()),c.persistence.runTransaction("Locally write mutations","readwrite",function(s){return c.Mn.pn(s,o).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),s=zo(o.transform,s||null);null!=s&&(n=null==n?ji.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new Es(i.key,o,function s(t){var a=[];return ii(t.fields,function(t,e){var n=new hi([t]);if(qi(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new li(a)}(o.value.mapValue),fs.exists(!0)))}return c._n.addMutationBatch(s,h,e,a)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return s=t.sent(),l.sharedClientState.addPendingMutation(s.batchId),e=l,n=s.batchId,r=p,i=(i=(i=e.xo[e.currentUser.toKey()])||new Fs(Xr)).insert(n,r),e.xo[e.currentUser.toKey()]=i,[4,zf(l,s.changes)];case 3:return t.sent(),[4,$l(l.remoteStore)];case 4:return t.sent(),[3,6];case 5:return l=t.sent(),l=sf(l,"Failed to persist write"),p.reject(l),[3,6];case 6:return[2]}var e,n,r,i,a,u,c,h,o})})}function Ff(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,ph(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.Co.get(e);e&&(zr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?zr(e.bo):0<t.removedDocuments.size&&(zr(e.bo),e.bo=!1))}),[4,zf(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,_c(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Vf(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.Po.forEach(function(t,e){e=e.view.zr(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].zr(i)&&(o=!0)}),o&&mf(t)}(t.eventManager,n),r.length&&t.vo._r(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function Uf(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i._n.lookupMutationBatch(e,r).next(function(t){return zr(null!==t),n=t.keys(),i._n.removeMutationBatch(e,t)}).next(function(){return i._n.performConsistencyCheck(e)}).next(function(){return i.Mn.pn(e,n)})}))];case 2:return o=t.sent(),jf(n,a,u),Bf(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,zf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,_c(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function qf(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Hl((n=o).remoteStore)||jr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Fo.get(r)||[]).push(s),n.Fo.set(r,i),[3,4]);case 3:return i=t.sent(),i=sf(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Bf(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function jf(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function Kf(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||Gf(e,t)})}function Gf(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Bl(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Hf(t))}function Qf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof Nf?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(jr("SyncEngine","New document in limbo: "+o),r.So.add(i),Hf(r))):u instanceof Df?(jr("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Gf(t,u.key)):Hr()}}function Hf(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ni(ui.fromString(e)),e=t.ko.next();t.Co.set(e,new Rf(n)),t.Do=t.Do.insert(n,e),ql(t.remoteStore,new Lu(Fo(ko(n.path)),e,2,Lr.o))}}function zf(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Po.isEmpty()?[3,3]:(n.Po.forEach(function(t,e){o.push(n.Oo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=rh.Pn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.vo._r(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return lu.forEach(c,function(e){return lu.forEach(e.bn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return lu.forEach(e.vn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Tu(e=t.sent()))throw e;return jr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Fn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Fn=r.Fn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Wf(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(jr("SyncEngine","User change. New user:",o.toKey()),[4,lh(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Fo.forEach(function(t){t.forEach(function(t){t.reject(new Vr(Fr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,zf(n,r.Ln)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Yf(a,u,c,h){return y(this,void 0,void 0,function(){var o,s;return g(this,function(t){switch(t.label){case 0:return[4,(e=(o=a).localStore,n=u,i=(r=e)._n,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.jt(e,n).next(function(t){return t?r.Mn.pn(e,t):lu.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,$l(o.remoteStore)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(jf(o,u,h||null),Bf(o,u),o.localStore._n.Gt(u)):Hr(),t.label=4;case 4:return[4,zf(o,s)];case 5:return t.sent(),[3,7];case 6:jr("SyncEngine","Cannot apply mutation batch with id: "+u),t.label=7;case 7:return[2]}var e,n,r,i})})}function Xf(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,a,u,c;return g(this,function(t){switch(t.label){case 0:return Zf(r=h),td(r),!0!==l||!0===r.$o?[3,3]:(e=r.sharedClientState.getAllActiveQueryTargets(),[4,$f(r,e.toArray())]);case 1:return i=t.sent(),r.$o=!0,[4,tf(r.remoteStore,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)a=s[o],ql(r.remoteStore,a);return[3,7];case 3:return!1!==l||!1===r.$o?[3,7]:(u=[],c=Promise.resolve(),r.Vo.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then(function(){return Kf(r,e),mh(r.localStore,e,!0)}),Bl(r.remoteStore,e)}),[4,c]);case 4:return t.sent(),[4,$f(r,u)];case 5:return t.sent(),(n=r).Co.forEach(function(t,e){Bl(n.remoteStore,e)}),n.No.ts(),n.Co=new Map,n.Do=new Fs(Ni.comparator),r.$o=!1,[4,tf(r.remoteStore,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function $f(d,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l,f;return g(this,function(t){switch(t.label){case 0:e=d,n=[],r=[],i=0,o=p,t.label=1;case 1:return i<o.length?(s=o[i],a=void 0,(u=e.Vo.get(s))&&0!==u.length?[4,gh(e.localStore,Fo(u[0]))]:[3,7]):[3,13];case 2:a=t.sent(),c=0,h=u,t.label=3;case 3:return c<h.length?(l=h[c],l=e.Po.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,vh((e=r).localStore,i.query,!0)];case 1:return n=t.sent(),n=i.view.Ao(n),[2,(e.isPrimaryClient&&Qf(e,i.targetId,n.To),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,bh(e.localStore,s)];case 8:return f=t.sent(),[4,gh(e.localStore,f)];case 9:return a=t.sent(),[4,Pf(e,Jf(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(a),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.vo._r(r),n)]}})})}function Jf(t){return Co(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Zf(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Ff.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.Co.get(e))&&t.bo)return Js().add(t.key);var r=Js();if(!(e=n.Vo.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Po.get(s),r=r.unionWith(s.view.wo);return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Fs(Ni.comparator)).insert(n,Gi.newNoDocument(n,ti.min())),i=Js().add(n),i=new ta(ti.min(),new Map,new Gs(Xr),r,i),[4,Ff(e,i)]):[3,2];case 1:return t.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),Hf(e),[3,4];case 2:return[4,mh(e.localStore,s,!1).then(function(){return Kf(e,s,a)}).catch(_c)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&mf(n)}.bind(null,t.eventManager),t.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function td(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,fh(e.localStore,o)];case 2:return r=t.sent(),jf(e,n,null),Bf(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,zf(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,_c(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Uf.bind(null,t),t}function ed(t,e,n){var r=t;!function(f,d,p){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,d.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=va((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Qe.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,d.close()]:[3,4];case 3:return[2,(t.sent(),void p._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return p._updateProgress(Af(a)),u=new Ef(a,f.localStore,d.R),[4,d.Lo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.oo(c)]:[3,10];case 7:return(h=t.sent())&&p._updateProgress(h),[4,d.Lo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,zf(f,l.wn,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Qe.saveBundleMetadata(t,e)}))];case 13:return t.sent(),p._completeWith(l.progress),[3,15];case 14:return Gr("SyncEngine","Loading bundle failed with "+(l=t.sent())),p._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var nd,rd,id=(ld.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.R=Tl(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Qo(e),[2]}})})},ld.prototype.Uo=function(t){return null},ld.prototype.Qo=function(t){return hh(this.persistence,new ih,t.initialUser,this.R)},ld.prototype.qo=function(t){return new Rh(Oh.bs,this.R)},ld.prototype.Bo=function(t){return new nl},ld.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},ld),od=(n(hd,rd=id),hd.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,rd.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,Eh(this.localStore)];case 2:return t.sent(),[4,this.Ko.initialize(this,e)];case 3:return t.sent(),[4,td(this.Ko.syncEngine)];case 4:return t.sent(),[4,$l(this.Ko.remoteStore)];case 5:return t.sent(),[2]}})})},hd.prototype.Qo=function(t){return hh(this.persistence,new ih,t.initialUser,this.R)},hd.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Nc(e,t.asyncQueue)},hd.prototype.qo=function(t){var e=th(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ac.withCacheSize(this.cacheSizeBytes):ac.DEFAULT;return new Xc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,wl(),El(),this.R,this.sharedClientState,!!this.forceOwnership)},hd.prototype.Bo=function(t){return new nl},hd),sd=(n(cd,nd=od),cd.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:return[4,nd.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Ko.syncEngine,this.sharedClientState instanceof el?(this.sharedClientState.syncEngine={ui:Yf.bind(null,e),ai:function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return(e=i).$o?(jr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Vo.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,wh(e.localStore)];case 3:return n=t.sent(),r=ta.createSynthesizedRemoteEventForCurrentChange(o,"current"===s),[4,zf(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,mh(e.localStore,o,!0)];case 6:return t.sent(),Kf(e,o,a),[3,8];case 7:Hr(),t.label=8;case 8:return[2]}})})}.bind(null,e),hi:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,a,u;return g(this,function(t){switch(t.label){case 0:if(!(n=Zf(c)).$o)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.Vo.has(r)?(jr("SyncEngine","Adding an already active target "+r),[3,5]):[4,bh(n.localStore,r)]):[3,6];case 2:return i=t.sent(),[4,gh(n.localStore,i)];case 3:return o=t.sent(),[4,Pf(n,Jf(i),o.targetId,!1)];case 4:t.sent(),ql(n.remoteStore,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return g(this,function(t){switch(t.label){case 0:return n.Vo.has(e)?[4,mh(n.localStore,e,!1).then(function(){Bl(n.remoteStore,e),Kf(n,e)}).catch(_c)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,u=l,t.label=7;case 7:return a<u.length?(u=u[a],[5,s(u)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),fn:function(t){return t.localStore.persistence.fn()}.bind(null,e),ci:function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,wh((e=n).localStore).then(function(t){return zf(e,t)})]})})}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.He(function(e){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,Xf(this.Ko.syncEngine,e)];case 1:return t.sent(),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},cd.prototype.Bo=function(t){var e=wl();if(!el.yt(e))throw new Vr(Fr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=th(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new el(e,t.asyncQueue,n,t.clientId,t.initialUser)},cd),ad=(ud.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Vf(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Wf.bind(null,this.syncEngine),[4,tf(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},ud.prototype.createEventManager=function(t){return new af},ud.prototype.createDatastore=function(t){var e=Tl(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new al(n));return t=t.credentials,new kl(t,n,e)},ud.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return Vf(e.syncEngine,t,0)},t=new(il.yt()?il:rl);return new Il(n,r,i,o,t)},ud.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new xf(t,e,n,r,i,o);return s&&(o.$o=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},ud.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,jr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Ul(e)];case 1:return t.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},ud);function ud(){}function cd(t,e){var n=this;return(n=nd.call(this,t,e,!1)||this).Ko=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function hd(t,e,n){var r=this;return(r=rd.call(this)||this).Ko=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function ld(){this.synchronizeTabs=!1}function fd(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var dd=(Td.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Td.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Td.prototype.Wo=function(){this.muted=!0},Td.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Td),pd=(Ed.prototype.close=function(){return this.Go.cancel()},Ed.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},Ed.prototype.Lo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},Ed.prototype.Ho=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.Jo()];case 1:return null===(e=t.sent())?[2,null]:(r=this.zo.decode(e),n=Number(r),isNaN(n)&&this.Yo("length string ("+r+") is not valid number"),[4,this.Xo(n)]);case 2:return r=t.sent(),[2,new bf(JSON.parse(r),e.length+n)]}})})},Ed.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Ed.prototype.Jo=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Ed.prototype.Xo=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.tc()]:[3,3];case 1:t.sent()&&this.Yo("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Ed.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},Ed.prototype.tc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Go.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Ed),yd=(wd.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Vr(Fr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Sa((n=s).R)+"/documents",r={documents:a.map(function(t){return Ea(n.R,t)})},[4,n.$i("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.R,"found"in(t=t)?function(t,e){zr(!!e.found),e.found.name,e.found.updateTime;var n=Ta(t,e.found.name),t=va(e.found.updateTime),e=new ji({mapValue:{fields:e.found.fields}});return Gi.newFoundDocument(n,t,e)}(e,t):"missing"in t?function(t,e){zr(!!e.missing),zr(!!e.readTime);t=Ta(t,e.missing),e=va(e.readTime);return Gi.newNoDocument(t,e)}(e,t):Hr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());zr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},wd.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},wd.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},wd.prototype.delete=function(t){this.write(new Rs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},wd.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Ni.fromPath(e);n.mutations.push(new xs(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=Sa((e=i).R)+"/documents",r={writes:o.map(function(t){return Ca(e.R,t)})},[4,e.Ni("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},wd.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Hr();e=ti.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(Fr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},wd.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?fs.updateTime(e):fs.none()},wd.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return fs.exists(!0);if(e.isEqual(ti.min()))throw new Vr(Fr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fs.updateTime(e)},wd.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},wd.prototype.ensureCommitNotCalled=function(){},wd),gd=(bd.prototype.run=function(){this.nc()},bd.prototype.nc=function(){var t=this;this.Zi.ji(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new yd(this.datastore),(n=this.sc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},bd.prototype.sc=function(t){try{var e=this.updateFunction(t);return!_i(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},bd.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},bd.prototype.rc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Ps(t)},bd),md=(vd.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},vd.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},vd.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Vr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")},vd.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new hu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=sf(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},vd);function vd(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Lh.UNAUTHENTICATED,this.clientId=Wr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return jr("FirestoreClient","Received user=",e.uid),[4,this.credentialListener(e)];case 1:return t.sent(),this.user=e,[2]}})})})}function bd(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Nl(this.asyncQueue,"transaction_retry")}function wd(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Ed(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new hu,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Td(t){this.observer=t,this.muted=!1}function Id(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),jr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n.isEqual(e)?[3,2]:[4,lh(o.localStore,e)];case 1:t.sent(),n=e,t.label=2;case 2:return[2]}})})}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}function _d(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Sd(r)];case 1:return e=t.sent(),jr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),jr("RemoteStore","RemoteStore received new credentials"),n=Hl(e),e.Or.add(3),[4,Ul(e)];case 1:return t.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Or.delete(3),[4,Vl(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)}),r.onlineComponents=i,[2]}})})}function Sd(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(jr("FirestoreClient","Using default OfflineComponentProvider"),[4,Id(e,new id)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Ad(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(jr("FirestoreClient","Using default OnlineComponentProvider"),[4,_d(e,new ad)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Nd(t){return Sd(t).then(function(t){return t.persistence})}function Dd(t){return Sd(t).then(function(t){return t.localStore})}function Cd(t){return Ad(t).then(function(t){return t.remoteStore})}function kd(t){return Ad(t).then(function(t){return t.syncEngine})}function Rd(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Ad(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=function(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Zf(s),(o=e.Po.get(a))?(n=o.targetId,e.sharedClientState.addLocalQueryTarget(n),r=o.view.Ro(),[3,4]):[3,1];case 1:return[4,gh(e.localStore,Fo(a))];case 2:return i=t.sent(),o=e.sharedClientState.addLocalQueryTarget(i.targetId),n=i.targetId,[4,Pf(e,a,n,"current"===o)];case 3:r=t.sent(),e.isPrimaryClient&&ql(e.remoteStore,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Po.get(o),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter(function(t){return!Uo(t,o)})),void e.Po.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,mh(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Bl(e.remoteStore,n.targetId),Kf(e,n.targetId)}).catch(_c)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Kf(e,n.targetId),[4,mh(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function xd(n,r,i){var t=this;void 0===i&&(i={});var o=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new dd({next:function(t){r.enqueueAndForget(function(){return gf(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Vr(Fr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Vr(Fr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new vf(ko(i.path),t,{includeMetadataChanges:!0,so:!0});return yf(n,a)},[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Od(n,r,i){var t=this;void 0===i&&(i={});var o=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new dd({next:function(t){n.enqueueAndForget(function(){return gf(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Vr(Fr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new vf(t,o,{includeMetadataChanges:!0,so:!0});return yf(e,s)},[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Ld(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Pd=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Md=(Object.defineProperty(Wd.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Wd.prototype.isEqual=function(t){return t instanceof Wd&&t.projectId===this.projectId&&t.database===this.database},Wd),Fd=new Map,Vd=(zd.prototype.getToken=function(){return Promise.resolve(null)},zd.prototype.invalidateToken=function(){},zd.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Lh.UNAUTHENTICATED)})},zd.prototype.removeChangeListener=function(){this.changeListener=null},zd),Ud=(Hd.prototype.getToken=function(){return Promise.resolve(this.token)},Hd.prototype.invalidateToken=function(){},Hd.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},Hd.prototype.removeChangeListener=function(){this.changeListener=null},Hd),qd=(Qd.prototype.getToken=function(){var e=this,n=this.cc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.cc!==n?(jr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(zr("string"==typeof t.accessToken),new Ld(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Qd.prototype.invalidateToken=function(){this.forceRefresh=!0},Qd.prototype.setChangeListener=function(t,e){this.uc=!0,this.asyncQueue=t,this.changeListener=e},Qd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.ac),this.changeListener=function(){return Promise.resolve()}},Qd.prototype.hc=function(){var t=this.auth&&this.auth.getUid();return zr(null===t||"string"==typeof t),new Lh(t)},Qd.prototype.lc=function(){var t=this;this.uc&&(this.uc=!1,this.asyncQueue.enqueueRetryable(function(){return y(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,this.changeListener(this.currentUser)];case 2:return t.sent(),this.uc=!0,[2]}})})}))},Qd),Bd=(Object.defineProperty(Gd.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.dc},e=this.fc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.wc&&(t["X-Goog-Iam-Authorization-Token"]=this.wc),t},enumerable:!1,configurable:!0}),Gd),jd=(Kd.prototype.getToken=function(){return Promise.resolve(new Bd(this.fc,this.dc,this.wc))},Kd.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Lh.FIRST_PARTY)})},Kd.prototype.removeChangeListener=function(){},Kd.prototype.invalidateToken=function(){},Kd);function Kd(t,e,n){this.fc=t,this.dc=e,this.wc=n}function Gd(t,e,n){this.fc=t,this.dc=e,this.wc=n,this.type="FirstParty",this.user=Lh.FIRST_PARTY}function Qd(e){var n=this;this.currentUser=Lh.UNAUTHENTICATED,this.oc=new hu,this.cc=0,this.changeListener=function(){return Promise.resolve()},this.uc=!1,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.ac=function(){n.cc++,n.currentUser=n.hc(),n.oc.resolve(),n.uc&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};function r(t){jr("FirebaseCredentialsProvider","Auth detected"),n.auth=t,n.lc(),n.auth.addAuthTokenListener(n.ac)}e.onInit(r),setTimeout(function(){var t;n.auth||((t=e.getImmediate({optional:!0}))?r(t):n.uc&&(jr("FirebaseCredentialsProvider","Auth not yet detected"),n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})))},0)}function Hd(t){this.token=t,this.changeListener=null}function zd(){this.changeListener=null}function Wd(t,e){this.projectId=t,this.database=e||"(default)"}function Yd(t,e,n){if(!n)throw new Vr(Fr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Xd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function $d(t,e,n,r){if(!0===e&&!0===r)throw new Vr(Fr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Jd(t){if(!Ni.isDocumentKey(t))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Zd(t){if(Ni.isDocumentKey(t))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function tp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Hr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function ep(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Vr(Fr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=tp(t);throw new Vr(Fr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function np(t,e){if(e<=0)throw new Vr(Fr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var rp,ip=(dp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},dp),op=(Object.defineProperty(fp.prototype,"app",{get:function(){if(!this._app)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(fp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(fp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),fp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ip(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Vd;switch(t.type){case"gapi":var e=t.client;return zr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new jd(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Vr(Fr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},fp.prototype._getSettings=function(){return this._settings},fp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},fp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},fp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},fp.prototype._terminate=function(){return(t=Fd.get(this))&&(jr("ComponentProvider","Removing Datastore"),Fd.delete(this),t.terminate()),Promise.resolve();var t},fp),sp=(Object.defineProperty(lp.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(lp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(lp.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(lp.prototype,"parent",{get:function(){return new up(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),lp.prototype.withConverter=function(t){return new lp(this.firestore,t,this._key)},lp),ap=(hp.prototype.withConverter=function(t){return new hp(this.firestore,t,this._query)},hp),up=(n(cp,rp=ap),Object.defineProperty(cp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new sp(this.firestore,null,new Ni(t))},enumerable:!1,configurable:!0}),cp.prototype.withConverter=function(t){return new cp(this.firestore,t,this._path)},cp);function cp(t,e,n){var r=this;return(r=rp.call(this,t,e,ko(n))||this)._path=n,r.type="collection",r}function hp(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function lp(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function fp(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ip({}),this._settingsFrozen=!1,t instanceof Md?(this._databaseId=t,this._credentials=new Vd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(Fr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Md(t.options.projectId)}(t),this._credentials=new qd(e))}function dp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(Fr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(Fr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,$d("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function pp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=v(t),Yd("collection","path",e),t instanceof op)return Zd(n=ui.fromString.apply(ui,s([e],r))),new up(t,null,n);if(!(t instanceof sp||t instanceof up))throw new Vr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zd(n=ui.fromString.apply(ui,s([t.path],r)).child(ui.fromString(e))),new up(t.firestore,null,n)}function yp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=v(t),Yd("doc","path",e=1===arguments.length?Wr.u():e),t instanceof op)return Jd(n=ui.fromString.apply(ui,s([e],r))),new sp(t,null,new Ni(n));if(!(t instanceof sp||t instanceof up))throw new Vr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Jd(n=t._path.child(ui.fromString.apply(ui,s([e],r)))),new sp(t.firestore,t instanceof up?t.converter:null,new Ni(n))}function gp(t,e){return t=v(t),e=v(e),(t instanceof sp||t instanceof up)&&(e instanceof sp||e instanceof up)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function mp(t,e){return t=v(t),e=v(e),t instanceof ap&&e instanceof ap&&t.firestore===e.firestore&&Uo(t._query,e._query)&&t.converter===e.converter}var vp=(Object.defineProperty(bp.prototype,"isShuttingDown",{get:function(){return this.yc},enumerable:!1,configurable:!0}),bp.prototype.enqueueAndForget=function(t){this.enqueue(t)},bp.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Rc(),this.bc(t)},bp.prototype.enterRestrictedMode=function(){var t;this.yc||(this.yc=!0,(t=El())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ac))},bp.prototype.enqueue=function(t){return this.Rc(),this.yc?new Promise(function(t){}):this.bc(t)},bp.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.mc.push(t),e.vc()})},bp.prototype.vc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.mc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.mc[0]()];case 2:return t.sent(),this.mc.shift(),this.Zi.reset(),[3,4];case 3:if(!Tu(e=t.sent()))throw e;return jr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.mc.length&&this.Zi.ji(function(){return n.vc()}),t.label=5;case 5:return[2]}})})},bp.prototype.bc=function(t){var r=this,e=this._c.then(function(){return r.Tc=!0,t().catch(function(t){throw r.Ec=t,r.Tc=!1,Kr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.Tc=!1,t})});return this._c=e},bp.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Rc(),-1<this.Ic.indexOf(t)&&(e=0);n=rf.createAndSchedule(this,t,e,n,function(t){return r.Pc(t)});return this.gc.push(n),n},bp.prototype.Rc=function(){this.Ec&&Hr()},bp.prototype.verifyOperationInProgress=function(){},bp.prototype.Vc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this._c];case 1:t.sent(),t.label=2;case 2:if(e!==this._c)return[3,0];t.label=3;case 3:return[2]}})})},bp.prototype.Sc=function(t){for(var e=0,n=this.gc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},bp.prototype.Dc=function(r){var i=this;return this.Vc().then(function(){i.gc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.gc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Vc()})},bp.prototype.Cc=function(t){this.Ic.push(t)},bp.prototype.Pc=function(t){t=this.gc.indexOf(t);this.gc.splice(t,1)},bp);function bp(){var e=this;this._c=Promise.resolve(),this.mc=[],this.yc=!1,this.gc=[],this.Ec=null,this.Tc=!1,this.Ic=[],this.Zi=new Nl(this,"async_queue_retry"),this.Ac=function(){var t=El();t&&jr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=El();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ac)}function wp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Ep,Tp=(Sp.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Sp.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Sp.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Sp.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Sp.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Sp.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Sp),Ip=(n(_p,Ep=op),_p.prototype._terminate=function(){return this._firestoreClient||Np(this),this._firestoreClient.terminate()},_p);function _p(t,e){var n=this;return(n=Ep.call(this,t,e)||this).type="firestore",n._queue=new vp,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Sp(){this._progressObserver={},this._taskCompletionResolver=new hu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Ap(t){return t._firestoreClient||Np(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Np(t){var e,n,r,i=t._freezeSettings(),i=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,new Pd(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));t._firestoreClient=new md(t._credentials,t._queue,i)}function Dp(n,r,i){var t=this,o=new hu;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,Id(n,i)];case 1:return t.sent(),[4,_d(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(e=t.sent()).name?e.code===Fr.FAILED_PRECONDITION||e.code===Fr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Cp(t){if(t._initialized||t._terminated)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var kp=(Bp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Bp),Rp=(qp.fromBase64String=function(t){try{return new qp(fi.fromBase64String(t))}catch(t){throw new Vr(Fr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},qp.fromUint8Array=function(t){return new qp(fi.fromUint8Array(t))},qp.prototype.toBase64=function(){return this._byteString.toBase64()},qp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},qp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},qp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},qp),xp=function(t){this._methodName=t},Op=(Object.defineProperty(Up.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(Up.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),Up.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Up.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},Up.prototype._compareTo=function(t){return Xr(this._lat,t._lat)||Xr(this._long,t._long)},Up),Lp=/^__.*__$/,Pp=(Vp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Es(t,this.data,this.fieldMask,e,this.fieldTransforms):new ws(t,this.data,e,this.fieldTransforms)},Vp),Mp=(Fp.prototype.toMutation=function(t,e){return new Es(t,this.data,this.fieldMask,e,this.fieldTransforms)},Fp);function Fp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Vp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Up(t,e){if(!isFinite(t)||t<-90||90<t)throw new Vr(Fr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Vr(Fr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function qp(t){this._byteString=t}function Bp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hi(t)}function jp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Hr()}}var Kp=(Object.defineProperty(Hp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Hp.prototype,"xc",{get:function(){return this.settings.xc},enumerable:!1,configurable:!0}),Hp.prototype.Fc=function(t){return new Hp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Hp.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Fc({path:e,$c:!1});return e.Oc(t),e},Hp.prototype.Mc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Fc({path:t,$c:!1});return t.Nc(),t},Hp.prototype.Lc=function(t){return this.Fc({path:void 0,$c:!0})},Hp.prototype.Bc=function(t){return Ey(t,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Uc)},Hp.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},Hp.prototype.Nc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Oc(this.path.get(t))},Hp.prototype.Oc=function(t){if(0===t.length)throw this.Bc("Document fields must not be empty");if(jp(this.xc)&&Lp.test(t))throw this.Bc('Document fields cannot begin and end with "__"')},Hp),Gp=(Qp.prototype.Qc=function(t,e,n,r){return void 0===r&&(r=!1),new Kp({xc:t,methodName:e,Uc:n,path:hi.emptyPath(),$c:!1,qc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},Qp);function Qp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Tl(t)}function Hp(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Nc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function zp(t){var e=t._freezeSettings(),n=Tl(t._databaseId);return new Gp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Wp(t,e,n,r,i,o){var s=t.Qc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);my("Data must be an object, but it was:",s,r);var a,u,r=yy(r,s);if(o.merge)a=new li(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=vy(e,l[h],n);if(!s.contains(f))throw new Vr(Fr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Ty(c,f)||c.push(f)}a=new li(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Pp(new ji(r),a,u)}var Yp,Xp=(n($p,Yp=xp),$p.prototype._toFieldTransform=function(t){if(2!==t.xc)throw 1===t.xc?t.Bc(this._methodName+"() can only appear at the top level of your update data"):t.Bc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},$p.prototype.isEqual=function(t){return t instanceof $p},$p);function $p(){return null!==Yp&&Yp.apply(this,arguments)||this}function Jp(t,e,n){return new Kp({xc:3,Uc:e.settings.Uc,methodName:t._methodName,$c:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Zp,ty,ey,ny,ry=(n(hy,ny=xp),hy.prototype._toFieldTransform=function(t){return new ls(t.path,new Xo)},hy.prototype.isEqual=function(t){return t instanceof hy},hy),iy=(n(cy,ey=xp),cy.prototype._toFieldTransform=function(t){var e=Jp(this,t,!0),n=this.Kc.map(function(t){return py(t,e)}),n=new $o(n);return new ls(t.path,n)},cy.prototype.isEqual=function(t){return this===t},cy),oy=(n(uy,ty=xp),uy.prototype._toFieldTransform=function(t){var e=Jp(this,t,!0),n=this.Kc.map(function(t){return py(t,e)}),n=new ns(n);return new ls(t.path,n)},uy.prototype.isEqual=function(t){return this===t},uy),sy=(n(ay,Zp=xp),ay.prototype._toFieldTransform=function(t){var e=new ss(t.R,Ho(t.R,this.jc));return new ls(t.path,e)},ay.prototype.isEqual=function(t){return this===t},ay);function ay(t,e){var n=this;return(n=Zp.call(this,t)||this).jc=e,n}function uy(t,e){var n=this;return(n=ty.call(this,t)||this).Kc=e,n}function cy(t,e){var n=this;return(n=ey.call(this,t)||this).Kc=e,n}function hy(){return null!==ny&&ny.apply(this,arguments)||this}function ly(t,r,i,e){var o=t.Qc(1,r,i);my("Data must be an object, but it was:",o,e);var s=[],a=ji.empty();ii(e,function(t,e){var n=wy(r,t,i);e=v(e);t=o.Mc(n);e instanceof Xp?s.push(n):null!=(t=py(e,t))&&(s.push(n),a.set(n,t))});e=new li(s);return new Mp(a,e,o.fieldTransforms)}function fy(t,e,n,r,i,o){var s=t.Qc(1,e,n),a=[vy(e,r,n)],u=[i];if(o.length%2!=0)throw new Vr(Fr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(vy(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=ji.empty(),y=a.length-1;0<=y;--y)Ty(d,a[y])||(h=a[y],l=v(l=u[y]),f=s.Mc(h),l instanceof Xp?d.push(h):null!=(f=py(l,f))&&(d.push(h),p.set(h,f)));i=new li(d);return new Mp(p,i,s.fieldTransforms)}function dy(t,e,n,r){return py(n,t.Qc((r=void 0===r?!1:r)?4:3,e))}function py(s,t){if(gy(s=v(s)))return my("Unsupported field value:",t,s),yy(s,t);if(s instanceof xp)return function(t,e){if(!jp(e.xc))throw e.Bc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Bc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.$c&&4!==t.xc)throw t.Bc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=py(i[r],t.Lc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=v(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ho(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Zr.fromDate(t);return{timestampValue:ga(e.R,n)}}if(t instanceof Zr)return n=new Zr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ga(e.R,n)};if(t instanceof Op)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Rp)return{bytesValue:ma(e.R,t._byteString)};if(t instanceof sp){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Bc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ba(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Bc("Unsupported field value: "+tp(t))}(0,t)}function yy(t,n){var r={};return oi(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ii(t,function(t,e){e=py(e,n.kc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function gy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Zr||t instanceof Op||t instanceof Rp||t instanceof sp||t instanceof xp)}function my(t,e,n){if(!gy(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=tp(n);throw"an object"===n?e.Bc(t+" a custom object"):e.Bc(t+" "+n)}var r}function vy(t,e,n){if((e=v(e))instanceof kp)return e._internalPath;if("string"==typeof e)return wy(t,e);throw Ey("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var by=new RegExp("[~\\*/\\[\\]]");function wy(e,n,r){if(0<=n.search(by))throw Ey("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(kp.bind.apply(kp,s([void 0],n.split(".")))))._internalPath}catch(t){throw Ey("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Ey(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Vr(Fr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Ty(t,e){return t.some(function(t){return t.isEqual(e)})}var Iy,_y=(Object.defineProperty(Ny.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Ny.prototype,"ref",{get:function(){return new sp(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Ny.prototype.exists=function(){return null!==this._document},Ny.prototype.data=function(){if(this._document){if(this._converter){var t=new Sy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},Ny.prototype.get=function(t){if(this._document){t=this._document.data.field(Dy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Ny),Sy=(n(Ay,Iy=_y),Ay.prototype.data=function(){return Iy.prototype.data.call(this)},Ay);function Ay(){return null!==Iy&&Iy.apply(this,arguments)||this}function Ny(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Dy(t,e){return"string"==typeof e?wy(t,e):(e instanceof kp?e:e._delegate)._internalPath}var Cy,ky,Ry=(Vy.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Vy),xy=(n(Fy,ky=_y),Fy.prototype.exists=function(){return ky.prototype.exists.call(this)},Fy.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Oy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},Fy.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data.field(Dy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},Fy),Oy=(n(My,Cy=xy),My.prototype.data=function(t){return Cy.prototype.data.call(this,t=void 0===t?{}:t)},My),Ly=(Object.defineProperty(Py.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Py.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Py.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Py.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new Oy(r._firestore,r._userDataWriter,t.key,t,new Ry(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query.converter))})},Py.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Vr(Fr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new Oy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Ry(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Oy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Ry(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Hr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Py);function Py(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ry(r.hasPendingWrites,r.fromCache),this.query=n}function My(){return null!==Cy&&Cy.apply(this,arguments)||this}function Fy(t,e,n,r,i,o){var s=this;return(s=ky.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function Vy(t,e){this.hasPendingWrites=t,this.fromCache=e}function Uy(t,e){return t instanceof xy&&e instanceof xy?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ly&&e instanceof Ly&&t._firestore===e._firestore&&mp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function qy(t){if(xo(t)&&0===t.explicitOrderBy.length)throw new Vr(Fr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}Se=function(){};function By(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var jy,Ky,Gy,Qy,Hy,zy=(n(ng,Hy=Se),ng.prototype._apply=function(t){var e=zp(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){og(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(ig(n,t,c))}h={arrayValue:{values:s}}}else h=ig(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||og(o,i),h=dy(e,"where",o,"in"===i||"not-in"===i);var h=Ji.create(r,i,h);return function(t,e){if(e.g()){var n=Lo(t);if(null!==n&&!n.isEqual(e.field))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=Oo(t);null!==n&&sg(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.Wc,this.Gc,this.zc);return new ap(t.firestore,t.converter,(t=t._query,e=t.filters.concat([e]),new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},ng),Wy=(n(eg,Qy=Se),eg.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new So(e,n);return e=r,null!==Oo(n=t)||null!==(t=Lo(n))&&sg(0,t,e.field),r}(t._query,this.Wc,this.Hc);return new ap(t.firestore,t.converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new Do(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},eg),Yy=(n(tg,Gy=Se),tg.prototype._apply=function(t){return new ap(t.firestore,t.converter,Vo(t._query,this.Jc,this.Yc))},tg),Xy=(n(Zy,Ky=Se),Zy.prototype._apply=function(t){var e=rg(t,this.type,this.Xc,this.Zc);return new ap(t.firestore,t.converter,(t=t._query,e=e,new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Zy),$y=(n(Jy,jy=Se),Jy.prototype._apply=function(t){var e=rg(t,this.type,this.Xc,this.Zc);return new ap(t.firestore,t.converter,(t=t._query,e=e,new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Jy);function Jy(t,e,n){var r=this;return(r=jy.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function Zy(t,e,n){var r=this;return(r=Ky.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function tg(t,e,n){var r=this;return(r=Gy.call(this)||this).type=t,r.Jc=e,r.Yc=n,r}function eg(t,e){var n=this;return(n=Qy.call(this)||this).Wc=t,n.Hc=e,n.type="orderBy",n}function ng(t,e,n){var r=this;return(r=Hy.call(this)||this).Wc=t,r.Gc=e,r.zc=n,r.type="where",r}function rg(t,c,e,n){if(e[0]=v(e[0]),e[0]instanceof _y)return function(t,e,n,r){if(!n)throw new Vr(Fr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Mo(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(Pi(e,n.key));else{var u=n.data.field(a.field);if(Ti(u))throw new Vr(Fr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new bo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=zp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Vr(Fr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Po(t)&&-1!==c.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ui.fromString(c));if(!Ni.isDocumentKey(h))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Ni(h);a.push(Pi(e,h))}else{c=dy(n,r,c);a.push(c)}}return new bo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function ig(t,e,n){if("string"==typeof(n=v(n))){if(""===n)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Po(e)&&-1!==n.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(ui.fromString(n));if(!Ni.isDocumentKey(e))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Pi(t,new Ni(e))}if(n instanceof sp)return Pi(t,n._key);throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+tp(n)+".")}function og(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function sg(t,e,n){if(!n.isEqual(e))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}ag.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return wi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ei(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Hr()}},ag.prototype.convertObject=function(t,n){var r=this,i={};return ii(t.fields,function(t,e){i[t]=r.convertValue(e,n)}),i},ag.prototype.convertGeoPoint=function(t){return new Op(wi(t.latitude),wi(t.longitude))},ag.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},ag.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return Ti(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ii(t));default:return null}},ag.prototype.convertTimestamp=function(t){t=bi(t);return new Zr(t.seconds,t.nanos)},ag.prototype.convertDocumentKey=function(t,e){var n=ui.fromString(t);zr(qa(n));t=new Md(n.get(1),n.get(3)),n=new Ni(n.popFirst(5));return t.isEqual(e)||Kr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},I=ag;function ag(){}function ug(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var cg,hg=(n(dg,cg=I),dg.prototype.convertBytes=function(t){return new Rp(t)},dg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new sp(this.firestore,null,t)},dg),lg=(fg.prototype.set=function(t,e,n){this._verifyNotCommitted();t=pg(t,this._firestore),e=ug(t.converter,e,n),n=Wp(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n);return this._mutations.push(n.toMutation(t._key,fs.none())),this},fg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=pg(t,this._firestore),e="string"==typeof(e=v(e))||e instanceof kp?fy(this._dataReader,"WriteBatch.update",t._key,e,n,r):ly(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,fs.exists(!0))),this},fg.prototype.delete=function(t){this._verifyNotCommitted();t=pg(t,this._firestore);return this._mutations=this._mutations.concat(new Rs(t._key,fs.none())),this},fg.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},fg.prototype._verifyNotCommitted=function(){if(this._committed)throw new Vr(Fr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},fg);function fg(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=zp(t)}function dg(t){var e=this;return(e=cg.call(this)||this).firestore=t,e}function pg(t,e){if((t=v(t)).firestore!==e)throw new Vr(Fr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var yg,gg=(n(mg,yg=I),mg.prototype.convertBytes=function(t){return new Rp(t)},mg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new sp(this.firestore,null,t)},mg);function mg(t){var e=this;return(e=yg.call(this)||this).firestore=t,e}function vg(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ep(t,sp);var o=ep(t.firestore,Ip),s=zp(o);return wg(o,[("string"==typeof(e=v(e))||e instanceof kp?fy(s,"updateDoc",t._key,e,n,r):ly(s,"updateDoc",t._key,e)).toMutation(t._key,fs.exists(!0))])}function bg(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e=v(e);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||wp(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return wp(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof sp?(a=ep(e.firestore,Ip),u=ko(e._key.path),h={next:function(t){n[i]&&n[i](Eg(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=ep(e,ap),a=ep(s.firestore,Ip),u=s._query,c=new gg(a),h={next:function(t){n[i]&&n[i](new Ly(a,c,s,t))},error:n[i+1],complete:n[i+2]},qy(e._query)),function(n,t,e){var r=this,i=new dd(h),o=new vf(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=yf,[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=gf,[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Ap(a),u,l)}function wg(t,e){return function(n,r){var t=this,i=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Mf,[4,kd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Ap(t),e)}function Eg(t,e,n){var r=n.docs.get(e._key),i=new gg(t);return new xy(t,i,e._key,r,new Ry(n.hasPendingWrites,n.fromCache),e.converter)}var Tg,Ig=(Sg.prototype.get=function(t){var e=this,n=pg(t,this._firestore),r=new hg(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Hr();t=t[0];if(t.isFoundDocument())return new _y(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new _y(e._firestore,r,n._key,null,n.converter);throw Hr()})},Sg.prototype.set=function(t,e,n){t=pg(t,this._firestore),e=ug(t.converter,e,n),n=Wp(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n);return this._transaction.set(t._key,n),this},Sg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=pg(t,this._firestore),e="string"==typeof(e=v(e))||e instanceof kp?fy(this._dataReader,"Transaction.update",t._key,e,n,r):ly(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Sg.prototype.delete=function(t){t=pg(t,this._firestore);return this._transaction.delete(t._key),this},n(_g,Tg=Sg),_g.prototype.get=function(t){var e=this,n=pg(t,this._firestore),r=new gg(this._firestore);return Tg.prototype.get.call(this,t).then(function(t){return new xy(e._firestore,r,n._key,t._document,new Ry(!1,!1),n.converter)})},_g);function _g(t,e){var n=this;return(n=Tg.call(this,t,e)||this)._firestore=t,n}function Sg(t,e){this._firestore=t,this._transaction=e,this._dataReader=zp(t)}function Ag(){if("undefined"==typeof Uint8Array)throw new Vr(Fr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ng(){if("undefined"==typeof atob)throw new Vr(Fr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Dg,Cg=(Mg.fromBase64String=function(t){return Ng(),new Mg(Rp.fromBase64String(t))},Mg.fromUint8Array=function(t){return Ag(),new Mg(Rp.fromUint8Array(t))},Mg.prototype.toBase64=function(){return Ng(),this._delegate.toBase64()},Mg.prototype.toUint8Array=function(){return Ag(),this._delegate.toUint8Array()},Mg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Mg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Mg),kg=(Pg.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Cp(t=ep(t,Ip));var n=Ap(t),r=t._freezeSettings(),t=new ad;return Dp(n,t,new od(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},Pg.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Cp(t=ep(t,Ip));var e=Ap(t),n=t._freezeSettings(),t=new ad;return Dp(e,t,new sd(t,n.cacheSizeBytes))}(t._delegate)},Pg.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n._initialized&&!n._terminated)throw new Vr(Fr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new hu;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return du.yt()?(e=n+"main",[4,du.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(th(n._databaseId,n._persistenceKey))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},Pg),Rg=(Object.defineProperty(Lg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Lg.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Gr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},Lg.prototype.useEmulator=function(t,e,n){(function(t,e,n,r){void 0===r&&(r={});var i=(t=ep(t,op))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Gr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){n=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=o({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(t),!1),""].join(".")}(r.mockUserToken),r=r.mockUserToken.sub||r.mockUserToken.user_id;if(!r)throw new Vr(Fr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Ud(new Ld(n,new Lh(r)))}})(this._delegate,t,e,n=void 0===n?{}:n)},Lg.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,Nd(i)];case 1:return n=t.sent(),[4,Cd(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Or.delete(0),Vl(e))]}var e})})})}(Ap(ep(this._delegate,Ip)))},Lg.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Nd(r)];case 1:return e=t.sent(),[4,Cd(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(0),[4,Ul(e)];case 1:return t.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Ap(ep(this._delegate,Ip)))},Lg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&$d("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.tu.enableMultiTabIndexedDbPersistence(this):this.tu.enableIndexedDbPersistence(this,n)},Lg.prototype.clearPersistence=function(){return this.tu.clearIndexedDbPersistence(this)},Lg.prototype.terminate=function(){return this.eu&&(this.eu._removeServiceInstance("firestore"),this.eu._removeServiceInstance("firestore-exp")),this._delegate._delete()},Lg.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=qf,[4,kd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Ap(ep(this._delegate,Ip)))},Lg.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new dd(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,Rd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Ap(ep(e,Ip)),wp(t)?t:{next:t});var e},Object.defineProperty(Lg.prototype,"app",{get:function(){if(!this.eu)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.eu},enumerable:!1,configurable:!0}),Lg.prototype.collection=function(t){try{return new em(this,pp(this._delegate,t))}catch(t){throw Qg(t,"collection()","Firestore.collection()")}},Lg.prototype.doc=function(t){try{return new Kg(this,yp(this._delegate,t))}catch(t){throw Qg(t,"doc()","Firestore.doc()")}},Lg.prototype.collectionGroup=function(t){try{return new Jg(this,function(t,e){if(t=ep(t,op),Yd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ap(t,null,(e=e,new Do(ui.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Qg(t,"collectionGroup()","Firestore.collectionGroup()")}},Lg.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,Ad(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new gd(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Ap(n=this._delegate),function(t){return t=new Ig(n,t),e(new Fg(r,t))})},Lg.prototype.batch=function(){var e=this;return Ap(this._delegate),new Vg(new lg(this._delegate,function(t){return wg(e._delegate,t)}))},Lg.prototype.loadBundle=function(t){throw new Vr(Fr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Lg.prototype.namedQuery=function(t){throw new Vr(Fr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Lg),xg=(n(Og,Dg=I),Og.prototype.convertBytes=function(t){return new Cg(new Rp(t))},Og.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return Kg.nu(t,this.firestore,null)},Og);function Og(t){var e=this;return(e=Dg.call(this)||this).firestore=t,e}function Lg(t,e,n){var r=this;this._delegate=e,this.tu=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Md||(this.eu=t)}function Pg(){}function Mg(t){this._delegate=t}var Fg=(jg.prototype.get=function(t){var e=this,n=um(t);return this._delegate.get(n).then(function(t){return new Xg(e._firestore,new xy(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},jg.prototype.set=function(t,e,n){t=um(t);return n?(Xd("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},jg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=um(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},jg.prototype.delete=function(t){t=um(t);return this._delegate.delete(t),this},jg),Vg=(Bg.prototype.set=function(t,e,n){t=um(t);return n?(Xd("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Bg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=um(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Bg.prototype.delete=function(t){t=um(t);return this._delegate.delete(t),this},Bg.prototype.commit=function(){return this._delegate.commit()},Bg),Ug=(qg.prototype.fromFirestore=function(t,e){t=new Oy(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new $g(this._firestore,t),null!=e?e:{})},qg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},qg.su=function(t,e){var n=qg.iu,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new qg(t,new xg(t),e),r.set(e,n)),n},qg);function qg(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function Bg(t){this._delegate=t}function jg(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new xg(t)}Ug.iu=new WeakMap;var Kg=(Gg.ru=function(t,e,n){if(t.length%2!=0)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Gg(e,new sp(e._delegate,n,new Ni(t)))},Gg.nu=function(t,e,n){return new Gg(e,new sp(e._delegate,n,t))},Object.defineProperty(Gg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Gg.prototype,"parent",{get:function(){return new em(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Gg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Gg.prototype.collection=function(t){try{return new em(this.firestore,pp(this._delegate,t))}catch(t){throw Qg(t,"collection()","DocumentReference.collection()")}},Gg.prototype.isEqual=function(t){return(t=v(t))instanceof sp&&gp(this._delegate,t)},Gg.prototype.set=function(t,e){e=Xd("DocumentReference.set",e);try{return function(t,e,n){t=ep(t,sp);var r=ep(t.firestore,Ip),e=ug(t.converter,e,n);return wg(r,[Wp(zp(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,fs.none())])}(this._delegate,t,e)}catch(t){throw Qg(t,"setDoc()","DocumentReference.set()")}},Gg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?vg(this._delegate,t):vg.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw Qg(t,"updateDoc()","DocumentReference.update()")}},Gg.prototype.delete=function(){return wg(ep((t=this._delegate).firestore,Ip),[new Rs(t._key,fs.none())]);var t},Gg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Hg(t),i=zg(t,function(t){return new Xg(e.firestore,new xy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))});return bg(this._delegate,r,i)},Gg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ep(e,sp);var n=ep(e.firestore,Ip),t=Ap(n),r=new gg(n);return function(n,r){var t=this,i=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)}))];case 1:return(i=t.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new Vr(Fr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=sf(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new xy(n,r,e._key,t,new Ry(null!==t&&t.hasLocalMutations,!0),e.converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=ep(e,sp);var n=ep(e.firestore,Ip);return xd(Ap(n),e._key,{source:"server"}).then(function(t){return Eg(n,e,t)})}:function(e){e=ep(e,sp);var n=ep(e.firestore,Ip);return xd(Ap(n),e._key).then(function(t){return Eg(n,e,t)})})(this._delegate).then(function(t){return new Xg(e.firestore,new xy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},Gg.prototype.withConverter=function(t){return new Gg(this.firestore,t?this._delegate.withConverter(Ug.su(this.firestore,t)):this._delegate.withConverter(null))},Gg);function Gg(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xg(t)}function Qg(t,e,n){return t.message=t.message.replace(e,n),t}function Hg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!wp(r))return r}return{}}function zg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=wp(t[0])?t[0]:wp(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Wg,Yg,Xg=(Object.defineProperty(am.prototype,"ref",{get:function(){return new Kg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),am.prototype.data=function(t){return this._delegate.data(t)},am.prototype.get=function(t,e){return this._delegate.get(t,e)},am.prototype.isEqual=function(t){return Uy(this._delegate,t._delegate)},am),$g=(n(sm,Yg=Xg),sm.prototype.data=function(t){return this._delegate.data(t)},sm),Jg=(om.prototype.where=function(t,e,n){try{return new om(this.firestore,By(this._delegate,(r=n,i=e,o=Dy("where",t),new zy(o,i,r))))}catch(t){throw Qg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},om.prototype.orderBy=function(t,e){try{return new om(this.firestore,By(this._delegate,(n=void 0===e?"asc":e,r=Dy("orderBy",t),new Wy(r,n))))}catch(t){throw Qg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},om.prototype.limit=function(t){try{return new om(this.firestore,By(this._delegate,(np("limit",e=t),new Yy("limit",e,"F"))))}catch(t){throw Qg(t,"limit()","Query.limit()")}var e},om.prototype.limitToLast=function(t){try{return new om(this.firestore,By(this._delegate,(np("limitToLast",e=t),new Yy("limitToLast",e,"L"))))}catch(t){throw Qg(t,"limitToLast()","Query.limitToLast()")}var e},om.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new om(this.firestore,By(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Xy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Qg(t,"startAt()","Query.startAt()")}},om.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new om(this.firestore,By(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Xy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Qg(t,"startAfter()","Query.startAfter()")}},om.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new om(this.firestore,By(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $y("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Qg(t,"endBefore()","Query.endBefore()")}},om.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new om(this.firestore,By(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $y("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Qg(t,"endAt()","Query.endAt()")}},om.prototype.isEqual=function(t){return mp(this._delegate,t._delegate)},om.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ep(e,ap);var n=ep(e.firestore,Ip),t=Ap(n),r=new gg(n);return function(n,r){var t=this,i=new hu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,vh(i,o,!0)];case 1:return r=t.sent(),e=new Cf(o,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=sf(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new Ly(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=ep(e,ap);var n=ep(e.firestore,Ip),t=Ap(n),r=new gg(n);return Od(t,e._query,{source:"server"}).then(function(t){return new Ly(n,r,e,t)})}:function(e){e=ep(e,ap);var n=ep(e.firestore,Ip),t=Ap(n),r=new gg(n);return qy(e._query),Od(t,e._query).then(function(t){return new Ly(n,r,e,t)})})(this._delegate).then(function(t){return new tm(e.firestore,new Ly(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},om.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Hg(t),i=zg(t,function(t){return new tm(e.firestore,new Ly(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return bg(this._delegate,r,i)},om.prototype.withConverter=function(t){return new om(this.firestore,t?this._delegate.withConverter(Ug.su(this.firestore,t)):this._delegate.withConverter(null))},om),Zg=(Object.defineProperty(im.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(im.prototype,"doc",{get:function(){return new $g(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(im.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(im.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),im),tm=(Object.defineProperty(rm.prototype,"query",{get:function(){return new Jg(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(rm.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(rm.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(rm.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(rm.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new $g(e._firestore,t)})},enumerable:!1,configurable:!0}),rm.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Zg(e._firestore,t)})},rm.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new $g(r._firestore,t))})},rm.prototype.isEqual=function(t){return Uy(this._delegate,t._delegate)},rm),em=(n(nm,Wg=Jg),Object.defineProperty(nm.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(nm.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(nm.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Kg(this.firestore,t):null},enumerable:!1,configurable:!0}),nm.prototype.doc=function(t){try{return new Kg(this.firestore,void 0===t?yp(this._delegate):yp(this._delegate,t))}catch(t){throw Qg(t,"doc()","CollectionReference.doc()")}},nm.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=ep(e.firestore,Ip),r=yp(e),n=ug(e.converter,n),wg(t,[Wp(zp(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,fs.exists(!1))]).then(function(){return r}).then(function(t){return new Kg(i.firestore,t)})},nm.prototype.isEqual=function(t){return gp(this._delegate,t._delegate)},nm.prototype.withConverter=function(t){return new nm(this.firestore,t?this._delegate.withConverter(Ug.su(this.firestore,t)):this._delegate.withConverter(null))},nm);function nm(t,e){var n=this;return(n=Wg.call(this,t,e)||this).firestore=t,n._delegate=e,n}function rm(t,e){this._firestore=t,this._delegate=e}function im(t,e){this._firestore=t,this._delegate=e}function om(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xg(t)}function sm(){return null!==Yg&&Yg.apply(this,arguments)||this}function am(t,e){this._firestore=t,this._delegate=e}function um(t){return ep(t,sp)}hm.documentId=function(){return new hm(hi.keyField().canonicalString())},hm.prototype.isEqual=function(t){return(t=v(t))instanceof kp&&this._delegate._internalPath.isEqual(t._internalPath)},Se=hm,cm.serverTimestamp=function(){var t=new ry("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new cm(t)},cm.delete=function(){var t=new Xp("deleteField");return t._methodName="FieldValue.delete",new cm(t)},cm.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new iy("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new cm(n)},cm.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new oy("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new cm(n)},cm.increment=function(t){t=new sy("increment",t);return t._methodName="FieldValue.increment",new cm(t)},cm.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},I=cm;function cm(t){this._delegate=t}function hm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(kp.bind.apply(kp,s([void 0],t)))}function lm(t){return e=this._delegate,s=t,n=Ap(e=ep(e,Ip)),t=new Tp,function(n,t,r){var e,i=this,o=(e=s,t=Tl(t),e=function(t){if(t instanceof Uint8Array)return fd(t,void 0);if(t instanceof ArrayBuffer)return fd(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new pd(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=ed,[4,kd(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function fm(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Qe.getNamedQuery(t,e)})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Ap(n=ep(n,Ip)),t).then(function(t){return t?new ap(n,null,t.query):null}).then(function(t){return t?new Jg(e,t):null})}var dm=(pm.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},pm.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},pm.prototype.setServiceProps=function(t){return this.serviceProps=t,this},pm.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},pm);function pm(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var ym,gm,mm={Firestore:Rg,GeoPoint:Op,Timestamp:Zr,Blob:Cg,Transaction:Fg,WriteBatch:Vg,DocumentReference:Kg,DocumentSnapshot:Xg,Query:Jg,QueryDocumentSnapshot:$g,QuerySnapshot:tm,CollectionReference:em,FieldPath:Se,FieldValue:I,setLogLevel:function(t){Ur.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(ym=e.default).INTERNAL.registerComponent(new dm("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Rg(e,new Ip(e,t),new kg)},"PUBLIC").setServiceProps(Object.assign({},mm))),ym.registerVersion("@firebase/firestore","2.3.3"),(gm=Rg).prototype.loadBundle=lm,gm.prototype.namedQuery=fm}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
