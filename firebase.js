!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(n,i){return new Promise(function(r,t){var e=new w(n,i),o=new XMLHttpRequest;o.onload=function(){var t,i,e={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",i=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i)};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;r(new E(n,e))},o.onerror=function(){t(new TypeError("Network request failed"))},o.ontimeout=function(){t(new TypeError("Network request failed"))},o.open(e.method,e.url,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),e.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t,e,n,r=y(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=m(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n,r,i=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function u(t){return Boolean(t&&void 0!==t.length)}function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void c(r.promise,t)}s(r.promise,e)}else(1===n._state?s:c)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void f((r=n,i=t,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=t,h(e)}catch(t){c(e,t)}var r,i}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new l(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!u(e))return i(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){if(!u(i))return e(new TypeError("Promise.race accepts an array"));for(var n=0,r=i.length;n<r;n++)o.resolve(i[n]).then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=n):p.Promise=o;var d,y,m,v="object",g=function(t){return t&&t.Math==Math&&t},b=g(typeof globalThis==v&&globalThis)||g(typeof window==v&&window)||g(typeof self==v&&self)||g(typeof t==v&&t)||Function("return this")(),w=function(t){try{return!!t()}catch(t){return!0}},_=!w(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),E={}.propertyIsEnumerable,T=Object.getOwnPropertyDescriptor,S={f:T&&!E.call({1:2},1)?function(t){var e=T(this,t);return!!e&&e.enumerable}:E},I=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},C={}.toString,N=function(t){return C.call(t).slice(8,-1)},A="".split,k=w(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==N(t)?A.call(t,""):Object(t)}:Object,D=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},R=function(t){return k(D(t))},O=function(t){return"object"==typeof t?null!==t:"function"==typeof t},P=function(t,e){if(!O(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!O(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!O(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!O(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},x={}.hasOwnProperty,M=function(t,e){return x.call(t,e)},L=b.document,F=O(L)&&O(L.createElement),U=function(t){return F?L.createElement(t):{}},q=!_&&!w(function(){return 7!=Object.defineProperty(U("div"),"a",{get:function(){return 7}}).a}),V=Object.getOwnPropertyDescriptor,B={f:_?V:function(t,e){if(t=R(t),e=P(e,!0),q)try{return V(t,e)}catch(t){}if(M(t,e))return I(!S.f.call(t,e),t[e])}},j=function(t){if(!O(t))throw TypeError(String(t)+" is not an object");return t},W=Object.defineProperty,K={f:_?W:function(t,e,n){if(j(t),e=P(e,!0),j(n),q)try{return W(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},Q=_?function(t,e,n){return K.f(t,e,I(1,n))}:function(t,e,n){return t[e]=n,t},H=function(e,n){try{Q(b,e,n)}catch(t){b[e]=n}return n},G=!1,z=e(function(t){var e="__core-js_shared__",n=b[e]||H(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),Y=z("native-function-to-string",Function.toString),X=b.WeakMap,J="function"==typeof X&&/native code/.test(Y.call(X)),$=0,Z=Math.random(),tt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++$+Z).toString(36)},et=z("keys"),nt=function(t){return et[t]||(et[t]=tt(t))},rt={},it=b.WeakMap;if(J){var ot=new it,at=ot.get,st=ot.has,ut=ot.set;d=function(t,e){return ut.call(ot,t,e),e},y=function(t){return at.call(ot,t)||{}},m=function(t){return st.call(ot,t)}}else{var ct=nt("state");rt[ct]=!0,d=function(t,e){return Q(t,ct,e),e},y=function(t){return M(t,ct)?t[ct]:{}},m=function(t){return M(t,ct)}}var ht={set:d,get:y,has:m,enforce:function(t){return m(t)?y(t):d(t,{})},getterFor:function(n){return function(t){var e;if(!O(t)||(e=y(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},lt=e(function(t){var e=ht.get,s=ht.enforce,u=String(Y).split("toString");z("inspectSource",function(t){return Y.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||M(n,"name")||Q(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:Q(t,e,n)):o?t[e]=n:H(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||Y.call(this)})}),ft=b,pt=function(t){return"function"==typeof t?t:void 0},dt=function(t,e){return arguments.length<2?pt(ft[t])||pt(b[t]):ft[t]&&ft[t][e]||b[t]&&b[t][e]},yt=Math.ceil,mt=Math.floor,vt=function(t){return isNaN(t=+t)?0:(0<t?mt:yt)(t)},gt=Math.min,bt=function(t){return 0<t?gt(vt(t),9007199254740991):0},wt=Math.max,_t=Math.min,Et=function(c){return function(t,e,n){var r,i,o,a=R(t),s=bt(a.length),u=(r=s,(i=vt(n))<0?wt(i+r,0):_t(i,r));if(c&&e!=e){for(;u<s;)if((o=a[u++])!=o)return!0}else for(;u<s;u++)if((c||u in a)&&a[u]===e)return c||u||0;return!c&&-1}},Tt={includes:Et(!0),indexOf:Et(!1)}.indexOf,St=function(t,e){var n,r=R(t),i=0,o=[];for(n in r)!M(rt,n)&&M(r,n)&&o.push(n);for(;e.length>i;)M(r,n=e[i++])&&(~Tt(o,n)||o.push(n));return o},It=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ct=It.concat("length","prototype"),Nt={f:Object.getOwnPropertyNames||function(t){return St(t,Ct)}},At={f:Object.getOwnPropertySymbols},kt=dt("Reflect","ownKeys")||function(t){var e=Nt.f(j(t)),n=At.f;return n?e.concat(n(t)):e},Dt=function(t,e){for(var n=kt(e),r=K.f,i=B.f,o=0;o<n.length;o++){var a=n[o];M(t,a)||r(t,a,i(e,a))}},Rt=/#|\.prototype\./,Ot=function(t,e){var n=xt[Pt(t)];return n==Lt||n!=Mt&&("function"==typeof e?w(e):!!e)},Pt=Ot.normalize=function(t){return String(t).replace(Rt,".").toLowerCase()},xt=Ot.data={},Mt=Ot.NATIVE="N",Lt=Ot.POLYFILL="P",Ft=Ot,Ut=B.f,qt=function(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||H(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Ut(n,r))&&a.value:n[r],!Ft(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;Dt(o,i)}(t.sham||i&&i.sham)&&Q(o,"sham",!0),lt(n,r,o,t)}},Vt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Bt=function(r,i,t){if(Vt(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}},jt=function(t){return Object(D(t))},Wt=Array.isArray||function(t){return"Array"==N(t)},Kt=!!Object.getOwnPropertySymbols&&!w(function(){return!String(Symbol())}),Qt=b.Symbol,Ht=z("wks"),Gt=function(t){return Ht[t]||(Ht[t]=Kt&&Qt[t]||(Kt?Qt:tt)("Symbol."+t))},zt=Gt("species"),Yt=function(t,e){var n;return Wt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Wt(n.prototype)?O(n)&&null===(n=n[zt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Xt=[].push,Jt=function(p){var d=1==p,y=2==p,m=3==p,v=4==p,g=6==p,b=5==p||g;return function(t,e,n,r){for(var i,o,a=jt(t),s=k(a),u=Bt(e,n,3),c=bt(s.length),h=0,l=r||Yt,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:Xt.call(f,i)}else if(v)return!1;return g?-1:m||v?v:f}},$t={forEach:Jt(0),map:Jt(1),filter:Jt(2),some:Jt(3),every:Jt(4),find:Jt(5),findIndex:Jt(6)},Zt=Object.keys||function(t){return St(t,It)},te=_?Object.defineProperties:function(t,e){j(t);for(var n,r=Zt(e),i=r.length,o=0;o<i;)K.f(t,n=r[o++],e[n]);return t},ee=dt("document","documentElement"),ne=nt("IE_PROTO"),re="prototype",ie=function(){},oe=function(){var t,e=U("iframe"),n=It.length,r="script";for(e.style.display="none",ee.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),oe=t.F;n--;)delete oe[re][It[n]];return oe()},ae=Object.create||function(t,e){var n;return null!==t?(ie[re]=j(t),n=new ie,ie[re]=null,n[ne]=t):n=oe(),void 0===e?n:te(n,e)};rt[ne]=!0;var se=Gt("unscopables"),ue=Array.prototype;null==ue[se]&&Q(ue,se,ae(null));var ce=function(t){ue[se][t]=!0},he=$t.find,le="find",fe=!0;le in[]&&Array(1)[le](function(){fe=!1}),qt({target:"Array",proto:!0,forced:fe},{find:function(t){return he(this,t,1<arguments.length?arguments[1]:void 0)}}),ce(le);var pe=Function.call,de=function(t,e,n){return Bt(pe,b[t].prototype[e],n)},ye=(de("Array","find"),$t.findIndex),me="findIndex",ve=!0;me in[]&&Array(1)[me](function(){ve=!1}),qt({target:"Array",proto:!0,forced:ve},{findIndex:function(t){return ye(this,t,1<arguments.length?arguments[1]:void 0)}}),ce(me);de("Array","findIndex");var ge,be,we,_e=function(s){return function(t,e){var n,r,i=String(D(t)),o=vt(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}},Ee={codeAt:_e(!1),charAt:_e(!0)},Te=!w(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Se=nt("IE_PROTO"),Ie=Object.prototype,Ce=Te?Object.getPrototypeOf:function(t){return t=jt(t),M(t,Se)?t[Se]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ie:null},Ne=Gt("iterator"),Ae=!1;[].keys&&("next"in(we=[].keys())?(be=Ce(Ce(we)))!==Object.prototype&&(ge=be):Ae=!0),null==ge&&(ge={}),M(ge,Ne)||Q(ge,Ne,function(){return this});var ke={IteratorPrototype:ge,BUGGY_SAFARI_ITERATORS:Ae},De=K.f,Re=Gt("toStringTag"),Oe=function(t,e,n){t&&!M(t=n?t:t.prototype,Re)&&De(t,Re,{configurable:!0,value:e})},Pe={},xe=ke.IteratorPrototype,Me=function(){return this},Le=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return j(t),function(t){if(!O(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),Fe=ke.IteratorPrototype,Ue=ke.BUGGY_SAFARI_ITERATORS,qe=Gt("iterator"),Ve="values",Be="entries",je=function(){return this},We=function(t,e,n,r,i,o,a){var s,u,c;u=r,c=e+" Iterator",(s=n).prototype=ae(xe,{next:I(1,u)}),Oe(s,c,!1),Pe[c]=Me;var h,l,f,p=function(t){if(t===i&&g)return g;if(!Ue&&t in m)return m[t];switch(t){case"keys":case Ve:case Be:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",y=!1,m=t.prototype,v=m[qe]||m["@@iterator"]||i&&m[i],g=!Ue&&v||p(i),b="Array"==e&&m.entries||v;if(b&&(h=Ce(b.call(new t)),Fe!==Object.prototype&&h.next&&(Ce(h)!==Fe&&(Le?Le(h,Fe):"function"!=typeof h[qe]&&Q(h,qe,je)),Oe(h,d,!0))),i==Ve&&v&&v.name!==Ve&&(y=!0,g=function(){return v.call(this)}),m[qe]!==g&&Q(m,qe,g),Pe[e]=g,i)if(l={values:p(Ve),keys:o?g:p("keys"),entries:p(Be)},a)for(f in l)!Ue&&!y&&f in m||lt(m,f,l[f]);else qt({target:e,proto:!0,forced:Ue||y},l);return l},Ke=Ee.charAt,Qe="String Iterator",He=ht.set,Ge=ht.getterFor(Qe);We(String,"String",function(t){He(this,{type:Qe,string:String(t),index:0})},function(){var t,e=Ge(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ke(n,r),e.index+=t.length,{value:t,done:!1})});var ze=function(e,t,n,r){try{return r?t(j(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&j(i.call(e)),t}},Ye=Gt("iterator"),Xe=Array.prototype,Je=function(t){return void 0!==t&&(Pe.Array===t||Xe[Ye]===t)},$e=function(t,e,n){var r=P(e);r in t?K.f(t,r,I(0,n)):t[r]=n},Ze=Gt("toStringTag"),tn="Arguments"==N(function(){return arguments}()),en=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ze))?n:tn?N(e):"Object"==(r=N(e))&&"function"==typeof e.callee?"Arguments":r},nn=Gt("iterator"),rn=function(t){if(null!=t)return t[nn]||t["@@iterator"]||Pe[en(t)]},on=Gt("iterator"),an=!1;try{var sn=0,un={next:function(){return{done:!!sn++}},return:function(){an=!0}};un[on]=function(){return this},Array.from(un,function(){throw 2})}catch(So){}var cn=function(t,e){if(!e&&!an)return!1;var n=!1;try{var r={};r[on]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},hn=!cn(function(t){Array.from(t)});qt({target:"Array",stat:!0,forced:hn},{from:function(t){var e,n,r,i,o=jt(t),a="function"==typeof this?this:Array,s=arguments.length,u=1<s?arguments[1]:void 0,c=void 0!==u,h=0,l=rn(o);if(c&&(u=Bt(u,2<s?arguments[2]:void 0,2)),null==l||a==Array&&Je(l))for(n=new a(e=bt(o.length));h<e;h++)$e(n,h,c?u(o[h],h):o[h]);else for(i=l.call(o),n=new a;!(r=i.next()).done;h++)$e(n,h,c?ze(i,u,[r.value,h],!0):r.value);return n.length=h,n}});ft.Array.from;var ln=Object.assign,fn=!ln||w(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=ln({},t)[n]||Zt(ln({},e)).join("")!=r})?function(t,e){for(var n=jt(t),r=arguments.length,i=1,o=At.f,a=S.f;i<r;)for(var s,u=k(arguments[i++]),c=o?Zt(u).concat(o(u)):Zt(u),h=c.length,l=0;l<h;)s=c[l++],_&&!a.call(u,s)||(n[s]=u[s]);return n}:ln;qt({target:"Object",stat:!0,forced:Object.assign!==fn},{assign:fn});ft.Object.assign;var pn=S.f,dn=function(s){return function(t){for(var e,n=R(t),r=Zt(n),i=r.length,o=0,a=[];o<i;)e=r[o++],_&&!pn.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}},yn={entries:dn(!0),values:dn(!1)},mn=yn.entries;qt({target:"Object",stat:!0},{entries:function(t){return mn(t)}});ft.Object.entries;var vn=yn.values;qt({target:"Object",stat:!0},{values:function(t){return vn(t)}});ft.Object.values;var gn=Gt("match"),bn=function(t){if(O(e=t)&&(void 0!==(n=e[gn])?n:"RegExp"==N(e)))throw TypeError("The method doesn't accept regular expressions");var e,n;return t},wn=Gt("match"),_n="".startsWith,En=Math.min;qt({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[wn]=!1,"/./"[e](n)}catch(t){}}return!1}("startsWith")},{startsWith:function(t){var e=String(D(this));bn(t);var n=bt(En(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return _n?_n.call(e,r,n):e.slice(n,n+r.length)===r}});de("String","startsWith");qt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(D(this)),n="",r=vt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});de("String","repeat");var Tn,Sn=Gt("species"),In=Gt("isConcatSpreadable"),Cn=9007199254740991,Nn="Maximum allowed index exceeded",An=!w(function(){var t=[];return t[In]=!1,t.concat()[0]!==t}),kn=(Tn="concat",!w(function(){var t=[];return(t.constructor={})[Sn]=function(){return{foo:1}},1!==t[Tn](Boolean).foo})),Dn=function(t){if(!O(t))return!1;var e=t[In];return void 0!==e?!!e:Wt(t)};qt({target:"Array",proto:!0,forced:!An||!kn},{concat:function(t){var e,n,r,i,o,a=jt(this),s=Yt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?a:arguments[e],Dn(o)){if(i=bt(o.length),Cn<u+i)throw TypeError(Nn);for(n=0;n<i;n++,u++)n in o&&$e(s,u,o[n])}else{if(Cn<=u)throw TypeError(Nn);$e(s,u++,o)}return s.length=u,s}});var Rn={};Rn[Gt("toStringTag")]="z";var On="[object z]"!==String(Rn)?function(){return"[object "+en(this)+"]"}:Rn.toString,Pn=Object.prototype;On!==Pn.toString&&lt(Pn,"toString",On,{unsafe:!0});var xn=Nt.f,Mn={}.toString,Ln="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Fn={f:function(t){return Ln&&"[object Window]"==Mn.call(t)?function(t){try{return xn(t)}catch(t){return Ln.slice()}}(t):xn(R(t))}},Un={f:Gt},qn=K.f,Vn=function(t){var e=ft.Symbol||(ft.Symbol={});M(e,t)||qn(e,t,{value:Un.f(t)})},Bn=$t.forEach,jn=nt("hidden"),Wn="Symbol",Kn="prototype",Qn=Gt("toPrimitive"),Hn=ht.set,Gn=ht.getterFor(Wn),zn=Object[Kn],Yn=b.Symbol,Xn=b.JSON,Jn=Xn&&Xn.stringify,$n=B.f,Zn=K.f,tr=Fn.f,er=S.f,nr=z("symbols"),rr=z("op-symbols"),ir=z("string-to-symbol-registry"),or=z("symbol-to-string-registry"),ar=z("wks"),sr=b.QObject,ur=!sr||!sr[Kn]||!sr[Kn].findChild,cr=_&&w(function(){return 7!=ae(Zn({},"a",{get:function(){return Zn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=$n(zn,e);r&&delete zn[e],Zn(t,e,n),r&&t!==zn&&Zn(zn,e,r)}:Zn,hr=function(t,e){var n=nr[t]=ae(Yn[Kn]);return Hn(n,{type:Wn,tag:t,description:e}),_||(n.description=e),n},lr=Kt&&"symbol"==typeof Yn.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Yn},fr=function(t,e,n){t===zn&&fr(rr,e,n),j(t);var r=P(e,!0);return j(n),M(nr,r)?(n.enumerable?(M(t,jn)&&t[jn][r]&&(t[jn][r]=!1),n=ae(n,{enumerable:I(0,!1)})):(M(t,jn)||Zn(t,jn,I(1,{})),t[jn][r]=!0),cr(t,r,n)):Zn(t,r,n)},pr=function(e,t){j(e);var n=R(t),r=Zt(n).concat(vr(n));return Bn(r,function(t){_&&!dr.call(n,t)||fr(e,t,n[t])}),e},dr=function(t){var e=P(t,!0),n=er.call(this,e);return!(this===zn&&M(nr,e)&&!M(rr,e))&&(!(n||!M(this,e)||!M(nr,e)||M(this,jn)&&this[jn][e])||n)},yr=function(t,e){var n=R(t),r=P(e,!0);if(n!==zn||!M(nr,r)||M(rr,r)){var i=$n(n,r);return!i||!M(nr,r)||M(n,jn)&&n[jn][r]||(i.enumerable=!0),i}},mr=function(t){var e=tr(R(t)),n=[];return Bn(e,function(t){M(nr,t)||M(rt,t)||n.push(t)}),n},vr=function(t){var e=t===zn,n=tr(e?rr:R(t)),r=[];return Bn(n,function(t){!M(nr,t)||e&&!M(zn,t)||r.push(nr[t])}),r};Kt||(lt((Yn=function(){if(this instanceof Yn)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=tt(t),n=function(t){this===zn&&n.call(rr,t),M(this,jn)&&M(this[jn],e)&&(this[jn][e]=!1),cr(this,e,I(1,t))};return _&&ur&&cr(zn,e,{configurable:!0,set:n}),hr(e,t)})[Kn],"toString",function(){return Gn(this).tag}),S.f=dr,K.f=fr,B.f=yr,Nt.f=Fn.f=mr,At.f=vr,_&&(Zn(Yn[Kn],"description",{configurable:!0,get:function(){return Gn(this).description}}),lt(zn,"propertyIsEnumerable",dr,{unsafe:!0})),Un.f=function(t){return hr(Gt(t),t)}),qt({global:!0,wrap:!0,forced:!Kt,sham:!Kt},{Symbol:Yn}),Bn(Zt(ar),function(t){Vn(t)}),qt({target:Wn,stat:!0,forced:!Kt},{for:function(t){var e=String(t);if(M(ir,e))return ir[e];var n=Yn(e);return ir[e]=n,or[n]=e,n},keyFor:function(t){if(!lr(t))throw TypeError(t+" is not a symbol");if(M(or,t))return or[t]},useSetter:function(){ur=!0},useSimple:function(){ur=!1}}),qt({target:"Object",stat:!0,forced:!Kt,sham:!_},{create:function(t,e){return void 0===e?ae(t):pr(ae(t),e)},defineProperty:fr,defineProperties:pr,getOwnPropertyDescriptor:yr}),qt({target:"Object",stat:!0,forced:!Kt},{getOwnPropertyNames:mr,getOwnPropertySymbols:vr}),qt({target:"Object",stat:!0,forced:w(function(){At.f(1)})},{getOwnPropertySymbols:function(t){return At.f(jt(t))}}),Xn&&qt({target:"JSON",stat:!0,forced:!Kt||w(function(){var t=Yn();return"[null]"!=Jn([t])||"{}"!=Jn({a:t})||"{}"!=Jn(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(O(e)||void 0!==t)&&!lr(t))return Wt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!lr(e))return e}),r[1]=e,Jn.apply(Xn,r)}}),Yn[Kn][Qn]||Q(Yn[Kn],Qn,Yn[Kn].valueOf),Oe(Yn,Wn),rt[jn]=!0,Vn("asyncIterator");var gr=K.f,br=b.Symbol;if(_&&"function"==typeof br&&(!("description"in br.prototype)||void 0!==br().description)){var wr={},_r=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof _r?new br(t):void 0===t?br():br(t);return""===t&&(wr[e]=!0),e};Dt(_r,br);var Er=_r.prototype=br.prototype;Er.constructor=_r;var Tr=Er.toString,Sr="Symbol(test)"==String(br("test")),Ir=/^Symbol\((.*)\)[^)]+$/;gr(Er,"description",{configurable:!0,get:function(){var t=O(this)?this.valueOf():this,e=Tr.call(t);if(M(wr,t))return"";var n=Sr?e.slice(7,-1):e.replace(Ir,"$1");return""===n?void 0:n}}),qt({global:!0,forced:!0},{Symbol:_r})}Vn("hasInstance"),Vn("isConcatSpreadable"),Vn("iterator"),Vn("match"),Vn("matchAll"),Vn("replace"),Vn("search"),Vn("species"),Vn("split"),Vn("toPrimitive"),Vn("toStringTag"),Vn("unscopables"),Oe(Math,"Math",!0),Oe(b.JSON,"JSON",!0);ft.Symbol;Vn("dispose"),Vn("observable"),Vn("patternMatch"),Vn("replaceAll");var Cr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Nr="Array Iterator",Ar=ht.set,kr=ht.getterFor(Nr),Dr=We(Array,"Array",function(t,e){Ar(this,{type:Nr,target:R(t),index:0,kind:e})},function(){var t=kr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");Pe.Arguments=Pe.Array,ce("keys"),ce("values"),ce("entries");var Rr=Gt("iterator"),Or=Gt("toStringTag"),Pr=Dr.values;for(var xr in Cr){var Mr=b[xr],Lr=Mr&&Mr.prototype;if(Lr){if(Lr[Rr]!==Pr)try{Q(Lr,Rr,Pr)}catch(So){Lr[Rr]=Pr}if(Lr[Or]||Q(Lr,Or,xr),Cr[xr])for(var Fr in Dr)if(Lr[Fr]!==Dr[Fr])try{Q(Lr,Fr,Dr[Fr])}catch(So){Lr[Fr]=Dr[Fr]}}}Un.f("iterator");var Ur=!w(function(){return Object.isExtensible(Object.preventExtensions({}))}),qr=e(function(t){var e=K.f,n=tt("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(t){e(t,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!O(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!M(t,n)){if(!i(t))return"F";if(!e)return"E";o(t)}return t[n].objectID},getWeakData:function(t,e){if(!M(t,n)){if(!i(t))return!0;if(!e)return!1;o(t)}return t[n].weakData},onFreeze:function(t){return Ur&&a.REQUIRED&&i(t)&&!M(t,n)&&o(t),t}};rt[n]=!0}),Vr=(qr.REQUIRED,qr.fastKey,qr.getWeakData,qr.onFreeze,e(function(t){var f=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=Bt(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=rn(t)))throw TypeError("Target is not iterable");if(Je(a)){for(s=0,u=bt(t.length);s<u;s++)if((c=r?l(j(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=ze(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}})),Br=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},jr=function(u,t,e,c,r){var h=b[u],i=h&&h.prototype,l=h,f=c?"set":"add",n={},o=function(t){var n=i[t];lt(i,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(r&&!O(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return r&&!O(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(r&&!O(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})};if(Ft(u,"function"!=typeof h||!(r||i.forEach&&!w(function(){(new h).entries().next()}))))l=e.getConstructor(t,u,c,f),qr.REQUIRED=!0;else if(Ft(u,!0)){var a=new l,s=a[f](r?{}:-0,1)!=a,p=w(function(){a.has(1)}),d=cn(function(t){new h(t)}),y=!r&&w(function(){for(var t=new h,e=5;e--;)t[f](e,e);return!t.has(-0)});d||(((l=t(function(t,e){Br(t,l,u);var n,r,i,o,a,s=(n=new h,r=t,i=l,Le&&"function"==typeof(o=r.constructor)&&o!==i&&O(a=o.prototype)&&a!==i.prototype&&Le(n,a),n);return null!=e&&Vr(e,s[f],s,c),s})).prototype=i).constructor=l),(p||y)&&(o("delete"),o("has"),c&&o("get")),(y||s)&&o(f),r&&i.clear&&delete i.clear}return n[u]=l,qt({global:!0,forced:l!=h},n),Oe(l,u),r||e.setStrong(l,u,c),l},Wr=function(t,e,n){for(var r in e)lt(t,r,e[r],n);return t},Kr=Gt("species"),Qr=K.f,Hr=qr.fastKey,Gr=ht.set,zr=ht.getterFor,Yr={getConstructor:function(t,n,r,i){var o=t(function(t,e){Br(t,o,n),Gr(t,{type:n,index:ae(null),first:void 0,last:void 0,size:0}),_||(t.size=0),null!=e&&Vr(e,t[i],t,r)}),s=zr(n),a=function(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Hr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),_?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t},u=function(t,e){var n,r=s(t),i=Hr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Wr(o.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,_?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),_?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=s(this),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!u(this,t)}}),Wr(o.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return a(this,0===t?0:t,e)}}:{add:function(t){return a(this,t=0===t?0:t,t)}}),_&&Qr(o.prototype,"size",{get:function(){return s(this).size}}),o},setStrong:function(t,e,n){var r,i,o=e+" Iterator",a=zr(e),s=zr(o);We(t,e,function(t,e){Gr(this,{type:o,target:t,state:a(t),kind:e,last:void 0})},function(){for(var t=s(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),r=dt(e),i=K.f,_&&r&&!r[Kr]&&i(r,Kr,{configurable:!0,get:function(){return this}})}},Xr=(jr("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yr,!0),ft.Map,function(t){var e,n,r,i,o=arguments.length,a=1<o?arguments[1]:void 0;return Vt(this),(e=void 0!==a)&&Vt(a),null==t?new this:(n=[],e?(r=0,i=Bt(a,2<o?arguments[2]:void 0,2),Vr(t,function(t){n.push(i(t,r++))})):Vr(t,n.push,n),new this(n))});qt({target:"Map",stat:!0},{from:Xr});var Jr=function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)};qt({target:"Map",stat:!0},{of:Jr});var $r=function(){for(var t=j(this),e=Vt(t.delete),n=!0,r=0,i=arguments.length;r<i;r++)n=n&&e.call(t,arguments[r]);return!!n};qt({target:"Map",proto:!0,real:!0,forced:G},{deleteAll:function(){return $r.apply(this,arguments)}});var Zr=function(t){return Map.prototype.entries.call(t)};qt({target:"Map",proto:!0,real:!0,forced:G},{every:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return!Vr(e,function(t,e){if(!r(e,t,n))return Vr.stop()},void 0,!0,!0).stopped}});var ti=Gt("species"),ei=function(t,e){var n,r=j(t).constructor;return void 0===r||null==(n=j(r)[ti])?e:Vt(n)};qt({target:"Map",proto:!0,real:!0,forced:G},{filter:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){r(e,t,n)&&o.call(i,t,e)},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{find:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop(e)},void 0,!0,!0).result}}),qt({target:"Map",proto:!0,real:!0,forced:G},{findKey:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop(t)},void 0,!0,!0).result}}),qt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;Vt(n);var i=Vt(r.has),o=Vt(r.get),a=Vt(r.set);return Vr(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});qt({target:"Map",proto:!0,real:!0,forced:G},{includes:function(i){return Vr(Zr(j(this)),function(t,e){if((n=e)===(r=i)||n!=n&&r!=r)return Vr.stop();var n,r},void 0,!0,!0).stopped}}),qt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Vt(e);var r=Vt(n.set);return Vr(t,function(t){r.call(n,e(t),t)}),n}}),qt({target:"Map",proto:!0,real:!0,forced:G},{keyOf:function(n){return Vr(Zr(j(this)),function(t,e){if(e===n)return Vr.stop(t)},void 0,!0,!0).result}}),qt({target:"Map",proto:!0,real:!0,forced:G},{mapKeys:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){o.call(i,r(e,t,n),e)},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{mapValues:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){o.call(i,t,r(e,t,n))},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{merge:function(t){for(var e=j(this),n=Vt(e.set),r=0;r<arguments.length;)Vr(arguments[r++],n,e,!0);return e}}),qt({target:"Map",proto:!0,real:!0,forced:G},{reduce:function(n){var r,t,i=j(this),e=Zr(i);if(Vt(n),1<arguments.length)r=arguments[1];else{if((t=e.next()).done)throw TypeError("Reduce of empty map with no initial value");r=t.value[1]}return Vr(e,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),qt({target:"Map",proto:!0,real:!0,forced:G},{some:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop()},void 0,!0,!0).stopped}}),qt({target:"Map",proto:!0,real:!0,forced:G},{update:function(t,e){var n=j(this),r=arguments.length;Vt(e);var i=n.has(t);if(!i&&r<3)throw TypeError("Updating absent value");var o=i?n.get(t):Vt(2<r?arguments[2]:void 0)(t,n);return n.set(t,e(o,t,n)),n}});jr("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yr),ft.Set;qt({target:"Set",stat:!0},{from:Xr}),qt({target:"Set",stat:!0},{of:Jr});qt({target:"Set",proto:!0,real:!0,forced:G},{addAll:function(){return function(){for(var t=j(this),e=Vt(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),qt({target:"Set",proto:!0,real:!0,forced:G},{deleteAll:function(){return $r.apply(this,arguments)}});var ni=function(t){return Set.prototype.values.call(t)};qt({target:"Set",proto:!0,real:!0,forced:G},{every:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return!Vr(n,function(t){if(!r(t,t,e))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{difference:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e),r=Vt(n.delete);return Vr(t,function(t){r.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{filter:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(e,dt("Set"))),o=Vt(i.add);return Vr(n,function(t){r(t,t,e)&&o.call(i,t)},void 0,!1,!0),i}}),qt({target:"Set",proto:!0,real:!0,forced:G},{find:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(n,function(t){if(r(t,t,e))return Vr.stop(t)},void 0,!1,!0).result}}),qt({target:"Set",proto:!0,real:!0,forced:G},{intersection:function(t){var e=j(this),n=new(ei(e,dt("Set"))),r=Vt(e.has),i=Vt(n.add);return Vr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isDisjointFrom:function(t){var e=j(this),n=Vt(e.has);return!Vr(t,function(t){if(!0===n.call(e,t))return Vr.stop()}).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isSubsetOf:function(t){var e=function(t){var e=rn(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return j(e.call(t))}(this),n=j(t),r=n.has;return"function"!=typeof r&&(n=new(dt("Set"))(t),r=Vt(n.has)),!Vr(e,function(t){if(!1===r.call(n,t))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isSupersetOf:function(t){var e=j(this),n=Vt(e.has);return!Vr(t,function(t){if(!1===n.call(e,t))return Vr.stop()}).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{join:function(t){var e=j(this),n=ni(e),r=void 0===t?",":String(t),i=[];return Vr(n,i.push,i,!1,!0),i.join(r)}}),qt({target:"Set",proto:!0,real:!0,forced:G},{map:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(e,dt("Set"))),o=Vt(i.add);return Vr(n,function(t){o.call(i,r(t,t,e))},void 0,!1,!0),i}}),qt({target:"Set",proto:!0,real:!0,forced:G},{reduce:function(e){var n,t,r=j(this),i=ni(r);if(Vt(e),1<arguments.length)n=arguments[1];else{if((t=i.next()).done)throw TypeError("Reduce of empty set with no initial value");n=t.value}return Vr(i,function(t){n=e(n,t,t,r)},void 0,!1,!0),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{some:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(n,function(t){if(r(t,t,e))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{symmetricDifference:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e),r=Vt(n.delete),i=Vt(n.add);return Vr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{union:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e);return Vr(t,Vt(n.add),n),n}});var ri=function(t,e){return(ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ii(t,e){function n(){this.constructor=t}ri(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oi=function(){return(oi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ai(o,a,s,u){return new(s||(s=Promise))(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function si(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ui(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ci(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function hi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ci(arguments[e]));return t}var li={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},fi=function(t,e){if(!t)throw pi(e)},pi=function(t){return new Error("Firebase Database ("+li.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},di=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,i>>6&63|128),63&i|128)}return e},yi=function(){function t(){this.byteToCharMap_=null,this.charToByteMap_=null,this.byteToCharMapWebSafe_=null,this.charToByteMapWebSafe_=null,this.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.HAS_NATIVE_SUPPORT="function"==typeof atob}return Object.defineProperty(t.prototype,"ENCODED_VALS",{get:function(){return this.ENCODED_VALS_BASE+"+/="},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ENCODED_VALS_WEBSAFE",{get:function(){return this.ENCODED_VALS_BASE+"-_."},enumerable:!0,configurable:!0}),t.prototype.encodeByteArray=function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},t.prototype.encodeString=function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(di(t),e)},t.prototype.decodeString=function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},t.prototype.decodeStringToByteArray=function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},t.prototype.init_=function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}},t}(),mi=function(t){try{return vi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},vi=new yi;function gi(t){return bi(void 0,t)}function bi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=bi(t[n],e[n]));return t}var wi=function(){function t(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}return t.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},t}();function _i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ei(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_i())}function Ti(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Si(){return!0===li.NODE_ADMIN}var Ii=function(r){function i(t,e){var n=r.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ci.prototype.create),n}return ii(i,r),i}(Error),Ci=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o,a=r[0]||{},s=this.service+"/"+t,u=this.errors[t],c=u?(o=a,u.replace(Ni,function(t,e){var n=o[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",h=this.serviceName+": "+c+" ("+s+").",l=new Ii(s,h);try{for(var f=ui(Object.keys(a)),p=f.next();!p.done;p=f.next()){var d=p.value;"_"!==d.slice(-1)&&(d in l&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),l[d]=a[d])}}catch(t){e={error:t}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(e)throw e.error}}return l},t}();var Ni=/\{\$([^}]+)}/g;function Ai(t){return JSON.parse(t)}function ki(t){return JSON.stringify(t)}var Di=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ai(mi(o[0])||""),n=Ai(mi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}};function Ri(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Oi(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Pi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Mi=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function Li(t,e){var n=new Fi(t,e);return n.subscribe.bind(n)}var Fi=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},t.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){var n,r;if("object"!=typeof t||null===t)return!1;try{for(var i=ui(e),o=i.next();!o.done;o=i.next()){var a=o.value;if(a in t&&"function"==typeof t[a])return!0}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Ui),void 0===r.error&&(r.error=Ui),void 0===r.complete&&(r.complete=Ui);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function Ui(){}var qi=function(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Vi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Bi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Vi(t,e,r)+"must be a valid function.")}function ji(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Vi(t,e,r)+"must be a valid context object.")}var Wi,Ki,Qi=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e};function Hi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Gi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Hi(arguments[e]));return t}(Ki=Wi||(Wi={}))[Ki.DEBUG=0]="DEBUG",Ki[Ki.VERBOSE=1]="VERBOSE",Ki[Ki.INFO=2]="INFO",Ki[Ki.WARN=3]="WARN",Ki[Ki.ERROR=4]="ERROR",Ki[Ki.SILENT=5]="SILENT";var zi,Yi=Wi.INFO,Xi=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Wi.DEBUG:case Wi.VERBOSE:console.log.apply(console,Gi(["["+i+"]  "+t.name+":"],n));break;case Wi.INFO:console.info.apply(console,Gi(["["+i+"]  "+t.name+":"],n));break;case Wi.WARN:console.warn.apply(console,Gi(["["+i+"]  "+t.name+":"],n));break;case Wi.ERROR:console.error.apply(console,Gi(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},Ji=function(){function t(t){this.name=t,this._logLevel=Yi,this._logHandler=Xi}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Wi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Gi([this,Wi.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Gi([this,Wi.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Gi([this,Wi.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Gi([this,Wi.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Gi([this,Wi.ERROR],t))},t}(),$i=((zi={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",zi["bad-app-name"]="Illegal App name: '{$appName}",zi["duplicate-app"]="Firebase App named '{$appName}' already exists",zi["app-deleted"]="Firebase App named '{$appName}' already deleted",zi["duplicate-service"]="Firebase service named '{$appName}' already registered",zi["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",zi),Zi=new Ci("app","Firebase",$i),to="[DEFAULT]",eo=[],no=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=gi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){eo.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){eo=eo.filter(function(t){return t!==e})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var l=this;return new Promise(function(t){l.checkDestroyed_(),t()}).then(function(){var e,t,n,r;l.firebase_.INTERNAL.removeApp(l.name_);var i=[];try{for(var o=ui(Object.keys(l.services_)),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,ui(Object.keys(l.services_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;i.push(l.services_[s][h])}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return Promise.all(i.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){l.isDeleted_=!0,l.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=to),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==to?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;bi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(eo.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),eo=[])},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Zi.create("app-deleted",{appName:this.name_})},t}();no.prototype.name&&no.prototype.options||no.prototype.delete||console.log("dc");var ro="6.3.1";var io=new Ji("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){io.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var oo=self.firebase.SDK_VERSION;oo&&0<=oo.indexOf("LITE")&&io.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ao=function t(){var e=function(a){var s={},u={},c={},h={__esModule:!0,initializeApp:function(t,e){if(void 0===e&&(e={}),"object"!=typeof e||null===e){var n=e;e={name:n}}var r=e;void 0===r.name&&(r.name=to);var i=r.name;if("string"!=typeof i||!i)throw Zi.create("bad-app-name",{appName:String(i)});if(Ri(s,i))throw Zi.create("duplicate-app",{appName:i});var o=new a(t,r,h);return p(s[i]=o,"create"),o},app:l,apps:null,SDK_VERSION:ro,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),u[n])throw Zi.create("duplicate-service",{appName:n});function o(t){if(void 0===t&&(t=l()),"function"!=typeof t[n])throw Zi.create("invalid-app-argument",{appName:n});return t[n]()}return u[n]=t,r&&(c[n]=r,f().forEach(function(t){r("create",t)})),void 0!==e&&bi(o,e),h[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){p(s[t],"delete"),delete s[t]},factories:u,useAsService:d}};function l(t){if(!Ri(s,t=t||to))throw Zi.create("no-app",{appName:t});return s[t]}function f(){return Object.keys(s).map(function(t){return s[t]})}function p(t,e){var n,r;try{for(var i=ui(Object.keys(u)),o=i.next();!o.done;o=i.next()){var a=d(0,o.value);if(null===a)return;c[a]&&c[a](e,t)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}function d(t,e){return"serverAuth"===e?null:e}return h.default=h,Object.defineProperty(h,"apps",{get:f}),l.App=a,h}(no);return e.INTERNAL=oi({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){bi(e,t)},createSubscribe:Li,ErrorFactory:Ci,deepExtend:bi}),e}(),so=ao.initializeApp;ao.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&io.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),so.apply(void 0,t)};var Hh=ao;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e,n,r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:(e=t,n=0,function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}})}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.o),reject:t(this.g)}},s.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.u(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.l(t):this.h(t)}},s.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},s.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.u=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ja(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ja(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ja(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var f=/^[\w+/_-]+[=]{0,2}$/,p=null;function s(){}function d(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function r(t){return null===t}function y(t){return"array"==d(t)}function m(t){var e=d(t);return"array"==e||"object"==e&&"number"==typeof t.length}function v(t){return"function"==d(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),i=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).cd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var L=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},F=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function U(t,e){return 0<=x(t,e)}function q(t,e){var n;return(n=0<=(e=x(t,e)))&&Array.prototype.splice.call(t,e,1),n}function V(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function B(t){return Array.prototype.concat.apply([],arguments)}function j(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var W,K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},Q=/&/g,H=/</g,G=/>/g,z=/"/g,Y=/'/g,X=/\x00/g,J=/[\x00&<>"']/;function $(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}t:{var tt=l.navigator;if(tt){var et=tt.userAgent;if(et){W=et;break t}}W=""}function nt(t){return $(W,t)}function rt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function it(t){for(var e in t)return!1;return!0}function ot(t){var e,n={};for(e in t)n[e]=t[e];return n}var at,st,ut="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ct(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ut.length;o++)n=ut[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ht(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function lt(t){return J.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(Q,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(H,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(G,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(z,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(Y,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(X,"&#0;"))),t}function ft(t){l.setTimeout(function(){throw t},0)}function pt(t,e){st||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);st=function(){t.then(mt)}}else st=function(){var t=mt;!v(l.setImmediate)||l.Window&&l.Window.prototype&&!nt("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(at||(at=function(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!nt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||nt("Trident")||nt("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}()),at(t)):l.setImmediate(t)}}(),dt||(st(),dt=!0),yt.add(t,e)}var dt=!1,yt=new R;function mt(){for(var t;n=e=void 0,n=null,(e=yt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){ft(t)}D(O,t)}var e,n;dt=!1}function vt(t,e){if(this.a=gt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=s)try{var n=this;t.call(e,function(t){Dt(n,bt,t)},function(t){if(!(t instanceof Ft))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Dt(n,wt,t)})}catch(t){Dt(this,wt,t)}}var gt=0,bt=2,wt=3;function _t(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}_t.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Et=new k(function(){return new _t},function(t){t.reset()});function Tt(t,e,n){var r=Et.get();return r.g=t,r.b=e,r.f=n,r}function St(t){if(t instanceof vt)return t;var e=new vt(s);return Dt(e,bt,t),e}function It(n){return new vt(function(t,e){e(n)})}function Ct(t,e,n){Rt(t,e,n,null)||pt(E(e,t))}function Nt(n){return new vt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Eb:!0,value:n}:{Eb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Ct(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function At(t,e){t.b||t.a!=bt&&t.a!=wt||Ot(t),t.f?t.f.next=e:t.b=e,t.f=e}function kt(t,i,o,a){var e=Tt(null,null,null);return e.a=new vt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof Ft?r(t):n(e)}catch(t){r(t)}}:r}),At(e.a.c=t,e),e.a}function Dt(t,e,n){var r,i;t.a==gt&&(t===n&&(e=wt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,Rt(n,t.Lc,t.Mc,t)||(t.i=n,t.a=e,t.c=null,Ot(t),e!=wt||n instanceof Ft||(i=n,(r=t).g=!0,pt(function(){r.g&&Lt.call(null,i)}))))}function Rt(t,e,n,r){if(t instanceof vt)return At(t,Tt(e||s,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(v(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function Ot(t){t.h||(t.h=!0,pt(t.Wb,t))}function Pt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function xt(t,e,n,r){if(n==wt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Mt(e,n,r);else try{e.c?e.g.call(e.f):Mt(e,n,r)}catch(t){Lt.call(null,t)}D(Et,e)}function Mt(t,e,n){e==bt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}vt.prototype.then=function(t,e,n){return kt(this,v(t)?t:null,v(e)?e:null,n)},vt.prototype.$goog_Thenable=!0,(t=vt.prototype).ia=function(t,e){return(t=Tt(t,t,e)).c=!0,At(this,t),this},t.s=function(t,e){return kt(this,null,t,e)},t.cancel=function(t){this.a==gt&&pt(function(){!function t(e,n){if(e.a==gt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==gt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):Pt(r),xt(r,o,wt,n)))}e.c=null}else Dt(e,wt,n)}(this,new Ft(t))},this)},t.Lc=function(t){this.a=gt,Dt(this,bt,t)},t.Mc=function(t){this.a=gt,Dt(this,wt,t)},t.Wb=function(){for(var t;t=Pt(this);)xt(this,t,this.a,this.i);this.h=!1};var Lt=ft;function Ft(t){C.call(this,t)}function Ut(){this.qa=this.qa,this.ja=this.ja}S(Ft,C);var qt=0;function Vt(t){if(!t.qa&&(t.qa=!0,t.va(),0!=qt))t[e]||(t[e]=++i)}function Bt(t){return Bt[" "](t),t}Ut.prototype.qa=!(Ft.prototype.name="cancel"),Ut.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},Bt[" "]=s;var jt,Wt,Kt=nt("Opera"),Qt=nt("Trident")||nt("MSIE"),Ht=nt("Edge"),Gt=Ht||Qt,zt=nt("Gecko")&&!($(W.toLowerCase(),"webkit")&&!nt("Edge"))&&!(nt("Trident")||nt("MSIE"))&&!nt("Edge"),Yt=$(W.toLowerCase(),"webkit")&&!nt("Edge");function Xt(){var t=l.document;return t?t.documentMode:void 0}t:{var Jt="",$t=(Wt=W,zt?/rv:([^\);]+)(\)|;)/.exec(Wt):Ht?/Edge\/([\d\.]+)/.exec(Wt):Qt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Wt):Yt?/WebKit\/(\S+)/.exec(Wt):Kt?/(?:Version)[ \/]?(\S+)/.exec(Wt):void 0);if($t&&(Jt=$t?$t[1]:""),Qt){var Zt=Xt();if(null!=Zt&&Zt>parseFloat(Jt)){jt=String(Zt);break t}}jt=Jt}var te,ee={};function ne(s){return t=s,e=function(){for(var t=0,e=K(String(jt)).split("."),n=K(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Z(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Z(0==o[2].length,0==a[2].length)||Z(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=ee,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var re=l.document;te=re&&Qt?Xt()||("CSS1Compat"==re.compatMode?parseInt(jt,10):5):void 0;var ie=Object.freeze||function(t){return t},oe=!Qt||9<=Number(te),ae=Qt&&!ne("9"),se=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",s,e),l.removeEventListener("test",s,e)}catch(t){}return t}();function ue(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function ce(t,e){if(ue.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(zt){t:{try{Bt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:he[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}ue.prototype.preventDefault=function(){this.Kb=!1},S(ce,ue);var he=ie({2:"touch",3:"pen",4:"mouse"});ce.prototype.preventDefault=function(){ce.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ae)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},ce.prototype.f=function(){return this.a};var le="closure_listenable_"+(1e6*Math.random()|0),fe=0;function pe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++fe,this.oa=this.Ia=!1}function de(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function ye(t){this.src=t,this.a={},this.b=0}function me(t,e){var n=e.type;n in t.a&&q(t.a[n],e)&&(de(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function ve(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}ye.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=ve(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new pe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var ge="closure_lm_"+(1e6*Math.random()|0),be={};function we(t,e,n,r,i){if(r&&r.once)Ee(t,e,n,r,i);else if(y(e))for(var o=0;o<e.length;o++)we(t,e[o],n,r,i);else n=Re(n),t&&t[le]?Pe(t,e,n,g(r)?!!r.capture:!!r,i):_e(t,e,n,!1,r,i)}function _e(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a,s,u=g(i)?!!i.capture:!!i,c=ke(t);if(c||(t[ge]=c=new ye(t)),!(n=c.add(e,n,r,u,o)).proxy)if(a=Ae,r=s=oe?function(t){return a.call(s.src,s.listener,t)}:function(t){if(!(t=a.call(s.src,s.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)se||(i=u),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ie(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function Ee(t,e,n,r,i){if(y(e))for(var o=0;o<e.length;o++)Ee(t,e[o],n,r,i);else n=Re(n),t&&t[le]?xe(t,e,n,g(r)?!!r.capture:!!r,i):_e(t,e,n,!0,r,i)}function Te(t,e,n,r,i){if(y(e))for(var o=0;o<e.length;o++)Te(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=Re(n),t&&t[le]?(t=t.m,(e=String(e).toString())in t.a&&(-1<(n=ve(o=t.a[e],n,r,i))&&(de(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=ke(t))&&(e=t.a[e.toString()],t=-1,e&&(t=ve(e,n,r,i)),(n=-1<t?e[t]:null)&&Se(n))}function Se(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[le])me(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ie(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ke(e))?(me(n,t),0==n.b&&(n.src=null,e[ge]=null)):de(t)}}}function Ie(t){return t in be?be[t]:be[t]="on"+t}function Ce(t,e,n,r){var i=!0;if((t=ke(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Ne(o,r),i=i&&!1!==o)}return i}function Ne(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&Se(t),n.call(r,e)}function Ae(t,e){if(t.oa)return!0;if(oe)return Ne(t,new ce(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new ce(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Ce(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Ce(r[i],t,!1,e),n=n&&o}return n}function ke(t){return(t=t[ge])instanceof ye?t:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(e){return v(e)?e:(e[De]||(e[De]=function(t){return e.handleEvent(t)}),e[De])}function Oe(){Ut.call(this),this.m=new ye(this),(this.Pb=this).Wa=null}function Pe(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function xe(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function Me(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&me(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function Le(t,e,n){if(v(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Fe(n){var r=null;return new vt(function(t,e){-1==(r=Le(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function Ue(t){if(t.S&&"function"==typeof t.S)return t.S();if(h(t))return t.split("");if(m(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function qe(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(m(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function Ve(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ve)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Be(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)je(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(Oe,Ut),Oe.prototype[le]=!0,Oe.prototype.addEventListener=function(t,e,n,r){we(this,t,e,n,r)},Oe.prototype.removeEventListener=function(t,e,n,r){Te(this,t,e,n,r)},Oe.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Pb;var r=t.type||t;if(h(t))t=new ue(t,n);else if(t instanceof ue)t.target=t.target||n;else{var i=t;ct(t=new ue(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=Me(a,r,!0,t)&&i}if(i=Me(a=t.b=n,r,!0,t)&&i,i=Me(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Me(a=t.b=e[o],r,!1,t)&&i;return i},Oe.prototype.va=function(){if(Oe.qb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)de(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=Ve.prototype).S=function(){Be(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return Be(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return je(this.b,t)?this.b[t]:e},t.set=function(t,e){je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ke(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof Ke?(this.h=void 0!==e?e:t.h,Qe(this,t.f),this.i=t.i,this.b=t.b,He(this,t.m),this.c=t.c,Ge(this,pn(t.a)),this.g=t.g):t&&(n=String(t).match(We))?(this.h=!!e,Qe(this,n[1]||"",!0),this.i=$e(n[2]||""),this.b=$e(n[3]||"",!0),He(this,n[4]),this.c=$e(n[5]||"",!0),Ge(this,n[6]||"",!0),this.g=$e(n[7]||"")):(this.h=!!e,this.a=new sn(null,this.h))}function Qe(t,e,n){t.f=n?$e(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ge(t,e,n){var r,i;e instanceof sn?(t.a=e,r=t.a,(i=t.h)&&!r.f&&(un(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(hn(this,e),fn(this,n,t))},r)),r.f=i):(n||(e=Ze(e,on)),t.a=new sn(e,t.h))}function ze(t,e,n){t.a.set(e,n)}function Ye(t,e){return t.a.get(e)}function Xe(t){return t instanceof Ke?new Ke(t):new Ke(t,void 0)}function Je(t,e){var n=new Ke(null,void 0);return Qe(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function $e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return h(t)?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ke.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Ze(n,an)),t.join("")},Ke.prototype.resolve=function(t){var e=new Ke(this),n=!!t.f;n?Qe(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)He(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if($(i,"./")||$(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?Ge(e,pn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function sn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(n){n.a||(n.a=new Ve,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function cn(t){var e=qe(t);if(void 0===e)throw Error("Keys are undefined");var n=new sn(null,void 0);t=Ue(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];y(o)?fn(n,i,o):n.add(i,o)}return n}function hn(t,e){un(t),e=dn(t,e),je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,je((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Be(t)))}function ln(t,e){return un(t),e=dn(t,e),je(t.a.b,e)}function fn(t,e,n){hn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),j(n)),t.b+=n.length)}function pn(t){var e=new sn;return e.c=t.c,t.a&&(e.a=new Ve(t.a),e.b=t.b),e}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=sn.prototype).add=function(t,e){un(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){un(this),this.a.forEach(function(t,e){M(t,function(t){n.call(r,t,e,this)},this)},this)},t.U=function(){un(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){un(this);var e=[];if(h(t))ln(this,t)&&(e=B(e,this.a.get(dn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},t.set=function(t,e){return un(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var yn=!Qt||9<=Number(te);function mn(t,e){this.a=t===bn&&e||"",this.b=gn}function vn(t){return t instanceof mn&&t.constructor===mn&&t.b===gn?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}mn.prototype.na=!0,mn.prototype.ma=function(){return this.a},mn.prototype.toString=function(){return"Const{"+this.a+"}"};var gn={},bn={};function wn(){this.a="",this.b=In}function _n(t){return t instanceof wn&&t.constructor===wn&&t.b===In?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+d(t)),"type_error:TrustedResourceUrl")}function En(t,n){var e,r,i=vn(t);if(!Sn.test(i))throw Error("Invalid TrustedResourceUrl format: "+i);return t=i.replace(Tn,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+i+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof mn?vn(t):encodeURIComponent(String(t))}),e=t,(r=new wn).a=e,r}wn.prototype.na=!0,wn.prototype.ma=function(){return this.a.toString()},wn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Tn=/%{(\w+)}/g,Sn=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,In={};function Cn(){this.a="",this.b=Dn}function Nn(t){return t instanceof Cn&&t.constructor===Cn&&t.b===Dn?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+d(t)),"type_error:SafeUrl")}Cn.prototype.na=!0,Cn.prototype.ma=function(){return this.a.toString()},Cn.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var An=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function kn(t){return t instanceof Cn?t:(t="object"==typeof t&&t.na?t.ma():String(t),An.test(t)||(t="about:invalid#zClosurez"),Rn(t))}var Dn={};function Rn(t){var e=new Cn;return e.a=t,e}function On(){this.a="",this.b=Pn}Rn("about:blank"),On.prototype.na=!0,On.prototype.ma=function(){return this.a.toString()},On.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Pn={};function xn(t){var e=new On;return e.a=t,e}function Mn(t){var e=document;return h(t)?e.getElementById(t):t}function Ln(n,t){rt(t,function(t,e){t&&"object"==typeof t&&t.na&&(t=t.ma()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:Fn.hasOwnProperty(e)?n.setAttribute(Fn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}xn("<!DOCTYPE html>"),xn(""),xn("<br>");var Fn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Un(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!yn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',lt(a.name),'"'),a.type){o.push(' type="',lt(a.type),'"');var s={};ct(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:y(a)?o.className=a.join(" "):Ln(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!m(o)||g(o)&&0<o.nodeType?r(o):M(qn(o)?j(o):o,r)}}(i,o,r),o}function qn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(v(t))return"function"==typeof t.item}return!1}function Vn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(y(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Kn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Kn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Bn,t,e),e.join("")}function Bn(){}var jn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Wn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Kn(t,e){e.push('"',t.replace(Wn,function(t){var e=jn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),jn[t]=e),e}),'"')}function Qn(){var t=hr();return Qt&&!!te&&11==te||/Edge\/\d+/.test(t)}function Hn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function Gn(t,e){e=e||l.window;var n="about:blank";t&&(n=Nn(kn(t)).toString()),e.location.href=n}function zn(t){return!!((t=(t||hr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Yn(t){t=t||l.window;try{t.close()}catch(t){}}function Xn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=hr().toLowerCase(),r&&(e.target=r,$(n,"crios/")&&(e.target="_blank")),sr(hr())==or&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof Cn?n:kn(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var a,s=i.join(",");if((nt("iPhone")&&!nt("iPod")&&!nt("iPad")||nt("iPad")||nt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(s=r.document.createElement("A"),e instanceof Cn||e instanceof Cn||(e="object"==typeof e&&e.na?e.ma():String(e),An.test(e)||(e="about:invalid#zClosurez"),e=Rn(e)),s.href=Nn(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=Nn(e).toString(),s&&(Gt&&$(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=xn('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+lt(t)+'">'),s.document.write((a=t)instanceof On&&a.constructor===On&&a.b===Pn?a.a:(A("expected object of type SafeHtml, got '"+a+"' of type "+d(a)),"type_error:SafeHtml")),s.document.close())):(s=r.open(Nn(e).toString(),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(t){}return s}var Jn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$n=/^[^@]+@[^@]+$/;function Zn(){var e=null;return new vt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},Ee(window,"load",e))}).s(function(t){throw Te(window,"load",e),t})}function tr(t){return t=t||hr(),!("file:"!==yr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function er(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function nr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function rr(){return Hh.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Hh.INTERNAL.hasOwnProperty("node")?"Node":nr()?"Worker":"Browser"}function ir(){var t=rr();return"ReactNative"===t||"Node"===t}var or="Firefox",ar="Chrome";function sr(t){var e=t.toLowerCase();return $(e,"opera/")||$(e,"opr/")||$(e,"opios/")?"Opera":$(e,"iemobile")?"IEMobile":$(e,"msie")||$(e,"trident/")?"IE":$(e,"edge/")?"Edge":$(e,"firefox/")?or:$(e,"silk/")?"Silk":$(e,"blackberry")?"Blackberry":$(e,"webos")?"Webos":!$(e,"safari/")||$(e,"chrome/")||$(e,"crios/")||$(e,"android")?!$(e,"chrome/")&&!$(e,"crios/")||$(e,"edge/")?$(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":ar:"Safari"}var ur={Sc:"FirebaseCore-web",Uc:"FirebaseUI-web"};function cr(t,e){e=e||[];var n,r=[],i={};for(n in ur)i[ur[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=rr())?r=sr(i=hr()):"Worker"===r&&(r=sr(i=hr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function hr(){return l.navigator&&l.navigator.userAgent||""}function lr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function fr(){try{var t=l.localStorage,e=wr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Qn()||!!l.indexedDB}catch(t){return nr()&&!!l.indexedDB}return!1}function pr(){return(dr()||"chrome-extension:"===yr()||tr())&&!ir()&&fr()&&!nr()}function dr(){return"http:"===yr()||"https:"===yr()}function yr(){return l.location&&l.location.protocol||null}function mr(t){return!zn(t=t||hr())&&sr(t)!=or}function vr(t){return void 0===t?null:Vn(t)}function gr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function br(t){if(null!==t)return JSON.parse(t)}function wr(t){return t||Math.floor(1e9*Math.random()).toString()}function _r(t){return"Safari"!=sr(t=t||hr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Er(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Tr(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=hr(),e=rr(),this.b=zn(t)||"ReactNative"===e}function Sr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Ir(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Cr(){return!(!lr("fireauth.oauthhelper",l)&&!lr("fireauth.iframe",l))}Tr.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!dr()&&"chrome-extension:"!==yr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Nr,Ar={};function kr(t){Ar[t]||(Ar[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Dr={};Object.defineProperty(Dr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Dr,"abcd",{configurable:!0,enumerable:!0,value:2}),Nr=2==Dr.abcd}catch(t){Nr=!1}function Rr(t,e,n){Nr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Or(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Rr(t,n,e[n])}function Pr(t){var e={};return Or(e,t),e}function xr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Rr(e,n,xr(t[n]));return e}function Mr(t){var e={},n=t[Fr],r=t[Ur];if(!(t=t[qr])||t!=Lr&&!n)throw Error("Invalid provider user info!");e[Br]=r||null,e[Vr]=n||null,Rr(this,Wr,t),Rr(this,jr,xr(e))}var Lr="EMAIL_SIGNIN",Fr="email",Ur="newEmail",qr="requestType",Vr="email",Br="fromEmail",jr="data",Wr="operation";function Kr(t,e){this.code=Hr+t,this.message=e||Gr[t]||""}function Qr(t){var e=t&&t.code;return e?new Kr(e.substring(Hr.length),t.message):null}S(Kr,Error),Kr.prototype.w=function(){return{code:this.code,message:this.message}},Kr.prototype.toJSON=function(){return this.w()};var Hr="auth/",Gr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function zr(t){var e=t[Zr];if(void 0===e)throw new Kr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Kr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Yr];if(n&&"object"==typeof n){e=n[ni];var r=n[ti];if(n=n[ei],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Kr("argument-error",ti+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Kr("argument-error",ei+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Kr("argument-error",ni+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Kr("missing-android-pkg-name")}}else if(void 0!==n)throw new Kr("argument-error",Yr+" property must be a non null object when specified.");if(this.f=null,(e=t[$r])&&"object"==typeof e){if("string"==typeof(e=e[ri])&&e.length)this.f=e;else if(void 0!==e)throw new Kr("argument-error",ri+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Kr("argument-error",$r+" property must be a non null object when specified.");if(void 0!==(e=t[Jr])&&"boolean"!=typeof e)throw new Kr("argument-error",Jr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Xr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Kr("argument-error",Xr+" property must be a non empty string when specified.");this.i=t||null}var Yr="android",Xr="dynamicLinkDomain",Jr="handleCodeInApp",$r="iOS",Zr="url",ti="installApp",ei="minimumVersion",ni="packageName",ri="bundleId";function ii(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var oi=null,ai=null;function si(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=ai[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!oi){oi={},ai={};for(var t=0;t<65;t++)oi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(ai[oi[t]]=t)&&(ai["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function ui(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function ci(t){return(t=hi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new ui(t):null}function hi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(si(t))}catch(t){}return null}ui.prototype.f=function(){return this.b};var li,fi={Yc:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},$c:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ad:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function pi(t){for(var e in fi)if(fi[e].id===t)return{firebaseEndpoint:(t=fi[e]).bb,secureTokenEndpoint:t.jb};return null}li=pi("__EID__")?"__EID__":void 0;var di="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),yi=["client_id","response_type","scope","redirect_uri","state"],mi={Tc:{Oa:"locale",Ba:500,Aa:600,Pa:"facebook.com",ib:yi},Vc:{Oa:null,Ba:500,Aa:620,Pa:"github.com",ib:yi},Wc:{Oa:"hl",Ba:515,Aa:680,Pa:"google.com",ib:yi},bd:{Oa:"lang",Ba:485,Aa:705,Pa:"twitter.com",ib:di}};function vi(t){for(var e in mi)if(mi[e].Pa==t)return mi[e];return null}function gi(t){var e={};e["facebook.com"]=Ti,e["google.com"]=Ii,e["github.com"]=Si,e["twitter.com"]=Ci;var n=t&&t[wi];try{if(n)return e[n]?new e[n](t):new Ei(t);if(void 0!==t[bi])return new _i(t)}catch(t){}return null}var bi="idToken",wi="providerId";function _i(t){var e=t[wi];if(!e&&t[bi]){var n=ci(t[bi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Rr(this,"providerId",e),Rr(this,"isNewUser",n)}function Ei(t){_i.call(this,t),Rr(this,"profile",xr((t=br(t.rawUserInfo||"{}"))||{}))}function Ti(t){if(Ei.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Si(t){if(Ei.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Rr(this,"username",this.profile&&this.profile.login||null)}function Ii(t){if(Ei.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ci(t){if(Ei.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Rr(this,"username",t.screenName||null)}function Ni(t){this.a=Xe(t)}function Ai(t){var e=Xe(t),n=Ye(e,"link"),r=Ye(Xe(n),"link");return Ye(Xe(e=Ye(e,"deep_link_id")),"link")||e||r||n||t}function ki(){}function Di(t,n){return t.then(function(t){if(t[ba]){var e=ci(t[ba]);if(!e||n!=e.c)throw new Kr("user-mismatch");return t}throw new Kr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Hr+"user-not-found"?new Kr("user-mismatch"):t})}function Ri(t,e){if(!e)throw new Kr("internal-error","failed to construct a credential");this.a=e,Rr(this,"providerId",t),Rr(this,"signInMethod",t)}function Oi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Pi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ri(t.providerId,t.pendingToken)}catch(t){}return null}function xi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Rr(this,"idToken",e.idToken),e.accessToken&&Rr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Rr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Kr("internal-error","failed to construct a credential");Rr(this,"accessToken",e.oauthToken),Rr(this,"secret",e.oauthTokenSecret)}Rr(this,"providerId",t),Rr(this,"signInMethod",n)}function Mi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:cn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Li(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new xi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Fi(t,e){this.Cc=e||[],Or(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(vi(t)||{}).Oa||null,this.ab=null}function Ui(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Kr("argument-error",'SAML provider IDs must be prefixed with "saml."');Fi.call(this,t,[])}function qi(t){Fi.call(this,t,yi),this.a=[]}function Vi(){qi.call(this,"facebook.com")}function Bi(t){if(!t)throw new Kr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Vi).credential({accessToken:e})}function ji(){qi.call(this,"github.com")}function Wi(t){if(!t)throw new Kr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new ji).credential({accessToken:e})}function Ki(){qi.call(this,"google.com"),this.ua("profile")}function Qi(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new Ki).credential({idToken:n,accessToken:e})}function Hi(){Fi.call(this,"twitter.com",di)}function Gi(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Kr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new xi("twitter.com",n,"twitter.com")}function zi(t,e,n){this.a=t,this.c=e,Rr(this,"providerId","password"),Rr(this,"signInMethod",n===Xi.EMAIL_LINK_SIGN_IN_METHOD?Xi.EMAIL_LINK_SIGN_IN_METHOD:Xi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Yi(t){return t&&t.email&&t.password?new zi(t.email,t.password,t.signInMethod):null}function Xi(){Or(this,{providerId:"password",isOAuthProvider:!1})}function Ji(t,e){if(!(e=$i(e)))throw new Kr("argument-error","Invalid email link!");return new zi(t,e,Xi.EMAIL_LINK_SIGN_IN_METHOD)}function $i(t){var e=Ye((t=new Ni(t=Ai(t))).a,"oobCode")||null;return"signIn"===(Ye(t.a,"mode")||null)&&e?e:null}function Zi(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new Kr("internal-error");this.a=t,Rr(this,"providerId","phone"),Rr(this,"signInMethod","phone")}function to(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return M(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new Zi(n)}return null}function eo(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function no(t){try{this.a=t||Hh.auth()}catch(t){throw new Kr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Or(this,{providerId:"phone",isOAuthProvider:!1})}function ro(t,e){if(!t)throw new Kr("missing-verification-id");if(!e)throw new Kr("missing-verification-code");return new Zi({Ua:t,Ta:e})}function io(t){if(t.temporaryProof&&t.phoneNumber)return new Zi({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Qi(o,n);case"facebook.com":return Bi(n);case"github.com":return Wi(n);case"twitter.com":return Gi(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ri(e,a):new xi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new qi(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function oo(t){if(!t.isOAuthProvider)throw new Kr("invalid-oauth-provider")}function ao(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new Kr("invalid-auth-event");if(this.g&&this.a)throw new Kr("invalid-auth-event");if(this.g&&!this.f)throw new Kr("invalid-auth-event")}function so(t){return(t=t||{}).type?new ao(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Qr(t.error),t.postBody):null}function uo(){this.b=null,this.a=[]}S(Ei,_i),S(Ti,Ei),S(Si,Ei),S(Ii,Ei),S(Ci,Ei),Ri.prototype.la=function(t){return Fa(t,Oi(this))},Ri.prototype.b=function(t,e){var n=Oi(this);return n.idToken=e,Ua(t,n)},Ri.prototype.f=function(t,e){return Di(qa(t,Oi(this)),e)},Ri.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},xi.prototype.la=function(t){return Fa(t,Mi(this))},xi.prototype.b=function(t,e){var n=Mi(this);return n.idToken=e,Ua(t,n)},xi.prototype.f=function(t,e){return Di(qa(t,Mi(this)),e)},xi.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Fi.prototype.Da=function(t){return this.zb=ot(t),this},S(Ui,Fi),S(qi,Fi),qi.prototype.ua=function(t){return U(this.a,t)||this.a.push(t),this},qi.prototype.Fb=function(){return j(this.a)},qi.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Kr("argument-error","credential failed: must provide the ID token and/or the access token.");return new xi(this.providerId,n,this.providerId)},S(Vi,qi),Rr(Vi,"PROVIDER_ID","facebook.com"),Rr(Vi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(ji,qi),Rr(ji,"PROVIDER_ID","github.com"),Rr(ji,"GITHUB_SIGN_IN_METHOD","github.com"),S(Ki,qi),Rr(Ki,"PROVIDER_ID","google.com"),Rr(Ki,"GOOGLE_SIGN_IN_METHOD","google.com"),S(Hi,Fi),Rr(Hi,"PROVIDER_ID","twitter.com"),Rr(Hi,"TWITTER_SIGN_IN_METHOD","twitter.com"),zi.prototype.la=function(t){return this.signInMethod==Xi.EMAIL_LINK_SIGN_IN_METHOD?ds(t,Ga,{email:this.a,oobCode:this.c}):ds(t,hs,{email:this.a,password:this.c})},zi.prototype.b=function(t,e){return this.signInMethod==Xi.EMAIL_LINK_SIGN_IN_METHOD?ds(t,za,{idToken:e,email:this.a,oobCode:this.c}):ds(t,is,{idToken:e,email:this.a,password:this.c})},zi.prototype.f=function(t,e){return Di(this.la(t),e)},zi.prototype.w=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Or(Xi,{PROVIDER_ID:"password"}),Or(Xi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Or(Xi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Zi.prototype.la=function(t){return t.Va(eo(this))},Zi.prototype.b=function(t,e){var n=eo(this);return n.idToken=e,ds(t,fs,n)},Zi.prototype.f=function(t,e){var n=eo(this);return n.operation="REAUTH",Di(t=ds(t,ps,n),e)},Zi.prototype.w=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},no.prototype.Va=function(r,i){var o=this.a.c;return St(i.verify()).then(function(t){if(!h(t))throw new Kr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(i.type){case"recaptcha":return(e=o,n={phoneNumber:r,recaptchaToken:t},ds(e,ns,n)).then(function(t){return"function"==typeof i.reset&&i.reset(),t},function(t){throw"function"==typeof i.reset&&i.reset(),t});default:throw new Kr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}var e,n})},Or(no,{PROVIDER_ID:"phone"}),Or(no,{PHONE_SIGN_IN_METHOD:"phone"}),ao.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},ao.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.w()}};var co,ho=null;function lo(t){var e="unauthorized-domain",n=void 0,r=Xe(t);t=r.b,"chrome-extension"==(r=r.f)?n=ht("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=ht("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Kr.call(this,e,n)}function fo(t,e,n){Kr.call(this,t,n),(t=e||{}).Ab&&Rr(this,"email",t.Ab),t.$&&Rr(this,"phoneNumber",t.$),t.credential&&Rr(this,"credential",t.credential)}function po(t){if(t.code){var e=t.code||"";0==e.indexOf(Hr)&&(e=e.substring(Hr.length));var n={credential:io(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new Kr(e,t.message||void 0);return new fo(e,n,t.message)}return null}function yo(){}function mo(t){return t.c||(t.c=t.b())}function vo(){}function go(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function bo(){}function wo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.cc,this),this.a.onerror=_(this.Gb,this),this.a.onprogress=_(this.dc,this),this.a.ontimeout=_(this.hc,this)}function _o(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Eo(t,e,n){this.reset(t,e,n,void 0,void 0)}function To(t){this.f=t,this.b=this.c=this.a=null}function So(t,e){this.name=t,this.value=e}uo.prototype.subscribe=function(t){var n=this;this.a.push(t),this.b||(this.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=lr("universalLinks.subscribe",l))&&t(null,this.b))},uo.prototype.unsubscribe=function(e){V(this.a,function(t){return t==e})},S(lo,Kr),S(fo,Kr),fo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.w();return e&&ct(t,e),t},fo.prototype.toJSON=function(){return this.w()},yo.prototype.c=null,S(vo,yo),vo.prototype.a=function(){var t=go(this);return t?new ActiveXObject(t):new XMLHttpRequest},vo.prototype.b=function(){var t={};return go(this)&&(t[0]=!0,t[1]=!0),t},co=new vo,S(bo,yo),bo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new wo;throw Error("Unsupported browser")},bo.prototype.b=function(){return{}},(t=wo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.cc=function(){this.status=200,this.response=this.responseText=this.a.responseText,_o(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",_o(this,4)},t.hc=function(){this.Gb()},t.dc=function(){this.status=200,_o(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Eo.prototype.a=null,Eo.prototype.reset=function(t,e,n,r,i){delete this.a},So.prototype.toString=function(){return this.name};var Io=new So("SEVERE",1e3),Co=new So("WARNING",900),No=new So("CONFIG",700),Ao=new So("FINE",500);To.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(v(e)&&(e=e()),t=new Eo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var ko,Do={},Ro=null;function Oo(t){var e;if(Ro||(Ro=new To(""),(Do[""]=Ro).c=No),!(e=Do[t])){e=new To(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Oo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Do[t]=e}return e}function Po(t,e){t&&t.log(Ao,e,void 0)}function xo(t){this.f=t}function Mo(t){Oe.call(this),this.u=t,this.readyState=Lo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Oo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(xo,yo),xo.prototype.a=function(){return new Mo(this.f)},xo.prototype.b=(ko={},function(){return ko}),S(Mo,Oe);var Lo=0;function Fo(t){t.c.read().then(t.bc.bind(t)).catch(t.Ma.bind(t))}function Uo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,qo(t)}function qo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Vo(t){Oe.call(this),this.headers=new Ve,this.D=t||null,this.c=!1,this.A=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Bo,this.v=this.O=!1}(t=Mo.prototype).open=function(t,e){if(this.readyState!=Lo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,qo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.gc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Uo(this,!1)),this.readyState=Lo},t.gc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,qo(this)),this.a&&(this.readyState=3,qo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.ec.bind(this),this.Ma.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Fo(this)):t.text().then(this.fc.bind(this),this.Ma.bind(this)))))},t.bc=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Uo(this,!0):qo(this),3==this.readyState&&Fo(this)}},t.fc=function(t){this.a&&(this.response=this.responseText=t,Uo(this,!0))},t.ec=function(t){this.a&&(this.response=t,Uo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(Co,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Uo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Co,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Co,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Vo,Oe);var Bo="";Vo.prototype.b=Oo("goog.net.XhrIo");var jo=/^https?$/i,Wo=["POST","PUT"];function Ko(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.N=n,e.G=!1,e.c=!0,e.a=e.D?e.D.a():co.a(),e.A=e.D?mo(e.D):mo(co),e.a.onreadystatechange=_(e.Jb,e);try{Po(e.b,Zo(e,"Opening Xhr")),e.I=!0,e.a.open(n,String(t),!0),e.I=!1}catch(t){return Po(e.b,Zo(e,"Error opening Xhr: "+t.message)),void Ho(e,t)}t=r||"";var o,a=new Ve(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(m(t)||h(t))M(t,e,void 0);else for(var n=qe(t),r=Ue(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){a.set(e,t)}),i=function(t){t:{for(var e=Qo,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(a.U()),r=l.FormData&&t instanceof l.FormData,!U(Wo,n)||i||r||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.o&&(e.a.responseType=e.o),"withCredentials"in e.a&&e.a.withCredentials!==e.O&&(e.a.withCredentials=e.O);try{Xo(e),0<e.g&&(e.v=(o=e.a,Qt&&ne(9)&&"number"==typeof o.timeout&&void 0!==o.ontimeout),Po(e.b,Zo(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ga,e)):e.u=Le(e.Ga,e.g,e)),Po(e.b,Zo(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Po(e.b,Zo(e,"Send error: "+t.message)),Ho(e,t)}}function Qo(t){return"content-type"==t.toLowerCase()}function Ho(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Go(t),Yo(t)}function Go(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function zo(e){if(e.c&&void 0!==u)if(e.A[1]&&4==Jo(e)&&2==$o(e))Po(e.b,Zo(e,"Local request error detected and ignored"));else if(e.i&&4==Jo(e))Le(e.Jb,0,e);else if(e.dispatchEvent("readystatechange"),4==Jo(e)){Po(e.b,Zo(e,"Request complete")),e.c=!1;try{var t,n=$o(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(We)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!jo.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<Jo(e)?e.a.statusText:""}catch(t){Po(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+$o(e)+"]",Go(e)}}finally{Yo(e)}}}function Yo(e,t){if(e.a){Xo(e);var n=e.a,r=e.A[0]?s:null;e.a=null,e.A=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Io,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function Xo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(l.clearTimeout(t.u),t.u=null)}function Jo(t){return t.a?t.a.readyState:0}function $o(t){try{return 2<Jo(t)?t.a.status:-1}catch(t){return-1}}function Zo(t,e){return e+" ["+t.N+" "+t.l+" "+$o(t)+"]"}function ta(t){var e=la;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.A=this.i=!1,this.h=0,this.b=null,this.m=0}function ea(t,e,n){t.a=!0,t.c=n,t.f=!e,oa(t)}function na(t){if(t.a){if(!t.l)throw new aa(t);t.l=!1}}function ra(t,e,n,r){t.g.push([e,n,r]),t.a&&oa(t)}function ia(t){return F(t.g,function(t){return v(t[1])})}function oa(e){if(e.h&&e.a&&ia(e)){var n=e.h,r=ca[n];r&&(l.clearTimeout(r.a),delete ca[n]),e.h=0}e.b&&(e.b.m--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.u,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ia(e)||(r=!0)}}e.c=n,t&&(s=_(e.o,e,!0),t=_(e.o,e,!1),n instanceof ta?(ra(n,s,t),n.A=!0):n.then(s,t)),r&&(n=new ua(n),ca[n.a]=n,e.h=n.a)}function aa(){C.call(this)}function sa(){C.call(this)}function ua(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Vo.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Po(this.b,Zo(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Po(this.b,Zo(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Yo(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Yo(this,!0)),Vo.qb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?zo(this):this.vc())},t.vc=function(){zo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Bo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Io,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Po(this.b,"Can not get response: "+t.message),null}},ta.prototype.cancel=function(t){if(this.a)this.c instanceof ta&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new sa(this),na(this),ea(this,!1,t))}},ta.prototype.o=function(t,e){this.i=!1,ea(this,t,e)},ta.prototype.then=function(t,e,n){var r,i,o=new vt(function(t,e){r=t,i=e});return ra(this,r,function(t){t instanceof sa?o.cancel():i(t)}),o.then(t,e,n)},ta.prototype.$goog_Thenable=!0,S(aa,C),aa.prototype.message="Deferred has already fired",aa.prototype.name="AlreadyCalledError",S(sa,C),sa.prototype.message="Deferred was canceled",sa.prototype.name="CanceledError",ua.prototype.c=function(){throw delete ca[this.a],this.b};var ca={};function ha(t){var e,n,r,i,o,a=document,s=_n(t).toString(),u=document.createElement("SCRIPT"),c={Lb:u,Ga:void 0},h=new ta(c);return e=window.setTimeout(function(){fa(u,!0);var t=new ya(da,"Timeout reached for loading script "+s);na(h),ea(h,!1,t)},5e3),c.Ga=e,u.onload=u.onreadystatechange=function(){u.readyState&&"loaded"!=u.readyState&&"complete"!=u.readyState||(fa(u,!1,e),na(h),ea(h,!0,null))},u.onerror=function(){fa(u,!0,e);var t=new ya(pa,"Error while loading script "+s);na(h),ea(h,!1,t)},ct(c={},{type:"text/javascript",charset:"UTF-8"}),Ln(u,c),r=t,(n=u).src=_n(r),null===p&&(p=(r=(r=l.document).querySelector&&r.querySelector("script[nonce]"))&&(r=r.nonce||r.getAttribute("nonce"))&&f.test(r)?r:""),(r=p)&&n.setAttribute("nonce",r),(i=a,(o=(i||document).getElementsByTagName("HEAD"))&&0!=o.length?o[0]:i.documentElement).appendChild(u),h}function la(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&fa(t,!0,this.Ga)}}function fa(t,e,n){null!=n&&l.clearTimeout(n),t.onload=s,t.onerror=s,t.onreadystatechange=s,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var pa=0,da=1;function ya(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ma(t){this.f=t}function va(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||wa,this.f=ot(t.secureTokenHeaders||_a),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Ea,this.a=ot(t.firebaseHeaders||Ta),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==rr(),!(n=l.XMLHttpRequest||n&&Hh.INTERNAL.node&&Hh.INTERNAL.node.XMLHttpRequest)&&!nr())throw new Kr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,nr()?this.c=new xo(self):ir()?this.c=new ma(n):this.c=new bo}S(ya,C),S(ma,yo),ma.prototype.a=function(){return new this.f},ma.prototype.b=function(){return{}};var ga,ba="idToken",wa=new Tr(3e4,6e4),_a={"Content-Type":"application/x-www-form-urlencoded"},Ea=new Tr(3e4,6e4),Ta={"Content-Type":"application/json"};function Sa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ia(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Ca(t,e,n,r,i,o,a){var s;(t=!((s=sr(s=hr())!=ar?null:(s=s.match(/\sChrome\/(\d+)/i))&&2==s.length?parseInt(s[1],10):null)&&s<30||Qt&&te&&!(9<te))||nr()?_(t.o,t):(ga||(ga=new vt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Aa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=En(Na,{onload:Aa});ra(ha(n),null,function(){e(Error("CORS_UNSUPPORTED"))},void 0)}}(t,e)})),_(t.l,t)))(e,n,r,i,o,a)}va.prototype.o=function(t,n,e,r,i,o){if(nr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Kr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Vo(this.c);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}Pe(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Po(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),xe(a,"ready",function(){s&&clearTimeout(s),Vt(this)}),xe(a,"timeout",function(){s&&clearTimeout(s),Vt(this),n&&n(null)}),Ko(a,t,e,r,i)};var Na=new mn(bn,"https://apis.google.com/js/client.js?onload=%{onload}"),Aa="__fcb"+Math.floor(1e6*Math.random()).toString();function ka(t){if(!h(t=t.email)||!$n.test(t))throw new Kr("invalid-email")}function Da(t){"email"in t&&ka(t)}function Ra(t){if(!t[ba])throw new Kr("internal-error")}function Oa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Kr("internal-error")}else{if(!t.sessionInfo)throw new Kr("missing-verification-id");if(!t.code)throw new Kr("missing-verification-code")}}va.prototype.l=function(t,n,r,i,o){var a=this;ga.then(function(){window.gapi.client.setApiKey(a.b);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},va.prototype.ob=function(){return ds(this,os,{})},va.prototype.rb=function(t,e){return ds(this,rs,{idToken:t,email:e})},va.prototype.sb=function(t,e){return ds(this,is,{idToken:t,password:e})};var Pa={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function xa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Kr("internal-error")}function Ma(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(ln(t=new sn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function La(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=po(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=po(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=po(t)):t.errorMessage&&(e=ys(t.errorMessage)),e)throw e;if(!t[ba])throw new Kr("internal-error")}function Fa(t,e){return e.returnIdpCredential=!0,ds(t,as,e)}function Ua(t,e){return e.returnIdpCredential=!0,ds(t,us,e)}function qa(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,ds(t,ss,e)}function Va(t){if(!t.oobCode)throw new Kr("invalid-action-code")}(t=va.prototype).tb=function(t,r){var i={idToken:t},o=[];return rt(Pa,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),ds(this,rs,i)},t.lb=function(t,e){return ct(t={requestType:"PASSWORD_RESET",email:t},e),ds(this,$a,t)},t.mb=function(t,e){return ct(t={requestType:"EMAIL_SIGNIN",email:t},e),ds(this,Xa,t)},t.kb=function(t,e){return ct(t={requestType:"VERIFY_EMAIL",idToken:t},e),ds(this,Ja,t)},t.Va=function(t){return ds(this,ls,t)},t.$a=function(t,e){return ds(this,es,{oobCode:t,newPassword:e})},t.Ka=function(t){return ds(this,ja,{oobCode:t})},t.Xa=function(t){return ds(this,Ba,{oobCode:t})};var Ba={endpoint:"setAccountInfo",C:Va,da:"email"},ja={endpoint:"resetPassword",C:Va,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Kr("internal-error")}},Wa={endpoint:"signupNewUser",C:function(t){if(ka(t),!t.password)throw new Kr("weak-password")},J:Ra,R:!0},Ka={endpoint:"createAuthUri"},Qa={endpoint:"deleteAccount",T:["idToken"]},Ha={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],C:function(t){if(!y(t.deleteProvider))throw new Kr("internal-error")}},Ga={endpoint:"emailLinkSignin",T:["email","oobCode"],C:ka,J:Ra,R:!0},za={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],C:ka,J:Ra,R:!0},Ya={endpoint:"getAccountInfo"},Xa={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Kr("internal-error");ka(t)},da:"email"},Ja={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],C:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Kr("internal-error")},da:"email"},$a={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Kr("internal-error");ka(t)},da:"email"},Za={wb:!0,endpoint:"getProjectConfig",Ib:"GET"},ts={wb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new Kr("internal-error")}},es={endpoint:"resetPassword",C:Va,da:"email"},ns={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},rs={endpoint:"setAccountInfo",T:["idToken"],C:Da,R:!0},is={endpoint:"setAccountInfo",T:["idToken"],C:function(t){if(Da(t),!t.password)throw new Kr("weak-password")},J:Ra,R:!0},os={endpoint:"signupNewUser",J:Ra,R:!0},as={endpoint:"verifyAssertion",C:xa,Qa:Ma,J:La,R:!0},ss={endpoint:"verifyAssertion",C:xa,Qa:Ma,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Kr("user-not-found");if(t.errorMessage)throw ys(t.errorMessage);if(!t[ba])throw new Kr("internal-error")},R:!0},us={endpoint:"verifyAssertion",C:function(t){if(xa(t),!t.idToken)throw new Kr("internal-error")},Qa:Ma,J:La,R:!0},cs={endpoint:"verifyCustomToken",C:function(t){if(!t.token)throw new Kr("invalid-custom-token")},J:Ra,R:!0},hs={endpoint:"verifyPassword",C:function(t){if(ka(t),!t.password)throw new Kr("wrong-password")},J:Ra,R:!0},ls={endpoint:"verifyPhoneNumber",C:Oa,J:Ra},fs={endpoint:"verifyPhoneNumber",C:function(t){if(!t.idToken)throw new Kr("internal-error");Oa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",po(t);Ra(t)}},ps={Vb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",C:Oa,J:Ra};function ds(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return It(new Kr("internal-error"));var r,i=e.Ib||"POST";return St(n).then(e.C).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,r,i,o,n){var a=Xe(t.g+e);ze(a,"key",t.b),n&&ze(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&ze(a,u,i[u]);return new vt(function(e,n){Ca(t,a.toString(),function(t){t?t.error?n(ms(t,o||{})):e(t):n(new Kr("network-request-failed"))},r,s?void 0:Vn(gr(i)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Vb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new Kr("internal-error");return r[e.da]})}function ys(t){return ms({error:{errors:[{message:t}],code:400,message:t}})}function ms(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Kr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",ct(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Kr(r[i],e);return!e&&t&&(e=vr(t)),new Kr("internal-error",e)}function vs(t){var o;this.b=t,this.a=null,this.gb=(o=this,(_s||(_s=new vt(function(t,e){function n(){Er(),lr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Er(),e(Error("Network Error"))},timeout:bs.get()})}if(lr("gapi.iframes.Iframe"))t();else if(lr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){lr("gapi.load")?n():e(Error("Network Error"))},St(ha(r=En(gs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw _s=null,t}))).then(function(){return new vt(function(r,i){lr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:lr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},ws.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})}))}var gs=new mn(bn,"https://apis.google.com/js/api.js?onload=%{onload}"),bs=new Tr(3e4,6e4),ws=new Tr(5e3,15e3),_s=null;function Es(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Je(this.i,"/__/auth/iframe"),ze(this.a,"apiKey",this.g),ze(this.a,"appName",this.h),this.b=null,this.c=[]}function Ts(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function Ss(t){try{return Hh.app(t).auth().ya()}catch(t){return[]}}function Is(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function Cs(t){var e,s=Hn();return(e=t,ds(e,Za,{}).then(function(t){return t.authorizedDomains||[]})).then(function(t){t:{var e=Xe(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?Xe(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(Jn.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new lo(Hn())})}function Ns(i){return i.m||(i.m=Zn().then(function(){if(!i.u){var t=i.c,e=i.h,n=Ss(i.b),r=new Es(i.l,i.f,i.b);r.f=t,r.b=e,r.c=j(n||[]),i.u=r.toString()}i.i=new vs(i.u),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");t=r.i,e=function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=so(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",St(e)}return e.status="ERROR",St(e)},t.gb.then(function(){t.a.register("authEvent",e,lr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))});var t,e}(i)})),i.m}function As(t){return t.o||(t.v=t.c?cr(t.c,Ss(t.b)):null,t.o=new va(t.f,pi(t.h),t.v)),t.o}function ks(t,e,n,r,i,o,a,s,u,c){return(t=new Ts(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=ot(u||null),t.f=c,t.toString()}function Ds(t){if(this.a=t||Hh.INTERNAL.reactNative&&Hh.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Kr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Rs(t){this.b=t,this.a={},this.c=_(this.f,this)}Es.prototype.toString=function(){return this.f?ze(this.a,"v",this.f):hn(this.a.a,"v"),this.b?ze(this.a,"eid",this.b):hn(this.a.a,"eid"),this.c.length?ze(this.a,"fw",this.c.join(",")):hn(this.a.a,"fw"),this.a.toString()},Ts.prototype.toString=function(){var t=Je(this.o,"/__/auth/handler");if(ze(t,"apiKey",this.l),ze(t,"appName",this.c),ze(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=Hh.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.ab=n,ze(t,"providerId",this.a.providerId),n=gr((e=this.a).zb))n[r]=n[r].toString();r=e.Cc,n=ot(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),it(n)||ze(t,"customParameters",vr(n))}if("function"==typeof this.a.Fb&&((e=this.a.Fb()).length&&ze(t,"scopes",e.join(","))),this.i?ze(t,"redirectUrl",this.i):hn(t.a,"redirectUrl"),this.g?ze(t,"eventId",this.g):hn(t.a,"eventId"),this.h?ze(t,"v",this.h):hn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!Ye(t,a)&&ze(t,a,this.b[a]);return this.f?ze(t,"eid",this.f):hn(t.a,"eid"),(a=Ss(this.c)).length&&ze(t,"fw",a.join(",")),t.toString()},(t=Is.prototype).Ea=function(e,n,t){var r=new Kr("popup-closed-by-user"),i=new Kr("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){var t,r;(t=o,r={type:"webStorageSupport"},Ns(t).then(function(){return e=t.i,n=r,e.gb.then(function(){return new vt(function(t){e.a.send(n.type,n,t,lr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})});var e,n}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})).then(function(t){t||(e&&Yn(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return n=e,new vt(function(e){return function t(){Fe(2e3).then(function(){if(n&&!n.closed)return t();e()})}()});var n}).then(function(){if(!a)return Fe(t).then(function(){n(r)})})},t.Mb=function(){var t=hr();return!mr(t)&&!_r(t)},t.Hb=function(){return!1},t.Db=function(e,t,n,r,i,o,a){if(!e)return It(new Kr("popup-blocked"));if(a&&!mr())return this.ga().s(function(t){Yn(e),i(t)}),r(),St();this.a||(this.a=Cs(As(this)));var s=this;return this.a.then(function(){var t=s.ga().s(function(t){throw Yn(e),i(t),t});return r(),t}).then(function(){(oo(n),a)||Gn(ks(s.l,s.f,s.b,t,n,null,o,s.c,void 0,s.h),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=Cs(As(this)));var r=this;return this.a.then(function(){oo(e),Gn(ks(r.l,r.f,r.b,t,e,Hn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return Ns(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Kr("network-request-failed")})},t.Ob=function(){return!0},t.wa=function(t){this.g.push(t)},t.La=function(e){V(this.g,function(t){return t==e})},(t=Ds.prototype).get=function(t){return St(this.a.getItem(t)).then(function(t){return t&&br(t)})},t.set=function(t,e){return St(this.a.setItem(t,vr(e)))},t.P=function(t){return St(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Os,Ps=[];function xs(t){this.a=t}function Ms(t){this.c=t,this.b=!1,this.a=[]}function Ls(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return It(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new vt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Fs(r,c),t}).s(function(t){throw Fs(r,c),t})}function Fs(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),V(t.a,function(t){return t==e})}}function Us(){if(!Bs())throw new Kr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=l.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var t,r=this;nr()&&self?(this.m=function(){var e=nr()?self:null;if(M(Ps,function(t){t.b==e&&(n=t)}),!n){var n=new Rs(e);Ps.push(n)}return n}(),this.m.subscribe("keyChanged",function(t,n){return Hs(r).then(function(e){return 0<e.length&&M(r.a,function(t){t(e)}),{keyProcessed:U(e,n.key)}})}),this.m.subscribe("ping",function(){return St(["keyChanged"])})):(t=l.navigator,t&&t.serviceWorker?St().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):St(null)).then(function(t){(r.h=t)&&(r.g=new Ms(new xs(t)),Ls(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&U(t[0].value,"keyChanged")&&(r.u=!0)}).s(function(){}))})}function qs(i){return new vt(function(e,n){var t=i.l.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){var r;(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):(r=i,new vt(function(t,e){var n=r.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})).then(function(){return qs(i)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Vs(t){return t.o||(t.o=qs(t)),t.o}function Bs(){try{return!!l.indexedDB}catch(t){return!1}}function js(t){return t.objectStore("firebaseLocalStorage")}function Ws(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ks(t){return new vt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Qs(t,e){return t.g&&t.h&&((n=l.navigator)&&n.serviceWorker&&n.serviceWorker.controller||null)===t.h?Ls(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):St();var n}function Hs(r){return Vs(r).then(function(t){var i=js(Ws(t,!1));return i.getAll?Ks(i.getAll()):new vt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function Gs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function zs(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=St().then(function(){if(Bs()){var e=wr(),n="__sak"+e;return Os||(Os=new Us),(i=Os).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.P(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.Y(function(e){M(r.a,function(t){t(e)})}),t})}function Ys(){this.a={},this.type="inMemory"}function Xs(){if(!function(){var t="Node"==rr();if(!(t=Js()||t&&Hh.INTERNAL.node&&Hh.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==rr())throw new Kr("internal-error","The LocalStorage compatibility library was not found.");throw new Kr("web-storage-unsupported")}this.a=Js()||Hh.INTERNAL.node.localStorage,this.type="localStorage"}function Js(){try{var t=l.localStorage,e=wr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function $s(){this.type="nullStorage"}function Zs(){if(!function(){var t="Node"==rr();if(!(t=tu()||t&&Hh.INTERNAL.node&&Hh.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==rr())throw new Kr("internal-error","The SessionStorage compatibility library was not found.");throw new Kr("web-storage-unsupported")}this.a=tu()||Hh.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function tu(){try{var t=l.sessionStorage,e=wr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function eu(){var t={};t.Browser=iu,t.Node=ou,t.ReactNative=au,t.Worker=su,this.a=t[rr()]}Rs.prototype.f=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];M(t,function(t){e.push(St().then(function(){return t(n.origin,n.data.data)}))}),Nt(e).then(function(t){var e=[];M(t,function(t){e.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),M(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},Rs.prototype.subscribe=function(t,e){it(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},Rs.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(V(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],it(this.a)&&this.b.removeEventListener("message",this.c)},xs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ms.prototype.close=function(){for(;0<this.a.length;)Fs(this,this.a[0]);this.b=!0},(t=Us.prototype).set=function(n,r){var i,o=!1,a=this;return Vs(this).then(function(t){return Ks((t=js(Ws(i=t,!0))).get(n))}).then(function(t){var e=js(Ws(i,!0));return t?(t.value=r,Ks(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,Ks(e.add(t)))}).then(function(){return a.c[n]=r,Qs(a,n)}).ia(function(){o&&a.b--})},t.get=function(e){return Vs(this).then(function(t){return Ks(js(Ws(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.P=function(e){var n=!1,r=this;return Vs(this).then(function(t){return n=!0,r.b++,Ks(js(Ws(t,!0)).delete(e))}).then(function(){return delete r.c[e],Qs(r,e)}).ia(function(){n&&r.b--})},t.Y=function(t){var n;0==this.a.length&&(Gs(n=this),function e(){n.f=setTimeout(function(){n.i=Hs(n).then(function(e){0<e.length&&M(n.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()),this.a.push(t)},t.ca=function(e){V(this.a,function(t){return t==e}),0==this.a.length&&Gs(this)},(t=zs.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.P=function(e){return this.b.then(function(t){return t.P(e)})},t.Y=function(t){this.a.push(t)},t.ca=function(e){V(this.a,function(t){return t==e})},(t=Ys.prototype).get=function(t){return St(this.a[t])},t.set=function(t,e){return this.a[t]=e,St()},t.P=function(t){return delete this.a[t],St()},t.Y=function(){},t.ca=function(){},(t=Xs.prototype).get=function(t){var e=this;return St().then(function(){return br(e.a.getItem(t))})},t.set=function(e,n){var r=this;return St().then(function(){var t=vr(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return St().then(function(){e.a.removeItem(t)})},t.Y=function(t){l.window&&we(l.window,"storage",t)},t.ca=function(t){l.window&&Te(l.window,"storage",t)},(t=$s.prototype).get=function(){return St(null)},t.set=function(){return St()},t.P=function(){return St()},t.Y=function(){},t.ca=function(){},(t=Zs.prototype).get=function(t){var e=this;return St().then(function(){return br(e.a.getItem(t))})},t.set=function(e,n){var r=this;return St().then(function(){var t=vr(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return St().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var nu,ru,iu={B:Xs,Sa:Zs},ou={B:Xs,Sa:Zs},au={B:Ds,Sa:$s},su={B:Xs,Sa:$s},uu={Xc:"local",NONE:"none",Zc:"session"};function cu(){var t=!(_r(hr())||!er()),e=mr(),n=fr();this.o=t,this.h=e,this.m=n,this.a={},nu||(nu=new eu),t=nu;try{this.g=!Qn()&&Cr()||!l.indexedDB?new t.a.B:new zs(nr()?new Ys:new t.a.B)}catch(t){this.g=new Ys,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new Ys}this.l=new Ys,this.f=_(this.Nb,this),this.b={}}function hu(){return ru||(ru=new cu),ru}function lu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function fu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function pu(t,e,n){return n=fu(e,n),"local"==e.B&&(t.b[n]=null),lu(t,e.B).P(n)}function du(t){t.c&&(clearInterval(t.c),t.c=null)}function yu(t){this.a=t,this.b=hu()}(t=cu.prototype).get=function(t,e){return lu(this,t.B).get(fu(t,e))},t.set=function(e,t,n){var r=fu(e,n),i=this,o=lu(this,e.B);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.B&&(i.b[r]=t)})},t.addListener=function(t,e,n){var r;t=fu(t,e),this.m&&(this.b[t]=l.localStorage.getItem(t)),it(this.a)&&(lu(this,"local").Y(this.f),this.h||(Qn()||!Cr())&&l.indexedDB||!this.m||(du(r=this),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new ce({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Nb(e))}},1e3))),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=fu(t,e),this.a[t]&&(V(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),it(this.a)&&(lu(this,"local").ca(this.f),du(this))},t.Nb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Ya(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?lu(this,"local").ca(this.f):du(this),this.o)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Ya(e))},Qt&&te&&10==te&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else M(t,_(this.Ya,this))},t.Ya=function(t){this.a[t]&&M(this.a[t],function(t){t()})};var mu,vu={name:"authEvent",B:"local"};function gu(){this.a=hu()}function bu(t,e){this.b=wu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=l.Int32Array?new Int32Array(64):Array(64),void 0!==mu||(mu=l.Int32Array?new Int32Array(Nu):Nu),this.reset()}S(bu,function(){this.b=-1});for(var wu=64,_u=wu-1,Eu=[],Tu=0;Tu<_u;Tu++)Eu[Tu]=0;var Su=B(128,Eu);function Iu(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|mu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Cu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Iu(t),i=0);else{if(!m(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Iu(t),i=0)}}t.c=i,t.g+=n}bu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):j(this.h)};var Nu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Au(){bu.call(this,8,ku)}S(Au,bu);var ku=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Du(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new gu,this.g=new yu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Ru(t){return new Kr("invalid-cordova-configuration",t)}function Ou(t){var e=new Au;Cu(e,t),t=[];var n=8*e.g;e.c<56?Cu(e,Su,56-e.c):Cu(e,Su,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Iu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return L(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}function Pu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function xu(r){return r.f||(r.f=r.ga().then(function(){return new vt(function(n){r.wa(function t(e){return n(e),r.La(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Mu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Ai(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=br(Ye(n=Xe(e),"firebaseError")||null))?Qr(n):null)?new ao(t.c,t.b,null,null,n):new ao(t.c,t.b,e,t.f)),e=n||o}Pu(i,e)})}var o=new ao("unknown",null,null,null,new Kr("no-auth-event")),t=!1,n=Fe(500).then(function(){return Mu(i).then(function(){t||Pu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(lr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},ho||(ho=new uo),ho.subscribe(e)}(r)})})),r.f}function Mu(e){var t,n=null;return(t=e.g,t.b.get(vu,t.a).then(function(t){return so(t)})).then(function(t){return n=t,pu((t=e.g).b,vu,t.a)}).then(function(){return n})}function Lu(t){this.a=t,this.b=hu()}(t=Du.prototype).ga=function(){return this.za?this.za:this.za=(tr(void 0)?Zn().then(function(){return new vt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):It(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof lr("universalLinks.subscribe",l))throw Ru("cordova-universal-links-plugin-fix is not installed");if(void 0===lr("BuildInfo.packageName",l))throw Ru("cordova-plugin-buildinfo is not installed");if("function"!=typeof lr("cordova.plugins.browsertab.openUrl",l))throw Ru("cordova-plugin-browsertab is not installed");if("function"!=typeof lr("cordova.InAppBrowser.open",l))throw Ru("cordova-plugin-inappbrowser is not installed")},function(){throw new Kr("cordova-not-ready")})},t.Ea=function(t,e){return e(new Kr("operation-not-supported-in-this-environment")),St()},t.Db=function(){return It(new Kr("operation-not-supported-in-this-environment"))},t.Ob=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,n){if(this.c)return It(new Kr("redirect-operation-pending"));var r=this,i=l.document,o=null,a=null,s=null,u=null;return this.c=St().then(function(){return oo(e),xu(r)}).then(function(){return function(n,t,e,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new ao(t,r,null,i,new Kr("no-auth-event")),a=lr("BuildInfo.packageName",l);if("string"!=typeof a)throw new Kr("invalid-cordova-configuration");var s=lr("BuildInfo.displayName",l),u={};if(hr().toLowerCase().match(/iphone|ipad|ipod/))u.ibi=a;else{if(!hr().toLowerCase().match(/android/))return It(new Kr("operation-not-supported-in-this-environment"));u.apn=a}s&&(u.appDisplayName=s),i=Ou(i),u.sessionId=i;var c=ks(n.l,n.i,n.m,t,e,null,r,n.o,u,n.u);return n.ga().then(function(){var t=n.h;return n.v.a.set(vu,o.w(),t)}).then(function(){var t=lr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Kr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=lr("cordova.plugins.browsertab.openUrl",l)))throw new Kr("invalid-cordova-configuration");e(c)}else{if("function"!=typeof(e=lr("cordova.InAppBrowser.open",l)))throw new Kr("invalid-cordova-configuration");t=hr(),n.a=e(c,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new vt(function(e,t){a=function(){var t=lr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(a),s=function(){o||(o=Fe(2e3).then(function(){t(new Kr("redirect-cancelled-by-user"))}))},u=function(){Sr()&&s()},i.addEventListener("resume",s,!1),hr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",u,!1)}).s(function(t){return Mu(r).then(function(){throw t})})}).ia(function(){s&&i.removeEventListener("resume",s,!1),u&&i.removeEventListener("visibilitychange",u,!1),o&&o.cancel(),a&&r.La(a),r.c=null})},t.wa=function(e){this.b.push(e),xu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new ao("unknown",null,null,null,new Kr("no-auth-event")),e(t))})},t.La=function(e){V(this.b,function(t){return t==e})};var Fu={name:"pendingRedirect",B:"session"};function Uu(t){return pu(t.b,Fu,t.a)}function qu(t,e,n){this.i={},this.u=0,this.A=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=_(this.cb,this),this.b=new Yu,this.v=new Zu,this.g=new Lu(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.v,this.c.linkViaPopup=this.v,this.c.reauthViaPopup=this.v,this.a=Vu(this.A,this.l,this.o,li)}function Vu(t,e,n,r){var i=Hh.SDK_VERSION||null;return tr()?new Du(t,e,n,i,r):new Is(t,e,n,i,r)}function Bu(e){e.f||(e.f=!0,e.a.wa(e.m));var n=e.a;return e.a.ga().s(function(t){throw e.a==n&&e.reset(),t})}function ju(n){n.a.Mb()&&Bu(n).s(function(t){var e=new ao("unknown",null,null,null,new Kr("operation-not-supported-in-this-environment"));Hu(t)&&n.cb(e)}),n.a.Hb()||Xu(n.b)}(t=qu.prototype).reset=function(){this.f=!1,this.a.La(this.m),this.a=Vu(this.A,this.l,this.o),this.i={}},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(U(this.h,t)||this.h.push(t),!this.f){var n=this;(e=this.g,e.b.get(Fu,e.a).then(function(t){return"pending"==t})).then(function(t){t?Uu(n.g).then(function(){Bu(n).s(function(t){var e=new ao("unknown",null,null,null,new Kr("operation-not-supported-in-this-environment"));Hu(t)&&n.cb(e)})}):ju(n)}).s(function(){ju(n)})}var e},t.unsubscribe=function(e){V(this.h,function(t){return t==e})},t.cb=function(t){if(!t)throw new Kr("invalid-auth-event");if(6e5<=T()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=T())),e=!0;break}}return Xu(this.b),e};var Wu=new Tr(2e3,1e4),Ku=new Tr(3e4,6e4);function Qu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function Hu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}qu.prototype.fa=function(){return this.b.fa()},qu.prototype.Ca=function(t,e,n){var r,i,o=this;return(i=this.g,i.b.set(Fu,"pending",i.a)).then(function(){return o.a.Ca(t,e,n).s(function(t){if(Hu(t))throw new Kr("operation-not-supported-in-this-environment");return r=t,Uu(o.g).then(function(){throw r})}).then(function(){return o.a.Ob()?new vt(function(){}):Uu(o.g).then(function(){return o.fa()}).then(function(){}).s(function(){})})})},qu.prototype.Ea=function(e,n,t,r){return this.a.Ea(t,function(t){e.ha(n,null,t,r)},Wu.get())};var Gu={};function zu(t,e,n){var r=e+":"+n;return Gu[r]||(Gu[r]=new qu(t,e,n)),Gu[r]}function Yu(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Xu(t){t.g||(t.g=!0,$u(t,!1,null,null))}function Ju(t,e){if(t.b=function(){return St(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function $u(t,e,n,r){e?r?function(t,e){if(t.b=function(){return It(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):Ju(t,n):Ju(t,{user:null}),t.f=[],t.c=[]}function Zu(){}function tc(){this.ub=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.ub},set:function(t){this.ub=t},enumerable:!1})}function ec(t,e){this.a=e,Rr(this,"verificationId",t)}function nc(t,e,n,r){return new no(t).Va(e,n).then(function(t){return new ec(t,r)})}function rc(t){var e=hi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Kr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Or(this,{token:t,expirationTime:Ir(1e3*e.exp),authTime:Ir(1e3*e.auth_time),issuedAtTime:Ir(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function ic(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function oc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function ac(t){this.f=t,this.b=this.a=null,this.c=0}function sc(t,e){var n=e[ba],r=e.refreshToken;e=uc(e.expiresIn),t.b=n,t.c=e,t.a=r}function uc(t){return T()+1e3*parseInt(t,10)}function cc(e,t){return(r=e.f,i=t,new vt(function(e,n){"refresh_token"==i.grant_type&&i.refresh_token||"authorization_code"==i.grant_type&&i.code?Ca(r,r.i+"?key="+encodeURIComponent(r.b),function(t){t?t.error?n(ms(t)):t.access_token&&t.refresh_token?e(t):n(new Kr("internal-error")):n(new Kr("network-request-failed"))},"POST",cn(i).toString(),r.f,r.m.get()):n(new Kr("internal-error"))})).then(function(t){return e.b=t.access_token,e.c=uc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t});var r,i}function hc(t,e){this.a=t||null,this.b=e||null,Or(this,{lastSignInTime:Ir(e||null),creationTime:Ir(t||null)})}function lc(t,e,n,r,i,o){Or(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function fc(t,e){for(var n in ue.call(this,t),e)this[n]=e[n]}function pc(t,e,n){var r;this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=Hh.SDK_VERSION?cr(Hh.SDK_VERSION):null,this.c=new va(this.l,pi(li),t),this.h=new ac(this.c),wc(this,e[ba]),sc(this.h,e),Rr(this,"refreshToken",this.h.a),Tc(this,n||{}),Oe.call(this),this.I=!1,this.u&&pr()&&(this.a=zu(this.u,this.l,this.o)),this.N=[],this.i=null,this.A=(r=this,new ic(function(){return r.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=r.h.c-T()-3e5;return 0<t?t:0})),this.V=_(this.Ha,this);var i=this;this.ka=null,this.ta=function(t){i.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){yc(i,t.c)},this.W=null}function dc(t,e){t.X&&Te(t.X,"languageCodeChanged",t.ta),(t.X=e)&&we(e,"languageCodeChanged",t.ta)}function yc(t,e){t.O=e,Ia(t.c,Hh.SDK_VERSION?cr(Hh.SDK_VERSION,t.O):null)}function mc(t,e){t.W&&Te(t.W,"frameworkChanged",t.sa),(t.W=e)&&we(e,"frameworkChanged",t.sa)}function vc(e){try{return Hh.app(e.o).auth()}catch(t){throw new Kr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.o+"'!")}}function gc(t){t.D||t.A.b||(t.A.start(),Te(t,"tokenChanged",t.V),we(t,"tokenChanged",t.V))}function bc(t){Te(t,"tokenChanged",t.V),t.A.stop()}function wc(t,e){t.ra=e,Rr(t,"_lat",e)}function _c(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return Nt(e).then(function(){return t})}function Ec(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function Tc(t,e){Or(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new hc(e.createdAt,e.lastLoginAt),providerData:[]})}function Sc(){}function Ic(t){return St().then(function(){if(t.D)throw new Kr("app-deleted")})}function Cc(t){return L(t.providerData,function(t){return t.providerId})}function Nc(t,e){e&&(Ac(t,e.providerId),t.providerData.push(e))}function Ac(t,e){V(t.providerData,function(t){return t.providerId==e})}function kc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Rr(t,e,n)}function Dc(e,t){var n,r,i;e!=t&&(Or(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,providerData:[]}),t.metadata?Rr(e,"metadata",new hc((i=t.metadata).a,i.b)):Rr(e,"metadata",new hc),M(t.providerData,function(t){Nc(e,t)}),n=e.h,r=t.h,n.b=r.b,n.a=r.a,n.c=r.c,Rr(e,"refreshToken",e.h.a))}function Rc(i){return i.F().then(function(t){var e,n,r=i.isAnonymous;return(e=i,n=t,ds(e.c,Ya,{idToken:n}).then(_(e.wc,e))).then(function(){return r||kc(i,"isAnonymous",!1),t})})}function Oc(t,e){e[ba]&&t.ra!=e[ba]&&(sc(t.h,e),t.dispatchEvent(new fc("tokenChanged")),wc(t,e[ba]),kc(t,"refreshToken",t.h.a))}function Pc(t,e){return Rc(t).then(function(){if(U(Cc(t),e))return _c(t).then(function(){throw new Kr("provider-already-linked")})})}function xc(t,e,n){return Pr({user:t,credential:io(e),additionalUserInfo:e=gi(e),operationType:n})}function Mc(t,e){return Oc(t,e),t.reload().then(function(){return t})}function Lc(n,r,t,e,i){if(!pr())return It(new Kr("operation-not-supported-in-this-environment"));if(n.i&&!i)return It(n.i);var o=vi(t.providerId),a=wr(n.uid+":::"),s=null;(!mr()||er())&&n.u&&t.isOAuthProvider&&(s=ks(n.u,n.l,n.o,r,t,null,a,Hh.SDK_VERSION||null));var u=Xn(s,o&&o.Ba,o&&o.Aa);return e=e().then(function(){if(Uc(n),!i)return n.F().then(function(){})}).then(function(){return Qu(n.a,u,r,t,a,!!s)}).then(function(){return new vt(function(t,e){n.ha(r,null,new Kr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.b=n.a.Ea(n,r,u,a)})}).then(function(t){return u&&Yn(u),t?Pr(t):null}).s(function(t){throw u&&Yn(u),t}),qc(n,e,i)}function Fc(e,t,n,r,i){if(!pr())return It(new Kr("operation-not-supported-in-this-environment"));if(e.i&&!i)return It(e.i);var o=null,a=wr(e.uid+":::");return r=r().then(function(){if(Uc(e),!i)return e.F().then(function(){})}).then(function(){return e.aa=a,_c(e)}).then(function(t){return e.ba&&(t=(t=e.ba).b.set(jc,e.w(),t.a)),t}).then(function(){return e.a.Ca(t,n,a)}).s(function(t){if(o=t,e.ba)return Wc(e.ba);throw o}).then(function(){if(o)throw o}),qc(e,r,i)}function Uc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new Kr("internal-error");throw new Kr("auth-domain-config-required")}}function qc(t,e,n){var r,i,o,a=(i=e,o=n,(r=t).i&&!o?(i.cancel(),It(r.i)):i.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(r.i||r.dispatchEvent(new fc("userInvalidated")),r.i=t),t}));return t.G.push(a),a.ia(function(){q(t.G,a)}),a}function Vc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[ba]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new pc(e,n,t);return t.providerData&&M(t.providerData,function(t){t&&Nc(r,Pr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Bc(t){this.a=t,this.b=hu()}Yu.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Yu.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?($u(this,!0,null,t.a),St()):e.xa(n,r)?function(e,t,n){n=n.xa(t.c,t.b);var r=t.g,i=t.f,o=t.h,a=!!t.c.match(/Redirect$/);n(r,i,o).then(function(t){$u(e,a,t,null)}).s(function(t){$u(e,a,null,t)})}(this,t,e):It(new Kr("invalid-auth-event")):($u(this,!1,null,null),St())}else It(new Kr("invalid-auth-event"))},Yu.prototype.Za=function(){this.g&&!this.i&&$u(this,!1,null,null)},Yu.prototype.fa=function(){var i=this;return new vt(function(t,e){var n,r;i.b?i.b().then(t,e):(i.f.push(t),i.c.push(e),n=i,r=new Kr("timeout"),n.a&&n.a.cancel(),n.a=Fe(Ku.get()).then(function(){n.b||(n.g=!0,$u(n,!0,null,r))}))})},Zu.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ha(t.c,null,t.a,t.b),St()):e.xa(n,r)?(o=e,a=(i=t).b,s=i.c,o.xa(s,a)(i.g,i.f,i.h).then(function(t){o.ha(s,t,null,a)}).s(function(t){o.ha(s,null,t,a)})):It(new Kr("invalid-auth-event"))}else It(new Kr("invalid-auth-event"));var i,o,a,s},ec.prototype.confirm=function(t){return t=ro(this.verificationId,t),this.a(t)},ic.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=Fe(oc(n,t)).then(function(){return e=l.document,n=null,Sr()||!e?St():new vt(function(t){n=function(){Sr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},ic.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},ac.prototype.w=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},ac.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?It(new Kr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?cc(this,{grant_type:"refresh_token",refresh_token:this.a}):St(null):St({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},hc.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(fc,ue),S(pc,Oe),pc.prototype.pa=function(t){this.ka=t,Sa(this.c,t)},pc.prototype.ea=function(){return this.ka},pc.prototype.ya=function(){return j(this.O)},pc.prototype.Ha=function(){this.A.b&&(this.A.stop(),this.A.start())},Rr(pc.prototype,"providerId","firebase"),(t=pc.prototype).reload=function(){var t=this;return qc(this,Ic(this).then(function(){return Rc(t).then(function(){return _c(t)}).then(Sc)}))},t.ac=function(t){return this.F(t).then(function(t){return new rc(t)})},t.F=function(t){var e=this;return qc(this,Ic(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new Kr("internal-error");return t.accessToken!=e.ra&&(wc(e,t.accessToken),e.dispatchEvent(new fc("tokenChanged"))),kc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.wc=function(t){if(!(t=t.users)||!t.length)throw new Kr("internal-error");Tc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=(r=(r=t).providerUserInfo)&&r.length?L(r,function(t){return new lc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[],n=0;n<e.length;n++)Nc(this,e[n]);var r;kc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.xc=function(t){return kr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return qc(this,t.f(this.c,this.uid).then(function(t){return Oc(e,t),n=xc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.oc=function(t){return kr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(e){var n=this,r=null;return qc(this,Pc(this,e.providerId).then(function(){return n.F()}).then(function(t){return e.b(n.c,t)}).then(function(t){return r=xc(n,t,"link"),Mc(n,t)}).then(function(){return r}))},t.pc=function(t,e){var n=this;return qc(this,Pc(this,"phone").then(function(){return nc(vc(n),t,e,_(n.fb,n))}))},t.yc=function(t,e){var n=this;return qc(this,St().then(function(){return nc(vc(n),t,e,_(n.hb,n))}),!0)},t.rb=function(e){var n=this;return qc(this,this.F().then(function(t){return n.c.rb(t,e)}).then(function(t){return Oc(n,t),n.reload()}))},t.Pc=function(e){var n=this;return qc(this,this.F().then(function(t){return e.b(n.c,t)}).then(function(t){return Oc(n,t),n.reload()}))},t.sb=function(e){var n=this;return qc(this,this.F().then(function(t){return n.c.sb(t,e)}).then(function(t){return Oc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Ic(this);var n=this;return qc(this,this.F().then(function(t){return n.c.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Oc(n,t),kc(n,"displayName",t.displayName||null),kc(n,"photoURL",t.photoUrl||null),M(n.providerData,function(t){"password"===t.providerId&&(Rr(t,"displayName",n.displayName),Rr(t,"photoURL",n.photoURL))}),_c(n)}).then(Sc))},t.Nc=function(i){var o=this;return qc(this,Rc(this).then(function(t){return U(Cc(o),i)?(e=o.c,n=t,r=[i],ds(e,Ha,{idToken:n,deleteProvider:r})).then(function(t){var e={};return M(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),M(Cc(o),function(t){e[t]||Ac(o,t)}),e[no.PROVIDER_ID]||Rr(o,"phoneNumber",null),_c(o)}):_c(o).then(function(){throw new Kr("no-such-provider")});var e,n,r}))},t.delete=function(){var e=this;return qc(this,this.F().then(function(t){return ds(e.c,Qa,{idToken:t})}).then(function(){e.dispatchEvent(new fc("userDeleted"))})).then(function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");dc(e,null),mc(e,null),e.G=[],e.D=!0,bc(e),Rr(e,"refreshToken",null),e.a&&e.a.unsubscribe(e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?_(this.Cb,this):null},t.qc=function(t){var e=this;return Lc(this,"linkViaPopup",t,function(){return Pc(e,t.providerId).then(function(){return _c(e)})},!1)},t.zc=function(t){return Lc(this,"reauthViaPopup",t,function(){return St()},!0)},t.rc=function(t){var e=this;return Fc(this,"linkViaRedirect",t,function(){return Pc(e,t.providerId)},!1)},t.Ac=function(t){return Fc(this,"reauthViaRedirect",t,function(){return St()},!0)},t.Bb=function(e,n,r){var i=this;this.b&&(this.b.cancel(),this.b=null);var o=null;return qc(this,this.F().then(function(t){return Ua(i.c,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=xc(i,t,"link"),Mc(i,t)}).then(function(){return o}))},t.Cb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return qc(this,St().then(function(){return Di(qa(r.c,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=xc(r,t,"reauthenticate"),Oc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(e){var n=this,r=null;return qc(this,this.F().then(function(t){return r=t,void 0===e||it(e)?{}:ii(new zr(e))}).then(function(t){return n.c.kb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.w()},t.w=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.h.w(),redirectEventId:this.aa||null};return this.metadata&&ct(e,this.metadata.w()),M(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var jc={name:"redirectUser",B:"session"};function Wc(t){return pu(t.b,jc,t.a)}function Kc(t){var e,n,r,i,o,a,s,u,c;this.a=t,this.b=hu(),this.c=null,this.f=(e=this,n=Gc("local"),r=Gc("session"),i=Gc("none"),(o=e.b,a=n,s=e.a,u=fu(a,s),c=lu(o,a.B),o.get(a,s).then(function(t){var e=null;try{e=br(l.localStorage.getItem(u))}catch(t){}if(e&&!t)return l.localStorage.removeItem(u),o.set(a,e,s);e&&t&&"localStorage"!=c.type&&l.localStorage.removeItem(u)})).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(Hc,e.a).then(function(t){return t?Gc(t):n})})})}).then(function(t){return e.c=t,Qc(e,t.B)}).s(function(){e.c||(e.c=n)})),this.b.addListener(Gc("local"),this.a,_(this.g,this))}function Qc(t,e){var n,s,r=[];for(n in uu)uu[n]!==e&&r.push(pu(t.b,Gc(uu[n]),t.a));return r.push(pu(t.b,Hc,t.a)),s=r,new vt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Ct(s[a],E(t,a),o);else n(i)})}Kc.prototype.g=function(){var e=this,n=Gc("local");Jc(this,function(){return St().then(function(){return e.c&&"local"!=e.c.B?e.b.get(n,e.a):null}).then(function(t){if(t)return Qc(e,"local").then(function(){e.c=n})})})};var Hc={name:"persistence",B:"session"};function Gc(t){return{name:"authUser",B:t}}function zc(t,e){return Jc(t,function(){return t.b.set(t.c,e.w(),t.a)})}function Yc(t){return Jc(t,function(){return pu(t.b,t.c,t.a)})}function Xc(t,e){return Jc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Vc(t||{})})})}function Jc(t,e){return t.f=t.f.then(e,e),t.f}function $c(t){if(this.l=!1,Rr(this,"settings",new tc),Rr(this,"app",t),!oh(this).options||!oh(this).options.apiKey)throw new Kr("invalid-api-key");var n,e,r,i,o,a,s,u,c,h,l,f;t=Hh.SDK_VERSION?cr(Hh.SDK_VERSION):null,this.c=new va(oh(this).options&&oh(this).options.apiKey,pi(li),t),this.N=[],this.o=[],this.I=[],this.Rb=Hh.INTERNAL.createSubscribe(_(this.kc,this)),this.O=void 0,this.Sb=Hh.INTERNAL.createSubscribe(_(this.mc,this)),rh(this,null),this.h=new Kc(oh(this).options.apiKey+":"+oh(this).name),this.A=new Bc(oh(this).options.apiKey+":"+oh(this).name),this.V=ch(this,(e=oh(n=this).options.authDomain,r=(i=n,o=(a=i.A,s=oh(i).options.authDomain,a.b.get(jc,a.a).then(function(t){return t&&s&&(t.authDomain=s),Vc(t||{})})).then(function(t){return(i.D=t)&&(t.ba=i.A),Wc(i.A)}),ch(i,o)).then(function(){return Xc(n.h,e)}).then(function(e){return e?(e.ba=n.A,n.D&&(n.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return zc(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:Yc(n.h)})):null}).then(function(t){rh(n,t||null)}),ch(n,r))),this.i=ch(this,(u=this).V.then(function(){return u.fa()}).s(function(){}).then(function(){if(!u.l)return u.ka()}).s(function(){}).then(function(){if(!u.l){u.X=!0;var t=u.h;t.b.addListener(Gc("local"),t.a,u.ka)}})),this.X=!1,this.ka=_(this.Kc,this),this.Ha=_(this.Z,this),this.ra=_(this.Zb,this),this.sa=_(this.ic,this),this.ta=_(this.jc,this),h=oh(c=this).options.authDomain,l=oh(c).options.apiKey,h&&pr()&&(c.Qb=c.V.then(function(){if(!c.l){if(c.a=zu(h,l,oh(c).name),c.a.subscribe(c),ah(c)&&Ec(ah(c)),c.D){Ec(c.D);var t=c.D;t.pa(c.ea()),dc(t,c),yc(t=c.D,c.G),mc(t,c),c.D=null}return c.a}})),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.sc,this),this.u=0,Oe.call(this),f=this,Object.defineProperty(f,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),f.W=null,this.G=[]}function Zc(t){ue.call(this,"languageCodeChanged"),this.g=t}function th(t){ue.call(this,"frameworkChanged"),this.c=t}function eh(t){return t.Qb||It(new Kr("auth-domain-config-required"))}function nh(o,a){var s={};return s.apiKey=oh(o).options.apiKey,s.authDomain=oh(o).options.authDomain,s.appName=oh(o).name,o.V.then(function(){return t=s,e=a,n=o.A,r=o.ya(),i=new pc(t,e),n&&(i.ba=n),r&&yc(i,r),i.reload().then(function(){return i});var t,e,n,r,i}).then(function(t){return ah(o)&&t.uid==ah(o).uid?Dc(ah(o),t):(rh(o,t),Ec(t)),o.Z(t)}).then(function(){uh(o)})}function rh(t,e){var n,r;ah(t)&&(n=ah(t),r=t.Ha,V(n.N,function(t){return t==r}),Te(ah(t),"tokenChanged",t.ra),Te(ah(t),"userDeleted",t.sa),Te(ah(t),"userInvalidated",t.ta),bc(ah(t))),e&&(e.N.push(t.Ha),we(e,"tokenChanged",t.ra),we(e,"userDeleted",t.sa),we(e,"userInvalidated",t.ta),0<t.u&&gc(e)),Rr(t,"currentUser",e),e&&(e.pa(t.ea()),dc(e,t),yc(e,t.G),mc(e,t))}function ih(e,t){var n=null,r=null;return ch(e,t.then(function(t){return n=io(t),r=gi(t),nh(e,t)}).then(function(){return Pr({user:ah(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function oh(t){return t.app}function ah(t){return t.currentUser}function sh(t){return ah(t)&&ah(t)._lat||null}function uh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](sh(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](sh(t))}}function ch(t,e){return t.N.push(e),e.ia(function(){q(t.N,e)}),e}function hh(){}function lh(){this.a={},this.b=1e12}Kc.prototype.nb=function(e){var n=null,r=this;return function(t){var e=new Kr("invalid-persistence-type"),n=new Kr("unsupported-persistence-type");t:{for(r in uu)if(uu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(rr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!fr()&&"none"!==t)throw n}}(e),Jc(this,function(){return e!=r.c.B?r.b.get(r.c,r.a).then(function(t){return n=t,Qc(r,e)}).then(function(){if(r.c=Gc(e),n)return r.b.set(r.c,n,r.a)}):St()})},S($c,Oe),S(Zc,ue),S(th,ue),(t=$c.prototype).nb=function(t){return ch(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,Sa(this.c,this.W),this.dispatchEvent(new Zc(this.ea())))},t.ea=function(){return this.W},t.Qc=function(){var t=l.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.sc=function(t){this.G.push(t),Ia(this.c,Hh.SDK_VERSION?cr(Hh.SDK_VERSION,this.G):null),this.dispatchEvent(new th(this.G))},t.ya=function(){return j(this.G)},t.toJSON=function(){return{apiKey:oh(this).options.apiKey,authDomain:oh(this).options.authDomain,appName:oh(this).name,currentUser:ah(this)&&ah(this).w()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.Yb,this):null},t.Yb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=Fa(r.c,t).then(function(t){return i=io(t),o=gi(t),t});return ch(this,t=r.V.then(function(){return a}).then(function(t){return nh(r,t)}).then(function(){return Pr({user:ah(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Ic=function(e){if(!pr())return It(new Kr("operation-not-supported-in-this-environment"));var n=this,t=vi(e.providerId),r=wr(),i=null;(!mr()||er())&&oh(this).options.authDomain&&e.isOAuthProvider&&(i=ks(oh(this).options.authDomain,oh(this).options.apiKey,oh(this).name,"signInViaPopup",e,null,r,Hh.SDK_VERSION||null));var o=Xn(i,t&&t.Ba,t&&t.Aa);return ch(this,t=eh(this).then(function(t){return Qu(t,o,"signInViaPopup",e,r,!!i)}).then(function(){return new vt(function(t,e){n.ha("signInViaPopup",null,new Kr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.b=n.a.Ea(n,"signInViaPopup",o,r)})}).then(function(t){return o&&Yn(o),t?Pr(t):null}).s(function(t){throw o&&Yn(o),t}))},t.Jc=function(t){if(!pr())return It(new Kr("operation-not-supported-in-this-environment"));var e=this;return ch(this,eh(this).then(function(){return Jc(t=e.h,function(){return t.b.set(Hc,t.c.B,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!pr())return It(new Kr("operation-not-supported-in-this-environment"));var t=this;return ch(this,eh(this).then(function(){return t.a.fa()}).then(function(t){return t?Pr(t):null}))},t.Oc=function(t){if(!t)return It(new Kr("null-user"));var e=this,n={};n.apiKey=oh(this).options.apiKey,n.authDomain=oh(this).options.authDomain,n.appName=oh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.h,o={};return o[ba]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new pc(e,o),n&&(e.ba=n),r&&yc(e,r),Dc(e,t),e}(t,n,e.A,e.ya());return ch(this,this.i.then(function(){if(oh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return ah(e)&&t.uid==ah(e).uid?(Dc(ah(e),t),e.Z(t)):(rh(e,r),Ec(r),e.Z(r))}).then(function(){uh(e)}))},t.pb=function(){var t=this;return ch(this,this.i.then(function(){return ah(t)?(rh(t,null),Yc(t.h).then(function(){uh(t)})):St()}))},t.Kc=function(){var r=this;return Xc(this.h,oh(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=ah(r)&&t){e=ah(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Dc(ah(r),t),ah(r).F();(ah(r)||t)&&(rh(r,t),t&&(Ec(t),t.ba=r.A),r.a&&r.a.subscribe(r),uh(r))}})},t.Z=function(t){return zc(this.h,t)},t.Zb=function(){uh(this),this.Z(ah(this))},t.ic=function(){this.pb()},t.jc=function(){this.pb()},t.kc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(ah(e))})},t.mc=function(t){var e,n,r=this;n=function(){t.next(ah(r))},(e=this).I.push(n),ch(e,e.i.then(function(){!e.l&&U(e.I,n)&&e.O!==e.getUid()&&(e.O=e.getUid(),n(sh(e)))}))},t.uc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){v(t)?t(ah(r)):v(t.next)&&t.next(ah(r))}),this.Rb(t,e,n)},t.tc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),v(t)?t(ah(r)):v(t.next)&&t.next(ah(r))}),this.Sb(t,e,n)},t.$b=function(t){var e=this;return ch(this,this.i.then(function(){return ah(e)?ah(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Ec=function(t){var n=this;return this.i.then(function(){return ih(n,ds(n.c,cs,{token:t}))}).then(function(t){var e=t.user;return kc(e,"isAnonymous",!1),n.Z(e),t})},t.Fc=function(t,e){var n=this;return this.i.then(function(){return ih(n,ds(n.c,hs,{email:t,password:e}))})},t.Ub=function(t,e){var n=this;return this.i.then(function(){return ih(n,ds(n.c,Wa,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return ih(e,t.la(e.c))})},t.Dc=function(t){return kr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=ah(n);return t&&t.isAnonymous?Pr({user:t,credential:null,additionalUserInfo:Pr({providerId:null,isNewUser:!1}),operationType:"signIn"}):ih(n,n.c.ob()).then(function(t){var e=t.user;return kc(e,"isAnonymous",!0),n.Z(e),t})})},t.getUid=function(){return ah(this)&&ah(this).uid||null},t.Tb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&ah(this)&&gc(ah(this))},t.Bc=function(e){var n=this;M(this.o,function(t){t==e&&n.u--}),this.u<0&&(this.u=0),0==this.u&&ah(this)&&bc(ah(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),ch(this,this.i.then(function(){e.l||U(e.o,t)&&t(sh(e))}))},t.removeAuthTokenListener=function(e){V(this.o,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(Gc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),Promise.resolve()},t.Xb=function(t){return ch(this,ds(this.c,Ka,{identifier:t,continueUri:dr()?Hn():"http://localhost"}).then(function(t){return t.signinMethods||[]}))},t.nc=function(t){return!!$i(t)},t.mb=function(e,n){var r=this;return ch(this,St().then(function(){var t=new zr(n);if(!t.c)throw new Kr("argument-error",Jr+" must be true when sending sign in link to email");return ii(t)}).then(function(t){return r.c.mb(e,t)}).then(function(){}))},t.Rc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return ch(this,this.c.$a(t,e).then(function(){}))},t.Ka=function(t){return ch(this,this.c.Ka(t).then(function(t){return new Mr(t)}))},t.Xa=function(t){return ch(this,this.c.Xa(t).then(function(){}))},t.lb=function(e,t){var n=this;return ch(this,St().then(function(){return void 0===t||it(t)?{}:ii(new zr(t))}).then(function(t){return n.c.lb(e,t)}).then(function(){}))},t.Hc=function(t,e){return ch(this,nc(this,t,e,_(this.Ra,this)))},t.Gc=function(e,n){var r=this;return ch(this,St().then(function(){var t=Ji(e,n||Hn());return r.Ra(t)}))},hh.prototype.render=function(){},hh.prototype.reset=function(){},hh.prototype.getResponse=function(){},hh.prototype.execute=function(){};var fh=null;function ph(t,e){return(e=dh(e))&&t.a[e]||null}function dh(t){return(t=void 0===t?1e12:t)?t.toString():null}function yh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Mn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():we(this.f,"click",this.i)}function mh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function vh(){}lh.prototype.render=function(t,e){return this.a[this.b.toString()]=new yh(t,e),this.b++},lh.prototype.reset=function(t){var e=ph(this,t);t=dh(t),e&&t&&(e.delete(),delete this.a[t])},lh.prototype.getResponse=function(t){return(t=ph(this,t))?t.getResponse():null},lh.prototype.execute=function(t){(t=ph(this,t))&&t.execute()},yh.prototype.getResponse=function(){return mh(this),this.b},yh.prototype.execute=function(){mh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},yh.prototype.delete=function(){mh(this),this.g=!0,clearTimeout(this.a),this.a=null,Te(this.f,"click",this.i)},vh.prototype.g=function(){return fh||(fh=new lh),St(fh)},vh.prototype.c=function(){};var gh=null;function bh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var wh=new mn(bn,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),_h=new Tr(3e4,6e4);bh.prototype.g=function(i){var o=this;return new vt(function(t,e){var r=setTimeout(function(){e(new Kr("network-request-failed"))},_h.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Kr("internal-error"));delete l[o.a]},St(ha(En(wh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Kr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},bh.prototype.c=function(){this.b--};var Eh=null;function Th(t,e,n,r,i,o,a){if(Rr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,a=a?(gh||(gh=new vh),gh):(Eh||(Eh=new bh),Eh),this.o=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Ch])throw new Kr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Nh],!l.document)throw new Kr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Mn(e)||!this.i&&Mn(e).hasChildNodes())throw new Kr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new va(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.m=[];var u=this.a[Sh];this.a[Sh]=function(t){if(Ah(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=lr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Ih];this.a[Ih]=function(){if(Ah(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=lr(c,l);"function"==typeof t&&t()}}}var Sh="callback",Ih="expired-callback",Ch="sitekey",Nh="size";function Ah(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function kh(t,e){return t.h.push(e),e.ia(function(){q(t.h,e)}),e}function Dh(t){if(t.D)throw new Kr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Rh(t,e,n){var r=!1;try{this.b=n||Hh.app()}catch(t){throw new Kr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Kr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Hh.SDK_VERSION?cr(Hh.SDK_VERSION,o):null,Th.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,pi(li),r)}function Oh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Kr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Ph.length)throw new Kr("internal-error","Argument validator received an unsupported number of arguments.");n=Ph[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new Kr("argument-error",t+" failed: "+r)}(t=Th.prototype).za=function(){var e=this;return this.f?this.f:this.f=kh(this,St().then(function(){if(dr()&&!nr())return Zn();throw new Kr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.o.g(e.v())}).then(function(t){return e.g=t,ds(e.u,ts,{})}).then(function(t){e.a[Ch]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Dh(this);var n=this;return kh(this,this.za().then(function(){if(null===n.c){var t=n.l;if(!n.i){var e=Mn(t);t=Un("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Dh(this);var i=this;return kh(this,this.render().then(function(e){return new vt(function(n){var t=i.g.getResponse(e);if(t)n(t);else{var r=function(t){var e;t&&(e=r,V(i.m,function(t){return t==e}),n(t))};i.m.push(r),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Dh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Dh(this),this.D=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Mn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Rh,Th);var Ph="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function xh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:h}}function Mh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:n}}function Lh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:g}}function Fh(t,e){return{name:t||"",K:"a function",optional:!!e,M:v}}function Uh(t,e){return{name:t||"",K:"null",optional:!!e,M:r}}function qh(n){return{name:n?n+"Credential":"credential",K:n?"a valid "+n+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.la||!e)}}}function Vh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&h(t.type)&&v(t.verify))}}}function Bh(e,n,t,r){return{name:t||"",K:e.K+" or "+n.K,optional:!!r,M:function(t){return e.M(t)||n.M(t)}}}function jh(t,e){for(var n in e){var r=e[n].name;t[r]=Qh(r,t[n],e[n].j)}}function Wh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){Oh(t,[n],[r],!0),this[e]=r},r,n,e[n].vb),enumerable:!0})}}function Kh(t,e,n,r){t[e]=Qh(e,n,r)}function Qh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Oh(a,n,t),e.apply(this,t)}if(!n)return e;var i,o,a=(o=(o=t).split("."))[o.length-1];for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}jh($c.prototype,{Xa:{name:"applyActionCode",j:[xh("code")]},Ka:{name:"checkActionCode",j:[xh("code")]},$a:{name:"confirmPasswordReset",j:[xh("code"),xh("newPassword")]},Ub:{name:"createUserWithEmailAndPassword",j:[xh("email"),xh("password")]},Xb:{name:"fetchSignInMethodsForEmail",j:[xh("email")]},fa:{name:"getRedirectResult",j:[]},nc:{name:"isSignInWithEmailLink",j:[xh("emailLink")]},tc:{name:"onAuthStateChanged",j:[Bh(Lh(),Fh(),"nextOrObserver"),Fh("opt_error",!0),Fh("opt_completed",!0)]},uc:{name:"onIdTokenChanged",j:[Bh(Lh(),Fh(),"nextOrObserver"),Fh("opt_error",!0),Fh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[xh("email"),Bh(Lh("opt_actionCodeSettings",!0),Uh(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[xh("email"),Lh("actionCodeSettings")]},nb:{name:"setPersistence",j:[xh("persistence")]},Dc:{name:"signInAndRetrieveDataWithCredential",j:[qh()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[qh()]},Ec:{name:"signInWithCustomToken",j:[xh("token")]},Fc:{name:"signInWithEmailAndPassword",j:[xh("email"),xh("password")]},Gc:{name:"signInWithEmailLink",j:[xh("email"),xh("emailLink",!0)]},Hc:{name:"signInWithPhoneNumber",j:[xh("phoneNumber"),Vh()]},Ic:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Jc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"updateCurrentUser",j:[Bh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof pc)}},Uh(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[xh(null,!0)]},Qc:{name:"useDeviceLanguage",j:[]},Rc:{name:"verifyPasswordResetCode",j:[xh("code")]}}),Wh($c.prototype,{lc:{name:"languageCode",vb:Bh(xh(),Uh(),"languageCode")}}),($c.Persistence=uu).LOCAL="local",$c.Persistence.SESSION="session",$c.Persistence.NONE="none",jh(pc.prototype,{delete:{name:"delete",j:[]},ac:{name:"getIdTokenResult",j:[Mh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Mh("opt_forceRefresh",!0)]},oc:{name:"linkAndRetrieveDataWithCredential",j:[qh()]},fb:{name:"linkWithCredential",j:[qh()]},pc:{name:"linkWithPhoneNumber",j:[xh("phoneNumber"),Vh()]},qc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},rc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},xc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[qh()]},hb:{name:"reauthenticateWithCredential",j:[qh()]},yc:{name:"reauthenticateWithPhoneNumber",j:[xh("phoneNumber"),Vh()]},zc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[Bh(Lh("opt_actionCodeSettings",!0),Uh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[xh(null,!0)]},Nc:{name:"unlink",j:[xh("provider")]},rb:{name:"updateEmail",j:[xh("email")]},sb:{name:"updatePassword",j:[xh("password")]},Pc:{name:"updatePhoneNumber",j:[qh("phone")]},tb:{name:"updateProfile",j:[Lh("profile")]}}),jh(lh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),jh(hh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),jh(vt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Wh(tc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",vb:Mh("appVerificationDisabledForTesting")}}),jh(ec.prototype,{confirm:{name:"confirm",j:[xh("verificationCode")]}}),Kh(ki,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Li,Yi,to,Pi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Bh(xh(),Lh(),"json")]),Kh(Xi,"credential",function(t,e){return new zi(t,e)},[xh("email"),xh("password")]),jh(zi.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),jh(Vi.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Lh("customOAuthParameters")]}}),Kh(Vi,"credential",Bi,[Bh(xh(),Lh(),"token")]),Kh(Xi,"credentialWithLink",Ji,[xh("email"),xh("emailLink")]),jh(ji.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Lh("customOAuthParameters")]}}),Kh(ji,"credential",Wi,[Bh(xh(),Lh(),"token")]),jh(Ki.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Lh("customOAuthParameters")]}}),Kh(Ki,"credential",Qi,[Bh(xh(),Bh(Lh(),Uh()),"idToken"),Bh(xh(),Uh(),"accessToken",!0)]),jh(Hi.prototype,{Da:{name:"setCustomParameters",j:[Lh("customOAuthParameters")]}}),Kh(Hi,"credential",Gi,[Bh(xh(),Lh(),"token"),xh("secret",!0)]),jh(qi.prototype,{ua:{name:"addScope",j:[xh("scope")]},credential:{name:"credential",j:[Bh(xh(),Bh(Lh(),Uh()),"optionsOrIdToken"),Bh(xh(),Uh(),"accessToken",!0)]},Da:{name:"setCustomParameters",j:[Lh("customOAuthParameters")]}}),jh(xi.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),jh(Ri.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),Kh(no,"credential",ro,[xh("verificationId"),xh("verificationCode")]),jh(no.prototype,{Va:{name:"verifyPhoneNumber",j:[xh("phoneNumber"),Vh()]}}),jh(Zi.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),jh(Kr.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),jh(fo.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),jh(lo.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),jh(Rh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Hh||!Hh.INTERNAL||!Hh.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:$c,AuthCredential:ki,Error:Kr};Kh(t,"EmailAuthProvider",Xi,[]),Kh(t,"FacebookAuthProvider",Vi,[]),Kh(t,"GithubAuthProvider",ji,[]),Kh(t,"GoogleAuthProvider",Ki,[]),Kh(t,"TwitterAuthProvider",Hi,[]),Kh(t,"OAuthProvider",qi,[xh("providerId")]),Kh(t,"SAMLAuthProvider",Ui,[xh("providerId")]),Kh(t,"PhoneAuthProvider",no,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof $c)}}]),Kh(t,"RecaptchaVerifier",Rh,[Bh(xh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Lh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Hh.app.App)}}]),Hh.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new $c(t)).getUid,t),getToken:_(t.$b,t),addAuthTokenListener:_(t.Tb,t),removeAuthTokenListener:_(t.Bc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),Hh.INTERNAL.extendNamespace({User:pc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var uo,co=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),ki(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ai(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),ho=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Ri(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),lo=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new co(e)}}catch(t){}return new ho},fo=lo("localStorage"),po=lo("sessionStorage"),yo=new Ji("@firebase/database"),mo=(uo=1,function(){return uo++}),vo=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;fi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(e[n++]=i<65536?i>>12|224:(e[n++]=i>>18|240,i>>12&63|128),i>>6&63|128),63&i|128)}return e}(t),n=new Mi;n.update(e);var r=n.digest();return vi.encodeByteArray(r)},go=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=go.apply(null,t[r]):"object"==typeof t[r]?n+=ki(t[r]):n+=t[r],n+=" ";return n},bo=null,wo=!0,_o=function(t,e){fi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(yo.logLevel=Wi.VERBOSE,bo=yo.log.bind(yo),e&&po.set("logging_enabled",!0)):"function"==typeof t?bo=t:(bo=null,po.remove("logging_enabled"))},Eo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===wo&&(wo=!1,null===bo&&!0===po.get("logging_enabled")&&_o(!0)),bo){var n=go.apply(null,t);bo(n)}},To=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Eo.apply(void 0,hi([n],t))}},So=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+go.apply(void 0,hi(t));yo.error(n)},Io=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+go.apply(void 0,hi(t));throw yo.error(n),new Error(n)},Co=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+go.apply(void 0,hi(t));yo.warn(n)},No=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},Ao="[MIN_NAME]",ko="[MAX_NAME]",Do=function(t,e){if(t===e)return 0;if(t===Ao||e===ko)return-1;if(e===Ao||t===ko)return 1;var n=Uo(t),r=Uo(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ro=function(t,e){return t===e?0:t<e?-1:1},Oo=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ki(e))},Po=function(t){if("object"!=typeof t||null===t)return ki(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=ki(e[i]),r+=":",r+=Po(t[e[i]]);return r+="}"},xo=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Mo(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Lo=function(t){fi(!No(t),"Invalid JSON number");var e,n,r,i,o,a,s;for(0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},Fo=new RegExp("^-?\\d{1,10}$"),Uo=function(t){if(Fo.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},qo=function(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Co("Exception was thrown by user callback.",t),e},Math.floor(0))}},Vo=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},Bo=function(){function i(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(i,"Empty",{get:function(){return new i("")},enumerable:!0,configurable:!0}),i.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},i.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},i.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new i(this.pieces_,t)},i.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},i.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},i.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},i.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},i.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new i(t,0)},i.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof i)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new i(e,0)},i.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},i.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return i.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},i.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Do(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},i.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},i.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},i}(),jo=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Qi(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Qi(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Qi(t),0<this.parts_.length&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Wo="firebaseio.com",Ko="websocket",Qo="long_polling",Ho=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=fo.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&fo.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(fi("string"==typeof t,"typeof type must == string"),fi("object"==typeof e,"typeof params must == object"),t===Ko)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Qo)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Mo(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var Go,zo,Yo,Xo,Jo,$o=function(t){var e=Zo(t),n=e.subdomain;"firebase"===e.domain&&Io(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Io("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Co("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Ho(e.host,e.secure,n,r),path:new Bo(e.pathString)}},Zo=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ui(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Co("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},ta=/[\[\].#$\/\u0000-\u001F\u007F]/,ea=/[\[\].#$\u0000-\u001F\u007F]/,na=10485760,ra=function(t){return"string"==typeof t&&0!==t.length&&!ta.test(t)},ia=function(t){return"string"==typeof t&&0!==t.length&&!ea.test(t)},oa=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!No(t)||t&&"object"==typeof t&&Ri(t,".sv")},aa=function(t,e,n,r,i){i&&void 0===n||sa(Vi(t,e,i),n,r)},sa=function(n,t,e){var r=e instanceof Bo?new jo(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(No(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>na/3&&Qi(t)>na)throw new Error(n+"contains a string greater than "+na+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Mo(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ra(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),sa(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},ua=function(t,e,n,r,i){if(!i||void 0!==n){var o=Vi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Mo(n,function(t,e){var n=new Bo(t);if(sa(o,e,r.child(n)),".priority"===n.getBack()&&!oa(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ra(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Bo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},ca=function(t,e,n,r){if(!r||void 0!==n){if(No(n))throw new Error(Vi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!oa(n))throw new Error(Vi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ha=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Vi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},la=function(t,e,n,r){if(!(r&&void 0===n||ra(n)))throw new Error(Vi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},fa=function(t,e,n,r){if(!(r&&void 0===n||ia(n)))throw new Error(Vi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},pa=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},da=function(t,e,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ra(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&((r=i)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),!ia(r)))throw new Error(Vi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ya=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){qi("OnDisconnect.cancel",0,1,arguments.length),Bi("OnDisconnect.cancel",1,t,!0);var e=new wi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){qi("OnDisconnect.remove",0,1,arguments.length),pa("OnDisconnect.remove",this.path_),Bi("OnDisconnect.remove",1,t,!0);var e=new wi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){qi("OnDisconnect.set",1,2,arguments.length),pa("OnDisconnect.set",this.path_),aa("OnDisconnect.set",1,t,this.path_,!1),Bi("OnDisconnect.set",2,e,!0);var n=new wi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){qi("OnDisconnect.setWithPriority",2,3,arguments.length),pa("OnDisconnect.setWithPriority",this.path_),aa("OnDisconnect.setWithPriority",1,t,this.path_,!1),ca("OnDisconnect.setWithPriority",2,e,!1),Bi("OnDisconnect.setWithPriority",3,n,!0);var r=new wi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(qi("OnDisconnect.update",1,2,arguments.length),pa("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Co("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ua("OnDisconnect.update",1,t,this.path_,!1),Bi("OnDisconnect.update",2,e,!0);var i=new wi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),ma=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return qi("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),va=(Go="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",zo=0,Yo=[],function(t){var e,n=t===zo;zo=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Go.charAt(t%64),t=Math.floor(t/64);fi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Yo[e];e--)Yo[e]=0;Yo[e]++}else for(e=0;e<12;e++)Yo[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Go.charAt(Yo[e]);return fi(20===i.length,"nextPushId: Length should be 20."),i}),ga=function(){function n(t,e){this.name=t,this.node=e}return n.Wrap=function(t,e){return new n(t,e)},n}(),ba=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new ga(Ao,t),r=new ga(Ao,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return ga.MIN},t}(),wa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Xo},set:function(t){Xo=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return Do(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw pi("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return ga.MIN},e.prototype.maxPost=function(){return new ga(ko,Xo)},e.prototype.makePost=function(t,e){return fi("string"==typeof t,"KeyIndex indexValue must always be a string."),new ga(t,Xo)},e.prototype.toString=function(){return".key"},e}(ba),_a=new wa;var Ea,Ta,Sa,Ia=function(t){return"number"==typeof t?"number:"+Lo(t):"string:"+t},Ca=function(t){if(t.isLeafNode()){var e=t.val();fi("string"==typeof e||"number"==typeof e||"object"==typeof e&&Ri(e,".sv"),"Priority must be a string or number.")}else fi(t===Jo||t.isEmpty(),"priority of unexpected type.");fi(t===Jo||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Na=function(){function o(t,e){void 0===e&&(e=o.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,fi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ca(this.priorityNode_)}return Object.defineProperty(o,"__childrenNodeConstructor",{get:function(){return Ea},set:function(t){Ea=t},enumerable:!0,configurable:!0}),o.prototype.isLeafNode=function(){return!0},o.prototype.getPriority=function(){return this.priorityNode_},o.prototype.updatePriority=function(t){return new o(this.value_,t)},o.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.hasChild=function(){return!1},o.prototype.getPredecessorChildName=function(t,e){return null},o.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:o.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},o.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(fi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,o.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},o.prototype.isEmpty=function(){return!1},o.prototype.numChildren=function(){return 0},o.prototype.forEachChild=function(t,e){return!1},o.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},o.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ia(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?Lo(this.value_):this.value_,this.lazyHash_=vo(t)}return this.lazyHash_},o.prototype.getValue=function(){return this.value_},o.prototype.compareTo=function(t){return t===o.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof o.__childrenNodeConstructor?-1:(fi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},o.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=o.VALUE_TYPE_ORDER.indexOf(e),i=o.VALUE_TYPE_ORDER.indexOf(n);return fi(0<=r,"Unknown leaf type: "+e),fi(0<=i,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},o.prototype.withIndex=function(){return this},o.prototype.isIndexed=function(){return!0},o.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},o.VALUE_TYPE_ORDER=["object","boolean","number","string"],o}();var Aa,ka,Da=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Do(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return ga.MIN},e.prototype.maxPost=function(){return new ga(ko,new Na("[PRIORITY-POST]",Sa))},e.prototype.makePost=function(t,e){var n=Ta(t);return new ga(e,new Na("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(ba)),Ra=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return 0<this.nodeStack_.length},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Oa=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:xa.EMPTY_NODE,this.right=null!=i?i:xa.EMPTY_NODE}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.count=function(){return this.left.count()+1+this.right.count()},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},o.prototype.minKey=function(){return this.min_().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},o.prototype.removeMin_=function(){if(this.left.isEmpty())return xa.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},o.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return xa.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},o.prototype.isRed_=function(){return this.color},o.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},o.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},o.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},o.prototype.rotateLeft_=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight_=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},o.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},o.RED=!0,o.BLACK=!1,o}(),Pa=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Oa(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),xa=function(){function n(t,e){void 0===e&&(e=n.EMPTY_NODE),this.comparator_=t,this.root_=e}return n.prototype.insert=function(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Oa.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Oa.BLACK,null,null))},n.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},n.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},n.prototype.isEmpty=function(){return this.root_.isEmpty()},n.prototype.count=function(){return this.root_.count()},n.prototype.minKey=function(){return this.root_.minKey()},n.prototype.maxKey=function(){return this.root_.maxKey()},n.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},n.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},n.prototype.getIterator=function(t){return new Ra(this.root_,null,this.comparator_,!1,t)},n.prototype.getIteratorFrom=function(t,e){return new Ra(this.root_,t,this.comparator_,!1,e)},n.prototype.getReverseIteratorFrom=function(t,e){return new Ra(this.root_,t,this.comparator_,!0,e)},n.prototype.getReverseIterator=function(t){return new Ra(this.root_,null,this.comparator_,!0,t)},n.EMPTY_NODE=new Pa,n}(),Ma=Math.log(2),La=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ma,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Fa=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Oa(r,n.node,Oa.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Oa(r,n.node,Oa.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(n+1,r),o=c[n],a=h?h(o):o;u(new Oa(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Oa.BLACK):(r(a,Oa.BLACK),r(a,Oa.RED))}return n}(new La(c.length));return new xa(e||t,n)},Ua={},qa=function(){function l(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(l,"Default",{get:function(){return fi(Da,"ChildrenNode.ts has not been loaded"),Aa=Aa||new l({".priority":Ua},{".priority":Da})},enumerable:!0,configurable:!0}),l.prototype.get=function(t){var e=Oi(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof xa?e:null},l.prototype.hasIndex=function(t){return Ri(this.indexSet_,t.toString())},l.prototype.addIndex=function(t,e){fi(t!==_a,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(ga.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Fa(r,t.getCompare()):Ua;var s=t.toString(),u=oi({},this.indexSet_);u[s]=t;var c=oi({},this.indexes_);return c[s]=n,new l(c,u)},l.prototype.addToIndexes=function(u,c){var h=this;return new l(xi(this.indexes_,function(t,e){var n=Oi(h.indexSet_,e);if(fi(n,"Missing index implementation for "+e),t===Ua){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(ga.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),Fa(r,n.getCompare())}return Ua}var a=c.get(u.name),s=t;return a&&(s=s.remove(new ga(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},l.prototype.removeFromIndexes=function(n,r){return new l(xi(this.indexes_,function(t){if(t===Ua)return t;var e=r.get(n.name);return e?t.remove(new ga(n.name,e)):t}),this.indexSet_)},l}();function Va(t,e){return Do(t.name,e.name)}function Ba(t,e){return Do(t,e)}var ja=function(){function s(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ca(this.priorityNode_),this.children_.isEmpty()&&fi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(s,"EMPTY_NODE",{get:function(){return ka||(ka=new s(new xa(Ba),null,qa.Default))},enumerable:!0,configurable:!0}),s.prototype.isLeafNode=function(){return!1},s.prototype.getPriority=function(){return this.priorityNode_||ka},s.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new s(this.children_,t,this.indexMap_)},s.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?ka:e},s.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},s.prototype.hasChild=function(t){return null!==this.children_.get(t)},s.prototype.updateImmediateChild=function(t,e){if(fi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n=new ga(t,e),r=void 0,i=void 0;return i=e.isEmpty()?(r=this.children_.remove(t),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),this.indexMap_.addToIndexes(n,this.children_)),new s(r,r.isEmpty()?ka:this.priorityNode_,i)},s.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;fi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},s.prototype.isEmpty=function(){return this.children_.isEmpty()},s.prototype.numChildren=function(){return this.children_.count()},s.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(Da,function(t,e){r[t]=e.val(n),i++,a&&s.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},s.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Ia(this.getPriority().val())+":"),this.forEachChild(Da,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":vo(r)}return this.lazyHash_},s.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ga(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},s.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},s.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ga(e,this.children_.get(e)):null},s.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},s.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ga(e,this.children_.get(e)):null},s.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},s.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},s.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,ga.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},s.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},s.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,ga.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},s.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Wa?-1:0},s.prototype.withIndex=function(t){if(t===_a||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new s(this.children_,this.priorityNode_,e)},s.prototype.isIndexed=function(t){return t===_a||this.indexMap_.hasIndex(t)},s.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Da),r=e.getIterator(Da),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},s.prototype.resolveIndex_=function(t){return t===_a?null:this.indexMap_.get(t.toString())},s.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,s}(),Wa=new(function(t){function e(){return t.call(this,new xa(Ba),ja.EMPTY_NODE,qa.Default)||this}return ii(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return ja.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(ja));Object.defineProperties(ga,{MIN:{value:new ga(Ao,ja.EMPTY_NODE)},MAX:{value:new ga(ko,Wa)}}),wa.__EMPTY_NODE=ja.EMPTY_NODE,Na.__childrenNodeConstructor=ja,Jo=Wa,Sa=Wa;var Ka=!0;function Qa(r,t){if(void 0===t&&(t=null),null===r)return ja.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),fi(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Na(r,Qa(t));if(r instanceof Array||!Ka){var i=ja.EMPTY_NODE;return Mo(r,function(t,e){if(Ri(r,t)&&"."!==t.substring(0,1)){var n=Qa(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(Qa(t))}var o=[],a=!1;if(Mo(r,function(t,e){if("."!==t.substring(0,1)){var n=Qa(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new ga(t,n)))}}),0==o.length)return ja.EMPTY_NODE;var e=Fa(o,Va,function(t){return t.name},Ba);if(a){var n=Fa(o,Da.getCompare());return new ja(e,Qa(t),new qa({".priority":n},{".priority":Da}))}return new ja(e,Qa(t),qa.Default)}Ta=Qa;var Ha,Ga,za,Ya=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Do(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return ga.MIN},e.prototype.maxPost=function(){return ga.MAX},e.prototype.makePost=function(t,e){var n=Qa(t);return new ga(e,n)},e.prototype.toString=function(){return".value"},e}(ba)),Xa=function(n){function t(t){var e=n.call(this)||this;return e.indexPath_=t,fi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}return ii(t,n),t.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Do(t.name,e.name):i},t.prototype.makePost=function(t,e){var n=Qa(t),r=ja.EMPTY_NODE.updateChild(this.indexPath_,n);return new ga(e,r)},t.prototype.maxPost=function(){var t=ja.EMPTY_NODE.updateChild(this.indexPath_,Wa);return new ga(ko,t)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(ba),Ja=function(){function i(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return i.prototype.val=function(){return qi("DataSnapshot.val",0,0,arguments.length),this.node_.val()},i.prototype.exportVal=function(){return qi("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},i.prototype.toJSON=function(){return qi("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},i.prototype.exists=function(){return qi("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},i.prototype.child=function(t){qi("DataSnapshot.child",0,1,arguments.length),t=String(t),fa("DataSnapshot.child",1,t,!1);var e=new Bo(t),n=this.ref_.child(e);return new i(this.node_.getChild(e),n,Da)},i.prototype.hasChild=function(t){qi("DataSnapshot.hasChild",1,1,arguments.length),fa("DataSnapshot.hasChild",1,t,!1);var e=new Bo(t);return!this.node_.getChild(e).isEmpty()},i.prototype.getPriority=function(){return qi("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},i.prototype.forEach=function(n){var r=this;return qi("DataSnapshot.forEach",1,1,arguments.length),Bi("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new i(e,r.ref_.child(t),Da))})},i.prototype.hasChildren=function(){return qi("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(i.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),i.prototype.numChildren=function(){return qi("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},i.prototype.getRef=function(){return qi("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(i.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),i}(),$a=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+ki(this.snapshot.exportVal())},t}(),Za=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),ts=function(){function e(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return e.prototype.respondsTo=function(t){return"value"===t},e.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new $a("value",this,new Ja(t.snapshotNode,e.getRef(),n))},e.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){fi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},e.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Za(this,t,e):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),es=function(){function s(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return s.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Ri(this.callbacks_,e)},s.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Za(this,t,e):null},s.prototype.createEvent=function(t,e){fi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new $a(t.type,this,new Ja(t.snapshotNode,n,r),t.prevName)},s.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){fi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},s.prototype.matches=function(e){var n=this;if(e instanceof s){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},s.prototype.hasAnyCallback=function(){return null!==this.callbacks_},s}(),ns=function(){function c(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(c,"__referenceConstructor",{get:function(){return fi(Ha,"Reference.ts has not been loaded"),Ha},set:function(t){Ha=t},enumerable:!0,configurable:!0}),c.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===_a){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Ao)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=ko)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Da){if(null!=e&&!oa(e)||null!=n&&!oa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(fi(t.getIndex()instanceof Xa||t.getIndex()===Ya,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},c.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},c.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},c.prototype.getQueryParams=function(){return this.queryParams_},c.prototype.getRef=function(){return qi("Query.ref",0,0,arguments.length),new c.__referenceConstructor(this.repo,this.path)},c.prototype.on=function(t,e,n,r){qi("Query.on",2,4,arguments.length),ha("Query.on",1,t,!1),Bi("Query.on",2,e,!1);var i=c.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},c.prototype.onValueEvent=function(t,e,n){var r=new ts(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},c.prototype.onChildEvent=function(t,e,n){var r=new es(t,e,n);this.repo.addEventCallbackForQuery(this,r)},c.prototype.off=function(t,e,n){qi("Query.off",0,3,arguments.length),ha("Query.off",1,t,!0),Bi("Query.off",2,e,!0),ji("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new ts(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new es(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},c.prototype.once=function(e,n,t,r){var i=this;qi("Query.once",1,4,arguments.length),ha("Query.once",1,e,!1),Bi("Query.once",2,n,!0);var o=c.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new wi;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},c.prototype.limitToFirst=function(t){if(qi("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},c.prototype.limitToLast=function(t){if(qi("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},c.prototype.orderByChild=function(t){if(qi("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');fa("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Bo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Xa(e),r=this.queryParams_.orderBy(n);return c.validateQueryEndpoints_(r),new c(this.repo,this.path,r,!0)},c.prototype.orderByKey=function(){qi("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(_a);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByPriority=function(){qi("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Da);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByValue=function(){qi("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ya);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.startAt=function(t,e){void 0===t&&(t=null),qi("Query.startAt",0,2,arguments.length),aa("Query.startAt",1,t,this.path,!0),la("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.endAt=function(t,e){void 0===t&&(t=null),qi("Query.endAt",0,2,arguments.length),aa("Query.endAt",1,t,this.path,!0),la("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.equalTo=function(t,e){if(qi("Query.equalTo",1,2,arguments.length),aa("Query.equalTo",1,t,this.path,!1),la("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},c.prototype.toString=function(){return qi("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},c.prototype.toJSON=function(){return qi("Query.toJSON",0,1,arguments.length),this.toString()},c.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},c.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Po(t);return"{}"===e?"default":e},c.prototype.isEqual=function(t){if(qi("Query.isEqual",1,1,arguments.length),!(t instanceof c)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},c.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Bi(t,3,r.cancel,!0),r.context=n,ji(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Vi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(c.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),c}(),rs=function(){function i(){this.value=null,this.children=new Map}return i.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},i.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new i);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},i.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Da,function(t,e){n.remember(new Bo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size}return!0},i.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Bo(r.toString()+"/"+t);e.forEachTree(n,i)})},i.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},i}(),is=function(t,e){return t&&"object"==typeof t?(fi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},os=function(t,r){var i,e=t.getPriority().val(),n=is(e,r);if(t.isLeafNode()){var o=t,a=is(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Na(a,Qa(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Na(n))),s.forEachChild(Da,function(t,e){var n=os(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(za=Ga||(Ga={}))[za.OVERWRITE=0]="OVERWRITE",za[za.MERGE=1]="MERGE",za[za.ACK_USER_WRITE=2]="ACK_USER_WRITE",za[za.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var as,ss,us=function(){function e(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,fi(!r||e,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),cs=function(){function n(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ga.ACK_USER_WRITE,this.source=us.User}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return fi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Bo(t));return new n(Bo.Empty,e,this.revert)}return fi(this.path.getFront()===t,"operationForChild called for unrelated child."),new n(this.path.popFront(),this.affectedTree,this.revert)},n}(),hs=function(){function o(t,e){void 0===e&&(as||(as=new xa(Ro)),e=as),this.value=t,this.children=e}return o.fromObject=function(t){var n=o.Empty;return Mo(t,function(t,e){n=n.set(new Bo(t),e)}),n},o.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},o.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Bo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Bo(n).child(i.path),value:i.value}},o.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},o.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):o.Empty},o.prototype.set=function(t,e){if(t.isEmpty())return new o(e,this.children);var n=t.getFront(),r=(this.children.get(n)||o.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new o(this.value,i)},o.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?o.Empty:new o(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?o.Empty:new o(this.value,i)}return this},o.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},o.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||o.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new o(this.value,i)},o.prototype.fold=function(t){return this.fold_(Bo.Empty,t)},o.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},o.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Bo.Empty,e)},o.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},o.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Bo.Empty,e)},o.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):o.Empty},o.prototype.foreach=function(t){this.foreach_(Bo.Empty,t)},o.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},o.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},o.Empty=new o(null),o}(),ls=function(){function e(t,e){this.source=t,this.path=e,this.type=Ga.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Bo.Empty):new e(this.source,this.path.popFront())},e}(),fs=function(){function e(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ga.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Bo.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),ps=function(){function n(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ga.MERGE}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Bo(t));return e.isEmpty()?null:e.value?new fs(this.source,Bo.Empty,e.value):new n(this.source,Bo.Empty,e)}return fi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,this.path.popFront(),this.children)},n.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},n}(),ds=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),ys=function(){function r(t,e){this.eventCache_=t,this.serverCache_=e}return r.prototype.updateEventSnap=function(t,e,n){return new r(new ds(t,e,n),this.serverCache_)},r.prototype.updateServerSnap=function(t,e,n){return new r(this.eventCache_,new ds(t,e,n))},r.prototype.getEventCache=function(){return this.eventCache_},r.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},r.prototype.getServerCache=function(){return this.serverCache_},r.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},r.Empty=new r(new ds(ja.EMPTY_NODE,!1,!1),new ds(ja.EMPTY_NODE,!1,!1)),r}(),ms=function(){function r(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return r.valueChange=function(t){return new r(r.VALUE,t)},r.childAddedChange=function(t,e){return new r(r.CHILD_ADDED,e,t)},r.childRemovedChange=function(t,e){return new r(r.CHILD_REMOVED,e,t)},r.childChangedChange=function(t,e,n){return new r(r.CHILD_CHANGED,e,t,n)},r.childMovedChange=function(t,e){return new r(r.CHILD_MOVED,e,t)},r.CHILD_ADDED="child_added",r.CHILD_REMOVED="child_removed",r.CHILD_CHANGED="child_changed",r.CHILD_MOVED="child_moved",r.VALUE="value",r}(),vs=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){fi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(ms.childRemovedChange(e,a)):fi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ms.childAddedChange(e,n)):o.trackChildChange(ms.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Da,function(t,e){n.hasChild(t)||i.trackChildChange(ms.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(Da,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(ms.childChangedChange(t,e,n))}else i.trackChildChange(ms.childAddedChange(t,e))})),n.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?ja.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),gs=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;fi(e==ms.CHILD_ADDED||e==ms.CHILD_CHANGED||e==ms.CHILD_REMOVED,"Only child changes supported for tracking"),fi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==ms.CHILD_ADDED&&i==ms.CHILD_REMOVED)this.changeMap.set(n,ms.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==ms.CHILD_REMOVED&&i==ms.CHILD_ADDED)this.changeMap.delete(n);else if(e==ms.CHILD_REMOVED&&i==ms.CHILD_CHANGED)this.changeMap.set(n,ms.childRemovedChange(n,r.oldSnap));else if(e==ms.CHILD_CHANGED&&i==ms.CHILD_ADDED)this.changeMap.set(n,ms.childAddedChange(n,t.snapshotNode));else{if(e!=ms.CHILD_CHANGED||i!=ms.CHILD_CHANGED)throw pi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,ms.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),bs=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),ws=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ds(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),_s=function(t,e){this.viewCache=t,this.changes=e},Es=function(){function l(t){this.filter_=t}return l.prototype.assertIndexed=function(t){fi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),fi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},l.prototype.applyOperation=function(t,e,n,r){var i,o,a=new gs;if(e.type===Ga.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(fi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Ga.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(fi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Ga.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Ga.LISTEN_COMPLETE)throw pi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return l.maybeAddValueEvent_(t,i,h),new _s(i,h)},l.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ms.valueChange(e.getCompleteEventSnap()))}},l.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(fi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof ja?u:ja.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){fi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},l.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,bs,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new ws(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},l.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new ws(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):ja.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},l.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},l.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},l.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},l.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:hs.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Bo(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Bo(t),i,a,s,u,c)}}),l},l.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=hs.Empty;return s.getNode().forEachChild(_a,function(t,e){u=u.set(new Bo(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=hs.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},l.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,bs,r)},l.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new ws(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();fi(h instanceof ja,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,ja.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Bo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},l}(),Ts=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===ms.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ms.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,ms.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ms.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ms.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ms.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ms.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw pi("Should only compare child_ events.");var n=new ga(t.childName,t.snapshotNode),r=new ga(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),Ss=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new vs(n.getIndex()),i=n.getNodeFilter();this.processor_=new Es(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(ja.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ja.EMPTY_NODE,a.getNode(),null),c=new ds(s,o.isFullyInitialized(),r.filtersNodes()),h=new ds(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new ys(h,c),this.eventGenerator_=new Ts(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,n){var r=[];if(n){fi(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},t.prototype.applyOperation=function(t,e,n){t.type===Ga.MERGE&&null!==t.source.queryId&&(fi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),fi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),fi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Da,function(t,e){n.push(ms.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(ms.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),Is=function(){function d(){this.views=new Map}return Object.defineProperty(d,"__referenceConstructor",{get:function(){return fi(ss,"Reference.ts has not been loaded"),ss},set:function(t){fi(!ss,"__referenceConstructor has already been defined"),ss=t},enumerable:!0,configurable:!0}),d.prototype.isEmpty=function(){return 0===this.views.size},d.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return fi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ui(this.views.values()),c=u.next();!c.done;c=u.next()){a=c.value;s=s.concat(a.applyOperation(t,e,n))}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},d.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof ja?n.calcCompleteEventChildren(r):ja.EMPTY_NODE,!1);var c=new ys(new ds(s,u,!1),new ds(r,i,!1));a=new Ss(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},d.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ui(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ci(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new d.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},d.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ui(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},d.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ui(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},d.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},d.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},d.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},d.prototype.getCompleteView=function(){var e,t;try{for(var n=ui(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},d}(),Cs=function(){function s(t){this.writeTree_=t}return s.prototype.addWrite=function(t,e){if(t.isEmpty())return new s(new hs(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Bo.relativePath(r,t);return i=i.updateChild(o,e),new s(this.writeTree_.set(r,i))}var a=new hs(e);return new s(this.writeTree_.setTree(t,a))},s.prototype.addWrites=function(n,t){var r=this;return Mo(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},s.prototype.removeWrite=function(t){return t.isEmpty()?s.Empty:new s(this.writeTree_.setTree(t,hs.Empty))},s.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},s.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Bo.relativePath(e.path,t)):null},s.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Da,function(t,e){n.push(new ga(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new ga(t,e.value))}),n},s.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new s(null!=e?new hs(e):this.writeTree_.subtree(t))},s.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},s.prototype.apply=function(t){return function n(r,t,i){{if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(fi(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}}(Bo.Empty,this.writeTree_,t)},s.Empty=new s(new hs(null)),s}();var Ns=function(){function c(){this.visibleWrites_=Cs.Empty,this.allWrites_=[],this.lastWriteId_=-1}return c.prototype.childWrites=function(t){return new As(t,this)},c.prototype.addOverwrite=function(t,e,n,r){fi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},c.prototype.addMerge=function(t,e,n){fi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},c.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},c.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});fi(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Mo(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))});return!0}return!1},c.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Bo.Empty)){var o=c.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);u=t||ja.EMPTY_NODE;return o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Bo.Empty)){var u=t||ja.EMPTY_NODE;return s.apply(u)}return null},c.prototype.calcCompleteEventChildren=function(t,e){var r=ja.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(Da,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Da,function(t,e){var n=i.childCompoundWrite(new Bo(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},c.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){fi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},c.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},c.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Bo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},c.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},c.prototype.resetTree_=function(){this.visibleWrites_=c.layerTree_(this.allWrites_,c.DefaultFilter_,Bo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},c.DefaultFilter_=function(t){return t.visible},c.layerTree_=function(t,e,n){for(var r=Cs.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Bo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Bo.relativePath(a,n),r=r.addWrite(Bo.Empty,o.snap.getChild(s)));else{if(!o.children)throw pi("WriteRecord should have .snap or .children");if(n.contains(a))s=Bo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Bo.relativePath(a,n)).isEmpty())r=r.addWrites(Bo.Empty,o.children);else{var u=Oi(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Bo.Empty,c)}}}}}return r},c}(),As=function(){function e(t,e){this.treePath_=t,this.writeTree_=e}return e.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},e.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},e.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},e.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},e.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},e.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),ks=function(){function v(t){this.listenProvider_=t,this.syncPointTree_=hs.Empty,this.pendingWriteTree_=new Ns,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return v.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new fs(us.User,t,e)):[]},v.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=hs.fromObject(e);return this.applyOperationToSyncPoints_(new ps(us.User,t,r))},v.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=hs.Empty;return null!=n.snap?r=r.set(Bo.Empty,!0):Mo(n.children,function(t,e){r=r.set(new Bo(t),e)}),this.applyOperationToSyncPoints_(new cs(n.path,r,e))}return[]},v.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new fs(us.Server,t,e))},v.prototype.applyServerMerge=function(t,e){var n=hs.fromObject(e);return this.applyOperationToSyncPoints_(new ps(us.Server,t,n))},v.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ls(us.Server,t))},v.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=v.parseQueryKey_(r),o=i.path,a=i.queryId,s=Bo.relativePath(o,t),u=new fs(us.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},v.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=v.parseQueryKey_(r),o=i.path,a=i.queryId,s=Bo.relativePath(o,t),u=hs.fromObject(e),c=new ps(us.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},v.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=v.parseQueryKey_(n),i=r.path,o=r.queryId,a=Bo.relativePath(i,t),s=new ls(us.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},v.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Bo.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);(a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Bo.Empty)):(a=new Is,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i)?n=!0:(n=!1,i=ja.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Bo.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=v.makeQueryKey_(t);fi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=v.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},v.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(v.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}if(!h&&0<u.length&&!n)if(c){this.listenProvider_.stopListening(v.queryForListening_(t),null)}else u.forEach(function(t){var e=r.queryToTagMap.get(v.makeQueryKey_(t));r.listenProvider_.stopListening(v.queryForListening_(t),e)});this.removeTags_(u)}return a},v.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Bo.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},v.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Mo(n,function(t,e){r=r.concat(e)}),r})},v.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=v.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},v.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},v.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(v.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)fi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Mo(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(v.queryForListening_(c),this.tagForQuery_(c))}return o},v.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||ja.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},v.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},v.parseQueryKey_=function(t){var e=t.indexOf("$");return fi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Bo(t.substr(0,e))}},v.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},v.prototype.tagForQuery_=function(t){var e=v.makeQueryKey_(t);return this.queryToTagMap.get(e)},v.getNextQueryTag_=function(){return v.nextQueryTag_++},v.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);fi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},v.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Bo.Empty))},v.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Bo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Bo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},v.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Bo.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Bo.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},v.nextQueryTag_=1,v}(),Ds=function(){function t(){this.rootNode_=ja.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),Rs=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Eo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Co(t)},t}(),Os=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Ri(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return gi(this.counters_)},t}(),Ps=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Os),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),xs=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),n=oi({},t);return this.last_&&Mo(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},t}(),Ms=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new xs(t);var n=1e4+2e4*Math.random();Vo(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Mo(t,function(t,e){0<e&&Ri(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Vo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Ls=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Fs(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},t.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Fs=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();bo&&Eo("event: "+e.toString()),qo(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Us=function(){function t(t){this.allowedEvents_=t,this.listeners_={},fi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=hi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(e){fi(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},t}(),qs=function(r){function t(){var e,t,n=r.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}return ii(t,r),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return fi("visible"===t,"Unknown event type: "+t),[this.visible_]},t}(Us),Vs=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ei()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return ii(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return fi("online"===t,"Unknown event type: "+t),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Us),Bs=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&qo(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},t}(),js=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=To(t),this.stats_=Ps.getCollection(e),this.urlFn=function(t){return e.connectionURL(Qo,t)}}return t.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Bs(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new Ws(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,5),r=n[0],i=n[1],o=n[2];n[3],n[4];if(a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Wo)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Si()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=ki(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=di(e),vi.encodeByteArray(n,!0)),i=xo(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},t.prototype.incrementIncomingBytes_=function(t){var e=ki(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),Ws=function(){function a(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=mo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=a.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Eo("frame writing exception"),t.stack&&Eo(t.stack),Eo(t)}}return a.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Eo("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},a.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},a.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},a.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},a.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},a.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},a.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Eo("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},a}(),Ks="";var Qs=null;"undefined"!=typeof MozWebSocket?Qs=MozWebSocket:"undefined"!=typeof WebSocket&&(Qs=WebSocket);var Hs=function(){function i(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=To(this.connId),this.stats_=Ps.getCollection(e),this.connURL=i.connectionURL_(e,n,r)}return i.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Wo)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Ko,r)},i.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fo.set("previous_websocket_failure",!0);try{if(Si()){var r=li.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Ks+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new Qs(this.connURL,[],i)}else this.mySock=new Qs(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},i.prototype.start=function(){},i.forceDisallow=function(){i.forceDisallow_=!0},i.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Qs&&!i.forceDisallow_},i.previouslyFailed=function(){return fo.isInMemoryStorage||!0===fo.get("previous_websocket_failure")},i.prototype.markConnectionHealthy=function(){fo.remove("previous_websocket_failure")},i.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ai(e);this.onMessage(n)}},i.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},i.prototype.extractFrameCount_=function(t){if(fi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},i.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},i.prototype.send=function(t){this.resetKeepAlive();var e=ki(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=xo(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},i.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},i.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},i.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},i.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},i.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4,i}(),Gs=function(){function c(t){this.initTransports_(t)}return Object.defineProperty(c,"ALL_TRANSPORTS",{get:function(){return[js,Hs]},enumerable:!0,configurable:!0}),c.prototype.initTransports_=function(t){var e,n,r=Hs&&Hs.isAvailable(),i=r&&!Hs.previouslyFailed();if(t.webSocketOnly&&(r||Co("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Hs];else{var o=this.transports_=[];try{for(var a=ui(c.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},c.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},c.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},c}(),zs=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=To("c:"+this.id+":"),this.transportManager_=new Gs(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Vo(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},t.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=Oo("t",t),n=Oo("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=Oo("t",t),n=Oo("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=Oo("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?So("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):So("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Co("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Vo(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Ys=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Xs=function(s){function h(t,e,n,r,i,o){var a=s.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=h.nextPersistentConnectionId_++,a.log_=To("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Si())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),qs.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Vs.getInstance().on("online",a.onOnline_,a),a}return ii(h,s),h.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(ki(i)),fi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},h.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),fi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),fi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},h.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;h.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},h.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Ri(t,"w")){var n=Oi(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Co("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},h.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},h.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=Di(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},h.prototype.tryAuth=function(){var t,r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,e=(t=Di(i).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",n={cred:i};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},h.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),fi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},h.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},h.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},h.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},h.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},h.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},h.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},h.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},h.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},h.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},h.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},h.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+ki(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},h.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):So("Unrecognized action received from server: "+ki(t)+"\nAre you using the latest client?")},h.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},h.prototype.scheduleConnect_=function(t){var e=this;fi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},h.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},h.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},h.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},h.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+h.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){fi(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Eo("getToken() completed but was canceled"):(Eo("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new zs(i,o.repoInfo_,e,n,r,function(t){Co(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},h.prototype.interrupt=function(t){Eo("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},h.prototype.resume=function(t){Eo("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Pi(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},h.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},h.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},h.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Po(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},h.prototype.removeListen_=function(t,e){var n,r=new Bo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},h.prototype.onAuthRevoked_=function(t,e){Eo("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},h.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},h.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ui(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ui(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},h.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Ks.replace(/\./g,"-")]=1,Ei()?t["framework.cordova"]=1:Ti()&&(t["framework.reactnative"]=1),this.reportStats(t)},h.prototype.shouldReconnect_=function(){var t=Vs.getInstance().currentlyOnline();return Pi(this.interruptReasons_)&&t},h.nextPersistentConnectionId_=0,h.nextConnectionId_=0,h}(Ys),Js=function(i){function c(t,e,n){var r=i.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=To("p:rest:"),r.listens_={},r}return ii(c,i),c.prototype.reportStats=function(t){throw new Error("Method not implemented.")},c.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(fi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},c.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=c.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;(404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Oi(o.listens_,s)===u)&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},c.prototype.unlisten=function(t,e){var n=c.getListenId_(t,e);delete this.listens_[n]},c.prototype.refreshAuthToken=function(t){},c.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){var e,n,r=[],i=function(e,t){Array.isArray(t)?t.forEach(function(t){r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))};try{for(var o=ui(Object.entries(t)),a=o.next();!a.done;a=o.next()){var s=ci(a.value,2);i(s[0],s[1])}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r.length?"&"+r.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ai(r.responseText)}catch(t){Co("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&Co("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},c}(Ys),$s="repo_interrupt",Zs=function(){function t(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ls,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new rs,this.persistentConnection_=null;var r=new Rs(n);if(this.stats_=Ps.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Js(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ki(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Xs(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Ps.getOrCreateReporter(t,function(){return new Ms(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Ds,this.infoSyncTree_=new ks({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new ks({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new Bo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Bo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=xi(e,function(t){return Qa(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Qa(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=xi(e,function(t){return Qa(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Qa(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var n=this;Mo(t,function(t,e){n.updateInfo_(e,t)})},t.prototype.updateInfo_=function(t,e){var n=new Bo("/.info/"+t),r=Qa(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=Qa(t,e),s=os(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Co("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Mo(t,function(t,e){r=!1;var n=Qa(e);u[t]=os(n,i)}),r)Eo("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Co("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Mo(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},t.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t,n,i,e=this.generateServerValues(),o=(t=this.onDisconnect_,n=e,i=new rs,t.forEachTree(new Bo(""),function(t,e){i.remember(t,os(e,n))}),i),a=[];o.forEachTree(Bo.Empty,function(t,e){a=a.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new rs,this.eventQueue_.raiseEventsForChangedPath(Bo.Empty,a)},t.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSet=function(n,t,r){var i=this,o=Qa(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=Qa(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Pi(n))return Eo("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Mo(n,function(t,e){var n=Qa(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt($s)},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume($s)},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new xs(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Mo(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Eo.apply(void 0,hi([n],t))},t.prototype.callOnCompleteCallback=function(r,i,o){r&&qo(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new lu(this))},enumerable:!0,configurable:!0}),t}(),tu=function(){function e(t){this.indexedFilter_=new vs(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},e.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new ga(e,n))||(n=ja.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},e.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=ja.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(ja.EMPTY_NODE);var i=this;return e.forEachChild(Da,function(t,e){i.matches(new ga(t,e))||(r=r.updateImmediateChild(t,ja.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},e.prototype.updatePriority=function(t,e){return t},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},e.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},e}(),eu=function(){function t(t){this.rangedFilter_=new tu(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new ga(e,n))||(n=ja.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=ja.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=ja.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(ja.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){a=i.getNext();!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,ja.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;fi(s.numChildren()==this.limit_,"");var u=new ga(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(ms.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(ms.childRemovedChange(e,l));var d=s.updateImmediateChild(e,ja.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(ms.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(ms.childRemovedChange(c.name,c.node)),i.trackChildChange(ms.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,ja.EMPTY_NODE)):t},t}(),nu=function(){function r(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Da}return r.prototype.hasStart=function(){return this.startSet_},r.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},r.prototype.getIndexStartValue=function(){return fi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},r.prototype.getIndexStartName=function(){return fi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ao},r.prototype.hasEnd=function(){return this.endSet_},r.prototype.getIndexEndValue=function(){return fi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},r.prototype.getIndexEndName=function(){return fi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ko},r.prototype.hasLimit=function(){return this.limitSet_},r.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},r.prototype.getLimit=function(){return fi(this.limitSet_,"Only valid if limit has been set"),this.limit_},r.prototype.getIndex=function(){return this.index_},r.prototype.copy_=function(){var t=new r;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},r.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},r.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},r.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},r.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,n.indexStartName_=null!=e?(n.startNameSet_=!0,e):(n.startNameSet_=!1,""),n},r.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,n.indexEndName_=void 0!==e?(n.endNameSet_=!0,e):(n.endNameSet_=!1,""),n},r.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},r.prototype.getQueryObject=function(){var t=r.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Da&&(e[t.INDEX]=this.index_.toString()),e},r.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},r.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Da},r.prototype.getNodeFilter=function(){return this.loadsAllData()?new vs(this.getIndex()):this.hasLimit()?new eu(this):new tu(this)},r.prototype.toRestQueryStringParameters=function(){var t,e=r.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Da?e.PRIORITY_INDEX:this.index_===Ya?e.VALUE_INDEX:this.index_===_a?e.KEY_INDEX:(fi(this.index_ instanceof Xa,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=ki(t),this.startSet_&&(n[e.START_AT]=ki(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+ki(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=ki(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+ki(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},r.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},r.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},r.DEFAULT=new r,r}(),ru=function(n){function o(t,e){if(!(t instanceof Zs))throw new Error("new Reference() no longer supported - use app.database().");return n.call(this,t,e,nu.DEFAULT,!1)||this}return ii(o,n),o.prototype.getKey=function(){return qi("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},o.prototype.child=function(t){var e,n,r,i;return qi("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Bo||(null===this.path.getFront()?(e="Reference.child",i=!(n=1),(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),fa(e,n,r,i)):fa("Reference.child",1,t,!1)),new o(this.repo,this.path.child(t))},o.prototype.getParent=function(){qi("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new o(this.repo,t)},o.prototype.getRoot=function(){qi("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},o.prototype.databaseProp=function(){return this.repo.database},o.prototype.set=function(t,e){qi("Reference.set",1,2,arguments.length),pa("Reference.set",this.path),aa("Reference.set",1,t,this.path,!1),Bi("Reference.set",2,e,!0);var n=new wi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},o.prototype.update=function(t,e){if(qi("Reference.update",1,2,arguments.length),pa("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Co("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ua("Reference.update",1,t,this.path,!1),Bi("Reference.update",2,e,!0);var i=new wi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},o.prototype.setWithPriority=function(t,e,n){if(qi("Reference.setWithPriority",2,3,arguments.length),pa("Reference.setWithPriority",this.path),aa("Reference.setWithPriority",1,t,this.path,!1),ca("Reference.setWithPriority",2,e,!1),Bi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new wi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},o.prototype.remove=function(t){return qi("Reference.remove",0,1,arguments.length),pa("Reference.remove",this.path),Bi("Reference.remove",1,t,!0),this.set(null,t)},o.prototype.transaction=function(t,r,e){if(qi("Reference.transaction",1,3,arguments.length),pa("Reference.transaction",this.path),Bi("Reference.transaction",1,t,!1),Bi("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Vi(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new wi;"function"==typeof r&&i.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new ma(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},o.prototype.setPriority=function(t,e){qi("Reference.setPriority",1,2,arguments.length),pa("Reference.setPriority",this.path),ca("Reference.setPriority",1,t,!1),Bi("Reference.setPriority",2,e,!0);var n=new wi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},o.prototype.push=function(t,e){qi("Reference.push",0,2,arguments.length),pa("Reference.push",this.path),aa("Reference.push",1,t,this.path,!0),Bi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=va(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},o.prototype.onDisconnect=function(){return pa("Reference.onDisconnect",this.path),new ya(this.repo,this.path)},Object.defineProperty(o.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),o}(ns);ns.__referenceConstructor=ru,Is.__referenceConstructor=ru;var iu,ou,au=function(){this.children={},this.childCount=0,this.value=null},su=function(){function i(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new au),this.name_=t,this.parent_=e,this.node_=n}return i.prototype.subTree=function(t){for(var e,n=t instanceof Bo?t:new Bo(t),r=this;null!==(e=n.getFront());){r=new i(e,r,Oi(r.node_.children,e)||new au),n=n.popFront()}return r},i.prototype.getValue=function(){return this.node_.value},i.prototype.setValue=function(t){fi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},i.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},i.prototype.hasChildren=function(){return 0<this.node_.childCount},i.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},i.prototype.forEachChild=function(n){var r=this;Mo(this.node_.children,function(t,e){n(new i(t,r,e))})},i.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},i.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},i.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},i.prototype.path=function(){return new Bo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},i.prototype.name=function(){return this.name_},i.prototype.parent=function(){return this.parent_},i.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},i.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Ri(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},i}();(ou=iu||(iu={}))[ou.RUN=0]="RUN",ou[ou.SENT=1]="SENT",ou[ou.COMPLETED=2]="COMPLETED",ou[ou.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",ou[ou.NEEDS_ABORT=4]="NEEDS_ABORT",Zs.MAX_TRANSACTION_RETRIES_=25,Zs.prototype.transactions_init_=function(){this.transactionQueueTree_=new su},Zs.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new ru(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:mo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Ja(a.currentInputSnapshot,new ru(this,a.path),Da);a.onComplete(null,!1,c)}}else{sa("transaction failed: Data returned ",u,a.path),a.status=iu.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Ri(u,".priority"))f=Oi(u,".priority"),fi(oa(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||ja.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Qa(u,f),y=os(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Zs.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||ja.EMPTY_NODE},Zs.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);fi(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===iu.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Zs.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];fi(o.status===iu.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=iu.SENT,o.retryCount++;var a=Bo.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=iu.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new ru(c,u[r].path),a=new Ja(i,o,Da);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)qo(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===iu.SENT_NEEDS_ABORT?u[r].status=iu.NEEDS_ABORT:u[r].status=iu.RUN;else{Co("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=iu.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Zs.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Zs.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===iu.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Bo.relativePath(e,s.path),c=!1,h=void 0;if(fi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===iu.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===iu.RUN)if(s.retryCount>=Zs.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){sa("transaction failed: Data returned ",f,s.path);var p=Qa(f);"object"==typeof f&&null!=f&&Ri(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=os(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=iu.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new ru(this,t[a].path),g=t[a].currentInputSnapshot,b=new Ja(g,v,Da);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)qo(r[a]);this.sendReadyTransactions_()}},Zs.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Zs.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Zs.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Zs.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==iu.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Zs.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Zs.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===iu.SENT_NEEDS_ABORT);else if(e[o].status===iu.SENT)fi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=iu.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(fi(e[o].status===iu.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)qo(n[o])}};var uu,cu="databaseURL",hu=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return uu||(uu=new t),uu},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options[cu];void 0===n&&Io("Can't determine Firebase Database URL.  Be sure to include "+cu+" option when calling firebase.initializeApp().");var r=$o(n),i=r.repoInfo;return da("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Io("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=Oi(this.repos_,t.app.name);e&&Oi(e,t.repoInfo_.toURLString())===t||Io("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=Oi(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Oi(n,t.toURLString());return r&&Io("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Zs(t,this.useRestClient_,e),n[t.toURLString()]=r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),lu=function(){function t(t){(this.repo_=t)instanceof Zs||Io("Don't call new Database() directly - please use firebase.database()."),this.root_=new ru(t,Bo.Empty),this.INTERNAL=new fu(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),qi("database.ref",0,1,arguments.length),t instanceof ru?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),qi(e,1,1,arguments.length);var n=$o(t);da(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Io(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&Io("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){qi("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){qi("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),fu=function(){function t(t){this.database=t}return t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.database.checkDeleted_("delete"),hu.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),pu=Object.freeze({forceLongPolling:function(){Hs.forceDisallow(),js.forceAllow()},forceWebSockets:function(){js.forceDisallow()},isWebSocketsAvailable:function(){return Hs.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),du=Xs;Xs.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Xs.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var yu,mu,vu=zs,gu=Ho,bu=Object.freeze({DataConnection:du,RealTimeConnection:vu,hijackHash:function(i){var o=Xs.prototype.put;return Xs.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Xs.prototype.put=o}},ConnectionTarget:gu,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){hu.getInstance().forceRestClient(t)}}),wu=lu.ServerValue;mu=(yu=Hh).SDK_VERSION,Ks=mu,yu.INTERNAL.registerService("database",function(t,e,n){return hu.getInstance().databaseFromApp(t,n)},{Reference:ru,Query:ns,Database:lu,DataSnapshot:Ja,enableLogging:_o,INTERNAL:pu,ServerValue:wu,TEST_ACCESS:bu},null,!0);var _u,Eu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Tu=Tu||{},Su=Eu;function Iu(t){return"string"==typeof t}function Cu(t){return"number"==typeof t}function Nu(t,e){t=t.split("."),e=e||Su;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Au(){}function ku(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Du(t){return"array"==ku(t)}function Ru(t){var e=ku(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Ou(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Pu="closure_uid_"+(1e9*Math.random()>>>0),xu=0;function Mu(t,e,n){return t.call.apply(t.bind,arguments)}function Lu(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Fu(t,e,n){return(Fu=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Mu:Lu).apply(null,arguments)}function Uu(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var qu=Date.now||function(){return+new Date};function Vu(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Bu(){this.j=this.j,this.i=this.i}Bu.prototype.j=!1,Bu.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Pu]||(this[Pu]=++xu)},Bu.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ju=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Iu(t))return Iu(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Wu=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Iu(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ku(t){return Array.prototype.concat.apply([],arguments)}function Qu(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Hu(t){return/^[\s\xa0]*$/.test(t)}var Gu,zu=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Yu(t,e){return-1!=t.indexOf(e)}function Xu(t,e){return t<e?-1:e<t?1:0}t:{var Ju=Su.navigator;if(Ju){var $u=Ju.userAgent;if($u){Gu=$u;break t}}Gu=""}function Zu(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tc(t){var e,n={};for(e in t)n[e]=t[e];return n}var ec="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nc(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ec.length;o++)n=ec[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function rc(t){return rc[" "](t),t}rc[" "]=Au;var ic,oc,ac=Yu(Gu,"Opera"),sc=Yu(Gu,"Trident")||Yu(Gu,"MSIE"),uc=Yu(Gu,"Edge"),cc=uc||sc,hc=Yu(Gu,"Gecko")&&!(Yu(Gu.toLowerCase(),"webkit")&&!Yu(Gu,"Edge"))&&!(Yu(Gu,"Trident")||Yu(Gu,"MSIE"))&&!Yu(Gu,"Edge"),lc=Yu(Gu.toLowerCase(),"webkit")&&!Yu(Gu,"Edge");function fc(){var t=Su.document;return t?t.documentMode:void 0}t:{var pc="",dc=(oc=Gu,hc?/rv:([^\);]+)(\)|;)/.exec(oc):uc?/Edge\/([\d\.]+)/.exec(oc):sc?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(oc):lc?/WebKit\/(\S+)/.exec(oc):ac?/(?:Version)[ \/]?(\S+)/.exec(oc):void 0);if(dc&&(pc=dc?dc[1]:""),sc){var yc=fc();if(null!=yc&&yc>parseFloat(pc)){ic=String(yc);break t}}ic=pc}var mc,vc={};function gc(s){return t=s,e=function(){for(var t=0,e=zu(String(ic)).split("."),n=zu(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Xu(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Xu(0==o[2].length,0==a[2].length)||Xu(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=vc,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var bc=Su.document;mc=bc&&sc?fc()||("CSS1Compat"==bc.compatMode?parseInt(ic,10):5):void 0;var wc=!sc||9<=Number(mc),_c=sc&&!gc("9"),Ec=function(){if(!Su.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Su.addEventListener("test",Au,e),Su.removeEventListener("test",Au,e)}catch(t){}return t}();function Tc(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function Sc(t,e){if(Tc.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(hc){t:{try{rc(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Iu(t.pointerType)?t.pointerType:Ic[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tc.prototype.b=function(){this.Ja=!1},Vu(Sc,Tc);var Ic={2:"touch",3:"pen",4:"mouse"};Sc.prototype.b=function(){Sc.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,_c)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Cc="closure_listenable_"+(1e6*Math.random()|0),Nc=0;function Ac(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Nc,this.X=this.Z=!1}function kc(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Dc(t){this.src=t,this.a={},this.b=0}function Rc(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=ju(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(kc(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Oc(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Dc.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Oc(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Ac(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pc="closure_lm_"+(1e6*Math.random()|0),xc={};function Mc(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Du(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Wc(r);return e&&e[Cc]?e.Ba(n,r,Ou(i)?!!i.capture:!!i,o):Lc(e,n,r,!0,i,o)}(t,e,n,r,i);if(Du(e)){for(var o=0;o<e.length;o++)Mc(t,e[o],n,r,i);return null}return n=Wc(n),t&&t[Cc]?t.Aa(e,n,Ou(r)?!!r.capture:!!r,i):Lc(t,e,n,!1,r,i)}function Lc(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Ou(i)?!!i.capture:!!i;if(a&&!wc)return null;var s,u,c=Bc(t);if(c||(t[Pc]=c=new Dc(t)),(n=c.add(e,n,r,a,o)).proxy)return n;if(s=Vc,r=u=wc?function(t){return s.call(u.src,u.listener,t)}:function(t){if(!(t=s.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Ec||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Uc(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Fc(t){if(!Cu(t)&&t&&!t.X){var e=t.src;if(e&&e[Cc])Rc(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Uc(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bc(e))?(Rc(n,t),0==n.b&&(n.src=null,e[Pc]=null)):kc(t)}}}function Uc(t){return t in xc?xc[t]:xc[t]="on"+t}function qc(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Fc(t),n.call(r,e)}function Vc(t,e){return!!t.X||(wc?qc(t,new Sc(e,this)):qc(t,e=new Sc(e||Nu("window.event"),this)))}function Bc(t){return(t=t[Pc])instanceof Dc?t:null}var jc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Wc(e){return"function"==ku(e)?e:(e[jc]||(e[jc]=function(t){return e.handleEvent(t)}),e[jc])}function Kc(){Bu.call(this),this.c=new Dc(this),(this.J=this).B=null}function Qc(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Rc(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Vu(Kc,Bu),Kc.prototype[Cc]=!0,(_u=Kc.prototype).addEventListener=function(t,e,n,r){Mc(this,t,e,n,r)},_u.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Du(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Ou(i)?!!i.capture:!!i,r=Wc(r),e&&e[Cc]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Oc(a=e.a[n],r,i,o))&&(kc(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Bc(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Oc(n,r,i,o)),(r=-1<e?n[e]:null)&&Fc(r))}(this,t,e,n,r)},_u.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Iu(t))t=new Tc(t,n);else if(t instanceof Tc)t.target=t.target||n;else{var i=t;nc(t=new Tc(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Qc(a,r,!0,t)&&i}if(i=Qc(a=t.a=n,r,!0,t)&&i,i=Qc(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Qc(a=t.a=e[o],r,!1,t)&&i;return i},_u.G=function(){if(Kc.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)kc(n[r]);delete e.a[t],e.b--}}this.B=null},_u.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},_u.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Hc=Su.JSON.stringify;function Gc(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function zc(){this.b=this.a=null}Gc.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Yc,Xc=new Gc(function(){return new Jc},function(t){t.reset()});function Jc(){this.next=this.b=this.a=null}function $c(t){Su.setTimeout(function(){throw t},0)}function Zc(t,e){var n;Yc||(n=Su.Promise.resolve(void 0),Yc=function(){n.then(nh)}),th||(Yc(),th=!0),eh.add(t,e)}zc.prototype.add=function(t,e){var n=Xc.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Jc.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var th=!(Jc.prototype.reset=function(){this.next=this.b=this.a=null}),eh=new zc;function nh(){for(var t;r=n=void 0,r=null,(n=eh).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){$c(t)}var e=Xc;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;th=!1}function rh(t,e){Kc.call(this),this.b=t||1,this.a=e||Su,this.f=Fu(this.gb,this),this.g=qu()}function ih(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function oh(t,e,n){if("function"==ku(t))n&&(t=Fu(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Fu(t.handleEvent,t)}return 2147483647<Number(e)?-1:Su.setTimeout(t,e||0)}function ah(t,e,n){Bu.call(this),this.f=null!=n?Fu(t,n):t,this.c=e,this.b=Fu(this.ab,this),this.a=[]}function sh(t){t.U=oh(t.b,t.c),t.f.apply(null,t.a)}function uh(t){Bu.call(this),this.b=t,this.a={}}Vu(rh,Kc),(_u=rh.prototype).ba=!1,_u.L=null,_u.gb=function(){if(this.ba){var t=qu()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(ih(this),this.start()))}},_u.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=qu())},_u.G=function(){rh.N.G.call(this),ih(this),delete this.a},Vu(ah,Bu),(_u=ah.prototype).ea=!1,_u.U=null,_u.Ua=function(t){this.a=arguments,this.U?this.ea=!0:sh(this)},_u.G=function(){ah.N.G.call(this),this.U&&(Su.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},_u.ab=function(){this.U=null,this.ea&&(this.ea=!1,sh(this))},Vu(uh,Bu);var ch=[];function hh(t,e,n,r){Du(n)||(n&&(ch[0]=n.toString()),n=ch);for(var i=0;i<n.length;i++){var o=Mc(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function lh(t){Zu(t.a,function(t,e){this.a.hasOwnProperty(e)&&Fc(t)},t),t.a={}}function fh(){}uh.prototype.G=function(){uh.N.G.call(this),lh(this)},uh.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ph=new Kc;function dh(t){Tc.call(this,"serverreachability",t)}function yh(t){ph.dispatchEvent(new dh(ph,t))}function mh(t){Tc.call(this,"statevent",t)}function vh(t){ph.dispatchEvent(new mh(ph,t))}function gh(t){Tc.call(this,"timingevent",t)}function bh(t,e){if("function"!=ku(t))throw Error("Fn must not be null and must be a function");return Su.setTimeout(function(){t()},e)}Vu(dh,Tc),Vu(mh,Tc),Vu(gh,Tc);var wh={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},_h={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Eh(){}function Th(t){var e;return(e=t.a)||(e=t.a={}),e}function Sh(){}Eh.prototype.a=null;var Ih,Ch={OPEN:"a",ib:"b",Na:"c",rb:"d"};function Nh(){Tc.call(this,"d")}function Ah(){Tc.call(this,"c")}function kh(){}function Dh(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new uh(this),this.O=Rh,t=cc?125:void 0,this.P=new rh(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Vu(Nh,Tc),Vu(Ah,Tc),Vu(kh,Eh),Ih=new kh;var Rh=45e3,Oh={},Ph={};function xh(t,e,n){t.F=1,t.f=al(Zh(e)),t.l=n,t.H=!0,Lh(t,null)}function Mh(t,e,n,r){t.F=1,t.f=al(Zh(e)),t.l=null,t.H=n,Lh(t,r)}function Lh(t,e){t.v=qu(),qh(t),t.D=Zh(t.f),ol(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ah(Fu(t.Ka,t,t.a),t.J)),hh(t.I,t.a,"readystatechange",t.eb),e=t.h?tc(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),yh(1)}function Fh(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Uh(t,n);if(i==Ph){4==e&&(t.c=4,vh(14),r=!1);break}if(i==Oh){t.c=4,vh(15),r=!1;break}Kh(t,i)}4==e&&0==n.length&&(t.c=1,vh(16),r=!1),t.b=t.b&&r,r||(Wh(t),jh(t))}function Uh(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Ph:(n=Number(e.substring(n,r)),isNaN(n)?Oh:(r+=1)+n>e.length?Ph:(e=e.substr(r,n),t.A=r+n,e))}function qh(t){t.R=qu()+t.O,Vh(t,t.O)}function Vh(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=bh(Fu(t.bb,t),e)}function Bh(t){t.i&&(Su.clearTimeout(t.i),t.i=null)}function jh(t){t.g.Da()||t.m||t.g.na(t)}function Wh(t){Bh(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,ih(t.P),lh(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Kh(t,e){try{t.g.Ga(t,e),yh(4)}catch(t){}}function Qh(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ru(t)||Iu(t))Wu(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Ru(t)||Iu(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Iu(t))return t.split("");if(Ru(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Gh(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Gh)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function zh(t,e){Xh(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Yh(t))}function Yh(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Xh(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Xh(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Xh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_u=Dh.prototype).setTimeout=function(t){this.O=t},_u.eb=function(t){t=t.target;var e=this.B;e&&3==$l(t)?e.Ua():this.Ka(t)},_u.Ka=function(t){try{if(t==this.a)t:{var e=$l(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!cc&&!this.a.aa())){this.m||4!=e||7==n||yh(8==n||r<=0?3:2),Bh(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Zl(this.a,"X-HTTP-Initial-Response");if(a&&!Hu(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,vh(12),Wh(this),jh(this);break t}this.s=!0,Kh(this,s)}this.H?(Fh(this,e,o),cc&&this.b&&3==e&&(hh(this.I,this.P,"tick",this.cb),this.P.start())):Kh(this,o),4==e&&Wh(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,qh(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,vh(12)):(this.c=0,vh(13)),Wh(this),jh(this)}}}catch(t){}},_u.cb=function(){if(this.a){var t=$l(this.a),e=this.a.aa();this.A<e.length&&(Bh(this),Fh(this,t,e),this.b&&4!=t&&qh(this))}},_u.cancel=function(){this.m=!0,Wh(this)},_u.bb=function(){this.i=null;var t=qu();0<=t-this.R?(2!=this.F&&(yh(3),vh(17)),Wh(this),this.c=2,jh(this)):Vh(this,this.R-t)},(_u=Gh.prototype).C=function(){Yh(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},_u.K=function(){return Yh(this),this.a.concat()},_u.get=function(t,e){return Xh(this.b,t)?this.b[t]:e},_u.set=function(t,e){Xh(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},_u.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Jh=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $h(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $h?(this.h=void 0!==e?e:t.h,tl(this,t.f),this.j=t.j,el(this,t.b),nl(this,t.i),this.a=t.a,rl(this,wl(t.c)),this.g=t.g):t&&(n=String(t).match(Jh))?(this.h=!!e,tl(this,n[1]||"",!0),this.j=sl(n[2]||""),el(this,n[3]||"",!0),nl(this,n[4]),this.a=sl(n[5]||"",!0),rl(this,n[6]||"",!0),this.g=sl(n[7]||"")):(this.h=!!e,this.c=new yl(null,this.h))}function Zh(t){return new $h(t)}function tl(t,e,n){t.f=n?sl(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function el(t,e,n){t.b=n?sl(e,!0):e}function nl(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rl(t,e,n){var r,i;e instanceof yl?(t.c=e,r=t.c,(i=t.h)&&!r.f&&(ml(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(vl(this,e),bl(this,n,t))},r)),r.f=i):(n||(e=ul(e,pl)),t.c=new yl(e,t.h))}function il(t,e,n){t.c.set(e,n)}function ol(t,e,n){Du(n)||(n=[String(n)]),bl(t.c,e,n)}function al(t){return il(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^qu()).toString(36)),t}function sl(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ul(t,e,n){return Iu(t)?(t=encodeURI(t).replace(e,cl),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cl(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$h.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ul(e,hl,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(ul(e,hl,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(ul(n,"/"==n.charAt(0)?fl:ll,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",ul(n,dl)),t.join("")},$h.prototype.resolve=function(t){var e=Zh(this),n=!!t.f;n?tl(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?el(e,t.b):n=null!=t.i;var r=t.a;if(n)nl(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Yu(i,"./")||Yu(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rl(e,wl(t.c)):n=!!t.g,n&&(e.g=t.g),e};var hl=/[#\/\?@]/g,ll=/[#\?:]/g,fl=/[#\?]/g,pl=/[#\?@]/g,dl=/#/g;function yl(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function ml(n){n.a||(n.a=new Gh,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function vl(t,e){ml(t),e=_l(t,e),Xh(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,zh(t.a,e))}function gl(t,e){return ml(t),e=_l(t,e),Xh(t.a.b,e)}function bl(t,e,n){vl(t,e),0<n.length&&(t.c=null,t.a.set(_l(t,e),Qu(n)),t.b+=n.length)}function wl(t){var e=new yl;return e.c=t.c,t.a&&(e.a=new Gh(t.a),e.b=t.b),e}function _l(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function El(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Tl(t){var e=t.a.F.a;if(null!=e)vh(4),e?(vh(10),ff(t.a,t,!1)):(vh(11),ff(t.a,t,!0));else{t.b=new Dh(t,void 0,void 0),t.b.h=t.h,e=vf(e=t.a,e.Y()?t.f:null,t.i),vh(4),ol(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&il(e,n,r),Mh(t.b,e,!1,t.f)}}function Sl(){this.a=this.b=null}function Il(){this.a=new Gh}function Cl(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Pu]||(t[Pu]=++xu)):e.charAt(0)+t}function Nl(t,e){this.b=t,this.a=e}function Al(t){this.g=t||kl,t=Su.PerformanceNavigationTiming?0<(t=Su.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Su.ka&&Su.ka.Ea&&Su.ka.Ea()&&Su.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Il),this.b=null,this.c=[]}(_u=yl.prototype).add=function(t,e){ml(this),this.c=null,t=_l(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},_u.forEach=function(n,r){ml(this),this.a.forEach(function(t,e){Wu(t,function(t){n.call(r,t,e,this)},this)},this)},_u.K=function(){ml(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_u.C=function(t){ml(this);var e=[];if(Iu(t))gl(this,t)&&(e=Ku(e,this.a.get(_l(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Ku(e,t[n])}return e},_u.set=function(t,e){return ml(this),this.c=null,gl(this,t=_l(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},_u.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},_u.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Vu(function(){},function(){}),(_u=El.prototype).M=null,_u.$=function(t){return this.a.$(t)},_u.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},_u.Da=function(){return!1},_u.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Zl(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Zl(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yf(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yf(e,2)}else 1==this.M&&(this.g?vh(6):"11111"==e?(vh(5),this.g=!0,(!sc||10<=Number(mc))&&(this.c=200,this.b.cancel(),vh(11),ff(this.a,this,!0))):(vh(7),this.g=!1))},_u.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Tl(this)):1==this.M&&(this.g?(vh(11),ff(this.a,this,!0)):(vh(10),ff(this.a,this,!1)));else{0==this.M?vh(8):1==this.M&&vh(9);var t=this.a;t.m=this.c,yf(t,2)}},_u.Y=function(){return this.a.Y()},_u.ma=function(){return this.a.ma()},Il.prototype.add=function(t){this.a.set(Cl(t),t)},Il.prototype.C=function(){return this.a.C()};var kl=10;function Dl(t,e){!t.a&&(Yu(e,"spdy")||Yu(e,"quic")||Yu(e,"h2"))&&(t.f=t.g,t.a=new Il,t.b&&(xl(t,t.b),t.b=null))}function Rl(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Ol(t){return t.b?1:t.a?t.a.a.c:0}function Pl(t,e){return t=t.b?t.b==e:!!t.a&&(e=Cl(e),Xh(t.a.a.b,e))}function xl(t,e){t.a?t.a.add(e):t.b=e}function Ml(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Cl(e),n=Xh(t.a.a.b,n)),n&&zh(t.a.a,Cl(e)))}function Ll(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Qu(t.c);var e=t.c;return Wu(t.a.C(),function(t){e=e.concat(t.j)}),e}function Fl(){}function Ul(){this.a=new Fl}function ql(t,r,e){var i=e||"";try{Qh(t,function(t,e){var n=t;Ou(t)&&(n=Hc(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Vl(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Al.prototype.cancel=function(){var t;this.c=Ll(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Wu(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},Fl.prototype.stringify=function(t){return Su.JSON.stringify(t,void 0)},Fl.prototype.parse=function(t){return Su.JSON.parse(t,void 0)};var Bl=Su.JSON.parse;function jl(t){Kc.call(this),this.headers=new Gh,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Wl,this.D=this.F=!1}Vu(jl,Kc);var Wl="",Kl=/^https?$/i,Ql=["POST","PUT"];function Hl(t){return"content-type"==t.toLowerCase()}function Gl(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,zl(t),Xl(t)}function zl(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Yl(t){if(t.b&&void 0!==Tu&&(!t.s[1]||4!=$l(t)||2!=t.T()))if(t.l&&4==$l(t))oh(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==$l(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Jh)[1]||null;if(!o&&Su.self&&Su.self.location){var a=Su.self.location.protocol;o=a.substr(0,a.length-1)}i=!Kl.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",zl(t))}finally{Xl(t)}}}function Xl(t,e){if(t.a){Jl(t);var n=t.a,r=t.s[0]?Au:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Jl(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Su.clearTimeout(t.m),t.m=null)}function $l(t){return t.a?t.a.readyState:0}function Zl(t,e){return t.a?t.a.getResponseHeader(e):null}function tf(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;var i;if(i="",Zu(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,Iu(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var o=""}else o=t.substring(r+1,n);n=(t=[t.substr(0,r),o,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return il(t,e,n),t}function ef(t){this.f=[],this.F=new Sl,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!Nu("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=Nu("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=Nu("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=Nu("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=Nu("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Al(t&&t.concurrentRequestLimit),this.ja=new Ul,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function nf(t){if(rf(t),3==t.u){var e=t.P++,n=Zh(t.B);il(n,"SID",t.H),il(n,"RID",e),il(n,"TYPE","terminate"),uf(t,n),(e=new Dh(t,e,void 0)).F=2,e.f=al(Zh(n)),n=!1,Su.navigator&&Su.navigator.sendBeacon&&(n=Su.navigator.sendBeacon(e.f.toString(),"")),!n&&Su.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=qu(),qh(e)}mf(t)}function rf(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(Su.clearTimeout(t.l),t.l=null),pf(t),t.b.cancel(),t.h&&(Cu(t.h)&&Su.clearTimeout(t.h),t.h=null)}function of(t,e){t.f.push(new Nl(t.Ra++,e)),3==t.u&&af(t)}function af(t){Rl(t.b)||t.h||(t.h=!0,Zc(t.Ia,t),t.A=0)}function sf(t,e){var n;n=e?e.W:t.P++;var r=Zh(t.B);il(r,"SID",t.H),il(r,"RID",n),il(r,"AID",t.O),uf(t,r),t.g&&t.i&&tf(r,t.g,t.i),n=new Dh(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=cf(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),xl(t.b,n),xh(n,r,e)}function uf(t,n){t.c&&Qh({},function(t,e){il(n,e,t)})}function cf(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Fu(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{ql(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function hf(t){t.a||t.l||(t.S=1,Zc(t.Ha,t),t.v=0)}function lf(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=bh(Fu(t.Ha,t),df(t,t.v)),t.v++,!0)}function ff(t,e,n){var r=e.l;r&&Dl(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=vf(t,null,t.ha),af(t)}function pf(t){null!=t.s&&(Su.clearTimeout(t.s),t.s=null)}function df(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function yf(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Fu(t.fb,t);n||(n=new $h("//www.google.com/images/cleardot.gif"),Su.location&&"http"==Su.location.protocol||tl(n,"https"),al(n)),function(t,e){var n=new fh;if(Su.Image){var r=new Image;r.onload=Uu(Vl,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Uu(Vl,n,r,"TestLoadImage: error",!1,e),r.onabort=Uu(Vl,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Uu(Vl,n,r,"TestLoadImage: timeout",!1,e),Su.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else vh(2);t.u=0,t.c&&t.c.ta(e),mf(t),rf(t)}function mf(t){t.u=0,t.m=-1,t.c&&(0==Ll(t.b).length&&0==t.f.length||(t.b.c.length=0,Qu(t.f),t.f.length=0),t.c.sa())}function vf(t,e,n){var r,i,o,a,s,u,c=(r=n)instanceof $h?Zh(r):new $h(r,void 0);if(""!=c.b)e&&el(c,e+"."+c.b),nl(c,c.i);else{var h,l=Su.location;h=e?e+"."+l.hostname:l.hostname,i=l.protocol,o=h,a=+l.port,s=n,u=new $h(null,void 0),i&&tl(u,i),o&&el(u,o),a&&nl(u,a),s&&(u.a=s),c=u}return t.V&&Zu(t.V,function(t,e){il(c,e,t)}),e=t.j,n=t.I,e&&n&&il(c,e,n),il(c,"VER",t.wa),uf(t,c),c}function gf(){}function bf(){if(sc&&!(10<=Number(mc)))throw Error("Environmental error: no available transport.")}function wf(t,e){Kc.call(this),this.a=new ef(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Hu(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hu(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Tf(this)}function _f(t){Nh.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ef(){Ah.call(this),this.status=1}function Tf(t){this.a=t}(_u=jl.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Th(this.H):Th(Ih),this.a.onreadystatechange=Fu(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Gl(this,t)}t=n||"";var i,o=new Gh(this.headers);r&&Qh(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Hl,n=t.length,r=Iu(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Iu(t)?t.charAt(e):t[e]}(o.K()),n=Su.FormData&&t instanceof Su.FormData,!(0<=ju(Ql,e))||r||n||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Jl(this),0<this.o&&((this.D=(i=this.a,sc&&gc(9)&&Cu(i.timeout)&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=Fu(this.Ca,this)):this.m=oh(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Gl(this,t)}},_u.Ca=function(){void 0!==Tu&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},_u.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Xl(this))},_u.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Xl(this,!0)),jl.N.G.call(this)},_u.Fa=function(){this.j||(this.w||this.l||this.g?Yl(this):this.$a())},_u.$a=function(){Yl(this)},_u.T=function(){try{return 2<$l(this)?this.a.status:-1}catch(t){return-1}},_u.za=function(){try{return 2<$l(this)?this.a.statusText:""}catch(t){return""}},_u.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},_u.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Bl(e)}},_u.ya=function(){return this.h},_u.Ya=function(){return Iu(this.f)?this.f:String(this.f)},(_u=ef.prototype).wa=8,_u.u=1,_u.Da=function(){return 0==this.u},_u.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Dh(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?nc(r=tc(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Iu(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=cf(this,n,e),il(i=Zh(this.B),"RID",t),il(i,"CVER",22),this.o&&this.j&&il(i,"X-HTTP-Session-Id",this.j),uf(this,i),this.g&&r&&tf(i,this.g,r),xl(this.b,n),this.W?(il(i,"$req",e),il(i,"SID","null"),n.S=!0,xh(n,i,null)):xh(n,i,e),this.u=2}}else 3==this.u&&(t?sf(this,t):0==this.f.length||Rl(this.b)||sf(this))},_u.Ha=function(){this.l=null,this.a=new Dh(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Zh(this.pa);il(t,"RID","rpc"),il(t,"SID",this.H),il(t,"CI",this.ia?"0":"1"),il(t,"AID",this.O),uf(this,t),il(t,"TYPE","xmlhttp"),this.g&&this.i&&tf(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Mh(this.a,t,!0,this.ga)},_u.Ga=function(t,e){if(0!=this.u&&(this.a==t||Pl(this.b,t)))if(this.m=t.o,!t.s&&Pl(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Du(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pf(this),this.a.cancel(),this.a=null}lf(this),vh(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=bh(Fu(this.Za,this),6e3));if(Ol(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yf(this,11)}else if((t.s||this.a==t)&&pf(this),!Hu(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Cu(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Zl(r,"X-Client-Wire-Protocol"))&&Dl(this.b,i),this.j&&(r=Zl(r,"X-HTTP-Session-Id")))&&(this.I=r,il(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=vf(this,this.Y()?this.ga:null,this.ha),r.s?(Ml(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Bh(r),qh(r)),this.a=r):hf(this),0<this.f.length&&af(this)}else"stop"!=r[0]&&"close"!=r[0]||yf(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yf(this,7):nf(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},_u.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,lf(this),vh(19))},_u.na=function(t){var e,n,r=null;if(this.a==t){pf(this),this.a=null;var i=2}else{if(!Pl(this.b,t))return;r=t.j,Ml(this.b,t),i=1}if(this.m=t.o,0!=this.u)if(t.b)1==i?(r=qu()-t.v,ph.dispatchEvent(new gh(ph,t.l?t.l.length:0,r,this.A)),af(this)):hf(this);else{var o=t.c;if(3==o||0==o&&0<this.m||(1!=i||(n=t,Ol((e=this).b)>=e.b.f-(e.h?1:0)||(e.h?(e.f=n.j.concat(e.f),0):1==e.u||2==e.u||e.A>=(e.Pa?0:e.Qa)||(e.h=bh(Fu(e.Ia,e,n),df(e,e.A)),e.A++,0))))&&(2!=i||!lf(this)))switch(r&&0<r.length&&(t=this.b,t.c=t.c.concat(r)),o){case 1:yf(this,5);break;case 4:yf(this,10);break;case 3:yf(this,6);break;default:yf(this,2)}}},_u.fb=function(t){vh(t?2:1)},_u.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new jl(this.La)).F=this.R,t},_u.ma=function(){return!!this.c&&!0},_u.Y=function(){return this.R},(_u=gf.prototype).va=function(){},_u.ua=function(){},_u.ta=function(){},_u.sa=function(){},_u.Ta=function(){},bf.prototype.a=function(t,e){return new wf(t,e)},Vu(wf,Kc),(_u=wf.prototype).addEventListener=function(t,e,n,r){wf.N.addEventListener.call(this,t,e,n,r)},_u.removeEventListener=function(t,e,n,r){wf.N.removeEventListener.call(this,t,e,n,r)},_u.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;vh(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new El(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=tf(e,t.g,t.i)),(t=t.w).i=n,e=vf(t.a,null,t.i),vh(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Tl(t)):(ol(e,"MODE","init"),!t.a.o&&t.a.j&&ol(e,"X-HTTP-Session-Id",t.a.j),t.b=new Dh(t,void 0,void 0),t.b.h=t.h,Mh(t.b,e,!1,null),t.M=0)},_u.close=function(){nf(this.a)},_u.Xa=function(t){if(Iu(t)){var e={};e.__data__=t,of(this.a,e)}else this.h?((e={}).__data__=Hc(t),of(this.a,e)):of(this.a,t)},_u.G=function(){this.a.c=null,delete this.f,nf(this.a),delete this.a,wf.N.G.call(this)},Vu(_f,Nh),Vu(Ef,Ah),Vu(Tf,gf),Tf.prototype.va=function(){this.a.dispatchEvent("a")},Tf.prototype.ua=function(t){this.a.dispatchEvent(new _f(t))},Tf.prototype.ta=function(t){this.a.dispatchEvent(new Ef(t))},Tf.prototype.sa=function(){this.a.dispatchEvent("b")};var Sf=Uu(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},bf);bf.prototype.createWebChannel=bf.prototype.a,wf.prototype.send=wf.prototype.Xa,wf.prototype.open=wf.prototype.Wa,wf.prototype.close=wf.prototype.close,wh.NO_ERROR=0,wh.TIMEOUT=8,wh.HTTP_ERROR=6,_h.COMPLETE="complete",(Sh.EventType=Ch).OPEN="a",Ch.CLOSE="b",Ch.ERROR="c",Ch.MESSAGE="d",Kc.prototype.listen=Kc.prototype.Aa,jl.prototype.listenOnce=jl.prototype.Ba,jl.prototype.getLastError=jl.prototype.Ya,jl.prototype.getLastErrorCode=jl.prototype.ya,jl.prototype.getStatus=jl.prototype.T,jl.prototype.getStatusText=jl.prototype.za,jl.prototype.getResponseJson=jl.prototype.Va,jl.prototype.getResponseText=jl.prototype.aa,jl.prototype.send=jl.prototype.ca;var If,Cf,Nf={createWebChannelTransport:Sf,ErrorCode:wh,EventType:_h,WebChannel:Sh,XhrIo:jl},Af=Nf.createWebChannelTransport,kf=Nf.ErrorCode,Df=Nf.EventType,Rf=Nf.WebChannel,Of=Nf.XhrIo,Pf=Hh.SDK_VERSION,xf=new Ji("@firebase/firestore");function Mf(){return xf.logLevel===Wi.DEBUG?If.DEBUG:xf.logLevel===Wi.SILENT?If.SILENT:If.ERROR}function Lf(t){switch(t){case If.DEBUG:xf.logLevel=Wi.DEBUG;break;case If.ERROR:xf.logLevel=Wi.ERROR;break;case If.SILENT:xf.logLevel=Wi.SILENT;break;default:xf.error("Firestore ("+Pf+"): Invalid value passed to `setLogLevel`")}}function Ff(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(xf.logLevel<=Wi.DEBUG){var i=n.map(qf);xf.debug.apply(xf,hi(["Firestore ("+Pf+") ["+t+"]: "+e],i))}}function Uf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xf.logLevel<=Wi.ERROR){var r=e.map(qf);xf.error.apply(xf,hi(["Firestore ("+Pf+"): "+t],r))}}function qf(e){if("string"==typeof e)return e;var t=jf.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Vf(t){var e="FIRESTORE ("+Pf+") INTERNAL ASSERTION FAILED: "+t;throw Uf(e),new Error(e)}function Bf(t,e){t||Vf(e)}(Cf=If||(If={}))[Cf.DEBUG=0]="DEBUG",Cf[Cf.ERROR=1]="ERROR",Cf[Cf.SILENT=2]="SILENT";var jf=function(){function e(){}return e.setPlatform=function(t){e.platform&&Vf("Platform already defined"),e.platform=t},e.getPlatform=function(){return e.platform||Vf("Platform not set"),e.platform},e}();function Wf(){return jf.getPlatform().emptyByteString}var Kf={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Qf=function(r){function t(t,e){var n=r.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}return ii(t,r),t}(Error);function Hf(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Qf(Kf.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Gf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zf(t,e){return void 0!==t?t:e}function Yf(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Xf(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Jf(t){for(var e in Bf(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function $f(t,e){if(0!==e.length)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+yp(e.length,"argument")+".")}function Zf(t,e,n){if(e.length!==n)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires "+yp(n,"argument")+", but was called with "+yp(e.length,"argument")+".")}function tp(t,e,n){if(e.length<n)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires at least "+yp(n,"argument")+", but was called with "+yp(e.length,"argument")+".")}function ep(t,e,n,r){if(e.length<n||e.length>r)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+yp(e.length,"argument")+".")}function np(t,e,n,r){up(t,e,dp(n)+" argument",r)}function rp(t,e,n,r){void 0!==r&&np(t,e,n,r)}function ip(t,e,n,r){up(t,e,n+" option",r)}function op(t,e,n,r){void 0!==r&&ip(t,e,n,r)}function ap(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+hp(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+hp(r[o]))}(t,e,n,r,i)}function sp(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){var o,a,s=[];try{for(var u=ui(i),c=u.next();!c.done;c=u.next()){var h=c.value;if(h===r)return;s.push(hp(h))}}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}var l=hp(r);throw new Qf(Kf.INVALID_ARGUMENT,"Invalid value "+l+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+s.join(", "))}(t,0,n,r,i)}function up(t,e,n,r){if(!("object"===e?cp(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=hp(r);throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function cp(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function hp(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Vf("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function lp(t,e,n){if(void 0===n)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+dp(e)+" argument, but it was undefined.")}function fp(n,t,r){Xf(t,function(t,e){if(r.indexOf(t)<0)throw new Qf(Kf.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function pp(t,e,n,r){var i=hp(r);return new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires its "+dp(n)+" argument to be a "+e+", but it was: "+i)}function dp(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function yp(t,e){return t+" "+e+(1===t?"":"s")}var mp=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Bf(20===e.length,"Invalid auto ID: "+e),e},t}();function vp(t,e){return t<e?-1:e<t?1:0}function gp(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function bp(t){return t+"\0"}function wp(){if("undefined"==typeof Uint8Array)throw new Qf(Kf.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function _p(){if(!jf.getPlatform().base64Available)throw new Qf(Kf.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ep,Tp,Sp=function(){function e(t){_p(),this._binaryString=t}return e.fromBase64String=function(t){Zf("Blob.fromBase64String",arguments,1),np("Blob.fromBase64String","string",1,t),_p();try{return new e(jf.getPlatform().atob(t))}catch(t){throw new Qf(Kf.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},e.fromUint8Array=function(t){if(Zf("Blob.fromUint8Array",arguments,1),wp(),!(t instanceof Uint8Array))throw pp("Blob.fromUint8Array","Uint8Array",1,t);return new e(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},e.prototype.toBase64=function(){return Zf("Blob.toBase64",arguments,0),_p(),jf.getPlatform().btoa(this._binaryString)},e.prototype.toUint8Array=function(){Zf("Blob.toUint8Array",arguments,0),wp();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._binaryString===t._binaryString},e.prototype._compareTo=function(t){return vp(this._binaryString,t._binaryString)},e}(),Ip=Hf(Sp,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Cp=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Np="(default)",Ap=function(){function e(t,e){this.projectId=t,this.database=e||Np}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database===Np},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e.prototype.compareTo=function(t){return vp(this.projectId,t.projectId)||vp(this.database,t.database)},e}(),kp=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Dp="__name__",Rp=function(){function n(t,e,n){this.init(t,e,n)}return n.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Vf("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Vf("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},n.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(n.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),n.prototype.isEqual=function(t){return 0===n.comparator(this,t)},n.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(function(t){e.push(t)}):"string"==typeof t?e.push(t):Vf("Unknown parameter type for Path.child(): "+t),this.construct(e)},n.prototype.limit=function(){return this.offset+this.length},n.prototype.popFirst=function(t){return t=void 0===t?1:t,Bf(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},n.prototype.popLast=function(){return Bf(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},n.prototype.firstSegment=function(){return Bf(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},n.prototype.lastSegment=function(){return this.get(this.length-1)},n.prototype.get=function(t){return Bf(t<this.length,"Index out of range"),this.segments[this.offset+t]},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},n.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},n.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},n}(),Op=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(0<=t.indexOf("//"))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return 0<t.length}))},e.EMPTY_PATH=new e([]),e}(Rp),Pp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,xp=function(t){function u(){return null!==t&&t.apply(this,arguments)||this}return ii(u,t),u.isValidIdentifier=function(t){return Pp.test(t)},u.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),u.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},u.prototype.toString=function(){return this.canonicalString()},u.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Dp},u.keyField=function(){return new u([Dp])},u.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Qf(Kf.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Qf(Kf.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Qf(Kf.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new u(e)},u.EMPTY_PATH=new u([]),u}(Rp),Mp=function(){function e(t){this.path=t,Bf(e.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}return e.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===Op.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,e){return Op.comparator(t.path,e.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new Op(t.slice()))},e.fromPathString=function(t){return new e(Op.fromString(t))},e.EMPTY=new e(new Op([])),e}(),Lp=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(Tp=Ep||(Ep={})).All="all",Tp.ListenStreamIdle="listen_stream_idle",Tp.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Tp.WriteStreamIdle="write_stream_idle",Tp.WriteStreamConnectionBackoff="write_stream_connection_backoff",Tp.OnlineStateTimeout="online_state_timeout",Tp.ClientMetadataRefresh="client_metadata_refresh",Tp.LruGarbageCollection="lru_garbage_collection";var Fp=function(){function a(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Lp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return a.createAndSchedule=function(t,e,n,r,i){var o=new a(t,e,Date.now()+n,r,i);return o.start(n),o},a.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},a.prototype.skipDelay=function(){return this.handleDelayElapsed()},a.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qf(Kf.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},a.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},a.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},a}(),Up=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var n=this;this.verifyNotFailed();var e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Uf("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Bf(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Bf(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Fp.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Vf("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Bf(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){var e,n;try{for(var r=ui(this.delayedOperations),i=r.next();!i.done;i=r.next()){if(i.value.timerId===t)return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!1},t.prototype.runDelayedOperationsEarly=function(o){var a=this;return this.drain().then(function(){var e,t;Bf(o===Ep.All||a.containsDelayedOperation(o),"Attempted to drain to missing operation "+o),a.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});try{for(var n=ui(a.delayedOperations),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.skipDelay(),o!==Ep.All&&i.timerId===o)break}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return a.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Bf(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),qp="",Vp="",Bp="",jp="";function Wp(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Qp(e)),e=Kp(t.get(n),e);return Qp(e)}function Kp(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=qp+Bp;break;case qp:n+=qp+jp;break;default:n+=o}}return n}function Qp(t){return t+qp+Vp}function Hp(t){var e=t.length;if(Bf(2<=e,"Invalid path "+t),2===e)return Bf(t.charAt(0)===qp&&t.charAt(1)===Vp,"Non-empty path "+t+" had length 2"),Op.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(qp,o);switch((a<0||n<a)&&Vf('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Vp:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Bp:i+=t.substring(o,a),i+="\0";break;case jp:i+=t.substring(o,a+1);break;default:Vf('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Op(r)}var Gp=function(){function n(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Qf(Kf.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Qf(Kf.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Qf(Kf.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Qf(Kf.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return n.now=function(){return n.fromMillis(Date.now())},n.fromDate=function(t){return n.fromMillis(t.getTime())},n.fromMillis=function(t){var e=Math.floor(t/1e3);return new n(e,1e6*(t-1e3*e))},n.prototype.toDate=function(){return new Date(this.toMillis())},n.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},n.prototype._compareTo=function(t){return this.seconds===t.seconds?vp(this.nanoseconds,t.nanoseconds):vp(this.seconds,t.seconds)},n.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},n.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},n}(),zp=function(){function n(t){this.timestamp=t}return n.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new n(new Gp(e,t%1e6*1e3))},n.fromTimestamp=function(t){return new n(t)},n.forDeletedDoc=function(){return n.MIN},n.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},n.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},n.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},n.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},n.prototype.toTimestamp=function(){return this.timestamp},n.MIN=new n(new Gp(0,0)),n}(),Yp=function(){function n(t,e){this.comparator=t,this.root=e||Jp.EMPTY}return n.prototype.insert=function(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jp.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jp.BLACK,null,null))},n.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},n.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},n.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(n.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),n.prototype.minKey=function(){return this.root.minKey()},n.prototype.maxKey=function(){return this.root.maxKey()},n.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},n.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},n.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},n.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},n.prototype.getIterator=function(){return new Xp(this.root,null,this.comparator,!1)},n.prototype.getIteratorFrom=function(t){return new Xp(this.root,t,this.comparator,!1)},n.prototype.getReverseIterator=function(){return new Xp(this.root,null,this.comparator,!0)},n.prototype.getReverseIteratorFrom=function(t){return new Xp(this.root,t,this.comparator,!0)},n}(),Xp=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Bf(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return 0<this.nodeStack.length},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Jp=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:o.EMPTY,this.right=null!=i?i:o.EMPTY,this.size=this.left.size+1+this.right.size}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},o.prototype.minKey=function(){return this.min().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},o.prototype.removeMin=function(){if(this.left.isEmpty())return o.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},o.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return o.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},o.prototype.isRed=function(){return this.color},o.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},o.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},o.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},o.prototype.rotateLeft=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},o.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Vf("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Vf("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Vf("Black depths differ");return t+(this.isRed()?0:1)},o.EMPTY=null,o.RED=!0,o.BLACK=!1,o}(),$p=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Jp(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();Jp.EMPTY=new $p;var Zp=function(){function o(t){this.comparator=t,this.data=new Yp(this.comparator)}return o.fromMapKeys=function(t){var e=new o(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},o.prototype.has=function(t){return null!==this.data.get(t)},o.prototype.first=function(){return this.data.minKey()},o.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(o.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),o.prototype.indexOf=function(t){return this.data.indexOf(t)},o.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},o.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},o.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},o.prototype.getIterator=function(){return new td(this.data.getIterator())},o.prototype.getIteratorFrom=function(t){return new td(this.data.getIteratorFrom(t))},o.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},o.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},o.prototype.isEmpty=function(){return this.data.isEmpty()},o.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},o.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},o.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},o.prototype.copy=function(t){var e=new o(this.comparator);return e.data=t,e},o}(),td=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ed=new Yp(Mp.comparator);function nd(){return ed}function rd(){return nd()}var id=new Yp(Mp.comparator);function od(){return id}var ad=new Yp(Mp.comparator);function sd(){return ad}var ud=new Zp(Mp.comparator);function cd(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=ud;try{for(var o=ui(n),a=o.next();!a.done;a=o.next()){var s=a.value;i=i.add(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return i}var hd=new Zp(vp);function ld(){return hd}var fd=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Bf(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Bf(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Bf(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){var n,r,i,o;e&&Bf(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);try{for(var a=ui(this.baseMutations),s=a.next();!s.done;s=a.next()){(l=s.value).key.isEqual(t)&&(e=l.applyToLocalView(e,e,this.localWriteTime))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}var u=e;try{for(var c=ui(this.mutations),h=c.next();!h.done;h=c.next()){var l;(l=h.value).key.isEqual(t)&&(e=l.applyToLocalView(e,u,this.localWriteTime))}}catch(t){i={error:t}}finally{try{h&&!h.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}return e},t.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cd())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&gp(this.mutations,t.mutations)&&gp(this.baseMutations,t.baseMutations)},t}(),pd=function(){function s(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return s.from=function(t,e,n,r){Bf(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=sd(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new s(t,e,n,r,i)},s}(),dd=function(){function s(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return s.prototype.catch=function(t){return this.next(void 0,t)},s.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Vf("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new s(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},s.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},s.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof s?e:s.resolve(e)}catch(t){return s.reject(t)}},s.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):s.resolve(e)},s.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):s.reject(e)},s.resolve=function(n){return new s(function(t,e){t(n)})},s.reject=function(n){return new s(function(t,e){e(n)})},s.waitFor=function(t){return new s(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},s.or=function(t){var e,n,r=s.resolve(!1),i=function(e){r=r.next(function(t){return t?s.resolve(t):e()})};try{for(var o=ui(t),a=o.next();!a.done;a=o.next()){i(a.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},s.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},s}(),yd=function(){function i(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return i.forUser=function(t,e,n,r){return Bf(""!==t.uid,"UserID must not be an empty string."),new i(t.isAuthenticated()?t.uid:"",e,n,r)},i.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bd(t).iterate({index:oy.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},i.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=gd(n),_d(e).put(t)})},i.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},i.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=gd(n),_d(e).put(t)})},i.prototype.addMutationBatch=function(h,l,f,p){var d=this,y=wd(h),m=bd(h);return m.add({}).next(function(t){var e,n;Bf("number"==typeof t,"Auto-generated key is not a number");var r=new fd(t,l,f,p),i=d.serializer.toDbMutationBatch(d.userId,r);d.documentKeysByBatchId[t]=r.keys();var o=[];try{for(var a=ui(p),s=a.next();!s.done;s=a.next()){var u=s.value,c=ay.key(d.userId,u.key.path,t);o.push(m.put(i)),o.push(y.put(c,ay.PLACEHOLDER)),o.push(d.indexManager.addToCollectionParentIndex(h,u.key.path.popLast()))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return dd.waitFor(o).next(function(){return r})})},i.prototype.lookupMutationBatch=function(t,e){var n=this;return bd(t).get(e).next(function(t){return t?(Bf(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},i.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?dd.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},i.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return bd(t).iterate({index:oy.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Bf(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},i.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bd(t).loadAll(oy.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},i.prototype.getAllMutationBatchesAffectingDocumentKey=function(u,c){var h=this,t=ay.prefixForPath(this.userId,c.path),e=IDBKeyRange.lowerBound(t),l=[];return wd(u).iterate({range:e},function(e,t,n){var r=ci(e,3),i=r[0],o=r[1],a=r[2],s=Hp(o);if(i===h.userId&&c.path.isEqual(s))return bd(u).get(a).next(function(t){if(!t)throw Vf("Dangling document-mutation reference found: "+e+" which points to "+a);Bf(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+a),l.push(h.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return l})},i.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var c=this,h=new Zp(vp),i=[];return t.forEach(function(u){var t=ay.prefixForPath(c.userId,u.path),e=IDBKeyRange.lowerBound(t),n=wd(r).iterate({range:e},function(t,e,n){var r=ci(t,3),i=r[0],o=r[1],a=r[2],s=Hp(o);i===c.userId&&u.path.isEqual(s)?h=h.add(a):n.done()});i.push(n)}),dd.waitFor(i).next(function(){return c.lookupMutationBatches(r,h)})},i.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var u=this;Bf(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Bf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var c=e.path,h=c.length+1,n=ay.prefixForPath(this.userId,c),r=IDBKeyRange.lowerBound(n),l=new Zp(vp);return wd(t).iterate({range:r},function(t,e,n){var r=ci(t,3),i=r[0],o=r[1],a=r[2],s=Hp(o);i===u.userId&&c.isPrefixOf(s)?s.length===h&&(l=l.add(a)):n.done()}).next(function(){return u.lookupMutationBatches(t,l)})},i.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(bd(t).get(e).next(function(t){if(null===t)throw Vf("Dangling document-mutation reference found, which points to "+e);Bf(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),dd.waitFor(i).next(function(){return r})},i.prototype.removeMutationBatch=function(e,n){var r=this;return vd(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),dd.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},i.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},i.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return dd.resolve();var e=IDBKeyRange.lowerBound(ay.prefixForUser(o.userId)),i=[];return wd(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Hp(t[1]);i.push(r)}else n.done()}).next(function(){Bf(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},i.prototype.containsKey=function(t,e){return md(t,this.userId,e)},i.prototype.getMutationQueueMetadata=function(t){var e=this;return _d(t).get(this.userId).next(function(t){return t||new iy(e.userId,-1,"")})},i}();function md(t,a,e){var n=ay.prefixForPath(a,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return wd(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=ci(t,3),i=r[0],o=r[1];r[2];i===a&&o===s&&(u=!0),n.done()}).next(function(){return u})}function vd(t,e,n){var r,i,o=t.store(oy.store),a=t.store(ay.store),s=[],u=IDBKeyRange.only(n.batchId),c=0,h=o.iterate({range:u},function(t,e,n){return c++,n.delete()});s.push(h.next(function(){Bf(1===c,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));var l=[];try{for(var f=ui(n.mutations),p=f.next();!p.done;p=f.next()){var d=p.value,y=ay.key(e,d.key.path,n.batchId);s.push(a.delete(y)),l.push(d.key)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}return dd.waitFor(s).next(function(){return l})}function gd(t){return t instanceof Uint8Array?(Bf("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function bd(t){return My.getStore(t,oy.store)}function wd(t){return My.getStore(t,ay.store)}function _d(t){return My.getStore(t,iy.store)}var Ed,Td;(Td=Ed||(Ed={}))[Td.QueryCache=0]="QueryCache",Td[Td.SyncEngine=1]="SyncEngine";var Sd=function(){function t(t,e){Bf((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},t.prototype.after=function(t){return this.seek(t+2),this.next()},t.prototype.seek=function(t){Bf((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(Ed.QueryCache,2)},t.forSyncEngine=function(){return new t(Ed.SyncEngine)},t}(),Id="SimpleDb",Cd=function(){function s(t){this.db=t,12.2===s.getIOSVersion(_i())&&Uf("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return s.openOrCreate=function(o,t,a){return Bf(s.isAvailable(),"IndexedDB not supported in current environment."),Ff(Id,"Opening database:",o),new dd(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new s(e))},i.onblocked=function(){r(new Qf(Kf.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Qf(Kf.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ff(Id,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new Ad(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,ty).next(function(){Ff(Id,"Database upgrade to version "+ty+" complete")})}}).toPromise()},s.delete=function(t){return Ff(Id,"Removing database:",t),Dd(window.indexedDB.deleteDatabase(t)).toPromise()},s.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=_i(),e=s.getIOSVersion(t),n=0<e&&e<10,r=s.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},s.getStore=function(t,e){return t.store(e)},s.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},s.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},s.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},s.prototype.runTransaction=function(t,e,n){var r=Ad.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),dd.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},s.prototype.close=function(){this.db.close()},s}(),Nd=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return Dd(this.dbCursor.delete())},t}(),Ad=function(){function r(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Lp,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=Od(t.target.error);n.completionDeferred.reject(e)}}return r.open=function(t,e,n){return new r(t.transaction(n,e))},Object.defineProperty(r.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),r.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Ff(Id,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},r.prototype.store=function(t){var e=this.transaction.objectStore(t);return Bf(!!e,"Object store not part of transaction: "+t),new kd(e)},r}(),kd=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){return Dd(void 0!==e?(Ff(Id,"PUT",this.store.name,t,e),this.store.put(e,t)):(Ff(Id,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},t.prototype.add=function(t){return Ff(Id,"ADD",this.store.name,t,t),Dd(this.store.add(t))},t.prototype.get=function(e){var n=this;return Dd(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ff(Id,"GET",n.store.name,e,t),t})},t.prototype.delete=function(t){return Ff(Id,"DELETE",this.store.name,t),Dd(this.store.delete(t))},t.prototype.count=function(){return Ff(Id,"COUNT",this.store.name),Dd(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Ff(Id,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(i){var t=this.cursor({});return new dd(function(n,r){t.onerror=function(t){var e=Od(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,a){var s=[];return new dd(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Nd(e),r=a(e.primaryKey,e.value,n);if(r instanceof dd){var i=r.catch(function(t){return n.done(),dd.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return dd.waitFor(s)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Bf(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Dd(t){return new dd(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Od(t.target.error);r(e)}})}var Rd=!1;function Od(t){var e=Cd.getIOSVersion(_i());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Qf("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Rd||(Rd=!0,setTimeout(function(){throw r},0)),r}}return t}var Pd=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Sd.forQueryCache()}return t.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return zp.fromTimestamp(new Gp(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Ld(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},t.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return xd(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Bf(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},t.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return xd(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return dd.waitFor(u)}).next(function(){return s})},t.prototype.forEachTarget=function(t,r){var i=this;return xd(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},t.prototype.retrieveMetadata=function(t){return Md(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,My.getStore(n,py.store)).put(py.key,e);var n},t.prototype.saveQueryData=function(t,e){return xd(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return xd(t).iterate({range:n,index:ly.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},t.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=Fd(n);return t.forEach(function(t){var e=Wp(t.path);o.push(a.put(new fy(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),dd.waitFor(o)},t.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=Fd(n);return dd.forEach(t,function(t){var e=Wp(t.path);return dd.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Fd(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Fd(t),o=cd();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Hp(t[1]),i=new Mp(r);o=o.add(i)}).next(function(){return o})},t.prototype.containsKey=function(t,e){var n=Wp(e.path),r=IDBKeyRange.bound([n],[bp(n)],!1,!0),o=0;return Fd(t).iterate({index:fy.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=ci(t,2),i=r[0];r[1];0!==i&&(o++,n.done())}).next(function(){return 0<o})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return xd(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function xd(t){return My.getStore(t,ly.store)}function Md(t){return Cd.getStore(t,py.store).get(py.key).next(function(t){return Bf(null!==t,"Missing metadata row."),t})}function Ld(t){return Md(t).next(function(t){return t.highestListenSequenceNumber})}function Fd(t){return My.getStore(t,fy.store)}var Ud=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return Mp.comparator(t.key,e.key)},t}(),qd=function(a){function e(t,e,n,r,i){var o=a.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}return ii(e,a),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Vf("Trying to compare documents on fields that don't exist")},e}(Ud),Vd=function(i){function e(t,e,n){var r=i.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}return ii(e,i),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Ud),Bd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Ud),jd=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e,n,r=this.mapKeyFn(t),i=this.inner[r];if(void 0!==i)try{for(var o=ui(i),a=o.next();!a.done;a=o.next()){var s=ci(a.value,2),u=s[0],c=s[1];if(u.isEqual(t))return c}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(c){Xf(this.inner,function(t,e){var n,r;try{for(var i=ui(e),o=i.next();!o.done;o=i.next()){var a=ci(o.value,2),s=a[0],u=a[1];c(s,u)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})},t.prototype.isEmpty=function(){return Jf(this.inner)},t}(),Wd=function(){function t(){this.changes=nd(),this.documentSizes=new jd(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?dd.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Bf(null!==this.changes,"Changes have already been applied."),this.changes},t}(),Kd="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Qd=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=Cd.getStore(t,my.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r,i,o=[];if(0<e.length){var a=zd(t),s=cd();try{for(var u=ui(e),c=u.next();!c.done;c=u.next()){var h=c.value,l=h.key,f=h.doc;o.push(a.put(Xd(l),f)),s=s.add(l),o.push(this.indexManager.addToCollectionParentIndex(t,l.path.popLast()))}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}this.keepDocumentChangeLog&&o.push(Yd(t).put({changes:this.serializer.toDbResourcePaths(s)})),o.push(this.updateSize(t,n))}return dd.waitFor(o)},t.prototype.removeEntry=function(t,e){var n=zd(t),r=Xd(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Jd(t)}):dd.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return zd(t).get(Xd(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return zd(t).get(Xd(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Jd(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=rd();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=rd(),i=new Yp(Mp.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Jd(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return dd.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return zd(t).iterate({range:n},function(t,e,n){for(var r=Mp.fromSegments(t);a&&Mp.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;Bf(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=od(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return zd(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof qd&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},t.prototype.getNewDocumentChanges=function(e){var r=this;Bf(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=cd(),i=nd(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Yd(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return dd.reject(new Qf(Kf.DATA_LOSS,Kd))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new Vd(n,zp.forDeletedDoc());i=i.insert(n,e)}))}),dd.waitFor(t)}).next(function(){return i})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Yd(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},t.prototype.newChangeBuffer=function(){return new Gd(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Hd(t).get(hy.key).next(function(t){return Bf(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return Hd(t).put(hy.key,e)},t.prototype.updateSize=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},t}();function Hd(t){return My.getStore(t,hy.store)}var Gd=function(n){function t(t){var e=n.call(this)||this;return e.documentCache=t,e}return ii(t,n),t.prototype.applyChanges=function(t){var o=this,e=this.assertChanges(),a=0,s=[];return e.forEach(function(t,e){var n=o.documentCache.serializer.toDbRemoteDocument(e),r=o.documentSizes.get(t);Bf(void 0!==r,"Attempting to change document "+t.toString()+" without having read it first");var i=Jd(n);a+=i-r,s.push({key:t,doc:n})}),this.documentCache.addEntries(t,s,a)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(Wd);function zd(t){return My.getStore(t,cy.store)}function Yd(t){return My.getStore(t,my.store)}function Xd(t){return t.path.toArray()}function Jd(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Vf("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var $d=function(){function t(){this.collectionParentIndex=new Zd}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),dd.resolve()},t.prototype.getCollectionParents=function(t,e){return dd.resolve(this.collectionParentIndex.getEntries(e))},t}(),Zd=function(){function t(){this.index={}}return t.prototype.add=function(t){Bf(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Zp(Op.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new Zp(Op.comparator)).toArray()},t}(),ty=8,ey=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,n,e,r){var i,o=this;Bf(e<r&&0<=e&&r<=ty,"Unexpected schema upgrade from v"+e+" to v{toVersion}."),e<1&&1<=r&&(t.createObjectStore(ry.store),(i=t).createObjectStore(iy.store,{keyPath:iy.keyPath}),i.createObjectStore(oy.store,{keyPath:oy.keyPath,autoIncrement:!0}).createIndex(oy.userMutationsIndex,oy.userMutationsKeyPath,{unique:!0}),i.createObjectStore(ay.store),yy(t),t.createObjectStore(cy.store));var a,s=dd.resolve();return e<3&&3<=r&&(0!==e&&((a=t).deleteObjectStore(fy.store),a.deleteObjectStore(ly.store),a.deleteObjectStore(py.store),yy(t)),s=s.next(function(){return t=n.store(py.store),e=new py(0,0,zp.MIN.toTimestamp(),0),t.put(py.key,e);var t,e})),e<4&&4<=r&&(0!==e&&(s=s.next(function(){return i=t,(o=n).store(oy.store).loadAll().next(function(t){i.deleteObjectStore(oy.store);var e=i.createObjectStore(oy.store,{keyPath:oy.keyPath,autoIncrement:!0});e.createIndex(oy.userMutationsIndex,oy.userMutationsKeyPath,{unique:!0});var n=o.store(oy.store),r=t.map(function(t){return n.put(t)});return dd.waitFor(r)});var i,o})),s=s.next(function(){t.createObjectStore(vy.store,{keyPath:vy.keyPath}),t.createObjectStore(my.store,{keyPath:"id",autoIncrement:!0})})),e<5&&5<=r&&(s=s.next(function(){return o.removeAcknowledgedMutations(n)})),e<6&&6<=r&&(s=s.next(function(){return t.createObjectStore(hy.store),o.addDocumentGlobal(n)})),e<7&&7<=r&&(s=s.next(function(){return o.ensureSequenceNumbers(n)})),e<8&&8<=r&&(s=s.next(function(){return o.createCollectionParentIndex(t,n)})),s},t.prototype.addDocumentGlobal=function(e){var n=0;return e.store(cy.store).iterate(function(t,e){n+=Jd(e)}).next(function(){var t=new hy(n);return e.store(hy.store).put(hy.key,t)})},t.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(iy.store),e=r.store(oy.store);return t.loadAll().next(function(t){return dd.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(oy.userMutationsIndex,t).next(function(t){return dd.forEach(t,function(t){Bf(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return vd(r,n.userId,e).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var a=t.store(fy.store),e=t.store(cy.store);return Ld(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Op(t),r=[0,Wp(n)];o.push(a.get(r).next(function(t){return t?dd.resolve():(e=n,a.put(new fy(0,Wp(e),i)));var e}))}).next(function(){return dd.waitFor(o)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(dy.store,{keyPath:dy.keyPath});var r=e.store(dy.store),i=new Zd,o=function(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Wp(n)})}};return e.store(cy.store).iterate({keysOnly:!0},function(t,e){var n=new Op(t);return o(n.popLast())}).next(function(){return e.store(ay.store).iterate({keysOnly:!0},function(t,e){var n=ci(t,3),r=(n[0],n[1]),i=(n[2],Hp(r));return o(i.popLast())})})},t}();var ny=function(t,e){this.seconds=t,this.nanoseconds=e},ry=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var iy=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),oy=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var ay=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Wp(e)]},t.key=function(t,e,n){return[t,Wp(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var sy=function(t,e){this.path=t,this.readTime=e},uy=function(t,e){this.path=t,this.version=e},cy=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),hy=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var ly=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),fy=function(){function t(t,e,n){this.targetId=t,this.path=e,Bf(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),py=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),dy=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function yy(t){t.createObjectStore(fy.store,{keyPath:fy.keyPath}).createIndex(fy.documentTargetsIndex,fy.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ly.store,{keyPath:ly.keyPath}).createIndex(ly.queryTargetsIndexName,ly.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(py.store)}var my=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var vy=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var gy,by,wy=hi(hi(hi([iy.store,oy.store,ay.store,cy.store,ly.store,ry.store,py.store,fy.store],[vy.store,my.store]),[hy.store]),[dy.store]),_y=function(){function t(){this.collectionParentsCache=new Zd}return t.prototype.addToCollectionParentIndex=function(t,e){if(Bf(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Bf(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Ey(t).put({collectionId:n,parent:Wp(r)})}return dd.resolve()},t.prototype.getCollectionParents=function(t,a){var s=[],e=IDBKeyRange.bound([a,""],[bp(a),""],!1,!0);return Ey(t).loadAll(e).next(function(t){var e,n;try{for(var r=ui(t),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.collectionId!==a)break;s.push(Hp(o.parent))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return s})},t}();function Ey(t){return My.getStore(t,dy.store)}(by=gy||(gy={}))[by.Listen=0]="Listen",by[by.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",by[by.LimboResolution=2]="LimboResolution";var Ty=function(){function e(t,e,n,r,i,o){void 0===i&&(i=zp.MIN),void 0===o&&(o=Wf()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return e.prototype.copy=function(t){return new e(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},e.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},e}(),Sy=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Mp.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Vd(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=Mp.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Bd(e,n)}return Vf("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof qd){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new cy(null,null,e,n)}if(t instanceof Vd){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new cy(null,new sy(r,i),null,n)}if(t instanceof Bd){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new cy(new uy(r,i),null,null,!0)}return Vf("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new ny(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Gp(t.seconds,t.nanoseconds);return zp.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new oy(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Gp.fromMillis(t.localWriteTimeMs);return new fd(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Wp(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){var e,n,r=cd();try{for(var i=ui(t),o=i.next();!o.done;o=i.next()){var a=o.value;r=r.add(new Mp(Hp(a)))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Ty(e,t.targetId,gy.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Bf(gy.Listen===t.purpose,"Only queries with purpose "+gy.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Bf("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new ly(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Iy(t,e){var n=ci(t,2),r=n[0],i=n[1],o=ci(e,2),a=o[0],s=o[1],u=vp(r,a);return 0===u?vp(i,s):u}var Cy=function(){function t(t){this.maxElements=t,this.buffer=new Zp(Iy),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Iy(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Ny={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ay=function(){function e(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e.COLLECTION_DISABLED=-1,e.MINIMUM_CACHE_SIZE_BYTES=1048576,e.DEFAULT=new e(e.DEFAULT_CACHE_SIZE_BYTES=41943040,e.DEFAULT_COLLECTION_PERCENTILE=10,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),e.DISABLED=new e(e.COLLECTION_DISABLED,0,0),e}(),ky=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){Bf(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ay.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Bf(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Ff("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Ep.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Ly)})},t}(),Dy=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return dd.resolve(kp.INVALID);var r=new Cy(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===Ay.COLLECTION_DISABLED?(Ff("LruGarbageCollector","Garbage collection skipped; disabled"),dd.resolve(Ny)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Ff("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Ny):r.runGarbageCollection(e,n)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Ff("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){(c=Date.now(),Mf()<=If.DEBUG)&&Ff("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms");return dd.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},t}(),Ry="IndexedDbPersistence",Oy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Py="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",xy=function(r){function t(t,e){var n=r.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}return ii(t,r),t}(function(){}),My=function(){function c(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!c.isAvailable())throw new Qf(Kf.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new Wy(this,o),this.dbName=t+c.MAIN_DATABASE,this.serializer=new Sy(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new Pd(this.referenceDelegate,this.serializer),this.indexManager=new _y,this.remoteDocumentCache=new Qd(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new Qf(Kf.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}return c.getStore=function(t,e){if(t instanceof xy)return Cd.getStore(t.simpleDbTransaction,e);throw Vf("IndexedDbPersistence must use instances of IndexedDbTransaction")},c.createIndexedDbPersistence=function(n,r,i,o,a,s){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s)).start()];case 1:return t.sent(),[2,e]}})})},c.createMultiClientIndexedDbPersistence=function(n,r,i,o,a,s,u){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s,u)).start()];case 1:return t.sent(),[2,e]}})})},c.prototype.start=function(){var n=this;return Bf(!this.started,"IndexedDbPersistence double-started!"),Bf(null!==this.window,"Expected 'window' to be defined"),Cd.openOrCreate(this.dbName,ty,new ey(this.serializer)).then(function(t){return n.simpleDb=t,n.updateClientMetadataAndTryBecomePrimary()}).then(function(){return n.attachVisibilityHandler(),n.attachWindowUnloadHook(),n.scheduleClientMetadataAndPrimaryLeaseRefreshes(),n.startRemoteDocumentCache()}).then(function(){return n.simpleDb.runTransaction("readonly",[py.store],function(t){return Ld(t).next(function(t){var e=n.multiClientParams?n.multiClientParams.sequenceNumberSyncer:void 0;n.listenSequence=new kp(t,e)})})}).then(function(){n._started=!0}).catch(function(t){return n.simpleDb&&n.simpleDb.close(),Promise.reject(t)})},c.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",wy,function(t){return e.remoteDocumentCache.start(t)})},c.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},c.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},c.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},c.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",wy,function(n){return Uy(n).put(new vy(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},c.prototype.verifyPrimaryLease=function(t){var e=this;return Fy(t).get(ry.key).next(function(t){return dd.resolve(e.isLocalClient(t))})},c.prototype.removeClientMetadata=function(t){return Uy(t).delete(this.clientId)},c.prototype.maybeGarbageCollectMultiClientState=function(){return ai(this,void 0,void 0,function(){var r,i,o=this;return si(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=c.getStore(n,vy.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return dd.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,hi(t));return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},c.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Ep.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},c.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},c.prototype.canActAsPrimary=function(e){var i=this;return Fy(e).get(ry.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Qf(Kf.FAILED_PRECONDITION,Py);return!1}}return!(!i.networkEnabled||!i.inForeground)||Uy(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ff(Ry,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},c.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[ry.store,vy.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},c.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},c.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[vy.store],function(t){return Uy(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},c.clearPersistence=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return c.isAvailable()?(e=n+c.MAIN_DATABASE,[4,Cd.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(c.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),c.prototype.getMutationQueue=function(t){return Bf(this.started,"Cannot initialize MutationQueue before persistence is started."),yd.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},c.prototype.getQueryCache=function(){return Bf(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},c.prototype.getRemoteDocumentCache=function(){return Bf(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},c.prototype.getIndexManager=function(){return Bf(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},c.prototype.runTransaction=function(n,t,r){var i=this;return Ff(Ry,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",wy,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Uf("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Qf(Kf.FAILED_PRECONDITION,Oy);return r(new xy(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new xy(e,i.listenSequence.next()))})})},c.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Fy(t).get(ry.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Qf(Kf.FAILED_PRECONDITION,Py)})},c.prototype.acquireOrExtendPrimaryLease=function(t){var e=new ry(this.clientId,this.allowTabSynchronization,Date.now());return Fy(t).put(ry.key,e)},c.isAvailable=function(){return Cd.isAvailable()},c.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},c.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Fy(t);return n.get(ry.key).next(function(t){return e.isLocalClient(t)?(Ff(Ry,"Releasing primary lease."),n.delete(ry.key)):dd.resolve()})},c.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(n<t)||(Uf("Detected an update time that is in the future: "+t+" > "+n),!1))},c.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},c.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Bf(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},c.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},c.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Bf("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},c.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Ff(Ry,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Uf(Ry,"Failed to get zombied client id.",t),!1}},c.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Uf("Failed to set zombie client id.",t)}},c.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},c.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},c.MAIN_DATABASE="main",c}();function Ly(n){return ai(this,void 0,void 0,function(){return si(this,function(t){if((e=n).code!==Kf.FAILED_PRECONDITION||e.message!==Oy)throw n;var e;return Ff(Ry,"Unexpectedly lost primary lease"),[2]})})}function Fy(t){return t.store(ry.store)}function Uy(t){return t.store(vy.store)}var qy,Vy,By,jy,Wy=function(){function t(t,e){this.db=t,this.garbageCollector=new Dy(this,e)}return t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Ky(t,e)},t.prototype.removeReference=function(t,e){return Ky(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Ky(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?dd.resolve(!0):(r=e,i=!1,_d(n=t).iterateSerial(function(t){return md(n,t,r).next(function(t){return t&&(i=!0),dd.resolve(!t)})}).next(function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=0,s=0,u=[];return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return a++,o.removeOrphanedDocument(r,e).next(function(t){s+=t})});u.push(n)}}).next(function(){return dd.waitFor(u)}).next(function(){return o.db.getRemoteDocumentCache().updateSize(r,-s)}).next(function(){return a})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return dd.waitFor([Fd(t).delete((n=e,[0,Wp(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Ky(t,e)},t.prototype.forEachOrphanedDocument=function(t,a){var s,e=Fd(t),u=kp.INVALID;return e.iterate({index:fy.documentTargetsIndex},function(t,e){var n=ci(t,2),r=n[0],i=(n[1],e.path),o=e.sequenceNumber;0===r?(u!==kp.INVALID&&a(new Mp(Hp(s)),u),u=o,s=i):u=kp.INVALID}).next(function(){u!==kp.INVALID&&a(new Mp(Hp(s)),u)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Ky(t,e){return Fd(t).put((n=e,r=t.currentSequenceNumber,new fy(0,Wp(n.path),r)));var n,r}(Vy=qy||(qy={}))[Vy.NullValue=0]="NullValue",Vy[Vy.BooleanValue=1]="BooleanValue",Vy[Vy.NumberValue=2]="NumberValue",Vy[Vy.TimestampValue=3]="TimestampValue",Vy[Vy.StringValue=4]="StringValue",Vy[Vy.BlobValue=5]="BlobValue",Vy[Vy.RefValue=6]="RefValue",Vy[Vy.GeoPointValue=7]="GeoPointValue",Vy[Vy.ArrayValue=8]="ArrayValue",Vy[Vy.ObjectValue=9]="ObjectValue",(jy=By||(By={}))[jy.Default=0]="Default",jy[jy.Estimate=1]="Estimate",jy[jy.Previous=2]="Previous";var Qy=function(){function n(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return n.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new n(By.Estimate,e);case"previous":return new n(By.Previous,e);case"none":case void 0:return new n(By.Default,e);default:return Vf("fromSnapshotOptions() called with invalid options.")}},n}(),Hy=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Bf(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),vp(this.typeOrder,t.typeOrder)},t}(),Gy=function(e){function n(){var t=e.call(this)||this;return t.typeOrder=qy.NullValue,t.internalValue=null,t}return ii(n,e),n.prototype.value=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n},n.prototype.compareTo=function(t){return t instanceof n?0:this.defaultCompareTo(t)},n.INSTANCE=new n,n}(Hy),zy=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.BooleanValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?vp(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Hy),Yy=function(n){function r(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.NumberValue,e}return ii(r,n),r.prototype.value=function(t){return this.internalValue},r.prototype.compareTo=function(t){return t instanceof r?(e=this.internalValue,n=t.internalValue,e<n?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1):this.defaultCompareTo(t);var e,n},r}(Hy);function Xy(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Jy,$y,Zy=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Xy(this.internalValue,t.internalValue)},e}(Yy),tm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Xy(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Yy),em=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.StringValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?vp(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Hy),nm=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.TimestampValue,e}return ii(e,n),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof rm?-1:this.defaultCompareTo(t)},e}(Hy),rm=function(r){function e(t,e){var n=r.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=qy.TimestampValue,n}return ii(e,r),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===By.Estimate?new nm(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===By.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof nm?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Hy),im=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.BlobValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Hy),om=function(r){function n(t,e){var n=r.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=qy.RefValue,n}return ii(n,r),n.prototype.value=function(t){return this.key},n.prototype.isEqual=function(t){return t instanceof n&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},n.prototype.compareTo=function(t){if(t instanceof n){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Mp.comparator(this.key,t.key)}return this.defaultCompareTo(t)},n}(Hy),am=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.GeoPointValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Hy),sm=function(n){function a(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.ObjectValue,e}return ii(a,n),a.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},a.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},a.prototype.isEqual=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},a.prototype.compareTo=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=vp(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return vp(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},a.prototype.set=function(t,e){if(Bf(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof a||(n=a.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},a.prototype.delete=function(t){if(Bf(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new a(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof a){var n=e.delete(t.popFirst());return new a(this.internalValue.insert(t.firstSegment(),n))}return this},a.prototype.contains=function(t){return null!==this.field(t)},a.prototype.field=function(t){Bf(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof a?e.internalValue.get(t):null}),e},a.prototype.fieldMask=function(){var i=new Zp(xp.comparator);return this.internalValue.forEach(function(t,e){var n=new xp([t]);if(e instanceof a){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),cm.fromSet(i)},a.prototype.toString=function(){return this.internalValue.toString()},a.prototype.child=function(t){return this.internalValue.get(t)||void 0},a.prototype.setChild=function(t,e){return new a(this.internalValue.insert(t,e))},a.EMPTY=new a(new Yp(vp)),a}(Hy),um=function(n){function i(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=qy.ArrayValue,e}return ii(i,n),i.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},i.prototype.contains=function(t){var e,n;try{for(var r=ui(this.internalValue),i=r.next();!i.done;i=r.next()){if(i.value.isEqual(t))return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!1},i.prototype.forEach=function(t){this.internalValue.forEach(t)},i.prototype.isEqual=function(t){if(t instanceof i){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},i.prototype.compareTo=function(t){if(t instanceof i){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return vp(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},i.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},i}(Hy),cm=function(){function n(t){this.fields=t}return n.fromSet=function(t){return new n(t)},n.fromArray=function(t){var e=new Zp(xp.comparator);return t.forEach(function(t){return e=e.add(t)}),new n(e)},n.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},n.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},n}(),hm=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),lm=function(t,e){this.version=t,this.transformResults=e};($y=Jy||(Jy={}))[$y.Set=0]="Set",$y[$y.Patch=1]="Patch",$y[$y.Transform=2]="Transform",$y[$y.Delete=3]="Delete";var fm=function(){function e(t,e){this.updateTime=t,this.exists=e,Bf(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),e.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof qd&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof qd:(Bf(this.isNone,"Precondition should be empty"),!0)},e.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},e.NONE=new e,e}(),pm=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Bf(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof qd?t.version:zp.MIN},t}(),dm=function(i){function e(t,e,n){var r=i.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Jy.Set,r}return ii(e,i),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Bf(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new qd(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=pm.getPostMutationVersion(t);return new qd(this.key,r,this.value,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(pm),ym=function(o){function e(t,e,n,r){var i=o.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Jy.Patch,i}return ii(e,o),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Bf(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Bd(this.key,e.version);var n=this.patchDocument(t);return new qd(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=pm.getPostMutationVersion(t),i=this.patchDocument(t);return new qd(this.key,r,i,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof qd?t.data:sm.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},e}(pm),mm=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Jy.Transform,n.precondition=fm.exists(!0),n}return ii(e,r),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Bf(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Bd(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new qd(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new qd(this.key,r.version,o,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){var e,n,r=null;try{for(var i=ui(this.fieldTransforms),o=i.next();!o.done;o=i.next()){var a=o.value,s=t instanceof qd?t.field(a.field):void 0,u=a.transform.computeBaseValue(s||null);null!=u&&(r=null==r?sm.EMPTY.set(a.field,u):r.set(a.field,u))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&gp(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){Bf(t instanceof qd,"Unknown MaybeDocument type "+t);var e=t;return Bf(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];Bf(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof qd&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){var r,i,o=[];try{for(var a=ui(this.fieldTransforms),s=a.next();!s.done;s=a.next()){var u=s.value,c=u.transform,h=null;e instanceof qd&&(h=e.field(u.field)),null===h&&n instanceof qd&&(h=n.field(u.field)),o.push(c.applyToLocalView(h,t))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},e.prototype.transformObject=function(t,e){Bf(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(pm),vm=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.precondition=e,n.type=Jy.Delete,n}return ii(e,r),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Bf(null==e.transformResults,"Transform results received by DeleteMutation."),new Vd(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Bf(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Vd(this.key,zp.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(pm),gm=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},t.prototype.getDocumentInternal=function(t,o,a){return this.remoteDocumentCache.getEntry(t,o).next(function(t){var e,n;try{for(var r=ui(a),i=r.next();!i.done;i=r.next()){t=i.value.applyToLocalView(o,t)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,a){var s=rd();return e.forEach(function(t,e){var n,r;try{for(var i=ui(a),o=i.next();!o.done;o=i.next()){e=o.value.applyToLocalView(t,e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}s=s.insert(t,e)}),s},t.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},t.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=nd();return e.forEach(function(t,e){e||(e=new Vd(t,zp.forDeletedDoc())),n=n.insert(t,e)}),n})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Mp(e)).next(function(t){var e=od();return t instanceof qd&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;Bf(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=od();return this.indexManager.getCollectionParents(n,o).next(function(t){return dd.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},t.prototype.getDocumentsMatchingCollectionQuery=function(e,n){var d,y,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n).next(function(t){return d=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return y=t,r.addMissingBaseDocuments(e,y,d).next(function(t){var e,n,r,i;d=t;try{for(var o=ui(y),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(r=void 0,ui(s.mutations)),c=u.next();!c.done;c=u.next()){var h=c.value,l=h.key,f=d.get(l),p=h.applyToLocalView(f,f,s.localWriteTime);d=p instanceof qd?d.insert(l,p):d.remove(l)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}})}).next(function(){return d.forEach(function(t,e){n.matches(e)||(d=d.remove(t))}),d})},t.prototype.addMissingBaseDocuments=function(t,e,n){var r,i,o,a,s=cd();try{for(var u=ui(e),c=u.next();!c.done;c=u.next()){var h=c.value;try{for(var l=(o=void 0,ui(h.mutations)),f=l.next();!f.done;f=l.next()){var p=f.value;p instanceof ym&&null===n.get(p.key)&&(s=s.add(p.key))}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}var d=n;return this.remoteDocumentCache.getEntries(t,s).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof qd&&(d=d.insert(t,e))}),d})},t}(),bm=function(){function t(){this.refsByKey=new Zp(wm.compareByKey),this.refsByTarget=new Zp(wm.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new wm(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new wm(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=Mp.EMPTY,r=new wm(n,t),i=new wm(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=Mp.EMPTY,n=new wm(e,t),r=new wm(e,t+1),i=cd();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new wm(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),wm=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return Mp.comparator(t.key,e.key)||vp(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return vp(t.targetOrBatchId,e.targetOrBatchId)||Mp.comparator(t.key,e.key)},t}(),_m=function(){function l(t,e){this.persistence=t,this.localViewReferences=new bm,this.queryDataByTarget={},Bf(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new gm(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return l.prototype.handleUserChange=function(e){var S=this;return this.persistence.runTransaction("Handle user change","readonly",function(E){var T;return S.mutationQueue.getAllMutationBatches(E).next(function(t){return T=t,S.mutationQueue=S.persistence.getMutationQueue(e),S.localDocuments=new gm(S.remoteDocuments,S.mutationQueue,S.persistence.getIndexManager()),S.mutationQueue.getAllMutationBatches(E)}).next(function(t){var e,n,r,i,o,a,s,u,c=[],h=[],l=cd();try{for(var f=ui(T),p=f.next();!p.done;p=f.next()){var d=p.value;c.push(d.batchId);try{for(var y=(r=void 0,ui(d.mutations)),m=y.next();!m.done;m=y.next()){var v=m.value;l=l.add(v.key)}}catch(t){r={error:t}}finally{try{m&&!m.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(e)throw e.error}}try{for(var g=ui(t),b=g.next();!b.done;b=g.next()){d=b.value;h.push(d.batchId);try{for(var w=(s=void 0,ui(d.mutations)),_=w.next();!_.done;_=w.next()){v=_.value;l=l.add(v.key)}}catch(t){s={error:t}}finally{try{_&&!_.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}}}catch(t){o={error:t}}finally{try{b&&!b.done&&(a=g.return)&&a.call(g)}finally{if(o)throw o.error}}return S.localDocuments.getDocuments(E,l).next(function(t){return{affectedDocuments:t,removedBatchIds:c,addedBatchIds:h}})})})},l.prototype.localWrite=function(c){var h=this,l=Gp.now(),t=c.reduce(function(t,e){return t.add(e.key)},cd());return this.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.localDocuments.getDocuments(u,t).next(function(n){var e,t,r=[];try{for(var i=ui(c),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.extractBaseValue(n.get(a.key));null!=s&&r.push(new ym(a.key,s,s.fieldMask(),fm.exists(!0)))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return h.mutationQueue.addMutationBatch(u,l,r,c).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},l.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):dd.resolve(null)})})},l.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},l.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Bf(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},l.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},l.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},l.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},l.prototype.applyRemoteEvent=function(u){var c=this,h=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[],s=cd();Yf(u.targetChanges,function(t,e){var n=c.queryDataByTarget[t];if(n){e.addedDocuments.forEach(function(t){s=s.add(t)}),e.modifiedDocuments.forEach(function(t){s=s.add(t)}),a.push(c.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n;n=n.copy({resumeToken:r,snapshotVersion:u.snapshotVersion}),c.queryDataByTarget[t]=n,l.shouldPersistQueryData(i,n,e)&&a.push(c.queryCache.updateQueryData(o,n))}}});var i=nd(),n=cd();u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(h.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||e.version.isEqual(zp.MIN)||s.has(e.key)&&!n.hasPendingWrites||0<=e.version.compareTo(n.version)?(h.addEntry(e),i=i.insert(t,e)):Ff("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})}));var e=u.snapshotVersion;if(!e.isEqual(zp.MIN)){var t=c.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Bf(0<=e.compareTo(t),"Watch stream reverted to previous snapshot?? "+e+" < "+t),c.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,e)});a.push(t)}return dd.waitFor(a).next(function(){return h.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,i)})})},l.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size))},l.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return dd.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),dd.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},l.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},l.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},l.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,dd.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new Ty(r,t,gy.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Bf(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},l.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){Bf(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?dd.resolve():dd.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},l.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},l.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},l.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},l.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},l.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},l.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=dd.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Bf(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):Bf(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},l.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},l.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},l.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},l.RESUME_TOKEN_MAX_AGE_MICROS=3e8,l}(),Em=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Wf(),this.batchesByDocumentKey=new Zp(wm.compareByKey)}return t.prototype.checkEmpty=function(t){return dd.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Bf(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Bf(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,dd.resolve()},t.prototype.getLastStreamToken=function(t){return dd.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,dd.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){var i,o;Bf(0!==r.length,"Mutation batches should not be empty");var a=this.nextBatchId;(this.nextBatchId++,0<this.mutationQueue.length)&&Bf(this.mutationQueue[this.mutationQueue.length-1].batchId<a,"Mutation batchIDs must be monotonically increasing order");var s=new fd(a,e,n,r);this.mutationQueue.push(s);try{for(var u=ui(r),c=u.next();!c.done;c=u.next()){var h=c.value;this.batchesByDocumentKey=this.batchesByDocumentKey.add(new wm(h.key,a)),this.indexManager.addToCollectionParentIndex(t,h.key.path.popLast())}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return dd.resolve(s)},t.prototype.lookupMutationBatch=function(t,e){return dd.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Bf(null!=n,"Failed to find local mutation batch."),dd.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return dd.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return dd.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new wm(n,0),i=new wm(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Bf(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Bf(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),dd.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new Zp(vp);return e.forEach(function(e){var t=new wm(e,0),n=new wm(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Bf(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),dd.resolve(this.findMutationBatches(i))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Bf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Mp.isDocumentKey(i)||(i=i.child(""));var o=new wm(new Mp(i),0),a=new Zp(vp);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),dd.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},t.prototype.removeMutationBatch=function(n,r){var i=this;Bf(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return dd.forEach(r.mutations,function(t){var e=new wm(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new wm(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return dd.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Bf(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),dd.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Bf(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Bf(n.batchId===t,"If found batch must match"),n},t}(),Tm=function(){function t(t){this.persistence=t,this.queries=new jd(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=zp.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new bm,this.targetCount=0,this.targetIdGenerator=Sd.forQueryCache()}return t.prototype.getTargetCount=function(t){return dd.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),dd.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return dd.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return dd.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,dd.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),dd.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Bf(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,dd.resolve()},t.prototype.updateQueryData=function(t,e){return Bf(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),dd.resolve()},t.prototype.removeQueryData=function(t,e){return Bf(0<this.targetCount,"Removing a target from an empty cache"),Bf(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,dd.resolve()},t.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),dd.waitFor(s).next(function(){return a})},t.prototype.getQueryCount=function(t){return dd.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return dd.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Vf("Not yet implemented.")},t.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),dd.waitFor(i)},t.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),dd.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),dd.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return dd.resolve(n)},t.prototype.containsKey=function(t,e){return dd.resolve(this.references.containsKey(e))},t}();var Sm=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Yp(Mp.comparator),this.newDocumentChanges=cd(),this.size=0}return t.prototype.addEntries=function(t,e,n){var r,i,o=[];try{for(var a=ui(e),s=a.next();!s.done;s=a.next()){var u=s.value,c=u.maybeDocument.key;this.docs=this.docs.insert(c,u),this.newDocumentChanges=this.newDocumentChanges.add(c),o.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return this.size+=n,dd.waitFor(o)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,dd.resolve(n.size)):dd.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return dd.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return dd.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=rd();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),dd.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=rd(),i=new Yp(Mp.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),dd.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){Bf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=od(),r=new Mp(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof qd&&e.matches(s)&&(n=n.insert(s.key,s))}return dd.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return dd.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var r=this,i=nd();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new Vd(t,zp.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=cd(),dd.resolve(i)},t.prototype.newChangeBuffer=function(){return new Im(this.sizer,this)},t.prototype.getSize=function(t){return dd.resolve(this.size)},t}(),Im=function(r){function t(t,e){var n=r.call(this)||this;return n.sizer=t,n.documentCache=e,n}return ii(t,r),t.prototype.applyChanges=function(t){var i=this,e=this.assertChanges(),o=0,a=[];return e.forEach(function(t,e){var n=i.documentSizes.get(t);Bf(void 0!==n,"Attempting to change document "+t.toString()+" without having read it first");var r=i.sizer(e);o+=r-n,a.push({maybeDocument:e,size:r})}),this.documentCache.addEntries(t,a,o)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(Wd),Cm=function(){function r(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new kp(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Tm(this);this.indexManager=new $d,this.remoteDocumentCache=new Sm(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return r.createLruPersistence=function(t,e,n){return new r(t,function(t){return new km(t,new Sy(e),n)})},r.createEagerPersistence=function(t){return new r(t,function(t){return new Am(t)})},r.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(r.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),r.prototype.getActiveClients=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,[this.clientId]]})})},r.prototype.setPrimaryStateListener=function(t){return t(!0)},r.prototype.setDatabaseDeletedListener=function(){},r.prototype.setNetworkEnabled=function(t){},r.prototype.getIndexManager=function(){return this.indexManager},r.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Em(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},r.prototype.getQueryCache=function(){return this.queryCache},r.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},r.prototype.runTransaction=function(t,e,n){var r=this;Ff("MemoryPersistence","Starting transaction:",t);var i=new Nm(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},r.prototype.mutationQueuesContainKey=function(e,n){return dd.or((t=this.mutationQueues,r=[],Xf(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.containsKey(e,n)}}));var t,r},r}(),Nm=function(t){this.currentSequenceNumber=t},Am=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),dd.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),dd.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),dd.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(n){var t=this,r=this.persistence.getRemoteDocumentCache();return dd.forEach(this.orphanedDocuments,function(e){return t.isReferenced(n,e).next(function(t){return t?dd.resolve():r.removeEntry(n,e).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return dd.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return dd.resolve(n.inMemoryPins.containsKey(e))}])},t}(),km=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new jd(function(t){return Wp(t.path)}),this.garbageCollector=new Dy(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return dd.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return dd.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?dd.resolve():r(e)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(n,t){var r=this,i=0,o=this.persistence.getRemoteDocumentCache();return o.forEachDocumentKey(n,function(e){return r.isPinned(n,e,t).next(function(t){return t?dd.resolve():(i++,o.removeEntry(n,e).next())})}).next(function(){return i})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),dd.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),dd.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),dd.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),dd.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Vf("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return dd.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return dd.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return dd.resolve(void 0!==t&&n<t)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Dm=Number,Rm=Dm.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Om=Dm.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Pm=Dm.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function xm(t){return null==t}function Mm(t){return Pm(t)&&t<=Om&&Rm<=t}var Lm,Fm,Um=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Ff("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),qm="PersistentStream";(Fm=Lm||(Lm={}))[Fm.Initial=0]="Initial",Fm[Fm.Starting=1]="Starting",Fm[Fm.Open=2]="Open",Fm[Fm.Error=3]="Error",Fm[Fm.Backoff=4]="Backoff";var Vm,Bm,jm,Wm,Km=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Lm.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Um(t,e,1e3,1.5,6e4)}return t.prototype.isStarted=function(){return this.state===Lm.Starting||this.state===Lm.Open||this.state===Lm.Backoff},t.prototype.isOpen=function(){return this.state===Lm.Open},t.prototype.start=function(){this.state!==Lm.Error?(Bf(this.state===Lm.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Lm.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Bf(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Lm.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.isOpen()?[2,this.close(Lm.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Bf(this.isStarted(),"Only started streams should be closed."),Bf(e===Lm.Error||xm(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==Lm.Error?this.backoff.reset():n&&n.code===Kf.RESOURCE_EXHAUSTED?(Uf(n.toString()),Uf("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Kf.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var n=this;Bf(this.state===Lm.Initial,"Must be in initial state to auth"),this.state=Lm.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Qf(Kf.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},t.prototype.startStream=function(t){var e=this;Bf(this.state===Lm.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Bf(e.state===Lm.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Lm.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Bf(this.state===Lm.Error,"Should only perform backoff when in Error state"),this.state=Lm.Backoff,this.backoff.backoffAndRun(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){return Bf(this.state===Lm.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Lm.Initial,this.start(),Bf(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Bf(this.isStarted(),"Can't handle server close on non-started stream"),Ff(qm,"close with error: "+t),this.stream=null,this.close(Lm.Error,t)},t.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Ff(qm,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Qm=function(a){function t(t,e,n,r,i){var o=a.call(this,t,Ep.ListenStreamConnectionBackoff,Ep.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}return ii(t,a),t.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},t.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},t.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},t.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},t}(Km),Hm=function(a){function t(t,e,n,r,i){var o=a.call(this,t,Ep.WriteStreamConnectionBackoff,Ep.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o}return ii(t,a),Object.defineProperty(t.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.handshakeComplete_=!1,a.prototype.start.call(this)},t.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},t.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},t.prototype.onMessage=function(t){if(Bf(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Bf(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},t.prototype.writeHandshake=function(){Bf(this.isOpen(),"Writing handshake requires an opened stream"),Bf(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},t.prototype.writeMutations=function(t){var e=this;Bf(this.isOpen(),"Writing mutations requires an opened stream"),Bf(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Bf(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},t}(Km),Gm=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Hm(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Qm(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=nd();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Bf(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},t.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Kf.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Kf.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t}(),zm=function(){function t(t){this.datastore=t,this.readVersions=sd(),this.mutations=[],this.committed=!1,this.writtenDocs=new Set}return t.prototype.lookup=function(t){var e=this;if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Qf(Kf.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof Vd||t instanceof qd?e.recordVersion(t):Vf("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new vm(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){var t=this;if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;var e=this.readVersions;if(this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Qf(Kf.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return this.datastore.commit(this.mutations).then(function(){t.committed=!0})},t.prototype.recordVersion=function(t){var e;if(t instanceof qd)e=t.version;else{if(!(t instanceof Vd))throw Vf("Document in a transaction was a "+t.constructor.name);e=zp.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Qf(Kf.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?fm.updateTime(e):fm.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return fm.exists(!0);if(e.isEqual(zp.forDeletedDoc()))throw new Qf(Kf.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fm.updateTime(e)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){Bf(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();(Bm=Vm||(Vm={}))[Bm.Unknown=0]="Unknown",Bm[Bm.Online=1]="Online",Bm[Bm.Offline=2]="Offline",(Wm=jm||(jm={}))[Wm.RemoteStore=0]="RemoteStore",Wm[Wm.SharedClientState=1]="SharedClientState";var Ym,Xm,Jm=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Vm.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Vm.Unknown),Bf(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Ep.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Bf(t.state===Vm.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Vm.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Vm.Online?(this.setAndBroadcast(Vm.Unknown),Bf(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Bf(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Vm.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Vm.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Uf(e),this.shouldWarnClientIsOffline=!1):Ff("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function $m(t){switch(t){case Kf.OK:return Vf("Treated status OK as error");case Kf.CANCELLED:case Kf.UNKNOWN:case Kf.DEADLINE_EXCEEDED:case Kf.RESOURCE_EXHAUSTED:case Kf.INTERNAL:case Kf.UNAVAILABLE:case Kf.UNAUTHENTICATED:return!1;case Kf.INVALID_ARGUMENT:case Kf.NOT_FOUND:case Kf.ALREADY_EXISTS:case Kf.PERMISSION_DENIED:case Kf.FAILED_PRECONDITION:case Kf.ABORTED:case Kf.OUT_OF_RANGE:case Kf.UNIMPLEMENTED:case Kf.DATA_LOSS:return!0;default:return Vf("Unknown status code: "+t)}}function Zm(t){if(void 0===t)return Uf("GRPC error has no .code"),Kf.UNKNOWN;switch(t){case Ym.OK:return Kf.OK;case Ym.CANCELLED:return Kf.CANCELLED;case Ym.UNKNOWN:return Kf.UNKNOWN;case Ym.DEADLINE_EXCEEDED:return Kf.DEADLINE_EXCEEDED;case Ym.RESOURCE_EXHAUSTED:return Kf.RESOURCE_EXHAUSTED;case Ym.INTERNAL:return Kf.INTERNAL;case Ym.UNAVAILABLE:return Kf.UNAVAILABLE;case Ym.UNAUTHENTICATED:return Kf.UNAUTHENTICATED;case Ym.INVALID_ARGUMENT:return Kf.INVALID_ARGUMENT;case Ym.NOT_FOUND:return Kf.NOT_FOUND;case Ym.ALREADY_EXISTS:return Kf.ALREADY_EXISTS;case Ym.PERMISSION_DENIED:return Kf.PERMISSION_DENIED;case Ym.FAILED_PRECONDITION:return Kf.FAILED_PRECONDITION;case Ym.ABORTED:return Kf.ABORTED;case Ym.OUT_OF_RANGE:return Kf.OUT_OF_RANGE;case Ym.UNIMPLEMENTED:return Kf.UNIMPLEMENTED;case Ym.DATA_LOSS:return Kf.DATA_LOSS;default:return Vf("Unknown status code: "+t)}}(Xm=Ym||(Ym={}))[Xm.OK=0]="OK",Xm[Xm.CANCELLED=1]="CANCELLED",Xm[Xm.UNKNOWN=2]="UNKNOWN",Xm[Xm.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xm[Xm.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xm[Xm.NOT_FOUND=5]="NOT_FOUND",Xm[Xm.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xm[Xm.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xm[Xm.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xm[Xm.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xm[Xm.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xm[Xm.ABORTED=10]="ABORTED",Xm[Xm.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xm[Xm.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xm[Xm.INTERNAL=13]="INTERNAL",Xm[Xm.UNAVAILABLE=14]="UNAVAILABLE",Xm[Xm.DATA_LOSS=15]="DATA_LOSS";var tv,ev,nv,rv,iv=function(){function o(n){this.comparator=n?function(t,e){return n(t,e)||Mp.comparator(t.key,e.key)}:function(t,e){return Mp.comparator(t.key,e.key)},this.keyedMap=od(),this.sortedSet=new Yp(this.comparator)}return o.emptySet=function(t){return new o(t.comparator)},o.prototype.has=function(t){return null!=this.keyedMap.get(t)},o.prototype.get=function(t){return this.keyedMap.get(t)},o.prototype.first=function(){return this.sortedSet.minKey()},o.prototype.last=function(){return this.sortedSet.maxKey()},o.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},o.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(o.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),o.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},o.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},o.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},o.prototype.copy=function(t,e){var n=new o;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},o}();(ev=tv||(tv={}))[ev.Added=0]="Added",ev[ev.Removed=1]="Removed",ev[ev.Modified=2]="Modified",ev[ev.Metadata=3]="Metadata",(rv=nv||(nv={}))[rv.Local=0]="Local",rv[rv.Synced=1]="Synced";var ov,av,sv=function(){function t(){this.changeMap=new Yp(Mp.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==tv.Added&&n.type===tv.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===tv.Metadata&&n.type!==tv.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===tv.Modified&&n.type===tv.Modified?this.changeMap=this.changeMap.insert(e,{type:tv.Modified,doc:t.doc}):t.type===tv.Modified&&n.type===tv.Added?this.changeMap=this.changeMap.insert(e,{type:tv.Added,doc:t.doc}):t.type===tv.Removed&&n.type===tv.Added?this.changeMap=this.changeMap.remove(e):t.type===tv.Removed&&n.type===tv.Modified?this.changeMap=this.changeMap.insert(e,{type:tv.Removed,doc:n.doc}):t.type===tv.Added&&n.type===tv.Removed?this.changeMap=this.changeMap.insert(e,{type:tv.Modified,doc:t.doc}):Vf("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},t}(),uv=function(){function o(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return o.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:tv.Added,doc:t})}),new o(t,e,iv.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(o.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),o.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},o}(),cv=function(){function i(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return i.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=hv.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new i(zp.MIN,r,ld(),nd(),cd())},i}(),hv=function(){function n(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return n.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new n(Wf(),e,cd(),cd(),cd())},n}(),lv=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},fv=function(t,e){this.targetId=t,this.existenceFilter=e};(av=ov||(ov={}))[av.NoChange=0]="NoChange",av[av.Added=1]="Added",av[av.Removed=2]="Removed",av[av.Current=3]="Current",av[av.Reset=4]="Reset";var pv=function(t,e,n,r){void 0===n&&(n=Wf()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},dv=function(){function t(){this.pendingResponses=0,this.documentChanges=vv(),this._resumeToken=Wf(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var n=cd(),r=cd(),i=cd();return this.documentChanges.forEach(function(t,e){switch(e){case tv.Added:n=n.add(t);break;case tv.Modified:r=r.add(t);break;case tv.Removed:i=i.add(t);break;default:Vf("Encountered invalid change type: "+e)}}),new hv(this._resumeToken,this._current,n,r,i)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=vv()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),yv=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=nd(),this.pendingDocumentTargetMapping=mv(),this.pendingTargetResets=new Zp(vp)}return t.prototype.handleDocumentChange=function(t){var e,n,r,i;try{for(var o=ui(t.updatedTargetIds),a=o.next();!a.done;a=o.next()){var s=a.value;t.newDoc instanceof qd?this.addDocumentToTarget(s,t.newDoc):t.newDoc instanceof Vd&&this.removeDocumentFromTarget(s,t.key,t.newDoc)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}try{for(var u=ui(t.removedTargetIds),c=u.next();!c.done;c=u.next()){s=c.value;this.removeDocumentFromTarget(s,t.key,t.newDoc)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}},t.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case ov.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case ov.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case ov.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Bf(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case ov.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case ov.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Vf("Unknown target watch change state: "+n.state)}})},t.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Yf(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Mp(i.path);this.removeDocumentFromTarget(e,o,new Vd(o,zp.forDeletedDoc()))}else Bf(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(i){var o=this,a={};Yf(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new Mp(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Vd(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=cd();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===gy.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new cv(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=nd(),this.pendingDocumentTargetMapping=mv(),this.pendingTargetResets=new Zp(vp),t},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?tv.Modified:tv.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,tv.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new dv),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Zp(vp),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(e){var n=this;Bf(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new dv,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function mv(){return new Yp(Mp.comparator)}function vv(){return new Yp(Mp.comparator)}var gv="RemoteStore",bv=function(){function t(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ai(o,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Ff(gv,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new Jm(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Vm.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Vm.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Ff(gv,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Ff(gv,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Vm.Unknown),[2]}})})},t.prototype.listen=function(t){Bf(!Gf(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Bf(Gf(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Jf(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Vm.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Bf(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new yv(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Jf(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return ai(this,void 0,void 0,function(){var n=this;return si(this,function(t){return Yf(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},t.prototype.onWatchStreamClose=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return void 0===e&&Bf(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(Vm.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(Vm.Online),n instanceof pv&&n.state===ov.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof lv?this.watchChangeAggregator.handleDocumentChange(n):n instanceof fv?this.watchChangeAggregator.handleExistenceFilter(n):(Bf(n instanceof pv,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(zp.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(r){var i=this;Bf(!r.isEqual(zp.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Yf(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.copy({resumeToken:e.resumeToken,snapshotVersion:r}))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.copy({resumeToken:Wf()}),i.sendUnwatchRequest(t);var n=new Ty(e.query,t,gy.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},t.prototype.handleTargetError=function(t){var n=this;Bf(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ai(n,void 0,void 0,function(){return si(this,function(t){return Gf(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},t.prototype.fillWritePipeline=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Bf(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},t.prototype.startWriteStream=function(){Bf(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var o=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){var e,t;try{for(var n=ui(o.writePipeline),r=n.next();!r.done;r=n.next()){var i=r.value;o.writeStream.writeMutations(i.mutations)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}).catch(Ly)},t.prototype.onMutationResult=function(t,e){var n=this;Bf(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=pd.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){return void 0===n&&Bf(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return $m(e.code)?(Ff(gv,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Wf(),[2,this.localStore.setLastStreamToken(Wf()).catch(Ly)]):[2]})})},t.prototype.handleWriteError=function(i){return ai(this,void 0,void 0,function(){var n,r=this;return si(this,function(t){return $m(e=i.code)&&e!==Kf.ABORTED?(n=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(n.batchId,i).then(function(){return r.fillWritePipeline()})]):[2];var e})})},t.prototype.createTransaction=function(){return new zm(this.datastore)},t.prototype.restartNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Vm.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Ff(gv,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(Vm.Unknown),t.label=4;case 4:return[2]}})})},t}(),wv=function(){function t(t,e){if(Zf("GeoPoint",arguments,2),np("GeoPoint","number",1,t),np("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Qf(Kf.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Qf(Kf.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return vp(this._lat,t._lat)||vp(this._long,t._long)},t}(),_v=function(){function n(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return n.atPath=function(t){return new n(t)},Object.defineProperty(n.prototype,"orderBy",{get:function(){var e,t;if(null===this.memoizedOrderBy){var n=this.getInequalityFilterField(),r=this.getFirstOrderByField();if(null!==n&&null===r)n.isKeyField()?this.memoizedOrderBy=[Pv]:this.memoizedOrderBy=[new Ov(n),Pv];else{Bf(null===n||null!==r&&n.isEqual(r),"First orderBy should match inequality field.");var i=!(this.memoizedOrderBy=[]);try{for(var o=ui(this.explicitOrderBy),a=o.next();!a.done;a=o.next()){var s=a.value;this.memoizedOrderBy.push(s),s.field.isKeyField()&&(i=!0)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(!i){var u=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Dv.ASCENDING;this.memoizedOrderBy.push(u===Dv.ASCENDING?Pv:xv)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),n.prototype.addFilter=function(t){Bf(null==this.getInequalityFilterField()||!(t instanceof Sv)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Bf(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},n.prototype.addOrderBy=function(t){Bf(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new n(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.withLimit=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},n.prototype.withStartAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},n.prototype.withEndAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},n.prototype.asCollectionQueryAtPath=function(t){return new n(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.canonicalId=function(){var e,t,n,r;if(null===this.memoizedCanonicalId){var i=this.path.canonicalString();this.isCollectionGroupQuery()&&(i+="|cg:"+this.collectionGroup),i+="|f:";try{for(var o=ui(this.filters),a=o.next();!a.done;a=o.next()){i+=a.value.canonicalId(),i+=","}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}i+="|ob:";try{for(var s=ui(this.orderBy),u=s.next();!u.done;u=s.next()){i+=u.value.canonicalId(),i+=","}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}xm(this.limit)||(i+="|l:",i+=this.limit),this.startAt&&(i+="|lb:",i+=this.startAt.canonicalId()),this.endAt&&(i+="|ub:",i+=this.endAt.canonicalId()),this.memoizedCanonicalId=i}return this.memoizedCanonicalId},n.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),xm(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},n.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},n.prototype.docComparator=function(t,e){var n,r,i=!1;try{for(var o=ui(this.orderBy),a=o.next();!a.done;a=o.next()){var s=a.value,u=s.compare(t,e);if(0!==u)return u;i=i||s.field.isKeyField()}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return Bf(i,"orderBy used that doesn't compare on key field"),0},n.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},n.prototype.hasLimit=function(){return!xm(this.limit)},n.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},n.prototype.getInequalityFilterField=function(){var e,t;try{for(var n=ui(this.filters),r=n.next();!r.done;r=n.next()){var i=r.value;if(i instanceof Sv&&i.isInequality())return i.field}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},n.prototype.findFilterOperator=function(t){var e,n;try{for(var r=ui(this.filters),i=r.next();!i.done;i=r.next()){var o=i.value;if(o instanceof Sv&&0<=t.indexOf(o.op))return o.op}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null},n.prototype.isDocumentQuery=function(){return Mp.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},n.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},n.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Mp.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},n.prototype.matchesOrderBy=function(t){var e,n;try{for(var r=ui(this.explicitOrderBy),i=r.next();!i.done;i=r.next()){var o=i.value;if(!o.field.isKeyField()&&null===t.field(o.field))return!1}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0},n.prototype.matchesFilters=function(t){var e,n;try{for(var r=ui(this.filters),i=r.next();!i.done;i=r.next()){if(!i.value.matches(t))return!1}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0},n.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},n.prototype.assertValidBound=function(t){Bf(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},n}(),Ev=function(){},Tv=function(){function e(t){this.name=t}return e.fromString=function(t){switch(t){case"<":return e.LESS_THAN;case"<=":return e.LESS_THAN_OR_EQUAL;case"==":return e.EQUAL;case">=":return e.GREATER_THAN_OR_EQUAL;case">":return e.GREATER_THAN;case"array-contains":return e.ARRAY_CONTAINS;case"in":return e.IN;case"array-contains-any":return e.ARRAY_CONTAINS_ANY;default:return Vf("Unknown FieldFilter operator: "+t)}},e.prototype.toString=function(){return this.name},e.prototype.isEqual=function(t){return this.name===t.name},e.LESS_THAN=new e("<"),e.LESS_THAN_OR_EQUAL=new e("<="),e.EQUAL=new e("=="),e.GREATER_THAN=new e(">"),e.GREATER_THAN_OR_EQUAL=new e(">="),e.ARRAY_CONTAINS=new e("array-contains"),e.IN=new e("in"),e.ARRAY_CONTAINS_ANY=new e("array-contains-any"),e}(),Sv=function(i){function r(t,e,n){var r=i.call(this)||this;return r.field=t,r.op=e,r.value=n,r}return ii(r,i),r.create=function(t,e,n){if(t.isKeyField())return e===Tv.IN?(Bf(n instanceof um,"Comparing on key with IN, but filter value not an ArrayValue"),Bf(n.internalValue.every(function(t){return t instanceof om}),"Comparing on key with IN, but an array value was not a RefValue"),new Cv(t,n)):(Bf(n instanceof om,"Comparing on key, but filter value not a RefValue"),Bf(e!==Tv.ARRAY_CONTAINS&&e!==Tv.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Iv(t,e,n));if(n.isEqual(Gy.INSTANCE)){if(e!==Tv.EQUAL)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new r(t,e,n)}if(n.isEqual(tm.NAN)){if(e!==Tv.EQUAL)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new r(t,e,n)}return e===Tv.ARRAY_CONTAINS?new Nv(t,n):e===Tv.IN?(Bf(n instanceof um,"IN filter has invalid value: "+n.toString()),new Av(t,n)):e===Tv.ARRAY_CONTAINS_ANY?(Bf(n instanceof um,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new kv(t,n)):new r(t,e,n)},r.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},r.prototype.matchesComparison=function(t){switch(this.op){case Tv.LESS_THAN:return t<0;case Tv.LESS_THAN_OR_EQUAL:return t<=0;case Tv.EQUAL:return 0===t;case Tv.GREATER_THAN:return 0<t;case Tv.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Vf("Unknown FieldFilter operator: "+this.op)}},r.prototype.isInequality=function(){return 0<=[Tv.LESS_THAN,Tv.LESS_THAN_OR_EQUAL,Tv.GREATER_THAN,Tv.GREATER_THAN_OR_EQUAL].indexOf(this.op)},r.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},r.prototype.isEqual=function(t){return t instanceof r&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},r.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},r}(Ev),Iv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.matches=function(t){var e=this.value,n=Mp.comparator(t.key,e.key);return this.matchesComparison(n)},e}(Sv),Cv=function(r){function t(t,e){var n=r.call(this,t,Tv.IN,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},t}(Sv),Nv=function(n){function t(t,e){return n.call(this,t,Tv.ARRAY_CONTAINS,e)||this}return ii(t,n),t.prototype.matches=function(t){var e=t.field(this.field);return e instanceof um&&e.contains(this.value)},t}(Sv),Av=function(r){function t(t,e){var n=r.call(this,t,Tv.IN,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},t}(Sv),kv=function(r){function t(t,e){var n=r.call(this,t,Tv.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof um&&n.internalValue.some(function(t){return e.value.contains(t)})},t}(Sv),Dv=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Rv=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){var e,t,n=this.before?"b:":"a:";try{for(var r=ui(this.position),i=r.next();!i.done;i=r.next()){n+=i.value.toString()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},t.prototype.sortsBeforeDocument=function(t,e){Bf(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Bf(o instanceof om,"Bound has a non-key value where the key path is being used."),n=Mp.comparator(o.key,e.key);else{var a=e.field(i.field);Bf(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===Dv.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),Ov=function(){function t(t,e){this.field=t,void 0===e&&(e=Dv.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?qd.compareByKey(t,e):qd.compareByField(this.field,t,e);switch(this.dir){case Dv.ASCENDING:return n;case Dv.DESCENDING:return-1*n;default:return Vf("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),Pv=new Ov(xp.keyField(),Dv.ASCENDING),xv=new Ov(xp.keyField(),Dv.DESCENDING),Mv=function(){function e(){}return e.prototype.applyToLocalView=function(t,e){return new rm(e,t)},e.prototype.applyToRemoteDocument=function(t,e){return e},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.instance=new e,e}(),Lv=function(){function e(t){this.elements=t}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){var e,n,r=qv(t),i=function(e){r.find(function(t){return t.isEqual(e)})||r.push(e)};try{for(var o=ui(this.elements),a=o.next();!a.done;a=o.next()){i(a.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return new um(r)},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&gp(t.elements,this.elements)},e}(),Fv=function(){function e(t){this.elements=t}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){var e,n,r=qv(t),i=function(e){r=r.filter(function(t){return!t.isEqual(e)})};try{for(var o=ui(this.elements),a=o.next();!a.done;a=o.next()){i(a.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return new um(r)},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&gp(t.elements,this.elements)},e}(),Uv=function(){function e(t){this.operand=t}return e.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Zy&&this.operand instanceof Zy){var r=n.internalValue+this.operand.internalValue;return new Zy(r)}r=n.internalValue+this.operand.internalValue;return new tm(r)},e.prototype.applyToRemoteDocument=function(t,e){return Bf(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},e.prototype.computeBaseValue=function(t){return t instanceof Yy?t:new Zy(0)},e.prototype.isEqual=function(t){return t instanceof e&&this.operand.isEqual(t.operand)},e}();function qv(t){return t instanceof um?t.internalValue.slice():[]}var Vv,Bv,jv=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),Wv=((Vv={})[Dv.ASCENDING.name]="ASCENDING",Vv[Dv.DESCENDING.name]="DESCENDING",Vv),Kv=((Bv={})[Tv.LESS_THAN.name]="LESS_THAN",Bv[Tv.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Bv[Tv.GREATER_THAN.name]="GREATER_THAN",Bv[Tv.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Bv[Tv.EQUAL.name]="EQUAL",Bv[Tv.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Bv[Tv.IN.name]="IN",Bv[Tv.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Bv),Qv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hv(t,e){Bf(!xm(t),e+" is missing")}function Gv(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Vf("can't parse "+t)}var zv=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Kf.UNKNOWN:Zm(t.code);return new Qf(e,t.message||"")},t.prototype.toInt32Value=function(t){return xm(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return xm(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Bf(!!t,"Cannot deserialize null or undefined timestamp.");var e=Gv(t.seconds||"0"),n=t.nanos||0;return new Gp(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Qv.exec(t);if(Bf(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Gp(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Bf(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Sp.fromBase64String(t)):(Bf(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Sp.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Bf(!!t,"Trying to deserialize version that isn't set"),zp.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=Op.fromString(t);return Bf(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Bf(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Bf(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Mp(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Op.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new Op(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new Op(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Bf(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Gy)return{nullValue:"NULL_VALUE"};if(t instanceof zy)return{booleanValue:t.value()};if(t instanceof Zy)return{integerValue:""+t.value()};if(t instanceof tm){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof em?{stringValue:t.value()}:t instanceof sm?{mapValue:this.toMapValue(t)}:t instanceof um?{arrayValue:this.toArrayValue(t)}:t instanceof nm?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof am?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof im?{bytesValue:this.toBytes(t.value())}:t instanceof om?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Vf("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Gy.INSTANCE;if("booleanValue"in t)return zy.of(t.booleanValue);if("integerValue"in t)return new Zy(Gv(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return tm.NAN;if("Infinity"===t.doubleValue)return tm.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return tm.NEGATIVE_INFINITY}return new tm(t.doubleValue)}if("stringValue"in t)return new em(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Hv(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new um(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Hv(t.timestampValue,"timestampValue"),new nm(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Hv(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new am(new wv(r,i))}if("bytesValue"in t){Hv(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new im(o)}if("referenceValue"in t){Hv(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Ap(a.get(1),a.get(3)),u=new Mp(this.extractLocalPathFromResourceName(a));return new om(s,u)}return Vf("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Bf(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new qd(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},t.prototype.fromFields=function(t){var n=this,e=t,r=sm.EMPTY;return Xf(e,function(t,e){r=r.set(new xp([t]),n.fromValue(e))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Bf(!!t.found,"Tried to deserialize a found document from a missing document."),Hv(t.found.name,"doc.found.name"),Hv(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new qd(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Bf(!!t.missing,"Tried to deserialize a missing document from a found document."),Bf(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Vd(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Vf("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case ov.Added:return"ADD";case ov.Current:return"CURRENT";case ov.NoChange:return"NO_CHANGE";case ov.Removed:return"REMOVE";case ov.Reset:return"RESET";default:return Vf("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof fv)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof lv){if(t.newDoc instanceof qd){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Vd){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof pv){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Ym.OK;switch(t){case Kf.OK:return Ym.OK;case Kf.CANCELLED:return Ym.CANCELLED;case Kf.UNKNOWN:return Ym.UNKNOWN;case Kf.DEADLINE_EXCEEDED:return Ym.DEADLINE_EXCEEDED;case Kf.RESOURCE_EXHAUSTED:return Ym.RESOURCE_EXHAUSTED;case Kf.INTERNAL:return Ym.INTERNAL;case Kf.UNAVAILABLE:return Ym.UNAVAILABLE;case Kf.UNAUTHENTICATED:return Ym.UNAUTHENTICATED;case Kf.INVALID_ARGUMENT:return Ym.INVALID_ARGUMENT;case Kf.NOT_FOUND:return Ym.NOT_FOUND;case Kf.ALREADY_EXISTS:return Ym.ALREADY_EXISTS;case Kf.PERMISSION_DENIED:return Ym.PERMISSION_DENIED;case Kf.FAILED_PRECONDITION:return Ym.FAILED_PRECONDITION;case Kf.ABORTED:return Ym.ABORTED;case Kf.OUT_OF_RANGE:return Ym.OUT_OF_RANGE;case Kf.UNIMPLEMENTED:return Ym.UNIMPLEMENTED;case Kf.DATA_LOSS:return Ym.DATA_LOSS;default:return Vf("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Vf("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){Hv(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new pv(n,r,i,a||null)}else if("documentChange"in t){Hv(t.documentChange,"documentChange"),Hv(t.documentChange.document,"documentChange.name"),Hv(t.documentChange.document.name,"documentChange.document.name"),Hv(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new qd(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new lv(f,p,l.key,l)}else if("documentDelete"in t){Hv(t.documentDelete,"documentDelete"),Hv(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):zp.forDeletedDoc(),l=new Vd(u,c),p=d.removedTargetIds||[];e=new lv([],p,l.key,l)}else if("documentRemove"in t){Hv(t.documentRemove,"documentRemove"),Hv(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[];e=new lv([],p,u,null)}else{if(!("filter"in t))return Vf("Unknown change type "+JSON.stringify(t));Hv(t.filter,"filter"),Hv(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new jv(v),b=m.targetId;e=new fv(b,g)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?ov.NoChange:"ADD"===t?ov.Added:"REMOVE"===t?ov.Removed:"CURRENT"===t?ov.Current:"RESET"===t?ov.Reset:Vf("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return zp.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?zp.MIN:e.readTime?this.fromVersion(e.readTime):zp.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof dm)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof vm)e={delete:this.toName(t.key)};else if(t instanceof ym)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof mm))return Vf("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):fm.NONE;if(t.update){Hv(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new ym(r,i,o,n)}return new dm(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new vm(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Bf(!0===n.exists,'Transforms only support precondition "exists == true"'),new mm(r,a)}return Vf("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Bf(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Vf("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?fm.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?fm.exists(t.exists):fm.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new lm(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Bf(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Mv)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Lv)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Fv)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Uv)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Vf("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Bf("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Mv.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Lv(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new Fv(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);Bf(i instanceof Yy,"NUMERIC_ADD transform requires a NumberValue"),n=new Uv(i)}else Vf("Unknown transform proto: "+JSON.stringify(t));var o=xp.fromServerFormat(t.fieldPath);return new hm(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Bf(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return _v.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Bf(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Bf(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Bf(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new _v(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case gy.Listen:return null;case gy.ExistenceFilterMismatch:return"existence-filter-mismatch";case gy.LimboResolution:return"limbo-document";default:return Vf("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Sv?e.toUnaryOrFieldFilter(t):Vf("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Vf("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Rv(r,n)},t.prototype.toDirection=function(t){return Wv[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Dv.ASCENDING;case"DESCENDING":return Dv.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Kv[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Tv.EQUAL;case"GREATER_THAN":return Tv.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Tv.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Tv.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Tv.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Tv.ARRAY_CONTAINS;case"IN":return Tv.IN;case"ARRAY_CONTAINS_ANY":return Tv.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Vf("Unspecified operator");default:return Vf("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return xp.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new Ov(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return Sv.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Tv.EQUAL){if(t.value.isEqual(tm.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Gy.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return Sv.create(e,Tv.EQUAL,tm.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return Sv.create(n,Tv.EQUAL,Gy.INSTANCE);case"OPERATOR_UNSPECIFIED":return Vf("Unspecified filter");default:return Vf("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return xp.fromServerFormat(t)});return cm.fromArray(e)},t}(),Yv=function(){this.listeners=[]},Xv=function(){function t(t){this.syncEngine=t,this.queries=new jd(function(t){return t.canonicalId()}),this.onlineState=Vm.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Yv,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){var e,n,r,i;try{for(var o=ui(t),a=o.next();!a.done;a=o.next()){var s=a.value,u=s.query,c=this.queries.get(u);if(c){try{for(var h=(r=void 0,ui(c.listeners)),l=h.next();!l.done;l=h.next()){l.value.onViewSnapshot(s)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}c.viewSnap=s}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},t.prototype.onWatchError=function(t,e){var n,r,i=this.queries.get(t);if(i)try{for(var o=ui(i.listeners),a=o.next();!a.done;a=o.next()){a.value.onError(e)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(a){this.onlineState=a,this.queries.forEach(function(t,e){var n,r;try{for(var i=ui(e.listeners),o=i.next();!o.done;o=i.next()){o.value.applyOnlineStateChange(a)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})},t}(),Jv=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Vm.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){var e,n;if(Bf(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){var r=[];try{for(var i=ui(t.docChanges),o=i.next();!o.done;o=i.next()){var a=o.value;a.type!==tv.Metadata&&r.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}t=new uv(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Bf(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Vm.Offline;return this.options.waitForSyncWhenOnline&&n?(Bf(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Vm.Offline},t.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Bf(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=uv.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),$v=function(){function c(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return c.fromSnapshot=function(t,e){var n,r,i=cd(),o=cd();try{for(var a=ui(e.docChanges),s=a.next();!s.done;s=a.next()){var u=s.value;switch(u.type){case tv.Added:i=i.add(u.doc.key);break;case tv.Removed:o=o.add(u.doc.key)}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return new c(t,i,o)},c}(),Zv=function(t){this.key=t},tg=function(t){this.key=t},eg=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=cd(),this.mutatedKeys=cd(),this.documentSet=new iv(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new sv,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof qd?e:null;r&&(Bf(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(u.track({type:tv.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:tv.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:tv.Added,doc:r}),a=!0):n&&!r&&(u.track({type:tv.Removed,doc:n}),a=!0,p&&(f=!0));a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:tv.Removed,doc:n})}return Bf(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var o=this;Bf(!t.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var i=t.changeSet.getChanges();i.sort(function(t,e){return n=t.type,r=e.type,(i=function(t){switch(t){case tv.Added:return 1;case tv.Modified:case tv.Metadata:return 2;case tv.Removed:return 0;default:return Vf("Unknown ChangeType: "+t)}})(n)-i(r)||o.query.docComparator(t.doc,e.doc);var n,r,i}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?nv.Synced:nv.Local,u=s!==this.syncState;return this.syncState=s,0!==i.length||u?{snapshot:new uv(this.query,t.documentSet,r,i,t.mutatedKeys,s===nv.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Vm.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new sv,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Bf(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=cd(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new tg(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new Zv(t))}),r},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=cd();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return uv.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===nv.Local)},t}();var ng="SyncEngine",rg=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ig=function(t){this.key=t},og=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new jd(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Yp(Mp.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new bm,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Sd.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Vm.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Bf(null!==t,"SyncEngine listener cannot be null"),Bf(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(a){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(s,u){var c=this,h=s.query;return this.localStore.executeQuery(h).then(function(a){return c.localStore.remoteDocumentKeys(s.targetId).then(function(t){var e=new eg(h,t),n=e.computeDocChanges(a),r=hv.createSynthesizedTargetChangeForCurrentChange(s.targetId,u&&c.onlineState!==Vm.Offline),i=e.applyChanges(n,!0===c.isPrimary,r);Bf(0===i.limboChanges.length,"View returned limbo docs before target ack from the server."),Bf(!!i.snapshot,"applyChanges for new view should always return a snapshot");var o=new rg(h,s.targetId,e);return c.queryViewsByQuery.set(h,o),c.queryViewsByTarget[s.targetId]=o,i.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(i){var t=this;return this.localStore.executeQuery(i.query).then(function(r){return t.localStore.remoteDocumentKeys(i.targetId).then(function(n){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){return e=i.view.synchronizeWithPersistedState(r,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Bf(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Ly)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(e,n){var r=this;void 0===n&&(n=5),Bf(0<=n,"Got negative number of retries for transaction.");var i=this.remoteStore.createTransaction();return function(){try{var t=e(i);return!xm(t)&&t.catch&&t.then?t.catch(function(t){return Promise.reject(r.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(t){return Promise.reject(r.wrapUpdateFunctionError(t))}}().then(function(t){return i.commit().then(function(){return t}).catch(function(t){return 0===n?Promise.reject(t):r.runTransaction(e,n-1)})})},t.prototype.applyRemoteEvent=function(e){var r=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(e).then(function(t){return Xf(e.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Bf(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Bf(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Bf(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),r.emitNewSnapsAndNotifyLocalStore(t,e)}).catch(Ly)},t.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===jm.RemoteStore||!this.isPrimary&&t===jm.SharedClientState){var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Bf(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},t.prototype.rejectListen=function(u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new Yp(Mp.comparator)).insert(n,new Vd(n,zp.forDeletedDoc())),i=cd().add(n),o=new cv(zp.MIN,{},new Zp(vp),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Bf(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(Ly)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(n,r,i){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Ff(ng,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Vf("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(Ly)},t.prototype.rejectFailedWrite=function(e,n){var r=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(e,n),this.localStore.rejectBatch(e).then(function(t){return r.sharedClientState.updateMutationState(e,"rejected",n),r.emitNewSnapsAndNotifyLocalStore(t)}).catch(Ly)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Yp(vp)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Bf(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){var n,r;try{for(var i=ui(e),o=i.next();!o.done;o=i.next()){var a=o.value;if(a instanceof Zv)this.limboDocumentRefs.addReference(a.key,t),this.trackLimboChange(a);else if(a instanceof tg){Ff(ng,"Document no longer in limbo: "+a.key),this.limboDocumentRefs.removeReference(a.key,t),this.limboDocumentRefs.containsKey(a.key)||this.removeLimboTarget(a.key)}else Vf("Unknown limbo change: "+JSON.stringify(a))}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Ff(ng,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=_v.atPath(e.path);this.limboResolutionsByTarget[n]=new ig(e),this.remoteStore.listen(new Ty(r,n,gy.LimboResolution,kp.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return ai(this,void 0,void 0,function(){var o,a,e,s=this;return si(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=$v.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Bf(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?[4,this.localStore.handleUserChange(r)]:[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},t.prototype.applyPrimaryState=function(l){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return si(this,function(t){switch(t.label){case 0:return!0!==l||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:n=t.sent();try{for(r=ui(n),i=r.next();!i.done;i=r.next())o=i.value,this.remoteStore.listen(o)}catch(t){u={error:t}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[3,7];case 3:return!1!==l||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Yf(this.queryViewsByTarget,function(t,e){h.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return h.unlisten(e.query)}),h.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var e=this;Yf(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Yp(Mp.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){var e,n,r=this,i=Promise.resolve(),a=[],s=[],o=function(o){i=i.then(function(){return ai(r,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return(n=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return t.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(r=t.sent()).snapshot&&s.push(r.snapshot),[3,8];case 4:return Bf(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 5:return Bf(!!(i=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(i)];case 6:return e=t.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:t.sent(),t.label=8;case 8:return a.push(e),[2]}})})})};try{for(var u=ui(t),c=u.next();!c.done;c=u.next()){o(c.value)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}return i.then(function(){return r.syncEngineListener.onWatchChange(s),a})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(r,o,n){return ai(this,void 0,void 0,function(){var e,i=this;return si(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Ff(ng,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[r])return[3,5];switch(o){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return ai(i,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return e=cv.createSynthesizedRemoteEventForCurrentChange(r,"current"===o),[4,this.emitNewSnapsAndNotifyLocalStore(n,e)];case 1:return t.sent(),[2]}})})},function(r){return ai(i,void 0,void 0,function(){var n;return si(this,function(t){switch(t.label){case 0:return(e=r).code!==Kf.DATA_LOSS||e.message!==Kd?[3,2]:(n=[],Yf(this.queryViewsByTarget,function(t){return n.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(n)]);case 1:return t.sent(),[3,3];case 2:throw r;case 3:return[2]}var e})})})];case 2:return e=this.queryViewsByTarget[r],this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(e.query,!0)];case 3:return t.sent(),this.syncEngineListener.onWatchError(e.query,n),[3,5];case 4:Vf("Unexpected target state: "+o),t.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(v,g){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,y,m=this;return si(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];t.label=1;case 1:t.trys.push([1,8,9,10]),e=ui(v),n=e.next(),t.label=2;case 2:return n.done?[3,7]:(h=n.value,Bf(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]);case 3:return Bf(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(r)];case 4:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 5:t.sent(),this.remoteStore.listen(i),t.label=6;case 6:return n=e.next(),[3,2];case 7:return[3,10];case 8:return o=t.sent(),f={error:o},[3,10];case 9:try{n&&!n.done&&(p=e.return)&&p.call(e)}finally{if(f)throw f.error}return[7];case 10:a=function(e){var n;return si(this,function(t){switch(t.label){case 0:return(n=s.queryViewsByTarget[e])?[4,s.localStore.releaseQuery(n.query,!1).then(function(){m.remoteStore.unlisten(e),m.removeAndCleanupQuery(n)}).catch(Ly)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},s=this,t.label=11;case 11:t.trys.push([11,16,17,18]),u=ui(g),c=u.next(),t.label=12;case 12:return c.done?[3,15]:(h=c.value,[5,a(h)]);case 13:t.sent(),t.label=14;case 14:return c=u.next(),[3,12];case 15:return[3,18];case 16:return l=t.sent(),d={error:l},[3,18];case 17:try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(d)throw d.error}return[7];case 18:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?cd().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:cd()},t}(),ag=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),sg="SharedClientState",ug="firestore_clients",cg="firestore_mutations",hg="firestore_targets",lg=function(){function a(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Bf(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return a.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Qf(r.error.code,r.error.message)),i?new a(t,e,r.state,o):(Uf(sg,"Failed to parse mutation state for ID '"+e+"': "+n),null)},a.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},a}(),fg=function(){function o(t,e,n){this.targetId=t,this.state=e,Bf(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return o.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Qf(n.error.code,n.error.message)),r?new o(t,n.state,i):(Uf(sg,"Failed to parse target state for ID '"+t+"': "+e),null)},o.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},o}(),pg=function(){function a(t,e){this.clientId=t,this.activeTargetIds=e}return a.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ld(),o=0;r&&o<n.activeTargetIds.length;++o)r=Mm(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new a(t,i):(Uf(sg,"Failed to parse client data for instance '"+t+"': "+e),null)},a}(),dg=function(){function n(t,e){this.clientId=t,this.onlineState=e}return n.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in Vm&&"string"==typeof e.clientId?new n(e.clientId,Vm[e.onlineState]):(Uf(sg,"Failed to parse online state: "+t),null)},n}(),yg=function(){function t(){this.activeTargetIds=ld()}return t.prototype.addQueryTarget=function(t){Bf(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),mg=function(){function a(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!a.isAvailable(this.platform))throw new Qf(Kf.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new yg,this.clientStateKeyRe=new RegExp("^"+ug+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+cg+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+hg+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}return a.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},a.prototype.start=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,y,m=this;return si(this,function(t){switch(t.label){case 0:return Bf(!this.started,"WebStorageSharedClientState already started"),Bf(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Bf(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:e=t.sent();try{for(n=ui(e),r=n.next();!r.done;r=n.next())(i=r.value)!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=pg.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a)}catch(t){f={error:t}}finally{try{r&&!r.done&&(p=n.return)&&p.call(n)}finally{if(f)throw f.error}}this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u);try{for(c=ui(this.earlyEvents),h=c.next();!h.done;h=c.next())l=h.value,this.handleWebStorageEvent(l)}catch(t){d={error:t}}finally{try{h&&!h.done&&(y=c.return)&&y.call(c)}finally{if(d)throw d.error}}return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return m.shutdown()}),this.started=!0,[2]}})})},a.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},a.prototype.getAllActiveQueryTargets=function(){var n=ld();return Xf(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},a.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},a.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},a.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},a.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=fg.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},a.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},a.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},a.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},a.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},a.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},a.prototype.setOnlineState=function(t){this.persistOnlineState(t)},a.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},a.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ff(sg,"READ",t,e),e},a.prototype.setItem=function(t,e){Ff(sg,"SET",t,e),this.storage.setItem(t,e)},a.prototype.removeItem=function(t){Ff(sg,"REMOVE",t),this.storage.removeItem(t)},a.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Ff(sg,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Uf("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Bf(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=kp.INVALID;if(null!=t)try{var n=JSON.parse(t);Bf("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Uf(sg,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==kp.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(a.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),a.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},a.prototype.persistMutationState=function(t,e,n){var r=new lg(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},a.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},a.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Vm[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},a.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new fg(t,e,n);this.setItem(r,i.toWebStorageJSON())},a.prototype.toWebStorageClientStateKey=function(t){return Bf(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),ug+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageQueryTargetMetadataKey=function(t){return hg+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageMutationBatchKey=function(t){var e=cg+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},a.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},a.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Bf(null!==n,"Cannot parse client state key '"+t+"'"),pg.fromWebStorageEntry(n,e)},a.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Bf(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lg.fromWebStorageEntry(new ag(i),r,e)},a.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Bf(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return fg.fromWebStorageEntry(r,e)},a.prototype.fromWebStorageOnlineState=function(t){return dg.fromWebStorageEntry(t)},a.prototype.handleMutationBatchEvent=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return e.user.uid!==this.currentUser.uid?(Ff(sg,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},a.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},a.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},a.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},a}();var vg=function(){function t(){this.localState=new yg,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new yg,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),gg="FirestoreClient",bg=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Ay.withCacheSize(this.cacheSizeBytes)},t}(),wg=function(){},_g=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=mp.newId(),this._clientShutdown=!1}return t.prototype.start=function(t){var n=this;this.verifyNotShutdown();var r=new Lp,i=new Lp,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof bg?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof Qf?t.code===Kf.FAILED_PRECONDITION||t.code===Kf.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotShutdown=function(){if(this._clientShutdown)throw new Qf(Kf.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=My.buildStoragePrefix(this.databaseInfo),a=new zv(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ai(t,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!mg.isAvailable(this.platform))throw new Qf(Kf.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=i.lruParams(),i.synchronizeTabs?(this.sharedClientState=new mg(this.asyncQueue,this.platform,o,this.clientId,r),[4,My.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return e=t.sent(),[3,4];case 2:return this.sharedClientState=new vg,[4,My.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n)];case 3:e=t.sent(),t.label=4;case 4:return[2,(this.persistence=e).referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Cm.createEagerPersistence(this.clientId),this.sharedClientState=new vg,Promise.resolve(null)},t.prototype.initializeRest=function(u,c){var t=this;return Ff(gg,"Initializing. user=",u.uid),this.platform.loadConnection(this.databaseInfo).then(function(s){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a=this;return si(this,function(t){switch(t.label){case 0:return this.localStore=new _m(this.persistence,u),c&&(this.lruScheduler=new ky(c,this.asyncQueue,this.localStore)),e=this.platform.newConnectivityMonitor(),n=this.platform.newSerializer(this.databaseInfo.databaseId),r=new Gm(this.asyncQueue,s,this.credentials,n),i=function(t){return a.syncEngine.applyOnlineStateChange(t,jm.RemoteStore)},o=function(t){return a.syncEngine.applyOnlineStateChange(t,jm.SharedClientState)},this.remoteStore=new bv(this.localStore,r,this.asyncQueue,i,e),this.syncEngine=new og(this.localStore,this.remoteStore,this.sharedClientState,u),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Xv(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Ff(gg,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueue(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this._clientShutdown?[3,4]:(this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()]);case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:t.sent(),this.credentials.removeChangeListener(),this._clientShutdown=!0,t.label=4;case 4:return[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new Jv(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof qd)return t;if(t instanceof Vd)return null;throw new Qf(Kf.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=cd(),n=new eg(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new Lp;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(t.prototype,"clientShutdown",{get:function(){return this._clientShutdown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),Eg=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Tg=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+yp(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(np("FieldPath","string",n,t[n]),0===t[n].length)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xp(t)}return e.documentId=function(){return e._DOCUMENT_ID},e.prototype.isEqual=function(t){if(!(t instanceof e))throw pp("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},e._DOCUMENT_ID=new e(xp.keyField().canonicalString()),e}(),Sg=new RegExp("[~\\*/\\[\\]]");var Ig=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},Cg=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Bf(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(ag.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Bf(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Ng=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var e=this;Bf(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Qf(Kf.ABORTED,"getToken aborted due to token change.");return t?(Bf("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Ig(t.accessToken,e.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Bf(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Bf(null!=this.tokenListener,"removeChangeListener() called twice"),Bf(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Bf(null===t||"string"==typeof t,"Received invalid UID: "+t),new ag(t)},t}(),Ag=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=ag.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),kg=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new Ag(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(ag.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Dg(t){return function(t,e){var n,r;if("object"!=typeof t||null===t)return!1;var i=t;try{for(var o=ui(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(s in i&&"function"==typeof i[s])return!0}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!1}(t,["next","error","complete"])}var Rg,Og,Pg=function(){function t(t){this._methodName=t}return t.delete=function(){return $f("FieldValue.delete",arguments),xg.instance},t.serverTimestamp=function(){return $f("FieldValue.serverTimestamp",arguments),Mg.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return tp("FieldValue.arrayUnion",arguments,1),new Lg(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return tp("FieldValue.arrayRemove",arguments,1),new Fg(t)},t.increment=function(t){return np("FieldValue.increment","number",1,t),Zf("FieldValue.increment",arguments,1),new Ug(t)},t.prototype.isEqual=function(t){return this===t},t}(),xg=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return ii(e,t),e.instance=new e,e}(Pg),Mg=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return ii(e,t),e.instance=new e,e}(Pg),Lg=function(n){function t(t){var e=n.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}return ii(t,n),t}(Pg),Fg=function(n){function t(t){var e=n.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}return ii(t,n),t}(Pg),Ug=function(n){function t(t){var e=n.call(this,"FieldValue.increment")||this;return e._operand=t,e}return ii(t,n),t}(Pg),qg=Hf(Pg,"Use FieldValue.<field>() instead."),Vg=/^__.*__$/,Bg=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new ym(t,this.data,this.fieldMask,e)):n.push(new dm(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new mm(t,this.fieldTransforms)),n},t}(),jg=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new ym(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new mm(t,this.fieldTransforms)),n},t}();function Wg(t){switch(t){case Rg.Set:case Rg.MergeSet:case Rg.Update:return!0;case Rg.Argument:return!1;default:throw Vf("Unexpected case for UserDataSource: "+t)}}(Og=Rg||(Rg={}))[Og.Set=0]="Set",Og[Og.Update=1]="Update",Og[Og.MergeSet=2]="MergeSet",Og[Og.Argument=3]="Argument";var Kg=function(){function r(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return r.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},r.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},r.prototype.childContextForArray=function(t){return new r(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},r.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Qf(Kf.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},r.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},r.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},r.prototype.validatePathSegment=function(t){if(Wg(this.dataSource)&&Vg.test(t))throw this.createError("Document fields cannot begin and end with __")},r}(),Qg=function(t,e){this.databaseId=t,this.key=e},Hg=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Kg(Rg.Set,t,xp.EMPTY_PATH);zg("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Bg(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r,i,o=new Kg(Rg.MergeSet,t,xp.EMPTY_PATH);zg("Data must be an object, but it was:",o,e);var a,s,u=this.parseData(e,o);if(n){var c=new Zp(xp.comparator);try{for(var h=ui(n),l=h.next();!l.done;l=h.next()){var f=l.value,p=void 0;if(f instanceof Tg)p=f._internalPath;else{if("string"!=typeof f)throw Vf("Expected stringOrFieldPath to be a string or a FieldPath");p=Xg(t,f)}if(!o.contains(p))throw new Qf(Kf.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");c=c.add(p)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}a=cm.fromSet(c),s=o.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=cm.fromArray(o.fieldMask),s=o.fieldTransforms;return new Bg(u,a,s)},t.prototype.parseUpdateData=function(o,t){var a=this,s=new Kg(Rg.Update,o,xp.EMPTY_PATH);zg("Data must be an object, but it was:",s,t);var u=new Zp(xp.comparator),c=sm.EMPTY;Xf(t,function(t,e){var n=Xg(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof xg)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=cm.fromSet(u);return new jg(c,e,s.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Kg(Rg.Update,t,xp.EMPTY_PATH),o=[Yg(t,e)],a=[n];if(r.length%2!=0)throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Yg(t,r[s])),a.push(r[s+1]);var u=new Zp(xp.comparator),c=sm.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof xg)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=cm.fromSet(u);return new jg(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Kg(Rg.Argument,t,xp.EMPTY_PATH),r=this.parseData(e,n);return Bf(null!=r,"Parsed data should not be null."),Bf(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Jg(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Gg(t=this.runPreConverter(t,e)))return zg("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Pg)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,r){var i=this,o=new Yp(vp);return Jf(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Xf(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new sm(o)},t.prototype.parseArray=function(t,e){var n,r,i=[],o=0;try{for(var a=ui(t),s=a.next();!s.done;s=a.next()){var u=s.value,c=this.parseData(u,e.childContextForArray(o));null==c&&(c=Gy.INSTANCE),i.push(c),o++}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return new um(i)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Wg(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof xg){if(e.dataSource!==Rg.MergeSet)throw e.dataSource===Rg.Update?(Bf(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Mg)e.fieldTransforms.push(new hm(e.path,Mv.instance));else if(t instanceof Lg){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Lv(n);e.fieldTransforms.push(new hm(e.path,r))}else if(t instanceof Fg){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Fv(n);e.fieldTransforms.push(new hm(e.path,i))}else if(t instanceof Ug){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new Uv(o);e.fieldTransforms.push(new hm(e.path,a))}else Vf("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Gy.INSTANCE;if("number"==typeof t)return Mm(t)?new Zy(t):new tm(t);if("boolean"==typeof t)return zy.of(t);if("string"==typeof t)return new em(t);if(t instanceof Date)return new nm(Gp.fromDate(t));if(t instanceof Gp)return new nm(new Gp(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof wv)return new am(t);if(t instanceof Sp)return new im(t);if(t instanceof Qg)return new om(t.databaseId,t.key);throw e.createError("Unsupported field value: "+hp(t))},t.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new Kg(Rg.Argument,r,xp.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},t}();function Gg(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Gp||t instanceof wv||t instanceof Sp||t instanceof Qg||t instanceof Pg)}function zg(t,e,n){if(!Gg(n)||!cp(n)){var r=hp(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Yg(t,e){if(e instanceof Tg)return e._internalPath;if("string"==typeof e)return Xg(t,e);throw new Qf(Kf.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Xg(e,t){try{return function(e){if(0<=e.search(Sg))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Tg.bind.apply(Tg,hi([void 0],e.split("."))))}catch(t){throw new Qf(Kf.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=Jg(t);throw new Qf(Kf.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Jg(t){return t instanceof Error?t.message:t.toString()}var $g=Ay.COLLECTION_DISABLED,Zg=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Qf(Kf.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ip("settings","non-empty string","host",t.host),this.host=t.host,op("settings","boolean","ssl",t.ssl),this.ssl=zf(t.ssl,!0);if(fp("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),op("settings","object","credentials",t.credentials),this.credentials=t.credentials,op("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Uf("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Uf("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=zf(t.timestampsInSnapshots,!0),op("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ay.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==$g&&t.cacheSizeBytes<Ay.MINIMUM_CACHE_SIZE_BYTES)throw new Qf(Kf.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ay.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}op("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),tb=function(){},eb=function(){function o(t){var e=this;this._queue=new Up,this.INTERNAL={delete:function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}};var n=new tb;if("object"==typeof t.options){var r=t;n.firebaseApp=r,n.databaseId=o.databaseIdFromApp(r),n.persistenceKey=n.firebaseApp.name,n.credentials=new Ng(r)}else{var i=t;if(!i.projectId)throw new Qf(Kf.INVALID_ARGUMENT,"Must provide projectId");n.databaseId=new Ap(i.projectId,i.database),n.persistenceKey="[DEFAULT]",n.credentials=new Cg}n.settings=new Zg({}),this._config=n,this._databaseId=n.databaseId}return o.prototype.settings=function(t){if(Zf("Firestore.settings",arguments,1),np("Firestore.settings","object",1,t),Gf(t,"persistence"))throw new Qf(Kf.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Zg(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new Qf(Kf.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._config.settings=e).credentials&&(this._config.credentials=function(t){if(!t)return new Cg;switch(t.type){case"gapi":var e=t.client;return Bf(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new kg(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Qf(Kf.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},o.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},o.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},o.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Qf(Kf.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Uf("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=zf(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new bg(this._config.settings.cacheSizeBytes,e))},o.prototype.clearPersistence=function(){var t=this,n=My.buildStoragePrefix(this.makeDatabaseInfo()),r=new Lp;return this._queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new Qf(Kf.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,My.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},o.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new wg),this._firestoreClient},o.prototype.makeDatabaseInfo=function(){return new Cp(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},o.prototype.configureClient=function(t){var r=this;Bf(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Bf(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._dataConverter=new Hg(function(t){if(t instanceof ib){var e=r._config.databaseId,n=t.firestore._config.databaseId;if(!n.isEqual(e))throw new Qf(Kf.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new Qg(r._config.databaseId,t._key)}return t}),this._firestoreClient=new _g(jf.getPlatform(),e,this._config.credentials,this._queue),this._firestoreClient.start(t)},o.databaseIdFromApp=function(t){var e=t.options;if(!Gf(e,"projectId"))throw new Qf(Kf.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Qf(Kf.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ap(n)},Object.defineProperty(o.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new Qf(Kf.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),o.prototype.collection=function(t){return Zf("Firestore.collection",arguments,1),np("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new hb(Op.fromString(t),this)},o.prototype.doc=function(t){return Zf("Firestore.doc",arguments,1),np("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),ib.forPath(Op.fromString(t),this)},o.prototype.collectionGroup=function(t){if(Zf("Firestore.collectionGroup",arguments,1),np("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new ub(new _v(Op.EMPTY_PATH,t),this)},o.prototype.runTransaction=function(e){var n=this;return Zf("Firestore.runTransaction",arguments,1),np("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new nb(n,t))})},o.prototype.batch=function(){return this.ensureClientConfigured(),new rb(this)},Object.defineProperty(o,"logLevel",{get:function(){switch(Mf()){case If.DEBUG:return"debug";case If.ERROR:return"error";case If.SILENT:return"silent";default:return Vf("Unknown log level: "+Mf())}},enumerable:!0,configurable:!0}),o.setLogLevel=function(t){switch(Zf("Firestore.setLogLevel",arguments,1),np("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Lf(If.DEBUG);break;case"error":Lf(If.ERROR);break;case"silent":Lf(If.SILENT);break;default:throw new Qf(Kf.INVALID_ARGUMENT,"Invalid log level: "+t)}},o.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},o}(),nb=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var n=this;Zf("Transaction.get",arguments,1);var r=db("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Vf("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Vd)return new ab(n._firestore,r._key,null,!1,!1);if(e instanceof qd)return new ab(n._firestore,r._key,e,!1,!1);throw Vf("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},t.prototype.set=function(t,e,n){ep("Transaction.set",arguments,2,3);var r=db("Transaction.set",t,this._firestore),i=(n=lb("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof Tg?(tp("Transaction.update",arguments,3),r=db("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Zf("Transaction.update",arguments,2),r=db("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Zf("Transaction.delete",arguments,1);var e=db("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),rb=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){ep("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=db("WriteBatch.set",t,this._firestore),i=(n=lb("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,fm.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof Tg?(tp("WriteBatch.update",arguments,3),r=db("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Zf("WriteBatch.update",arguments,2),r=db("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,fm.exists(!0))),this},t.prototype.delete=function(t){Zf("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=db("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new vm(e._key,fm.NONE)),this},t.prototype.commit=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new Qf(Kf.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),ib=function(){function n(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return n.forPath=function(t,e){if(t.length%2!=0)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new n(new Mp(t),e)},Object.defineProperty(n.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new hb(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),n.prototype.collection=function(t){if(Zf("DocumentReference.collection",arguments,1),np("DocumentReference.collection","non-empty string",1,t),!t)throw new Qf(Kf.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Op.fromString(t);return new hb(this._key.path.child(e),this.firestore)},n.prototype.isEqual=function(t){if(!(t instanceof n))throw pp("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},n.prototype.set=function(t,e){ep("DocumentReference.set",arguments,1,2);var n=(e=lb("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,fm.NONE))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Tg?(tp("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Zf("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,fm.exists(!0)))},n.prototype.delete=function(){return Zf("DocumentReference.delete",arguments,0),this._firestoreClient.write([new vm(this._key,fm.NONE)])},n.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ep("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Dg(t[i])||(fp("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),op("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=Dg(t[i])?t[i]:(np("DocumentReference.onSnapshot","function",i,t[i]),rp("DocumentReference.onSnapshot","function",i+1,t[i+1]),rp("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},n.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Eg({next:function(t){if(n.next){Bf(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new ab(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(_v.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},n.prototype.get=function(n){var r=this;return ep("DocumentReference.get",arguments,0,1),pb("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new ab(r.firestore,r._key,t,!0,t instanceof qd&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},n.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Qf(Kf.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Qf(Kf.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},n}(),ob=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),ab=function(){function e(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return e.prototype.data=function(t){return ep("DocumentSnapshot.data",arguments,0,1),t=fb("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,Qy.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},e.prototype.get=function(t,e){if(ep("DocumentSnapshot.get",arguments,1,2),e=fb("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Yg("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Qy.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new ib(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return new ob(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){if(!(t instanceof e))throw pp("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},e.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},e.prototype.convertValue=function(t,e){if(t instanceof sm)return this.convertObject(t,e);if(t instanceof um)return this.convertArray(t,e);if(t instanceof om){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Uf("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new ib(n,this._firestore)}return t.value(e)},e.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},e}(),sb=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return ii(t,n),t.prototype.data=function(t){var e=n.prototype.data.call(this,t);return Bf("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},t}(ab),ub=function(){function p(t,e){this._query=t,this.firestore=e}return p.prototype.where=function(t,e,n){var r,i,o;if(Zf("Query.where",arguments,3),lp("Query.where",3,n),"in"!==e&&"array-contains-any"!==e){!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid value "+hp(r)+" provided to function "+t+"() for its "+dp(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e)}var a=Yg("Query.where",t),s=Tv.fromString(e);if(a.isKeyField()){if(s===Tv.ARRAY_CONTAINS||s===Tv.ARRAY_CONTAINS_ANY)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' queries on FieldPath.documentId().");if(s===Tv.IN){this.validateDisjunctiveFilterElements(n,s);var u=[];try{for(var c=ui(n),h=c.next();!h.done;h=c.next()){var l=h.value;u.push(this.parseDocumentIdValue(l))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}o=new um(u)}else o=this.parseDocumentIdValue(n)}else s!==Tv.IN&&s!==Tv.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,s),o=this.firestore._dataConverter.parseQueryValue("Query.where",n);var f=Sv.create(a,s,o);return this.validateNewFilter(f),new p(this._query.addFilter(f),this.firestore)},p.prototype.orderBy=function(t,e){var n;if(ep("Query.orderBy",arguments,1,2),rp("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Dv.ASCENDING;else{if("desc"!==e)throw new Qf(Kf.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Dv.DESCENDING}if(null!==this._query.startAt)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Yg("Query.orderBy",t),i=new Ov(r,n);return this.validateNewOrderBy(i),new p(this._query.addOrderBy(i),this.firestore)},p.prototype.limit=function(t){if(Zf("Query.limit",arguments,1),np("Query.limit","number",1,t),t<=0)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new p(this._query.withLimit(t),this.firestore)},p.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];tp("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new p(this._query.withStartAt(r),this.firestore)},p.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];tp("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new p(this._query.withStartAt(r),this.firestore)},p.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];tp("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new p(this._query.withEndAt(r),this.firestore)},p.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];tp("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new p(this._query.withEndAt(r),this.firestore)},p.prototype.isEqual=function(t){if(!(t instanceof p))throw pp("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},p.prototype.boundFromDocOrFields=function(t,e,n,r){if(lp(t,1,e),e instanceof ab){if(0<n.length)throw new Qf(Kf.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Qf(Kf.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},p.prototype.boundFromDocument=function(t,e,n){var r,i,o=[];try{for(var a=ui(this._query.orderBy),s=a.next();!s.done;s=a.next()){var u=s.value;if(u.field.isKeyField())o.push(new om(this.firestore._databaseId,e.key));else{var c=e.field(u.field);if(c instanceof rm)throw new Qf(Kf.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return new Rv(o,n)},p.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Qf(Kf.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Op.fromString(a));if(!Mp.isDocumentKey(s))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Mp(s);i.push(new om(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new Rv(i,n)},p.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ep("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Dg(t[i])||(fp("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),op("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Dg(t[i])?t[i]:(np("Query.onSnapshot","function",i,t[i]),rp("Query.onSnapshot","function",i+1,t[i+1]),rp("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},p.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Eg({next:function(t){e.next&&e.next(new cb(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},p.prototype.get=function(n){var r=this;return ep("Query.get",arguments,0,1),pb("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new cb(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},p.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Qf(Kf.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},p.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Op.fromString(t));if(!Mp.isDocumentKey(e))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new om(this.firestore._databaseId,new Mp(e))}if(t instanceof ib){var n=t;return new om(this.firestore._databaseId,n._key)}throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+hp(t)+".")},p.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},p.prototype.validateNewFilter=function(t){if(t instanceof Sv){var e=[Tv.ARRAY_CONTAINS,Tv.ARRAY_CONTAINS_ANY],n=[Tv.IN,Tv.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},p.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},p.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Qf(Kf.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},p}(),cb=function(){function e(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new ob(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,n){var r=this;ep("QuerySnapshot.forEach",arguments,1,2),np("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(e.prototype,"query",{get:function(){return new ub(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),e.prototype.docChanges=function(t){t&&(fp("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),op("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Qf(Kf.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){{if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new sb(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Bf(t.type===tv.Added,"Invalid event type for first snapshot"),Bf(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==tv.Metadata}).map(function(t){var e=new sb(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==tv.Added&&(Bf(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==tv.Removed&&(a=a.add(t.doc),r=a.indexOf(t.doc.key)),{type:function(t){switch(t){case tv.Added:return"added";case tv.Modified:case tv.Metadata:return"modified";case tv.Removed:return"removed";default:return Vf("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},e.prototype.isEqual=function(t){if(!(t instanceof e))throw pp("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},e.prototype.convertToDocumentImpl=function(t){return new sb(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},e}();hi(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(cb.prototype.docChanges,t,{get:function(){return function(){throw new Qf(Kf.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var hb=function(r){function t(t,e){var n=r.call(this,_v.atPath(t),e)||this;if(t.length%2!=1)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}return ii(t,r),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new ib(new Mp(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.doc=function(t){if(ep("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=mp.newId()),np("CollectionReference.doc","non-empty string",1,t),""===t)throw new Qf(Kf.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Op.fromString(t);return ib.forPath(this._query.path.child(e),this.firestore)},t.prototype.add=function(t){Zf("CollectionReference.add",arguments,1),np("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},t}(ub);function lb(t,e){if(void 0===e)return{merge:!1};if(fp(t,e,["merge","mergeFields"]),op(t,"boolean","merge",e.merge),ap(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof Tg}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Qf(Kf.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function fb(t,e){return void 0===e?{}:(fp(t,e,["serverTimestamps"]),sp(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function pb(t,e){rp(t,"object",1,e),e&&(fp(t,e,["source"]),sp(t,0,"source",e.source,["default","server","cache"]))}function db(t,e,n){if(e instanceof ib){if(e.firestore!==n)throw new Qf(Kf.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw pp(t,"DocumentReference",1,e)}var yb=Hf(eb,"Use firebase.firestore() instead."),mb=Hf(nb,"Use firebase.firestore().runTransaction() instead."),vb=Hf(rb,"Use firebase.firestore().batch() instead."),gb=Hf(ib,"Use firebase.firestore().doc() instead."),bb=Hf(ab),wb=Hf(sb),_b=Hf(ub),Eb=Hf(cb),Tb=Hf(hb,"Use firebase.firestore().collection() instead."),Sb={Firestore:yb,GeoPoint:wv,Timestamp:Gp,Blob:Ip,Transaction:mb,WriteBatch:vb,DocumentReference:gb,DocumentSnapshot:bb,Query:_b,QueryDocumentSnapshot:wb,QuerySnapshot:Eb,CollectionReference:Tb,FieldPath:Tg,FieldValue:qg,setLogLevel:eb.setLogLevel,CACHE_SIZE_UNLIMITED:$g};function Ib(t){t.INTERNAL.registerService("firestore",function(t){return new eb(t)},function(t){Bf(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Sb))}var Cb=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),Nb="ConnectivityMonitor",Ab=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){var e,t;Ff(Nb,"Network connectivity changed: AVAILABLE");try{for(var n=ui(this.callbacks),r=n.next();!r.done;r=n.next()){(0,r.value)(0)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onNetworkUnavailable=function(){var e,t;Ff(Nb,"Network connectivity changed: UNAVAILABLE");try{for(var n=ui(this.callbacks),r=n.next();!r.done;r=n.next()){(0,r.value)(1)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),kb=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Bf(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Bf(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Bf(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Bf(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Bf(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Bf(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),Db="Connection",Rb={BatchGetDocuments:"batchGet",Commit:"commit"},Ob="gl-js/ fire/"+Pf,Pb=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Ob},t.prototype.invokeRPC=function(o,a,s){var u=this,c=this.makeUrl(o);return new Promise(function(n,r){var i=new Of;i.listenOnce(Df.COMPLETE,function(){try{switch(i.getLastErrorCode()){case kf.NO_ERROR:var t=i.getResponseJson();Ff(Db,"XHR received:",JSON.stringify(t)),n(t);break;case kf.TIMEOUT:Ff(Db,'RPC "'+o+'" timed out'),r(new Qf(Kf.DEADLINE_EXCEEDED,"Request time out"));break;case kf.HTTP_ERROR:var e=i.getStatus();Ff(Db,'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?r(new Qf(function(t){switch(t){case 200:return Kf.OK;case 400:return Kf.INVALID_ARGUMENT;case 401:return Kf.UNAUTHENTICATED;case 403:return Kf.PERMISSION_DENIED;case 404:return Kf.NOT_FOUND;case 409:return Kf.ABORTED;case 416:return Kf.OUT_OF_RANGE;case 429:return Kf.RESOURCE_EXHAUSTED;case 499:return Kf.CANCELLED;case 500:return Kf.UNKNOWN;case 501:return Kf.UNIMPLEMENTED;case 503:return Kf.UNAVAILABLE;case 504:return Kf.DEADLINE_EXCEEDED;default:return 200<=t&&t<300?Kf.OK:400<=t&&t<500?Kf.FAILED_PRECONDITION:500<=t&&t<600?Kf.INTERNAL:Kf.UNKNOWN}}(e),"Server responded with status "+i.getStatusText())):(Ff(Db,'RPC "'+o+'" failed'),r(new Qf(Kf.UNAVAILABLE,"Connection failed.")));break;default:Vf('RPC "'+o+'" failed with unanticipated webchannel error '+i.getLastErrorCode()+": "+i.getLastError()+", giving up.")}}finally{Ff(Db,'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);Ff(Db,"XHR sending: ",c+" "+t);var e={"Content-Type":"text/plain"};u.modifyHeadersForRequest(e,s),i.send(c,"POST",t,e,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Af(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ti()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Ff(Db,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),a=!1,u=!1,c=new kb({sendFn:function(t){u?Ff(Db,"Not sending because WebChannel is closed:",t):(a||(Ff(Db,"Opening WebChannel transport."),s.open(),a=!0),Ff(Db,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),h=function(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(Rf.EventType.OPEN,function(){u||Ff(Db,"WebChannel transport opened.")}),h(Rf.EventType.CLOSE,function(){u||(u=!0,Ff(Db,"WebChannel transport closed"),c.callOnClose())}),h(Rf.EventType.ERROR,function(t){u||(u=!0,Ff(Db,"WebChannel transport errored:",t),c.callOnClose(new Qf(Kf.UNAVAILABLE,"The operation could not be completed")))}),h(Rf.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];Bf(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Ff(Db,"WebChannel received error:",r);var i=r.status,o=function(t){var e=Ym[t];if(void 0!==e)return Zm(e)}(i),a=r.message;void 0===o&&(o=Kf.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),u=!0,c.callOnClose(new Qf(o,a)),s.close()}else Ff(Db,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=Rb[t];Bf(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),xb=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Pb(t))},t.prototype.newConnectivityMonitor=function(){return Ab.isAvailable()?new Ab:new Cb},t.prototype.newSerializer=function(t){return new zv(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();jf.setPlatform(new xb),Ib(Hh);var Mb={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Lb=function(i){function o(t,e,n){var r=i.call(this,e)||this;return Object.setPrototypeOf(r,o.prototype),r.code=t,r.details=n,r}return ii(o,i),o}(Error);var Fb=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},t}();function Ub(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var qb=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return Ub(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?Ub(t,function(t){return e.decode(t)}):t},t}();var Vb,Bb,jb=function(){function t(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new qb,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new Fb(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},t.prototype.postJSON=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},t.prototype.call=function(h,l,f){return ai(this,void 0,void 0,function(){var e,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:return e=this._url(h),l=this.serializer.encode(l),r={data:l},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=t.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),a=f.timeout||7e4,[4,Promise.race([this.postJSON(e,r,i),(n=a,new Promise(function(t,e){setTimeout(function(){e(new Lb("deadline-exceeded","deadline-exceeded"))},n)})),this.cancelAllRequests])];case 2:if(!(s=t.sent()))throw new Lb("cancelled","Firebase Functions instance was deleted.");if(u=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!Mb[s])return new Lb("internal","internal");r=Mb[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new Lb(r,i,o)}(s.status,s.json,this.serializer))throw u;if(!s.json)throw new Lb("internal","Response is not valid JSON object.");if(void 0===(c=s.json.data)&&(c=s.json.result),void 0===c)throw new Lb("internal","Response is missing data field.");return[2,{data:this.serializer.decode(c)}]}var n})})},t}();function Wb(t,e,n){return new jb(t,n)}Vb={Functions:jb},Hh.INTERNAL.registerService("functions",Wb,Vb,void 0,!0);var Kb,Qb,Hb,Gb,zb=((Bb={})["only-available-in-window"]="This method is available in a Window context.",Bb["only-available-in-sw"]="This method is available in a service worker context.",Bb["should-be-overriden"]="This method should be overriden by extended classes.",Bb["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",Bb["permission-default"]="The required permissions were not granted and dismissed instead.",Bb["permission-blocked"]="The required permissions were not granted and blocked instead.",Bb["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",Bb["notifications-blocked"]="Notifications have been blocked.",Bb["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",Bb["sw-registration-expected"]="A service worker registration was the expected input.",Bb["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",Bb["invalid-saved-token"]="Unable to access details of the saved token.",Bb["sw-reg-redundant"]="The service worker being used for push was made redundant.",Bb["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",Bb["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",Bb["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",Bb["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",Bb["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",Bb["token-update-no-token"]="FCM returned no token when updating the user to push.",Bb["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",Bb["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",Bb["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",Bb["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",Bb["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",Bb["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",Bb["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",Bb["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",Bb["failed-to-delete-token"]="Unable to delete the currently saved token.",Bb["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",Bb["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",Bb["bad-scope"]="The service worker scope must be a string with at least one character.",Bb["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",Bb["bad-subscription"]="The subscription must be a valid PushSubscription.",Bb["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",Bb["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",Bb["failed-delete-vapid-key"]="The VAPID key could not be deleted.",Bb["invalid-public-vapid-key"]="The public VAPID key must be a string.",Bb["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",Bb["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",Bb),Yb=new Ci("messaging","Messaging",zb),Xb=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Jb="https://fcm.googleapis.com";function $b(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function Zb(t){var e;return(e=new Uint8Array(t),btoa(String.fromCharCode.apply(String,hi(e)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Qb=Kb||(Kb={})).TYPE_OF_MSG="firebase-messaging-msg-type",Qb.DATA="firebase-messaging-msg-data",(Gb=Hb||(Hb={})).PUSH_MSG_RECEIVED="push-msg-received",Gb.NOTIFICATION_CLICKED="notification-clicked";var tw=function(){function t(){}return t.prototype.getToken=function(h,l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=Zb(l.getKey("p256dh")),n=Zb(l.getKey("auth")),r="authorized_entity="+h+"&endpoint="+l.endpoint+"&encryption_key="+e+"&encryption_auth="+n,$b(f.buffer,Xb.buffer)||(i=Zb(f),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Jb+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),Yb.create("token-subscribe-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,Yb.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw Yb.create("token-subscribe-no-token");if(!s.pushSet)throw Yb.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},t.prototype.updateToken=function(h,l,f,p,d){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=Zb(p.getKey("p256dh")),n=Zb(p.getKey("auth")),r="push_set="+f+"&token="+l+"&authorized_entity="+h+"&endpoint="+p.endpoint+"&encryption_key="+e+"&encryption_auth="+n,$b(d.buffer,Xb.buffer)||(i=Zb(d),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Jb+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),Yb.create("token-update-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,Yb.create("token-update-failed",{errorInfo:c});if(!s.token)throw Yb.create("token-update-no-token");return[2,s.token]}})})},t.prototype.deleteToken=function(s,u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:e="authorized_entity="+s+"&token="+u+"&pushSet="+c,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Jb+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,Yb.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw a=t.sent(),Yb.create("token-unsubscribe-failed",{errorInfo:a});case 5:return[2]}})})},t}();function ew(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var nw="undefined",rw="fcm_token_object_Store";function iw(){var e=indexedDB.open(nw);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(rw)){var t=n.transaction(rw).objectStore(rw),r=new tw,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(nw)}}}(e.result)}}var ow=function(){function t(){this.dbPromise=null}return t.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},t.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},t.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},t.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},t.prototype.closeDatabase=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(a,s){return void 0===s&&(s="readonly"),ai(this,void 0,void 0,function(){var e,r,i,o;return si(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),r=e.transaction(this.objectStoreName,s),i=r.objectStore(this.objectStoreName),[4,(n=a(i),new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}}))];case 2:return o=t.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}var n})})},t.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},t}();var aw=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}return ii(t,e),t.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:iw();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=oi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=ew(e.vapidKey)),"string"==typeof e.auth&&(n.auth=ew(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=ew(e.p256dh).buffer),t.update(n),t.continue()}}}},t.prototype.getTokenDetailsFromToken=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Yb.create("bad-token");return sw({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},t.prototype.getTokenDetailsFromSWScope=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Yb.create("bad-scope");return sw({swScope:e}),[2,this.get(e)]})})},t.prototype.saveTokenDetails=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e.swScope)throw Yb.create("bad-scope");if(!e.vapidKey)throw Yb.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw Yb.create("bad-subscription");if(!e.fcmSenderId)throw Yb.create("bad-sender-id");if(!e.fcmToken)throw Yb.create("bad-token");if(!e.fcmPushSet)throw Yb.create("bad-push-set");return sw(e),[2,this.put(e)]})})},t.prototype.deleteToken=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(Yb.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw Yb.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},t}(ow);function sw(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Yb.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Yb.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Yb.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Yb.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Yb.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Yb.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Yb.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw Yb.create("bad-push-set")}var uw=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}return ii(t,e),t.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},t.prototype.getVapidFromSWScope=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw Yb.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},t.prototype.saveVapidDetails=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){if("string"!=typeof n||0===n.length)throw Yb.create("bad-scope");if(null===r||65!==r.length)throw Yb.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},t.prototype.deleteVapidDetails=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw Yb.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},t}(ow),cw="messagingSenderId",hw=function(){function t(t){var e=this;if(!t.options[cw]||"string"!=typeof t.options[cw])throw Yb.create("bad-sender-id");this.messagingSenderId=t.options[cw],this.tokenDetailsModel=new aw,this.vapidDetailsModel=new uw,this.iidModel=new tw,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw Yb.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},t.prototype.manageExistingToken=function(e,n,r,i){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!$b(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=$b(t.getKey("auth"),n.auth),o=$b(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},t.prototype.updateToken=function(i,o,a,s){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},t.prototype.getNewToken=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},t.prototype.deleteToken=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},t.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},t.prototype.requestPermission=function(){throw Yb.create("only-available-in-window")},t.prototype.useServiceWorker=function(t){throw Yb.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){throw Yb.create("only-available-in-window")},t.prototype.onMessage=function(t,e,n){throw Yb.create("only-available-in-window")},t.prototype.onTokenRefresh=function(t,e,n){throw Yb.create("only-available-in-window")},t.prototype.setBackgroundMessageHandler=function(t){throw Yb.create("only-available-in-sw")},t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}();var lw="FCM_MSG",fw=function(n){function t(t){var e=n.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}return ii(t,n),t.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},t.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},t.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},t.prototype.onPush_=function(s){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},t.prototype.onSubChange_=function(t){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),Yb.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},t.prototype.onNotificationClick_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[lw]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[lw]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=dw(Hb.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},t.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oi({},t.notification);return n.data=oi({},t.notification.data,((e={})[lw]=t,e)),n}},t.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Yb.create("bg-handler-function-expected");this.bgMessageHandler=t},t.prototype.getWindowClient_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,pw()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},t.prototype.attemptToMessageClient_=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Yb.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},t.prototype.hasVisibleClients_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,pw()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},t.prototype.sendMessageToWindowClients_=function(i){return ai(this,void 0,void 0,function(){var e,n,r=this;return si(this,function(t){switch(t.label){case 0:return[4,pw()];case 1:return e=t.sent(),n=dw(Hb.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},t.prototype.getSWRegistration_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,self.registration]})})},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw Yb.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,Xb]:[2,n]}})})},t}(hw);function pw(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function dw(t,e){var n;return(n={})[Kb.TYPE_OF_MSG]=t,n[Kb.DATA]=e,n}var yw,mw=function(n){function t(t){var e=n.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Li(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Li(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}return ii(t,n),t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),[3,5];case 4:return t.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw Yb.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,n.prototype.getToken.call(this)]}})})},t.prototype.requestPermission=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?Yb.create("permission-blocked"):Yb.create("permission-default")}})})},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Yb.create("sw-registration-expected");if(null!=this.registrationToUse)throw Yb.create("use-sw-before-get-token");this.registrationToUse=t},t.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Yb.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw Yb.create("use-public-key-before-get-token");var e=ew(t);if(65!==e.length)throw Yb.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},t.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},t.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},t.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(Yb.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(Yb.create("sw-reg-redundant"));else t(r);else e(Yb.create("no-sw-in-reg"))})},t.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Yb.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,Xb]})})},t.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[Kb.TYPE_OF_MSG]){var e=t.data;switch(e[Kb.TYPE_OF_MSG]){case Hb.PUSH_MSG_RECEIVED:case Hb.NOTIFICATION_CLICKED:var n=e[Kb.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},t}(hw);function vw(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}yw={isSupported:vw},Hh.INTERNAL.registerService("messaging",function(t){if(!vw())throw Yb.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new fw(t):new mw(t)},yw);var gw="firebasestorage.googleapis.com",bw="storageBucket",ww=function(){function t(t,e){this.code_=Ew(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return Ew(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),_w={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function Ew(t){return"storage/"+t}function Tw(){return new ww(_w.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Sw(){return new ww(_w.CANCELED,"User canceled the upload/download.")}function Iw(){return new ww(_w.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Cw(t,e,n){return new ww(_w.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Nw(){return new ww(_w.APP_DELETED,"The Firebase app was deleted.")}function Aw(t,e){return new ww(_w.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function kw(t){throw new ww(_w.INTERNAL_ERROR,"Internal error: "+t)}var Dw={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Rw(t){switch(t){case Dw.RAW:case Dw.BASE64:case Dw.BASE64URL:case Dw.DATA_URL:return;default:throw"Expected one of the event types: ["+Dw.RAW+", "+Dw.BASE64+", "+Dw.BASE64URL+", "+Dw.DATA_URL+"]."}}var Ow=function(t,e){this.data=t,this.contentType=e||null};function Pw(t,e){switch(t){case Dw.RAW:return new Ow(xw(e));case Dw.BASE64:case Dw.BASE64URL:return new Ow(Mw(t,e));case Dw.DATA_URL:return new Ow((n=new Lw(e)).base64?Mw(Dw.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Aw(Dw.DATA_URL,"Malformed data URL.")}return xw(e)}(n.rest),new Lw(e).contentType)}var n;throw Tw()}function xw(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Mw(e,t){switch(e){case Dw.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Aw(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Dw.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw Aw(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw Aw(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Lw=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Aw(Dw.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(r=";base64",(n=i).length>=r.length&&n.substring(n.length-r.length)===r),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)};var Fw,Uw,qw={STATE_CHANGED:"state_changed"},Vw="running",Bw="pausing",jw="paused",Ww="success",Kw="canceling",Qw="canceled",Hw="error",Gw={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function zw(t){switch(t){case Vw:case Bw:case Kw:return Gw.RUNNING;case jw:return Gw.PAUSED;case Ww:return Gw.SUCCESS;case Qw:return Gw.CANCELED;case Hw:default:return Gw.ERROR}}function Yw(t){return null!=t}function Xw(t){return void 0!==t}function Jw(t){return"function"==typeof t}function $w(t){return"object"==typeof t}function Zw(t){return"string"==typeof t||t instanceof String}function t_(t){return"number"==typeof t||t instanceof Number}function e_(t){return n_()&&t instanceof Blob}function n_(){return"undefined"!=typeof Blob}(Uw=Fw||(Fw={}))[Uw.NO_ERROR=0]="NO_ERROR",Uw[Uw.NETWORK_ERROR=1]="NETWORK_ERROR",Uw[Uw.ABORT=2]="ABORT";var r_=function(){function t(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Fw.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=Fw.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=Fw.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw kw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),Yw(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return Yw(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw kw("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw kw("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw kw("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Yw(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Yw(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),i_=function(){function t(){}return t.prototype.createXhrIo=function(){return new r_},t}();function o_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(n_())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var a_=function(){function s(t,e){var n=0,r="";e_(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return s.prototype.size=function(){return this.size_},s.prototype.type=function(){return this.type_},s.prototype.slice=function(t,e){if(e_(this.data_)){var n=this.data_,r=(o=t,a=e,(i=n).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new s(r)}var i,o,a;return new s(new Uint8Array(this.data_.buffer,t,e-t),!0)},s.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(n_()){var n=t.map(function(t){return t instanceof s?t.data_:t});return new s(o_.apply(null,n))}var r=t.map(function(t){return Zw(t)?Pw(Dw.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new s(o,!0)},s.prototype.uploadData=function(){return this.data_},s}(),s_=function(){function f(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(f.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),f.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},f.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},f.makeFromBucketSpec=function(e){var t,n;try{t=f.makeFromUrl(e)}catch(t){return new f(e,"")}if(""===t.path)return t;throw n=e,new ww(_w.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")},f.makeFromUrl=function(t){var e=null,n="([A-Za-z0-9.\\-_]+)";var r=new RegExp("^gs://"+n+"(/(.*))?$","i");for(var i,o=gw.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],s=0;s<a.length;s++){var u=a[s],c=u.regex.exec(t);if(c){var h=c[u.indices.bucket],l=c[u.indices.path];l||(l=""),e=new f(h,l),u.postModify(e);break}}if(null==e)throw i=t,new ww(_w.INVALID_URL,"Invalid URL '"+i+"'.");return e},f}();function u_(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return $w(n=e)&&!Array.isArray(n)?e:null}function c_(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function h_(t){return"https://"+gw+"/v0"+t}function l_(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function f_(t,e){return e}var p_=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||f_},d_=null;function y_(){if(d_)return d_;var t=[];t.push(new p_("bucket")),t.push(new p_("generation")),t.push(new p_("metageneration")),t.push(new p_("name","fullPath",!0));var e=new p_("name");e.xform=function(t,e){return!Zw(n=e)||n.length<2?n:c_(n);var n},t.push(e);var n=new p_("size");return n.xform=function(t,e){return Yw(e)?Number(e):e},t.push(n),t.push(new p_("timeCreated")),t.push(new p_("updated")),t.push(new p_("md5Hash",null,!0)),t.push(new p_("cacheControl",null,!0)),t.push(new p_("contentDisposition",null,!0)),t.push(new p_("contentEncoding",null,!0)),t.push(new p_("contentLanguage",null,!0)),t.push(new p_("contentType",null,!0)),t.push(new p_("metadata","customMetadata",!0)),d_=t}function m_(t,e,n){for(var r,i,o={type:"file"},a=n.length,s=0;s<a;s++){var u=n[s];o[u.local]=u.xform(o,e[u.server])}return r=o,i=t,Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new s_(t,e);return i.makeStorageReference(n)}}),o}function v_(t,e,n){var r=u_(e);return null===r?null:m_(t,r,n)}function g_(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function b_(t){if(!$w(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!$w(n))throw"Expected object for 'customMetadata' mapping."}else if($w(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var w_="maxResults",__=1e3,E_="pageToken",T_="prefixes",S_="items";function I_(t,e){var n,r,i,o,a={prefixes:[],items:[],nextPageToken:e.nextPageToken},s=t.bucket();if(null===s)throw new ww(_w.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+bw+"' property when initializing the app?");if(e[T_])try{for(var u=ui(e[T_]),c=u.next();!c.done;c=u.next()){var h=c.value.replace(/\/$/,""),l=t.makeStorageReference(new s_(s,h));a.prefixes.push(l)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}if(e[S_])try{for(var f=ui(e[S_]),p=f.next();!p.done;p=f.next()){var d=p.value;l=t.makeStorageReference(new s_(s,d.name));a.items.push(l)}}catch(t){i={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return a}function C_(t){if(!$w(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===w_){if(!t_(n=t[w_])||!Number.isInteger(n)||t[w_]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[w_])throw"Expected maxResults to be less than or equal to "+__+"."}else{if(e!==E_)throw"Unknown option: "+e;if(t[E_]&&!Zw(t[E_]))throw"Expected pageToken to be string."}var n}var N_=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function A_(t){if(!t)throw Tw()}function k_(r,i){return function(t,e){var n=v_(r,e,i);return A_(null!==n),n}}function D_(o){return function(t,e){var n,r,i=(n=o,null===(r=u_(e))?null:I_(n,r));return A_(null!==i),i}}function R_(r,i){return function(t,e){var n=v_(r,e,i);return A_(null!==n),function(r,t){var e=u_(t);if(null===e)return null;if(!Zw(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return h_("/b/"+i(e)+"/o/"+i(n))+l_({alt:"media",token:t})})[0]}(n,e)}}function O_(o){return function(t,e){var n,r,i;return(n=401===t.getStatus()?new ww(_w.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=o.bucket,new ww(_w.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=o.path,new ww(_w.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):e).setServerResponseProp(e.serverResponseProp()),n}}function P_(i){var o=O_(i);return function(t,e){var n,r=o(t,e);return 404===t.getStatus()&&(n=i.path,r=new ww(_w.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")),r.setServerResponseProp(e.serverResponseProp()),r}}function x_(t,e,n){var r=h_(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new N_(r,"GET",k_(t,n),i);return o.errorHandler=P_(e),o}function M_(t,e,n){var r,i,o=Object.assign({},n);return o.fullPath=t.path,o.size=e.size(),o.contentType||(o.contentType=(i=e,(r=null)&&r.contentType||i&&i.type()||"application/octet-stream")),o}var L_=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function F_(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){A_(!1)}return A_(!!n&&-1!==(e||["active"]).indexOf(n)),n}function U_(t,a,e,s,n,u,r,i){var c=new L_(0,0);if(c.total=r?(c.current=r.current,r.total):(c.current=0,s.size()),s.size()!==c.total)throw new ww(_w.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw Iw();var y=a.maxUploadRetryTime(),m=new N_(e,"POST",function(t,e){var n,r=F_(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?k_(a,u)(t,e):null,new L_(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=O_(t),m}var q_=function(t,e,n){if(Jw(t)||Yw(e)||Yw(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},V_=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function B_(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=e,c=n.length,l=a===s?1===(h=a)?"argument":"arguments":(h="between "+a+" and "+s,"arguments"),new ww(_w.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?Cw(o,e,t.message):Cw(o,e,t)}}var j_=function(e,t){var n=this;this.validator=function(t){n.optional&&!Xw(t)||e(t)},this.optional=!!t};function W_(t,e){function n(t){if(!Zw(t))throw"Expected string."}var r,i,o;return r=t?(i=n,o=t,function(t){i(t),o(t)}):n,new j_(r,e)}function K_(t){return new j_(b_,t)}function Q_(){return new j_(function(t){if(!(t_(t)&&0<=t))throw"Expected a number 0 or greater."})}function H_(e,t){return new j_(function(t){if(!(null===t||Yw(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function G_(t){return new j_(function(t){if(null!==t&&!Jw(t))throw"Expected a Function."},t)}function z_(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,hi(t))})}}var Y_=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Vw,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(_w.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Hw))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(_w.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Hw))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},t.prototype.shouldDoResumable_=function(t){return 262144<t.size()},t.prototype.start_=function(){this.state_===Vw&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case Vw:e(t);break;case Kw:n.transition_(Qw);break;case Bw:n.transition_(jw)}})},t.prototype.createResumable_=function(){var m=this;this.resolveToken_(function(t){var e,n,r,i,o,a,s,u,c,h,l,f,p,d=(e=m.authWrapper_,n=m.location_,r=m.mappings_,i=m.blob_,o=m.metadata_,a=n.bucketOnlyServerUrl(),s=M_(n,i,o),u={name:s.fullPath},c=h_(a),h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":i.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},l=g_(s,r),f=e.maxUploadRetryTime(),(p=new N_(c,"POST",function(t){var e;F_(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){A_(!1)}return A_(Zw(e)),e},f)).urlParams=u,p.headers=h,p.body=l,p.errorHandler=O_(n),p),y=m.authWrapper_.makeRequest(d,t);(m.request_=y).getPromise().then(function(t){m.request_=null,m.uploadUrl_=t,m.needToFetchStatus_=!1,m.completeTransitions_()},m.errorHandler_)})},t.prototype.fetchStatus_=function(){var c=this,h=this.uploadUrl_;this.resolveToken_(function(t){var e,n,r,i,o,a,s=(e=c.authWrapper_,n=c.location_,r=h,i=c.blob_,o=e.maxUploadRetryTime(),(a=new N_(r,"POST",function(t){var e=F_(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){A_(!1)}n||A_(!1);var r=Number(n);return A_(!isNaN(r)),new L_(r,i.size(),"final"===e)},o)).headers={"X-Goog-Upload-Command":"query"},a.errorHandler=O_(n),a),u=c.authWrapper_.makeRequest(s,t);(c.request_=u).getPromise().then(function(t){t=t,c.request_=null,c.updateProgress_(t.current),c.needToFetchStatus_=!1,t.finalized&&(c.needToFetchMetadata_=!0),c.completeTransitions_()},c.errorHandler_)})},t.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new L_(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=U_(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(Hw)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(Ww)):r.completeTransitions_()},r.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=x_(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(Ww)},r.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=M_(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+g_(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=a_.getBlob(c,r,h);if(null===l)throw Iw();var f={name:u.fullPath},p=h_(o),d=t.maxUploadRetryTime(),y=new N_(p,"POST",k_(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=O_(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(Ww)},r.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Kw:case Bw:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Vw:var e=this.state_===jw;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case jw:this.state_=t,this.notifyObservers_();break;case Qw:this.error_=Sw(),this.state_=t,this.notifyObservers_();break;case Hw:case Ww:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Bw:this.transition_(jw);break;case Kw:this.transition_(Qw);break;case Vw:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=zw(this.state_);return new V_(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=G_(!0).validator,a=H_(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(Xw(t.next)||Xw(t.error)||Xw(t.complete)))throw"";return}catch(t){throw r}}B_("on",[W_(function(){if(t!==qw.STATE_CHANGED)throw"Expected one of the event types: ["+qw.STATE_CHANGED+"]."}),H_(s,!0),G_(!0),G_(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&B_("on",i,arguments);var r=new q_(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[H_(function(t){if(null===t)throw r;s(t)}),G_(!0),G_(!0)];return!(Xw(e)||Xw(n)||Xw(o))?c(h):c(null)(e,n,o)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(zw(this.state_)){case Gw.SUCCESS:z_(this.resolve_.bind(null,this.snapshot))();break;case Gw.CANCELED:case Gw.ERROR:z_(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(zw(this.state_)){case Gw.RUNNING:case Gw.PAUSED:t.next&&z_(t.next.bind(t,this.snapshot))();break;case Gw.SUCCESS:t.complete&&z_(t.complete.bind(t))();break;case Gw.CANCELED:case Gw.ERROR:t.error&&z_(t.error.bind(t,this.error_))();break;default:t.error&&z_(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){B_("resume",[],arguments);var t=this.state_===jw||this.state_===Bw;return t&&this.transition_(Vw),t},t.prototype.pause=function(){B_("pause",[],arguments);var t=this.state_===Vw;return t&&this.transition_(Bw),t},t.prototype.cancel=function(){B_("cancel",[],arguments);var t=this.state_===Vw||this.state_===Bw;return t&&this.transition_(Kw),t},t}(),X_=function(){function n(t,e){this.authWrapper=t,this.location=e instanceof s_?e:s_.makeFromUrl(e)}return n.prototype.toString=function(){return B_("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},n.prototype.newRef=function(t,e){return new n(t,e)},n.prototype.mappings=function(){return y_()},n.prototype.child=function(t){B_("child",[W_()],arguments);var e,n,r=(e=this.location.path,n=t.split("/").filter(function(t){return 0<t.length}).join("/"),0===e.length?n:e+"/"+n),i=new s_(this.location.bucket,r);return this.newRef(this.authWrapper,i)},Object.defineProperty(n.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new s_(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){var t=new s_(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return c_(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),n.prototype.put=function(t,e){return void 0===e&&(e=null),B_("put",[new j_(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||n_()&&t instanceof Blob))throw"Expected Blob or File."}),K_(!0)],arguments),this.throwIfRoot_("put"),new Y_(this,this.authWrapper,this.location,this.mappings(),new a_(t),e)},n.prototype.putString=function(t,e,n){void 0===e&&(e=Dw.RAW),B_("putString",[W_(),W_(Rw,!0),K_(!0)],arguments),this.throwIfRoot_("putString");var r=Pw(e,t),i=Object.assign({},n);return!Yw(i.contentType)&&Yw(r.contentType)&&(i.contentType=r.contentType),new Y_(this,this.authWrapper,this.location,this.mappings(),new a_(r.data,!0),i)},n.prototype.delete=function(){var s=this;return B_("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a=(e=s.authWrapper,n=s.location,r=h_(n.fullServerUrl()),i=e.maxOperationRetryTime(),(o=new N_(r,"DELETE",function(t,e){},i)).successCodes=[200,204],o.errorHandler=P_(n),o);return s.authWrapper.makeRequest(a,t).getPromise()})},n.prototype.listAll=function(){B_("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},n.prototype.listAllHelper=function(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,hi(n.prefixes)),(i=o.items).push.apply(i,hi(n.items)),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},n.prototype.list=function(r){var t;B_("list",[(t=!0,new j_(C_,t))],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=h_(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new N_(a,"GET",D_(t),s);return u.urlParams=o,u.errorHandler=O_(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},n.prototype.getMetadata=function(){var n=this;return B_("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=x_(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},n.prototype.updateMetadata=function(h){var l=this;return B_("updateMetadata",[K_()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s,u,c=(e=l.authWrapper,n=l.location,r=h,i=l.mappings(),o=h_(n.fullServerUrl()),a=g_(r,i),s=e.maxOperationRetryTime(),(u=new N_(o,"PATCH",k_(e,i),s)).headers={"Content-Type":"application/json; charset=utf-8"},u.body=a,u.errorHandler=P_(n),u);return l.authWrapper.makeRequest(c,t).getPromise()})},n.prototype.getDownloadURL=function(){var u=this;return B_("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s=(e=u.authWrapper,n=u.location,r=u.mappings(),i=h_(n.fullServerUrl()),o=e.maxOperationRetryTime(),(a=new N_(i,"GET",R_(e,r),o)).errorHandler=P_(n),a);return u.authWrapper.makeRequest(s,t).getPromise().then(function(t){if(null===t)throw new ww(_w.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},n.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw e=t,new ww(_w.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");var e},n}(),J_=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),$_=function(){function t(){this.map=new Map,this.id=-9007199254740991}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},t.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},t}(),Z_=function(){function a(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;Yw(o)&&(this.bucket_=a.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new $_}return a.extractBucket_=function(t){var e=t[bw]||null;return null==e?null:s_.makeFromBucketSpec(e).bucket},a.prototype.getAuthToken=function(){return null!==this.app_&&Yw(this.app_.INTERNAL)&&Yw(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},a.prototype.bucket=function(){if(this.deleted_)throw Nw();return this.bucket_},a.prototype.service=function(){return this.service_},a.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},a.prototype.makeRequest=function(t,e){if(this.deleted_)return new J_(Nw());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},a.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},a.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},a.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},a.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},a.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},a}();var tE=function(){function t(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());Xw(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=Tw()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?Nw():Sw()):i(n=new ww(_w.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new eE(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,hi([null,t],e)):s()||o?c.call.apply(c,hi([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new eE(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===Fw.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new eE(r,t))}else{var i=t.getErrorCode()===Fw.ABORT;o(!1,new eE(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),eE=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function nE(t,e,n){var r,i,o,a,s=l_(t.urlParams),u=t.url+s,c=Object.assign({},t.headers);return r=c,null!==(i=e)&&0<i.length&&(r.Authorization="Firebase "+i),o=c,a=void 0!==Hh?Hh.SDK_VERSION:"AppManager",o["X-Firebase-Storage-Version"]="webjs/"+a,new tE(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var rE,iE=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Z_(t,function(t,e){return new X_(t,e)},nE,this,e),this.app_=t,null!=n)this.bucket_=s_.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new s_(r,""))}this.internals_=new oE(this)}return t.prototype.ref=function(t){if(B_("ref",[W_(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new X_(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return B_("refFromURL",[W_(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{s_.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new X_(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){B_("setMaxUploadRetryTime",[Q_()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){B_("setMaxOperationRetryTime",[Q_()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),oE=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}();function aE(t,e,n){return new iE(t,new i_,n)}function sE(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function uE(n,r,i){var o,t=new Promise(function(t,e){sE(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function cE(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function hE(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return uE(this[n],t,arguments)})})}function lE(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function fE(t,r,e,n){n.forEach(function(n){n in e.prototype&&(t.prototype[n]=function(){return t=this[r],(e=uE(t,n,arguments)).then(function(t){if(t)return new dE(t,e.request)});var t,e})})}function pE(t){this._index=t}function dE(t,e){this._cursor=t,this._request=e}function yE(t){this._store=t}function mE(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function vE(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new mE(n)}function gE(t){this._db=t}rE={TaskState:Gw,TaskEvent:qw,StringFormat:Dw,Storage:iE,Reference:X_},Hh.INTERNAL.registerService("storage",aE,rE,void 0,!0),cE(pE,"_index",["name","keyPath","multiEntry","unique"]),hE(pE,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),fE(pE,"_index",IDBIndex,["openCursor","openKeyCursor"]),cE(dE,"_cursor",["direction","key","primaryKey","value"]),hE(dE,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(dE.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),sE(e._request).then(function(t){if(t)return new dE(t,e._request)})})})}),yE.prototype.createIndex=function(){return new pE(this._store.createIndex.apply(this._store,arguments))},yE.prototype.index=function(){return new pE(this._store.index.apply(this._store,arguments))},cE(yE,"_store",["name","keyPath","indexNames","autoIncrement"]),hE(yE,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),fE(yE,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),lE(yE,"_store",IDBObjectStore,["deleteIndex"]),mE.prototype.objectStore=function(){return new yE(this._tx.objectStore.apply(this._tx,arguments))},cE(mE,"_tx",["objectStoreNames","mode"]),lE(mE,"_tx",IDBTransaction,["abort"]),vE.prototype.createObjectStore=function(){return new yE(this._db.createObjectStore.apply(this._db,arguments))},cE(vE,"_db",["name","version","objectStoreNames"]),lE(vE,"_db",IDBDatabase,["deleteObjectStore","close"]),gE.prototype.transaction=function(){return new mE(this._db.transaction.apply(this._db,arguments))},cE(gE,"_db",["name","version","objectStoreNames"]),lE(gE,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[yE,pE].forEach(function(t){o in t.prototype&&(t.prototype[o.replace("open","iterate")]=function(){var t,e=(t=arguments,Array.prototype.slice.call(t)),n=e[e.length-1],r=this._store||this._index,i=r[o].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[pE,yE].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var bE,wE=1e4,_E="w:0.2.1",EE="FIS_v2",TE="https://firebaseinstallations.googleapis.com/v1",SE=36e5,IE=((bE={})["missing-app-config-values"]="Missing App configuration values.",bE["create-installation-failed"]="Could not register Firebase Installation.",bE["generate-token-failed"]="Could not generate Auth Token.",bE["not-registered"]="Firebase Installation is not registered.",bE["installation-not-found"]="Firebase Installation not found.",bE["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',bE["app-offline"]="Could not process request. Application offline.",bE["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",bE),CE=new Ci("installations","Installations",IE);function NE(t){return t instanceof Ii&&t.code.includes("request-failed")}function AE(t){if(!t||!t.options)throw CE.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw CE.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function kE(t){var e=t.projectId;return TE+"/projects/"+e+"/installations"}function DE(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function RE(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,CE.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function OE(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function PE(t,e){var n=e.refreshToken,r=OE(t);return r.append("Authorization",EE+" "+n),r}function xE(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function ME(e){return new Promise(function(t){setTimeout(t,e)})}var LE=/^[cdef][\w-]{21}$/,FE="";function UE(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=(n=t,btoa(String.fromCharCode.apply(String,hi(n))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);return LE.test(e)?e:FE}catch(t){return FE}var n}var qE="firebase-installations-database",VE=1,BE="firebase-installations-store",jE=null;function WE(){var e,t,n;return jE||(e=function(t){switch(t.oldVersion){case 0:t.createObjectStore(BE)}},t=uE(indexedDB,"open",[qE,VE]),(n=t.request)&&(n.onupgradeneeded=function(t){e&&e(new vE(n.result,t.oldVersion,n.transaction))}),jE=t.then(function(t){return new gE(t)})),jE}function KE(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=GE(i),[4,WE()];case 1:return n=t.sent(),[4,(r=n.transaction(BE,"readwrite")).objectStore(BE).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function QE(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=GE(i),[4,WE()];case 1:return n=t.sent(),[4,(r=n.transaction(BE,"readwrite")).objectStore(BE).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function HE(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=GE(s),[4,WE()];case 1:return n=t.sent(),r=n.transaction(BE,"readwrite"),[4,(i=r.objectStore(BE)).get(e)];case 2:return o=t.sent(),(a=u(o))===o?[2,a]:void 0!==a?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function GE(t){return t.appName+"!"+t.appId}function zE(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,HE(i,function(t){var e=function(t){var e=t||{fid:UE(),registrationStatus:0};if(XE(e))return{fid:e.fid,registrationStatus:0};return e}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,YE(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,ME(100)];case 3:return t.sent(),[4,YE(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw CE.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(CE.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=kE(s),n=OE(s),r={fid:u,authVersion:EE,appId:s.appId,sdkVersion:_E},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,xE(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return[2,{fid:(a=t.sent()).fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:DE(a.authToken)}];case 3:return[4,RE("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,KE(r,e)];case 2:return NE(n=t.sent())&&409===n.serverCode?[4,QE(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,KE(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==FE?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function YE(t){return HE(t,function(t){if(!t)throw CE.create("installation-not-found");return XE(t)?{fid:t.fid,registrationStatus:0}:t})}function XE(t){return 1===t.registrationStatus&&t.registrationTime+wE<Date.now()}function JE(c,h){return ai(this,void 0,void 0,function(){var r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=c,n=h.fid,r=kE(e)+"/"+n+"/authTokens:generate",i=PE(c,h),o={installation:{sdkVersion:_E}},a={method:"POST",headers:i,body:JSON.stringify(o)},[4,xE(function(){return fetch(r,a)})];case 1:return(s=t.sent()).ok?[4,s.json()]:[3,3];case 2:return u=t.sent(),[2,DE(u)];case 3:return[4,RE("Generate Auth Token",s)];case 4:throw t.sent()}var e,n})})}function $E(c){return ai(this,void 0,void 0,function(){var u,e,n;return si(this,function(t){switch(t.label){case 0:return[4,HE(c,function(t){if(!tT(t))throw CE.create("not-registered");var e,n,r,i,o,a=t.authToken;if(2!==(r=a).requestStatus||(i=r,(o=Date.now())<i.creationTime||i.creationTime+i.expiresIn<o+SE)){if(1===a.requestStatus)return u=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,ZE(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,ME(100)];case 3:return t.sent(),[4,ZE(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw CE.create("generate-token-failed");return[2,n]}})})}(c),t;if(!navigator.onLine)throw CE.create("app-offline");var s=(e=t,n={requestStatus:1,requestTime:Date.now()},oi({},e,{authToken:n}));return u=function(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,JE(i,o)];case 1:return e=t.sent(),r=oi({},o,{authToken:e}),[4,KE(i,r)];case 2:return t.sent(),[2,e];case 3:return!NE(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,QE(i)];case 4:return t.sent(),[3,7];case 5:return r=oi({},o,{authToken:{requestStatus:0}}),[4,KE(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(c,s),s}return t})];case 1:return e=t.sent(),u?[4,u]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function ZE(t){return HE(t,function(t){if(!tT(t))throw CE.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+wE<Date.now()?oi({},t,{authToken:{requestStatus:0}}):t})}function tT(t){return void 0!==t&&2===t.registrationStatus}function eT(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,zE(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw CE.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=AE(n))];case 1:return t.sent(),[2,$E(e)]}})})}function nT(s,u){return ai(this,void 0,void 0,function(){var r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=s,n=u.fid,r=kE(e)+"/"+n,i=PE(s,u),o={method:"DELETE",headers:i},[4,xE(function(){return fetch(r,o)})];case 1:return(a=t.sent()).ok?[3,3]:[4,RE("Delete Installation",a)];case 2:throw t.sent();case 3:return[2]}var e,n})})}Hh.INTERNAL.registerService("installations",function(t){return AE(t),{app:t,getId:function(){return function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,zE(e=AE(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&$E(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return eT(t)},delete:function(){return function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,HE(e=AE(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw CE.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw CE.create("app-offline");case 3:return[4,nT(e,n)];case 4:return t.sent(),[4,QE(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(t)}}});var rT,iT,oT,aT,sT="0.2.12",uT="FB-PERF-TRACE-MEASURE",cT="@firebase/performance/config",hT="@firebase/performance/configexpire",lT="Performance",fT=((rT={})["trace started"]="Trace {$traceName} was started before.",rT["trace stopped"]="Trace {$traceName} is not running.",rT["no window"]="Window is not available.",rT["no app id"]="App id is not available.",rT["no project id"]="Project id is not available.",rT["no api key"]="Api key is not available.",rT["invalid cc log"]="Attempted to queue invalid cc event",rT["FB not default"]="Performance can only start when Firebase app instance is the default one.",rT["RC response not ok"]="RC response is not ok",rT),pT=new Ci("performance",lT,fT),dT=function(){function t(t){if(!t)throw pT.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},t.prototype.setupObserver=function(t,a){this.PerformanceObserver&&new this.PerformanceObserver(function(t){var e,n;try{for(var r=ui(t.getEntries()),i=r.next();!i.done;i=r.next()){var o=i.value;a(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===iT&&(iT=new t(oT)),iT},t}();var yT,mT,vT,gT=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw pT.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw pT.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw pT.create("no api key");return t},t.getInstance=function(){return void 0===aT&&(aT=new t),aT},t}();function bT(){return yT}function wT(){switch(dT.getInstance().document.visibilityState){case"visible":return mT.VISIBLE;case"hidden":return mT.HIDDEN;case"prerender":return mT.PRERENDER;default:return mT.UNKNOWN}}(vT=mT||(mT={}))[vT.UNKNOWN=0]="UNKNOWN",vT[vT.VISIBLE=1]="VISIBLE",vT[vT.HIDDEN=2]="HIDDEN",vT[vT.PRERENDER=3]="PRERENDER",vT[vT.UNLOADED=4]="UNLOADED";var _T=new Ji(lT);_T.logLevel=Wi.INFO;var ET="0.0.1",TT={loggingEnabled:!0},ST="FIREBASE_INSTALLATIONS_AUTH";function IT(t){var i,e,n=function(){var t=dT.getInstance().localStorage,e=t.getItem(hT);if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem(cT);if(!r)return;try{var i=JSON.parse(r);return i}catch(t){return}}();return n?(NT(n),Promise.resolve()):(i=t,(e=gT.getInstance().firebaseAppInstance.installations().getToken(),e.then(function(t){}),e).then(function(t){var e=gT.getInstance().getProjectId(),n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+e+"/namespaces/fireperf:fetch?key="+gT.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:ST+" "+t},body:JSON.stringify({app_instance_id:i,app_instance_id_token:t,app_id:gT.getInstance().getAppId(),app_version:sT,sdk_version:ET})});return fetch(r).then(function(t){if(t.ok)return t.json();throw pT.create("RC response not ok")})}).catch(function(){_T.info(CT)})).then(function(t){return NT(t)}).then(function(t){return function(t){if(!t)return;var e=dT.getInstance().localStorage;e.setItem(cT,JSON.stringify(t)),e.setItem(hT,String(Date.now()+60*gT.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var CT="Could not fetch config, will use default configs";function NT(t){if(!t)return t;var e=gT.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=TT.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=AT(e.tracesSamplingRate),e.logNetworkAfterSampling=AT(e.networkRequestsSamplingRate),t}function AT(t){return Math.random()<=t}var kT,DT=1;function RT(){var n;return DT=2,kT=kT||(n=dT.getInstance().document,new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})).then(function(){return(t=gT.getInstance().firebaseAppInstance.installations().getId()).then(function(t){yT=t}),t;var t}).then(function(t){return IT(t)}).then(function(){return OT()},function(){return OT()})}function OT(){DT=3}var PT,xT=1e4,MT=3,LT=MT,FT=[];function UT(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw pT.create("invalid cc log");FT=hi(FT,[t])}({message:i.apply(void 0,hi(n)),eventTime:Date.now()})}}function qT(){if(PT)return PT;var t=UT(jT);return(PT=new Ji("@firebase/performance/cc")).logHandler=t,PT}function VT(t){var e=gT.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&dT.getInstance().requiredApisAvailable()&&(t.isAuto&&wT()!==mT.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===DT?BT(t):RT().then(function(){return BT(t)},function(){return BT(t)})))}function BT(t){bT()&&setTimeout(function(){return qT().log(t,1)},0)}function jT(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:WT(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=KT(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=KT(n));var r={application_info:WT(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function WT(){return{google_app_id:gT.getInstance().getAppId(),app_instance_id:bT(),web_app_info:{sdk_version:sT,page_url:dT.getInstance().getUrl(),service_worker_status:(t=dT.getInstance().navigator,"serviceWorker"in t?t.serviceWorker.controller?2:3:1),visibility_state:wT(),effective_connection_type:function(){var t=dT.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}function KT(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==LT){if(!FT.length)return r(xT);var t=hi(FT);FT=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:gT.getInstance().logSource,log_event:e};fetch(gT.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||_T.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?xT:Math.max(xT,e);LT=MT,r(n)}).catch(function(){FT=hi(t,FT),LT--,_T.info("Tries left: "+LT+"."),r(xT)})}},t)}(5500);var QT=function(){function u(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=dT.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||uT+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return u.prototype.start=function(){if(1!==this.state)throw pT.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},u.prototype.stop=function(){if(2!==this.state)throw pT.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),VT(this)},u.prototype.record=function(t,e,n){var r,i;if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=oi({},n.attributes)),n&&n.metrics)try{for(var o=ui(Object.keys(n.metrics)),a=o.next();!a.done;a=o.next()){var s=a.value;isNaN(Number(n.metrics[s]))||(this.counters[s]=Number(Math.floor(n.metrics[s])))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}VT(this)},u.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&(this.counters[t]=0),this.counters[t]+=e},u.prototype.putMetric=function(t,e){this.counters[t]=e},u.prototype.getMetric=function(t){return this.counters[t]||0},u.prototype.putAttribute=function(t,e){this.customAttributes[t]=e},u.prototype.getAttribute=function(t){return this.customAttributes[t]},u.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},u.prototype.getAttributes=function(){return oi({},this.customAttributes)},u.prototype.setStartTime=function(t){this.startTimeUs=t},u.prototype.setDuration=function(t){this.durationUs=t},u.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},u.createOobTrace=function(t,e,n){var r=dT.getInstance().getUrl();if(r){var i=new u("_wt_"+r,!0),o=Math.floor(1e3*dT.getInstance().getTimeOrigin());i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.incrementMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.incrementMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.incrementMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));if(e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.incrementMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.incrementMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.incrementMetric("_fid",Math.floor(1e3*n))}VT(i)}},u.createUserTimingTrace=function(t){VT(new u(t,!1,t))},u}();function HT(t){var e=t;if(e&&void 0!==e.responseStart){var n,r,i=dT.getInstance().getTimeOrigin(),o=Math.floor(1e3*(e.startTime+i)),a=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,s=Math.floor(1e3*(e.responseEnd-e.startTime)),u={url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:o,timeToResponseInitiatedUs:a,timeToResponseCompletedUs:s};n=u,(r=gT.getInstance()).instrumentationEnabled&&n.url!==r.logEndPointUrl.split("?")[0]&&r.loggingEnabled&&r.logNetworkAfterSampling&&setTimeout(function(){return qT().log(n,0)},0)}}var GT=5e3;function zT(){bT()&&(setTimeout(function(){return function(){var t=dT.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){QT.createOobTrace(e,n),r=void 0},GT);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),QT.createOobTrace(e,n,t))})}else QT.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){var e,t,n=dT.getInstance(),r=n.getEntriesByType("resource");try{for(var i=ui(r),o=i.next();!o.done;o=i.next()){var a=o.value;HT(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n.setupObserver("resource",HT)}()},0),setTimeout(function(){return function(){var e,t,n=dT.getInstance(),r=n.getEntriesByType("measure");try{for(var i=ui(r),o=i.next();!o.done;o=i.next()){var a=o.value;YT(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n.setupObserver("measure",YT)}()},0))}function YT(t){var e=t.name;e.substring(0,uT.length)!==uT&&QT.createUserTimingTrace(e)}var XT,JT=function(){function t(t){this.app=t,dT.getInstance().requiredApisAvailable()?RT().then(zT,zT):_T.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return t.prototype.trace=function(t){return new QT(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return gT.getInstance().instrumentationEnabled},set:function(t){gT.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return gT.getInstance().dataCollectionEnabled},set:function(t){gT.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),t}();return XT=window,oT=XT,Hh.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw pT.create("FB not default");return gT.getInstance().firebaseAppInstance=t,new JT(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Hh});
//# sourceMappingURL=firebase.js.map
