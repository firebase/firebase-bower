!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(n,i){return new Promise(function(r,t){var e=new w(n,i),o=new XMLHttpRequest;o.onload=function(){var t,i,e={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",i=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i)};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;r(new E(n,e))},o.onerror=function(){t(new TypeError("Network request failed"))},o.ontimeout=function(){t(new TypeError("Network request failed"))},o.open(e.method,e.url,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),e.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t,e,n,r=y(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=m(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n,r,i=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function u(t){return Boolean(t&&void 0!==t.length)}function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void c(r.promise,t)}s(r.promise,e)}else(1===n._state?s:c)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void f((r=n,i=t,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=t,h(e)}catch(t){c(e,t)}var r,i}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new l(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!u(e))return i(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){if(!u(i))return e(new TypeError("Promise.race accepts an array"));for(var n=0,r=i.length;n<r;n++)o.resolve(i[n]).then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=n):p.Promise=o;var d,y,m,g="object",v=function(t){return t&&t.Math==Math&&t},b=v(typeof globalThis==g&&globalThis)||v(typeof window==g&&window)||v(typeof self==g&&self)||v(typeof t==g&&t)||Function("return this")(),w=function(t){try{return!!t()}catch(t){return!0}},_=!w(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),E={}.propertyIsEnumerable,T=Object.getOwnPropertyDescriptor,S={f:T&&!E.call({1:2},1)?function(t){var e=T(this,t);return!!e&&e.enumerable}:E},I=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},C={}.toString,N=function(t){return C.call(t).slice(8,-1)},A="".split,k=w(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==N(t)?A.call(t,""):Object(t)}:Object,D=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},R=function(t){return k(D(t))},O=function(t){return"object"==typeof t?null!==t:"function"==typeof t},P=function(t,e){if(!O(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!O(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!O(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!O(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},x={}.hasOwnProperty,M=function(t,e){return x.call(t,e)},L=b.document,F=O(L)&&O(L.createElement),U=function(t){return F?L.createElement(t):{}},q=!_&&!w(function(){return 7!=Object.defineProperty(U("div"),"a",{get:function(){return 7}}).a}),V=Object.getOwnPropertyDescriptor,B={f:_?V:function(t,e){if(t=R(t),e=P(e,!0),q)try{return V(t,e)}catch(t){}if(M(t,e))return I(!S.f.call(t,e),t[e])}},j=function(t){if(!O(t))throw TypeError(String(t)+" is not an object");return t},W=Object.defineProperty,K={f:_?W:function(t,e,n){if(j(t),e=P(e,!0),j(n),q)try{return W(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},Q=_?function(t,e,n){return K.f(t,e,I(1,n))}:function(t,e,n){return t[e]=n,t},H=function(e,n){try{Q(b,e,n)}catch(t){b[e]=n}return n},G=!1,z=e(function(t){var e="__core-js_shared__",n=b[e]||H(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),Y=z("native-function-to-string",Function.toString),X=b.WeakMap,J="function"==typeof X&&/native code/.test(Y.call(X)),$=0,Z=Math.random(),tt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++$+Z).toString(36)},et=z("keys"),nt=function(t){return et[t]||(et[t]=tt(t))},rt={},it=b.WeakMap;if(J){var ot=new it,at=ot.get,st=ot.has,ut=ot.set;d=function(t,e){return ut.call(ot,t,e),e},y=function(t){return at.call(ot,t)||{}},m=function(t){return st.call(ot,t)}}else{var ct=nt("state");rt[ct]=!0,d=function(t,e){return Q(t,ct,e),e},y=function(t){return M(t,ct)?t[ct]:{}},m=function(t){return M(t,ct)}}var ht={set:d,get:y,has:m,enforce:function(t){return m(t)?y(t):d(t,{})},getterFor:function(n){return function(t){var e;if(!O(t)||(e=y(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},lt=e(function(t){var e=ht.get,s=ht.enforce,u=String(Y).split("toString");z("inspectSource",function(t){return Y.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||M(n,"name")||Q(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:Q(t,e,n)):o?t[e]=n:H(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||Y.call(this)})}),ft=b,pt=function(t){return"function"==typeof t?t:void 0},dt=function(t,e){return arguments.length<2?pt(ft[t])||pt(b[t]):ft[t]&&ft[t][e]||b[t]&&b[t][e]},yt=Math.ceil,mt=Math.floor,gt=function(t){return isNaN(t=+t)?0:(0<t?mt:yt)(t)},vt=Math.min,bt=function(t){return 0<t?vt(gt(t),9007199254740991):0},wt=Math.max,_t=Math.min,Et=function(c){return function(t,e,n){var r,i,o,a=R(t),s=bt(a.length),u=(r=s,(i=gt(n))<0?wt(i+r,0):_t(i,r));if(c&&e!=e){for(;u<s;)if((o=a[u++])!=o)return!0}else for(;u<s;u++)if((c||u in a)&&a[u]===e)return c||u||0;return!c&&-1}},Tt={includes:Et(!0),indexOf:Et(!1)}.indexOf,St=function(t,e){var n,r=R(t),i=0,o=[];for(n in r)!M(rt,n)&&M(r,n)&&o.push(n);for(;e.length>i;)M(r,n=e[i++])&&(~Tt(o,n)||o.push(n));return o},It=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ct=It.concat("length","prototype"),Nt={f:Object.getOwnPropertyNames||function(t){return St(t,Ct)}},At={f:Object.getOwnPropertySymbols},kt=dt("Reflect","ownKeys")||function(t){var e=Nt.f(j(t)),n=At.f;return n?e.concat(n(t)):e},Dt=function(t,e){for(var n=kt(e),r=K.f,i=B.f,o=0;o<n.length;o++){var a=n[o];M(t,a)||r(t,a,i(e,a))}},Rt=/#|\.prototype\./,Ot=function(t,e){var n=xt[Pt(t)];return n==Lt||n!=Mt&&("function"==typeof e?w(e):!!e)},Pt=Ot.normalize=function(t){return String(t).replace(Rt,".").toLowerCase()},xt=Ot.data={},Mt=Ot.NATIVE="N",Lt=Ot.POLYFILL="P",Ft=Ot,Ut=B.f,qt=function(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||H(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Ut(n,r))&&a.value:n[r],!Ft(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;Dt(o,i)}(t.sham||i&&i.sham)&&Q(o,"sham",!0),lt(n,r,o,t)}},Vt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Bt=function(r,i,t){if(Vt(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}},jt=function(t){return Object(D(t))},Wt=Array.isArray||function(t){return"Array"==N(t)},Kt=!!Object.getOwnPropertySymbols&&!w(function(){return!String(Symbol())}),Qt=b.Symbol,Ht=z("wks"),Gt=function(t){return Ht[t]||(Ht[t]=Kt&&Qt[t]||(Kt?Qt:tt)("Symbol."+t))},zt=Gt("species"),Yt=function(t,e){var n;return Wt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Wt(n.prototype)?O(n)&&null===(n=n[zt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Xt=[].push,Jt=function(p){var d=1==p,y=2==p,m=3==p,g=4==p,v=6==p,b=5==p||v;return function(t,e,n,r){for(var i,o,a=jt(t),s=k(a),u=Bt(e,n,3),c=bt(s.length),h=0,l=r||Yt,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:Xt.call(f,i)}else if(g)return!1;return v?-1:m||g?g:f}},$t={forEach:Jt(0),map:Jt(1),filter:Jt(2),some:Jt(3),every:Jt(4),find:Jt(5),findIndex:Jt(6)},Zt=Object.keys||function(t){return St(t,It)},te=_?Object.defineProperties:function(t,e){j(t);for(var n,r=Zt(e),i=r.length,o=0;o<i;)K.f(t,n=r[o++],e[n]);return t},ee=dt("document","documentElement"),ne=nt("IE_PROTO"),re="prototype",ie=function(){},oe=function(){var t,e=U("iframe"),n=It.length,r="script";for(e.style.display="none",ee.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),oe=t.F;n--;)delete oe[re][It[n]];return oe()},ae=Object.create||function(t,e){var n;return null!==t?(ie[re]=j(t),n=new ie,ie[re]=null,n[ne]=t):n=oe(),void 0===e?n:te(n,e)};rt[ne]=!0;var se=Gt("unscopables"),ue=Array.prototype;null==ue[se]&&Q(ue,se,ae(null));var ce=function(t){ue[se][t]=!0},he=$t.find,le="find",fe=!0;le in[]&&Array(1)[le](function(){fe=!1}),qt({target:"Array",proto:!0,forced:fe},{find:function(t){return he(this,t,1<arguments.length?arguments[1]:void 0)}}),ce(le);var pe=Function.call,de=function(t,e,n){return Bt(pe,b[t].prototype[e],n)},ye=(de("Array","find"),$t.findIndex),me="findIndex",ge=!0;me in[]&&Array(1)[me](function(){ge=!1}),qt({target:"Array",proto:!0,forced:ge},{findIndex:function(t){return ye(this,t,1<arguments.length?arguments[1]:void 0)}}),ce(me);de("Array","findIndex");var ve,be,we,_e=function(s){return function(t,e){var n,r,i=String(D(t)),o=gt(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}},Ee={codeAt:_e(!1),charAt:_e(!0)},Te=!w(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Se=nt("IE_PROTO"),Ie=Object.prototype,Ce=Te?Object.getPrototypeOf:function(t){return t=jt(t),M(t,Se)?t[Se]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ie:null},Ne=Gt("iterator"),Ae=!1;[].keys&&("next"in(we=[].keys())?(be=Ce(Ce(we)))!==Object.prototype&&(ve=be):Ae=!0),null==ve&&(ve={}),M(ve,Ne)||Q(ve,Ne,function(){return this});var ke={IteratorPrototype:ve,BUGGY_SAFARI_ITERATORS:Ae},De=K.f,Re=Gt("toStringTag"),Oe=function(t,e,n){t&&!M(t=n?t:t.prototype,Re)&&De(t,Re,{configurable:!0,value:e})},Pe={},xe=ke.IteratorPrototype,Me=function(){return this},Le=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return j(t),function(t){if(!O(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),Fe=ke.IteratorPrototype,Ue=ke.BUGGY_SAFARI_ITERATORS,qe=Gt("iterator"),Ve="values",Be="entries",je=function(){return this},We=function(t,e,n,r,i,o,a){var s,u,c;u=r,c=e+" Iterator",(s=n).prototype=ae(xe,{next:I(1,u)}),Oe(s,c,!1),Pe[c]=Me;var h,l,f,p=function(t){if(t===i&&v)return v;if(!Ue&&t in m)return m[t];switch(t){case"keys":case Ve:case Be:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",y=!1,m=t.prototype,g=m[qe]||m["@@iterator"]||i&&m[i],v=!Ue&&g||p(i),b="Array"==e&&m.entries||g;if(b&&(h=Ce(b.call(new t)),Fe!==Object.prototype&&h.next&&(Ce(h)!==Fe&&(Le?Le(h,Fe):"function"!=typeof h[qe]&&Q(h,qe,je)),Oe(h,d,!0))),i==Ve&&g&&g.name!==Ve&&(y=!0,v=function(){return g.call(this)}),m[qe]!==v&&Q(m,qe,v),Pe[e]=v,i)if(l={values:p(Ve),keys:o?v:p("keys"),entries:p(Be)},a)for(f in l)!Ue&&!y&&f in m||lt(m,f,l[f]);else qt({target:e,proto:!0,forced:Ue||y},l);return l},Ke=Ee.charAt,Qe="String Iterator",He=ht.set,Ge=ht.getterFor(Qe);We(String,"String",function(t){He(this,{type:Qe,string:String(t),index:0})},function(){var t,e=Ge(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ke(n,r),e.index+=t.length,{value:t,done:!1})});var ze=function(e,t,n,r){try{return r?t(j(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&j(i.call(e)),t}},Ye=Gt("iterator"),Xe=Array.prototype,Je=function(t){return void 0!==t&&(Pe.Array===t||Xe[Ye]===t)},$e=function(t,e,n){var r=P(e);r in t?K.f(t,r,I(0,n)):t[r]=n},Ze=Gt("toStringTag"),tn="Arguments"==N(function(){return arguments}()),en=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ze))?n:tn?N(e):"Object"==(r=N(e))&&"function"==typeof e.callee?"Arguments":r},nn=Gt("iterator"),rn=function(t){if(null!=t)return t[nn]||t["@@iterator"]||Pe[en(t)]},on=Gt("iterator"),an=!1;try{var sn=0,un={next:function(){return{done:!!sn++}},return:function(){an=!0}};un[on]=function(){return this},Array.from(un,function(){throw 2})}catch(_o){}var cn=function(t,e){if(!e&&!an)return!1;var n=!1;try{var r={};r[on]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},hn=!cn(function(t){Array.from(t)});qt({target:"Array",stat:!0,forced:hn},{from:function(t){var e,n,r,i,o=jt(t),a="function"==typeof this?this:Array,s=arguments.length,u=1<s?arguments[1]:void 0,c=void 0!==u,h=0,l=rn(o);if(c&&(u=Bt(u,2<s?arguments[2]:void 0,2)),null==l||a==Array&&Je(l))for(n=new a(e=bt(o.length));h<e;h++)$e(n,h,c?u(o[h],h):o[h]);else for(i=l.call(o),n=new a;!(r=i.next()).done;h++)$e(n,h,c?ze(i,u,[r.value,h],!0):r.value);return n.length=h,n}});ft.Array.from;var ln=Object.assign,fn=!ln||w(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=ln({},t)[n]||Zt(ln({},e)).join("")!=r})?function(t,e){for(var n=jt(t),r=arguments.length,i=1,o=At.f,a=S.f;i<r;)for(var s,u=k(arguments[i++]),c=o?Zt(u).concat(o(u)):Zt(u),h=c.length,l=0;l<h;)s=c[l++],_&&!a.call(u,s)||(n[s]=u[s]);return n}:ln;qt({target:"Object",stat:!0,forced:Object.assign!==fn},{assign:fn});ft.Object.assign;var pn=S.f,dn=function(s){return function(t){for(var e,n=R(t),r=Zt(n),i=r.length,o=0,a=[];o<i;)e=r[o++],_&&!pn.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}},yn={entries:dn(!0),values:dn(!1)},mn=yn.entries;qt({target:"Object",stat:!0},{entries:function(t){return mn(t)}});ft.Object.entries;var gn=yn.values;qt({target:"Object",stat:!0},{values:function(t){return gn(t)}});ft.Object.values;var vn=Gt("match"),bn=function(t){if(O(e=t)&&(void 0!==(n=e[vn])?n:"RegExp"==N(e)))throw TypeError("The method doesn't accept regular expressions");var e,n;return t},wn=Gt("match"),_n="".startsWith,En=Math.min;qt({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[wn]=!1,"/./"[e](n)}catch(t){}}return!1}("startsWith")},{startsWith:function(t){var e=String(D(this));bn(t);var n=bt(En(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return _n?_n.call(e,r,n):e.slice(n,n+r.length)===r}});de("String","startsWith");qt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(D(this)),n="",r=gt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});de("String","repeat");var Tn,Sn=Gt("species"),In=Gt("isConcatSpreadable"),Cn=9007199254740991,Nn="Maximum allowed index exceeded",An=!w(function(){var t=[];return t[In]=!1,t.concat()[0]!==t}),kn=(Tn="concat",!w(function(){var t=[];return(t.constructor={})[Sn]=function(){return{foo:1}},1!==t[Tn](Boolean).foo})),Dn=function(t){if(!O(t))return!1;var e=t[In];return void 0!==e?!!e:Wt(t)};qt({target:"Array",proto:!0,forced:!An||!kn},{concat:function(t){var e,n,r,i,o,a=jt(this),s=Yt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?a:arguments[e],Dn(o)){if(i=bt(o.length),Cn<u+i)throw TypeError(Nn);for(n=0;n<i;n++,u++)n in o&&$e(s,u,o[n])}else{if(Cn<=u)throw TypeError(Nn);$e(s,u++,o)}return s.length=u,s}});var Rn={};Rn[Gt("toStringTag")]="z";var On="[object z]"!==String(Rn)?function(){return"[object "+en(this)+"]"}:Rn.toString,Pn=Object.prototype;On!==Pn.toString&&lt(Pn,"toString",On,{unsafe:!0});var xn=Nt.f,Mn={}.toString,Ln="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Fn={f:function(t){return Ln&&"[object Window]"==Mn.call(t)?function(t){try{return xn(t)}catch(t){return Ln.slice()}}(t):xn(R(t))}},Un={f:Gt},qn=K.f,Vn=function(t){var e=ft.Symbol||(ft.Symbol={});M(e,t)||qn(e,t,{value:Un.f(t)})},Bn=$t.forEach,jn=nt("hidden"),Wn="Symbol",Kn="prototype",Qn=Gt("toPrimitive"),Hn=ht.set,Gn=ht.getterFor(Wn),zn=Object[Kn],Yn=b.Symbol,Xn=b.JSON,Jn=Xn&&Xn.stringify,$n=B.f,Zn=K.f,tr=Fn.f,er=S.f,nr=z("symbols"),rr=z("op-symbols"),ir=z("string-to-symbol-registry"),or=z("symbol-to-string-registry"),ar=z("wks"),sr=b.QObject,ur=!sr||!sr[Kn]||!sr[Kn].findChild,cr=_&&w(function(){return 7!=ae(Zn({},"a",{get:function(){return Zn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=$n(zn,e);r&&delete zn[e],Zn(t,e,n),r&&t!==zn&&Zn(zn,e,r)}:Zn,hr=function(t,e){var n=nr[t]=ae(Yn[Kn]);return Hn(n,{type:Wn,tag:t,description:e}),_||(n.description=e),n},lr=Kt&&"symbol"==typeof Yn.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Yn},fr=function(t,e,n){t===zn&&fr(rr,e,n),j(t);var r=P(e,!0);return j(n),M(nr,r)?(n.enumerable?(M(t,jn)&&t[jn][r]&&(t[jn][r]=!1),n=ae(n,{enumerable:I(0,!1)})):(M(t,jn)||Zn(t,jn,I(1,{})),t[jn][r]=!0),cr(t,r,n)):Zn(t,r,n)},pr=function(e,t){j(e);var n=R(t),r=Zt(n).concat(gr(n));return Bn(r,function(t){_&&!dr.call(n,t)||fr(e,t,n[t])}),e},dr=function(t){var e=P(t,!0),n=er.call(this,e);return!(this===zn&&M(nr,e)&&!M(rr,e))&&(!(n||!M(this,e)||!M(nr,e)||M(this,jn)&&this[jn][e])||n)},yr=function(t,e){var n=R(t),r=P(e,!0);if(n!==zn||!M(nr,r)||M(rr,r)){var i=$n(n,r);return!i||!M(nr,r)||M(n,jn)&&n[jn][r]||(i.enumerable=!0),i}},mr=function(t){var e=tr(R(t)),n=[];return Bn(e,function(t){M(nr,t)||M(rt,t)||n.push(t)}),n},gr=function(t){var e=t===zn,n=tr(e?rr:R(t)),r=[];return Bn(n,function(t){!M(nr,t)||e&&!M(zn,t)||r.push(nr[t])}),r};Kt||(lt((Yn=function(){if(this instanceof Yn)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=tt(t),n=function(t){this===zn&&n.call(rr,t),M(this,jn)&&M(this[jn],e)&&(this[jn][e]=!1),cr(this,e,I(1,t))};return _&&ur&&cr(zn,e,{configurable:!0,set:n}),hr(e,t)})[Kn],"toString",function(){return Gn(this).tag}),S.f=dr,K.f=fr,B.f=yr,Nt.f=Fn.f=mr,At.f=gr,_&&(Zn(Yn[Kn],"description",{configurable:!0,get:function(){return Gn(this).description}}),lt(zn,"propertyIsEnumerable",dr,{unsafe:!0})),Un.f=function(t){return hr(Gt(t),t)}),qt({global:!0,wrap:!0,forced:!Kt,sham:!Kt},{Symbol:Yn}),Bn(Zt(ar),function(t){Vn(t)}),qt({target:Wn,stat:!0,forced:!Kt},{for:function(t){var e=String(t);if(M(ir,e))return ir[e];var n=Yn(e);return ir[e]=n,or[n]=e,n},keyFor:function(t){if(!lr(t))throw TypeError(t+" is not a symbol");if(M(or,t))return or[t]},useSetter:function(){ur=!0},useSimple:function(){ur=!1}}),qt({target:"Object",stat:!0,forced:!Kt,sham:!_},{create:function(t,e){return void 0===e?ae(t):pr(ae(t),e)},defineProperty:fr,defineProperties:pr,getOwnPropertyDescriptor:yr}),qt({target:"Object",stat:!0,forced:!Kt},{getOwnPropertyNames:mr,getOwnPropertySymbols:gr}),qt({target:"Object",stat:!0,forced:w(function(){At.f(1)})},{getOwnPropertySymbols:function(t){return At.f(jt(t))}}),Xn&&qt({target:"JSON",stat:!0,forced:!Kt||w(function(){var t=Yn();return"[null]"!=Jn([t])||"{}"!=Jn({a:t})||"{}"!=Jn(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(O(e)||void 0!==t)&&!lr(t))return Wt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!lr(e))return e}),r[1]=e,Jn.apply(Xn,r)}}),Yn[Kn][Qn]||Q(Yn[Kn],Qn,Yn[Kn].valueOf),Oe(Yn,Wn),rt[jn]=!0,Vn("asyncIterator");var vr=K.f,br=b.Symbol;if(_&&"function"==typeof br&&(!("description"in br.prototype)||void 0!==br().description)){var wr={},_r=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof _r?new br(t):void 0===t?br():br(t);return""===t&&(wr[e]=!0),e};Dt(_r,br);var Er=_r.prototype=br.prototype;Er.constructor=_r;var Tr=Er.toString,Sr="Symbol(test)"==String(br("test")),Ir=/^Symbol\((.*)\)[^)]+$/;vr(Er,"description",{configurable:!0,get:function(){var t=O(this)?this.valueOf():this,e=Tr.call(t);if(M(wr,t))return"";var n=Sr?e.slice(7,-1):e.replace(Ir,"$1");return""===n?void 0:n}}),qt({global:!0,forced:!0},{Symbol:_r})}Vn("hasInstance"),Vn("isConcatSpreadable"),Vn("iterator"),Vn("match"),Vn("matchAll"),Vn("replace"),Vn("search"),Vn("species"),Vn("split"),Vn("toPrimitive"),Vn("toStringTag"),Vn("unscopables"),Oe(Math,"Math",!0),Oe(b.JSON,"JSON",!0);ft.Symbol;Vn("dispose"),Vn("observable"),Vn("patternMatch"),Vn("replaceAll");var Cr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Nr="Array Iterator",Ar=ht.set,kr=ht.getterFor(Nr),Dr=We(Array,"Array",function(t,e){Ar(this,{type:Nr,target:R(t),index:0,kind:e})},function(){var t=kr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");Pe.Arguments=Pe.Array,ce("keys"),ce("values"),ce("entries");var Rr=Gt("iterator"),Or=Gt("toStringTag"),Pr=Dr.values;for(var xr in Cr){var Mr=b[xr],Lr=Mr&&Mr.prototype;if(Lr){if(Lr[Rr]!==Pr)try{Q(Lr,Rr,Pr)}catch(_o){Lr[Rr]=Pr}if(Lr[Or]||Q(Lr,Or,xr),Cr[xr])for(var Fr in Dr)if(Lr[Fr]!==Dr[Fr])try{Q(Lr,Fr,Dr[Fr])}catch(_o){Lr[Fr]=Dr[Fr]}}}Un.f("iterator");var Ur=!w(function(){return Object.isExtensible(Object.preventExtensions({}))}),qr=e(function(t){var e=K.f,n=tt("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(t){e(t,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!O(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!M(t,n)){if(!i(t))return"F";if(!e)return"E";o(t)}return t[n].objectID},getWeakData:function(t,e){if(!M(t,n)){if(!i(t))return!0;if(!e)return!1;o(t)}return t[n].weakData},onFreeze:function(t){return Ur&&a.REQUIRED&&i(t)&&!M(t,n)&&o(t),t}};rt[n]=!0}),Vr=(qr.REQUIRED,qr.fastKey,qr.getWeakData,qr.onFreeze,e(function(t){var f=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=Bt(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=rn(t)))throw TypeError("Target is not iterable");if(Je(a)){for(s=0,u=bt(t.length);s<u;s++)if((c=r?l(j(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=ze(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}})),Br=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},jr=function(u,t,e,c,r){var h=b[u],i=h&&h.prototype,l=h,f=c?"set":"add",n={},o=function(t){var n=i[t];lt(i,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(r&&!O(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return r&&!O(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(r&&!O(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})};if(Ft(u,"function"!=typeof h||!(r||i.forEach&&!w(function(){(new h).entries().next()}))))l=e.getConstructor(t,u,c,f),qr.REQUIRED=!0;else if(Ft(u,!0)){var a=new l,s=a[f](r?{}:-0,1)!=a,p=w(function(){a.has(1)}),d=cn(function(t){new h(t)}),y=!r&&w(function(){for(var t=new h,e=5;e--;)t[f](e,e);return!t.has(-0)});d||(((l=t(function(t,e){Br(t,l,u);var n,r,i,o,a,s=(n=new h,r=t,i=l,Le&&"function"==typeof(o=r.constructor)&&o!==i&&O(a=o.prototype)&&a!==i.prototype&&Le(n,a),n);return null!=e&&Vr(e,s[f],s,c),s})).prototype=i).constructor=l),(p||y)&&(o("delete"),o("has"),c&&o("get")),(y||s)&&o(f),r&&i.clear&&delete i.clear}return n[u]=l,qt({global:!0,forced:l!=h},n),Oe(l,u),r||e.setStrong(l,u,c),l},Wr=function(t,e,n){for(var r in e)lt(t,r,e[r],n);return t},Kr=Gt("species"),Qr=K.f,Hr=qr.fastKey,Gr=ht.set,zr=ht.getterFor,Yr={getConstructor:function(t,n,r,i){var o=t(function(t,e){Br(t,o,n),Gr(t,{type:n,index:ae(null),first:void 0,last:void 0,size:0}),_||(t.size=0),null!=e&&Vr(e,t[i],t,r)}),s=zr(n),a=function(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Hr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),_?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t},u=function(t,e){var n,r=s(t),i=Hr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Wr(o.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,_?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),_?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=s(this),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!u(this,t)}}),Wr(o.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return a(this,0===t?0:t,e)}}:{add:function(t){return a(this,t=0===t?0:t,t)}}),_&&Qr(o.prototype,"size",{get:function(){return s(this).size}}),o},setStrong:function(t,e,n){var r,i,o=e+" Iterator",a=zr(e),s=zr(o);We(t,e,function(t,e){Gr(this,{type:o,target:t,state:a(t),kind:e,last:void 0})},function(){for(var t=s(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),r=dt(e),i=K.f,_&&r&&!r[Kr]&&i(r,Kr,{configurable:!0,get:function(){return this}})}},Xr=(jr("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yr,!0),ft.Map,function(t){var e,n,r,i,o=arguments.length,a=1<o?arguments[1]:void 0;return Vt(this),(e=void 0!==a)&&Vt(a),null==t?new this:(n=[],e?(r=0,i=Bt(a,2<o?arguments[2]:void 0,2),Vr(t,function(t){n.push(i(t,r++))})):Vr(t,n.push,n),new this(n))});qt({target:"Map",stat:!0},{from:Xr});var Jr=function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)};qt({target:"Map",stat:!0},{of:Jr});var $r=function(){for(var t=j(this),e=Vt(t.delete),n=!0,r=0,i=arguments.length;r<i;r++)n=n&&e.call(t,arguments[r]);return!!n};qt({target:"Map",proto:!0,real:!0,forced:G},{deleteAll:function(){return $r.apply(this,arguments)}});var Zr=function(t){return Map.prototype.entries.call(t)};qt({target:"Map",proto:!0,real:!0,forced:G},{every:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return!Vr(e,function(t,e){if(!r(e,t,n))return Vr.stop()},void 0,!0,!0).stopped}});var ti=Gt("species"),ei=function(t,e){var n,r=j(t).constructor;return void 0===r||null==(n=j(r)[ti])?e:Vt(n)};qt({target:"Map",proto:!0,real:!0,forced:G},{filter:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){r(e,t,n)&&o.call(i,t,e)},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{find:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop(e)},void 0,!0,!0).result}}),qt({target:"Map",proto:!0,real:!0,forced:G},{findKey:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop(t)},void 0,!0,!0).result}}),qt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;Vt(n);var i=Vt(r.has),o=Vt(r.get),a=Vt(r.set);return Vr(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});qt({target:"Map",proto:!0,real:!0,forced:G},{includes:function(i){return Vr(Zr(j(this)),function(t,e){if((n=e)===(r=i)||n!=n&&r!=r)return Vr.stop();var n,r},void 0,!0,!0).stopped}}),qt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Vt(e);var r=Vt(n.set);return Vr(t,function(t){r.call(n,e(t),t)}),n}}),qt({target:"Map",proto:!0,real:!0,forced:G},{keyOf:function(n){return Vr(Zr(j(this)),function(t,e){if(e===n)return Vr.stop(t)},void 0,!0,!0).result}}),qt({target:"Map",proto:!0,real:!0,forced:G},{mapKeys:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){o.call(i,r(e,t,n),e)},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{mapValues:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(n,dt("Map"))),o=Vt(i.set);return Vr(e,function(t,e){o.call(i,t,r(e,t,n))},void 0,!0,!0),i}}),qt({target:"Map",proto:!0,real:!0,forced:G},{merge:function(t){for(var e=j(this),n=Vt(e.set),r=0;r<arguments.length;)Vr(arguments[r++],n,e,!0);return e}}),qt({target:"Map",proto:!0,real:!0,forced:G},{reduce:function(n){var r,t,i=j(this),e=Zr(i);if(Vt(n),1<arguments.length)r=arguments[1];else{if((t=e.next()).done)throw TypeError("Reduce of empty map with no initial value");r=t.value[1]}return Vr(e,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),qt({target:"Map",proto:!0,real:!0,forced:G},{some:function(t){var n=j(this),e=Zr(n),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(e,function(t,e){if(r(e,t,n))return Vr.stop()},void 0,!0,!0).stopped}}),qt({target:"Map",proto:!0,real:!0,forced:G},{update:function(t,e){var n=j(this),r=arguments.length;Vt(e);var i=n.has(t);if(!i&&r<3)throw TypeError("Updating absent value");var o=i?n.get(t):Vt(2<r?arguments[2]:void 0)(t,n);return n.set(t,e(o,t,n)),n}});jr("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yr),ft.Set;qt({target:"Set",stat:!0},{from:Xr}),qt({target:"Set",stat:!0},{of:Jr});qt({target:"Set",proto:!0,real:!0,forced:G},{addAll:function(){return function(){for(var t=j(this),e=Vt(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),qt({target:"Set",proto:!0,real:!0,forced:G},{deleteAll:function(){return $r.apply(this,arguments)}});var ni=function(t){return Set.prototype.values.call(t)};qt({target:"Set",proto:!0,real:!0,forced:G},{every:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return!Vr(n,function(t){if(!r(t,t,e))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{difference:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e),r=Vt(n.delete);return Vr(t,function(t){r.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{filter:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(e,dt("Set"))),o=Vt(i.add);return Vr(n,function(t){r(t,t,e)&&o.call(i,t)},void 0,!1,!0),i}}),qt({target:"Set",proto:!0,real:!0,forced:G},{find:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(n,function(t){if(r(t,t,e))return Vr.stop(t)},void 0,!1,!0).result}}),qt({target:"Set",proto:!0,real:!0,forced:G},{intersection:function(t){var e=j(this),n=new(ei(e,dt("Set"))),r=Vt(e.has),i=Vt(n.add);return Vr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isDisjointFrom:function(t){var e=j(this),n=Vt(e.has);return!Vr(t,function(t){if(!0===n.call(e,t))return Vr.stop()}).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isSubsetOf:function(t){var e=function(t){var e=rn(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return j(e.call(t))}(this),n=j(t),r=n.has;return"function"!=typeof r&&(n=new(dt("Set"))(t),r=Vt(n.has)),!Vr(e,function(t){if(!1===r.call(n,t))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{isSupersetOf:function(t){var e=j(this),n=Vt(e.has);return!Vr(t,function(t){if(!1===n.call(e,t))return Vr.stop()}).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{join:function(t){var e=j(this),n=ni(e),r=void 0===t?",":String(t),i=[];return Vr(n,i.push,i,!1,!0),i.join(r)}}),qt({target:"Set",proto:!0,real:!0,forced:G},{map:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3),i=new(ei(e,dt("Set"))),o=Vt(i.add);return Vr(n,function(t){o.call(i,r(t,t,e))},void 0,!1,!0),i}}),qt({target:"Set",proto:!0,real:!0,forced:G},{reduce:function(e){var n,t,r=j(this),i=ni(r);if(Vt(e),1<arguments.length)n=arguments[1];else{if((t=i.next()).done)throw TypeError("Reduce of empty set with no initial value");n=t.value}return Vr(i,function(t){n=e(n,t,t,r)},void 0,!1,!0),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{some:function(t){var e=j(this),n=ni(e),r=Bt(t,1<arguments.length?arguments[1]:void 0,3);return Vr(n,function(t){if(r(t,t,e))return Vr.stop()},void 0,!1,!0).stopped}}),qt({target:"Set",proto:!0,real:!0,forced:G},{symmetricDifference:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e),r=Vt(n.delete),i=Vt(n.add);return Vr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),qt({target:"Set",proto:!0,real:!0,forced:G},{union:function(t){var e=j(this),n=new(ei(e,dt("Set")))(e);return Vr(t,Vt(n.add),n),n}});var ri=function(t,e){return(ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ii(t,e){function n(){this.constructor=t}ri(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oi=function(){return(oi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ai(o,a,s,u){return new(s||(s=Promise))(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function si(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ui(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ci(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function hi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ci(arguments[e]));return t}var li={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},fi=function(t,e){if(!t)throw pi(e)},pi=function(t){return new Error("Firebase Database ("+li.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},di=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,i>>6&63|128),63&i|128)}return e},yi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(di(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},mi=function(t){try{return yi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function gi(t){return vi(void 0,t)}function vi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=vi(t[n],e[n]));return t}var bi=function(){function t(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}return t.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},t}();function wi(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function _i(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wi())}function Ei(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ti(){return!0===li.NODE_ADMIN}var Si=function(r){function i(t,e){var n=r.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ii.prototype.create),n}return ii(i,r),i}(Error),Ii=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,a=this.errors[t],s=a?(r=i,a.replace(Ci,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",u=this.serviceName+": "+s+" ("+o+").",c=new Si(o,u),h=0,l=Object.keys(i);h<l.length;h++){var f=l[h];"_"!==f.slice(-1)&&(f in c&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),c[f]=i[f])}return c},t}();var Ci=/\{\$([^}]+)}/g;function Ni(t){return JSON.parse(t)}function Ai(t){return JSON.stringify(t)}var ki=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ni(mi(o[0])||""),n=Ni(mi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}};function Di(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ri(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Oi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var xi=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function Mi(t,e){var n=new Li(t,e);return n.subscribe.bind(n)}var Li=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},t.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Fi),void 0===r.error&&(r.error=Fi),void 0===r.complete&&(r.complete=Fi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function Fi(){}var Ui=function(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function qi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Vi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(qi(t,e,r)+"must be a valid function.")}function Bi(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(qi(t,e,r)+"must be a valid context object.")}var ji,Wi,Ki=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e};(Wi=ji||(ji={}))[Wi.DEBUG=0]="DEBUG",Wi[Wi.VERBOSE=1]="VERBOSE",Wi[Wi.INFO=2]="INFO",Wi[Wi.WARN=3]="WARN",Wi[Wi.ERROR=4]="ERROR",Wi[Wi.SILENT=5]="SILENT";var Qi,Hi=ji.INFO,Gi=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case ji.DEBUG:case ji.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},zi=function(){function t(t){this.name=t,this._logLevel=Hi,this._logHandler=Gi}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in ji))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.ERROR].concat(t))},t}(),Yi=((Qi={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Qi["bad-app-name"]="Illegal App name: '{$appName}",Qi["duplicate-app"]="Firebase App named '{$appName}' already exists",Qi["app-deleted"]="Firebase App named '{$appName}' already deleted",Qi["duplicate-service"]="Firebase service named '{$appName}' already registered",Qi["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Qi),Xi=new Ii("app","Firebase",Yi),Ji="[DEFAULT]",$i=[],Zi=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=gi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){$i.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){$i=$i.filter(function(t){return t!==e})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=Ji),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==Ji?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;vi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&($i.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),$i=[])},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Xi.create("app-deleted",{appName:this.name_})},t}();Zi.prototype.name&&Zi.prototype.options||Zi.prototype.delete||console.log("dc");var to="6.3.3";var eo=new zi("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){eo.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var no=self.firebase.SDK_VERSION;no&&0<=no.indexOf("LITE")&&eo.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ro=function t(){var e=function(a){var s={},u={},c={},h={__esModule:!0,initializeApp:function(t,e){if(void 0===e&&(e={}),"object"!=typeof e||null===e){var n=e;e={name:n}}var r=e;void 0===r.name&&(r.name=Ji);var i=r.name;if("string"!=typeof i||!i)throw Xi.create("bad-app-name",{appName:String(i)});if(Di(s,i))throw Xi.create("duplicate-app",{appName:i});var o=new a(t,r,h);return p(s[i]=o,"create"),o},app:l,apps:null,SDK_VERSION:to,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),u[n])throw Xi.create("duplicate-service",{appName:n});function o(t){if(void 0===t&&(t=l()),"function"!=typeof t[n])throw Xi.create("invalid-app-argument",{appName:n});return t[n]()}return u[n]=t,r&&(c[n]=r,f().forEach(function(t){r("create",t)})),void 0!==e&&vi(o,e),h[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){p(s[t],"delete"),delete s[t]},factories:u,useAsService:o}};function l(t){if(!Di(s,t=t||Ji))throw Xi.create("no-app",{appName:t});return s[t]}function f(){return Object.keys(s).map(function(t){return s[t]})}function p(t,e){for(var n=0,r=Object.keys(u);n<r.length;n++){var i=o(0,r[n]);if(null===i)return;c[i]&&c[i](e,t)}}function o(t,e){return"serverAuth"===e?null:e}return h.default=h,Object.defineProperty(h,"apps",{get:f}),l.App=a,h}(Zi);return e.INTERNAL=oi({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){vi(e,t)},createSubscribe:Mi,ErrorFactory:Ii,deepExtend:vi}),e}(),io=ro.initializeApp;ro.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&eo.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),io.apply(void 0,t)};var Jh=ro;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e,n,r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:(e=t,n=0,function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}})}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.o),reject:t(this.g)}},s.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.u(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.l(t):this.h(t)}},s.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},s.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.u=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ja(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ja(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ja(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var f=/^[\w+/_-]+[=]{0,2}$/,p=null;function s(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),v=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).cd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var M=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=M(t,e)}function V(t,e){var n;return(n=0<=(e=M(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.na=!0,Y.prototype.ma=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.na=!0,tt.prototype.ma=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Et}function vt(t){return t instanceof gt&&t.constructor===gt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}gt.prototype.na=!0,gt.prototype.ma=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof gt?t:(t="object"==typeof t&&t.na?t.ma():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var _t,Et={};function Tt(t){var e=new gt;return e.a=t,e}Tt("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.na=!0,Nt.prototype.ma=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Mt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t,e,n=document.createElement("IFRAME");n.style.display="none",t=n,e=at(X(Z)),x(t,"HTMLIFrameElement"),t.src=et(e).toString(),document.documentElement.appendChild(n);var r=n.contentWindow;(n=r.document).open(),n.write(At(Pt)),n.close();var i="callImmediate"+Math.random(),o="file:"==r.location.protocol?"*":r.location.protocol+"//"+r.location.host;n=_(function(t){"*"!=o&&t.origin!=o||t.data!=i||this.port1.onmessage()},this),r.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){r.postMessage(i,o)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt||(Rt=Ft()),Rt(t)):l.setImmediate(t)}}(),qt||(Ot(),qt=!0),Vt.add(t,e)}Dt("<br>");var qt=!1,Vt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=s)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(s);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(E(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Eb:!0,value:n}:{Eb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){var r,i;t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Lc,t.Mc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||(i=n,(r=t).g=!0,Ut(function(){r.g&&se.call(null,i)}))))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||s,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Wb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ia=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Lc=function(t){this.a=Wt,ee(this,Kt,t)},t.Mc=function(t){this.a=Wt,ee(this,Qt,t)},t.Wb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.qa=this.qa,this.ja=this.ja}S(ue,C);var he=0;function le(t){if(!t.qa&&(t.qa=!0,t.va(),0!=he))t[e]||(t[e]=++v)}function fe(t){return fe[" "](t),t}ce.prototype.qa=!(ue.prototype.name="cancel"),ce.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},fe[" "]=s;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ge=Ct("Edge"),ve=ge||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ge?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(s){return t=s,e=function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=Ce,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}Ie=l.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",s,e),l.removeEventListener("test",s,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:xe[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Kb=!1},S(Pe,Oe);var xe=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var Me="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Le,this.oa=this.Ia=!1}function Ue(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[Me]?rn(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a,s,u=g(i)?!!i.capture:!!i,c=Ze(t);if(c||(t[je]=c=new qe(t)),!(n=c.add(e,n,r,u,o)).proxy)if(a=$e,r=s=ke?function(t){return a.call(s.src,s.listener,t)}:function(t){if(!(t=a.call(s.src,s.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=u),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[Me]?on(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=en(n),t&&t[Me]?(t=t.m,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[Me])Ve(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&ze(t),n.call(r,e)}function $e(t,e){if(t.oa)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.m=new qe(this),(this.Pb=this).Wa=null}function rn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ve(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.S&&"function"==typeof t.S)return t.S();if(h(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[Me]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Pb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.va=function(){if(nn.qb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=ln.prototype).S=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,gn(this,t.m),this.c=t.c,vn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),gn(this,n[4]),this.c=Tn(n[5]||"",!0),vn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function vn(t,e,n){var r,i;e instanceof Rn?(t.a=e,r=t.a,(i=t.h)&&!r.f&&(On(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(xn(this,e),Ln(this,n,t))},r)),r.f=i):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)gn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?vn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function xn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function Mn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){xn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.U=function(){On(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){On(this);var e=[];if(h(t))Mn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,Mn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.na&&(t=t.ma()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Mt(a.name),'"'),a.type){o.push(' type="',Mt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||g(o)&&0<o.nodeType?r(o):L(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=vt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.na?e.ma():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=vt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=vt(e).toString(),a&&(ve&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Mt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(vt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return Jh.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Jh.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Sc:"FirebaseCore-web",Uc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return l.navigator&&l.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function vr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&gr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Er(t){return void 0===t?null:Qn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",l)&&!mr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function xr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==Mr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,qr(t[n]));return e}function Vr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,Lr(this,zr,t),Lr(this,Gr,qr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.w=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.w()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=t[ii];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ti];if(n&&"object"==typeof n){e=n[si];var r=n[oi];if(n=n[ai],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",oi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",ai+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",si+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ti+" property must be a non null object when specified.");if(this.f=null,(e=t[ri])&&"object"==typeof e){if("string"==typeof(e=e[ui])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",ui+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",ri+" property must be a non null object when specified.");if(void 0!==(e=t[ni])&&"boolean"!=typeof e)throw new Yr("argument-error",ni+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ei])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",ei+" property must be a non empty string when specified.");this.i=t||null}var ti="android",ei="dynamicLinkDomain",ni="handleCodeInApp",ri="iOS",ii="url",oi="installApp",ai="minimumVersion",si="packageName",ui="bundleId";function ci(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var hi=null,li=null;function fi(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=li[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!hi){hi={},li={};for(var t=0;t<65;t++)hi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(li[hi[t]]=t)&&(li["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function pi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function di(t){return(t=yi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new pi(t):null}function yi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(fi(t))}catch(t){}return null}pi.prototype.f=function(){return this.b};var mi,gi={Yc:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},$c:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ad:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function vi(t){for(var e in gi)if(gi[e].id===t)return{firebaseEndpoint:(t=gi[e]).bb,secureTokenEndpoint:t.jb};return null}mi=vi("__EID__")?"__EID__":void 0;var bi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),wi=["client_id","response_type","scope","redirect_uri","state"],_i={Tc:{Oa:"locale",Ba:500,Aa:600,Pa:"facebook.com",ib:wi},Vc:{Oa:null,Ba:500,Aa:620,Pa:"github.com",ib:wi},Wc:{Oa:"hl",Ba:515,Aa:680,Pa:"google.com",ib:wi},bd:{Oa:"lang",Ba:485,Aa:705,Pa:"twitter.com",ib:bi}};function Ei(t){for(var e in _i)if(_i[e].Pa==t)return _i[e];return null}function Ti(t){var e={};e["facebook.com"]=Ai,e["google.com"]=Di,e["github.com"]=ki,e["twitter.com"]=Ri;var n=t&&t[Ii];try{if(n)return e[n]?new e[n](t):new Ni(t);if(void 0!==t[Si])return new Ci(t)}catch(t){}return null}var Si="idToken",Ii="providerId";function Ci(t){var e=t[Ii];if(!e&&t[Si]){var n=di(t[Si]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Ni(t){Ci.call(this,t),Lr(this,"profile",qr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Ai(t){if(Ni.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function ki(t){if(Ni.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function Di(t){if(Ni.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ri(t){if(Ni.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Oi(t){this.a=_n(t)}function Pi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function xi(){}function Mi(t,n){return t.then(function(t){if(t[Sa]){var e=di(t[Sa]);if(!e||n!=e.c)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Li(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Fi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Ui(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Li(t.providerId,t.pendingToken)}catch(t){}return null}function qi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function Vi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Bi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new qi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function ji(t,e){this.Cc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Ei(t)||{}).Oa||null,this.ab=null}function Wi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');ji.call(this,t,[])}function Ki(t){ji.call(this,t,wi),this.a=[]}function Qi(){Ki.call(this,"facebook.com")}function Hi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Qi).credential({accessToken:e})}function Gi(){Ki.call(this,"github.com")}function zi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Gi).credential({accessToken:e})}function Yi(){Ki.call(this,"google.com"),this.ua("profile")}function Xi(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new Yi).credential({idToken:n,accessToken:e})}function Ji(){ji.call(this,"twitter.com",bi)}function $i(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new qi("twitter.com",n,"twitter.com")}function Zi(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===eo.EMAIL_LINK_SIGN_IN_METHOD?eo.EMAIL_LINK_SIGN_IN_METHOD:eo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function to(t){return t&&t.email&&t.password?new Zi(t.email,t.password,t.signInMethod):null}function eo(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function no(t,e){if(!(e=ro(e)))throw new Yr("argument-error","Invalid email link!");return new Zi(t,e,eo.EMAIL_LINK_SIGN_IN_METHOD)}function ro(t){var e=wn((t=new Oi(t=Pi(t))).a,"oobCode")||null;return"signIn"===(wn(t.a,"mode")||null)&&e?e:null}function io(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function oo(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new io(n)}return null}function ao(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function so(t){try{this.a=t||Jh.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function uo(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new io({Ua:t,Ta:e})}function co(t){if(t.temporaryProof&&t.phoneNumber)return new io({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Xi(o,n);case"facebook.com":return Hi(n);case"github.com":return zi(n);case"twitter.com":return $i(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Li(e,a):new qi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Ki(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function ho(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function lo(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function fo(t){return(t=t||{}).type?new lo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody):null}function po(){this.b=null,this.a=[]}S(Ni,Ci),S(Ai,Ni),S(ki,Ni),S(Di,Ni),S(Ri,Ni),Li.prototype.la=function(t){return ja(t,Fi(this))},Li.prototype.b=function(t,e){var n=Fi(this);return n.idToken=e,Wa(t,n)},Li.prototype.f=function(t,e){return Mi(Ka(t,Fi(this)),e)},Li.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},qi.prototype.la=function(t){return ja(t,Vi(this))},qi.prototype.b=function(t,e){var n=Vi(this);return n.idToken=e,Wa(t,n)},qi.prototype.f=function(t,e){return Mi(Ka(t,Vi(this)),e)},qi.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},ji.prototype.Da=function(t){return this.zb=H(t),this},S(Wi,ji),S(Ki,ji),Ki.prototype.ua=function(t){return q(this.a,t)||this.a.push(t),this},Ki.prototype.Fb=function(){return W(this.a)},Ki.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new qi(this.providerId,n,this.providerId)},S(Qi,Ki),Lr(Qi,"PROVIDER_ID","facebook.com"),Lr(Qi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(Gi,Ki),Lr(Gi,"PROVIDER_ID","github.com"),Lr(Gi,"GITHUB_SIGN_IN_METHOD","github.com"),S(Yi,Ki),Lr(Yi,"PROVIDER_ID","google.com"),Lr(Yi,"GOOGLE_SIGN_IN_METHOD","google.com"),S(Ji,ji),Lr(Ji,"PROVIDER_ID","twitter.com"),Lr(Ji,"TWITTER_SIGN_IN_METHOD","twitter.com"),Zi.prototype.la=function(t){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,$a,{email:this.a,oobCode:this.c}):bs(t,ys,{email:this.a,password:this.c})},Zi.prototype.b=function(t,e){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,Za,{idToken:e,email:this.a,oobCode:this.c}):bs(t,cs,{idToken:e,email:this.a,password:this.c})},Zi.prototype.f=function(t,e){return Mi(this.la(t),e)},Zi.prototype.w=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(eo,{PROVIDER_ID:"password"}),Fr(eo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(eo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),io.prototype.la=function(t){return t.Va(ao(this))},io.prototype.b=function(t,e){var n=ao(this);return n.idToken=e,bs(t,gs,n)},io.prototype.f=function(t,e){var n=ao(this);return n.operation="REAUTH",Mi(t=bs(t,vs,n),e)},io.prototype.w=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},so.prototype.Va=function(r,i){var o=this.a.c;return Yt(i.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(i.type){case"recaptcha":return(e=o,n={phoneNumber:r,recaptchaToken:t},bs(e,ss,n)).then(function(t){return"function"==typeof i.reset&&i.reset(),t},function(t){throw"function"==typeof i.reset&&i.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}var e,n})},Fr(so,{PROVIDER_ID:"phone"}),Fr(so,{PHONE_SIGN_IN_METHOD:"phone"}),lo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},lo.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.w()}};var yo,mo=null;function go(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function vo(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&Lr(this,"email",t.Ab),t.$&&Lr(this,"phoneNumber",t.$),t.credential&&Lr(this,"credential",t.credential)}function bo(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:co(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new vo(e,n,t.message)}return null}function wo(){}function _o(t){return t.c||(t.c=t.b())}function Eo(){}function To(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function So(){}function Io(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.cc,this),this.a.onerror=_(this.Gb,this),this.a.onprogress=_(this.dc,this),this.a.ontimeout=_(this.hc,this)}function Co(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function No(t,e,n){this.reset(t,e,n,void 0,void 0)}function Ao(t){this.f=t,this.b=this.c=this.a=null}function ko(t,e){this.name=t,this.value=e}po.prototype.subscribe=function(t){var n=this;this.a.push(t),this.b||(this.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",l))&&t(null,this.b))},po.prototype.unsubscribe=function(e){B(this.a,function(t){return t==e})},S(go,Yr),S(vo,Yr),vo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.w();return e&&z(t,e),t},vo.prototype.toJSON=function(){return this.w()},wo.prototype.c=null,S(Eo,wo),Eo.prototype.a=function(){var t=To(this);return t?new ActiveXObject(t):new XMLHttpRequest},Eo.prototype.b=function(){var t={};return To(this)&&(t[0]=!0,t[1]=!0),t},yo=new Eo,S(So,wo),So.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Io;throw Error("Unsupported browser")},So.prototype.b=function(){return{}},(t=Io.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.cc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Co(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",Co(this,4)},t.hc=function(){this.Gb()},t.dc=function(){this.status=200,Co(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},No.prototype.a=null,No.prototype.reset=function(t,e,n,r,i){delete this.a},ko.prototype.toString=function(){return this.name};var Do=new ko("SEVERE",1e3),Ro=new ko("WARNING",900),Oo=new ko("CONFIG",700),Po=new ko("FINE",500);Ao.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new No(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var xo,Mo={},Lo=null;function Fo(t){var e;if(Lo||(Lo=new Ao(""),(Mo[""]=Lo).c=Oo),!(e=Mo[t])){e=new Ao(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Fo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Mo[t]=e}return e}function Uo(t,e){t&&t.log(Po,e,void 0)}function qo(t){this.f=t}function Vo(t){nn.call(this),this.u=t,this.readyState=Bo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Fo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(qo,wo),qo.prototype.a=function(){return new Vo(this.f)},qo.prototype.b=(xo={},function(){return xo}),S(Vo,nn);var Bo=0;function jo(t){t.c.read().then(t.bc.bind(t)).catch(t.Ma.bind(t))}function Wo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Ko(t)}function Ko(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Qo(t){nn.call(this),this.headers=new ln,this.D=t||null,this.c=!1,this.A=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Ho,this.v=this.O=!1}(t=Vo.prototype).open=function(t,e){if(this.readyState!=Bo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Ko(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.gc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Wo(this,!1)),this.readyState=Bo},t.gc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Ko(this)),this.a&&(this.readyState=3,Ko(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.ec.bind(this),this.Ma.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,jo(this)):t.text().then(this.fc.bind(this),this.Ma.bind(this)))))},t.bc=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Wo(this,!0):Ko(this),3==this.readyState&&jo(this)}},t.fc=function(t){this.a&&(this.response=this.responseText=t,Wo(this,!0))},t.ec=function(t){this.a&&(this.response=t,Wo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(Ro,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Wo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Ro,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Ro,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Qo,nn);var Ho="";Qo.prototype.b=Fo("goog.net.XhrIo");var Go=/^https?$/i,zo=["POST","PUT"];function Yo(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.N=n,e.G=!1,e.c=!0,e.a=e.D?e.D.a():yo.a(),e.A=e.D?_o(e.D):_o(yo),e.a.onreadystatechange=_(e.Jb,e);try{Uo(e.b,ia(e,"Opening Xhr")),e.I=!0,e.a.open(n,String(t),!0),e.I=!1}catch(t){return Uo(e.b,ia(e,"Error opening Xhr: "+t.message)),void Jo(e,t)}t=r||"";var o,a=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||h(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){a.set(e,t)}),i=function(t){t:{for(var e=Xo,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(a.U()),r=l.FormData&&t instanceof l.FormData,!q(zo,n)||i||r||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.o&&(e.a.responseType=e.o),"withCredentials"in e.a&&e.a.withCredentials!==e.O&&(e.a.withCredentials=e.O);try{ea(e),0<e.g&&(e.v=(o=e.a,me&&Ne(9)&&"number"==typeof o.timeout&&void 0!==o.ontimeout),Uo(e.b,ia(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ga,e)):e.u=sn(e.Ga,e.g,e)),Uo(e.b,ia(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Uo(e.b,ia(e,"Send error: "+t.message)),Jo(e,t)}}function Xo(t){return"content-type"==t.toLowerCase()}function Jo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,$o(t),ta(t)}function $o(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Zo(e){if(e.c&&void 0!==u)if(e.A[1]&&4==na(e)&&2==ra(e))Uo(e.b,ia(e,"Local request error detected and ignored"));else if(e.i&&4==na(e))sn(e.Jb,0,e);else if(e.dispatchEvent("readystatechange"),4==na(e)){Uo(e.b,ia(e,"Request complete")),e.c=!1;try{var t,n=ra(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!Go.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<na(e)?e.a.statusText:""}catch(t){Uo(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+ra(e)+"]",$o(e)}}finally{ta(e)}}}function ta(e,t){if(e.a){ea(e);var n=e.a,r=e.A[0]?s:null;e.a=null,e.A=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Do,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ea(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(l.clearTimeout(t.u),t.u=null)}function na(t){return t.a?t.a.readyState:0}function ra(t){try{return 2<na(t)?t.a.status:-1}catch(t){return-1}}function ia(t,e){return e+" ["+t.N+" "+t.l+" "+ra(t)+"]"}function oa(t){var e=ma;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.A=this.i=!1,this.h=0,this.b=null,this.m=0}function aa(t,e,n){t.a=!0,t.c=n,t.f=!e,ha(t)}function sa(t){if(t.a){if(!t.l)throw new la(t);t.l=!1}}function ua(t,e,n,r){t.g.push([e,n,r]),t.a&&ha(t)}function ca(t){return U(t.g,function(t){return m(t[1])})}function ha(e){if(e.h&&e.a&&ca(e)){var n=e.h,r=da[n];r&&(l.clearTimeout(r.a),delete da[n]),e.h=0}e.b&&(e.b.m--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.u,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ca(e)||(r=!0)}}e.c=n,t&&(s=_(e.o,e,!0),t=_(e.o,e,!1),n instanceof oa?(ua(n,s,t),n.A=!0):n.then(s,t)),r&&(n=new pa(n),da[n.a]=n,e.h=n.a)}function la(){C.call(this)}function fa(){C.call(this)}function pa(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Qo.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Uo(this.b,ia(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Uo(this.b,ia(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ta(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ta(this,!0)),Qo.qb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?Zo(this):this.vc())},t.vc=function(){Zo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Ho:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Do,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Uo(this.b,"Can not get response: "+t.message),null}},oa.prototype.cancel=function(t){if(this.a)this.c instanceof oa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new fa(this),sa(this),aa(this,!1,t))}},oa.prototype.o=function(t,e){this.i=!1,aa(this,t,e)},oa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ua(this,r,function(t){t instanceof fa?o.cancel():i(t)}),o.then(t,e,n)},oa.prototype.$goog_Thenable=!0,S(la,C),la.prototype.message="Deferred has already fired",la.prototype.name="AlreadyCalledError",S(fa,C),fa.prototype.message="Deferred was canceled",fa.prototype.name="CanceledError",pa.prototype.c=function(){throw delete da[this.a],this.b};var da={};function ya(t){var e,n,r,i,o,a=document,s=et(t).toString(),u=document.createElement("SCRIPT"),c={Lb:u,Ga:void 0},h=new oa(c);return e=window.setTimeout(function(){ga(u,!0);var t=new wa(ba,"Timeout reached for loading script "+s);sa(h),aa(h,!1,t)},5e3),c.Ga=e,u.onload=u.onreadystatechange=function(){u.readyState&&"loaded"!=u.readyState&&"complete"!=u.readyState||(ga(u,!1,e),sa(h),aa(h,!0,null))},u.onerror=function(){ga(u,!0,e);var t=new wa(va,"Error while loading script "+s);sa(h),aa(h,!1,t)},z(c={},{type:"text/javascript",charset:"UTF-8"}),Bn(u,c),r=t,x(n=u,"HTMLScriptElement"),n.src=et(r),null===p&&(p=(r=(r=l.document).querySelector&&r.querySelector("script[nonce]"))&&(r=r.nonce||r.getAttribute("nonce"))&&f.test(r)?r:""),(r=p)&&n.setAttribute("nonce",r),(i=a,(o=(i||document).getElementsByTagName("HEAD"))&&0!=o.length?o[0]:i.documentElement).appendChild(u),h}function ma(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&ga(t,!0,this.Ga)}}function ga(t,e,n){null!=n&&l.clearTimeout(n),t.onload=s,t.onerror=s,t.onreadystatechange=s,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var va=0,ba=1;function wa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function _a(t){this.f=t}function Ea(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ia,this.f=H(t.secureTokenHeaders||Ca),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Na,this.a=H(t.firebaseHeaders||Aa),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&Jh.INTERNAL.node&&Jh.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,sr()?this.c=new qo(self):cr()?this.c=new _a(n):this.c=new So}S(wa,C),S(_a,wo),_a.prototype.a=function(){return new this.f},_a.prototype.b=function(){return{}};var Ta,Sa="idToken",Ia=new Ar(3e4,6e4),Ca={"Content-Type":"application/x-www-form-urlencoded"},Na=new Ar(3e4,6e4),Aa={"Content-Type":"application/json"};function ka(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Da(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Ra(t,e,n,r,i,o,a){var s;(t=!((s=fr(s=yr())!=lr?null:(s=s.match(/\sChrome\/(\d+)/i))&&2==s.length?parseInt(s[1],10):null)&&s<30||me&&Ie&&!(9<Ie))||sr()?_(t.o,t):(Ta||(Ta=new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Pa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=nt(Oa,{onload:Pa});ua(ya(n),null,function(){e(Error("CORS_UNSUPPORTED"))},void 0)}}(t,e)})),_(t.l,t)))(e,n,r,i,o,a)}Ea.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Qo(this.c);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Uo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),Yo(a,t,e,r,i)};var Oa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Pa="__fcb"+Math.floor(1e6*Math.random()).toString();function xa(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Ma(t){"email"in t&&xa(t)}function La(t){if(!t[Sa])throw new Yr("internal-error")}function Fa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Ea.prototype.l=function(t,n,r,i,o){var a=this;Ta.then(function(){window.gapi.client.setApiKey(a.b);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Ea.prototype.ob=function(){return bs(this,hs,{})},Ea.prototype.rb=function(t,e){return bs(this,us,{idToken:t,email:e})},Ea.prototype.sb=function(t,e){return bs(this,cs,{idToken:t,password:e})};var Ua={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function qa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function Va(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Mn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ba(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=bo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=bo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=bo(t)):t.errorMessage&&(e=ws(t.errorMessage)),e)throw e;if(!t[Sa])throw new Yr("internal-error")}function ja(t,e){return e.returnIdpCredential=!0,bs(t,ls,e)}function Wa(t,e){return e.returnIdpCredential=!0,bs(t,ps,e)}function Ka(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,bs(t,fs,e)}function Qa(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Ea.prototype).tb=function(t,r){var i={idToken:t},o=[];return K(Ua,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),bs(this,us,i)},t.lb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),bs(this,rs,t)},t.mb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),bs(this,es,t)},t.kb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),bs(this,ns,t)},t.Va=function(t){return bs(this,ms,t)},t.$a=function(t,e){return bs(this,as,{oobCode:t,newPassword:e})},t.Ka=function(t){return bs(this,Ga,{oobCode:t})},t.Xa=function(t){return bs(this,Ha,{oobCode:t})};var Ha={endpoint:"setAccountInfo",C:Qa,da:"email"},Ga={endpoint:"resetPassword",C:Qa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")}},za={endpoint:"signupNewUser",C:function(t){if(xa(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},Ya={endpoint:"createAuthUri"},Xa={endpoint:"deleteAccount",T:["idToken"]},Ja={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],C:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},$a={endpoint:"emailLinkSignin",T:["email","oobCode"],C:xa,J:La,R:!0},Za={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],C:xa,J:La,R:!0},ts={endpoint:"getAccountInfo"},es={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},ns={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],C:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},da:"email"},rs={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},is={wb:!0,endpoint:"getProjectConfig",Ib:"GET"},os={wb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},as={endpoint:"resetPassword",C:Qa,da:"email"},ss={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},us={endpoint:"setAccountInfo",T:["idToken"],C:Ma,R:!0},cs={endpoint:"setAccountInfo",T:["idToken"],C:function(t){if(Ma(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},hs={endpoint:"signupNewUser",J:La,R:!0},ls={endpoint:"verifyAssertion",C:qa,Qa:Va,J:Ba,R:!0},fs={endpoint:"verifyAssertion",C:qa,Qa:Va,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw ws(t.errorMessage);if(!t[Sa])throw new Yr("internal-error")},R:!0},ps={endpoint:"verifyAssertion",C:function(t){if(qa(t),!t.idToken)throw new Yr("internal-error")},Qa:Va,J:Ba,R:!0},ds={endpoint:"verifyCustomToken",C:function(t){if(!t.token)throw new Yr("invalid-custom-token")},J:La,R:!0},ys={endpoint:"verifyPassword",C:function(t){if(xa(t),!t.password)throw new Yr("wrong-password")},J:La,R:!0},ms={endpoint:"verifyPhoneNumber",C:Fa,J:La},gs={endpoint:"verifyPhoneNumber",C:function(t){if(!t.idToken)throw new Yr("internal-error");Fa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",bo(t);La(t)}},vs={Vb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",C:Fa,J:La};function bs(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Xt(new Yr("internal-error"));var r,i=e.Ib||"POST";return Yt(n).then(e.C).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,r,i,o,n){var a=_n(t.g+e);bn(a,"key",t.b),n&&bn(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Ra(t,a.toString(),function(t){t?t.error?n(_s(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Tr(i)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Vb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new Yr("internal-error");return r[e.da]})}function ws(t){return _s({error:{errors:[{message:t}],code:400,message:t}})}function _s(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Er(t)),new Yr("internal-error",e)}function Es(t){var o;this.b=t,this.a=null,this.gb=(o=this,(Cs||(Cs=new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Ss.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(ya(r=nt(Ts,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Cs=null,t}))).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Is.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})}))}var Ts=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Ss=new Ar(3e4,6e4),Is=new Ar(5e3,15e3),Cs=null;function Ns(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function As(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ks(t){try{return Jh.app(t).auth().ya()}catch(t){return[]}}function Ds(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function Rs(t){var e,s=Jn();return(e=t,bs(e,is,{}).then(function(t){return t.authorizedDomains||[]})).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new go(Jn())})}function Os(i){return i.m||(i.m=ir().then(function(){if(!i.u){var t=i.c,e=i.h,n=ks(i.b),r=new Ns(i.l,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.u=r.toString()}i.i=new Es(i.u),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");t=r.i,e=function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=fo(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)},t.gb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))});var t,e}(i)})),i.m}function Ps(t){return t.o||(t.v=t.c?dr(t.c,ks(t.b)):null,t.o=new Ea(t.f,vi(t.h),t.v)),t.o}function xs(t,e,n,r,i,o,a,s,u,c){return(t=new As(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=H(u||null),t.f=c,t.toString()}function Ms(t){if(this.a=t||Jh.INTERNAL.reactNative&&Jh.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ls(t){this.b=t,this.a={},this.c=_(this.f,this)}Ns.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):xn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):xn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):xn(this.a.a,"fw"),this.a.toString()},As.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.l),bn(t,"appName",this.c),bn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=Jh.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.ab=n,bn(t,"providerId",this.a.providerId),n=Tr((e=this.a).zb))n[r]=n[r].toString();r=e.Cc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),Q(n)||bn(t,"customParameters",Er(n))}if("function"==typeof this.a.Fb&&((e=this.a.Fb()).length&&bn(t,"scopes",e.join(","))),this.i?bn(t,"redirectUrl",this.i):xn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):xn(t.a,"eventId"),this.h?bn(t,"v",this.h):xn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.f?bn(t,"eid",this.f):xn(t.a,"eid"),(a=ks(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Ds.prototype).Ea=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){var t,r;(t=o,r={type:"webStorageSupport"},Os(t).then(function(){return e=t.i,n=r,e.gb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})});var e,n}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return n=e,new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()});var n}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Mb=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Hb=function(){return!1},t.Db=function(e,t,n,r,i,o,a){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ga().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Rs(Ps(this)));var s=this;return this.a.then(function(){var t=s.ga().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){(ho(n),a)||$n(xs(s.l,s.f,s.b,t,n,null,o,s.c,void 0,s.h),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=Rs(Ps(this)));var r=this;return this.a.then(function(){ho(e),$n(xs(r.l,r.f,r.b,t,e,Jn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return Os(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Ob=function(){return!0},t.wa=function(t){this.g.push(t)},t.La=function(e){B(this.g,function(t){return t==e})},(t=Ms.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Er(e)))},t.P=function(t){return Yt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Fs,Us=[];function qs(t){this.a=t}function Vs(t){this.c=t,this.b=!1,this.a=[]}function Bs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return js(r,c),t}).s(function(t){throw js(r,c),t})}function js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function Ws(){if(!Hs())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=l.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var t,r=this;sr()&&self?(this.m=function(){var e=sr()?self:null;if(L(Us,function(t){t.b==e&&(n=t)}),!n){var n=new Ls(e);Us.push(n)}return n}(),this.m.subscribe("keyChanged",function(t,n){return Js(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:q(e,n.key)}})}),this.m.subscribe("ping",function(){return Yt(["keyChanged"])})):(t=l.navigator,t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)).then(function(t){(r.h=t)&&(r.g=new Vs(new qs(t)),Bs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&q(t[0].value,"keyChanged")&&(r.u=!0)}).s(function(){}))})}function Ks(i){return new jt(function(e,n){var t=i.l.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){var r;(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):(r=i,new jt(function(t,e){var n=r.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})).then(function(){return Ks(i)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Qs(t){return t.o||(t.o=Ks(t)),t.o}function Hs(){try{return!!l.indexedDB}catch(t){return!1}}function Gs(t){return t.objectStore("firebaseLocalStorage")}function zs(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ys(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Xs(t,e){return t.g&&t.h&&((n=l.navigator)&&n.serviceWorker&&n.serviceWorker.controller||null)===t.h?Bs(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Yt();var n}function Js(r){return Qs(r).then(function(t){var i=Gs(zs(t,!1));return i.getAll?Ys(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function $s(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Zs(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(Hs()){var e=Ir(),n="__sak"+e;return Fs||(Fs=new Ws),(i=Fs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.P(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.Y(function(e){L(r.a,function(t){t(e)})}),t})}function tu(){this.a={},this.type="inMemory"}function eu(){if(!function(){var t="Node"==ur();if(!(t=nu()||t&&Jh.INTERNAL.node&&Jh.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=nu()||Jh.INTERNAL.node.localStorage,this.type="localStorage"}function nu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function ru(){this.type="nullStorage"}function iu(){if(!function(){var t="Node"==ur();if(!(t=ou()||t&&Jh.INTERNAL.node&&Jh.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=ou()||Jh.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function ou(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function au(){var t={};t.Browser=cu,t.Node=hu,t.ReactNative=lu,t.Worker=fu,this.a=t[ur()]}Ls.prototype.f=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},Ls.prototype.subscribe=function(t,e){Q(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},Ls.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(B(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],Q(this.a)&&this.b.removeEventListener("message",this.c)},qs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Vs.prototype.close=function(){for(;0<this.a.length;)js(this,this.a[0]);this.b=!0},(t=Ws.prototype).set=function(n,r){var i,o=!1,a=this;return Qs(this).then(function(t){return Ys((t=Gs(zs(i=t,!0))).get(n))}).then(function(t){var e=Gs(zs(i,!0));return t?(t.value=r,Ys(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,Ys(e.add(t)))}).then(function(){return a.c[n]=r,Xs(a,n)}).ia(function(){o&&a.b--})},t.get=function(e){return Qs(this).then(function(t){return Ys(Gs(zs(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.P=function(e){var n=!1,r=this;return Qs(this).then(function(t){return n=!0,r.b++,Ys(Gs(zs(t,!0)).delete(e))}).then(function(){return delete r.c[e],Xs(r,e)}).ia(function(){n&&r.b--})},t.Y=function(t){var n;0==this.a.length&&($s(n=this),function e(){n.f=setTimeout(function(){n.i=Js(n).then(function(e){0<e.length&&L(n.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()),this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&$s(this)},(t=Zs.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.P=function(e){return this.b.then(function(t){return t.P(e)})},t.Y=function(t){this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e})},(t=tu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.P=function(t){return delete this.a[t],Yt()},t.Y=function(){},t.ca=function(){},(t=eu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(t){l.window&&Ke(l.window,"storage",t)},t.ca=function(t){l.window&&Ge(l.window,"storage",t)},(t=ru.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.P=function(){return Yt()},t.Y=function(){},t.ca=function(){},(t=iu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var su,uu,cu={B:eu,Sa:iu},hu={B:eu,Sa:iu},lu={B:Ms,Sa:ru},fu={B:eu,Sa:ru},pu={Xc:"local",NONE:"none",Zc:"session"};function du(){var t=!(Cr(yr())||!ar()),e=_r(),n=gr();this.o=t,this.h=e,this.m=n,this.a={},su||(su=new au),t=su;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.B:new Zs(sr()?new tu:new t.a.B)}catch(t){this.g=new tu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new tu}this.l=new tu,this.f=_(this.Nb,this),this.b={}}function yu(){return uu||(uu=new du),uu}function mu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function gu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function vu(t,e,n){return n=gu(e,n),"local"==e.B&&(t.b[n]=null),mu(t,e.B).P(n)}function bu(t){t.c&&(clearInterval(t.c),t.c=null)}function wu(t){this.a=t,this.b=yu()}(t=du.prototype).get=function(t,e){return mu(this,t.B).get(gu(t,e))},t.set=function(e,t,n){var r=gu(e,n),i=this,o=mu(this,e.B);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.B&&(i.b[r]=t)})},t.addListener=function(t,e,n){var r;t=gu(t,e),this.m&&(this.b[t]=l.localStorage.getItem(t)),Q(this.a)&&(mu(this,"local").Y(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.m||(bu(r=this),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Nb(e))}},1e3))),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=gu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(mu(this,"local").ca(this.f),bu(this))},t.Nb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Ya(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?mu(this,"local").ca(this.f):bu(this),this.o)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Ya(e))},me&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.Ya,this))},t.Ya=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var _u,Eu={name:"authEvent",B:"local"};function Tu(){this.a=yu()}function Su(t,e){this.b=Iu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=l.Int32Array?new Int32Array(64):Array(64),void 0!==_u||(_u=l.Int32Array?new Int32Array(Ou):Ou),this.reset()}S(Su,function(){this.b=-1});for(var Iu=64,Cu=Iu-1,Nu=[],Au=0;Au<Cu;Au++)Nu[Au]=0;var ku=j(128,Nu);function Du(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|_u[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Ru(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Du(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Du(t),i=0)}}t.c=i,t.g+=n}Su.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Ou=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Pu(){Su.call(this,8,xu)}S(Pu,Su);var xu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Mu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new Tu,this.g=new wu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Lu(t){return new Yr("invalid-cordova-configuration",t)}function Fu(t){var e=new Pu;Ru(e,t),t=[];var n=8*e.g;e.c<56?Ru(e,ku,56-e.c):Ru(e,ku,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Du(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}function Uu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function qu(r){return r.f||(r.f=r.ga().then(function(){return new jt(function(n){r.wa(function t(e){return n(e),r.La(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Vu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Pi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new lo(t.c,t.b,null,null,n):new lo(t.c,t.b,e,t.f)),e=n||o}Uu(i,e)})}var o=new lo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Vu(i).then(function(){t||Uu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},mo||(mo=new po),mo.subscribe(e)}(r)})})),r.f}function Vu(e){var t,n=null;return(t=e.g,t.b.get(Eu,t.a).then(function(t){return fo(t)})).then(function(t){return n=t,vu((t=e.g).b,Eu,t.a)}).then(function(){return n})}function Bu(t){this.a=t,this.b=yu()}(t=Mu.prototype).ga=function(){return this.za?this.za:this.za=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",l))throw Lu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",l))throw Lu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",l))throw Lu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",l))throw Lu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Ea=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Ob=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,n){if(this.c)return Xt(new Yr("redirect-operation-pending"));var r=this,i=l.document,o=null,a=null,s=null,u=null;return this.c=Yt().then(function(){return ho(e),qu(r)}).then(function(){return function(n,t,e,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new lo(t,r,null,i,new Yr("no-auth-event")),a=mr("BuildInfo.packageName",l);if("string"!=typeof a)throw new Yr("invalid-cordova-configuration");var s=mr("BuildInfo.displayName",l),u={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))u.ibi=a;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));u.apn=a}s&&(u.appDisplayName=s),i=Fu(i),u.sessionId=i;var c=xs(n.l,n.i,n.m,t,e,null,r,n.o,u,n.u);return n.ga().then(function(){var t=n.h;return n.v.a.set(Eu,o.w(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(c)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(c,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new jt(function(e,t){a=function(){var t=mr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(a),s=function(){o||(o=un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))}))},u=function(){kr()&&s()},i.addEventListener("resume",s,!1),yr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",u,!1)}).s(function(t){return Vu(r).then(function(){throw t})})}).ia(function(){s&&i.removeEventListener("resume",s,!1),u&&i.removeEventListener("visibilitychange",u,!1),o&&o.cancel(),a&&r.La(a),r.c=null})},t.wa=function(e){this.b.push(e),qu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new lo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.La=function(e){B(this.b,function(t){return t==e})};var ju={name:"pendingRedirect",B:"session"};function Wu(t){return vu(t.b,ju,t.a)}function Ku(t,e,n){this.i={},this.u=0,this.A=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=_(this.cb,this),this.b=new tc,this.v=new ic,this.g=new Bu(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.v,this.c.linkViaPopup=this.v,this.c.reauthViaPopup=this.v,this.a=Qu(this.A,this.l,this.o,mi)}function Qu(t,e,n,r){var i=Jh.SDK_VERSION||null;return or()?new Mu(t,e,n,i,r):new Ds(t,e,n,i,r)}function Hu(e){e.f||(e.f=!0,e.a.wa(e.m));var n=e.a;return e.a.ga().s(function(t){throw e.a==n&&e.reset(),t})}function Gu(n){n.a.Mb()&&Hu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));Ju(t)&&n.cb(e)}),n.a.Hb()||ec(n.b)}(t=Ku.prototype).reset=function(){this.f=!1,this.a.La(this.m),this.a=Qu(this.A,this.l,this.o),this.i={}},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(q(this.h,t)||this.h.push(t),!this.f){var n=this;(e=this.g,e.b.get(ju,e.a).then(function(t){return"pending"==t})).then(function(t){t?Wu(n.g).then(function(){Hu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));Ju(t)&&n.cb(e)})}):Gu(n)}).s(function(){Gu(n)})}var e},t.unsubscribe=function(e){B(this.h,function(t){return t==e})},t.cb=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=T()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=T())),e=!0;break}}return ec(this.b),e};var zu=new Ar(2e3,1e4),Yu=new Ar(3e4,6e4);function Xu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function Ju(t){return!(!t||"auth/cordova-not-ready"!=t.code)}Ku.prototype.fa=function(){return this.b.fa()},Ku.prototype.Ca=function(t,e,n){var r,i,o=this;return(i=this.g,i.b.set(ju,"pending",i.a)).then(function(){return o.a.Ca(t,e,n).s(function(t){if(Ju(t))throw new Yr("operation-not-supported-in-this-environment");return r=t,Wu(o.g).then(function(){throw r})}).then(function(){return o.a.Ob()?new jt(function(){}):Wu(o.g).then(function(){return o.fa()}).then(function(){}).s(function(){})})})},Ku.prototype.Ea=function(e,n,t,r){return this.a.Ea(t,function(t){e.ha(n,null,t,r)},zu.get())};var $u={};function Zu(t,e,n){var r=e+":"+n;return $u[r]||($u[r]=new Ku(t,e,n)),$u[r]}function tc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function ec(t){t.g||(t.g=!0,rc(t,!1,null,null))}function nc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function rc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):nc(t,n):nc(t,{user:null}),t.f=[],t.c=[]}function ic(){}function oc(){this.ub=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.ub},set:function(t){this.ub=t},enumerable:!1})}function ac(t,e){this.a=e,Lr(this,"verificationId",t)}function sc(t,e,n,r){return new so(t).Va(e,n).then(function(t){return new ac(t,r)})}function uc(t){var e=yi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function cc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function hc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function lc(t){this.f=t,this.b=this.a=null,this.c=0}function fc(t,e){var n=e[Sa],r=e.refreshToken;e=pc(e.expiresIn),t.b=n,t.c=e,t.a=r}function pc(t){return T()+1e3*parseInt(t,10)}function dc(e,t){return(r=e.f,i=t,new jt(function(e,n){"refresh_token"==i.grant_type&&i.refresh_token||"authorization_code"==i.grant_type&&i.code?Ra(r,r.i+"?key="+encodeURIComponent(r.b),function(t){t?t.error?n(_s(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(i).toString(),r.f,r.m.get()):n(new Yr("internal-error"))})).then(function(t){return e.b=t.access_token,e.c=pc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t});var r,i}function yc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function mc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function gc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function vc(t,e,n){var r;this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=Jh.SDK_VERSION?dr(Jh.SDK_VERSION):null,this.c=new Ea(this.l,vi(mi),t),this.h=new lc(this.c),Ic(this,e[Sa]),fc(this.h,e),Lr(this,"refreshToken",this.h.a),Ac(this,n||{}),nn.call(this),this.I=!1,this.u&&vr()&&(this.a=Zu(this.u,this.l,this.o)),this.N=[],this.i=null,this.A=(r=this,new cc(function(){return r.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=r.h.c-T()-3e5;return 0<t?t:0})),this.V=_(this.Ha,this);var i=this;this.ka=null,this.ta=function(t){i.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){wc(i,t.c)},this.W=null}function bc(t,e){t.X&&Ge(t.X,"languageCodeChanged",t.ta),(t.X=e)&&Ke(e,"languageCodeChanged",t.ta)}function wc(t,e){t.O=e,Da(t.c,Jh.SDK_VERSION?dr(Jh.SDK_VERSION,t.O):null)}function _c(t,e){t.W&&Ge(t.W,"frameworkChanged",t.sa),(t.W=e)&&Ke(e,"frameworkChanged",t.sa)}function Ec(e){try{return Jh.app(e.o).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.o+"'!")}}function Tc(t){t.D||t.A.b||(t.A.start(),Ge(t,"tokenChanged",t.V),Ke(t,"tokenChanged",t.V))}function Sc(t){Ge(t,"tokenChanged",t.V),t.A.stop()}function Ic(t,e){t.ra=e,Lr(t,"_lat",e)}function Cc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return $t(e).then(function(){return t})}function Nc(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function Ac(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new yc(e.createdAt,e.lastLoginAt),providerData:[]})}function kc(){}function Dc(t){return Yt().then(function(){if(t.D)throw new Yr("app-deleted")})}function Rc(t){return F(t.providerData,function(t){return t.providerId})}function Oc(t,e){e&&(Pc(t,e.providerId),t.providerData.push(e))}function Pc(t,e){B(t.providerData,function(t){return t.providerId==e})}function xc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Mc(e,t){var n,r,i;e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,providerData:[]}),t.metadata?Lr(e,"metadata",new yc((i=t.metadata).a,i.b)):Lr(e,"metadata",new yc),L(t.providerData,function(t){Oc(e,t)}),n=e.h,r=t.h,n.b=r.b,n.a=r.a,n.c=r.c,Lr(e,"refreshToken",e.h.a))}function Lc(i){return i.F().then(function(t){var e,n,r=i.isAnonymous;return(e=i,n=t,bs(e.c,ts,{idToken:n}).then(_(e.wc,e))).then(function(){return r||xc(i,"isAnonymous",!1),t})})}function Fc(t,e){e[Sa]&&t.ra!=e[Sa]&&(fc(t.h,e),t.dispatchEvent(new gc("tokenChanged")),Ic(t,e[Sa]),xc(t,"refreshToken",t.h.a))}function Uc(t,e){return Lc(t).then(function(){if(q(Rc(t),e))return Cc(t).then(function(){throw new Yr("provider-already-linked")})})}function qc(t,e,n){return Ur({user:t,credential:co(e),additionalUserInfo:e=Ti(e),operationType:n})}function Vc(t,e){return Fc(t,e),t.reload().then(function(){return t})}function Bc(n,r,t,e,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.i&&!i)return Xt(n.i);var o=Ei(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.u&&t.isOAuthProvider&&(s=xs(n.u,n.l,n.o,r,t,null,a,Jh.SDK_VERSION||null));var u=er(s,o&&o.Ba,o&&o.Aa);return e=e().then(function(){if(Wc(n),!i)return n.F().then(function(){})}).then(function(){return Xu(n.a,u,r,t,a,!!s)}).then(function(){return new jt(function(t,e){n.ha(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.b=n.a.Ea(n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),Kc(n,e,i)}function jc(e,t,n,r,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.i&&!i)return Xt(e.i);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(Wc(e),!i)return e.F().then(function(){})}).then(function(){return e.aa=a,Cc(e)}).then(function(t){return e.ba&&(t=(t=e.ba).b.set(Gc,e.w(),t.a)),t}).then(function(){return e.a.Ca(t,n,a)}).s(function(t){if(o=t,e.ba)return zc(e.ba);throw o}).then(function(){if(o)throw o}),Kc(e,r,i)}function Wc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function Kc(t,e,n){var r,i,o,a=(i=e,o=n,(r=t).i&&!o?(i.cancel(),Xt(r.i)):i.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(r.i||r.dispatchEvent(new gc("userInvalidated")),r.i=t),t}));return t.G.push(a),a.ia(function(){V(t.G,a)}),a}function Qc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Sa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new vc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Oc(r,Ur(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Hc(t){this.a=t,this.b=yu()}tc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},tc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(rc(this,!0,null,t.a),Yt()):e.xa(n,r)?function(e,t,n){n=n.xa(t.c,t.b);var r=t.g,i=t.f,o=t.h,a=!!t.c.match(/Redirect$/);n(r,i,o).then(function(t){rc(e,a,t,null)}).s(function(t){rc(e,a,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(rc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},tc.prototype.Za=function(){this.g&&!this.i&&rc(this,!1,null,null)},tc.prototype.fa=function(){var i=this;return new jt(function(t,e){var n,r;i.b?i.b().then(t,e):(i.f.push(t),i.c.push(e),n=i,r=new Yr("timeout"),n.a&&n.a.cancel(),n.a=un(Yu.get()).then(function(){n.b||(n.g=!0,rc(n,!0,null,r))}))})},ic.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ha(t.c,null,t.a,t.b),Yt()):e.xa(n,r)?(o=e,a=(i=t).b,s=i.c,o.xa(s,a)(i.g,i.f,i.h).then(function(t){o.ha(s,t,null,a)}).s(function(t){o.ha(s,null,t,a)})):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"));var i,o,a,s},ac.prototype.confirm=function(t){return t=uo(this.verificationId,t),this.a(t)},cc.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(hc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},cc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},lc.prototype.w=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},lc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?dc(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},yc.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(gc,Oe),S(vc,nn),vc.prototype.pa=function(t){this.ka=t,ka(this.c,t)},vc.prototype.ea=function(){return this.ka},vc.prototype.ya=function(){return W(this.O)},vc.prototype.Ha=function(){this.A.b&&(this.A.stop(),this.A.start())},Lr(vc.prototype,"providerId","firebase"),(t=vc.prototype).reload=function(){var t=this;return Kc(this,Dc(this).then(function(){return Lc(t).then(function(){return Cc(t)}).then(kc)}))},t.ac=function(t){return this.F(t).then(function(t){return new uc(t)})},t.F=function(t){var e=this;return Kc(this,Dc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ra&&(Ic(e,t.accessToken),e.dispatchEvent(new gc("tokenChanged"))),xc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.wc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");Ac(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=(r=(r=t).providerUserInfo)&&r.length?F(r,function(t){return new mc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[],n=0;n<e.length;n++)Oc(this,e[n]);var r;xc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.xc=function(t){return xr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return Kc(this,t.f(this.c,this.uid).then(function(t){return Fc(e,t),n=qc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.oc=function(t){return xr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(e){var n=this,r=null;return Kc(this,Uc(this,e.providerId).then(function(){return n.F()}).then(function(t){return e.b(n.c,t)}).then(function(t){return r=qc(n,t,"link"),Vc(n,t)}).then(function(){return r}))},t.pc=function(t,e){var n=this;return Kc(this,Uc(this,"phone").then(function(){return sc(Ec(n),t,e,_(n.fb,n))}))},t.yc=function(t,e){var n=this;return Kc(this,Yt().then(function(){return sc(Ec(n),t,e,_(n.hb,n))}),!0)},t.rb=function(e){var n=this;return Kc(this,this.F().then(function(t){return n.c.rb(t,e)}).then(function(t){return Fc(n,t),n.reload()}))},t.Pc=function(e){var n=this;return Kc(this,this.F().then(function(t){return e.b(n.c,t)}).then(function(t){return Fc(n,t),n.reload()}))},t.sb=function(e){var n=this;return Kc(this,this.F().then(function(t){return n.c.sb(t,e)}).then(function(t){return Fc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Dc(this);var n=this;return Kc(this,this.F().then(function(t){return n.c.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Fc(n,t),xc(n,"displayName",t.displayName||null),xc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),Cc(n)}).then(kc))},t.Nc=function(i){var o=this;return Kc(this,Lc(this).then(function(t){return q(Rc(o),i)?(e=o.c,n=t,r=[i],bs(e,Ja,{idToken:n,deleteProvider:r})).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Rc(o),function(t){e[t]||Pc(o,t)}),e[so.PROVIDER_ID]||Lr(o,"phoneNumber",null),Cc(o)}):Cc(o).then(function(){throw new Yr("no-such-provider")});var e,n,r}))},t.delete=function(){var e=this;return Kc(this,this.F().then(function(t){return bs(e.c,Xa,{idToken:t})}).then(function(){e.dispatchEvent(new gc("userDeleted"))})).then(function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");bc(e,null),_c(e,null),e.G=[],e.D=!0,Sc(e),Lr(e,"refreshToken",null),e.a&&e.a.unsubscribe(e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?_(this.Cb,this):null},t.qc=function(t){var e=this;return Bc(this,"linkViaPopup",t,function(){return Uc(e,t.providerId).then(function(){return Cc(e)})},!1)},t.zc=function(t){return Bc(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.rc=function(t){var e=this;return jc(this,"linkViaRedirect",t,function(){return Uc(e,t.providerId)},!1)},t.Ac=function(t){return jc(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,r){var i=this;this.b&&(this.b.cancel(),this.b=null);var o=null;return Kc(this,this.F().then(function(t){return Wa(i.c,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=qc(i,t,"link"),Vc(i,t)}).then(function(){return o}))},t.Cb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Kc(this,Yt().then(function(){return Mi(Ka(r.c,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=qc(r,t,"reauthenticate"),Fc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(e){var n=this,r=null;return Kc(this,this.F().then(function(t){return r=t,void 0===e||Q(e)?{}:ci(new Zr(e))}).then(function(t){return n.c.kb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.w()},t.w=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.h.w(),redirectEventId:this.aa||null};return this.metadata&&z(e,this.metadata.w()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var Gc={name:"redirectUser",B:"session"};function zc(t){return vu(t.b,Gc,t.a)}function Yc(t){var e,n,r,i,o,a,s,u,c;this.a=t,this.b=yu(),this.c=null,this.f=(e=this,n=$c("local"),r=$c("session"),i=$c("none"),(o=e.b,a=n,s=e.a,u=gu(a,s),c=mu(o,a.B),o.get(a,s).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(u))}catch(t){}if(e&&!t)return l.localStorage.removeItem(u),o.set(a,e,s);e&&t&&"localStorage"!=c.type&&l.localStorage.removeItem(u)})).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(Jc,e.a).then(function(t){return t?$c(t):n})})})}).then(function(t){return e.c=t,Xc(e,t.B)}).s(function(){e.c||(e.c=n)})),this.b.addListener($c("local"),this.a,_(this.g,this))}function Xc(t,e){var n,s,r=[];for(n in pu)pu[n]!==e&&r.push(vu(t.b,$c(pu[n]),t.a));return r.push(vu(t.b,Jc,t.a)),s=r,new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],E(t,a),o);else n(i)})}Yc.prototype.g=function(){var e=this,n=$c("local");nh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.B?e.b.get(n,e.a):null}).then(function(t){if(t)return Xc(e,"local").then(function(){e.c=n})})})};var Jc={name:"persistence",B:"session"};function $c(t){return{name:"authUser",B:t}}function Zc(t,e){return nh(t,function(){return t.b.set(t.c,e.w(),t.a)})}function th(t){return nh(t,function(){return vu(t.b,t.c,t.a)})}function eh(t,e){return nh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Qc(t||{})})})}function nh(t,e){return t.f=t.f.then(e,e),t.f}function rh(t){if(this.l=!1,Lr(this,"settings",new oc),Lr(this,"app",t),!hh(this).options||!hh(this).options.apiKey)throw new Yr("invalid-api-key");var n,e,r,i,o,a,s,u,c,h,l,f;t=Jh.SDK_VERSION?dr(Jh.SDK_VERSION):null,this.c=new Ea(hh(this).options&&hh(this).options.apiKey,vi(mi),t),this.N=[],this.o=[],this.I=[],this.Rb=Jh.INTERNAL.createSubscribe(_(this.kc,this)),this.O=void 0,this.Sb=Jh.INTERNAL.createSubscribe(_(this.mc,this)),uh(this,null),this.h=new Yc(hh(this).options.apiKey+":"+hh(this).name),this.A=new Hc(hh(this).options.apiKey+":"+hh(this).name),this.V=dh(this,(e=hh(n=this).options.authDomain,r=(i=n,o=(a=i.A,s=hh(i).options.authDomain,a.b.get(Gc,a.a).then(function(t){return t&&s&&(t.authDomain=s),Qc(t||{})})).then(function(t){return(i.D=t)&&(t.ba=i.A),zc(i.A)}),dh(i,o)).then(function(){return eh(n.h,e)}).then(function(e){return e?(e.ba=n.A,n.D&&(n.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return Zc(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:th(n.h)})):null}).then(function(t){uh(n,t||null)}),dh(n,r))),this.i=dh(this,(u=this).V.then(function(){return u.fa()}).s(function(){}).then(function(){if(!u.l)return u.ka()}).s(function(){}).then(function(){if(!u.l){u.X=!0;var t=u.h;t.b.addListener($c("local"),t.a,u.ka)}})),this.X=!1,this.ka=_(this.Kc,this),this.Ha=_(this.Z,this),this.ra=_(this.Zb,this),this.sa=_(this.ic,this),this.ta=_(this.jc,this),h=hh(c=this).options.authDomain,l=hh(c).options.apiKey,h&&vr()&&(c.Qb=c.V.then(function(){if(!c.l){if(c.a=Zu(h,l,hh(c).name),c.a.subscribe(c),lh(c)&&Nc(lh(c)),c.D){Nc(c.D);var t=c.D;t.pa(c.ea()),bc(t,c),wc(t=c.D,c.G),_c(t,c),c.D=null}return c.a}})),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.sc,this),this.u=0,nn.call(this),f=this,Object.defineProperty(f,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),f.W=null,this.G=[]}function ih(t){Oe.call(this,"languageCodeChanged"),this.g=t}function oh(t){Oe.call(this,"frameworkChanged"),this.c=t}function ah(t){return t.Qb||Xt(new Yr("auth-domain-config-required"))}function sh(o,a){var s={};return s.apiKey=hh(o).options.apiKey,s.authDomain=hh(o).options.authDomain,s.appName=hh(o).name,o.V.then(function(){return t=s,e=a,n=o.A,r=o.ya(),i=new vc(t,e),n&&(i.ba=n),r&&wc(i,r),i.reload().then(function(){return i});var t,e,n,r,i}).then(function(t){return lh(o)&&t.uid==lh(o).uid?Mc(lh(o),t):(uh(o,t),Nc(t)),o.Z(t)}).then(function(){ph(o)})}function uh(t,e){var n,r;lh(t)&&(n=lh(t),r=t.Ha,B(n.N,function(t){return t==r}),Ge(lh(t),"tokenChanged",t.ra),Ge(lh(t),"userDeleted",t.sa),Ge(lh(t),"userInvalidated",t.ta),Sc(lh(t))),e&&(e.N.push(t.Ha),Ke(e,"tokenChanged",t.ra),Ke(e,"userDeleted",t.sa),Ke(e,"userInvalidated",t.ta),0<t.u&&Tc(e)),Lr(t,"currentUser",e),e&&(e.pa(t.ea()),bc(e,t),wc(e,t.G),_c(e,t))}function ch(e,t){var n=null,r=null;return dh(e,t.then(function(t){return n=co(t),r=Ti(t),sh(e,t)}).then(function(){return Ur({user:lh(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function hh(t){return t.app}function lh(t){return t.currentUser}function fh(t){return lh(t)&&lh(t)._lat||null}function ph(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](fh(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](fh(t))}}function dh(t,e){return t.N.push(e),e.ia(function(){V(t.N,e)}),e}function yh(){}function mh(){this.a={},this.b=1e12}Yc.prototype.nb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in pu)if(pu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gr()&&"none"!==t)throw n}}(e),nh(this,function(){return e!=r.c.B?r.b.get(r.c,r.a).then(function(t){return n=t,Xc(r,e)}).then(function(){if(r.c=$c(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(rh,nn),S(ih,Oe),S(oh,Oe),(t=rh.prototype).nb=function(t){return dh(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,ka(this.c,this.W),this.dispatchEvent(new ih(this.ea())))},t.ea=function(){return this.W},t.Qc=function(){var t=l.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.sc=function(t){this.G.push(t),Da(this.c,Jh.SDK_VERSION?dr(Jh.SDK_VERSION,this.G):null),this.dispatchEvent(new oh(this.G))},t.ya=function(){return W(this.G)},t.toJSON=function(){return{apiKey:hh(this).options.apiKey,authDomain:hh(this).options.authDomain,appName:hh(this).name,currentUser:lh(this)&&lh(this).w()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.Yb,this):null},t.Yb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=ja(r.c,t).then(function(t){return i=co(t),o=Ti(t),t});return dh(this,t=r.V.then(function(){return a}).then(function(t){return sh(r,t)}).then(function(){return Ur({user:lh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Ic=function(e){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ei(e.providerId),r=Ir(),i=null;(!_r()||ar())&&hh(this).options.authDomain&&e.isOAuthProvider&&(i=xs(hh(this).options.authDomain,hh(this).options.apiKey,hh(this).name,"signInViaPopup",e,null,r,Jh.SDK_VERSION||null));var o=er(i,t&&t.Ba,t&&t.Aa);return dh(this,t=ah(this).then(function(t){return Xu(t,o,"signInViaPopup",e,r,!!i)}).then(function(){return new jt(function(t,e){n.ha("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.b=n.a.Ea(n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Jc=function(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return dh(this,ah(this).then(function(){return nh(t=e.h,function(){return t.b.set(Jc,t.c.B,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var t=this;return dh(this,ah(this).then(function(){return t.a.fa()}).then(function(t){return t?Ur(t):null}))},t.Oc=function(t){if(!t)return Xt(new Yr("null-user"));var e=this,n={};n.apiKey=hh(this).options.apiKey,n.authDomain=hh(this).options.authDomain,n.appName=hh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.h,o={};return o[Sa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new vc(e,o),n&&(e.ba=n),r&&wc(e,r),Mc(e,t),e}(t,n,e.A,e.ya());return dh(this,this.i.then(function(){if(hh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return lh(e)&&t.uid==lh(e).uid?(Mc(lh(e),t),e.Z(t)):(uh(e,r),Nc(r),e.Z(r))}).then(function(){ph(e)}))},t.pb=function(){var t=this;return dh(this,this.i.then(function(){return lh(t)?(uh(t,null),th(t.h).then(function(){ph(t)})):Yt()}))},t.Kc=function(){var r=this;return eh(this.h,hh(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=lh(r)&&t){e=lh(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Mc(lh(r),t),lh(r).F();(lh(r)||t)&&(uh(r,t),t&&(Nc(t),t.ba=r.A),r.a&&r.a.subscribe(r),ph(r))}})},t.Z=function(t){return Zc(this.h,t)},t.Zb=function(){ph(this),this.Z(lh(this))},t.ic=function(){this.pb()},t.jc=function(){this.pb()},t.kc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(lh(e))})},t.mc=function(t){var e,n,r=this;n=function(){t.next(lh(r))},(e=this).I.push(n),dh(e,e.i.then(function(){!e.l&&q(e.I,n)&&e.O!==e.getUid()&&(e.O=e.getUid(),n(fh(e)))}))},t.uc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){m(t)?t(lh(r)):m(t.next)&&t.next(lh(r))}),this.Rb(t,e,n)},t.tc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),m(t)?t(lh(r)):m(t.next)&&t.next(lh(r))}),this.Sb(t,e,n)},t.$b=function(t){var e=this;return dh(this,this.i.then(function(){return lh(e)?lh(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Ec=function(t){var n=this;return this.i.then(function(){return ch(n,bs(n.c,ds,{token:t}))}).then(function(t){var e=t.user;return xc(e,"isAnonymous",!1),n.Z(e),t})},t.Fc=function(t,e){var n=this;return this.i.then(function(){return ch(n,bs(n.c,ys,{email:t,password:e}))})},t.Ub=function(t,e){var n=this;return this.i.then(function(){return ch(n,bs(n.c,za,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return ch(e,t.la(e.c))})},t.Dc=function(t){return xr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=lh(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):ch(n,n.c.ob()).then(function(t){var e=t.user;return xc(e,"isAnonymous",!0),n.Z(e),t})})},t.getUid=function(){return lh(this)&&lh(this).uid||null},t.Tb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&lh(this)&&Tc(lh(this))},t.Bc=function(e){var n=this;L(this.o,function(t){t==e&&n.u--}),this.u<0&&(this.u=0),0==this.u&&lh(this)&&Sc(lh(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),dh(this,this.i.then(function(){e.l||q(e.o,t)&&t(fh(e))}))},t.removeAuthTokenListener=function(e){B(this.o,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener($c("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),Promise.resolve()},t.Xb=function(t){return dh(this,bs(this.c,Ya,{identifier:t,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]}))},t.nc=function(t){return!!ro(t)},t.mb=function(e,n){var r=this;return dh(this,Yt().then(function(){var t=new Zr(n);if(!t.c)throw new Yr("argument-error",ni+" must be true when sending sign in link to email");return ci(t)}).then(function(t){return r.c.mb(e,t)}).then(function(){}))},t.Rc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return dh(this,this.c.$a(t,e).then(function(){}))},t.Ka=function(t){return dh(this,this.c.Ka(t).then(function(t){return new Vr(t)}))},t.Xa=function(t){return dh(this,this.c.Xa(t).then(function(){}))},t.lb=function(e,t){var n=this;return dh(this,Yt().then(function(){return void 0===t||Q(t)?{}:ci(new Zr(t))}).then(function(t){return n.c.lb(e,t)}).then(function(){}))},t.Hc=function(t,e){return dh(this,sc(this,t,e,_(this.Ra,this)))},t.Gc=function(e,n){var r=this;return dh(this,Yt().then(function(){var t=no(e,n||Jn());return r.Ra(t)}))},yh.prototype.render=function(){},yh.prototype.reset=function(){},yh.prototype.getResponse=function(){},yh.prototype.execute=function(){};var gh=null;function vh(t,e){return(e=bh(e))&&t.a[e]||null}function bh(t){return(t=void 0===t?1e12:t)?t.toString():null}function wh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function _h(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Eh(){}mh.prototype.render=function(t,e){return this.a[this.b.toString()]=new wh(t,e),this.b++},mh.prototype.reset=function(t){var e=vh(this,t);t=bh(t),e&&t&&(e.delete(),delete this.a[t])},mh.prototype.getResponse=function(t){return(t=vh(this,t))?t.getResponse():null},mh.prototype.execute=function(t){(t=vh(this,t))&&t.execute()},wh.prototype.getResponse=function(){return _h(this),this.b},wh.prototype.execute=function(){_h(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},wh.prototype.delete=function(){_h(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Eh.prototype.g=function(){return gh||(gh=new mh),Yt(gh)},Eh.prototype.c=function(){};var Th=null;function Sh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Ih=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Ch=new Ar(3e4,6e4);Sh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Ch.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(ya(nt(Ih,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},Sh.prototype.c=function(){this.b--};var Nh=null;function Ah(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,a=a?(Th||(Th=new Eh),Th):(Nh||(Nh=new Sh),Nh),this.o=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Rh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Oh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Ea(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.m=[];var u=this.a[kh];this.a[kh]=function(t){if(Ph(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Dh];this.a[Dh]=function(){if(Ph(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,l);"function"==typeof t&&t()}}}var kh="callback",Dh="expired-callback",Rh="sitekey",Oh="size";function Ph(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function xh(t,e){return t.h.push(e),e.ia(function(){V(t.h,e)}),e}function Mh(t){if(t.D)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Lh(t,e,n){var r=!1;try{this.b=n||Jh.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Jh.SDK_VERSION?dr(Jh.SDK_VERSION,o):null,Ah.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,vi(mi),r)}function Fh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Uh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Uh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Ah.prototype).za=function(){var e=this;return this.f?this.f:this.f=xh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.o.g(e.v())}).then(function(t){return e.g=t,bs(e.u,os,{})}).then(function(t){e.a[Rh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Mh(this);var n=this;return xh(this,this.za().then(function(){if(null===n.c){var t=n.l;if(!n.i){var e=Vn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Mh(this);var i=this;return xh(this,this.render().then(function(e){return new jt(function(n){var t=i.g.getResponse(e);if(t)n(t);else{var r=function(t){var e;t&&(e=r,B(i.m,function(t){return t==e}),n(t))};i.m.push(r),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Mh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Mh(this),this.D=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Lh,Ah);var Uh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function qh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:h}}function Vh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:n}}function Bh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:g}}function jh(t,e){return{name:t||"",K:"a function",optional:!!e,M:m}}function Wh(t,e){return{name:t||"",K:"null",optional:!!e,M:i}}function Kh(n){return{name:n?n+"Credential":"credential",K:n?"a valid "+n+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.la||!e)}}}function Qh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function Hh(e,n,t,r){return{name:t||"",K:e.K+" or "+n.K,optional:!!r,M:function(t){return e.M(t)||n.M(t)}}}function Gh(t,e){for(var n in e){var r=e[n].name;t[r]=Xh(r,t[n],e[n].j)}}function zh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){Fh(t,[n],[r],!0),this[e]=r},r,n,e[n].vb),enumerable:!0})}}function Yh(t,e,n,r){t[e]=Xh(e,n,r)}function Xh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Fh(a,n,t),e.apply(this,t)}if(!n)return e;var i,o,a=(o=(o=t).split("."))[o.length-1];for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}Gh(rh.prototype,{Xa:{name:"applyActionCode",j:[qh("code")]},Ka:{name:"checkActionCode",j:[qh("code")]},$a:{name:"confirmPasswordReset",j:[qh("code"),qh("newPassword")]},Ub:{name:"createUserWithEmailAndPassword",j:[qh("email"),qh("password")]},Xb:{name:"fetchSignInMethodsForEmail",j:[qh("email")]},fa:{name:"getRedirectResult",j:[]},nc:{name:"isSignInWithEmailLink",j:[qh("emailLink")]},tc:{name:"onAuthStateChanged",j:[Hh(Bh(),jh(),"nextOrObserver"),jh("opt_error",!0),jh("opt_completed",!0)]},uc:{name:"onIdTokenChanged",j:[Hh(Bh(),jh(),"nextOrObserver"),jh("opt_error",!0),jh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[qh("email"),Hh(Bh("opt_actionCodeSettings",!0),Wh(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[qh("email"),Bh("actionCodeSettings")]},nb:{name:"setPersistence",j:[qh("persistence")]},Dc:{name:"signInAndRetrieveDataWithCredential",j:[Kh()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[Kh()]},Ec:{name:"signInWithCustomToken",j:[qh("token")]},Fc:{name:"signInWithEmailAndPassword",j:[qh("email"),qh("password")]},Gc:{name:"signInWithEmailLink",j:[qh("email"),qh("emailLink",!0)]},Hc:{name:"signInWithPhoneNumber",j:[qh("phoneNumber"),Qh()]},Ic:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Jc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"updateCurrentUser",j:[Hh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof vc)}},Wh(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[qh(null,!0)]},Qc:{name:"useDeviceLanguage",j:[]},Rc:{name:"verifyPasswordResetCode",j:[qh("code")]}}),zh(rh.prototype,{lc:{name:"languageCode",vb:Hh(qh(),Wh(),"languageCode")}}),(rh.Persistence=pu).LOCAL="local",rh.Persistence.SESSION="session",rh.Persistence.NONE="none",Gh(vc.prototype,{delete:{name:"delete",j:[]},ac:{name:"getIdTokenResult",j:[Vh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Vh("opt_forceRefresh",!0)]},oc:{name:"linkAndRetrieveDataWithCredential",j:[Kh()]},fb:{name:"linkWithCredential",j:[Kh()]},pc:{name:"linkWithPhoneNumber",j:[qh("phoneNumber"),Qh()]},qc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},rc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},xc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Kh()]},hb:{name:"reauthenticateWithCredential",j:[Kh()]},yc:{name:"reauthenticateWithPhoneNumber",j:[qh("phoneNumber"),Qh()]},zc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[Hh(Bh("opt_actionCodeSettings",!0),Wh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[qh(null,!0)]},Nc:{name:"unlink",j:[qh("provider")]},rb:{name:"updateEmail",j:[qh("email")]},sb:{name:"updatePassword",j:[qh("password")]},Pc:{name:"updatePhoneNumber",j:[Kh("phone")]},tb:{name:"updateProfile",j:[Bh("profile")]}}),Gh(mh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Gh(yh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Gh(jt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),zh(oc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",vb:Vh("appVerificationDisabledForTesting")}}),Gh(ac.prototype,{confirm:{name:"confirm",j:[qh("verificationCode")]}}),Yh(xi,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Bi,to,oo,Ui],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Hh(qh(),Bh(),"json")]),Yh(eo,"credential",function(t,e){return new Zi(t,e)},[qh("email"),qh("password")]),Gh(Zi.prototype,{w:{name:"toJSON",j:[qh(null,!0)]}}),Gh(Qi.prototype,{ua:{name:"addScope",j:[qh("scope")]},Da:{name:"setCustomParameters",j:[Bh("customOAuthParameters")]}}),Yh(Qi,"credential",Hi,[Hh(qh(),Bh(),"token")]),Yh(eo,"credentialWithLink",no,[qh("email"),qh("emailLink")]),Gh(Gi.prototype,{ua:{name:"addScope",j:[qh("scope")]},Da:{name:"setCustomParameters",j:[Bh("customOAuthParameters")]}}),Yh(Gi,"credential",zi,[Hh(qh(),Bh(),"token")]),Gh(Yi.prototype,{ua:{name:"addScope",j:[qh("scope")]},Da:{name:"setCustomParameters",j:[Bh("customOAuthParameters")]}}),Yh(Yi,"credential",Xi,[Hh(qh(),Hh(Bh(),Wh()),"idToken"),Hh(qh(),Wh(),"accessToken",!0)]),Gh(Ji.prototype,{Da:{name:"setCustomParameters",j:[Bh("customOAuthParameters")]}}),Yh(Ji,"credential",$i,[Hh(qh(),Bh(),"token"),qh("secret",!0)]),Gh(Ki.prototype,{ua:{name:"addScope",j:[qh("scope")]},credential:{name:"credential",j:[Hh(qh(),Hh(Bh(),Wh()),"optionsOrIdToken"),Hh(qh(),Wh(),"accessToken",!0)]},Da:{name:"setCustomParameters",j:[Bh("customOAuthParameters")]}}),Gh(qi.prototype,{w:{name:"toJSON",j:[qh(null,!0)]}}),Gh(Li.prototype,{w:{name:"toJSON",j:[qh(null,!0)]}}),Yh(so,"credential",uo,[qh("verificationId"),qh("verificationCode")]),Gh(so.prototype,{Va:{name:"verifyPhoneNumber",j:[qh("phoneNumber"),Qh()]}}),Gh(io.prototype,{w:{name:"toJSON",j:[qh(null,!0)]}}),Gh(Yr.prototype,{toJSON:{name:"toJSON",j:[qh(null,!0)]}}),Gh(vo.prototype,{toJSON:{name:"toJSON",j:[qh(null,!0)]}}),Gh(go.prototype,{toJSON:{name:"toJSON",j:[qh(null,!0)]}}),Gh(Lh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Jh||!Jh.INTERNAL||!Jh.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:rh,AuthCredential:xi,Error:Yr};Yh(t,"EmailAuthProvider",eo,[]),Yh(t,"FacebookAuthProvider",Qi,[]),Yh(t,"GithubAuthProvider",Gi,[]),Yh(t,"GoogleAuthProvider",Yi,[]),Yh(t,"TwitterAuthProvider",Ji,[]),Yh(t,"OAuthProvider",Ki,[qh("providerId")]),Yh(t,"SAMLAuthProvider",Wi,[qh("providerId")]),Yh(t,"PhoneAuthProvider",so,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof rh)}}]),Yh(t,"RecaptchaVerifier",Lh,[Hh(qh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Bh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Jh.app.App)}}]),Jh.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new rh(t)).getUid,t),getToken:_(t.$b,t),addAuthTokenListener:_(t.Tb,t),removeAuthTokenListener:_(t.Bc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),Jh.INTERNAL.extendNamespace({User:vc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var oo,ao=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ai(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ni(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),so=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Di(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),uo=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ao(e)}}catch(t){}return new so},co=uo("localStorage"),ho=uo("sessionStorage"),lo=new zi("@firebase/database"),fo=(oo=1,function(){return oo++}),po=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;fi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(e[n++]=i<65536?i>>12|224:(e[n++]=i>>18|240,i>>12&63|128),i>>6&63|128),63&i|128)}return e}(t),n=new xi;n.update(e);var r=n.digest();return yi.encodeByteArray(r)},yo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=yo.apply(null,t[r]):"object"==typeof t[r]?n+=Ai(t[r]):n+=t[r],n+=" ";return n},mo=null,go=!0,vo=function(t,e){fi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(lo.logLevel=ji.VERBOSE,mo=lo.log.bind(lo),e&&ho.set("logging_enabled",!0)):"function"==typeof t?mo=t:(mo=null,ho.remove("logging_enabled"))},bo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===go&&(go=!1,null===mo&&!0===ho.get("logging_enabled")&&vo(!0)),mo){var n=yo.apply(null,t);mo(n)}},wo=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bo.apply(void 0,hi([n],t))}},_o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+yo.apply(void 0,hi(t));lo.error(n)},Eo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+yo.apply(void 0,hi(t));throw lo.error(n),new Error(n)},To=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+yo.apply(void 0,hi(t));lo.warn(n)},So=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},Io="[MIN_NAME]",Co="[MAX_NAME]",No=function(t,e){if(t===e)return 0;if(t===Io||e===Co)return-1;if(e===Io||t===Co)return 1;var n=Mo(t),r=Mo(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ao=function(t,e){return t===e?0:t<e?-1:1},ko=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Ai(e))},Do=function(t){if("object"!=typeof t||null===t)return Ai(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Ai(e[i]),r+=":",r+=Do(t[e[i]]);return r+="}"},Ro=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Oo(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Po=function(t){fi(!So(t),"Invalid JSON number");var e,n,r,i,o,a,s;for(0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},xo=new RegExp("^-?\\d{1,10}$"),Mo=function(t){if(xo.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Lo=function(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw To("Exception was thrown by user callback.",t),e},Math.floor(0))}},Fo=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},Uo=function(){function i(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(i,"Empty",{get:function(){return new i("")},enumerable:!0,configurable:!0}),i.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},i.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},i.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new i(this.pieces_,t)},i.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},i.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},i.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},i.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},i.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new i(t,0)},i.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof i)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new i(e,0)},i.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},i.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return i.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},i.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=No(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},i.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},i.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},i}(),qo=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Ki(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Ki(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Ki(t),0<this.parts_.length&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Vo="firebaseio.com",Bo="websocket",jo="long_polling",Wo=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=co.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&co.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(fi("string"==typeof t,"typeof type must == string"),fi("object"==typeof e,"typeof params must == object"),t===Bo)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==jo)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Oo(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var Ko,Qo,Ho,Go,zo,Yo=function(t){var e=Xo(t),n=e.subdomain;"firebase"===e.domain&&Eo(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Eo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&To("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Wo(e.host,e.secure,n,r),path:new Uo(e.pathString)}},Xo=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ui(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):To("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},Jo=/[\[\].#$\/\u0000-\u001F\u007F]/,$o=/[\[\].#$\u0000-\u001F\u007F]/,Zo=10485760,ta=function(t){return"string"==typeof t&&0!==t.length&&!Jo.test(t)},ea=function(t){return"string"==typeof t&&0!==t.length&&!$o.test(t)},na=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!So(t)||t&&"object"==typeof t&&Di(t,".sv")},ra=function(t,e,n,r,i){i&&void 0===n||ia(qi(t,e,i),n,r)},ia=function(n,t,e){var r=e instanceof Uo?new qo(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(So(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>Zo/3&&Ki(t)>Zo)throw new Error(n+"contains a string greater than "+Zo+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Oo(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ta(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),ia(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},oa=function(t,e,n,r,i){if(!i||void 0!==n){var o=qi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Oo(n,function(t,e){var n=new Uo(t);if(ia(o,e,r.child(n)),".priority"===n.getBack()&&!na(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ta(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Uo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},aa=function(t,e,n,r){if(!r||void 0!==n){if(So(n))throw new Error(qi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!na(n))throw new Error(qi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},sa=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(qi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ua=function(t,e,n,r){if(!(r&&void 0===n||ta(n)))throw new Error(qi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ca=function(t,e,n,r){if(!(r&&void 0===n||ea(n)))throw new Error(qi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ha=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},la=function(t,e,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ta(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&((r=i)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),!ea(r)))throw new Error(qi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},fa=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Ui("OnDisconnect.cancel",0,1,arguments.length),Vi("OnDisconnect.cancel",1,t,!0);var e=new bi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Ui("OnDisconnect.remove",0,1,arguments.length),ha("OnDisconnect.remove",this.path_),Vi("OnDisconnect.remove",1,t,!0);var e=new bi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Ui("OnDisconnect.set",1,2,arguments.length),ha("OnDisconnect.set",this.path_),ra("OnDisconnect.set",1,t,this.path_,!1),Vi("OnDisconnect.set",2,e,!0);var n=new bi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Ui("OnDisconnect.setWithPriority",2,3,arguments.length),ha("OnDisconnect.setWithPriority",this.path_),ra("OnDisconnect.setWithPriority",1,t,this.path_,!1),aa("OnDisconnect.setWithPriority",2,e,!1),Vi("OnDisconnect.setWithPriority",3,n,!0);var r=new bi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Ui("OnDisconnect.update",1,2,arguments.length),ha("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,To("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}oa("OnDisconnect.update",1,t,this.path_,!1),Vi("OnDisconnect.update",2,e,!0);var i=new bi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),pa=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Ui("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),da=(Ko="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Qo=0,Ho=[],function(t){var e,n=t===Qo;Qo=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Ko.charAt(t%64),t=Math.floor(t/64);fi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Ho[e];e--)Ho[e]=0;Ho[e]++}else for(e=0;e<12;e++)Ho[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Ko.charAt(Ho[e]);return fi(20===i.length,"nextPushId: Length should be 20."),i}),ya=function(){function n(t,e){this.name=t,this.node=e}return n.Wrap=function(t,e){return new n(t,e)},n}(),ma=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new ya(Io,t),r=new ya(Io,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return ya.MIN},t}(),ga=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Go},set:function(t){Go=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return No(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw pi("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return ya.MIN},e.prototype.maxPost=function(){return new ya(Co,Go)},e.prototype.makePost=function(t,e){return fi("string"==typeof t,"KeyIndex indexValue must always be a string."),new ya(t,Go)},e.prototype.toString=function(){return".key"},e}(ma),va=new ga;var ba,wa,_a,Ea=function(t){return"number"==typeof t?"number:"+Po(t):"string:"+t},Ta=function(t){if(t.isLeafNode()){var e=t.val();fi("string"==typeof e||"number"==typeof e||"object"==typeof e&&Di(e,".sv"),"Priority must be a string or number.")}else fi(t===zo||t.isEmpty(),"priority of unexpected type.");fi(t===zo||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Sa=function(){function o(t,e){void 0===e&&(e=o.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,fi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ta(this.priorityNode_)}return Object.defineProperty(o,"__childrenNodeConstructor",{get:function(){return ba},set:function(t){ba=t},enumerable:!0,configurable:!0}),o.prototype.isLeafNode=function(){return!0},o.prototype.getPriority=function(){return this.priorityNode_},o.prototype.updatePriority=function(t){return new o(this.value_,t)},o.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.hasChild=function(){return!1},o.prototype.getPredecessorChildName=function(t,e){return null},o.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:o.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},o.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(fi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,o.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},o.prototype.isEmpty=function(){return!1},o.prototype.numChildren=function(){return 0},o.prototype.forEachChild=function(t,e){return!1},o.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},o.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ea(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?Po(this.value_):this.value_,this.lazyHash_=po(t)}return this.lazyHash_},o.prototype.getValue=function(){return this.value_},o.prototype.compareTo=function(t){return t===o.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof o.__childrenNodeConstructor?-1:(fi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},o.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=o.VALUE_TYPE_ORDER.indexOf(e),i=o.VALUE_TYPE_ORDER.indexOf(n);return fi(0<=r,"Unknown leaf type: "+e),fi(0<=i,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},o.prototype.withIndex=function(){return this},o.prototype.isIndexed=function(){return!0},o.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},o.VALUE_TYPE_ORDER=["object","boolean","number","string"],o}();var Ia,Ca,Na=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?No(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return ya.MIN},e.prototype.maxPost=function(){return new ya(Co,new Sa("[PRIORITY-POST]",_a))},e.prototype.makePost=function(t,e){var n=wa(t);return new ya(e,new Sa("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(ma)),Aa=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return 0<this.nodeStack_.length},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),ka=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:Ra.EMPTY_NODE,this.right=null!=i?i:Ra.EMPTY_NODE}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.count=function(){return this.left.count()+1+this.right.count()},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},o.prototype.minKey=function(){return this.min_().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},o.prototype.removeMin_=function(){if(this.left.isEmpty())return Ra.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},o.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Ra.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},o.prototype.isRed_=function(){return this.color},o.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},o.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},o.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},o.prototype.rotateLeft_=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight_=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},o.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},o.RED=!0,o.BLACK=!1,o}(),Da=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ka(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Ra=function(){function n(t,e){void 0===e&&(e=n.EMPTY_NODE),this.comparator_=t,this.root_=e}return n.prototype.insert=function(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ka.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ka.BLACK,null,null))},n.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},n.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},n.prototype.isEmpty=function(){return this.root_.isEmpty()},n.prototype.count=function(){return this.root_.count()},n.prototype.minKey=function(){return this.root_.minKey()},n.prototype.maxKey=function(){return this.root_.maxKey()},n.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},n.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},n.prototype.getIterator=function(t){return new Aa(this.root_,null,this.comparator_,!1,t)},n.prototype.getIteratorFrom=function(t,e){return new Aa(this.root_,t,this.comparator_,!1,e)},n.prototype.getReverseIteratorFrom=function(t,e){return new Aa(this.root_,t,this.comparator_,!0,e)},n.prototype.getReverseIterator=function(t){return new Aa(this.root_,null,this.comparator_,!0,t)},n.EMPTY_NODE=new Da,n}(),Oa=Math.log(2),Pa=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Oa,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),xa=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new ka(r,n.node,ka.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new ka(r,n.node,ka.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(n+1,r),o=c[n],a=h?h(o):o;u(new ka(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,ka.BLACK):(r(a,ka.BLACK),r(a,ka.RED))}return n}(new Pa(c.length));return new Ra(e||t,n)},Ma={},La=function(){function l(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(l,"Default",{get:function(){return fi(Na,"ChildrenNode.ts has not been loaded"),Ia=Ia||new l({".priority":Ma},{".priority":Na})},enumerable:!0,configurable:!0}),l.prototype.get=function(t){var e=Ri(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Ra?e:null},l.prototype.hasIndex=function(t){return Di(this.indexSet_,t.toString())},l.prototype.addIndex=function(t,e){fi(t!==va,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(ya.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?xa(r,t.getCompare()):Ma;var s=t.toString(),u=oi({},this.indexSet_);u[s]=t;var c=oi({},this.indexes_);return c[s]=n,new l(c,u)},l.prototype.addToIndexes=function(u,c){var h=this;return new l(Pi(this.indexes_,function(t,e){var n=Ri(h.indexSet_,e);if(fi(n,"Missing index implementation for "+e),t===Ma){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(ya.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),xa(r,n.getCompare())}return Ma}var a=c.get(u.name),s=t;return a&&(s=s.remove(new ya(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},l.prototype.removeFromIndexes=function(n,r){return new l(Pi(this.indexes_,function(t){if(t===Ma)return t;var e=r.get(n.name);return e?t.remove(new ya(n.name,e)):t}),this.indexSet_)},l}();function Fa(t,e){return No(t.name,e.name)}function Ua(t,e){return No(t,e)}var qa=function(){function s(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ta(this.priorityNode_),this.children_.isEmpty()&&fi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(s,"EMPTY_NODE",{get:function(){return Ca||(Ca=new s(new Ra(Ua),null,La.Default))},enumerable:!0,configurable:!0}),s.prototype.isLeafNode=function(){return!1},s.prototype.getPriority=function(){return this.priorityNode_||Ca},s.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new s(this.children_,t,this.indexMap_)},s.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Ca:e},s.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},s.prototype.hasChild=function(t){return null!==this.children_.get(t)},s.prototype.updateImmediateChild=function(t,e){if(fi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n=new ya(t,e),r=void 0,i=void 0;return i=e.isEmpty()?(r=this.children_.remove(t),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),this.indexMap_.addToIndexes(n,this.children_)),new s(r,r.isEmpty()?Ca:this.priorityNode_,i)},s.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;fi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},s.prototype.isEmpty=function(){return this.children_.isEmpty()},s.prototype.numChildren=function(){return this.children_.count()},s.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(Na,function(t,e){r[t]=e.val(n),i++,a&&s.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},s.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Ea(this.getPriority().val())+":"),this.forEachChild(Na,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":po(r)}return this.lazyHash_},s.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ya(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},s.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},s.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ya(e,this.children_.get(e)):null},s.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},s.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ya(e,this.children_.get(e)):null},s.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},s.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},s.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,ya.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},s.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},s.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,ya.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},s.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Va?-1:0},s.prototype.withIndex=function(t){if(t===va||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new s(this.children_,this.priorityNode_,e)},s.prototype.isIndexed=function(t){return t===va||this.indexMap_.hasIndex(t)},s.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Na),r=e.getIterator(Na),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},s.prototype.resolveIndex_=function(t){return t===va?null:this.indexMap_.get(t.toString())},s.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,s}(),Va=new(function(t){function e(){return t.call(this,new Ra(Ua),qa.EMPTY_NODE,La.Default)||this}return ii(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return qa.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(qa));Object.defineProperties(ya,{MIN:{value:new ya(Io,qa.EMPTY_NODE)},MAX:{value:new ya(Co,Va)}}),ga.__EMPTY_NODE=qa.EMPTY_NODE,Sa.__childrenNodeConstructor=qa,zo=Va,_a=Va;var Ba=!0;function ja(r,t){if(void 0===t&&(t=null),null===r)return qa.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),fi(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Sa(r,ja(t));if(r instanceof Array||!Ba){var i=qa.EMPTY_NODE;return Oo(r,function(t,e){if(Di(r,t)&&"."!==t.substring(0,1)){var n=ja(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(ja(t))}var o=[],a=!1;if(Oo(r,function(t,e){if("."!==t.substring(0,1)){var n=ja(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new ya(t,n)))}}),0==o.length)return qa.EMPTY_NODE;var e=xa(o,Fa,function(t){return t.name},Ua);if(a){var n=xa(o,Na.getCompare());return new qa(e,ja(t),new La({".priority":n},{".priority":Na}))}return new qa(e,ja(t),La.Default)}wa=ja;var Wa,Ka,Qa,Ha=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?No(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return ya.MIN},e.prototype.maxPost=function(){return ya.MAX},e.prototype.makePost=function(t,e){var n=ja(t);return new ya(e,n)},e.prototype.toString=function(){return".value"},e}(ma)),Ga=function(n){function t(t){var e=n.call(this)||this;return e.indexPath_=t,fi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}return ii(t,n),t.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?No(t.name,e.name):i},t.prototype.makePost=function(t,e){var n=ja(t),r=qa.EMPTY_NODE.updateChild(this.indexPath_,n);return new ya(e,r)},t.prototype.maxPost=function(){var t=qa.EMPTY_NODE.updateChild(this.indexPath_,Va);return new ya(Co,t)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(ma),za=function(){function i(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return i.prototype.val=function(){return Ui("DataSnapshot.val",0,0,arguments.length),this.node_.val()},i.prototype.exportVal=function(){return Ui("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},i.prototype.toJSON=function(){return Ui("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},i.prototype.exists=function(){return Ui("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},i.prototype.child=function(t){Ui("DataSnapshot.child",0,1,arguments.length),t=String(t),ca("DataSnapshot.child",1,t,!1);var e=new Uo(t),n=this.ref_.child(e);return new i(this.node_.getChild(e),n,Na)},i.prototype.hasChild=function(t){Ui("DataSnapshot.hasChild",1,1,arguments.length),ca("DataSnapshot.hasChild",1,t,!1);var e=new Uo(t);return!this.node_.getChild(e).isEmpty()},i.prototype.getPriority=function(){return Ui("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},i.prototype.forEach=function(n){var r=this;return Ui("DataSnapshot.forEach",1,1,arguments.length),Vi("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new i(e,r.ref_.child(t),Na))})},i.prototype.hasChildren=function(){return Ui("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(i.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),i.prototype.numChildren=function(){return Ui("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},i.prototype.getRef=function(){return Ui("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(i.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),i}(),Ya=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Ai(this.snapshot.exportVal())},t}(),Xa=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Ja=function(){function e(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return e.prototype.respondsTo=function(t){return"value"===t},e.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Ya("value",this,new za(t.snapshotNode,e.getRef(),n))},e.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){fi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},e.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Xa(this,t,e):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),$a=function(){function s(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return s.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Di(this.callbacks_,e)},s.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Xa(this,t,e):null},s.prototype.createEvent=function(t,e){fi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Ya(t.type,this,new za(t.snapshotNode,n,r),t.prevName)},s.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){fi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},s.prototype.matches=function(e){var n=this;if(e instanceof s){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},s.prototype.hasAnyCallback=function(){return null!==this.callbacks_},s}(),Za=function(){function c(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(c,"__referenceConstructor",{get:function(){return fi(Wa,"Reference.ts has not been loaded"),Wa},set:function(t){Wa=t},enumerable:!0,configurable:!0}),c.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===va){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Io)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Co)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Na){if(null!=e&&!na(e)||null!=n&&!na(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(fi(t.getIndex()instanceof Ga||t.getIndex()===Ha,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},c.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},c.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},c.prototype.getQueryParams=function(){return this.queryParams_},c.prototype.getRef=function(){return Ui("Query.ref",0,0,arguments.length),new c.__referenceConstructor(this.repo,this.path)},c.prototype.on=function(t,e,n,r){Ui("Query.on",2,4,arguments.length),sa("Query.on",1,t,!1),Vi("Query.on",2,e,!1);var i=c.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},c.prototype.onValueEvent=function(t,e,n){var r=new Ja(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},c.prototype.onChildEvent=function(t,e,n){var r=new $a(t,e,n);this.repo.addEventCallbackForQuery(this,r)},c.prototype.off=function(t,e,n){Ui("Query.off",0,3,arguments.length),sa("Query.off",1,t,!0),Vi("Query.off",2,e,!0),Bi("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Ja(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new $a(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},c.prototype.once=function(e,n,t,r){var i=this;Ui("Query.once",1,4,arguments.length),sa("Query.once",1,e,!1),Vi("Query.once",2,n,!0);var o=c.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new bi;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},c.prototype.limitToFirst=function(t){if(Ui("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},c.prototype.limitToLast=function(t){if(Ui("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},c.prototype.orderByChild=function(t){if(Ui("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ca("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Uo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Ga(e),r=this.queryParams_.orderBy(n);return c.validateQueryEndpoints_(r),new c(this.repo,this.path,r,!0)},c.prototype.orderByKey=function(){Ui("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(va);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByPriority=function(){Ui("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Na);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByValue=function(){Ui("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ha);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.startAt=function(t,e){void 0===t&&(t=null),Ui("Query.startAt",0,2,arguments.length),ra("Query.startAt",1,t,this.path,!0),ua("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.endAt=function(t,e){void 0===t&&(t=null),Ui("Query.endAt",0,2,arguments.length),ra("Query.endAt",1,t,this.path,!0),ua("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.equalTo=function(t,e){if(Ui("Query.equalTo",1,2,arguments.length),ra("Query.equalTo",1,t,this.path,!1),ua("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},c.prototype.toString=function(){return Ui("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},c.prototype.toJSON=function(){return Ui("Query.toJSON",0,1,arguments.length),this.toString()},c.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},c.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Do(t);return"{}"===e?"default":e},c.prototype.isEqual=function(t){if(Ui("Query.isEqual",1,1,arguments.length),!(t instanceof c)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},c.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Vi(t,3,r.cancel,!0),r.context=n,Bi(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(qi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(c.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),c}(),ts=function(){function i(){this.value=null,this.children=new Map}return i.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},i.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new i);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},i.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Na,function(t,e){n.remember(new Uo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size}return!0},i.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Uo(r.toString()+"/"+t);e.forEachTree(n,i)})},i.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},i}(),es=function(t,e){return t&&"object"==typeof t?(fi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},ns=function(t,r){var i,e=t.getPriority().val(),n=es(e,r);if(t.isLeafNode()){var o=t,a=es(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Sa(a,ja(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Sa(n))),s.forEachChild(Na,function(t,e){var n=ns(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(Qa=Ka||(Ka={}))[Qa.OVERWRITE=0]="OVERWRITE",Qa[Qa.MERGE=1]="MERGE",Qa[Qa.ACK_USER_WRITE=2]="ACK_USER_WRITE",Qa[Qa.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var rs,is,os=function(){function e(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,fi(!r||e,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),as=function(){function n(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ka.ACK_USER_WRITE,this.source=os.User}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return fi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Uo(t));return new n(Uo.Empty,e,this.revert)}return fi(this.path.getFront()===t,"operationForChild called for unrelated child."),new n(this.path.popFront(),this.affectedTree,this.revert)},n}(),ss=function(){function o(t,e){void 0===e&&(rs||(rs=new Ra(Ao)),e=rs),this.value=t,this.children=e}return o.fromObject=function(t){var n=o.Empty;return Oo(t,function(t,e){n=n.set(new Uo(t),e)}),n},o.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},o.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Uo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Uo(n).child(i.path),value:i.value}},o.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},o.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):o.Empty},o.prototype.set=function(t,e){if(t.isEmpty())return new o(e,this.children);var n=t.getFront(),r=(this.children.get(n)||o.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new o(this.value,i)},o.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?o.Empty:new o(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?o.Empty:new o(this.value,i)}return this},o.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},o.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||o.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new o(this.value,i)},o.prototype.fold=function(t){return this.fold_(Uo.Empty,t)},o.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},o.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Uo.Empty,e)},o.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},o.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Uo.Empty,e)},o.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):o.Empty},o.prototype.foreach=function(t){this.foreach_(Uo.Empty,t)},o.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},o.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},o.Empty=new o(null),o}(),us=function(){function e(t,e){this.source=t,this.path=e,this.type=Ka.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Uo.Empty):new e(this.source,this.path.popFront())},e}(),cs=function(){function e(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ka.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Uo.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),hs=function(){function n(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ka.MERGE}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Uo(t));return e.isEmpty()?null:e.value?new cs(this.source,Uo.Empty,e.value):new n(this.source,Uo.Empty,e)}return fi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,this.path.popFront(),this.children)},n.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},n}(),ls=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),fs=function(){function r(t,e){this.eventCache_=t,this.serverCache_=e}return r.prototype.updateEventSnap=function(t,e,n){return new r(new ls(t,e,n),this.serverCache_)},r.prototype.updateServerSnap=function(t,e,n){return new r(this.eventCache_,new ls(t,e,n))},r.prototype.getEventCache=function(){return this.eventCache_},r.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},r.prototype.getServerCache=function(){return this.serverCache_},r.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},r.Empty=new r(new ls(qa.EMPTY_NODE,!1,!1),new ls(qa.EMPTY_NODE,!1,!1)),r}(),ps=function(){function r(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return r.valueChange=function(t){return new r(r.VALUE,t)},r.childAddedChange=function(t,e){return new r(r.CHILD_ADDED,e,t)},r.childRemovedChange=function(t,e){return new r(r.CHILD_REMOVED,e,t)},r.childChangedChange=function(t,e,n){return new r(r.CHILD_CHANGED,e,t,n)},r.childMovedChange=function(t,e){return new r(r.CHILD_MOVED,e,t)},r.CHILD_ADDED="child_added",r.CHILD_REMOVED="child_removed",r.CHILD_CHANGED="child_changed",r.CHILD_MOVED="child_moved",r.VALUE="value",r}(),ds=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){fi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(ps.childRemovedChange(e,a)):fi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ps.childAddedChange(e,n)):o.trackChildChange(ps.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Na,function(t,e){n.hasChild(t)||i.trackChildChange(ps.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(Na,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(ps.childChangedChange(t,e,n))}else i.trackChildChange(ps.childAddedChange(t,e))})),n.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?qa.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),ys=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;fi(e==ps.CHILD_ADDED||e==ps.CHILD_CHANGED||e==ps.CHILD_REMOVED,"Only child changes supported for tracking"),fi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==ps.CHILD_ADDED&&i==ps.CHILD_REMOVED)this.changeMap.set(n,ps.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==ps.CHILD_REMOVED&&i==ps.CHILD_ADDED)this.changeMap.delete(n);else if(e==ps.CHILD_REMOVED&&i==ps.CHILD_CHANGED)this.changeMap.set(n,ps.childRemovedChange(n,r.oldSnap));else if(e==ps.CHILD_CHANGED&&i==ps.CHILD_ADDED)this.changeMap.set(n,ps.childAddedChange(n,t.snapshotNode));else{if(e!=ps.CHILD_CHANGED||i!=ps.CHILD_CHANGED)throw pi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,ps.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),ms=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),gs=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ls(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),vs=function(t,e){this.viewCache=t,this.changes=e},bs=function(){function l(t){this.filter_=t}return l.prototype.assertIndexed=function(t){fi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),fi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},l.prototype.applyOperation=function(t,e,n,r){var i,o,a=new ys;if(e.type===Ka.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(fi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Ka.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(fi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Ka.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Ka.LISTEN_COMPLETE)throw pi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return l.maybeAddValueEvent_(t,i,h),new vs(i,h)},l.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ps.valueChange(e.getCompleteEventSnap()))}},l.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(fi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof qa?u:qa.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){fi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},l.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,ms,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new gs(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},l.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new gs(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):qa.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},l.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},l.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},l.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},l.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:ss.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Uo(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Uo(t),i,a,s,u,c)}}),l},l.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=ss.Empty;return s.getNode().forEachChild(va,function(t,e){u=u.set(new Uo(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=ss.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},l.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,ms,r)},l.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new gs(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();fi(h instanceof qa,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,qa.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Uo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},l}(),ws=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===ps.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ps.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,ps.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ps.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ps.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ps.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ps.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw pi("Should only compare child_ events.");var n=new ya(t.childName,t.snapshotNode),r=new ya(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),_s=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new ds(n.getIndex()),i=n.getNodeFilter();this.processor_=new bs(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(qa.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(qa.EMPTY_NODE,a.getNode(),null),c=new ls(s,o.isFullyInitialized(),r.filtersNodes()),h=new ls(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new fs(h,c),this.eventGenerator_=new ws(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,n){var r=[];if(n){fi(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},t.prototype.applyOperation=function(t,e,n){t.type===Ka.MERGE&&null!==t.source.queryId&&(fi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),fi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),fi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Na,function(t,e){n.push(ps.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(ps.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),Es=function(){function d(){this.views=new Map}return Object.defineProperty(d,"__referenceConstructor",{get:function(){return fi(is,"Reference.ts has not been loaded"),is},set:function(t){fi(!is,"__referenceConstructor has already been defined"),is=t},enumerable:!0,configurable:!0}),d.prototype.isEmpty=function(){return 0===this.views.size},d.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return fi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ui(this.views.values()),c=u.next();!c.done;c=u.next()){a=c.value;s=s.concat(a.applyOperation(t,e,n))}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},d.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof qa?n.calcCompleteEventChildren(r):qa.EMPTY_NODE,!1);var c=new fs(new ls(s,u,!1),new ls(r,i,!1));a=new _s(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},d.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ui(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ci(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new d.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},d.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ui(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},d.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ui(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},d.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},d.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},d.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},d.prototype.getCompleteView=function(){var e,t;try{for(var n=ui(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},d}(),Ts=function(){function s(t){this.writeTree_=t}return s.prototype.addWrite=function(t,e){if(t.isEmpty())return new s(new ss(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Uo.relativePath(r,t);return i=i.updateChild(o,e),new s(this.writeTree_.set(r,i))}var a=new ss(e);return new s(this.writeTree_.setTree(t,a))},s.prototype.addWrites=function(n,t){var r=this;return Oo(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},s.prototype.removeWrite=function(t){return t.isEmpty()?s.Empty:new s(this.writeTree_.setTree(t,ss.Empty))},s.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},s.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Uo.relativePath(e.path,t)):null},s.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Na,function(t,e){n.push(new ya(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new ya(t,e.value))}),n},s.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new s(null!=e?new ss(e):this.writeTree_.subtree(t))},s.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},s.prototype.apply=function(t){return function n(r,t,i){{if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(fi(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}}(Uo.Empty,this.writeTree_,t)},s.Empty=new s(new ss(null)),s}();var Ss=function(){function c(){this.visibleWrites_=Ts.Empty,this.allWrites_=[],this.lastWriteId_=-1}return c.prototype.childWrites=function(t){return new Is(t,this)},c.prototype.addOverwrite=function(t,e,n,r){fi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},c.prototype.addMerge=function(t,e,n){fi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},c.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},c.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});fi(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Oo(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))});return!0}return!1},c.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Uo.Empty)){var o=c.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);u=t||qa.EMPTY_NODE;return o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Uo.Empty)){var u=t||qa.EMPTY_NODE;return s.apply(u)}return null},c.prototype.calcCompleteEventChildren=function(t,e){var r=qa.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(Na,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Na,function(t,e){var n=i.childCompoundWrite(new Uo(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},c.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){fi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},c.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},c.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Uo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},c.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},c.prototype.resetTree_=function(){this.visibleWrites_=c.layerTree_(this.allWrites_,c.DefaultFilter_,Uo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},c.DefaultFilter_=function(t){return t.visible},c.layerTree_=function(t,e,n){for(var r=Ts.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Uo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Uo.relativePath(a,n),r=r.addWrite(Uo.Empty,o.snap.getChild(s)));else{if(!o.children)throw pi("WriteRecord should have .snap or .children");if(n.contains(a))s=Uo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Uo.relativePath(a,n)).isEmpty())r=r.addWrites(Uo.Empty,o.children);else{var u=Ri(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Uo.Empty,c)}}}}}return r},c}(),Is=function(){function e(t,e){this.treePath_=t,this.writeTree_=e}return e.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},e.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},e.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},e.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},e.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},e.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Cs=function(){function g(t){this.listenProvider_=t,this.syncPointTree_=ss.Empty,this.pendingWriteTree_=new Ss,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return g.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new cs(os.User,t,e)):[]},g.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=ss.fromObject(e);return this.applyOperationToSyncPoints_(new hs(os.User,t,r))},g.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=ss.Empty;return null!=n.snap?r=r.set(Uo.Empty,!0):Oo(n.children,function(t,e){r=r.set(new Uo(t),e)}),this.applyOperationToSyncPoints_(new as(n.path,r,e))}return[]},g.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new cs(os.Server,t,e))},g.prototype.applyServerMerge=function(t,e){var n=ss.fromObject(e);return this.applyOperationToSyncPoints_(new hs(os.Server,t,n))},g.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new us(os.Server,t))},g.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=g.parseQueryKey_(r),o=i.path,a=i.queryId,s=Uo.relativePath(o,t),u=new cs(os.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},g.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=g.parseQueryKey_(r),o=i.path,a=i.queryId,s=Uo.relativePath(o,t),u=ss.fromObject(e),c=new hs(os.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},g.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=g.parseQueryKey_(n),i=r.path,o=r.queryId,a=Uo.relativePath(i,t),s=new us(os.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},g.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Uo.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);(a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Uo.Empty)):(a=new Es,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i)?n=!0:(n=!1,i=qa.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Uo.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=g.makeQueryKey_(t);fi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=g.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},g.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(g.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}if(!h&&0<u.length&&!n)if(c){this.listenProvider_.stopListening(g.queryForListening_(t),null)}else u.forEach(function(t){var e=r.queryToTagMap.get(g.makeQueryKey_(t));r.listenProvider_.stopListening(g.queryForListening_(t),e)});this.removeTags_(u)}return a},g.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Uo.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},g.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Oo(n,function(t,e){r=r.concat(e)}),r})},g.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=g.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},g.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},g.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(g.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)fi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Oo(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(g.queryForListening_(c),this.tagForQuery_(c))}return o},g.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||qa.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},g.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},g.parseQueryKey_=function(t){var e=t.indexOf("$");return fi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Uo(t.substr(0,e))}},g.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},g.prototype.tagForQuery_=function(t){var e=g.makeQueryKey_(t);return this.queryToTagMap.get(e)},g.getNextQueryTag_=function(){return g.nextQueryTag_++},g.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);fi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},g.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Uo.Empty))},g.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Uo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Uo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},g.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Uo.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Uo.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},g.nextQueryTag_=1,g}(),Ns=function(){function t(){this.rootNode_=qa.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),As=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(bo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',To(t)},t}(),ks=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Di(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return gi(this.counters_)},t}(),Ds=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new ks),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),Rs=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),n=oi({},t);return this.last_&&Oo(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},t}(),Os=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Rs(t);var n=1e4+2e4*Math.random();Fo(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Oo(t,function(t,e){0<e&&Di(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Fo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Ps=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new xs(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},t.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),xs=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();mo&&bo("event: "+e.toString()),Lo(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Ms=function(){function t(t){this.allowedEvents_=t,this.listeners_={},fi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=hi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(e){fi(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},t}(),Ls=function(r){function t(){var e,t,n=r.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}return ii(t,r),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return fi("visible"===t,"Unknown event type: "+t),[this.visible_]},t}(Ms),Fs=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||_i()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return ii(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return fi("online"===t,"Unknown event type: "+t),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Ms),Us=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Lo(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},t}(),qs=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wo(t),this.stats_=Ds.getCollection(e),this.urlFn=function(t){return e.connectionURL(jo,t)}}return t.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Us(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new Vs(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,5),r=n[0],i=n[1],o=n[2];n[3],n[4];if(a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Vo)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Ti()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Ai(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=di(e),yi.encodeByteArray(n,!0)),i=Ro(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},t.prototype.incrementIncomingBytes_=function(t){var e=Ai(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),Vs=function(){function a(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=fo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=a.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){bo("frame writing exception"),t.stack&&bo(t.stack),bo(t)}}return a.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||bo("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},a.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},a.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},a.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},a.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},a.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},a.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){bo("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},a}(),Bs="";var js=null;"undefined"!=typeof MozWebSocket?js=MozWebSocket:"undefined"!=typeof WebSocket&&(js=WebSocket);var Ws=function(){function i(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wo(this.connId),this.stats_=Ds.getCollection(e),this.connURL=i.connectionURL_(e,n,r)}return i.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Vo)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Bo,r)},i.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,co.set("previous_websocket_failure",!0);try{if(Ti()){var r=li.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Bs+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new js(this.connURL,[],i)}else this.mySock=new js(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},i.prototype.start=function(){},i.forceDisallow=function(){i.forceDisallow_=!0},i.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==js&&!i.forceDisallow_},i.previouslyFailed=function(){return co.isInMemoryStorage||!0===co.get("previous_websocket_failure")},i.prototype.markConnectionHealthy=function(){co.remove("previous_websocket_failure")},i.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ni(e);this.onMessage(n)}},i.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},i.prototype.extractFrameCount_=function(t){if(fi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},i.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},i.prototype.send=function(t){this.resetKeepAlive();var e=Ai(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Ro(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},i.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},i.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},i.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},i.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},i.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4,i}(),Ks=function(){function c(t){this.initTransports_(t)}return Object.defineProperty(c,"ALL_TRANSPORTS",{get:function(){return[qs,Ws]},enumerable:!0,configurable:!0}),c.prototype.initTransports_=function(t){var e,n,r=Ws&&Ws.isAvailable(),i=r&&!Ws.previouslyFailed();if(t.webSocketOnly&&(r||To("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ws];else{var o=this.transports_=[];try{for(var a=ui(c.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},c.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},c.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},c}(),Qs=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wo("c:"+this.id+":"),this.transportManager_=new Ks(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Fo(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},t.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=ko("t",t),n=ko("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=ko("t",t),n=ko("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=ko("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?_o("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_o("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&To("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Fo(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Fo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(co.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Hs=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Gs=function(s){function h(t,e,n,r,i,o){var a=s.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=h.nextPersistentConnectionId_++,a.log_=wo("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ti())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),Ls.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Fs.getInstance().on("online",a.onOnline_,a),a}return ii(h,s),h.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Ai(i)),fi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},h.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),fi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),fi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},h.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;h.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},h.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Di(t,"w")){var n=Ri(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();To("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},h.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},h.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=ki(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},h.prototype.tryAuth=function(){var t,r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,e=(t=ki(i).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",n={cred:i};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},h.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),fi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},h.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},h.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},h.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},h.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},h.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},h.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},h.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},h.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},h.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},h.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},h.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Ai(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},h.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):_o("Unrecognized action received from server: "+Ai(t)+"\nAre you using the latest client?")},h.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},h.prototype.scheduleConnect_=function(t){var e=this;fi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},h.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},h.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},h.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},h.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+h.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){fi(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?bo("getToken() completed but was canceled"):(bo("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new Qs(i,o.repoInfo_,e,n,r,function(t){To(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},h.prototype.interrupt=function(t){bo("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},h.prototype.resume=function(t){bo("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Oi(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},h.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},h.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},h.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Do(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},h.prototype.removeListen_=function(t,e){var n,r=new Uo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},h.prototype.onAuthRevoked_=function(t,e){bo("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},h.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},h.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ui(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ui(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},h.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Bs.replace(/\./g,"-")]=1,_i()?t["framework.cordova"]=1:Ei()&&(t["framework.reactnative"]=1),this.reportStats(t)},h.prototype.shouldReconnect_=function(){var t=Fs.getInstance().currentlyOnline();return Oi(this.interruptReasons_)&&t},h.nextPersistentConnectionId_=0,h.nextConnectionId_=0,h}(Hs),zs=function(i){function c(t,e,n){var r=i.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=wo("p:rest:"),r.listens_={},r}return ii(c,i),c.prototype.reportStats=function(t){throw new Error("Method not implemented.")},c.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(fi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},c.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=c.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;(404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Ri(o.listens_,s)===u)&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},c.prototype.unlisten=function(t,e){var n=c.getListenId_(t,e);delete this.listens_[n]},c.prototype.refreshAuthToken=function(t){},c.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ni(r.responseText)}catch(t){To("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&To("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},c}(Hs),Ys="repo_interrupt",Xs=function(){function t(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ps,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ts,this.persistentConnection_=null;var r=new As(n);if(this.stats_=Ds.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new zs(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ai(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Gs(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Ds.getOrCreateReporter(t,function(){return new Os(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Ns,this.infoSyncTree_=new Cs({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Cs({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new Uo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Uo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Pi(e,function(t){return ja(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=ja(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Pi(e,function(t){return ja(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=ja(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var n=this;Oo(t,function(t,e){n.updateInfo_(e,t)})},t.prototype.updateInfo_=function(t,e){var n=new Uo("/.info/"+t),r=ja(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=ja(t,e),s=ns(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||To("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Oo(t,function(t,e){r=!1;var n=ja(e);u[t]=ns(n,i)}),r)bo("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||To("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Oo(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},t.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t,n,i,e=this.generateServerValues(),o=(t=this.onDisconnect_,n=e,i=new ts,t.forEachTree(new Uo(""),function(t,e){i.remember(t,ns(e,n))}),i),a=[];o.forEachTree(Uo.Empty,function(t,e){a=a.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new ts,this.eventQueue_.raiseEventsForChangedPath(Uo.Empty,a)},t.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSet=function(n,t,r){var i=this,o=ja(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=ja(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Oi(n))return bo("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Oo(n,function(t,e){var n=ja(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Ys)},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Ys)},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Rs(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Oo(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),bo.apply(void 0,hi([n],t))},t.prototype.callOnCompleteCallback=function(r,i,o){r&&Lo(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new uu(this))},enumerable:!0,configurable:!0}),t}(),Js=function(){function e(t){this.indexedFilter_=new ds(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},e.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new ya(e,n))||(n=qa.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},e.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=qa.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(qa.EMPTY_NODE);var i=this;return e.forEachChild(Na,function(t,e){i.matches(new ya(t,e))||(r=r.updateImmediateChild(t,qa.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},e.prototype.updatePriority=function(t,e){return t},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},e.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},e}(),$s=function(){function t(t){this.rangedFilter_=new Js(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new ya(e,n))||(n=qa.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=qa.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=qa.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(qa.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){a=i.getNext();!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,qa.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;fi(s.numChildren()==this.limit_,"");var u=new ya(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(ps.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(ps.childRemovedChange(e,l));var d=s.updateImmediateChild(e,qa.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(ps.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(ps.childRemovedChange(c.name,c.node)),i.trackChildChange(ps.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,qa.EMPTY_NODE)):t},t}(),Zs=function(){function r(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Na}return r.prototype.hasStart=function(){return this.startSet_},r.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},r.prototype.getIndexStartValue=function(){return fi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},r.prototype.getIndexStartName=function(){return fi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Io},r.prototype.hasEnd=function(){return this.endSet_},r.prototype.getIndexEndValue=function(){return fi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},r.prototype.getIndexEndName=function(){return fi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Co},r.prototype.hasLimit=function(){return this.limitSet_},r.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},r.prototype.getLimit=function(){return fi(this.limitSet_,"Only valid if limit has been set"),this.limit_},r.prototype.getIndex=function(){return this.index_},r.prototype.copy_=function(){var t=new r;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},r.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},r.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},r.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},r.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,n.indexStartName_=null!=e?(n.startNameSet_=!0,e):(n.startNameSet_=!1,""),n},r.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,n.indexEndName_=void 0!==e?(n.endNameSet_=!0,e):(n.endNameSet_=!1,""),n},r.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},r.prototype.getQueryObject=function(){var t=r.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Na&&(e[t.INDEX]=this.index_.toString()),e},r.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},r.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Na},r.prototype.getNodeFilter=function(){return this.loadsAllData()?new ds(this.getIndex()):this.hasLimit()?new $s(this):new Js(this)},r.prototype.toRestQueryStringParameters=function(){var t,e=r.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Na?e.PRIORITY_INDEX:this.index_===Ha?e.VALUE_INDEX:this.index_===va?e.KEY_INDEX:(fi(this.index_ instanceof Ga,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Ai(t),this.startSet_&&(n[e.START_AT]=Ai(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Ai(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Ai(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Ai(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},r.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},r.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},r.DEFAULT=new r,r}(),tu=function(n){function o(t,e){if(!(t instanceof Xs))throw new Error("new Reference() no longer supported - use app.database().");return n.call(this,t,e,Zs.DEFAULT,!1)||this}return ii(o,n),o.prototype.getKey=function(){return Ui("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},o.prototype.child=function(t){var e,n,r,i;return Ui("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Uo||(null===this.path.getFront()?(e="Reference.child",i=!(n=1),(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),ca(e,n,r,i)):ca("Reference.child",1,t,!1)),new o(this.repo,this.path.child(t))},o.prototype.getParent=function(){Ui("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new o(this.repo,t)},o.prototype.getRoot=function(){Ui("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},o.prototype.databaseProp=function(){return this.repo.database},o.prototype.set=function(t,e){Ui("Reference.set",1,2,arguments.length),ha("Reference.set",this.path),ra("Reference.set",1,t,this.path,!1),Vi("Reference.set",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},o.prototype.update=function(t,e){if(Ui("Reference.update",1,2,arguments.length),ha("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,To("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}oa("Reference.update",1,t,this.path,!1),Vi("Reference.update",2,e,!0);var i=new bi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},o.prototype.setWithPriority=function(t,e,n){if(Ui("Reference.setWithPriority",2,3,arguments.length),ha("Reference.setWithPriority",this.path),ra("Reference.setWithPriority",1,t,this.path,!1),aa("Reference.setWithPriority",2,e,!1),Vi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new bi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},o.prototype.remove=function(t){return Ui("Reference.remove",0,1,arguments.length),ha("Reference.remove",this.path),Vi("Reference.remove",1,t,!0),this.set(null,t)},o.prototype.transaction=function(t,r,e){if(Ui("Reference.transaction",1,3,arguments.length),ha("Reference.transaction",this.path),Vi("Reference.transaction",1,t,!1),Vi("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(qi(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new bi;"function"==typeof r&&i.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new pa(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},o.prototype.setPriority=function(t,e){Ui("Reference.setPriority",1,2,arguments.length),ha("Reference.setPriority",this.path),aa("Reference.setPriority",1,t,!1),Vi("Reference.setPriority",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},o.prototype.push=function(t,e){Ui("Reference.push",0,2,arguments.length),ha("Reference.push",this.path),ra("Reference.push",1,t,this.path,!0),Vi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=da(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},o.prototype.onDisconnect=function(){return ha("Reference.onDisconnect",this.path),new fa(this.repo,this.path)},Object.defineProperty(o.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),o}(Za);Za.__referenceConstructor=tu,Es.__referenceConstructor=tu;var eu,nu,ru=function(){this.children={},this.childCount=0,this.value=null},iu=function(){function i(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new ru),this.name_=t,this.parent_=e,this.node_=n}return i.prototype.subTree=function(t){for(var e,n=t instanceof Uo?t:new Uo(t),r=this;null!==(e=n.getFront());){r=new i(e,r,Ri(r.node_.children,e)||new ru),n=n.popFront()}return r},i.prototype.getValue=function(){return this.node_.value},i.prototype.setValue=function(t){fi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},i.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},i.prototype.hasChildren=function(){return 0<this.node_.childCount},i.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},i.prototype.forEachChild=function(n){var r=this;Oo(this.node_.children,function(t,e){n(new i(t,r,e))})},i.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},i.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},i.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},i.prototype.path=function(){return new Uo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},i.prototype.name=function(){return this.name_},i.prototype.parent=function(){return this.parent_},i.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},i.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Di(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},i}();(nu=eu||(eu={}))[nu.RUN=0]="RUN",nu[nu.SENT=1]="SENT",nu[nu.COMPLETED=2]="COMPLETED",nu[nu.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",nu[nu.NEEDS_ABORT=4]="NEEDS_ABORT",Xs.MAX_TRANSACTION_RETRIES_=25,Xs.prototype.transactions_init_=function(){this.transactionQueueTree_=new iu},Xs.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new tu(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:fo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new za(a.currentInputSnapshot,new tu(this,a.path),Na);a.onComplete(null,!1,c)}}else{ia("transaction failed: Data returned ",u,a.path),a.status=eu.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Di(u,".priority"))f=Ri(u,".priority"),fi(na(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||qa.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=ja(u,f),y=ns(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Xs.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||qa.EMPTY_NODE},Xs.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);fi(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===eu.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Xs.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];fi(o.status===eu.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=eu.SENT,o.retryCount++;var a=Uo.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=eu.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new tu(c,u[r].path),a=new za(i,o,Na);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Lo(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===eu.SENT_NEEDS_ABORT?u[r].status=eu.NEEDS_ABORT:u[r].status=eu.RUN;else{To("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=eu.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Xs.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Xs.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===eu.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Uo.relativePath(e,s.path),c=!1,h=void 0;if(fi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===eu.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===eu.RUN)if(s.retryCount>=Xs.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){ia("transaction failed: Data returned ",f,s.path);var p=ja(f);"object"==typeof f&&null!=f&&Di(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=ns(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=eu.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var g=new tu(this,t[a].path),v=t[a].currentInputSnapshot,b=new za(v,g,Na);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Lo(r[a]);this.sendReadyTransactions_()}},Xs.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Xs.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Xs.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Xs.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==eu.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Xs.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Xs.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===eu.SENT_NEEDS_ABORT);else if(e[o].status===eu.SENT)fi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=eu.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(fi(e[o].status===eu.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Lo(n[o])}};var ou,au="databaseURL",su=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return ou||(ou=new t),ou},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options[au];void 0===n&&Eo("Can't determine Firebase Database URL.  Be sure to include "+au+" option when calling firebase.initializeApp().");var r=Yo(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o&&(n="http://"+o+"?ns="+i.namespace),la("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Eo("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=Ri(this.repos_,t.app.name);e&&Ri(e,t.repoInfo_.toURLString())===t||Eo("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=Ri(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Ri(n,t.toURLString());return r&&Eo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Xs(t,this.useRestClient_,e),n[t.toURLString()]=r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),uu=function(){function t(t){(this.repo_=t)instanceof Xs||Eo("Don't call new Database() directly - please use firebase.database()."),this.root_=new tu(t,Uo.Empty),this.INTERNAL=new cu(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Ui("database.ref",0,1,arguments.length),t instanceof tu?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Ui(e,1,1,arguments.length);var n=Yo(t);la(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Eo(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&Eo("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Ui("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Ui("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),cu=function(){function t(t){this.database=t}return t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.database.checkDeleted_("delete"),su.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),hu=Object.freeze({forceLongPolling:function(){Ws.forceDisallow(),qs.forceAllow()},forceWebSockets:function(){qs.forceDisallow()},isWebSocketsAvailable:function(){return Ws.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),lu=Gs;Gs.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Gs.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var fu,pu,du=Qs,yu=Wo,mu=Object.freeze({DataConnection:lu,RealTimeConnection:du,hijackHash:function(i){var o=Gs.prototype.put;return Gs.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Gs.prototype.put=o}},ConnectionTarget:yu,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){su.getInstance().forceRestClient(t)}}),gu=uu.ServerValue;pu=(fu=Jh).SDK_VERSION,Bs=pu,fu.INTERNAL.registerService("database",function(t,e,n){return su.getInstance().databaseFromApp(t,n)},{Reference:tu,Query:Za,Database:uu,DataSnapshot:za,enableLogging:vo,INTERNAL:hu,ServerValue:gu,TEST_ACCESS:mu},null,!0);var vu,bu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},wu=wu||{},_u=bu;function Eu(t){return"string"==typeof t}function Tu(t){return"number"==typeof t}function Su(t,e){t=t.split("."),e=e||_u;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Iu(){}function Cu(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Nu(t){return"array"==Cu(t)}function Au(t){var e=Cu(t);return"array"==e||"object"==e&&"number"==typeof t.length}function ku(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Du="closure_uid_"+(1e9*Math.random()>>>0),Ru=0;function Ou(t,e,n){return t.call.apply(t.bind,arguments)}function Pu(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function xu(t,e,n){return(xu=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ou:Pu).apply(null,arguments)}function Mu(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Lu=Date.now||function(){return+new Date};function Fu(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Uu(){this.j=this.j,this.i=this.i}Uu.prototype.j=!1,Uu.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Du]||(this[Du]=++Ru)},Uu.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var qu=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Eu(t))return Eu(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Vu=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Eu(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Bu(t){return Array.prototype.concat.apply([],arguments)}function ju(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Wu(t){return/^[\s\xa0]*$/.test(t)}var Ku,Qu=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Hu(t,e){return-1!=t.indexOf(e)}function Gu(t,e){return t<e?-1:e<t?1:0}t:{var zu=_u.navigator;if(zu){var Yu=zu.userAgent;if(Yu){Ku=Yu;break t}}Ku=""}function Xu(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ju(t){var e,n={};for(e in t)n[e]=t[e];return n}var $u="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Zu(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<$u.length;o++)n=$u[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function tc(t){return tc[" "](t),t}tc[" "]=Iu;var ec,nc,rc=Hu(Ku,"Opera"),ic=Hu(Ku,"Trident")||Hu(Ku,"MSIE"),oc=Hu(Ku,"Edge"),ac=oc||ic,sc=Hu(Ku,"Gecko")&&!(Hu(Ku.toLowerCase(),"webkit")&&!Hu(Ku,"Edge"))&&!(Hu(Ku,"Trident")||Hu(Ku,"MSIE"))&&!Hu(Ku,"Edge"),uc=Hu(Ku.toLowerCase(),"webkit")&&!Hu(Ku,"Edge");function cc(){var t=_u.document;return t?t.documentMode:void 0}t:{var hc="",lc=(nc=Ku,sc?/rv:([^\);]+)(\)|;)/.exec(nc):oc?/Edge\/([\d\.]+)/.exec(nc):ic?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(nc):uc?/WebKit\/(\S+)/.exec(nc):rc?/(?:Version)[ \/]?(\S+)/.exec(nc):void 0);if(lc&&(hc=lc?lc[1]:""),ic){var fc=cc();if(null!=fc&&fc>parseFloat(hc)){ec=String(fc);break t}}ec=hc}var pc,dc={};function yc(s){return t=s,e=function(){for(var t=0,e=Qu(String(ec)).split("."),n=Qu(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Gu(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Gu(0==o[2].length,0==a[2].length)||Gu(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=dc,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var mc=_u.document;pc=mc&&ic?cc()||("CSS1Compat"==mc.compatMode?parseInt(ec,10):5):void 0;var gc=!ic||9<=Number(pc),vc=ic&&!yc("9"),bc=function(){if(!_u.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{_u.addEventListener("test",Iu,e),_u.removeEventListener("test",Iu,e)}catch(t){}return t}();function wc(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function _c(t,e){if(wc.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(sc){t:{try{tc(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Eu(t.pointerType)?t.pointerType:Ec[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}wc.prototype.b=function(){this.Ja=!1},Fu(_c,wc);var Ec={2:"touch",3:"pen",4:"mouse"};_c.prototype.b=function(){_c.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,vc)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Tc="closure_listenable_"+(1e6*Math.random()|0),Sc=0;function Ic(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Sc,this.X=this.Z=!1}function Cc(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Nc(t){this.src=t,this.a={},this.b=0}function Ac(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=qu(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Cc(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function kc(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Nc.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=kc(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Ic(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Dc="closure_lm_"+(1e6*Math.random()|0),Rc={};function Oc(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Nu(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Vc(r);return e&&e[Tc]?e.Ba(n,r,ku(i)?!!i.capture:!!i,o):Pc(e,n,r,!0,i,o)}(t,e,n,r,i);if(Nu(e)){for(var o=0;o<e.length;o++)Oc(t,e[o],n,r,i);return null}return n=Vc(n),t&&t[Tc]?t.Aa(e,n,ku(r)?!!r.capture:!!r,i):Pc(t,e,n,!1,r,i)}function Pc(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=ku(i)?!!i.capture:!!i;if(a&&!gc)return null;var s,u,c=Uc(t);if(c||(t[Dc]=c=new Nc(t)),(n=c.add(e,n,r,a,o)).proxy)return n;if(s=Fc,r=u=gc?function(t){return s.call(u.src,u.listener,t)}:function(t){if(!(t=s.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bc||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Mc(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xc(t){if(!Tu(t)&&t&&!t.X){var e=t.src;if(e&&e[Tc])Ac(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mc(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Uc(e))?(Ac(n,t),0==n.b&&(n.src=null,e[Dc]=null)):Cc(t)}}}function Mc(t){return t in Rc?Rc[t]:Rc[t]="on"+t}function Lc(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&xc(t),n.call(r,e)}function Fc(t,e){return!!t.X||(gc?Lc(t,new _c(e,this)):Lc(t,e=new _c(e||Su("window.event"),this)))}function Uc(t){return(t=t[Dc])instanceof Nc?t:null}var qc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vc(e){return"function"==Cu(e)?e:(e[qc]||(e[qc]=function(t){return e.handleEvent(t)}),e[qc])}function Bc(){Uu.call(this),this.c=new Nc(this),(this.J=this).B=null}function jc(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Ac(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Fu(Bc,Uu),Bc.prototype[Tc]=!0,(vu=Bc.prototype).addEventListener=function(t,e,n,r){Oc(this,t,e,n,r)},vu.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Nu(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=ku(i)?!!i.capture:!!i,r=Vc(r),e&&e[Tc]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=kc(a=e.a[n],r,i,o))&&(Cc(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Uc(e))&&(n=e.a[n.toString()],e=-1,n&&(e=kc(n,r,i,o)),(r=-1<e?n[e]:null)&&xc(r))}(this,t,e,n,r)},vu.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Eu(t))t=new wc(t,n);else if(t instanceof wc)t.target=t.target||n;else{var i=t;Zu(t=new wc(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=jc(a,r,!0,t)&&i}if(i=jc(a=t.a=n,r,!0,t)&&i,i=jc(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=jc(a=t.a=e[o],r,!1,t)&&i;return i},vu.G=function(){if(Bc.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Cc(n[r]);delete e.a[t],e.b--}}this.B=null},vu.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},vu.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wc=_u.JSON.stringify;function Kc(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qc(){this.b=this.a=null}Kc.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Hc,Gc=new Kc(function(){return new zc},function(t){t.reset()});function zc(){this.next=this.b=this.a=null}function Yc(t){_u.setTimeout(function(){throw t},0)}function Xc(t,e){var n;Hc||(n=_u.Promise.resolve(void 0),Hc=function(){n.then(Zc)}),Jc||(Hc(),Jc=!0),$c.add(t,e)}Qc.prototype.add=function(t,e){var n=Gc.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zc.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Jc=!(zc.prototype.reset=function(){this.next=this.b=this.a=null}),$c=new Qc;function Zc(){for(var t;r=n=void 0,r=null,(n=$c).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Yc(t)}var e=Gc;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Jc=!1}function th(t,e){Bc.call(this),this.b=t||1,this.a=e||_u,this.f=xu(this.gb,this),this.g=Lu()}function eh(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function nh(t,e,n){if("function"==Cu(t))n&&(t=xu(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=xu(t.handleEvent,t)}return 2147483647<Number(e)?-1:_u.setTimeout(t,e||0)}function rh(t,e,n){Uu.call(this),this.f=null!=n?xu(t,n):t,this.c=e,this.b=xu(this.ab,this),this.a=[]}function ih(t){t.U=nh(t.b,t.c),t.f.apply(null,t.a)}function oh(t){Uu.call(this),this.b=t,this.a={}}Fu(th,Bc),(vu=th.prototype).ba=!1,vu.L=null,vu.gb=function(){if(this.ba){var t=Lu()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(eh(this),this.start()))}},vu.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Lu())},vu.G=function(){th.N.G.call(this),eh(this),delete this.a},Fu(rh,Uu),(vu=rh.prototype).ea=!1,vu.U=null,vu.Ua=function(t){this.a=arguments,this.U?this.ea=!0:ih(this)},vu.G=function(){rh.N.G.call(this),this.U&&(_u.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},vu.ab=function(){this.U=null,this.ea&&(this.ea=!1,ih(this))},Fu(oh,Uu);var ah=[];function sh(t,e,n,r){Nu(n)||(n&&(ah[0]=n.toString()),n=ah);for(var i=0;i<n.length;i++){var o=Oc(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function uh(t){Xu(t.a,function(t,e){this.a.hasOwnProperty(e)&&xc(t)},t),t.a={}}function ch(){}oh.prototype.G=function(){oh.N.G.call(this),uh(this)},oh.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hh=new Bc;function lh(t){wc.call(this,"serverreachability",t)}function fh(t){hh.dispatchEvent(new lh(hh,t))}function ph(t){wc.call(this,"statevent",t)}function dh(t){hh.dispatchEvent(new ph(hh,t))}function yh(t){wc.call(this,"timingevent",t)}function mh(t,e){if("function"!=Cu(t))throw Error("Fn must not be null and must be a function");return _u.setTimeout(function(){t()},e)}Fu(lh,wc),Fu(ph,wc),Fu(yh,wc);var gh={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},vh={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function bh(){}function wh(t){var e;return(e=t.a)||(e=t.a={}),e}function _h(){}bh.prototype.a=null;var Eh,Th={OPEN:"a",ib:"b",Na:"c",rb:"d"};function Sh(){wc.call(this,"d")}function Ih(){wc.call(this,"c")}function Ch(){}function Nh(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new oh(this),this.O=Ah,t=ac?125:void 0,this.P=new th(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Fu(Sh,wc),Fu(Ih,wc),Fu(Ch,bh),Eh=new Ch;var Ah=45e3,kh={},Dh={};function Rh(t,e,n){t.F=1,t.f=rl(Yh(e)),t.l=n,t.H=!0,Ph(t,null)}function Oh(t,e,n,r){t.F=1,t.f=rl(Yh(e)),t.l=null,t.H=n,Ph(t,r)}function Ph(t,e){t.v=Lu(),Lh(t),t.D=Yh(t.f),nl(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new rh(xu(t.Ka,t,t.a),t.J)),sh(t.I,t.a,"readystatechange",t.eb),e=t.h?Ju(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),fh(1)}function xh(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Mh(t,n);if(i==Dh){4==e&&(t.c=4,dh(14),r=!1);break}if(i==kh){t.c=4,dh(15),r=!1;break}Bh(t,i)}4==e&&0==n.length&&(t.c=1,dh(16),r=!1),t.b=t.b&&r,r||(Vh(t),qh(t))}function Mh(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Dh:(n=Number(e.substring(n,r)),isNaN(n)?kh:(r+=1)+n>e.length?Dh:(e=e.substr(r,n),t.A=r+n,e))}function Lh(t){t.R=Lu()+t.O,Fh(t,t.O)}function Fh(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=mh(xu(t.bb,t),e)}function Uh(t){t.i&&(_u.clearTimeout(t.i),t.i=null)}function qh(t){t.g.Da()||t.m||t.g.na(t)}function Vh(t){Uh(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,eh(t.P),uh(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Bh(t,e){try{t.g.Ga(t,e),fh(4)}catch(t){}}function jh(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Au(t)||Eu(t))Vu(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Au(t)||Eu(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Eu(t))return t.split("");if(Au(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Wh(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Wh)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Kh(t,e){Hh(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qh(t))}function Qh(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Hh(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Hh(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Hh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(vu=Nh.prototype).setTimeout=function(t){this.O=t},vu.eb=function(t){t=t.target;var e=this.B;e&&3==Yl(t)?e.Ua():this.Ka(t)},vu.Ka=function(t){try{if(t==this.a)t:{var e=Yl(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ac&&!this.a.aa())){this.m||4!=e||7==n||fh(8==n||r<=0?3:2),Uh(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Xl(this.a,"X-HTTP-Initial-Response");if(a&&!Wu(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,dh(12),Vh(this),qh(this);break t}this.s=!0,Bh(this,s)}this.H?(xh(this,e,o),ac&&this.b&&3==e&&(sh(this.I,this.P,"tick",this.cb),this.P.start())):Bh(this,o),4==e&&Vh(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Lh(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,dh(12)):(this.c=0,dh(13)),Vh(this),qh(this)}}}catch(t){}},vu.cb=function(){if(this.a){var t=Yl(this.a),e=this.a.aa();this.A<e.length&&(Uh(this),xh(this,t,e),this.b&&4!=t&&Lh(this))}},vu.cancel=function(){this.m=!0,Vh(this)},vu.bb=function(){this.i=null;var t=Lu();0<=t-this.R?(2!=this.F&&(fh(3),dh(17)),Vh(this),this.c=2,qh(this)):Fh(this,this.R-t)},(vu=Wh.prototype).C=function(){Qh(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},vu.K=function(){return Qh(this),this.a.concat()},vu.get=function(t,e){return Hh(this.b,t)?this.b[t]:e},vu.set=function(t,e){Hh(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},vu.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Gh=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function zh(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof zh?(this.h=void 0!==e?e:t.h,Xh(this,t.f),this.j=t.j,$h(this,t.b),Zh(this,t.i),this.a=t.a,tl(this,gl(t.c)),this.g=t.g):t&&(n=String(t).match(Gh))?(this.h=!!e,Xh(this,n[1]||"",!0),this.j=il(n[2]||""),$h(this,n[3]||"",!0),Zh(this,n[4]),this.a=il(n[5]||"",!0),tl(this,n[6]||"",!0),this.g=il(n[7]||"")):(this.h=!!e,this.c=new fl(null,this.h))}function Yh(t){return new zh(t)}function Xh(t,e,n){t.f=n?il(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $h(t,e,n){t.b=n?il(e,!0):e}function Zh(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function tl(t,e,n){var r,i;e instanceof fl?(t.c=e,r=t.c,(i=t.h)&&!r.f&&(pl(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dl(this,e),ml(this,n,t))},r)),r.f=i):(n||(e=ol(e,hl)),t.c=new fl(e,t.h))}function el(t,e,n){t.c.set(e,n)}function nl(t,e,n){Nu(n)||(n=[String(n)]),ml(t.c,e,n)}function rl(t){return el(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Lu()).toString(36)),t}function il(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ol(t,e,n){return Eu(t)?(t=encodeURI(t).replace(e,al),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function al(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}zh.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ol(e,sl,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(ol(e,sl,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(ol(n,"/"==n.charAt(0)?cl:ul,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",ol(n,ll)),t.join("")},zh.prototype.resolve=function(t){var e=Yh(this),n=!!t.f;n?Xh(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?$h(e,t.b):n=null!=t.i;var r=t.a;if(n)Zh(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Hu(i,"./")||Hu(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?tl(e,gl(t.c)):n=!!t.g,n&&(e.g=t.g),e};var sl=/[#\/\?@]/g,ul=/[#\?:]/g,cl=/[#\?]/g,hl=/[#\?@]/g,ll=/#/g;function fl(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pl(n){n.a||(n.a=new Wh,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dl(t,e){pl(t),e=vl(t,e),Hh(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Kh(t.a,e))}function yl(t,e){return pl(t),e=vl(t,e),Hh(t.a.b,e)}function ml(t,e,n){dl(t,e),0<n.length&&(t.c=null,t.a.set(vl(t,e),ju(n)),t.b+=n.length)}function gl(t){var e=new fl;return e.c=t.c,t.a&&(e.a=new Wh(t.a),e.b=t.b),e}function vl(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function bl(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function wl(t){var e=t.a.F.a;if(null!=e)dh(4),e?(dh(10),cf(t.a,t,!1)):(dh(11),cf(t.a,t,!0));else{t.b=new Nh(t,void 0,void 0),t.b.h=t.h,e=df(e=t.a,e.Y()?t.f:null,t.i),dh(4),nl(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&el(e,n,r),Oh(t.b,e,!1,t.f)}}function _l(){this.a=this.b=null}function El(){this.a=new Wh}function Tl(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Du]||(t[Du]=++Ru)):e.charAt(0)+t}function Sl(t,e){this.b=t,this.a=e}function Il(t){this.g=t||Cl,t=_u.PerformanceNavigationTiming?0<(t=_u.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(_u.ka&&_u.ka.Ea&&_u.ka.Ea()&&_u.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new El),this.b=null,this.c=[]}(vu=fl.prototype).add=function(t,e){pl(this),this.c=null,t=vl(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},vu.forEach=function(n,r){pl(this),this.a.forEach(function(t,e){Vu(t,function(t){n.call(r,t,e,this)},this)},this)},vu.K=function(){pl(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},vu.C=function(t){pl(this);var e=[];if(Eu(t))yl(this,t)&&(e=Bu(e,this.a.get(vl(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Bu(e,t[n])}return e},vu.set=function(t,e){return pl(this),this.c=null,yl(this,t=vl(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},vu.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},vu.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Fu(function(){},function(){}),(vu=bl.prototype).M=null,vu.$=function(t){return this.a.$(t)},vu.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},vu.Da=function(){return!1},vu.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Xl(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Xl(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void ff(e,2)}this.f=r[0]}else(e=this.a).m=this.c,ff(e,2)}else 1==this.M&&(this.g?dh(6):"11111"==e?(dh(5),this.g=!0,(!ic||10<=Number(pc))&&(this.c=200,this.b.cancel(),dh(11),cf(this.a,this,!0))):(dh(7),this.g=!1))},vu.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,wl(this)):1==this.M&&(this.g?(dh(11),cf(this.a,this,!0)):(dh(10),cf(this.a,this,!1)));else{0==this.M?dh(8):1==this.M&&dh(9);var t=this.a;t.m=this.c,ff(t,2)}},vu.Y=function(){return this.a.Y()},vu.ma=function(){return this.a.ma()},El.prototype.add=function(t){this.a.set(Tl(t),t)},El.prototype.C=function(){return this.a.C()};var Cl=10;function Nl(t,e){!t.a&&(Hu(e,"spdy")||Hu(e,"quic")||Hu(e,"h2"))&&(t.f=t.g,t.a=new El,t.b&&(Rl(t,t.b),t.b=null))}function Al(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function kl(t){return t.b?1:t.a?t.a.a.c:0}function Dl(t,e){return t=t.b?t.b==e:!!t.a&&(e=Tl(e),Hh(t.a.a.b,e))}function Rl(t,e){t.a?t.a.add(e):t.b=e}function Ol(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Tl(e),n=Hh(t.a.a.b,n)),n&&Kh(t.a.a,Tl(e)))}function Pl(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return ju(t.c);var e=t.c;return Vu(t.a.C(),function(t){e=e.concat(t.j)}),e}function xl(){}function Ml(){this.a=new xl}function Ll(t,r,e){var i=e||"";try{jh(t,function(t,e){var n=t;ku(t)&&(n=Wc(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Fl(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Il.prototype.cancel=function(){var t;this.c=Pl(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Vu(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},xl.prototype.stringify=function(t){return _u.JSON.stringify(t,void 0)},xl.prototype.parse=function(t){return _u.JSON.parse(t,void 0)};var Ul=_u.JSON.parse;function ql(t){Bc.call(this),this.headers=new Wh,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Vl,this.D=this.F=!1}Fu(ql,Bc);var Vl="",Bl=/^https?$/i,jl=["POST","PUT"];function Wl(t){return"content-type"==t.toLowerCase()}function Kl(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Ql(t),Gl(t)}function Ql(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Hl(t){if(t.b&&void 0!==wu&&(!t.s[1]||4!=Yl(t)||2!=t.T()))if(t.l&&4==Yl(t))nh(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Yl(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Gh)[1]||null;if(!o&&_u.self&&_u.self.location){var a=_u.self.location.protocol;o=a.substr(0,a.length-1)}i=!Bl.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Ql(t))}finally{Gl(t)}}}function Gl(t,e){if(t.a){zl(t);var n=t.a,r=t.s[0]?Iu:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function zl(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(_u.clearTimeout(t.m),t.m=null)}function Yl(t){return t.a?t.a.readyState:0}function Xl(t,e){return t.a?t.a.getResponseHeader(e):null}function Jl(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;var i;if(i="",Xu(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,Eu(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var o=""}else o=t.substring(r+1,n);n=(t=[t.substr(0,r),o,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return el(t,e,n),t}function $l(t){this.f=[],this.F=new _l,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!Su("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=Su("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=Su("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=Su("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=Su("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Il(t&&t.concurrentRequestLimit),this.ja=new Ml,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Zl(t){if(tf(t),3==t.u){var e=t.P++,n=Yh(t.B);el(n,"SID",t.H),el(n,"RID",e),el(n,"TYPE","terminate"),of(t,n),(e=new Nh(t,e,void 0)).F=2,e.f=rl(Yh(n)),n=!1,_u.navigator&&_u.navigator.sendBeacon&&(n=_u.navigator.sendBeacon(e.f.toString(),"")),!n&&_u.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Lu(),Lh(e)}pf(t)}function tf(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(_u.clearTimeout(t.l),t.l=null),hf(t),t.b.cancel(),t.h&&(Tu(t.h)&&_u.clearTimeout(t.h),t.h=null)}function ef(t,e){t.f.push(new Sl(t.Ra++,e)),3==t.u&&nf(t)}function nf(t){Al(t.b)||t.h||(t.h=!0,Xc(t.Ia,t),t.A=0)}function rf(t,e){var n;n=e?e.W:t.P++;var r=Yh(t.B);el(r,"SID",t.H),el(r,"RID",n),el(r,"AID",t.O),of(t,r),t.g&&t.i&&Jl(r,t.g,t.i),n=new Nh(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=af(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Rl(t.b,n),Rh(n,r,e)}function of(t,n){t.c&&jh({},function(t,e){el(n,e,t)})}function af(t,e,n){n=Math.min(t.f.length,n);var r=t.c?xu(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Ll(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function sf(t){t.a||t.l||(t.S=1,Xc(t.Ha,t),t.v=0)}function uf(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=mh(xu(t.Ha,t),lf(t,t.v)),t.v++,!0)}function cf(t,e,n){var r=e.l;r&&Nl(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=df(t,null,t.ha),nf(t)}function hf(t){null!=t.s&&(_u.clearTimeout(t.s),t.s=null)}function lf(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function ff(t,e){if(2==e){var n=null;t.c&&(n=null);var r=xu(t.fb,t);n||(n=new zh("//www.google.com/images/cleardot.gif"),_u.location&&"http"==_u.location.protocol||Xh(n,"https"),rl(n)),function(t,e){var n=new ch;if(_u.Image){var r=new Image;r.onload=Mu(Fl,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Mu(Fl,n,r,"TestLoadImage: error",!1,e),r.onabort=Mu(Fl,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Mu(Fl,n,r,"TestLoadImage: timeout",!1,e),_u.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else dh(2);t.u=0,t.c&&t.c.ta(e),pf(t),tf(t)}function pf(t){t.u=0,t.m=-1,t.c&&(0==Pl(t.b).length&&0==t.f.length||(t.b.c.length=0,ju(t.f),t.f.length=0),t.c.sa())}function df(t,e,n){var r,i,o,a,s,u,c=(r=n)instanceof zh?Yh(r):new zh(r,void 0);if(""!=c.b)e&&$h(c,e+"."+c.b),Zh(c,c.i);else{var h,l=_u.location;h=e?e+"."+l.hostname:l.hostname,i=l.protocol,o=h,a=+l.port,s=n,u=new zh(null,void 0),i&&Xh(u,i),o&&$h(u,o),a&&Zh(u,a),s&&(u.a=s),c=u}return t.V&&Xu(t.V,function(t,e){el(c,e,t)}),e=t.j,n=t.I,e&&n&&el(c,e,n),el(c,"VER",t.wa),of(t,c),c}function yf(){}function mf(){if(ic&&!(10<=Number(pc)))throw Error("Environmental error: no available transport.")}function gf(t,e){Bc.call(this),this.a=new $l(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Wu(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Wu(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new wf(this)}function vf(t){Sh.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function bf(){Ih.call(this),this.status=1}function wf(t){this.a=t}(vu=ql.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?wh(this.H):wh(Eh),this.a.onreadystatechange=xu(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Kl(this,t)}t=n||"";var i,o=new Wh(this.headers);r&&jh(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Wl,n=t.length,r=Eu(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Eu(t)?t.charAt(e):t[e]}(o.K()),n=_u.FormData&&t instanceof _u.FormData,!(0<=qu(jl,e))||r||n||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{zl(this),0<this.o&&((this.D=(i=this.a,ic&&yc(9)&&Tu(i.timeout)&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=xu(this.Ca,this)):this.m=nh(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Kl(this,t)}},vu.Ca=function(){void 0!==wu&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},vu.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Gl(this))},vu.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Gl(this,!0)),ql.N.G.call(this)},vu.Fa=function(){this.j||(this.w||this.l||this.g?Hl(this):this.$a())},vu.$a=function(){Hl(this)},vu.T=function(){try{return 2<Yl(this)?this.a.status:-1}catch(t){return-1}},vu.za=function(){try{return 2<Yl(this)?this.a.statusText:""}catch(t){return""}},vu.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},vu.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ul(e)}},vu.ya=function(){return this.h},vu.Ya=function(){return Eu(this.f)?this.f:String(this.f)},(vu=$l.prototype).wa=8,vu.u=1,vu.Da=function(){return 0==this.u},vu.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Nh(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?Zu(r=Ju(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Eu(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=af(this,n,e),el(i=Yh(this.B),"RID",t),el(i,"CVER",22),this.o&&this.j&&el(i,"X-HTTP-Session-Id",this.j),of(this,i),this.g&&r&&Jl(i,this.g,r),Rl(this.b,n),this.W?(el(i,"$req",e),el(i,"SID","null"),n.S=!0,Rh(n,i,null)):Rh(n,i,e),this.u=2}}else 3==this.u&&(t?rf(this,t):0==this.f.length||Al(this.b)||rf(this))},vu.Ha=function(){this.l=null,this.a=new Nh(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Yh(this.pa);el(t,"RID","rpc"),el(t,"SID",this.H),el(t,"CI",this.ia?"0":"1"),el(t,"AID",this.O),of(this,t),el(t,"TYPE","xmlhttp"),this.g&&this.i&&Jl(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Oh(this.a,t,!0,this.ga)},vu.Ga=function(t,e){if(0!=this.u&&(this.a==t||Dl(this.b,t)))if(this.m=t.o,!t.s&&Dl(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Nu(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;hf(this),this.a.cancel(),this.a=null}uf(this),dh(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=mh(xu(this.Za,this),6e3));if(kl(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else ff(this,11)}else if((t.s||this.a==t)&&hf(this),!Wu(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Tu(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Xl(r,"X-Client-Wire-Protocol"))&&Nl(this.b,i),this.j&&(r=Xl(r,"X-HTTP-Session-Id")))&&(this.I=r,el(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=df(this,this.Y()?this.ga:null,this.ha),r.s?(Ol(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Uh(r),Lh(r)),this.a=r):sf(this),0<this.f.length&&nf(this)}else"stop"!=r[0]&&"close"!=r[0]||ff(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?ff(this,7):Zl(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},vu.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,uf(this),dh(19))},vu.na=function(t){var e,n,r=null;if(this.a==t){hf(this),this.a=null;var i=2}else{if(!Dl(this.b,t))return;r=t.j,Ol(this.b,t),i=1}if(this.m=t.o,0!=this.u)if(t.b)1==i?(r=Lu()-t.v,hh.dispatchEvent(new yh(hh,t.l?t.l.length:0,r,this.A)),nf(this)):sf(this);else{var o=t.c;if(3==o||0==o&&0<this.m||(1!=i||(n=t,kl((e=this).b)>=e.b.f-(e.h?1:0)||(e.h?(e.f=n.j.concat(e.f),0):1==e.u||2==e.u||e.A>=(e.Pa?0:e.Qa)||(e.h=mh(xu(e.Ia,e,n),lf(e,e.A)),e.A++,0))))&&(2!=i||!uf(this)))switch(r&&0<r.length&&(t=this.b,t.c=t.c.concat(r)),o){case 1:ff(this,5);break;case 4:ff(this,10);break;case 3:ff(this,6);break;default:ff(this,2)}}},vu.fb=function(t){dh(t?2:1)},vu.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new ql(this.La)).F=this.R,t},vu.ma=function(){return!!this.c&&!0},vu.Y=function(){return this.R},(vu=yf.prototype).va=function(){},vu.ua=function(){},vu.ta=function(){},vu.sa=function(){},vu.Ta=function(){},mf.prototype.a=function(t,e){return new gf(t,e)},Fu(gf,Bc),(vu=gf.prototype).addEventListener=function(t,e,n,r){gf.N.addEventListener.call(this,t,e,n,r)},vu.removeEventListener=function(t,e,n,r){gf.N.removeEventListener.call(this,t,e,n,r)},vu.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;dh(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new bl(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Jl(e,t.g,t.i)),(t=t.w).i=n,e=df(t.a,null,t.i),dh(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,wl(t)):(nl(e,"MODE","init"),!t.a.o&&t.a.j&&nl(e,"X-HTTP-Session-Id",t.a.j),t.b=new Nh(t,void 0,void 0),t.b.h=t.h,Oh(t.b,e,!1,null),t.M=0)},vu.close=function(){Zl(this.a)},vu.Xa=function(t){if(Eu(t)){var e={};e.__data__=t,ef(this.a,e)}else this.h?((e={}).__data__=Wc(t),ef(this.a,e)):ef(this.a,t)},vu.G=function(){this.a.c=null,delete this.f,Zl(this.a),delete this.a,gf.N.G.call(this)},Fu(vf,Sh),Fu(bf,Ih),Fu(wf,yf),wf.prototype.va=function(){this.a.dispatchEvent("a")},wf.prototype.ua=function(t){this.a.dispatchEvent(new vf(t))},wf.prototype.ta=function(t){this.a.dispatchEvent(new bf(t))},wf.prototype.sa=function(){this.a.dispatchEvent("b")};var _f=Mu(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},mf);mf.prototype.createWebChannel=mf.prototype.a,gf.prototype.send=gf.prototype.Xa,gf.prototype.open=gf.prototype.Wa,gf.prototype.close=gf.prototype.close,gh.NO_ERROR=0,gh.TIMEOUT=8,gh.HTTP_ERROR=6,vh.COMPLETE="complete",(_h.EventType=Th).OPEN="a",Th.CLOSE="b",Th.ERROR="c",Th.MESSAGE="d",Bc.prototype.listen=Bc.prototype.Aa,ql.prototype.listenOnce=ql.prototype.Ba,ql.prototype.getLastError=ql.prototype.Ya,ql.prototype.getLastErrorCode=ql.prototype.ya,ql.prototype.getStatus=ql.prototype.T,ql.prototype.getStatusText=ql.prototype.za,ql.prototype.getResponseJson=ql.prototype.Va,ql.prototype.getResponseText=ql.prototype.aa,ql.prototype.send=ql.prototype.ca;var Ef,Tf,Sf={createWebChannelTransport:_f,ErrorCode:gh,EventType:vh,WebChannel:_h,XhrIo:ql},If=Sf.createWebChannelTransport,Cf=Sf.ErrorCode,Nf=Sf.EventType,Af=Sf.WebChannel,kf=Sf.XhrIo,Df=Jh.SDK_VERSION,Rf=new zi("@firebase/firestore");function Of(){return Rf.logLevel===ji.DEBUG?Ef.DEBUG:Rf.logLevel===ji.SILENT?Ef.SILENT:Ef.ERROR}function Pf(t){switch(t){case Ef.DEBUG:Rf.logLevel=ji.DEBUG;break;case Ef.ERROR:Rf.logLevel=ji.ERROR;break;case Ef.SILENT:Rf.logLevel=ji.SILENT;break;default:Rf.error("Firestore ("+Df+"): Invalid value passed to `setLogLevel`")}}function xf(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Rf.logLevel<=ji.DEBUG){var i=n.map(Lf);Rf.debug.apply(Rf,["Firestore ("+Df+") ["+t+"]: "+e].concat(i))}}function Mf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Rf.logLevel<=ji.ERROR){var r=e.map(Lf);Rf.error.apply(Rf,["Firestore ("+Df+"): "+t].concat(r))}}function Lf(e){if("string"==typeof e)return e;var t=qf.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Ff(t){var e="FIRESTORE ("+Df+") INTERNAL ASSERTION FAILED: "+t;throw Mf(e),new Error(e)}function Uf(t,e){t||Ff(e)}(Tf=Ef||(Ef={}))[Tf.DEBUG=0]="DEBUG",Tf[Tf.ERROR=1]="ERROR",Tf[Tf.SILENT=2]="SILENT";var qf=function(){function e(){}return e.setPlatform=function(t){e.platform&&Ff("Platform already defined"),e.platform=t},e.getPlatform=function(){return e.platform||Ff("Platform not set"),e.platform},e}();function Vf(){return qf.getPlatform().emptyByteString}var Bf={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jf=function(r){function t(t,e){var n=r.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}return ii(t,r),t}(Error);function Wf(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new jf(Bf.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Kf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Qf(t,e){return void 0!==t?t:e}function Hf(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Gf(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zf(t){for(var e in Uf(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Yf(t,e){if(0!==e.length)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+fp(e.length,"argument")+".")}function Xf(t,e,n){if(e.length!==n)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires "+fp(n,"argument")+", but was called with "+fp(e.length,"argument")+".")}function Jf(t,e,n){if(e.length<n)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires at least "+fp(n,"argument")+", but was called with "+fp(e.length,"argument")+".")}function $f(t,e,n,r){if(e.length<n||e.length>r)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+fp(e.length,"argument")+".")}function Zf(t,e,n,r){op(t,e,lp(n)+" argument",r)}function tp(t,e,n,r){void 0!==r&&Zf(t,e,n,r)}function ep(t,e,n,r){op(t,e,n+" option",r)}function np(t,e,n,r){void 0!==r&&ep(t,e,n,r)}function rp(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+sp(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+sp(r[o]))}(t,e,n,r,i)}function ip(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(sp(u))}var c=sp(r);throw new jf(Bf.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function op(t,e,n,r){if(!("object"===e?ap(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=sp(r);throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ap(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function sp(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Ff("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function up(t,e,n){if(void 0===n)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+lp(e)+" argument, but it was undefined.")}function cp(n,t,r){Gf(t,function(t,e){if(r.indexOf(t)<0)throw new jf(Bf.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function hp(t,e,n,r){var i=sp(r);return new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires its "+lp(n)+" argument to be a "+e+", but it was: "+i)}function lp(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function fp(t,e){return t+" "+e+(1===t?"":"s")}var pp=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Uf(20===e.length,"Invalid auto ID: "+e),e},t}();function dp(t,e){return t<e?-1:e<t?1:0}function yp(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function mp(t){return t+"\0"}function gp(){if("undefined"==typeof Uint8Array)throw new jf(Bf.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function vp(){if(!qf.getPlatform().base64Available)throw new jf(Bf.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var bp,wp,_p=function(){function e(t){vp(),this._binaryString=t}return e.fromBase64String=function(t){Xf("Blob.fromBase64String",arguments,1),Zf("Blob.fromBase64String","string",1,t),vp();try{return new e(qf.getPlatform().atob(t))}catch(t){throw new jf(Bf.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},e.fromUint8Array=function(t){if(Xf("Blob.fromUint8Array",arguments,1),gp(),!(t instanceof Uint8Array))throw hp("Blob.fromUint8Array","Uint8Array",1,t);return new e(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},e.prototype.toBase64=function(){return Xf("Blob.toBase64",arguments,0),vp(),qf.getPlatform().btoa(this._binaryString)},e.prototype.toUint8Array=function(){Xf("Blob.toUint8Array",arguments,0),gp();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._binaryString===t._binaryString},e.prototype._compareTo=function(t){return dp(this._binaryString,t._binaryString)},e}(),Ep=Wf(_p,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Tp=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Sp="(default)",Ip=function(){function e(t,e){this.projectId=t,this.database=e||Sp}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database===Sp},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e.prototype.compareTo=function(t){return dp(this.projectId,t.projectId)||dp(this.database,t.database)},e}(),Cp=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Np="__name__",Ap=function(){function n(t,e,n){this.init(t,e,n)}return n.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Ff("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Ff("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},n.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(n.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),n.prototype.isEqual=function(t){return 0===n.comparator(this,t)},n.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(function(t){e.push(t)}):"string"==typeof t?e.push(t):Ff("Unknown parameter type for Path.child(): "+t),this.construct(e)},n.prototype.limit=function(){return this.offset+this.length},n.prototype.popFirst=function(t){return t=void 0===t?1:t,Uf(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},n.prototype.popLast=function(){return Uf(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},n.prototype.firstSegment=function(){return Uf(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},n.prototype.lastSegment=function(){return this.get(this.length-1)},n.prototype.get=function(t){return Uf(t<this.length,"Index out of range"),this.segments[this.offset+t]},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},n.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},n.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},n}(),kp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(0<=t.indexOf("//"))throw new jf(Bf.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return 0<t.length}))},e.EMPTY_PATH=new e([]),e}(Ap),Dp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Rp=function(t){function u(){return null!==t&&t.apply(this,arguments)||this}return ii(u,t),u.isValidIdentifier=function(t){return Dp.test(t)},u.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),u.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},u.prototype.toString=function(){return this.canonicalString()},u.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Np},u.keyField=function(){return new u([Np])},u.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new jf(Bf.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new jf(Bf.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new jf(Bf.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new jf(Bf.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new u(e)},u.EMPTY_PATH=new u([]),u}(Ap),Op=function(){function e(t){this.path=t,Uf(e.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}return e.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===kp.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,e){return kp.comparator(t.path,e.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new kp(t.slice()))},e.fromPathString=function(t){return new e(kp.fromString(t))},e.EMPTY=new e(new kp([])),e}(),Pp=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(wp=bp||(bp={})).All="all",wp.ListenStreamIdle="listen_stream_idle",wp.ListenStreamConnectionBackoff="listen_stream_connection_backoff",wp.WriteStreamIdle="write_stream_idle",wp.WriteStreamConnectionBackoff="write_stream_connection_backoff",wp.OnlineStateTimeout="online_state_timeout",wp.ClientMetadataRefresh="client_metadata_refresh",wp.LruGarbageCollection="lru_garbage_collection";var xp=function(){function a(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Pp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return a.createAndSchedule=function(t,e,n,r,i){var o=new a(t,e,Date.now()+n,r,i);return o.start(n),o},a.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},a.prototype.skipDelay=function(){return this.handleDelayElapsed()},a.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jf(Bf.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},a.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},a.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},a}(),Mp=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var n=this;this.verifyNotFailed();var e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Mf("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Uf(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Uf(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=xp.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Ff("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Uf(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Uf(r===bp.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==bp.All&&n.timerId===r)break}return i.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Uf(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Lp="",Fp="",Up="",qp="";function Vp(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=jp(e)),e=Bp(t.get(n),e);return jp(e)}function Bp(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Lp+Up;break;case Lp:n+=Lp+qp;break;default:n+=o}}return n}function jp(t){return t+Lp+Fp}function Wp(t){var e=t.length;if(Uf(2<=e,"Invalid path "+t),2===e)return Uf(t.charAt(0)===Lp&&t.charAt(1)===Fp,"Non-empty path "+t+" had length 2"),kp.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Lp,o);switch((a<0||n<a)&&Ff('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Fp:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Up:i+=t.substring(o,a),i+="\0";break;case qp:i+=t.substring(o,a+1);break;default:Ff('Invalid encoded resource path: "'+t+'"')}o=a+2}return new kp(r)}var Kp=function(){function n(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new jf(Bf.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new jf(Bf.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jf(Bf.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new jf(Bf.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return n.now=function(){return n.fromMillis(Date.now())},n.fromDate=function(t){return n.fromMillis(t.getTime())},n.fromMillis=function(t){var e=Math.floor(t/1e3);return new n(e,1e6*(t-1e3*e))},n.prototype.toDate=function(){return new Date(this.toMillis())},n.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},n.prototype._compareTo=function(t){return this.seconds===t.seconds?dp(this.nanoseconds,t.nanoseconds):dp(this.seconds,t.seconds)},n.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},n.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},n}(),Qp=function(){function n(t){this.timestamp=t}return n.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new n(new Kp(e,t%1e6*1e3))},n.fromTimestamp=function(t){return new n(t)},n.forDeletedDoc=function(){return n.MIN},n.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},n.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},n.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},n.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},n.prototype.toTimestamp=function(){return this.timestamp},n.MIN=new n(new Kp(0,0)),n}(),Hp=function(){function n(t,e){this.comparator=t,this.root=e||zp.EMPTY}return n.prototype.insert=function(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,zp.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,zp.BLACK,null,null))},n.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},n.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},n.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(n.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),n.prototype.minKey=function(){return this.root.minKey()},n.prototype.maxKey=function(){return this.root.maxKey()},n.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},n.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},n.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},n.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},n.prototype.getIterator=function(){return new Gp(this.root,null,this.comparator,!1)},n.prototype.getIteratorFrom=function(t){return new Gp(this.root,t,this.comparator,!1)},n.prototype.getReverseIterator=function(){return new Gp(this.root,null,this.comparator,!0)},n.prototype.getReverseIteratorFrom=function(t){return new Gp(this.root,t,this.comparator,!0)},n}(),Gp=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Uf(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return 0<this.nodeStack.length},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),zp=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:o.EMPTY,this.right=null!=i?i:o.EMPTY,this.size=this.left.size+1+this.right.size}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},o.prototype.minKey=function(){return this.min().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},o.prototype.removeMin=function(){if(this.left.isEmpty())return o.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},o.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return o.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},o.prototype.isRed=function(){return this.color},o.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},o.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},o.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},o.prototype.rotateLeft=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},o.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Ff("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Ff("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Ff("Black depths differ");return t+(this.isRed()?0:1)},o.EMPTY=null,o.RED=!0,o.BLACK=!1,o}(),Yp=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new zp(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();zp.EMPTY=new Yp;var Xp=function(){function o(t){this.comparator=t,this.data=new Hp(this.comparator)}return o.fromMapKeys=function(t){var e=new o(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},o.prototype.has=function(t){return null!==this.data.get(t)},o.prototype.first=function(){return this.data.minKey()},o.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(o.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),o.prototype.indexOf=function(t){return this.data.indexOf(t)},o.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},o.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},o.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},o.prototype.getIterator=function(){return new Jp(this.data.getIterator())},o.prototype.getIteratorFrom=function(t){return new Jp(this.data.getIteratorFrom(t))},o.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},o.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},o.prototype.isEmpty=function(){return this.data.isEmpty()},o.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},o.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},o.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},o.prototype.copy=function(t){var e=new o(this.comparator);return e.data=t,e},o}(),Jp=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),$p=new Hp(Op.comparator);function Zp(){return $p}function td(){return Zp()}var ed=new Hp(Op.comparator);function nd(){return ed}var rd=new Hp(Op.comparator);function id(){return rd}var od=new Xp(Op.comparator);function ad(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=od,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var sd=new Xp(dp);function ud(){return sd}var cd=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Uf(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Uf(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Uf(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Uf(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ad())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&yp(this.mutations,t.mutations)&&yp(this.baseMutations,t.baseMutations)},t}(),hd=function(){function s(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return s.from=function(t,e,n,r){Uf(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=id(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new s(t,e,n,r,i)},s}(),ld=function(){function a(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return a.prototype.catch=function(t){return this.next(void 0,t)},a.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Ff("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new a(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},a.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},a.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof a?e:a.resolve(e)}catch(t){return a.reject(t)}},a.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):a.resolve(e)},a.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):a.reject(e)},a.resolve=function(n){return new a(function(t,e){t(n)})},a.reject=function(n){return new a(function(t,e){e(n)})},a.waitFor=function(t){return new a(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},a.or=function(t){for(var n=a.resolve(!1),e=function(e){n=n.next(function(t){return t?a.resolve(t):e()})},r=0,i=t;r<i.length;r++){e(i[r])}return n},a.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},a}(),fd=function(){function i(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return i.forUser=function(t,e,n,r){return Uf(""!==t.uid,"UserID must not be an empty string."),new i(t.isAuthenticated()?t.uid:"",e,n,r)},i.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return md(t).iterate({index:ny.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},i.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=yd(n),vd(e).put(t)})},i.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},i.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=yd(n),vd(e).put(t)})},i.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=gd(u),d=md(u);return d.add({}).next(function(t){Uf("number"==typeof t,"Auto-generated key is not a number");var e=new cd(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=ry.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,ry.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return ld.waitFor(r).next(function(){return e})})},i.prototype.lookupMutationBatch=function(t,e){var n=this;return md(t).get(e).next(function(t){return t?(Uf(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},i.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?ld.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},i.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return md(t).iterate({index:ny.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Uf(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},i.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return md(t).loadAll(ny.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},i.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=ry.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return gd(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Wp(i);if(r===c.userId&&u.path.isEqual(a))return md(s).get(o).next(function(t){if(!t)throw Ff("Dangling document-mutation reference found: "+e+" which points to "+o);Uf(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},i.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new Xp(dp),i=[];return t.forEach(function(s){var t=ry.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=gd(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Wp(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),ld.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},i.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Uf(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Uf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=ry.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new Xp(dp);return gd(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Wp(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},i.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(md(t).get(e).next(function(t){if(null===t)throw Ff("Dangling document-mutation reference found, which points to "+e);Uf(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),ld.waitFor(i).next(function(){return r})},i.prototype.removeMutationBatch=function(e,n){var r=this;return dd(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),ld.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},i.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},i.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return ld.resolve();var e=IDBKeyRange.lowerBound(ry.prefixForUser(o.userId)),i=[];return gd(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Wp(t[1]);i.push(r)}else n.done()}).next(function(){Uf(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},i.prototype.containsKey=function(t,e){return pd(t,this.userId,e)},i.prototype.getMutationQueueMetadata=function(t){var e=this;return vd(t).get(this.userId).next(function(t){return t||new ey(e.userId,-1,"")})},i}();function pd(t,o,e){var n=ry.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return gd(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function dd(t,e,n){var r=t.store(ny.store),i=t.store(ry.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Uf(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=ry.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return ld.waitFor(o).next(function(){return c})}function yd(t){return t instanceof Uint8Array?(Uf("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function md(t){return Oy.getStore(t,ny.store)}function gd(t){return Oy.getStore(t,ry.store)}function vd(t){return Oy.getStore(t,ey.store)}var bd,wd;(wd=bd||(bd={}))[wd.QueryCache=0]="QueryCache",wd[wd.SyncEngine=1]="SyncEngine";var _d=function(){function t(t,e){Uf((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},t.prototype.after=function(t){return this.seek(t+2),this.next()},t.prototype.seek=function(t){Uf((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(bd.QueryCache,2)},t.forSyncEngine=function(){return new t(bd.SyncEngine)},t}(),Ed="SimpleDb",Td=function(){function s(t){this.db=t,12.2===s.getIOSVersion(wi())&&Mf("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return s.openOrCreate=function(o,t,a){return Uf(s.isAvailable(),"IndexedDB not supported in current environment."),xf(Ed,"Opening database:",o),new ld(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new s(e))},i.onblocked=function(){r(new jf(Bf.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new jf(Bf.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){xf(Ed,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new Id(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,Jd).next(function(){xf(Ed,"Database upgrade to version "+Jd+" complete")})}}).toPromise()},s.delete=function(t){return xf(Ed,"Removing database:",t),Nd(window.indexedDB.deleteDatabase(t)).toPromise()},s.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=wi(),e=s.getIOSVersion(t),n=0<e&&e<10,r=s.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},s.getStore=function(t,e){return t.store(e)},s.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},s.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},s.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},s.prototype.runTransaction=function(t,e,n){var r=Id.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),ld.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},s.prototype.close=function(){this.db.close()},s}(),Sd=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return Nd(this.dbCursor.delete())},t}(),Id=function(){function r(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Pp,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=kd(t.target.error);n.completionDeferred.reject(e)}}return r.open=function(t,e,n){return new r(t.transaction(n,e))},Object.defineProperty(r.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),r.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(xf(Ed,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},r.prototype.store=function(t){var e=this.transaction.objectStore(t);return Uf(!!e,"Object store not part of transaction: "+t),new Cd(e)},r}(),Cd=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){return Nd(void 0!==e?(xf(Ed,"PUT",this.store.name,t,e),this.store.put(e,t)):(xf(Ed,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},t.prototype.add=function(t){return xf(Ed,"ADD",this.store.name,t,t),Nd(this.store.add(t))},t.prototype.get=function(e){var n=this;return Nd(this.store.get(e)).next(function(t){return void 0===t&&(t=null),xf(Ed,"GET",n.store.name,e,t),t})},t.prototype.delete=function(t){return xf(Ed,"DELETE",this.store.name,t),Nd(this.store.delete(t))},t.prototype.count=function(){return xf(Ed,"COUNT",this.store.name),Nd(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){xf(Ed,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(i){var t=this.cursor({});return new ld(function(n,r){t.onerror=function(t){var e=kd(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,a){var s=[];return new ld(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Sd(e),r=a(e.primaryKey,e.value,n);if(r instanceof ld){var i=r.catch(function(t){return n.done(),ld.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return ld.waitFor(s)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Uf(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Nd(t){return new ld(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=kd(t.target.error);r(e)}})}var Ad=!1;function kd(t){var e=Td.getIOSVersion(wi());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new jf("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ad||(Ad=!0,setTimeout(function(){throw r},0)),r}}return t}var Dd=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=_d.forQueryCache()}return t.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Qp.fromTimestamp(new Kp(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Pd(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},t.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Rd(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Uf(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},t.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return Rd(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return ld.waitFor(u)}).next(function(){return s})},t.prototype.forEachTarget=function(t,r){var i=this;return Rd(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},t.prototype.retrieveMetadata=function(t){return Od(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Oy.getStore(n,hy.store)).put(hy.key,e);var n},t.prototype.saveQueryData=function(t,e){return Rd(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return Rd(t).iterate({range:n,index:uy.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},t.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=xd(n);return t.forEach(function(t){var e=Vp(t.path);o.push(a.put(new cy(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),ld.waitFor(o)},t.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=xd(n);return ld.forEach(t,function(t){var e=Vp(t.path);return ld.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=xd(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=xd(t),o=ad();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Wp(t[1]),i=new Op(r);o=o.add(i)}).next(function(){return o})},t.prototype.containsKey=function(t,e){var n=Vp(e.path),r=IDBKeyRange.bound([n],[mp(n)],!1,!0),i=0;return xd(t).iterate({index:cy.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return 0<i})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return Rd(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function Rd(t){return Oy.getStore(t,uy.store)}function Od(t){return Td.getStore(t,hy.store).get(hy.key).next(function(t){return Uf(null!==t,"Missing metadata row."),t})}function Pd(t){return Od(t).next(function(t){return t.highestListenSequenceNumber})}function xd(t){return Oy.getStore(t,cy.store)}var Md=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return Op.comparator(t.key,e.key)},t}(),Ld=function(a){function e(t,e,n,r,i){var o=a.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}return ii(e,a),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Ff("Trying to compare documents on fields that don't exist")},e}(Md),Fd=function(i){function e(t,e,n){var r=i.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}return ii(e,i),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Md),Ud=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Md),qd=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(s){Gf(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},t.prototype.isEmpty=function(){return zf(this.inner)},t}(),Vd=function(){function t(){this.changes=Zp(),this.documentSizes=new qd(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?ld.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Uf(null!==this.changes,"Changes have already been applied."),this.changes},t}(),Bd="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",jd=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=Td.getStore(t,py.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=Qd(t),o=ad(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Gd(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Hd(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return ld.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=Qd(t),r=Gd(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return zd(t)}):ld.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return Qd(t).get(Gd(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return Qd(t).get(Gd(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:zd(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=td();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=td(),i=new Hp(Op.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,zd(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return ld.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return Qd(t).iterate({range:n},function(t,e,n){for(var r=Op.fromSegments(t);a&&Op.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;Uf(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=nd(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return Qd(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Ld&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},t.prototype.getNewDocumentChanges=function(e){var r=this;Uf(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=ad(),i=Zp(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Hd(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return ld.reject(new jf(Bf.DATA_LOSS,Bd))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new Fd(n,Qp.forDeletedDoc());i=i.insert(n,e)}))}),ld.waitFor(t)}).next(function(){return i})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Hd(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},t.prototype.newChangeBuffer=function(){return new Kd(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Wd(t).get(sy.key).next(function(t){return Uf(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return Wd(t).put(sy.key,e)},t.prototype.updateSize=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},t}();function Wd(t){return Oy.getStore(t,sy.store)}var Kd=function(n){function t(t){var e=n.call(this)||this;return e.documentCache=t,e}return ii(t,n),t.prototype.applyChanges=function(t){var o=this,e=this.assertChanges(),a=0,s=[];return e.forEach(function(t,e){var n=o.documentCache.serializer.toDbRemoteDocument(e),r=o.documentSizes.get(t);Uf(void 0!==r,"Attempting to change document "+t.toString()+" without having read it first");var i=zd(n);a+=i-r,s.push({key:t,doc:n})}),this.documentCache.addEntries(t,s,a)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(Vd);function Qd(t){return Oy.getStore(t,ay.store)}function Hd(t){return Oy.getStore(t,py.store)}function Gd(t){return t.path.toArray()}function zd(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ff("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Yd=function(){function t(){this.collectionParentIndex=new Xd}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),ld.resolve()},t.prototype.getCollectionParents=function(t,e){return ld.resolve(this.collectionParentIndex.getEntries(e))},t}(),Xd=function(){function t(){this.index={}}return t.prototype.add=function(t){Uf(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Xp(kp.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new Xp(kp.comparator)).toArray()},t}(),Jd=8,$d=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,n,e,r){var i,o=this;Uf(e<r&&0<=e&&r<=Jd,"Unexpected schema upgrade from v"+e+" to v{toVersion}."),e<1&&1<=r&&(t.createObjectStore(ty.store),(i=t).createObjectStore(ey.store,{keyPath:ey.keyPath}),i.createObjectStore(ny.store,{keyPath:ny.keyPath,autoIncrement:!0}).createIndex(ny.userMutationsIndex,ny.userMutationsKeyPath,{unique:!0}),i.createObjectStore(ry.store),fy(t),t.createObjectStore(ay.store));var a,s=ld.resolve();return e<3&&3<=r&&(0!==e&&((a=t).deleteObjectStore(cy.store),a.deleteObjectStore(uy.store),a.deleteObjectStore(hy.store),fy(t)),s=s.next(function(){return t=n.store(hy.store),e=new hy(0,0,Qp.MIN.toTimestamp(),0),t.put(hy.key,e);var t,e})),e<4&&4<=r&&(0!==e&&(s=s.next(function(){return i=t,(o=n).store(ny.store).loadAll().next(function(t){i.deleteObjectStore(ny.store);var e=i.createObjectStore(ny.store,{keyPath:ny.keyPath,autoIncrement:!0});e.createIndex(ny.userMutationsIndex,ny.userMutationsKeyPath,{unique:!0});var n=o.store(ny.store),r=t.map(function(t){return n.put(t)});return ld.waitFor(r)});var i,o})),s=s.next(function(){t.createObjectStore(dy.store,{keyPath:dy.keyPath}),t.createObjectStore(py.store,{keyPath:"id",autoIncrement:!0})})),e<5&&5<=r&&(s=s.next(function(){return o.removeAcknowledgedMutations(n)})),e<6&&6<=r&&(s=s.next(function(){return t.createObjectStore(sy.store),o.addDocumentGlobal(n)})),e<7&&7<=r&&(s=s.next(function(){return o.ensureSequenceNumbers(n)})),e<8&&8<=r&&(s=s.next(function(){return o.createCollectionParentIndex(t,n)})),s},t.prototype.addDocumentGlobal=function(e){var n=0;return e.store(ay.store).iterate(function(t,e){n+=zd(e)}).next(function(){var t=new sy(n);return e.store(sy.store).put(sy.key,t)})},t.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(ey.store),e=r.store(ny.store);return t.loadAll().next(function(t){return ld.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(ny.userMutationsIndex,t).next(function(t){return ld.forEach(t,function(t){Uf(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return dd(r,n.userId,e).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var a=t.store(cy.store),e=t.store(ay.store);return Pd(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new kp(t),r=[0,Vp(n)];o.push(a.get(r).next(function(t){return t?ld.resolve():(e=n,a.put(new cy(0,Vp(e),i)));var e}))}).next(function(){return ld.waitFor(o)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(ly.store,{keyPath:ly.keyPath});var r=e.store(ly.store),i=new Xd,o=function(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Vp(n)})}};return e.store(ay.store).iterate({keysOnly:!0},function(t,e){var n=new kp(t);return o(n.popLast())}).next(function(){return e.store(ry.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Wp(n));return o(r.popLast())})})},t}();var Zd=function(t,e){this.seconds=t,this.nanoseconds=e},ty=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var ey=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),ny=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var ry=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Vp(e)]},t.key=function(t,e,n){return[t,Vp(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var iy=function(t,e){this.path=t,this.readTime=e},oy=function(t,e){this.path=t,this.version=e},ay=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),sy=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var uy=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),cy=function(){function t(t,e,n){this.targetId=t,this.path=e,Uf(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),hy=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),ly=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function fy(t){t.createObjectStore(cy.store,{keyPath:cy.keyPath}).createIndex(cy.documentTargetsIndex,cy.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(uy.store,{keyPath:uy.keyPath}).createIndex(uy.queryTargetsIndexName,uy.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(hy.store)}var py=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var dy=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var yy,my,gy=[ey.store,ny.store,ry.store,ay.store,uy.store,ty.store,hy.store,cy.store].concat([dy.store,py.store]).concat([sy.store]).concat([ly.store]),vy=function(){function t(){this.collectionParentsCache=new Xd}return t.prototype.addToCollectionParentIndex=function(t,e){if(Uf(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Uf(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return by(t).put({collectionId:n,parent:Vp(r)})}return ld.resolve()},t.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[mp(i),""],!1,!0);return by(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Wp(r.parent))}return o})},t}();function by(t){return Oy.getStore(t,ly.store)}(my=yy||(yy={}))[my.Listen=0]="Listen",my[my.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",my[my.LimboResolution=2]="LimboResolution";var wy=function(){function e(t,e,n,r,i,o){void 0===i&&(i=Qp.MIN),void 0===o&&(o=Vf()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return e.prototype.copy=function(t){return new e(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},e.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},e}(),_y=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Op.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Fd(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=Op.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Ud(e,n)}return Ff("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Ld){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new ay(null,null,e,n)}if(t instanceof Fd){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new ay(null,new iy(r,i),null,n)}if(t instanceof Ud){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new ay(new oy(r,i),null,null,!0)}return Ff("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Zd(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Kp(t.seconds,t.nanoseconds);return Qp.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new ny(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Kp.fromMillis(t.localWriteTimeMs);return new cd(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Vp(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=ad(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Op(Wp(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new wy(e,t.targetId,yy.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Uf(yy.Listen===t.purpose,"Only queries with purpose "+yy.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Uf("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new uy(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Ey(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=dp(n,i);return 0===a?dp(r,o):a}var Ty=function(){function t(t){this.maxElements=t,this.buffer=new Xp(Ey),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ey(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Sy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Iy=function(){function e(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e.COLLECTION_DISABLED=-1,e.MINIMUM_CACHE_SIZE_BYTES=1048576,e.DEFAULT=new e(e.DEFAULT_CACHE_SIZE_BYTES=41943040,e.DEFAULT_COLLECTION_PERCENTILE=10,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),e.DISABLED=new e(e.COLLECTION_DISABLED,0,0),e}(),Cy=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){Uf(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Iy.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Uf(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;xf("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(bp.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Py)})},t}(),Ny=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ld.resolve(Cp.INVALID);var r=new Ty(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===Iy.COLLECTION_DISABLED?(xf("LruGarbageCollector","Garbage collection skipped; disabled"),ld.resolve(Sy)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(xf("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Sy):r.runGarbageCollection(e,n)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(xf("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){(c=Date.now(),Of()<=Ef.DEBUG)&&xf("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms");return ld.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},t}(),Ay="IndexedDbPersistence",ky="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Dy="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ry=function(r){function t(t,e){var n=r.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}return ii(t,r),t}(function(){}),Oy=function(){function c(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!c.isAvailable())throw new jf(Bf.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new Vy(this,o),this.dbName=t+c.MAIN_DATABASE,this.serializer=new _y(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new Dd(this.referenceDelegate,this.serializer),this.indexManager=new vy,this.remoteDocumentCache=new jd(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new jf(Bf.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}return c.getStore=function(t,e){if(t instanceof Ry)return Td.getStore(t.simpleDbTransaction,e);throw Ff("IndexedDbPersistence must use instances of IndexedDbTransaction")},c.createIndexedDbPersistence=function(n,r,i,o,a,s){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s)).start()];case 1:return t.sent(),[2,e]}})})},c.createMultiClientIndexedDbPersistence=function(n,r,i,o,a,s,u){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s,u)).start()];case 1:return t.sent(),[2,e]}})})},c.prototype.start=function(){var n=this;return Uf(!this.started,"IndexedDbPersistence double-started!"),Uf(null!==this.window,"Expected 'window' to be defined"),Td.openOrCreate(this.dbName,Jd,new $d(this.serializer)).then(function(t){return n.simpleDb=t,n.updateClientMetadataAndTryBecomePrimary()}).then(function(){return n.attachVisibilityHandler(),n.attachWindowUnloadHook(),n.scheduleClientMetadataAndPrimaryLeaseRefreshes(),n.startRemoteDocumentCache()}).then(function(){return n.simpleDb.runTransaction("readonly",[hy.store],function(t){return Pd(t).next(function(t){var e=n.multiClientParams?n.multiClientParams.sequenceNumberSyncer:void 0;n.listenSequence=new Cp(t,e)})})}).then(function(){n._started=!0}).catch(function(t){return n.simpleDb&&n.simpleDb.close(),Promise.reject(t)})},c.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",gy,function(t){return e.remoteDocumentCache.start(t)})},c.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},c.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},c.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},c.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",gy,function(n){return My(n).put(new dy(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},c.prototype.verifyPrimaryLease=function(t){var e=this;return xy(t).get(ty.key).next(function(t){return ld.resolve(e.isLocalClient(t))})},c.prototype.removeClientMetadata=function(t){return My(t).delete(this.clientId)},c.prototype.maybeGarbageCollectMultiClientState=function(){return ai(this,void 0,void 0,function(){var r,i,o=this;return si(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=c.getStore(n,dy.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return ld.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,t);return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},c.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(bp.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},c.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},c.prototype.canActAsPrimary=function(e){var i=this;return xy(e).get(ty.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new jf(Bf.FAILED_PRECONDITION,Dy);return!1}}return!(!i.networkEnabled||!i.inForeground)||My(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&xf(Ay,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},c.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[ty.store,dy.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},c.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},c.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[dy.store],function(t){return My(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},c.clearPersistence=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return c.isAvailable()?(e=n+c.MAIN_DATABASE,[4,Td.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(c.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),c.prototype.getMutationQueue=function(t){return Uf(this.started,"Cannot initialize MutationQueue before persistence is started."),fd.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},c.prototype.getQueryCache=function(){return Uf(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},c.prototype.getRemoteDocumentCache=function(){return Uf(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},c.prototype.getIndexManager=function(){return Uf(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},c.prototype.runTransaction=function(n,t,r){var i=this;return xf(Ay,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",gy,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Mf("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new jf(Bf.FAILED_PRECONDITION,ky);return r(new Ry(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new Ry(e,i.listenSequence.next()))})})},c.prototype.verifyAllowTabSynchronization=function(t){var e=this;return xy(t).get(ty.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new jf(Bf.FAILED_PRECONDITION,Dy)})},c.prototype.acquireOrExtendPrimaryLease=function(t){var e=new ty(this.clientId,this.allowTabSynchronization,Date.now());return xy(t).put(ty.key,e)},c.isAvailable=function(){return Td.isAvailable()},c.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},c.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=xy(t);return n.get(ty.key).next(function(t){return e.isLocalClient(t)?(xf(Ay,"Releasing primary lease."),n.delete(ty.key)):ld.resolve()})},c.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(n<t)||(Mf("Detected an update time that is in the future: "+t+" > "+n),!1))},c.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},c.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Uf(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},c.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},c.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Uf("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},c.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return xf(Ay,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Mf(Ay,"Failed to get zombied client id.",t),!1}},c.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Mf("Failed to set zombie client id.",t)}},c.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},c.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},c.MAIN_DATABASE="main",c}();function Py(n){return ai(this,void 0,void 0,function(){return si(this,function(t){if((e=n).code!==Bf.FAILED_PRECONDITION||e.message!==ky)throw n;var e;return xf(Ay,"Unexpectedly lost primary lease"),[2]})})}function xy(t){return t.store(ty.store)}function My(t){return t.store(dy.store)}var Ly,Fy,Uy,qy,Vy=function(){function t(t,e){this.db=t,this.garbageCollector=new Ny(this,e)}return t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return By(t,e)},t.prototype.removeReference=function(t,e){return By(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return By(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?ld.resolve(!0):(r=e,i=!1,vd(n=t).iterateSerial(function(t){return pd(n,t,r).next(function(t){return t&&(i=!0),ld.resolve(!t)})}).next(function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=0,s=0,u=[];return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return a++,o.removeOrphanedDocument(r,e).next(function(t){s+=t})});u.push(n)}}).next(function(){return ld.waitFor(u)}).next(function(){return o.db.getRemoteDocumentCache().updateSize(r,-s)}).next(function(){return a})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return ld.waitFor([xd(t).delete((n=e,[0,Vp(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return By(t,e)},t.prototype.forEachOrphanedDocument=function(t,o){var a,e=xd(t),s=Cp.INVALID;return e.iterate({index:cy.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Cp.INVALID&&o(new Op(Wp(a)),s),s=i,a=r):s=Cp.INVALID}).next(function(){s!==Cp.INVALID&&o(new Op(Wp(a)),s)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function By(t,e){return xd(t).put((n=e,r=t.currentSequenceNumber,new cy(0,Vp(n.path),r)));var n,r}(Fy=Ly||(Ly={}))[Fy.NullValue=0]="NullValue",Fy[Fy.BooleanValue=1]="BooleanValue",Fy[Fy.NumberValue=2]="NumberValue",Fy[Fy.TimestampValue=3]="TimestampValue",Fy[Fy.StringValue=4]="StringValue",Fy[Fy.BlobValue=5]="BlobValue",Fy[Fy.RefValue=6]="RefValue",Fy[Fy.GeoPointValue=7]="GeoPointValue",Fy[Fy.ArrayValue=8]="ArrayValue",Fy[Fy.ObjectValue=9]="ObjectValue",(qy=Uy||(Uy={}))[qy.Default=0]="Default",qy[qy.Estimate=1]="Estimate",qy[qy.Previous=2]="Previous";var jy=function(){function n(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return n.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new n(Uy.Estimate,e);case"previous":return new n(Uy.Previous,e);case"none":case void 0:return new n(Uy.Default,e);default:return Ff("fromSnapshotOptions() called with invalid options.")}},n}(),Wy=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Uf(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),dp(this.typeOrder,t.typeOrder)},t}(),Ky=function(e){function n(){var t=e.call(this)||this;return t.typeOrder=Ly.NullValue,t.internalValue=null,t}return ii(n,e),n.prototype.value=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n},n.prototype.compareTo=function(t){return t instanceof n?0:this.defaultCompareTo(t)},n.INSTANCE=new n,n}(Wy),Qy=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.BooleanValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?dp(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Wy),Hy=function(n){function r(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.NumberValue,e}return ii(r,n),r.prototype.value=function(t){return this.internalValue},r.prototype.compareTo=function(t){return t instanceof r?(e=this.internalValue,n=t.internalValue,e<n?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1):this.defaultCompareTo(t);var e,n},r}(Wy);function Gy(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var zy,Yy,Xy=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Gy(this.internalValue,t.internalValue)},e}(Hy),Jy=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Gy(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Hy),$y=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.StringValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?dp(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Wy),Zy=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.TimestampValue,e}return ii(e,n),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof tm?-1:this.defaultCompareTo(t)},e}(Wy),tm=function(r){function e(t,e){var n=r.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Ly.TimestampValue,n}return ii(e,r),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Uy.Estimate?new Zy(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Uy.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Zy?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Wy),em=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.BlobValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Wy),nm=function(r){function n(t,e){var n=r.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Ly.RefValue,n}return ii(n,r),n.prototype.value=function(t){return this.key},n.prototype.isEqual=function(t){return t instanceof n&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},n.prototype.compareTo=function(t){if(t instanceof n){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Op.comparator(this.key,t.key)}return this.defaultCompareTo(t)},n}(Wy),rm=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.GeoPointValue,e}return ii(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Wy),im=function(n){function a(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.ObjectValue,e}return ii(a,n),a.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},a.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},a.prototype.isEqual=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},a.prototype.compareTo=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=dp(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return dp(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},a.prototype.set=function(t,e){if(Uf(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof a||(n=a.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},a.prototype.delete=function(t){if(Uf(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new a(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof a){var n=e.delete(t.popFirst());return new a(this.internalValue.insert(t.firstSegment(),n))}return this},a.prototype.contains=function(t){return null!==this.field(t)},a.prototype.field=function(t){Uf(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof a?e.internalValue.get(t):null}),e},a.prototype.fieldMask=function(){var i=new Xp(Rp.comparator);return this.internalValue.forEach(function(t,e){var n=new Rp([t]);if(e instanceof a){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),am.fromSet(i)},a.prototype.toString=function(){return this.internalValue.toString()},a.prototype.child=function(t){return this.internalValue.get(t)||void 0},a.prototype.setChild=function(t,e){return new a(this.internalValue.insert(t,e))},a.EMPTY=new a(new Hp(dp)),a}(Wy),om=function(n){function i(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=Ly.ArrayValue,e}return ii(i,n),i.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},i.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},i.prototype.forEach=function(t){this.internalValue.forEach(t)},i.prototype.isEqual=function(t){if(t instanceof i){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},i.prototype.compareTo=function(t){if(t instanceof i){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return dp(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},i.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},i}(Wy),am=function(){function n(t){this.fields=t}return n.fromSet=function(t){return new n(t)},n.fromArray=function(t){var e=new Xp(Rp.comparator);return t.forEach(function(t){return e=e.add(t)}),new n(e)},n.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},n.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},n}(),sm=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),um=function(t,e){this.version=t,this.transformResults=e};(Yy=zy||(zy={}))[Yy.Set=0]="Set",Yy[Yy.Patch=1]="Patch",Yy[Yy.Transform=2]="Transform",Yy[Yy.Delete=3]="Delete";var cm=function(){function e(t,e){this.updateTime=t,this.exists=e,Uf(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),e.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Ld&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ld:(Uf(this.isNone,"Precondition should be empty"),!0)},e.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},e.NONE=new e,e}(),hm=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Uf(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Ld?t.version:Qp.MIN},t}(),lm=function(i){function e(t,e,n){var r=i.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=zy.Set,r}return ii(e,i),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Uf(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ld(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=hm.getPostMutationVersion(t);return new Ld(this.key,r,this.value,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(hm),fm=function(o){function e(t,e,n,r){var i=o.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=zy.Patch,i}return ii(e,o),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Uf(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Ud(this.key,e.version);var n=this.patchDocument(t);return new Ld(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=hm.getPostMutationVersion(t),i=this.patchDocument(t);return new Ld(this.key,r,i,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Ld?t.data:im.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},e}(hm),pm=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=zy.Transform,n.precondition=cm.exists(!0),n}return ii(e,r),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Uf(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Ud(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new Ld(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new Ld(this.key,r.version,o,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ld?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?im.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&yp(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){Uf(t instanceof Ld,"Unknown MaybeDocument type "+t);var e=t;return Uf(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];Uf(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Ld&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Ld&&(u=e.field(a.field)),null===u&&n instanceof Ld&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){Uf(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(hm),dm=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.precondition=e,n.type=zy.Delete,n}return ii(e,r),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Uf(null==e.transformResults,"Transform results received by DeleteMutation."),new Fd(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Uf(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Fd(this.key,Qp.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(hm),ym=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},t.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++){t=n[e].applyToLocalView(r,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=td();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++){e=r[n].applyToLocalView(t,e)}o=o.insert(t,e)}),o},t.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},t.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=Zp();return e.forEach(function(t,e){e||(e=new Fd(t,Qp.forDeletedDoc())),n=n.insert(t,e)}),n})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Op(e)).next(function(t){var e=nd();return t instanceof Ld&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;Uf(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=nd();return this.indexManager.getCollectionParents(n,o).next(function(t){return ld.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},t.prototype.getDocumentsMatchingCollectionQuery=function(e,n){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof Ld?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=ad(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof fm&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ld&&(c=c.insert(t,e))}),c})},t}(),mm=function(){function t(){this.refsByKey=new Xp(gm.compareByKey),this.refsByTarget=new Xp(gm.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new gm(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new gm(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=Op.EMPTY,r=new gm(n,t),i=new gm(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=Op.EMPTY,n=new gm(e,t),r=new gm(e,t+1),i=ad();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new gm(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),gm=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return Op.comparator(t.key,e.key)||dp(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return dp(t.targetOrBatchId,e.targetOrBatchId)||Op.comparator(t.key,e.key)},t}(),vm=function(){function l(t,e){this.persistence=t,this.localViewReferences=new mm,this.queryDataByTarget={},Uf(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new ym(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return l.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new ym(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=ad(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h];n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++){c=p[f];r=r.add(c.key)}}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},l.prototype.localWrite=function(s){var u=this,c=Kp.now(),t=s.reduce(function(t,e){return t.add(e.key)},ad());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return u.localDocuments.getDocuments(a,t).next(function(n){for(var t=[],e=0,r=s;e<r.length;e++){var i=r[e],o=i.extractBaseValue(n.get(i.key));null!=o&&t.push(new fm(i.key,o,o.fieldMask(),cm.exists(!0)))}return u.mutationQueue.addMutationBatch(a,c,t,s).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},l.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):ld.resolve(null)})})},l.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},l.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Uf(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},l.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},l.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},l.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},l.prototype.applyRemoteEvent=function(u){var c=this,h=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[],s=ad();Hf(u.targetChanges,function(t,e){var n=c.queryDataByTarget[t];if(n){e.addedDocuments.forEach(function(t){s=s.add(t)}),e.modifiedDocuments.forEach(function(t){s=s.add(t)}),a.push(c.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n;n=n.copy({resumeToken:r,snapshotVersion:u.snapshotVersion}),c.queryDataByTarget[t]=n,l.shouldPersistQueryData(i,n,e)&&a.push(c.queryCache.updateQueryData(o,n))}}});var i=Zp(),n=ad();u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(h.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||e.version.isEqual(Qp.MIN)||s.has(e.key)&&!n.hasPendingWrites||0<=e.version.compareTo(n.version)?(h.addEntry(e),i=i.insert(t,e)):xf("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})}));var e=u.snapshotVersion;if(!e.isEqual(Qp.MIN)){var t=c.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Uf(0<=e.compareTo(t),"Watch stream reverted to previous snapshot?? "+e+" < "+t),c.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,e)});a.push(t)}return ld.waitFor(a).next(function(){return h.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,i)})})},l.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size))},l.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return ld.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),ld.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},l.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},l.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},l.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,ld.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new wy(r,t,yy.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Uf(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},l.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){Uf(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?ld.resolve():ld.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},l.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},l.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},l.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},l.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},l.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},l.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=ld.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Uf(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):Uf(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},l.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},l.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},l.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},l.RESUME_TOKEN_MAX_AGE_MICROS=3e8,l}(),bm=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Vf(),this.batchesByDocumentKey=new Xp(gm.compareByKey)}return t.prototype.checkEmpty=function(t){return ld.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Uf(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Uf(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,ld.resolve()},t.prototype.getLastStreamToken=function(t){return ld.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,ld.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){Uf(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,0<this.mutationQueue.length)&&Uf(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new cd(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new gm(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return ld.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ld.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Uf(null!=n,"Failed to find local mutation batch."),ld.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return ld.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return ld.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new gm(n,0),i=new gm(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Uf(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Uf(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),ld.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new Xp(dp);return e.forEach(function(e){var t=new gm(e,0),n=new gm(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Uf(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),ld.resolve(this.findMutationBatches(i))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Uf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Op.isDocumentKey(i)||(i=i.child(""));var o=new gm(new Op(i),0),a=new Xp(dp);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),ld.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},t.prototype.removeMutationBatch=function(n,r){var i=this;Uf(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return ld.forEach(r.mutations,function(t){var e=new gm(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new gm(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return ld.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Uf(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),ld.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Uf(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Uf(n.batchId===t,"If found batch must match"),n},t}(),wm=function(){function t(t){this.persistence=t,this.queries=new qd(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Qp.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new mm,this.targetCount=0,this.targetIdGenerator=_d.forQueryCache()}return t.prototype.getTargetCount=function(t){return ld.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),ld.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ld.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ld.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,ld.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),ld.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Uf(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,ld.resolve()},t.prototype.updateQueryData=function(t,e){return Uf(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),ld.resolve()},t.prototype.removeQueryData=function(t,e){return Uf(0<this.targetCount,"Removing a target from an empty cache"),Uf(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,ld.resolve()},t.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),ld.waitFor(s).next(function(){return a})},t.prototype.getQueryCount=function(t){return ld.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return ld.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Ff("Not yet implemented.")},t.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),ld.waitFor(i)},t.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),ld.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),ld.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return ld.resolve(n)},t.prototype.containsKey=function(t,e){return ld.resolve(this.references.containsKey(e))},t}();var _m=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Hp(Op.comparator),this.newDocumentChanges=ad(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,ld.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,ld.resolve(n.size)):ld.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ld.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return ld.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=td();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),ld.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=td(),i=new Hp(Op.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),ld.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){Uf(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=nd(),r=new Op(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof Ld&&e.matches(s)&&(n=n.insert(s.key,s))}return ld.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return ld.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var r=this,i=Zp();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new Fd(t,Qp.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=ad(),ld.resolve(i)},t.prototype.newChangeBuffer=function(){return new Em(this.sizer,this)},t.prototype.getSize=function(t){return ld.resolve(this.size)},t}(),Em=function(r){function t(t,e){var n=r.call(this)||this;return n.sizer=t,n.documentCache=e,n}return ii(t,r),t.prototype.applyChanges=function(t){var i=this,e=this.assertChanges(),o=0,a=[];return e.forEach(function(t,e){var n=i.documentSizes.get(t);Uf(void 0!==n,"Attempting to change document "+t.toString()+" without having read it first");var r=i.sizer(e);o+=r-n,a.push({maybeDocument:e,size:r})}),this.documentCache.addEntries(t,a,o)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(Vd),Tm=function(){function r(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Cp(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new wm(this);this.indexManager=new Yd,this.remoteDocumentCache=new _m(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return r.createLruPersistence=function(t,e,n){return new r(t,function(t){return new Cm(t,new _y(e),n)})},r.createEagerPersistence=function(t){return new r(t,function(t){return new Im(t)})},r.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(r.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),r.prototype.getActiveClients=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,[this.clientId]]})})},r.prototype.setPrimaryStateListener=function(t){return t(!0)},r.prototype.setDatabaseDeletedListener=function(){},r.prototype.setNetworkEnabled=function(t){},r.prototype.getIndexManager=function(){return this.indexManager},r.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new bm(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},r.prototype.getQueryCache=function(){return this.queryCache},r.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},r.prototype.runTransaction=function(t,e,n){var r=this;xf("MemoryPersistence","Starting transaction:",t);var i=new Sm(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},r.prototype.mutationQueuesContainKey=function(e,n){return ld.or((t=this.mutationQueues,r=[],Gf(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.containsKey(e,n)}}));var t,r},r}(),Sm=function(t){this.currentSequenceNumber=t},Im=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),ld.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),ld.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),ld.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(n){var t=this,r=this.persistence.getRemoteDocumentCache();return ld.forEach(this.orphanedDocuments,function(e){return t.isReferenced(n,e).next(function(t){return t?ld.resolve():r.removeEntry(n,e).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return ld.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return ld.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Cm=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new qd(function(t){return Vp(t.path)}),this.garbageCollector=new Ny(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return ld.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return ld.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?ld.resolve():r(e)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(n,t){var r=this,i=0,o=this.persistence.getRemoteDocumentCache();return o.forEachDocumentKey(n,function(e){return r.isPinned(n,e,t).next(function(t){return t?ld.resolve():(i++,o.removeEntry(n,e).next())})}).next(function(){return i})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ld.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ld.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ld.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ld.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ff("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return ld.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return ld.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return ld.resolve(void 0!==t&&n<t)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Nm=Number,Am=Nm.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),km=Nm.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Dm=Nm.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Rm(t){return null==t}function Om(t){return Dm(t)&&t<=km&&Am<=t}var Pm,xm,Mm=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&xf("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),Lm="PersistentStream";(xm=Pm||(Pm={}))[xm.Initial=0]="Initial",xm[xm.Starting=1]="Starting",xm[xm.Open=2]="Open",xm[xm.Error=3]="Error",xm[xm.Backoff=4]="Backoff";var Fm,Um,qm,Vm,Bm=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Pm.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Mm(t,e,1e3,1.5,6e4)}return t.prototype.isStarted=function(){return this.state===Pm.Starting||this.state===Pm.Open||this.state===Pm.Backoff},t.prototype.isOpen=function(){return this.state===Pm.Open},t.prototype.start=function(){this.state!==Pm.Error?(Uf(this.state===Pm.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Pm.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Uf(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Pm.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.isOpen()?[2,this.close(Pm.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Uf(this.isStarted(),"Only started streams should be closed."),Uf(e===Pm.Error||Rm(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==Pm.Error?this.backoff.reset():n&&n.code===Bf.RESOURCE_EXHAUSTED?(Mf(n.toString()),Mf("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Bf.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var n=this;Uf(this.state===Pm.Initial,"Must be in initial state to auth"),this.state=Pm.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new jf(Bf.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},t.prototype.startStream=function(t){var e=this;Uf(this.state===Pm.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Uf(e.state===Pm.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Pm.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Uf(this.state===Pm.Error,"Should only perform backoff when in Error state"),this.state=Pm.Backoff,this.backoff.backoffAndRun(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){return Uf(this.state===Pm.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Pm.Initial,this.start(),Uf(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Uf(this.isStarted(),"Can't handle server close on non-started stream"),xf(Lm,"close with error: "+t),this.stream=null,this.close(Pm.Error,t)},t.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(xf(Lm,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),jm=function(a){function t(t,e,n,r,i){var o=a.call(this,t,bp.ListenStreamConnectionBackoff,bp.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}return ii(t,a),t.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},t.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},t.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},t.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},t}(Bm),Wm=function(a){function t(t,e,n,r,i){var o=a.call(this,t,bp.WriteStreamConnectionBackoff,bp.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o}return ii(t,a),Object.defineProperty(t.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.handshakeComplete_=!1,a.prototype.start.call(this)},t.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},t.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},t.prototype.onMessage=function(t){if(Uf(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Uf(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},t.prototype.writeHandshake=function(){Uf(this.isOpen(),"Writing handshake requires an opened stream"),Uf(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},t.prototype.writeMutations=function(t){var e=this;Uf(this.isOpen(),"Writing mutations requires an opened stream"),Uf(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Uf(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},t}(Bm),Km=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Wm(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new jm(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=Zp();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Uf(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},t.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Bf.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Bf.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t}(),Qm=function(){function t(t){this.datastore=t,this.readVersions=id(),this.mutations=[],this.committed=!1,this.writtenDocs=new Set}return t.prototype.lookup=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new jf(Bf.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Fd||t instanceof Ld?n.recordVersion(t):Ff("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new dm(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new jf(Bf.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t instanceof Ld)e=t.version;else{if(!(t instanceof Fd))throw Ff("Document in a transaction was a "+t.constructor.name);e=Qp.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new jf(Bf.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?cm.updateTime(e):cm.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return cm.exists(!0);if(e.isEqual(Qp.forDeletedDoc()))throw new jf(Bf.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cm.updateTime(e)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){Uf(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();(Um=Fm||(Fm={}))[Um.Unknown=0]="Unknown",Um[Um.Online=1]="Online",Um[Um.Offline=2]="Offline",(Vm=qm||(qm={}))[Vm.RemoteStore=0]="RemoteStore",Vm[Vm.SharedClientState=1]="SharedClientState";var Hm,Gm,zm=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Fm.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Fm.Unknown),Uf(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(bp.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Uf(t.state===Fm.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Fm.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Fm.Online?(this.setAndBroadcast(Fm.Unknown),Uf(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Uf(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Fm.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Fm.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Mf(e),this.shouldWarnClientIsOffline=!1):xf("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function Ym(t){switch(t){case Bf.OK:return Ff("Treated status OK as error");case Bf.CANCELLED:case Bf.UNKNOWN:case Bf.DEADLINE_EXCEEDED:case Bf.RESOURCE_EXHAUSTED:case Bf.INTERNAL:case Bf.UNAVAILABLE:case Bf.UNAUTHENTICATED:return!1;case Bf.INVALID_ARGUMENT:case Bf.NOT_FOUND:case Bf.ALREADY_EXISTS:case Bf.PERMISSION_DENIED:case Bf.FAILED_PRECONDITION:case Bf.ABORTED:case Bf.OUT_OF_RANGE:case Bf.UNIMPLEMENTED:case Bf.DATA_LOSS:return!0;default:return Ff("Unknown status code: "+t)}}function Xm(t){if(void 0===t)return Mf("GRPC error has no .code"),Bf.UNKNOWN;switch(t){case Hm.OK:return Bf.OK;case Hm.CANCELLED:return Bf.CANCELLED;case Hm.UNKNOWN:return Bf.UNKNOWN;case Hm.DEADLINE_EXCEEDED:return Bf.DEADLINE_EXCEEDED;case Hm.RESOURCE_EXHAUSTED:return Bf.RESOURCE_EXHAUSTED;case Hm.INTERNAL:return Bf.INTERNAL;case Hm.UNAVAILABLE:return Bf.UNAVAILABLE;case Hm.UNAUTHENTICATED:return Bf.UNAUTHENTICATED;case Hm.INVALID_ARGUMENT:return Bf.INVALID_ARGUMENT;case Hm.NOT_FOUND:return Bf.NOT_FOUND;case Hm.ALREADY_EXISTS:return Bf.ALREADY_EXISTS;case Hm.PERMISSION_DENIED:return Bf.PERMISSION_DENIED;case Hm.FAILED_PRECONDITION:return Bf.FAILED_PRECONDITION;case Hm.ABORTED:return Bf.ABORTED;case Hm.OUT_OF_RANGE:return Bf.OUT_OF_RANGE;case Hm.UNIMPLEMENTED:return Bf.UNIMPLEMENTED;case Hm.DATA_LOSS:return Bf.DATA_LOSS;default:return Ff("Unknown status code: "+t)}}(Gm=Hm||(Hm={}))[Gm.OK=0]="OK",Gm[Gm.CANCELLED=1]="CANCELLED",Gm[Gm.UNKNOWN=2]="UNKNOWN",Gm[Gm.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Gm[Gm.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Gm[Gm.NOT_FOUND=5]="NOT_FOUND",Gm[Gm.ALREADY_EXISTS=6]="ALREADY_EXISTS",Gm[Gm.PERMISSION_DENIED=7]="PERMISSION_DENIED",Gm[Gm.UNAUTHENTICATED=16]="UNAUTHENTICATED",Gm[Gm.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Gm[Gm.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Gm[Gm.ABORTED=10]="ABORTED",Gm[Gm.OUT_OF_RANGE=11]="OUT_OF_RANGE",Gm[Gm.UNIMPLEMENTED=12]="UNIMPLEMENTED",Gm[Gm.INTERNAL=13]="INTERNAL",Gm[Gm.UNAVAILABLE=14]="UNAVAILABLE",Gm[Gm.DATA_LOSS=15]="DATA_LOSS";var Jm,$m,Zm,tg,eg=function(){function o(n){this.comparator=n?function(t,e){return n(t,e)||Op.comparator(t.key,e.key)}:function(t,e){return Op.comparator(t.key,e.key)},this.keyedMap=nd(),this.sortedSet=new Hp(this.comparator)}return o.emptySet=function(t){return new o(t.comparator)},o.prototype.has=function(t){return null!=this.keyedMap.get(t)},o.prototype.get=function(t){return this.keyedMap.get(t)},o.prototype.first=function(){return this.sortedSet.minKey()},o.prototype.last=function(){return this.sortedSet.maxKey()},o.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},o.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(o.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),o.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},o.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},o.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},o.prototype.copy=function(t,e){var n=new o;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},o}();($m=Jm||(Jm={}))[$m.Added=0]="Added",$m[$m.Removed=1]="Removed",$m[$m.Modified=2]="Modified",$m[$m.Metadata=3]="Metadata",(tg=Zm||(Zm={}))[tg.Local=0]="Local",tg[tg.Synced=1]="Synced";var ng,rg,ig=function(){function t(){this.changeMap=new Hp(Op.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Jm.Added&&n.type===Jm.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Jm.Metadata&&n.type!==Jm.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Jm.Modified&&n.type===Jm.Modified?this.changeMap=this.changeMap.insert(e,{type:Jm.Modified,doc:t.doc}):t.type===Jm.Modified&&n.type===Jm.Added?this.changeMap=this.changeMap.insert(e,{type:Jm.Added,doc:t.doc}):t.type===Jm.Removed&&n.type===Jm.Added?this.changeMap=this.changeMap.remove(e):t.type===Jm.Removed&&n.type===Jm.Modified?this.changeMap=this.changeMap.insert(e,{type:Jm.Removed,doc:n.doc}):t.type===Jm.Added&&n.type===Jm.Removed?this.changeMap=this.changeMap.insert(e,{type:Jm.Modified,doc:t.doc}):Ff("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},t}(),og=function(){function o(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return o.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:Jm.Added,doc:t})}),new o(t,e,eg.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(o.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),o.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},o}(),ag=function(){function i(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return i.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=sg.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new i(Qp.MIN,r,ud(),Zp(),ad())},i}(),sg=function(){function n(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return n.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new n(Vf(),e,ad(),ad(),ad())},n}(),ug=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},cg=function(t,e){this.targetId=t,this.existenceFilter=e};(rg=ng||(ng={}))[rg.NoChange=0]="NoChange",rg[rg.Added=1]="Added",rg[rg.Removed=2]="Removed",rg[rg.Current=3]="Current",rg[rg.Reset=4]="Reset";var hg=function(t,e,n,r){void 0===n&&(n=Vf()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},lg=function(){function t(){this.pendingResponses=0,this.documentChanges=dg(),this._resumeToken=Vf(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var n=ad(),r=ad(),i=ad();return this.documentChanges.forEach(function(t,e){switch(e){case Jm.Added:n=n.add(t);break;case Jm.Modified:r=r.add(t);break;case Jm.Removed:i=i.add(t);break;default:Ff("Encountered invalid change type: "+e)}}),new sg(this._resumeToken,this._current,n,r,i)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=dg()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),fg=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Zp(),this.pendingDocumentTargetMapping=pg(),this.pendingTargetResets=new Xp(dp)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Ld?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Fd&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case ng.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case ng.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case ng.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Uf(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case ng.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case ng.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Ff("Unknown target watch change state: "+n.state)}})},t.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Hf(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Op(i.path);this.removeDocumentFromTarget(e,o,new Fd(o,Qp.forDeletedDoc()))}else Uf(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(i){var o=this,a={};Hf(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new Op(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Fd(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=ad();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===yy.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new ag(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Zp(),this.pendingDocumentTargetMapping=pg(),this.pendingTargetResets=new Xp(dp),t},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Jm.Modified:Jm.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Jm.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new lg),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Xp(dp),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(e){var n=this;Uf(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new lg,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function pg(){return new Hp(Op.comparator)}function dg(){return new Hp(Op.comparator)}var yg="RemoteStore",mg=function(){function t(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ai(o,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(xf(yg,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new zm(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Fm.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Fm.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(xf(yg,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return xf(yg,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Fm.Unknown),[2]}})})},t.prototype.listen=function(t){Uf(!Kf(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Uf(Kf(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),zf(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Fm.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Uf(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new fg(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!zf(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return ai(this,void 0,void 0,function(){var n=this;return si(this,function(t){return Hf(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},t.prototype.onWatchStreamClose=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return void 0===e&&Uf(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(Fm.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(Fm.Online),n instanceof hg&&n.state===ng.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof ug?this.watchChangeAggregator.handleDocumentChange(n):n instanceof cg?this.watchChangeAggregator.handleExistenceFilter(n):(Uf(n instanceof hg,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(Qp.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(r){var i=this;Uf(!r.isEqual(Qp.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Hf(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.copy({resumeToken:e.resumeToken,snapshotVersion:r}))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.copy({resumeToken:Vf()}),i.sendUnwatchRequest(t);var n=new wy(e.query,t,yy.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},t.prototype.handleTargetError=function(t){var n=this;Uf(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ai(n,void 0,void 0,function(){return si(this,function(t){return Kf(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},t.prototype.fillWritePipeline=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Uf(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},t.prototype.startWriteStream=function(){Uf(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(Py)},t.prototype.onMutationResult=function(t,e){var n=this;Uf(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=hd.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){return void 0===n&&Uf(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return Ym(e.code)?(xf(yg,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Vf(),[2,this.localStore.setLastStreamToken(Vf()).catch(Py)]):[2]})})},t.prototype.handleWriteError=function(i){return ai(this,void 0,void 0,function(){var n,r=this;return si(this,function(t){return Ym(e=i.code)&&e!==Bf.ABORTED?(n=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(n.batchId,i).then(function(){return r.fillWritePipeline()})]):[2];var e})})},t.prototype.createTransaction=function(){return new Qm(this.datastore)},t.prototype.restartNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Fm.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(xf(yg,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(Fm.Unknown),t.label=4;case 4:return[2]}})})},t}(),gg=function(){function t(t,e){if(Xf("GeoPoint",arguments,2),Zf("GeoPoint","number",1,t),Zf("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new jf(Bf.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new jf(Bf.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return dp(this._lat,t._lat)||dp(this._long,t._long)},t}(),vg=function(){function n(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return n.atPath=function(t){return new n(t)},Object.defineProperty(n.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[Dg]:this.memoizedOrderBy=[new kg(t),Dg];else{Uf(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Ng.ASCENDING;this.memoizedOrderBy.push(a===Ng.ASCENDING?Dg:Rg)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),n.prototype.addFilter=function(t){Uf(null==this.getInequalityFilterField()||!(t instanceof _g)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Uf(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},n.prototype.addOrderBy=function(t){Uf(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new n(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.withLimit=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},n.prototype.withStartAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},n.prototype.withEndAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},n.prototype.asCollectionQueryAtPath=function(t){return new n(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}Rm(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},n.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Rm(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},n.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},n.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Uf(n,"orderBy used that doesn't compare on key field"),0},n.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},n.prototype.hasLimit=function(){return!Rm(this.limit)},n.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},n.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof _g&&n.isInequality())return n.field}return null},n.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof _g&&0<=t.indexOf(r.op))return r.op}return null},n.prototype.isDocumentQuery=function(){return Op.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},n.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},n.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Op.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},n.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},n.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},n.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},n.prototype.assertValidBound=function(t){Uf(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},n}(),bg=function(){},wg=function(){function e(t){this.name=t}return e.fromString=function(t){switch(t){case"<":return e.LESS_THAN;case"<=":return e.LESS_THAN_OR_EQUAL;case"==":return e.EQUAL;case">=":return e.GREATER_THAN_OR_EQUAL;case">":return e.GREATER_THAN;case"array-contains":return e.ARRAY_CONTAINS;case"in":return e.IN;case"array-contains-any":return e.ARRAY_CONTAINS_ANY;default:return Ff("Unknown FieldFilter operator: "+t)}},e.prototype.toString=function(){return this.name},e.prototype.isEqual=function(t){return this.name===t.name},e.LESS_THAN=new e("<"),e.LESS_THAN_OR_EQUAL=new e("<="),e.EQUAL=new e("=="),e.GREATER_THAN=new e(">"),e.GREATER_THAN_OR_EQUAL=new e(">="),e.ARRAY_CONTAINS=new e("array-contains"),e.IN=new e("in"),e.ARRAY_CONTAINS_ANY=new e("array-contains-any"),e}(),_g=function(i){function r(t,e,n){var r=i.call(this)||this;return r.field=t,r.op=e,r.value=n,r}return ii(r,i),r.create=function(t,e,n){if(t.isKeyField())return e===wg.IN?(Uf(n instanceof om,"Comparing on key with IN, but filter value not an ArrayValue"),Uf(n.internalValue.every(function(t){return t instanceof nm}),"Comparing on key with IN, but an array value was not a RefValue"),new Tg(t,n)):(Uf(n instanceof nm,"Comparing on key, but filter value not a RefValue"),Uf(e!==wg.ARRAY_CONTAINS&&e!==wg.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Eg(t,e,n));if(n.isEqual(Ky.INSTANCE)){if(e!==wg.EQUAL)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new r(t,e,n)}if(n.isEqual(Jy.NAN)){if(e!==wg.EQUAL)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new r(t,e,n)}return e===wg.ARRAY_CONTAINS?new Sg(t,n):e===wg.IN?(Uf(n instanceof om,"IN filter has invalid value: "+n.toString()),new Ig(t,n)):e===wg.ARRAY_CONTAINS_ANY?(Uf(n instanceof om,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Cg(t,n)):new r(t,e,n)},r.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},r.prototype.matchesComparison=function(t){switch(this.op){case wg.LESS_THAN:return t<0;case wg.LESS_THAN_OR_EQUAL:return t<=0;case wg.EQUAL:return 0===t;case wg.GREATER_THAN:return 0<t;case wg.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Ff("Unknown FieldFilter operator: "+this.op)}},r.prototype.isInequality=function(){return 0<=[wg.LESS_THAN,wg.LESS_THAN_OR_EQUAL,wg.GREATER_THAN,wg.GREATER_THAN_OR_EQUAL].indexOf(this.op)},r.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},r.prototype.isEqual=function(t){return t instanceof r&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},r.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},r}(bg),Eg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ii(e,t),e.prototype.matches=function(t){var e=this.value,n=Op.comparator(t.key,e.key);return this.matchesComparison(n)},e}(_g),Tg=function(r){function t(t,e){var n=r.call(this,t,wg.IN,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},t}(_g),Sg=function(n){function t(t,e){return n.call(this,t,wg.ARRAY_CONTAINS,e)||this}return ii(t,n),t.prototype.matches=function(t){var e=t.field(this.field);return e instanceof om&&e.contains(this.value)},t}(_g),Ig=function(r){function t(t,e){var n=r.call(this,t,wg.IN,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},t}(_g),Cg=function(r){function t(t,e){var n=r.call(this,t,wg.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}return ii(t,r),t.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof om&&n.internalValue.some(function(t){return e.value.contains(t)})},t}(_g),Ng=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Ag=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Uf(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Uf(o instanceof nm,"Bound has a non-key value where the key path is being used."),n=Op.comparator(o.key,e.key);else{var a=e.field(i.field);Uf(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===Ng.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),kg=function(){function t(t,e){this.field=t,void 0===e&&(e=Ng.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Ld.compareByKey(t,e):Ld.compareByField(this.field,t,e);switch(this.dir){case Ng.ASCENDING:return n;case Ng.DESCENDING:return-1*n;default:return Ff("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),Dg=new kg(Rp.keyField(),Ng.ASCENDING),Rg=new kg(Rp.keyField(),Ng.DESCENDING),Og=function(){function e(){}return e.prototype.applyToLocalView=function(t,e){return new tm(e,t)},e.prototype.applyToRemoteDocument=function(t,e){return e},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.instance=new e,e}(),Pg=function(){function e(t){this.elements=t}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){for(var n=Lg(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++){e(i[r])}return new om(n)},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&yp(t.elements,this.elements)},e}(),xg=function(){function e(t){this.elements=t}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){for(var n=Lg(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++){e(i[r])}return new om(n)},e.prototype.computeBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&yp(t.elements,this.elements)},e}(),Mg=function(){function e(t){this.operand=t}return e.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Xy&&this.operand instanceof Xy){var r=n.internalValue+this.operand.internalValue;return new Xy(r)}r=n.internalValue+this.operand.internalValue;return new Jy(r)},e.prototype.applyToRemoteDocument=function(t,e){return Uf(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},e.prototype.computeBaseValue=function(t){return t instanceof Hy?t:new Xy(0)},e.prototype.isEqual=function(t){return t instanceof e&&this.operand.isEqual(t.operand)},e}();function Lg(t){return t instanceof om?t.internalValue.slice():[]}var Fg,Ug,qg=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),Vg=((Fg={})[Ng.ASCENDING.name]="ASCENDING",Fg[Ng.DESCENDING.name]="DESCENDING",Fg),Bg=((Ug={})[wg.LESS_THAN.name]="LESS_THAN",Ug[wg.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Ug[wg.GREATER_THAN.name]="GREATER_THAN",Ug[wg.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Ug[wg.EQUAL.name]="EQUAL",Ug[wg.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Ug[wg.IN.name]="IN",Ug[wg.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Ug),jg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wg(t,e){Uf(!Rm(t),e+" is missing")}function Kg(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Ff("can't parse "+t)}var Qg=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Bf.UNKNOWN:Xm(t.code);return new jf(e,t.message||"")},t.prototype.toInt32Value=function(t){return Rm(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Rm(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Uf(!!t,"Cannot deserialize null or undefined timestamp.");var e=Kg(t.seconds||"0"),n=t.nanos||0;return new Kp(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=jg.exec(t);if(Uf(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Kp(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Uf(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),_p.fromBase64String(t)):(Uf(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),_p.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Uf(!!t,"Trying to deserialize version that isn't set"),Qp.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=kp.fromString(t);return Uf(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Uf(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Uf(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Op(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?kp.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new kp(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new kp(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Uf(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Ky)return{nullValue:"NULL_VALUE"};if(t instanceof Qy)return{booleanValue:t.value()};if(t instanceof Xy)return{integerValue:""+t.value()};if(t instanceof Jy){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof $y?{stringValue:t.value()}:t instanceof im?{mapValue:this.toMapValue(t)}:t instanceof om?{arrayValue:this.toArrayValue(t)}:t instanceof Zy?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof rm?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof em?{bytesValue:this.toBytes(t.value())}:t instanceof nm?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Ff("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Ky.INSTANCE;if("booleanValue"in t)return Qy.of(t.booleanValue);if("integerValue"in t)return new Xy(Kg(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Jy.NAN;if("Infinity"===t.doubleValue)return Jy.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Jy.NEGATIVE_INFINITY}return new Jy(t.doubleValue)}if("stringValue"in t)return new $y(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Wg(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new om(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Wg(t.timestampValue,"timestampValue"),new Zy(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Wg(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new rm(new gg(r,i))}if("bytesValue"in t){Wg(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new em(o)}if("referenceValue"in t){Wg(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Ip(a.get(1),a.get(3)),u=new Op(this.extractLocalPathFromResourceName(a));return new nm(s,u)}return Ff("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Uf(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new Ld(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},t.prototype.fromFields=function(t){var n=this,e=t,r=im.EMPTY;return Gf(e,function(t,e){r=r.set(new Rp([t]),n.fromValue(e))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Uf(!!t.found,"Tried to deserialize a found document from a missing document."),Wg(t.found.name,"doc.found.name"),Wg(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new Ld(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Uf(!!t.missing,"Tried to deserialize a missing document from a found document."),Uf(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Fd(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Ff("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case ng.Added:return"ADD";case ng.Current:return"CURRENT";case ng.NoChange:return"NO_CHANGE";case ng.Removed:return"REMOVE";case ng.Reset:return"RESET";default:return Ff("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof cg)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof ug){if(t.newDoc instanceof Ld){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Fd){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof hg){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Hm.OK;switch(t){case Bf.OK:return Hm.OK;case Bf.CANCELLED:return Hm.CANCELLED;case Bf.UNKNOWN:return Hm.UNKNOWN;case Bf.DEADLINE_EXCEEDED:return Hm.DEADLINE_EXCEEDED;case Bf.RESOURCE_EXHAUSTED:return Hm.RESOURCE_EXHAUSTED;case Bf.INTERNAL:return Hm.INTERNAL;case Bf.UNAVAILABLE:return Hm.UNAVAILABLE;case Bf.UNAUTHENTICATED:return Hm.UNAUTHENTICATED;case Bf.INVALID_ARGUMENT:return Hm.INVALID_ARGUMENT;case Bf.NOT_FOUND:return Hm.NOT_FOUND;case Bf.ALREADY_EXISTS:return Hm.ALREADY_EXISTS;case Bf.PERMISSION_DENIED:return Hm.PERMISSION_DENIED;case Bf.FAILED_PRECONDITION:return Hm.FAILED_PRECONDITION;case Bf.ABORTED:return Hm.ABORTED;case Bf.OUT_OF_RANGE:return Hm.OUT_OF_RANGE;case Bf.UNIMPLEMENTED:return Hm.UNIMPLEMENTED;case Bf.DATA_LOSS:return Hm.DATA_LOSS;default:return Ff("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Ff("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){Wg(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new hg(n,r,i,a||null)}else if("documentChange"in t){Wg(t.documentChange,"documentChange"),Wg(t.documentChange.document,"documentChange.name"),Wg(t.documentChange.document.name,"documentChange.document.name"),Wg(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new Ld(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new ug(f,p,l.key,l)}else if("documentDelete"in t){Wg(t.documentDelete,"documentDelete"),Wg(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):Qp.forDeletedDoc(),l=new Fd(u,c),p=d.removedTargetIds||[];e=new ug([],p,l.key,l)}else if("documentRemove"in t){Wg(t.documentRemove,"documentRemove"),Wg(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[];e=new ug([],p,u,null)}else{if(!("filter"in t))return Ff("Unknown change type "+JSON.stringify(t));Wg(t.filter,"filter"),Wg(t.filter.targetId,"filter.targetId");var m=t.filter,g=m.count||0,v=new qg(g),b=m.targetId;e=new cg(b,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?ng.NoChange:"ADD"===t?ng.Added:"REMOVE"===t?ng.Removed:"CURRENT"===t?ng.Current:"RESET"===t?ng.Reset:Ff("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Qp.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Qp.MIN:e.readTime?this.fromVersion(e.readTime):Qp.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof lm)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof dm)e={delete:this.toName(t.key)};else if(t instanceof fm)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof pm))return Ff("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):cm.NONE;if(t.update){Wg(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new fm(r,i,o,n)}return new lm(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new dm(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Uf(!0===n.exists,'Transforms only support precondition "exists == true"'),new pm(r,a)}return Ff("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Uf(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ff("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?cm.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?cm.exists(t.exists):cm.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new um(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Uf(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Og)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Pg)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof xg)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Mg)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Ff("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Uf("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Og.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Pg(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new xg(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);Uf(i instanceof Hy,"NUMERIC_ADD transform requires a NumberValue"),n=new Mg(i)}else Ff("Unknown transform proto: "+JSON.stringify(t));var o=Rp.fromServerFormat(t.fieldPath);return new sm(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Uf(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return vg.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Uf(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Uf(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Uf(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new vg(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case yy.Listen:return null;case yy.ExistenceFilterMismatch:return"existence-filter-mismatch";case yy.LimboResolution:return"limbo-document";default:return Ff("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof _g?e.toUnaryOrFieldFilter(t):Ff("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Ff("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Ag(r,n)},t.prototype.toDirection=function(t){return Vg[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Ng.ASCENDING;case"DESCENDING":return Ng.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Bg[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return wg.EQUAL;case"GREATER_THAN":return wg.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return wg.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return wg.LESS_THAN;case"LESS_THAN_OR_EQUAL":return wg.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return wg.ARRAY_CONTAINS;case"IN":return wg.IN;case"ARRAY_CONTAINS_ANY":return wg.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Ff("Unspecified operator");default:return Ff("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return Rp.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new kg(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return _g.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===wg.EQUAL){if(t.value.isEqual(Jy.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Ky.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return _g.create(e,wg.EQUAL,Jy.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return _g.create(n,wg.EQUAL,Ky.INSTANCE);case"OPERATOR_UNSPECIFIED":return Ff("Unspecified filter");default:return Ff("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Rp.fromServerFormat(t)});return am.fromArray(e)},t}(),Hg=function(){this.listeners=[]},Gg=function(){function t(t){this.syncEngine=t,this.queries=new qd(function(t){return t.canonicalId()}),this.onlineState=Fm.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Hg,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){s[a].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(i){this.onlineState=i,this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++){r[n].applyOnlineStateChange(i)}})},t}(),zg=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Fm.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Uf(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Jm.Metadata&&e.push(i)}t=new og(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Uf(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Fm.Offline;return this.options.waitForSyncWhenOnline&&n?(Uf(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Fm.Offline},t.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Uf(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=og.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),Yg=function(){function s(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return s.fromSnapshot=function(t,e){for(var n=ad(),r=ad(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case Jm.Added:n=n.add(a.doc.key);break;case Jm.Removed:r=r.add(a.doc.key)}}return new s(t,n,r)},s}(),Xg=function(t){this.key=t},Jg=function(t){this.key=t},$g=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=ad(),this.mutatedKeys=ad(),this.documentSet=new eg(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new ig,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Ld?e:null;r&&(Uf(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(u.track({type:Jm.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:Jm.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:Jm.Added,doc:r}),a=!0):n&&!r&&(u.track({type:Jm.Removed,doc:n}),a=!0,p&&(f=!0));a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:Jm.Removed,doc:n})}return Uf(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var o=this;Uf(!t.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var i=t.changeSet.getChanges();i.sort(function(t,e){return n=t.type,r=e.type,(i=function(t){switch(t){case Jm.Added:return 1;case Jm.Modified:case Jm.Metadata:return 2;case Jm.Removed:return 0;default:return Ff("Unknown ChangeType: "+t)}})(n)-i(r)||o.query.docComparator(t.doc,e.doc);var n,r,i}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Zm.Synced:Zm.Local,u=s!==this.syncState;return this.syncState=s,0!==i.length||u?{snapshot:new og(this.query,t.documentSet,r,i,t.mutatedKeys,s===Zm.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Fm.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new ig,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Uf(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=ad(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new Jg(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new Xg(t))}),r},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=ad();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return og.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Zm.Local)},t}();var Zg="SyncEngine",tv=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ev=function(t){this.key=t},nv=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new qd(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Hp(Op.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new mm,this.mutationUserCallbacks={},this.limboTargetIdGenerator=_d.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Fm.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Uf(null!==t,"SyncEngine listener cannot be null"),Uf(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(a){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(c,h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=c.query,[4,this.localStore.executeQuery(e)];case 1:return n=t.sent(),[4,this.localStore.remoteDocumentKeys(c.targetId)];case 2:return r=t.sent(),i=new $g(e,r),o=i.computeDocChanges(n),a=sg.createSynthesizedTargetChangeForCurrentChange(c.targetId,h&&this.onlineState!==Fm.Offline),Uf(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),Uf(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new tv(e,c.targetId,i),this.queryViewsByQuery.set(e,u),this.queryViewsByTarget[c.targetId]=u,[2,s.snapshot]}})})},t.prototype.synchronizeViewAndComputeSnapshot=function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i.query)];case 1:return e=t.sent(),[4,this.localStore.remoteDocumentKeys(i.targetId)];case 2:return n=t.sent(),r=i.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,r.limboChanges),[2,r]}})})},t.prototype.unlisten=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Uf(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Py)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},t.prototype.write=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},t.prototype.runTransaction=function(o,a){return void 0===a&&(a=5),ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:if(Uf(0<=a,"Got negative number of retries for transaction."),e=this.remoteStore.createTransaction(),Rm(n=o(e))||!n.catch||!n.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,n];case 2:return r=t.sent(),[4,e.commit()];case 3:return t.sent(),[2,r];case 4:return i=t.sent(),0<a&&this.isRetryableTransactionError(i)?[2,this.runTransaction(o,a-1)]:[2,Promise.reject(i)];case 5:return[2]}})})},t.prototype.applyRemoteEvent=function(n){return ai(this,void 0,void 0,function(){var e,r=this;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),Gf(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Uf(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Uf(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Uf(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Py(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},t.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===qm.RemoteStore||!this.isPrimary&&t===qm.SharedClientState){var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Uf(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},t.prototype.rejectListen=function(u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new Hp(Op.comparator)).insert(n,new Fd(n,Qp.forDeletedDoc())),i=ad().add(n),o=new ag(Qp.MIN,{},new Xp(dp),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Uf(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(Py)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(n,r,i){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(xf(Zg,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Ff("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,Py(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},t.prototype.rejectFailedWrite=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,Py(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Hp(dp)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Uf(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof Xg)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Jg){xf(Zg,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Ff("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){xf(Zg,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=vg.atPath(e.path);this.limboResolutionsByTarget[n]=new ev(e),this.remoteStore.listen(new wy(r,n,yy.LimboResolution,Cp.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return ai(this,void 0,void 0,function(){var o,a,e,s=this;return si(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=Yg.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Uf(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?[4,this.localStore.handleUserChange(r)]:[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},t.prototype.applyPrimaryState=function(c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return si(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Hf(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var e=this;Hf(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Hp(Op.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=h,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return t.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=t.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Uf(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Uf(!!(c=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:t.sent(),t.label=9;case 9:e.push(a),t.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ym(e)},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(s,u,c){return ai(this,void 0,void 0,function(){var n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(this.isPrimary)return xf(Zg,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[s])return[3,11];switch(u){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return t.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return n=t.sent(),r=ag.createSynthesizedRemoteEventForCurrentChange(s,"current"===u),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 3:return t.sent(),[3,11];case 4:return i=t.sent(),(e=i).code!==Bf.DATA_LOSS||e.message!==Bd?[3,6]:(o=[],Hf(this.queryViewsByTarget,function(t){return o.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(o)]);case 5:return t.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return a=this.queryViewsByTarget[s],this.removeAndCleanupQuery(a),[4,this.localStore.releaseQuery(a.query,!0)];case 9:return t.sent(),this.syncEngineListener.onWatchError(a.query,c),[3,11];case 10:Ff("Unexpected target state: "+u),t.label=11;case 11:return[2]}var e})})},t.prototype.applyActiveTargetsChange=function(l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return si(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Uf(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return Uf(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return si(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(Py)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?ad().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:ad()},t}(),rv=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),iv="SharedClientState",ov="firestore_clients",av="firestore_mutations",sv="firestore_targets",uv=function(){function a(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Uf(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return a.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new jf(r.error.code,r.error.message)),i?new a(t,e,r.state,o):(Mf(iv,"Failed to parse mutation state for ID '"+e+"': "+n),null)},a.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},a}(),cv=function(){function o(t,e,n){this.targetId=t,this.state=e,Uf(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return o.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new jf(n.error.code,n.error.message)),r?new o(t,n.state,i):(Mf(iv,"Failed to parse target state for ID '"+t+"': "+e),null)},o.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},o}(),hv=function(){function a(t,e){this.clientId=t,this.activeTargetIds=e}return a.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ud(),o=0;r&&o<n.activeTargetIds.length;++o)r=Om(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new a(t,i):(Mf(iv,"Failed to parse client data for instance '"+t+"': "+e),null)},a}(),lv=function(){function n(t,e){this.clientId=t,this.onlineState=e}return n.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in Fm&&"string"==typeof e.clientId?new n(e.clientId,Fm[e.onlineState]):(Mf(iv,"Failed to parse online state: "+t),null)},n}(),fv=function(){function t(){this.activeTargetIds=ud()}return t.prototype.addQueryTarget=function(t){Uf(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),pv=function(){function a(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!a.isAvailable(this.platform))throw new jf(Bf.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new fv,this.clientStateKeyRe=new RegExp("^"+ov+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+av+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+sv+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}return a.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},a.prototype.start=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return si(this,function(t){switch(t.label){case 0:return Uf(!this.started,"WebStorageSharedClientState already started"),Uf(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Uf(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=hv.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},a.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},a.prototype.getAllActiveQueryTargets=function(){var n=ud();return Gf(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},a.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},a.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},a.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},a.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=cv.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},a.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},a.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},a.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},a.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},a.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},a.prototype.setOnlineState=function(t){this.persistOnlineState(t)},a.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},a.prototype.getItem=function(t){var e=this.storage.getItem(t);return xf(iv,"READ",t,e),e},a.prototype.setItem=function(t,e){xf(iv,"SET",t,e),this.storage.setItem(t,e)},a.prototype.removeItem=function(t){xf(iv,"REMOVE",t),this.storage.removeItem(t)},a.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(xf(iv,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Mf("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Uf(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Cp.INVALID;if(null!=t)try{var n=JSON.parse(t);Uf("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Mf(iv,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Cp.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(a.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),a.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},a.prototype.persistMutationState=function(t,e,n){var r=new uv(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},a.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},a.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Fm[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},a.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new cv(t,e,n);this.setItem(r,i.toWebStorageJSON())},a.prototype.toWebStorageClientStateKey=function(t){return Uf(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),ov+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageQueryTargetMetadataKey=function(t){return sv+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageMutationBatchKey=function(t){var e=av+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},a.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},a.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Uf(null!==n,"Cannot parse client state key '"+t+"'"),hv.fromWebStorageEntry(n,e)},a.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Uf(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return uv.fromWebStorageEntry(new rv(i),r,e)},a.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Uf(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return cv.fromWebStorageEntry(r,e)},a.prototype.fromWebStorageOnlineState=function(t){return lv.fromWebStorageEntry(t)},a.prototype.handleMutationBatchEvent=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return e.user.uid!==this.currentUser.uid?(xf(iv,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},a.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},a.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},a.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},a}();var dv=function(){function t(){this.localState=new fv,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new fv,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),yv="FirestoreClient",mv=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Iy.withCacheSize(this.cacheSizeBytes)},t}(),gv=function(){},vv=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=pp.newId(),this._clientShutdown=!1}return t.prototype.start=function(t){var n=this;this.verifyNotShutdown();var r=new Pp,i=new Pp,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof mv?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof jf?t.code===Bf.FAILED_PRECONDITION||t.code===Bf.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotShutdown=function(){if(this._clientShutdown)throw new jf(Bf.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=Oy.buildStoragePrefix(this.databaseInfo),a=new Qg(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ai(t,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!pv.isAvailable(this.platform))throw new jf(Bf.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=i.lruParams(),i.synchronizeTabs?(this.sharedClientState=new pv(this.asyncQueue,this.platform,o,this.clientId,r),[4,Oy.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return e=t.sent(),[3,4];case 2:return this.sharedClientState=new dv,[4,Oy.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n)];case 3:e=t.sent(),t.label=4;case 4:return[2,(this.persistence=e).referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Tm.createEagerPersistence(this.clientId),this.sharedClientState=new dv,Promise.resolve(null)},t.prototype.initializeRest=function(u,c){var t=this;return xf(yv,"Initializing. user=",u.uid),this.platform.loadConnection(this.databaseInfo).then(function(s){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a=this;return si(this,function(t){switch(t.label){case 0:return this.localStore=new vm(this.persistence,u),c&&(this.lruScheduler=new Cy(c,this.asyncQueue,this.localStore)),e=this.platform.newConnectivityMonitor(),n=this.platform.newSerializer(this.databaseInfo.databaseId),r=new Km(this.asyncQueue,s,this.credentials,n),i=function(t){return a.syncEngine.applyOnlineStateChange(t,qm.RemoteStore)},o=function(t){return a.syncEngine.applyOnlineStateChange(t,qm.SharedClientState)},this.remoteStore=new mg(this.localStore,r,this.asyncQueue,i,e),this.syncEngine=new nv(this.localStore,this.remoteStore,this.sharedClientState,u),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Gg(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),xf(yv,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueue(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this._clientShutdown?[3,4]:(this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()]);case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:t.sent(),this.credentials.removeChangeListener(),this._clientShutdown=!0,t.label=4;case 4:return[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new zg(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Ld)return t;if(t instanceof Fd)return null;throw new jf(Bf.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=ad(),n=new $g(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new Pp;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(t.prototype,"clientShutdown",{get:function(){return this._clientShutdown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),bv=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),wv=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+fp(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Zf("FieldPath","string",n,t[n]),0===t[n].length)throw new jf(Bf.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rp(t)}return e.documentId=function(){return e._DOCUMENT_ID},e.prototype.isEqual=function(t){if(!(t instanceof e))throw hp("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},e._DOCUMENT_ID=new e(Rp.keyField().canonicalString()),e}(),_v=new RegExp("[~\\*/\\[\\]]");var Ev=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},Tv=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Uf(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(rv.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Uf(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Sv=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var e=this;Uf(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new jf(Bf.ABORTED,"getToken aborted due to token change.");return t?(Uf("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Ev(t.accessToken,e.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Uf(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Uf(null!=this.tokenListener,"removeChangeListener() called twice"),Uf(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Uf(null===t||"string"==typeof t,"Received invalid UID: "+t),new rv(t)},t}(),Iv=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=rv.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),Cv=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new Iv(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(rv.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Nv(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var Av,kv,Dv=function(){function t(t){this._methodName=t}return t.delete=function(){return Yf("FieldValue.delete",arguments),Rv.instance},t.serverTimestamp=function(){return Yf("FieldValue.serverTimestamp",arguments),Ov.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Jf("FieldValue.arrayUnion",arguments,1),new Pv(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Jf("FieldValue.arrayRemove",arguments,1),new xv(t)},t.increment=function(t){return Zf("FieldValue.increment","number",1,t),Xf("FieldValue.increment",arguments,1),new Mv(t)},t.prototype.isEqual=function(t){return this===t},t}(),Rv=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return ii(e,t),e.instance=new e,e}(Dv),Ov=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return ii(e,t),e.instance=new e,e}(Dv),Pv=function(n){function t(t){var e=n.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}return ii(t,n),t}(Dv),xv=function(n){function t(t){var e=n.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}return ii(t,n),t}(Dv),Mv=function(n){function t(t){var e=n.call(this,"FieldValue.increment")||this;return e._operand=t,e}return ii(t,n),t}(Dv),Lv=Wf(Dv,"Use FieldValue.<field>() instead."),Fv=/^__.*__$/,Uv=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new fm(t,this.data,this.fieldMask,e)):n.push(new lm(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new pm(t,this.fieldTransforms)),n},t}(),qv=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new fm(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new pm(t,this.fieldTransforms)),n},t}();function Vv(t){switch(t){case Av.Set:case Av.MergeSet:case Av.Update:return!0;case Av.Argument:return!1;default:throw Ff("Unexpected case for UserDataSource: "+t)}}(kv=Av||(Av={}))[kv.Set=0]="Set",kv[kv.Update=1]="Update",kv[kv.MergeSet=2]="MergeSet",kv[kv.Argument=3]="Argument";var Bv=function(){function r(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return r.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},r.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},r.prototype.childContextForArray=function(t){return new r(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},r.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new jf(Bf.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},r.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},r.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},r.prototype.validatePathSegment=function(t){if(Vv(this.dataSource)&&Fv.test(t))throw this.createError("Document fields cannot begin and end with __")},r}(),jv=function(t,e){this.databaseId=t,this.key=e},Wv=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Bv(Av.Set,t,Rp.EMPTY_PATH);Qv("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Uv(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Bv(Av.MergeSet,t,Rp.EMPTY_PATH);Qv("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Xp(Rp.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof wv)l=h._internalPath;else{if("string"!=typeof h)throw Ff("Expected stringOrFieldPath to be a string or a FieldPath");l=Gv(t,h)}if(!r.contains(l))throw new jf(Bf.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=am.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=am.fromArray(r.fieldMask),o=r.fieldTransforms;return new Uv(a,i,o)},t.prototype.parseUpdateData=function(o,t){var a=this,s=new Bv(Av.Update,o,Rp.EMPTY_PATH);Qv("Data must be an object, but it was:",s,t);var u=new Xp(Rp.comparator),c=im.EMPTY;Gf(t,function(t,e){var n=Gv(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof Rv)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=am.fromSet(u);return new qv(c,e,s.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Bv(Av.Update,t,Rp.EMPTY_PATH),o=[Hv(t,e)],a=[n];if(r.length%2!=0)throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Hv(t,r[s])),a.push(r[s+1]);var u=new Xp(Rp.comparator),c=im.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Rv)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=am.fromSet(u);return new qv(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Bv(Av.Argument,t,Rp.EMPTY_PATH),r=this.parseData(e,n);return Uf(null!=r,"Parsed data should not be null."),Uf(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=zv(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Kv(t=this.runPreConverter(t,e)))return Qv("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Dv)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,r){var i=this,o=new Hp(dp);return zf(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Gf(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new im(o)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Ky.INSTANCE),n.push(s),r++}return new om(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Vv(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Rv){if(e.dataSource!==Av.MergeSet)throw e.dataSource===Av.Update?(Uf(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Ov)e.fieldTransforms.push(new sm(e.path,Og.instance));else if(t instanceof Pv){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Pg(n);e.fieldTransforms.push(new sm(e.path,r))}else if(t instanceof xv){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new xg(n);e.fieldTransforms.push(new sm(e.path,i))}else if(t instanceof Mv){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new Mg(o);e.fieldTransforms.push(new sm(e.path,a))}else Ff("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Ky.INSTANCE;if("number"==typeof t)return Om(t)?new Xy(t):new Jy(t);if("boolean"==typeof t)return Qy.of(t);if("string"==typeof t)return new $y(t);if(t instanceof Date)return new Zy(Kp.fromDate(t));if(t instanceof Kp)return new Zy(new Kp(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof gg)return new rm(t);if(t instanceof _p)return new em(t);if(t instanceof jv)return new nm(t.databaseId,t.key);throw e.createError("Unsupported field value: "+sp(t))},t.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new Bv(Av.Argument,r,Rp.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},t}();function Kv(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Kp||t instanceof gg||t instanceof _p||t instanceof jv||t instanceof Dv)}function Qv(t,e,n){if(!Kv(n)||!ap(n)){var r=sp(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Hv(t,e){if(e instanceof wv)return e._internalPath;if("string"==typeof e)return Gv(t,e);throw new jf(Bf.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Gv(e,t){try{return function(e){if(0<=e.search(_v))throw new jf(Bf.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(wv.bind.apply(wv,[void 0].concat(e.split("."))))}catch(t){throw new jf(Bf.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=zv(t);throw new jf(Bf.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function zv(t){return t instanceof Error?t.message:t.toString()}var Yv=Iy.COLLECTION_DISABLED,Xv=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new jf(Bf.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ep("settings","non-empty string","host",t.host),this.host=t.host,np("settings","boolean","ssl",t.ssl),this.ssl=Qf(t.ssl,!0);if(cp("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),np("settings","object","credentials",t.credentials),this.credentials=t.credentials,np("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Mf("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Mf("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Qf(t.timestampsInSnapshots,!0),np("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Iy.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Yv&&t.cacheSizeBytes<Iy.MINIMUM_CACHE_SIZE_BYTES)throw new jf(Bf.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Iy.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}np("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),Jv=function(){},$v=function(){function o(t){var e=this;this._queue=new Mp,this.INTERNAL={delete:function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}};var n=new Jv;if("object"==typeof t.options){var r=t;n.firebaseApp=r,n.databaseId=o.databaseIdFromApp(r),n.persistenceKey=n.firebaseApp.name,n.credentials=new Sv(r)}else{var i=t;if(!i.projectId)throw new jf(Bf.INVALID_ARGUMENT,"Must provide projectId");n.databaseId=new Ip(i.projectId,i.database),n.persistenceKey="[DEFAULT]",n.credentials=new Tv}n.settings=new Xv({}),this._config=n,this._databaseId=n.databaseId}return o.prototype.settings=function(t){if(Xf("Firestore.settings",arguments,1),Zf("Firestore.settings","object",1,t),Kf(t,"persistence"))throw new jf(Bf.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Xv(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new jf(Bf.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._config.settings=e).credentials&&(this._config.credentials=function(t){if(!t)return new Tv;switch(t.type){case"gapi":var e=t.client;return Uf(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Cv(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new jf(Bf.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},o.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},o.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},o.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new jf(Bf.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Mf("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Qf(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new mv(this._config.settings.cacheSizeBytes,e))},o.prototype.clearPersistence=function(){var t=this,n=Oy.buildStoragePrefix(this.makeDatabaseInfo()),r=new Pp;return this._queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new jf(Bf.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Oy.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},o.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new gv),this._firestoreClient},o.prototype.makeDatabaseInfo=function(){return new Tp(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},o.prototype.configureClient=function(t){var r=this;Uf(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Uf(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._dataConverter=new Wv(function(t){if(t instanceof eb){var e=r._config.databaseId,n=t.firestore._config.databaseId;if(!n.isEqual(e))throw new jf(Bf.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new jv(r._config.databaseId,t._key)}return t}),this._firestoreClient=new vv(qf.getPlatform(),e,this._config.credentials,this._queue),this._firestoreClient.start(t)},o.databaseIdFromApp=function(t){var e=t.options;if(!Kf(e,"projectId"))throw new jf(Bf.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new jf(Bf.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ip(n)},Object.defineProperty(o.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new jf(Bf.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),o.prototype.collection=function(t){return Xf("Firestore.collection",arguments,1),Zf("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new sb(kp.fromString(t),this)},o.prototype.doc=function(t){return Xf("Firestore.doc",arguments,1),Zf("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),eb.forPath(kp.fromString(t),this)},o.prototype.collectionGroup=function(t){if(Xf("Firestore.collectionGroup",arguments,1),Zf("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new jf(Bf.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new ob(new vg(kp.EMPTY_PATH,t),this)},o.prototype.runTransaction=function(e){var n=this;return Xf("Firestore.runTransaction",arguments,1),Zf("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new Zv(n,t))})},o.prototype.batch=function(){return this.ensureClientConfigured(),new tb(this)},Object.defineProperty(o,"logLevel",{get:function(){switch(Of()){case Ef.DEBUG:return"debug";case Ef.ERROR:return"error";case Ef.SILENT:return"silent";default:return Ff("Unknown log level: "+Of())}},enumerable:!0,configurable:!0}),o.setLogLevel=function(t){switch(Xf("Firestore.setLogLevel",arguments,1),Zf("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Pf(Ef.DEBUG);break;case"error":Pf(Ef.ERROR);break;case"silent":Pf(Ef.SILENT);break;default:throw new jf(Bf.INVALID_ARGUMENT,"Invalid log level: "+t)}},o.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},o}(),Zv=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var n=this;Xf("Transaction.get",arguments,1);var r=lb("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Ff("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Fd)return new rb(n._firestore,r._key,null,!1,!1);if(e instanceof Ld)return new rb(n._firestore,r._key,e,!1,!1);throw Ff("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},t.prototype.set=function(t,e,n){$f("Transaction.set",arguments,2,3);var r=lb("Transaction.set",t,this._firestore),i=(n=ub("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof wv?(Jf("Transaction.update",arguments,3),r=lb("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Xf("Transaction.update",arguments,2),r=lb("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Xf("Transaction.delete",arguments,1);var e=lb("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),tb=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){$f("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=lb("WriteBatch.set",t,this._firestore),i=(n=ub("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,cm.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof wv?(Jf("WriteBatch.update",arguments,3),r=lb("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Xf("WriteBatch.update",arguments,2),r=lb("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,cm.exists(!0))),this},t.prototype.delete=function(t){Xf("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=lb("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new dm(e._key,cm.NONE)),this},t.prototype.commit=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new jf(Bf.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),eb=function(){function n(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return n.forPath=function(t,e){if(t.length%2!=0)throw new jf(Bf.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new n(new Op(t),e)},Object.defineProperty(n.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new sb(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),n.prototype.collection=function(t){if(Xf("DocumentReference.collection",arguments,1),Zf("DocumentReference.collection","non-empty string",1,t),!t)throw new jf(Bf.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=kp.fromString(t);return new sb(this._key.path.child(e),this.firestore)},n.prototype.isEqual=function(t){if(!(t instanceof n))throw hp("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},n.prototype.set=function(t,e){$f("DocumentReference.set",arguments,1,2);var n=(e=ub("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,cm.NONE))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof wv?(Jf("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Xf("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,cm.exists(!0)))},n.prototype.delete=function(){return Xf("DocumentReference.delete",arguments,0),this._firestoreClient.write([new dm(this._key,cm.NONE)])},n.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];$f("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Nv(t[i])||(cp("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),np("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=Nv(t[i])?t[i]:(Zf("DocumentReference.onSnapshot","function",i,t[i]),tp("DocumentReference.onSnapshot","function",i+1,t[i+1]),tp("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},n.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new bv({next:function(t){if(n.next){Uf(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new rb(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(vg.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},n.prototype.get=function(n){var r=this;return $f("DocumentReference.get",arguments,0,1),hb("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new rb(r.firestore,r._key,t,!0,t instanceof Ld&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},n.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new jf(Bf.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new jf(Bf.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},n}(),nb=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),rb=function(){function e(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return e.prototype.data=function(t){return $f("DocumentSnapshot.data",arguments,0,1),t=cb("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,jy.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},e.prototype.get=function(t,e){if($f("DocumentSnapshot.get",arguments,1,2),e=cb("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Hv("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,jy.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new eb(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return new nb(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){if(!(t instanceof e))throw hp("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},e.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},e.prototype.convertValue=function(t,e){if(t instanceof im)return this.convertObject(t,e);if(t instanceof om)return this.convertArray(t,e);if(t instanceof nm){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Mf("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new eb(n,this._firestore)}return t.value(e)},e.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},e}(),ib=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return ii(t,n),t.prototype.data=function(t){var e=n.prototype.data.call(this,t);return Uf("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},t}(rb),ob=function(){function l(t,e){this._query=t,this.firestore=e}return l.prototype.where=function(t,e,n){if(Xf("Query.where",arguments,3),up("Query.where",3,n),"in"!==e&&"array-contains-any"!==e){!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new jf(Bf.INVALID_ARGUMENT,"Invalid value "+sp(r)+" provided to function "+t+"() for its "+lp(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e)}var r,i=Hv("Query.where",t),o=wg.fromString(e);if(i.isKeyField()){if(o===wg.ARRAY_CONTAINS||o===wg.ARRAY_CONTAINS_ANY)throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===wg.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new om(a)}else r=this.parseDocumentIdValue(n)}else o!==wg.IN&&o!==wg.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=_g.create(i,o,r);return this.validateNewFilter(h),new l(this._query.addFilter(h),this.firestore)},l.prototype.orderBy=function(t,e){var n;if($f("Query.orderBy",arguments,1,2),tp("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Ng.ASCENDING;else{if("desc"!==e)throw new jf(Bf.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Ng.DESCENDING}if(null!==this._query.startAt)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Hv("Query.orderBy",t),i=new kg(r,n);return this.validateNewOrderBy(i),new l(this._query.addOrderBy(i),this.firestore)},l.prototype.limit=function(t){if(Xf("Query.limit",arguments,1),Zf("Query.limit","number",1,t),t<=0)throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new l(this._query.withLimit(t),this.firestore)},l.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jf("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new l(this._query.withStartAt(r),this.firestore)},l.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jf("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new l(this._query.withStartAt(r),this.firestore)},l.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jf("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new l(this._query.withEndAt(r),this.firestore)},l.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jf("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new l(this._query.withEndAt(r),this.firestore)},l.prototype.isEqual=function(t){if(!(t instanceof l))throw hp("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},l.prototype.boundFromDocOrFields=function(t,e,n,r){if(up(t,1,e),e instanceof rb){if(0<n.length)throw new jf(Bf.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new jf(Bf.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},l.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new nm(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof tm)throw new jf(Bf.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new Ag(r,n)},l.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new jf(Bf.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(kp.fromString(a));if(!Op.isDocumentKey(s))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Op(s);i.push(new nm(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new Ag(i,n)},l.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];$f("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Nv(t[i])||(cp("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),np("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Nv(t[i])?t[i]:(Zf("Query.onSnapshot","function",i,t[i]),tp("Query.onSnapshot","function",i+1,t[i+1]),tp("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},l.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new bv({next:function(t){e.next&&e.next(new ab(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},l.prototype.get=function(n){var r=this;return $f("Query.get",arguments,0,1),hb("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new ab(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},l.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new jf(Bf.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},l.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(kp.fromString(t));if(!Op.isDocumentKey(e))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new nm(this.firestore._databaseId,new Op(e))}if(t instanceof eb){var n=t;return new nm(this.firestore._databaseId,n._key)}throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+sp(t)+".")},l.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new jf(Bf.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},l.prototype.validateNewFilter=function(t){if(t instanceof _g){var e=[wg.ARRAY_CONTAINS,wg.ARRAY_CONTAINS_ANY],n=[wg.IN,wg.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new jf(Bf.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new jf(Bf.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},l.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},l.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new jf(Bf.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},l}(),ab=function(){function e(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new nb(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,n){var r=this;$f("QuerySnapshot.forEach",arguments,1,2),Zf("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(e.prototype,"query",{get:function(){return new ob(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),e.prototype.docChanges=function(t){t&&(cp("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),np("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new jf(Bf.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){{if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new ib(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Uf(t.type===Jm.Added,"Invalid event type for first snapshot"),Uf(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==Jm.Metadata}).map(function(t){var e=new ib(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==Jm.Added&&(Uf(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==Jm.Removed&&(a=a.add(t.doc),r=a.indexOf(t.doc.key)),{type:function(t){switch(t){case Jm.Added:return"added";case Jm.Modified:case Jm.Metadata:return"modified";case Jm.Removed:return"removed";default:return Ff("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},e.prototype.isEqual=function(t){if(!(t instanceof e))throw hp("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},e.prototype.convertToDocumentImpl=function(t){return new ib(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},e}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(ab.prototype.docChanges,t,{get:function(){return function(){throw new jf(Bf.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var sb=function(r){function t(t,e){var n=r.call(this,vg.atPath(t),e)||this;if(t.length%2!=1)throw new jf(Bf.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}return ii(t,r),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new eb(new Op(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.doc=function(t){if($f("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=pp.newId()),Zf("CollectionReference.doc","non-empty string",1,t),""===t)throw new jf(Bf.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=kp.fromString(t);return eb.forPath(this._query.path.child(e),this.firestore)},t.prototype.add=function(t){Xf("CollectionReference.add",arguments,1),Zf("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},t}(ob);function ub(t,e){if(void 0===e)return{merge:!1};if(cp(t,e,["merge","mergeFields"]),np(t,"boolean","merge",e.merge),rp(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof wv}),void 0!==e.mergeFields&&void 0!==e.merge)throw new jf(Bf.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function cb(t,e){return void 0===e?{}:(cp(t,e,["serverTimestamps"]),ip(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function hb(t,e){tp(t,"object",1,e),e&&(cp(t,e,["source"]),ip(t,0,"source",e.source,["default","server","cache"]))}function lb(t,e,n){if(e instanceof eb){if(e.firestore!==n)throw new jf(Bf.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw hp(t,"DocumentReference",1,e)}var fb=Wf($v,"Use firebase.firestore() instead."),pb=Wf(Zv,"Use firebase.firestore().runTransaction() instead."),db=Wf(tb,"Use firebase.firestore().batch() instead."),yb=Wf(eb,"Use firebase.firestore().doc() instead."),mb=Wf(rb),gb=Wf(ib),vb=Wf(ob),bb=Wf(ab),wb=Wf(sb,"Use firebase.firestore().collection() instead."),_b={Firestore:fb,GeoPoint:gg,Timestamp:Kp,Blob:Ep,Transaction:pb,WriteBatch:db,DocumentReference:yb,DocumentSnapshot:mb,Query:vb,QueryDocumentSnapshot:gb,QuerySnapshot:bb,CollectionReference:wb,FieldPath:wv,FieldValue:Lv,setLogLevel:$v.setLogLevel,CACHE_SIZE_UNLIMITED:Yv};function Eb(t){t.INTERNAL.registerService("firestore",function(t){return new $v(t)},function(t){Uf(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(_b))}var Tb=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),Sb="ConnectivityMonitor",Ib=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){xf(Sb,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){xf(Sb,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Cb=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Uf(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Uf(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Uf(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Uf(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Uf(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Uf(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),Nb="Connection",Ab={BatchGetDocuments:"batchGet",Commit:"commit"},kb="gl-js/ fire/"+Df,Db=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=kb},t.prototype.invokeRPC=function(c,n,r){var i=this,o=this.makeUrl(c);return new Promise(function(a,s){var u=new kf;u.listenOnce(Nf.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Cf.NO_ERROR:var t=u.getResponseJson();xf(Nb,"XHR received:",JSON.stringify(t)),a(t);break;case Cf.TIMEOUT:xf(Nb,'RPC "'+c+'" timed out'),s(new jf(Bf.DEADLINE_EXCEEDED,"Request time out"));break;case Cf.HTTP_ERROR:var e=u.getStatus();if(xf(Nb,'RPC "'+c+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status,o=i.toLowerCase().replace("_","-"),0<=Object.values(Bf).indexOf(o)?o:Bf.UNKNOWN);s(new jf(r,n.message))}else s(new jf(Bf.UNKNOWN,"Server responded with status "+u.getStatus()))}else xf(Nb,'RPC "'+c+'" failed'),s(new jf(Bf.UNAVAILABLE,"Connection failed."));break;default:Ff('RPC "'+c+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{xf(Nb,'RPC "'+c+'" completed.')}var i,o});var t=JSON.stringify(n);xf(Nb,"XHR sending: ",o+" "+t);var e={"Content-Type":"text/plain"};i.modifyHeadersForRequest(e,r),u.send(o,"POST",t,e,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=If(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ei()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");xf(Nb,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),a=!1,u=!1,c=new Cb({sendFn:function(t){u?xf(Nb,"Not sending because WebChannel is closed:",t):(a||(xf(Nb,"Opening WebChannel transport."),s.open(),a=!0),xf(Nb,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),h=function(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(Af.EventType.OPEN,function(){u||xf(Nb,"WebChannel transport opened.")}),h(Af.EventType.CLOSE,function(){u||(u=!0,xf(Nb,"WebChannel transport closed"),c.callOnClose())}),h(Af.EventType.ERROR,function(t){u||(u=!0,xf(Nb,"WebChannel transport errored:",t),c.callOnClose(new jf(Bf.UNAVAILABLE,"The operation could not be completed")))}),h(Af.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];Uf(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){xf(Nb,"WebChannel received error:",r);var i=r.status,o=function(t){var e=Hm[t];if(void 0!==e)return Xm(e)}(i),a=r.message;void 0===o&&(o=Bf.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),u=!0,c.callOnClose(new jf(o,a)),s.close()}else xf(Nb,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=Ab[t];Uf(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),Rb=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Db(t))},t.prototype.newConnectivityMonitor=function(){return Ib.isAvailable()?new Ib:new Tb},t.prototype.newSerializer=function(t){return new Qg(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();qf.setPlatform(new Rb),Eb(Jh);var Ob={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Pb=function(i){function o(t,e,n){var r=i.call(this,e)||this;return Object.setPrototypeOf(r,o.prototype),r.code=t,r.details=n,r}return ii(o,i),o}(Error);var xb=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},t}();function Mb(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var Lb=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return Mb(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?Mb(t,function(t){return e.decode(t)}):t},t}();var Fb,Ub,qb=function(){function t(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new Lb,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new xb(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},t.prototype.postJSON=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},t.prototype.call=function(h,l,f){return ai(this,void 0,void 0,function(){var e,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:return e=this._url(h),l=this.serializer.encode(l),r={data:l},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=t.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),a=f.timeout||7e4,[4,Promise.race([this.postJSON(e,r,i),(n=a,new Promise(function(t,e){setTimeout(function(){e(new Pb("deadline-exceeded","deadline-exceeded"))},n)})),this.cancelAllRequests])];case 2:if(!(s=t.sent()))throw new Pb("cancelled","Firebase Functions instance was deleted.");if(u=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!Ob[s])return new Pb("internal","internal");r=Ob[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new Pb(r,i,o)}(s.status,s.json,this.serializer))throw u;if(!s.json)throw new Pb("internal","Response is not valid JSON object.");if(void 0===(c=s.json.data)&&(c=s.json.result),void 0===c)throw new Pb("internal","Response is missing data field.");return[2,{data:this.serializer.decode(c)}]}var n})})},t}();function Vb(t,e,n){return new qb(t,n)}Fb={Functions:qb},Jh.INTERNAL.registerService("functions",Vb,Fb,void 0,!0);var Bb,jb,Wb,Kb,Qb=((Ub={})["only-available-in-window"]="This method is available in a Window context.",Ub["only-available-in-sw"]="This method is available in a service worker context.",Ub["should-be-overriden"]="This method should be overriden by extended classes.",Ub["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",Ub["permission-default"]="The required permissions were not granted and dismissed instead.",Ub["permission-blocked"]="The required permissions were not granted and blocked instead.",Ub["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",Ub["notifications-blocked"]="Notifications have been blocked.",Ub["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",Ub["sw-registration-expected"]="A service worker registration was the expected input.",Ub["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",Ub["invalid-saved-token"]="Unable to access details of the saved token.",Ub["sw-reg-redundant"]="The service worker being used for push was made redundant.",Ub["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",Ub["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",Ub["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",Ub["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",Ub["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",Ub["token-update-no-token"]="FCM returned no token when updating the user to push.",Ub["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",Ub["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",Ub["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",Ub["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",Ub["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",Ub["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",Ub["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",Ub["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",Ub["failed-to-delete-token"]="Unable to delete the currently saved token.",Ub["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",Ub["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",Ub["bad-scope"]="The service worker scope must be a string with at least one character.",Ub["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",Ub["bad-subscription"]="The subscription must be a valid PushSubscription.",Ub["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",Ub["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",Ub["failed-delete-vapid-key"]="The VAPID key could not be deleted.",Ub["invalid-public-vapid-key"]="The public VAPID key must be a string.",Ub["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",Ub["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",Ub),Hb=new Ii("messaging","Messaging",Qb),Gb=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),zb="https://fcm.googleapis.com";function Yb(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function Xb(t){var e;return(e=new Uint8Array(t),btoa(String.fromCharCode.apply(String,hi(e)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(jb=Bb||(Bb={})).TYPE_OF_MSG="firebase-messaging-msg-type",jb.DATA="firebase-messaging-msg-data",(Kb=Wb||(Wb={})).PUSH_MSG_RECEIVED="push-msg-received",Kb.NOTIFICATION_CLICKED="notification-clicked";var Jb=function(){function t(){}return t.prototype.getToken=function(h,l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=Xb(l.getKey("p256dh")),n=Xb(l.getKey("auth")),r="authorized_entity="+h+"&endpoint="+l.endpoint+"&encryption_key="+e+"&encryption_auth="+n,Yb(f.buffer,Gb.buffer)||(i=Xb(f),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(zb+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),Hb.create("token-subscribe-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,Hb.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw Hb.create("token-subscribe-no-token");if(!s.pushSet)throw Hb.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},t.prototype.updateToken=function(h,l,f,p,d){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=Xb(p.getKey("p256dh")),n=Xb(p.getKey("auth")),r="push_set="+f+"&token="+l+"&authorized_entity="+h+"&endpoint="+p.endpoint+"&encryption_key="+e+"&encryption_auth="+n,Yb(d.buffer,Gb.buffer)||(i=Xb(d),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(zb+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),Hb.create("token-update-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,Hb.create("token-update-failed",{errorInfo:c});if(!s.token)throw Hb.create("token-update-no-token");return[2,s.token]}})})},t.prototype.deleteToken=function(s,u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:e="authorized_entity="+s+"&token="+u+"&pushSet="+c,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(zb+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,Hb.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw a=t.sent(),Hb.create("token-unsubscribe-failed",{errorInfo:a});case 5:return[2]}})})},t}();function $b(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Zb="undefined",tw="fcm_token_object_Store";function ew(){var e=indexedDB.open(Zb);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(tw)){var t=n.transaction(tw).objectStore(tw),r=new Jb,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(Zb)}}}(e.result)}}var nw=function(){function t(){this.dbPromise=null}return t.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},t.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},t.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},t.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},t.prototype.closeDatabase=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(a,s){return void 0===s&&(s="readonly"),ai(this,void 0,void 0,function(){var e,r,i,o;return si(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),r=e.transaction(this.objectStoreName,s),i=r.objectStore(this.objectStoreName),[4,(n=a(i),new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}}))];case 2:return o=t.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}var n})})},t.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},t}();var rw=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}return ii(t,e),t.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:ew();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=oi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=$b(e.vapidKey)),"string"==typeof e.auth&&(n.auth=$b(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=$b(e.p256dh).buffer),t.update(n),t.continue()}}}},t.prototype.getTokenDetailsFromToken=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Hb.create("bad-token");return iw({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},t.prototype.getTokenDetailsFromSWScope=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Hb.create("bad-scope");return iw({swScope:e}),[2,this.get(e)]})})},t.prototype.saveTokenDetails=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e.swScope)throw Hb.create("bad-scope");if(!e.vapidKey)throw Hb.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw Hb.create("bad-subscription");if(!e.fcmSenderId)throw Hb.create("bad-sender-id");if(!e.fcmToken)throw Hb.create("bad-token");if(!e.fcmPushSet)throw Hb.create("bad-push-set");return iw(e),[2,this.put(e)]})})},t.prototype.deleteToken=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(Hb.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw Hb.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},t}(nw);function iw(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Hb.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Hb.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Hb.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Hb.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Hb.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Hb.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Hb.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw Hb.create("bad-push-set")}var ow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}return ii(t,e),t.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},t.prototype.getVapidFromSWScope=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw Hb.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},t.prototype.saveVapidDetails=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){if("string"!=typeof n||0===n.length)throw Hb.create("bad-scope");if(null===r||65!==r.length)throw Hb.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},t.prototype.deleteVapidDetails=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw Hb.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},t}(nw),aw="messagingSenderId",sw=function(){function t(t){var e=this;if(!t.options[aw]||"string"!=typeof t.options[aw])throw Hb.create("bad-sender-id");this.messagingSenderId=t.options[aw],this.tokenDetailsModel=new rw,this.vapidDetailsModel=new ow,this.iidModel=new Jb,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw Hb.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},t.prototype.manageExistingToken=function(e,n,r,i){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!Yb(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Yb(t.getKey("auth"),n.auth),o=Yb(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},t.prototype.updateToken=function(i,o,a,s){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},t.prototype.getNewToken=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},t.prototype.deleteToken=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},t.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},t.prototype.requestPermission=function(){throw Hb.create("only-available-in-window")},t.prototype.useServiceWorker=function(t){throw Hb.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){throw Hb.create("only-available-in-window")},t.prototype.onMessage=function(t,e,n){throw Hb.create("only-available-in-window")},t.prototype.onTokenRefresh=function(t,e,n){throw Hb.create("only-available-in-window")},t.prototype.setBackgroundMessageHandler=function(t){throw Hb.create("only-available-in-sw")},t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}();var uw="FCM_MSG",cw=function(n){function t(t){var e=n.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}return ii(t,n),t.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},t.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},t.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},t.prototype.onPush_=function(s){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},t.prototype.onSubChange_=function(t){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),Hb.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},t.prototype.onNotificationClick_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[uw]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[uw]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=lw(Wb.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},t.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oi({},t.notification);return n.data=oi({},t.notification.data,((e={})[uw]=t,e)),n}},t.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Hb.create("bg-handler-function-expected");this.bgMessageHandler=t},t.prototype.getWindowClient_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,hw()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},t.prototype.attemptToMessageClient_=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw Hb.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},t.prototype.hasVisibleClients_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,hw()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},t.prototype.sendMessageToWindowClients_=function(i){return ai(this,void 0,void 0,function(){var e,n,r=this;return si(this,function(t){switch(t.label){case 0:return[4,hw()];case 1:return e=t.sent(),n=lw(Wb.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},t.prototype.getSWRegistration_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,self.registration]})})},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw Hb.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,Gb]:[2,n]}})})},t}(sw);function hw(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function lw(t,e){var n;return(n={})[Bb.TYPE_OF_MSG]=t,n[Bb.DATA]=e,n}var fw,pw=function(n){function t(t){var e=n.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Mi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Mi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}return ii(t,n),t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),[3,5];case 4:return t.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw Hb.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,n.prototype.getToken.call(this)]}})})},t.prototype.requestPermission=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?Hb.create("permission-blocked"):Hb.create("permission-default")}})})},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Hb.create("sw-registration-expected");if(null!=this.registrationToUse)throw Hb.create("use-sw-before-get-token");this.registrationToUse=t},t.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Hb.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw Hb.create("use-public-key-before-get-token");var e=$b(t);if(65!==e.length)throw Hb.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},t.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},t.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},t.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(Hb.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(Hb.create("sw-reg-redundant"));else t(r);else e(Hb.create("no-sw-in-reg"))})},t.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Hb.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,Gb]})})},t.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[Bb.TYPE_OF_MSG]){var e=t.data;switch(e[Bb.TYPE_OF_MSG]){case Wb.PUSH_MSG_RECEIVED:case Wb.NOTIFICATION_CLICKED:var n=e[Bb.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},t}(sw);function dw(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}fw={isSupported:dw},Jh.INTERNAL.registerService("messaging",function(t){if(!dw())throw Hb.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new cw(t):new pw(t)},fw);var yw="firebasestorage.googleapis.com",mw="storageBucket",gw=function(){function t(t,e){this.code_=bw(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return bw(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),vw={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function bw(t){return"storage/"+t}function ww(){return new gw(vw.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function _w(){return new gw(vw.CANCELED,"User canceled the upload/download.")}function Ew(){return new gw(vw.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Tw(t,e,n){return new gw(vw.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Sw(){return new gw(vw.APP_DELETED,"The Firebase app was deleted.")}function Iw(t,e){return new gw(vw.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Cw(t){throw new gw(vw.INTERNAL_ERROR,"Internal error: "+t)}var Nw={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Aw(t){switch(t){case Nw.RAW:case Nw.BASE64:case Nw.BASE64URL:case Nw.DATA_URL:return;default:throw"Expected one of the event types: ["+Nw.RAW+", "+Nw.BASE64+", "+Nw.BASE64URL+", "+Nw.DATA_URL+"]."}}var kw=function(t,e){this.data=t,this.contentType=e||null};function Dw(t,e){switch(t){case Nw.RAW:return new kw(Rw(e));case Nw.BASE64:case Nw.BASE64URL:return new kw(Ow(t,e));case Nw.DATA_URL:return new kw((n=new Pw(e)).base64?Ow(Nw.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Iw(Nw.DATA_URL,"Malformed data URL.")}return Rw(e)}(n.rest),new Pw(e).contentType)}var n;throw ww()}function Rw(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Ow(e,t){switch(e){case Nw.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Iw(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Nw.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw Iw(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw Iw(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Pw=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Iw(Nw.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(r=";base64",(n=i).length>=r.length&&n.substring(n.length-r.length)===r),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)};var xw,Mw,Lw={STATE_CHANGED:"state_changed"},Fw="running",Uw="pausing",qw="paused",Vw="success",Bw="canceling",jw="canceled",Ww="error",Kw={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Qw(t){switch(t){case Fw:case Uw:case Bw:return Kw.RUNNING;case qw:return Kw.PAUSED;case Vw:return Kw.SUCCESS;case jw:return Kw.CANCELED;case Ww:default:return Kw.ERROR}}function Hw(t){return null!=t}function Gw(t){return void 0!==t}function zw(t){return"function"==typeof t}function Yw(t){return"object"==typeof t}function Xw(t){return"string"==typeof t||t instanceof String}function Jw(t){return"number"==typeof t||t instanceof Number}function $w(t){return Zw()&&t instanceof Blob}function Zw(){return"undefined"!=typeof Blob}(Mw=xw||(xw={}))[Mw.NO_ERROR=0]="NO_ERROR",Mw[Mw.NETWORK_ERROR=1]="NETWORK_ERROR",Mw[Mw.ABORT=2]="ABORT";var t_=function(){function t(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=xw.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=xw.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=xw.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw Cw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),Hw(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return Hw(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Cw("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Cw("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Cw("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Hw(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Hw(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),e_=function(){function t(){}return t.prototype.createXhrIo=function(){return new t_},t}();function n_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Zw())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var r_=function(){function s(t,e){var n=0,r="";$w(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return s.prototype.size=function(){return this.size_},s.prototype.type=function(){return this.type_},s.prototype.slice=function(t,e){if($w(this.data_)){var n=this.data_,r=(o=t,a=e,(i=n).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new s(r)}var i,o,a;return new s(new Uint8Array(this.data_.buffer,t,e-t),!0)},s.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(Zw()){var n=t.map(function(t){return t instanceof s?t.data_:t});return new s(n_.apply(null,n))}var r=t.map(function(t){return Xw(t)?Dw(Nw.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new s(o,!0)},s.prototype.uploadData=function(){return this.data_},s}(),i_=function(){function f(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(f.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),f.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},f.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},f.makeFromBucketSpec=function(e){var t,n;try{t=f.makeFromUrl(e)}catch(t){return new f(e,"")}if(""===t.path)return t;throw n=e,new gw(vw.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")},f.makeFromUrl=function(t){var e=null,n="([A-Za-z0-9.\\-_]+)";var r=new RegExp("^gs://"+n+"(/(.*))?$","i");for(var i,o=yw.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],s=0;s<a.length;s++){var u=a[s],c=u.regex.exec(t);if(c){var h=c[u.indices.bucket],l=c[u.indices.path];l||(l=""),e=new f(h,l),u.postModify(e);break}}if(null==e)throw i=t,new gw(vw.INVALID_URL,"Invalid URL '"+i+"'.");return e},f}();function o_(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return Yw(n=e)&&!Array.isArray(n)?e:null}function a_(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function s_(t){return"https://"+yw+"/v0"+t}function u_(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function c_(t,e){return e}var h_=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||c_},l_=null;function f_(){if(l_)return l_;var t=[];t.push(new h_("bucket")),t.push(new h_("generation")),t.push(new h_("metageneration")),t.push(new h_("name","fullPath",!0));var e=new h_("name");e.xform=function(t,e){return!Xw(n=e)||n.length<2?n:a_(n);var n},t.push(e);var n=new h_("size");return n.xform=function(t,e){return Hw(e)?Number(e):e},t.push(n),t.push(new h_("timeCreated")),t.push(new h_("updated")),t.push(new h_("md5Hash",null,!0)),t.push(new h_("cacheControl",null,!0)),t.push(new h_("contentDisposition",null,!0)),t.push(new h_("contentEncoding",null,!0)),t.push(new h_("contentLanguage",null,!0)),t.push(new h_("contentType",null,!0)),t.push(new h_("metadata","customMetadata",!0)),l_=t}function p_(t,e,n){for(var r,i,o={type:"file"},a=n.length,s=0;s<a;s++){var u=n[s];o[u.local]=u.xform(o,e[u.server])}return r=o,i=t,Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new i_(t,e);return i.makeStorageReference(n)}}),o}function d_(t,e,n){var r=o_(e);return null===r?null:p_(t,r,n)}function y_(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function m_(t){if(!Yw(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!Yw(n))throw"Expected object for 'customMetadata' mapping."}else if(Yw(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var g_="maxResults",v_=1e3,b_="pageToken",w_="prefixes",__="items";function E_(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new gw(vw.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+mw+"' property when initializing the app?");if(e[w_])for(var i=0,o=e[w_];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new i_(r,a));n.prefixes.push(s)}if(e[__])for(var u=0,c=e[__];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new i_(r,h.name));n.items.push(s)}return n}function T_(t){if(!Yw(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===g_){if(!Jw(n=t[g_])||!Number.isInteger(n)||t[g_]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[g_])throw"Expected maxResults to be less than or equal to "+v_+"."}else{if(e!==b_)throw"Unknown option: "+e;if(t[b_]&&!Xw(t[b_]))throw"Expected pageToken to be string."}var n}var S_=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function I_(t){if(!t)throw ww()}function C_(r,i){return function(t,e){var n=d_(r,e,i);return I_(null!==n),n}}function N_(o){return function(t,e){var n,r,i=(n=o,null===(r=o_(e))?null:E_(n,r));return I_(null!==i),i}}function A_(r,i){return function(t,e){var n=d_(r,e,i);return I_(null!==n),function(r,t){var e=o_(t);if(null===e)return null;if(!Xw(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return s_("/b/"+i(e)+"/o/"+i(n))+u_({alt:"media",token:t})})[0]}(n,e)}}function k_(o){return function(t,e){var n,r,i;return(n=401===t.getStatus()?new gw(vw.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=o.bucket,new gw(vw.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=o.path,new gw(vw.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):e).setServerResponseProp(e.serverResponseProp()),n}}function D_(i){var o=k_(i);return function(t,e){var n,r=o(t,e);return 404===t.getStatus()&&(n=i.path,r=new gw(vw.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")),r.setServerResponseProp(e.serverResponseProp()),r}}function R_(t,e,n){var r=s_(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new S_(r,"GET",C_(t,n),i);return o.errorHandler=D_(e),o}function O_(t,e,n){var r,i,o=Object.assign({},n);return o.fullPath=t.path,o.size=e.size(),o.contentType||(o.contentType=(i=e,(r=null)&&r.contentType||i&&i.type()||"application/octet-stream")),o}var P_=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function x_(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){I_(!1)}return I_(!!n&&-1!==(e||["active"]).indexOf(n)),n}function M_(t,a,e,s,n,u,r,i){var c=new P_(0,0);if(c.total=r?(c.current=r.current,r.total):(c.current=0,s.size()),s.size()!==c.total)throw new gw(vw.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw Ew();var y=a.maxUploadRetryTime(),m=new S_(e,"POST",function(t,e){var n,r=x_(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?C_(a,u)(t,e):null,new P_(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=k_(t),m}var L_=function(t,e,n){if(zw(t)||Hw(e)||Hw(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},F_=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function U_(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=e,c=n.length,l=a===s?1===(h=a)?"argument":"arguments":(h="between "+a+" and "+s,"arguments"),new gw(vw.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?Tw(o,e,t.message):Tw(o,e,t)}}var q_=function(e,t){var n=this;this.validator=function(t){n.optional&&!Gw(t)||e(t)},this.optional=!!t};function V_(t,e){function n(t){if(!Xw(t))throw"Expected string."}var r,i,o;return r=t?(i=n,o=t,function(t){i(t),o(t)}):n,new q_(r,e)}function B_(t){return new q_(m_,t)}function j_(){return new q_(function(t){if(!(Jw(t)&&0<=t))throw"Expected a number 0 or greater."})}function W_(e,t){return new q_(function(t){if(!(null===t||Hw(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function K_(t){return new q_(function(t){if(null!==t&&!zw(t))throw"Expected a Function."},t)}function Q_(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var H_=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Fw,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(vw.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Ww))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(vw.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Ww))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},t.prototype.shouldDoResumable_=function(t){return 262144<t.size()},t.prototype.start_=function(){this.state_===Fw&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case Fw:e(t);break;case Bw:n.transition_(jw);break;case Uw:n.transition_(qw)}})},t.prototype.createResumable_=function(){var m=this;this.resolveToken_(function(t){var e,n,r,i,o,a,s,u,c,h,l,f,p,d=(e=m.authWrapper_,n=m.location_,r=m.mappings_,i=m.blob_,o=m.metadata_,a=n.bucketOnlyServerUrl(),s=O_(n,i,o),u={name:s.fullPath},c=s_(a),h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":i.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},l=y_(s,r),f=e.maxUploadRetryTime(),(p=new S_(c,"POST",function(t){var e;x_(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){I_(!1)}return I_(Xw(e)),e},f)).urlParams=u,p.headers=h,p.body=l,p.errorHandler=k_(n),p),y=m.authWrapper_.makeRequest(d,t);(m.request_=y).getPromise().then(function(t){m.request_=null,m.uploadUrl_=t,m.needToFetchStatus_=!1,m.completeTransitions_()},m.errorHandler_)})},t.prototype.fetchStatus_=function(){var c=this,h=this.uploadUrl_;this.resolveToken_(function(t){var e,n,r,i,o,a,s=(e=c.authWrapper_,n=c.location_,r=h,i=c.blob_,o=e.maxUploadRetryTime(),(a=new S_(r,"POST",function(t){var e=x_(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){I_(!1)}n||I_(!1);var r=Number(n);return I_(!isNaN(r)),new P_(r,i.size(),"final"===e)},o)).headers={"X-Goog-Upload-Command":"query"},a.errorHandler=k_(n),a),u=c.authWrapper_.makeRequest(s,t);(c.request_=u).getPromise().then(function(t){t=t,c.request_=null,c.updateProgress_(t.current),c.needToFetchStatus_=!1,t.finalized&&(c.needToFetchMetadata_=!0),c.completeTransitions_()},c.errorHandler_)})},t.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new P_(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=M_(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(Ww)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(Vw)):r.completeTransitions_()},r.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=R_(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(Vw)},r.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=O_(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+y_(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=r_.getBlob(c,r,h);if(null===l)throw Ew();var f={name:u.fullPath},p=s_(o),d=t.maxUploadRetryTime(),y=new S_(p,"POST",C_(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=k_(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(Vw)},r.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Bw:case Uw:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Fw:var e=this.state_===qw;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case qw:this.state_=t,this.notifyObservers_();break;case jw:this.error_=_w(),this.state_=t,this.notifyObservers_();break;case Ww:case Vw:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Uw:this.transition_(qw);break;case Bw:this.transition_(jw);break;case Fw:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Qw(this.state_);return new F_(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=K_(!0).validator,a=W_(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(Gw(t.next)||Gw(t.error)||Gw(t.complete)))throw"";return}catch(t){throw r}}U_("on",[V_(function(){if(t!==Lw.STATE_CHANGED)throw"Expected one of the event types: ["+Lw.STATE_CHANGED+"]."}),W_(s,!0),K_(!0),K_(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&U_("on",i,arguments);var r=new L_(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[W_(function(t){if(null===t)throw r;s(t)}),K_(!0),K_(!0)];return!(Gw(e)||Gw(n)||Gw(o))?c(h):c(null)(e,n,o)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Qw(this.state_)){case Kw.SUCCESS:Q_(this.resolve_.bind(null,this.snapshot))();break;case Kw.CANCELED:case Kw.ERROR:Q_(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Qw(this.state_)){case Kw.RUNNING:case Kw.PAUSED:t.next&&Q_(t.next.bind(t,this.snapshot))();break;case Kw.SUCCESS:t.complete&&Q_(t.complete.bind(t))();break;case Kw.CANCELED:case Kw.ERROR:t.error&&Q_(t.error.bind(t,this.error_))();break;default:t.error&&Q_(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){U_("resume",[],arguments);var t=this.state_===qw||this.state_===Uw;return t&&this.transition_(Fw),t},t.prototype.pause=function(){U_("pause",[],arguments);var t=this.state_===Fw;return t&&this.transition_(Uw),t},t.prototype.cancel=function(){U_("cancel",[],arguments);var t=this.state_===Fw||this.state_===Uw;return t&&this.transition_(Bw),t},t}(),G_=function(){function n(t,e){this.authWrapper=t,this.location=e instanceof i_?e:i_.makeFromUrl(e)}return n.prototype.toString=function(){return U_("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},n.prototype.newRef=function(t,e){return new n(t,e)},n.prototype.mappings=function(){return f_()},n.prototype.child=function(t){U_("child",[V_()],arguments);var e,n,r=(e=this.location.path,n=t.split("/").filter(function(t){return 0<t.length}).join("/"),0===e.length?n:e+"/"+n),i=new i_(this.location.bucket,r);return this.newRef(this.authWrapper,i)},Object.defineProperty(n.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new i_(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){var t=new i_(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return a_(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),n.prototype.put=function(t,e){return void 0===e&&(e=null),U_("put",[new q_(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Zw()&&t instanceof Blob))throw"Expected Blob or File."}),B_(!0)],arguments),this.throwIfRoot_("put"),new H_(this,this.authWrapper,this.location,this.mappings(),new r_(t),e)},n.prototype.putString=function(t,e,n){void 0===e&&(e=Nw.RAW),U_("putString",[V_(),V_(Aw,!0),B_(!0)],arguments),this.throwIfRoot_("putString");var r=Dw(e,t),i=Object.assign({},n);return!Hw(i.contentType)&&Hw(r.contentType)&&(i.contentType=r.contentType),new H_(this,this.authWrapper,this.location,this.mappings(),new r_(r.data,!0),i)},n.prototype.delete=function(){var s=this;return U_("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a=(e=s.authWrapper,n=s.location,r=s_(n.fullServerUrl()),i=e.maxOperationRetryTime(),(o=new S_(r,"DELETE",function(t,e){},i)).successCodes=[200,204],o.errorHandler=D_(n),o);return s.authWrapper.makeRequest(a,t).getPromise()})},n.prototype.listAll=function(){U_("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},n.prototype.listAllHelper=function(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},n.prototype.list=function(r){var t;U_("list",[(t=!0,new q_(T_,t))],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=s_(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new S_(a,"GET",N_(t),s);return u.urlParams=o,u.errorHandler=k_(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},n.prototype.getMetadata=function(){var n=this;return U_("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=R_(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},n.prototype.updateMetadata=function(h){var l=this;return U_("updateMetadata",[B_()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s,u,c=(e=l.authWrapper,n=l.location,r=h,i=l.mappings(),o=s_(n.fullServerUrl()),a=y_(r,i),s=e.maxOperationRetryTime(),(u=new S_(o,"PATCH",C_(e,i),s)).headers={"Content-Type":"application/json; charset=utf-8"},u.body=a,u.errorHandler=D_(n),u);return l.authWrapper.makeRequest(c,t).getPromise()})},n.prototype.getDownloadURL=function(){var u=this;return U_("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s=(e=u.authWrapper,n=u.location,r=u.mappings(),i=s_(n.fullServerUrl()),o=e.maxOperationRetryTime(),(a=new S_(i,"GET",A_(e,r),o)).errorHandler=D_(n),a);return u.authWrapper.makeRequest(s,t).getPromise().then(function(t){if(null===t)throw new gw(vw.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},n.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw e=t,new gw(vw.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");var e},n}(),z_=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),Y_=function(){function t(){this.map=new Map,this.id=-9007199254740991}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},t.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},t}(),X_=function(){function a(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;Hw(o)&&(this.bucket_=a.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new Y_}return a.extractBucket_=function(t){var e=t[mw]||null;return null==e?null:i_.makeFromBucketSpec(e).bucket},a.prototype.getAuthToken=function(){return null!==this.app_&&Hw(this.app_.INTERNAL)&&Hw(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},a.prototype.bucket=function(){if(this.deleted_)throw Sw();return this.bucket_},a.prototype.service=function(){return this.service_},a.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},a.prototype.makeRequest=function(t,e){if(this.deleted_)return new z_(Sw());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},a.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},a.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},a.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},a.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},a.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},a}();var J_=function(){function t(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());Gw(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=ww()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?Sw():_w()):i(n=new gw(vw.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new $_(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new $_(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===xw.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new $_(r,t))}else{var i=t.getErrorCode()===xw.ABORT;o(!1,new $_(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),$_=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function Z_(t,e,n){var r,i,o,a,s=u_(t.urlParams),u=t.url+s,c=Object.assign({},t.headers);return r=c,null!==(i=e)&&0<i.length&&(r.Authorization="Firebase "+i),o=c,a=void 0!==Jh?Jh.SDK_VERSION:"AppManager",o["X-Firebase-Storage-Version"]="webjs/"+a,new J_(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var tE,eE=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new X_(t,function(t,e){return new G_(t,e)},Z_,this,e),this.app_=t,null!=n)this.bucket_=i_.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new i_(r,""))}this.internals_=new nE(this)}return t.prototype.ref=function(t){if(U_("ref",[V_(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new G_(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return U_("refFromURL",[V_(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{i_.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new G_(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){U_("setMaxUploadRetryTime",[j_()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){U_("setMaxOperationRetryTime",[j_()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),nE=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}();function rE(t,e,n){return new eE(t,new e_,n)}function iE(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function oE(n,r,i){var o,t=new Promise(function(t,e){iE(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function aE(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function sE(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return oE(this[n],t,arguments)})})}function uE(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function cE(t,r,e,n){n.forEach(function(n){n in e.prototype&&(t.prototype[n]=function(){return t=this[r],(e=oE(t,n,arguments)).then(function(t){if(t)return new lE(t,e.request)});var t,e})})}function hE(t){this._index=t}function lE(t,e){this._cursor=t,this._request=e}function fE(t){this._store=t}function pE(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function dE(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new pE(n)}function yE(t){this._db=t}tE={TaskState:Kw,TaskEvent:Lw,StringFormat:Nw,Storage:eE,Reference:G_},Jh.INTERNAL.registerService("storage",rE,tE,void 0,!0),aE(hE,"_index",["name","keyPath","multiEntry","unique"]),sE(hE,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),cE(hE,"_index",IDBIndex,["openCursor","openKeyCursor"]),aE(lE,"_cursor",["direction","key","primaryKey","value"]),sE(lE,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(lE.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),iE(e._request).then(function(t){if(t)return new lE(t,e._request)})})})}),fE.prototype.createIndex=function(){return new hE(this._store.createIndex.apply(this._store,arguments))},fE.prototype.index=function(){return new hE(this._store.index.apply(this._store,arguments))},aE(fE,"_store",["name","keyPath","indexNames","autoIncrement"]),sE(fE,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),cE(fE,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),uE(fE,"_store",IDBObjectStore,["deleteIndex"]),pE.prototype.objectStore=function(){return new fE(this._tx.objectStore.apply(this._tx,arguments))},aE(pE,"_tx",["objectStoreNames","mode"]),uE(pE,"_tx",IDBTransaction,["abort"]),dE.prototype.createObjectStore=function(){return new fE(this._db.createObjectStore.apply(this._db,arguments))},aE(dE,"_db",["name","version","objectStoreNames"]),uE(dE,"_db",IDBDatabase,["deleteObjectStore","close"]),yE.prototype.transaction=function(){return new pE(this._db.transaction.apply(this._db,arguments))},aE(yE,"_db",["name","version","objectStoreNames"]),uE(yE,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[fE,hE].forEach(function(t){o in t.prototype&&(t.prototype[o.replace("open","iterate")]=function(){var t,e=(t=arguments,Array.prototype.slice.call(t)),n=e[e.length-1],r=this._store||this._index,i=r[o].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[hE,fE].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var mE,gE=1e4,vE="w:0.2.2",bE="FIS_v2",wE="https://firebaseinstallations.googleapis.com/v1",_E=36e5,EE=((mE={})["missing-app-config-values"]="Missing App configuration values.",mE["create-installation-failed"]="Could not register Firebase Installation.",mE["generate-token-failed"]="Could not generate Auth Token.",mE["not-registered"]="Firebase Installation is not registered.",mE["installation-not-found"]="Firebase Installation not found.",mE["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',mE["app-offline"]="Could not process request. Application offline.",mE["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",mE),TE=new Ii("installations","Installations",EE);function SE(t){return t instanceof Si&&t.code.includes("request-failed")}function IE(t){if(!t||!t.options)throw TE.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw TE.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function CE(t){var e=t.projectId;return wE+"/projects/"+e+"/installations"}function NE(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function AE(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,TE.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function kE(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function DE(t,e){var n=e.refreshToken,r=kE(t);return r.append("Authorization",bE+" "+n),r}function RE(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function OE(e){return new Promise(function(t){setTimeout(t,e)})}var PE=/^[cdef][\w-]{21}$/,xE="";function ME(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=(n=t,btoa(String.fromCharCode.apply(String,hi(n))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);return PE.test(e)?e:xE}catch(t){return xE}var n}var LE="firebase-installations-database",FE=1,UE="firebase-installations-store",qE=null;function VE(){var e,t,n;return qE||(e=function(t){switch(t.oldVersion){case 0:t.createObjectStore(UE)}},t=oE(indexedDB,"open",[LE,FE]),(n=t.request)&&(n.onupgradeneeded=function(t){e&&e(new dE(n.result,t.oldVersion,n.transaction))}),qE=t.then(function(t){return new yE(t)})),qE}function BE(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=KE(i),[4,VE()];case 1:return n=t.sent(),[4,(r=n.transaction(UE,"readwrite")).objectStore(UE).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function jE(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=KE(i),[4,VE()];case 1:return n=t.sent(),[4,(r=n.transaction(UE,"readwrite")).objectStore(UE).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function WE(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=KE(s),[4,VE()];case 1:return n=t.sent(),r=n.transaction(UE,"readwrite"),[4,(i=r.objectStore(UE)).get(e)];case 2:return o=t.sent(),(a=u(o))===o?[2,a]:void 0!==a?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function KE(t){return t.appName+"!"+t.appId}function QE(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,WE(i,function(t){var e=function(t){var e=t||{fid:ME(),registrationStatus:0};if(GE(e))return{fid:e.fid,registrationStatus:0};return e}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,HE(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,OE(100)];case 3:return t.sent(),[4,HE(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw TE.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(TE.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=CE(s),n=kE(s),r={fid:u,authVersion:bE,appId:s.appId,sdkVersion:vE},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,RE(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return[2,{fid:(a=t.sent()).fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:NE(a.authToken)}];case 3:return[4,AE("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,BE(r,e)];case 2:return SE(n=t.sent())&&409===n.serverCode?[4,jE(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,BE(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==xE?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function HE(t){return WE(t,function(t){if(!t)throw TE.create("installation-not-found");return GE(t)?{fid:t.fid,registrationStatus:0}:t})}function GE(t){return 1===t.registrationStatus&&t.registrationTime+gE<Date.now()}function zE(c,h){return ai(this,void 0,void 0,function(){var r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=c,n=h.fid,r=CE(e)+"/"+n+"/authTokens:generate",i=DE(c,h),o={installation:{sdkVersion:vE}},a={method:"POST",headers:i,body:JSON.stringify(o)},[4,RE(function(){return fetch(r,a)})];case 1:return(s=t.sent()).ok?[4,s.json()]:[3,3];case 2:return u=t.sent(),[2,NE(u)];case 3:return[4,AE("Generate Auth Token",s)];case 4:throw t.sent()}var e,n})})}function YE(c){return ai(this,void 0,void 0,function(){var u,e,n;return si(this,function(t){switch(t.label){case 0:return[4,WE(c,function(t){if(!JE(t))throw TE.create("not-registered");var e,n,r,i,o,a=t.authToken;if(2!==(r=a).requestStatus||(i=r,(o=Date.now())<i.creationTime||i.creationTime+i.expiresIn<o+_E)){if(1===a.requestStatus)return u=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,XE(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,OE(100)];case 3:return t.sent(),[4,XE(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw TE.create("generate-token-failed");return[2,n]}})})}(c),t;if(!navigator.onLine)throw TE.create("app-offline");var s=(e=t,n={requestStatus:1,requestTime:Date.now()},oi({},e,{authToken:n}));return u=function(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,zE(i,o)];case 1:return e=t.sent(),r=oi({},o,{authToken:e}),[4,BE(i,r)];case 2:return t.sent(),[2,e];case 3:return!SE(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,jE(i)];case 4:return t.sent(),[3,7];case 5:return r=oi({},o,{authToken:{requestStatus:0}}),[4,BE(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(c,s),s}return t})];case 1:return e=t.sent(),u?[4,u]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function XE(t){return WE(t,function(t){if(!JE(t))throw TE.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+gE<Date.now()?oi({},t,{authToken:{requestStatus:0}}):t})}function JE(t){return void 0!==t&&2===t.registrationStatus}function $E(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,QE(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw TE.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=IE(n))];case 1:return t.sent(),[2,YE(e)]}})})}function ZE(s,u){return ai(this,void 0,void 0,function(){var r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=s,n=u.fid,r=CE(e)+"/"+n,i=DE(s,u),o={method:"DELETE",headers:i},[4,RE(function(){return fetch(r,o)})];case 1:return(a=t.sent()).ok?[3,3]:[4,AE("Delete Installation",a)];case 2:throw t.sent();case 3:return[2]}var e,n})})}Jh.INTERNAL.registerService("installations",function(t){return IE(t),{app:t,getId:function(){return function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,QE(e=IE(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&YE(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return $E(t)},delete:function(){return function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,WE(e=IE(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw TE.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw TE.create("app-offline");case 3:return[4,ZE(e,n)];case 4:return t.sent(),[4,jE(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(t)}}});var tT,eT,nT,rT,iT="0.2.13",oT="FB-PERF-TRACE-MEASURE",aT="@firebase/performance/config",sT="@firebase/performance/configexpire",uT="Performance",cT=((tT={})["trace started"]="Trace {$traceName} was started before.",tT["trace stopped"]="Trace {$traceName} is not running.",tT["no window"]="Window is not available.",tT["no app id"]="App id is not available.",tT["no project id"]="Project id is not available.",tT["no api key"]="Api key is not available.",tT["invalid cc log"]="Attempted to queue invalid cc event",tT["FB not default"]="Performance can only start when Firebase app instance is the default one.",tT["RC response not ok"]="RC response is not ok",tT),hT=new Ii("performance",uT,cT),lT=function(){function t(t){if(!t)throw hT.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},t.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===eT&&(eT=new t(nT)),eT},t}();var fT,pT,dT,yT=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw hT.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw hT.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw hT.create("no api key");return t},t.getInstance=function(){return void 0===rT&&(rT=new t),rT},t}();function mT(){return fT}function gT(){switch(lT.getInstance().document.visibilityState){case"visible":return pT.VISIBLE;case"hidden":return pT.HIDDEN;case"prerender":return pT.PRERENDER;default:return pT.UNKNOWN}}(dT=pT||(pT={}))[dT.UNKNOWN=0]="UNKNOWN",dT[dT.VISIBLE=1]="VISIBLE",dT[dT.HIDDEN=2]="HIDDEN",dT[dT.PRERENDER=3]="PRERENDER",dT[dT.UNLOADED=4]="UNLOADED";var vT=new zi(uT);vT.logLevel=ji.INFO;var bT="0.0.1",wT={loggingEnabled:!0},_T="FIREBASE_INSTALLATIONS_AUTH";function ET(t){var i,e,n=function(){var t=lT.getInstance().localStorage,e=t.getItem(sT);if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem(aT);if(!r)return;try{var i=JSON.parse(r);return i}catch(t){return}}();return n?(ST(n),Promise.resolve()):(i=t,(e=yT.getInstance().firebaseAppInstance.installations().getToken(),e.then(function(t){}),e).then(function(t){var e=yT.getInstance().getProjectId(),n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+e+"/namespaces/fireperf:fetch?key="+yT.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:_T+" "+t},body:JSON.stringify({app_instance_id:i,app_instance_id_token:t,app_id:yT.getInstance().getAppId(),app_version:iT,sdk_version:bT})});return fetch(r).then(function(t){if(t.ok)return t.json();throw hT.create("RC response not ok")})}).catch(function(){vT.info(TT)})).then(function(t){return ST(t)}).then(function(t){return function(t){if(!t)return;var e=lT.getInstance().localStorage;e.setItem(aT,JSON.stringify(t)),e.setItem(sT,String(Date.now()+60*yT.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var TT="Could not fetch config, will use default configs";function ST(t){if(!t)return t;var e=yT.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=wT.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=IT(e.tracesSamplingRate),e.logNetworkAfterSampling=IT(e.networkRequestsSamplingRate),t}function IT(t){return Math.random()<=t}var CT,NT=1;function AT(){var n;return NT=2,CT=CT||(n=lT.getInstance().document,new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})).then(function(){return(t=yT.getInstance().firebaseAppInstance.installations().getId()).then(function(t){fT=t}),t;var t}).then(function(t){return ET(t)}).then(function(){return kT()},function(){return kT()})}function kT(){NT=3}var DT,RT=1e4,OT=3,PT=OT,xT=[];function MT(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw hT.create("invalid cc log");xT=xT.concat([t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function LT(){if(DT)return DT;var t=MT(qT);return(DT=new zi("@firebase/performance/cc")).logHandler=t,DT}function FT(t){var e=yT.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&lT.getInstance().requiredApisAvailable()&&(t.isAuto&&gT()!==pT.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===NT?UT(t):AT().then(function(){return UT(t)},function(){return UT(t)})))}function UT(t){mT()&&setTimeout(function(){return LT().log(t,1)},0)}function qT(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:VT(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=BT(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=BT(n));var r={application_info:VT(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function VT(){return{google_app_id:yT.getInstance().getAppId(),app_instance_id:mT(),web_app_info:{sdk_version:iT,page_url:lT.getInstance().getUrl(),service_worker_status:(t=lT.getInstance().navigator,"serviceWorker"in t?t.serviceWorker.controller?2:3:1),visibility_state:gT(),effective_connection_type:function(){var t=lT.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}function BT(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==PT){if(!xT.length)return r(RT);var t=xT.slice();xT=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:yT.getInstance().logSource,log_event:e};fetch(yT.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||vT.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?RT:Math.max(RT,e);PT=OT,r(n)}).catch(function(){xT=t.concat(xT),PT--,vT.info("Tries left: "+PT+"."),r(RT)})}},t)}(5500);var jT=function(){function u(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=lT.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||oT+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return u.prototype.start=function(){if(1!==this.state)throw hT.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},u.prototype.stop=function(){if(2!==this.state)throw hT.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),FT(this)},u.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=oi({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}FT(this)},u.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&(this.counters[t]=0),this.counters[t]+=e},u.prototype.putMetric=function(t,e){this.counters[t]=e},u.prototype.getMetric=function(t){return this.counters[t]||0},u.prototype.putAttribute=function(t,e){this.customAttributes[t]=e},u.prototype.getAttribute=function(t){return this.customAttributes[t]},u.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},u.prototype.getAttributes=function(){return oi({},this.customAttributes)},u.prototype.setStartTime=function(t){this.startTimeUs=t},u.prototype.setDuration=function(t){this.durationUs=t},u.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},u.createOobTrace=function(t,e,n){var r=lT.getInstance().getUrl();if(r){var i=new u("_wt_"+r,!0),o=Math.floor(1e3*lT.getInstance().getTimeOrigin());i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.incrementMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.incrementMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.incrementMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));if(e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.incrementMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.incrementMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.incrementMetric("_fid",Math.floor(1e3*n))}FT(i)}},u.createUserTimingTrace=function(t){FT(new u(t,!1,t))},u}();function WT(t){var e=t;if(e&&void 0!==e.responseStart){var n,r,i=lT.getInstance().getTimeOrigin(),o=Math.floor(1e3*(e.startTime+i)),a=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,s=Math.floor(1e3*(e.responseEnd-e.startTime)),u={url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:o,timeToResponseInitiatedUs:a,timeToResponseCompletedUs:s};n=u,(r=yT.getInstance()).instrumentationEnabled&&n.url!==r.logEndPointUrl.split("?")[0]&&r.loggingEnabled&&r.logNetworkAfterSampling&&setTimeout(function(){return LT().log(n,0)},0)}}var KT=5e3;function QT(){mT()&&(setTimeout(function(){return function(){var t=lT.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){jT.createOobTrace(e,n),r=void 0},KT);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),jT.createOobTrace(e,n,t))})}else jT.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=lT.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){var i=r[n];WT(i)}t.setupObserver("resource",WT)}()},0),setTimeout(function(){return function(){for(var t=lT.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){var i=r[n];HT(i)}t.setupObserver("measure",HT)}()},0))}function HT(t){var e=t.name;e.substring(0,oT.length)!==oT&&jT.createUserTimingTrace(e)}var GT=function(){function t(t){this.app=t,lT.getInstance().requiredApisAvailable()?AT().then(QT,QT):vT.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return t.prototype.trace=function(t){return new jT(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return yT.getInstance().instrumentationEnabled},set:function(t){yT.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return yT.getInstance().dataCollectionEnabled},set:function(t){yT.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),t}();return Jh.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw hT.create("FB not default");if("undefined"==typeof window)throw hT.create("no window");var e;return e=window,nT=e,yT.getInstance().firebaseAppInstance=t,new GT(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Jh});
//# sourceMappingURL=firebase.js.map
