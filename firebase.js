!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new E(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function v(t){return"object"==typeof t?null!==t:"function"==typeof t}function i(t){return w?y.createElement(t):{}}function p(t){if(!v(t))throw TypeError(String(t)+" is not an object");return t}function o(t,e){if(!v(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!v(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function g(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function h(e,n){try{S(b,e,n)}catch(t){b[e]=n}return n}function c(t,e){return C.call(t,e)}function s(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++D+R).toString(36)}function r(t){return O[t]||(O[t]=s(t))}var a,u,l,f="object",b=n(typeof globalThis==f&&globalThis)||n(typeof window==f&&window)||n(typeof self==f&&self)||n(typeof t==f&&t)||Function("return this")(),d=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),y=b.document,w=v(y)&&v(y.createElement),_=!d&&!m(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}),E=Object.defineProperty,T={f:d?E:function(t,e,n){if(p(t),e=o(e,!0),p(n),_)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},S=d?function(t,e,n){return T.f(t,e,g(1,n))}:function(t,e,n){return t[e]=n,t},I=e(function(t){var e="__core-js_shared__",n=b[e]||h(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.2.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),C={}.hasOwnProperty,N=I("native-function-to-string",Function.toString),A=b.WeakMap,k="function"==typeof A&&/native code/.test(N.call(A)),D=0,R=Math.random(),O=I("keys"),P={},M=b.WeakMap;if(k){var x=new M,L=x.get,F=x.has,U=x.set;a=function(t,e){return U.call(x,t,e),e},u=function(t){return L.call(x,t)||{}},l=function(t){return F.call(x,t)}}else{var q=r("state");P[q]=!0,a=function(t,e){return S(t,q,e),e},u=function(t){return c(t,q)?t[q]:{}},l=function(t){return c(t,q)}}function V(t){return Q.call(t).slice(8,-1)}function B(t){return z[t]||(z[t]=H&&G[t]||(H?G:s)("Symbol."+t))}function j(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Y))?n:X?V(e):"Object"==(r=V(e))&&"function"==typeof e.callee?"Arguments":r}var W={set:a,get:u,has:l,enforce:function(t){return l(t)?u(t):a(t,{})},getterFor:function(n){return function(t){var e;if(!v(t)||(e=u(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},K=e(function(t){var e=W.get,s=W.enforce,u=String(N).split("toString");I("inspectSource",function(t){return N.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||c(n,"name")||S(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:S(t,e,n)):o?t[e]=n:h(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||N.call(this)})}),Q={}.toString,H=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),G=b.Symbol,z=I("wks"),Y=B("toStringTag"),X="Arguments"==V(function(){return arguments}()),J={};J[B("toStringTag")]="z";var $="[object z]"!==String(J)?function(){return"[object "+j(this)+"]"}:J.toString,Z=Object.prototype;$!==Z.toString&&K(Z,"toString",$,{unsafe:!0});function tt(t){return isNaN(t=+t)?0:(0<t?vt:mt)(t)}function et(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function nt(s){return function(t,e){var n,r,i=String(et(t)),o=tt(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}function rt(t){return Tt(et(t))}function it(t){return"function"==typeof t?t:void 0}function ot(t,e){return arguments.length<2?it(Ct[t])||it(b[t]):Ct[t]&&Ct[t][e]||b[t]&&b[t][e]}function at(t){return 0<t?Nt(tt(t),9007199254740991):0}function st(s){return function(t,e,n){var r,i=rt(t),o=at(i.length),a=function(t,e){var n=tt(t);return n<0?At(n+e,0):kt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function ut(t,e){var n,r=rt(t),i=0,o=[];for(n in r)!c(P,n)&&c(r,n)&&o.push(n);for(;e.length>i;)c(r,n=e[i++])&&(~Dt(o,n)||o.push(n));return o}function ct(t,e){for(var n=xt(e),r=T.f,i=It.f,o=0;o<n.length;o++){var a=n[o];c(t,a)||r(t,a,i(e,a))}}function ht(t,e){var n=Ut[Ft(t)];return n==Vt||n!=qt&&("function"==typeof e?m(e):!!e)}function lt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||h(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=jt(n,r))&&a.value:n[r],!Bt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;ct(o,i)}(t.sham||i&&i.sham)&&S(o,"sham",!0),K(n,r,o,t)}}function ft(t){return Object(et(t))}var pt,dt,yt,mt=Math.ceil,vt=Math.floor,gt={codeAt:nt(!1),charAt:nt(!0)},bt={}.propertyIsEnumerable,wt=Object.getOwnPropertyDescriptor,_t={f:wt&&!bt.call({1:2},1)?function(t){var e=wt(this,t);return!!e&&e.enumerable}:bt},Et="".split,Tt=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==V(t)?Et.call(t,""):Object(t)}:Object,St=Object.getOwnPropertyDescriptor,It={f:d?St:function(t,e){if(t=rt(t),e=o(e,!0),_)try{return St(t,e)}catch(t){}if(c(t,e))return g(!_t.f.call(t,e),t[e])}},Ct=b,Nt=Math.min,At=Math.max,kt=Math.min,Dt={includes:st(!0),indexOf:st(!1)}.indexOf,Rt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ot=Rt.concat("length","prototype"),Pt={f:Object.getOwnPropertyNames||function(t){return ut(t,Ot)}},Mt={f:Object.getOwnPropertySymbols},xt=ot("Reflect","ownKeys")||function(t){var e=Pt.f(p(t)),n=Mt.f;return n?e.concat(n(t)):e},Lt=/#|\.prototype\./,Ft=ht.normalize=function(t){return String(t).replace(Lt,".").toLowerCase()},Ut=ht.data={},qt=ht.NATIVE="N",Vt=ht.POLYFILL="P",Bt=ht,jt=It.f,Wt=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Kt=r("IE_PROTO"),Qt=Object.prototype,Ht=Wt?Object.getPrototypeOf:function(t){return t=ft(t),c(t,Kt)?t[Kt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Qt:null},Gt=B("iterator"),zt=!1;[].keys&&("next"in(yt=[].keys())?(dt=Ht(Ht(yt)))!==Object.prototype&&(pt=dt):zt=!0),null==pt&&(pt={}),c(pt,Gt)||S(pt,Gt,function(){return this});function Yt(){}var Xt={IteratorPrototype:pt,BUGGY_SAFARI_ITERATORS:zt},Jt=Object.keys||function(t){return ut(t,Rt)},$t=d?Object.defineProperties:function(t,e){p(t);for(var n,r=Jt(e),i=r.length,o=0;o<i;)T.f(t,n=r[o++],e[n]);return t},Zt=ot("document","documentElement"),te=r("IE_PROTO"),ee="prototype",ne=function(){var t,e=i("iframe"),n=Rt.length,r="script";for(e.style.display="none",Zt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),ne=t.F;n--;)delete ne[ee][Rt[n]];return ne()},re=Object.create||function(t,e){var n;return null!==t?(Yt[ee]=p(t),n=new Yt,Yt[ee]=null,n[te]=t):n=ne(),void 0===e?n:$t(n,e)};P[te]=!0;function ie(t,e,n){t&&!c(t=n?t:t.prototype,ce)&&ue(t,ce,{configurable:!0,value:e})}function oe(){return this}function ae(){return this}function se(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!de&&t in p)return p[t];switch(t){case"keys":case me:case ve:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=re(le,{next:g(1,n)}),ie(t,r,!1),he[r]=oe}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[ye]||p["@@iterator"]||i&&p[i],y=!de&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=Ht(m.call(new t)),pe!==Object.prototype&&u.next&&(Ht(u)!==pe&&(fe?fe(u,pe):"function"!=typeof u[ye]&&S(u,ye,ae)),ie(u,l,!0))),i==me&&d&&d.name!==me&&(f=!0,y=function(){return d.call(this)}),p[ye]!==y&&S(p,ye,y),he[e]=y,i)if(c={values:s(me),keys:o?y:s("keys"),entries:s(ve)},a)for(h in c)!de&&!f&&h in p||K(p,h,c[h]);else lt({target:e,proto:!0,forced:de||f},c);return c}var ue=T.f,ce=B("toStringTag"),he={},le=Xt.IteratorPrototype,fe=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return p(t),function(t){if(!v(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),pe=Xt.IteratorPrototype,de=Xt.BUGGY_SAFARI_ITERATORS,ye=B("iterator"),me="values",ve="entries",ge=gt.charAt,be="String Iterator",we=W.set,_e=W.getterFor(be);se(String,"String",function(t){we(this,{type:be,string:String(t),index:0})},function(){var t,e=_e(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=ge(n,r),e.index+=t.length,{value:t,done:!1})});var Ee={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Te=B("unscopables"),Se=Array.prototype;null==Se[Te]&&S(Se,Te,re(null));function Ie(t){Se[Te][t]=!0}var Ce="Array Iterator",Ne=W.set,Ae=W.getterFor(Ce),ke=se(Array,"Array",function(t,e){Ne(this,{type:Ce,target:rt(t),index:0,kind:e})},function(){var t=Ae(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");he.Arguments=he.Array,Ie("keys"),Ie("values"),Ie("entries");var De=B("iterator"),Re=B("toStringTag"),Oe=ke.values;for(var Pe in Ee){var Me=b[Pe],xe=Me&&Me.prototype;if(xe){if(xe[De]!==Oe)try{S(xe,De,Oe)}catch(ds){xe[De]=Oe}if(xe[Re]||S(xe,Re,Pe),Ee[Pe])for(var Le in ke)if(xe[Le]!==ke[Le])try{S(xe,Le,ke[Le])}catch(ds){xe[Le]=ke[Le]}}}function Fe(t,e,n){for(var r in e)K(t,r,e[r],n);return t}function Ue(t){var e=ot(t),n=T.f;d&&e&&!e[He]&&n(e,He,{configurable:!0,get:function(){return this}})}function qe(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Ve(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function Be(t){return void 0!==t&&(he.Array===t||ze[Ge]===t)}function je(r,i,t){if(qe(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function We(t){if(null!=t)return t[Ye]||t["@@iterator"]||he[j(t)]}function Ke(e,t,n,r){try{return r?t(p(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&p(i.call(e)),t}}var Qe=b.Promise,He=B("species"),Ge=B("iterator"),ze=Array.prototype,Ye=B("iterator"),Xe=e(function(t){function f(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=je(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=We(t)))throw TypeError("Target is not iterable");if(Be(a)){for(s=0,u=at(t.length);s<u;s++)if((c=r?l(p(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=Ke(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}}),Je=B("iterator"),$e=!1;try{var Ze=0,tn={next:function(){return{done:!!Ze++}},return:function(){$e=!0}};tn[Je]=function(){return this},Array.from(tn,function(){throw 2})}catch(ds){}function en(t,e){if(!e&&!$e)return!1;var n=!1;try{var r={};r[Je]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}function nn(t,e){var n,r=p(t).constructor;return void 0===r||null==(n=p(r)[ln])?e:qe(n)}function rn(t){if(bn.hasOwnProperty(t)){var e=bn[t];delete bn[t],e()}}function on(t){return function(){rn(t)}}function an(t){rn(t.data)}function sn(t){b.postMessage(t+"",fn.protocol+"//"+fn.host)}var un,cn,hn,ln=B("species"),fn=b.location,pn=b.setImmediate,dn=b.clearImmediate,yn=b.process,mn=b.MessageChannel,vn=b.Dispatch,gn=0,bn={},wn="onreadystatechange";pn&&dn||(pn=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return bn[++gn]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},un(gn),gn},dn=function(t){delete bn[t]},"process"==V(yn)?un=function(t){yn.nextTick(on(t))}:vn&&vn.now?un=function(t){vn.now(on(t))}:mn?(hn=(cn=new mn).port2,cn.port1.onmessage=an,un=je(hn.postMessage,hn,1)):!b.addEventListener||"function"!=typeof postMessage||b.importScripts||m(sn)?un=wn in i("script")?function(t){Zt.appendChild(i("script"))[wn]=function(){Zt.removeChild(this),rn(t)}}:function(t){setTimeout(on(t),0)}:(un=sn,b.addEventListener("message",an,!1)));var _n,En,Tn,Sn,In,Cn,Nn,An,kn={set:pn,clear:dn},Dn=ot("navigator","userAgent")||"",Rn=It.f,On=kn.set,Pn=b.MutationObserver||b.WebKitMutationObserver,Mn=b.process,xn=b.Promise,Ln="process"==V(Mn),Fn=Rn(b,"queueMicrotask"),Un=Fn&&Fn.value;Un||(_n=function(){var t,e;for(Ln&&(t=Mn.domain)&&t.exit();En;){e=En.fn,En=En.next;try{e()}catch(t){throw En?Sn():Tn=void 0,t}}Tn=void 0,t&&t.enter()},Sn=Ln?function(){Mn.nextTick(_n)}:Pn&&!/(iphone|ipod|ipad).*applewebkit/i.test(Dn)?(In=!0,Cn=document.createTextNode(""),new Pn(_n).observe(Cn,{characterData:!0}),function(){Cn.data=In=!In}):xn&&xn.resolve?(Nn=xn.resolve(void 0),An=Nn.then,function(){An.call(Nn,_n)}):function(){On.call(b,_n)});function qn(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=qe(n),this.reject=qe(r)}function Vn(t,e){if(p(t),v(e)&&e.constructor===t)return e;var n=$n.f(t);return(0,n.resolve)(e),n.promise}function Bn(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}function jn(t){var e;return!(!v(t)||"function"!=typeof(e=t.then))&&e}function Wn(l,f,p){if(!f.notified){f.notified=!0;var d=f.reactions;Jn(function(){for(var t=f.value,e=1==f.state,n=0;d.length>n;){var r,i,o,a=d[n++],s=e?a.ok:a.fail,u=a.resolve,c=a.reject,h=a.domain;try{s?(e||(2===f.rejection&&_r(l,f),f.rejection=1),!0===s?r=t:(h&&h.enter(),r=s(t),h&&(h.exit(),o=!0)),r===a.promise?c(ar("Promise-chain cycle")):(i=jn(r))?i.call(r,u,c):u(r)):c(t)}catch(t){h&&!o&&h.exit(),c(t)}}f.reactions=[],f.notified=!1,p&&!f.rejection&&br(l,f)})}}function Kn(t,e,n){var r,i;yr?((r=sr.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),b.dispatchEvent(r)):r={promise:e,reason:n},(i=b["on"+t])?i(r):t===mr&&function(t,e){var n=b.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function Qn(e,n,r,i){return function(t){e(n,r,t,i)}}function Hn(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,Wn(t,e,!0))}var Gn,zn,Yn,Xn,Jn=Un||function(t){var e={fn:t,next:void 0};Tn&&(Tn.next=e),En||(En=e,Sn()),Tn=e},$n={f:function(t){return new qn(t)}},Zn=kn.set,tr=B("species"),er="Promise",nr=W.get,rr=W.set,ir=W.getterFor(er),or=Qe,ar=b.TypeError,sr=b.document,ur=b.process,cr=b.fetch,hr=ur&&ur.versions,lr=hr&&hr.v8||"",fr=$n.f,pr=fr,dr="process"==V(ur),yr=!!(sr&&sr.createEvent&&b.dispatchEvent),mr="unhandledrejection",vr=Bt(er,function(){function e(){}var t=or.resolve(1),n=(t.constructor={})[tr]=function(t){t(e,e)};return!((dr||"function"==typeof PromiseRejectionEvent)&&t.then(e)instanceof n&&0!==lr.indexOf("6.6")&&-1===Dn.indexOf("Chrome/66"))}),gr=vr||!en(function(t){or.all(t).catch(function(){})}),br=function(n,r){Zn.call(b,function(){var t,e=r.value;if(wr(r)&&(t=Bn(function(){dr?ur.emit("unhandledRejection",e,n):Kn(mr,n,e)}),r.rejection=dr||wr(r)?2:1,t.error))throw t.value})},wr=function(t){return 1!==t.rejection&&!t.parent},_r=function(t,e){Zn.call(b,function(){dr?ur.emit("rejectionHandled",t):Kn("rejectionhandled",t,e.value)})},Er=function(n,r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(n===t)throw ar("Promise can't be resolved itself");var i=jn(t);i?Jn(function(){var e={done:!1};try{i.call(t,Qn(Er,n,e,r),Qn(Hn,n,e,r))}catch(t){Hn(n,e,t,r)}}):(r.value=t,r.state=1,Wn(n,r,!1))}catch(t){Hn(n,{done:!1},t,r)}}};vr&&(or=function(t){Ve(this,or,er),qe(t),Gn.call(this);var e=nr(this);try{t(Qn(Er,this,e),Qn(Hn,this,e))}catch(t){Hn(this,e,t)}},(Gn=function(t){rr(this,{type:er,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Fe(or.prototype,{then:function(t,e){var n=ir(this),r=fr(nn(this,or));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=dr?ur.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Wn(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),zn=function(){var t=new Gn,e=nr(t);this.promise=t,this.resolve=Qn(Er,t,e),this.reject=Qn(Hn,t,e)},$n.f=fr=function(t){return t===or||t===Yn?new zn(t):pr(t)},"function"==typeof Qe&&(Xn=Qe.prototype.then,K(Qe.prototype,"then",function(t,e){var n=this;return new or(function(t,e){Xn.call(n,t,e)}).then(t,e)}),"function"==typeof cr&&lt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Vn(or,cr.apply(b,arguments))}}))),lt({global:!0,wrap:!0,forced:vr},{Promise:or}),ie(or,er,!1),Ue(er),Yn=Ct[er],lt({target:er,stat:!0,forced:vr},{reject:function(t){var e=fr(this);return e.reject.call(void 0,t),e.promise}}),lt({target:er,stat:!0,forced:vr},{resolve:function(t){return Vn(this,t)}}),lt({target:er,stat:!0,forced:gr},{all:function(t){var s=this,e=fr(s),u=e.resolve,c=e.reject,n=Bn(function(){var r=qe(s.resolve),i=[],o=0,a=1;Xe(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]=t,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),e.promise},race:function(t){var n=this,r=fr(n),i=r.reject,e=Bn(function(){var e=qe(n.resolve);Xe(t,function(t){e.call(n,t).then(r.resolve,i)})});return e.error&&i(e.value),r.promise}}),lt({target:"Promise",stat:!0},{allSettled:function(t){var s=this,e=$n.f(s),u=e.resolve,n=e.reject,r=Bn(function(){var r=qe(s.resolve),i=[],o=0,a=1;Xe(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]={status:"fulfilled",value:t},--a||u(i))},function(t){n||(n=!0,i[e]={status:"rejected",reason:t},--a||u(i))})}),--a||u(i)});return r.error&&n(r.value),e.promise}}),lt({target:"Promise",proto:!0,real:!0},{finally:function(e){var n=nn(this,ot("Promise")),t="function"==typeof e;return this.then(t?function(t){return Vn(n,e()).then(function(){return t})}:e,t?function(t){return Vn(n,e()).then(function(){throw t})}:e)}}),"function"!=typeof Qe||Qe.prototype.finally||K(Qe.prototype,"finally",ot("Promise").prototype.finally);Ct.Promise;var Tr=function(t,e){var n=this;if(!(n instanceof Tr))return new Tr(t,e);fe&&(n=fe(new Error(e),Ht(n)));var r=[];return Xe(t,r.push,r),S(n,"errors",r),void 0!==e&&S(n,"message",String(e)),n};Tr.prototype=re(Error.prototype,{constructor:g(5,Tr),name:g(5,"AggregateError")}),lt({global:!0},{AggregateError:Tr}),lt({target:"Promise",stat:!0},{try:function(t){var e=$n.f(this),n=Bn(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Sr="No one promise resolved";lt({target:"Promise",stat:!0},{any:function(t){var u=this,e=$n.f(u),c=e.resolve,h=e.reject,n=Bn(function(){var r=qe(u.resolve),i=[],o=0,a=1,s=!1;Xe(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(u,t).then(function(t){n||s||(s=!0,c(t))},function(t){n||s||(n=!0,i[e]=t,--a||h(new(ot("AggregateError"))(i,Sr)))})}),--a||h(new(ot("AggregateError"))(i,Sr))});return n.error&&h(n.value),e.promise}});function Ir(t,e){var n;return Nr(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Nr(n.prototype)?v(n)&&null===(n=n[Ar])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Cr(p){var d=1==p,y=2==p,m=3==p,v=4==p,g=6==p,b=5==p||g;return function(t,e,n,r){for(var i,o,a=ft(t),s=Tt(a),u=je(e,n,3),c=at(s.length),h=0,l=r||Ir,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:kr.call(f,i)}else if(v)return!1;return g?-1:m||v?v:f}}var Nr=Array.isArray||function(t){return"Array"==V(t)},Ar=B("species"),kr=[].push,Dr={forEach:Cr(0),map:Cr(1),filter:Cr(2),some:Cr(3),every:Cr(4),find:Cr(5),findIndex:Cr(6)},Rr=Dr.find,Or="find",Pr=!0;Or in[]&&Array(1)[Or](function(){Pr=!1}),lt({target:"Array",proto:!0,forced:Pr},{find:function(t,e){return Rr(this,t,1<arguments.length?e:void 0)}}),Ie(Or);function Mr(t,e,n){return je(xr,b[t].prototype[e],n)}var xr=Function.call,Lr=(Mr("Array","find"),Dr.findIndex),Fr="findIndex",Ur=!0;Fr in[]&&Array(1)[Fr](function(){Ur=!1}),lt({target:"Array",proto:!0,forced:Ur},{findIndex:function(t,e){return Lr(this,t,1<arguments.length?e:void 0)}}),Ie(Fr);function qr(t,e,n){var r=o(e);r in t?T.f(t,r,g(0,n)):t[r]=n}Mr("Array","findIndex");var Vr=!en(function(t){Array.from(t)});lt({target:"Array",stat:!0,forced:Vr},{from:function(t,e,n){var r,i,o,a,s=ft(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=We(s);if(l&&(h=je(h,2<c?n:void 0,2)),null==p||u==Array&&Be(p))for(i=new u(r=at(s.length));f<r;f++)qr(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)qr(i,f,l?Ke(a,h,[o.value,f],!0):o.value);return i.length=f,i}});Ct.Array.from;var Br,jr,Wr,Kr=Dr.some;lt({target:"Array",proto:!0,forced:(Br="some",Wr=[][Br],!Wr||!m(function(){Wr.call(null,jr||function(){throw 1},1)}))},{some:function(t,e){return Kr(this,t,1<arguments.length?e:void 0)}});Mr("Array","some");function Qr(t){return v(t)&&c(si,j(t))}var Hr,Gr=T.f,zr=b.DataView,Yr=zr&&zr.prototype,Xr=b.Int8Array,Jr=Xr&&Xr.prototype,$r=b.Uint8ClampedArray,Zr=$r&&$r.prototype,ti=Xr&&Ht(Xr),ei=Jr&&Ht(Jr),ni=Object.prototype,ri=(ni.isPrototypeOf,B("toStringTag")),ii=s("TYPED_ARRAY_TAG"),oi=!(!b.ArrayBuffer||!zr),ai=oi&&!!fe&&"Opera"!==j(b.opera),si={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(Hr in si)b[Hr]||(ai=!1);if((!ai||"function"!=typeof ti||ti===Function.prototype)&&(ti=function(){throw TypeError("Incorrect invocation")},ai))for(Hr in si)b[Hr]&&fe(b[Hr],ti);if((!ai||!ei||ei===ni)&&(ei=ti.prototype,ai))for(Hr in si)b[Hr]&&fe(b[Hr].prototype,ei);if(ai&&Ht(Zr)!==ei&&fe(Zr,ei),d&&!c(ei,ri))for(Hr in!0,Gr(ei,ri,{get:function(){return v(this)?this[ii]:void 0}}),si)b[Hr]&&S(b[Hr],ii,Hr);oi&&fe&&Ht(Yr)!==ni&&fe(Yr,ni);function ui(){return pi.call(mi(this))}var ci=function(t){if(Qr(t))return t;throw TypeError("Target is not a typed array")},hi=function(t,e,n){if(d){if(n)for(var r in si){var i=b[r];i&&c(i.prototype,t)&&delete i.prototype[t]}ei[t]&&!n||K(ei,t,n?e:ai&&Jr[t]||e)}},li=B("iterator"),fi=b.Uint8Array,pi=ke.values,di=ke.keys,yi=ke.entries,mi=ci,vi=hi,gi=fi&&fi.prototype[li],bi=!!gi&&("values"==gi.name||null==gi.name);vi("entries",function(){return yi.call(mi(this))}),vi("keys",function(){return di.call(mi(this))}),vi("values",ui,!bi),vi(li,ui,!bi);var wi=Object.assign,_i=!wi||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=wi({},t)[n]||Jt(wi({},e)).join("")!=r})?function(t,e){for(var n=ft(t),r=arguments.length,i=1,o=Mt.f,a=_t.f;i<r;)for(var s,u=Tt(arguments[i++]),c=o?Jt(u).concat(o(u)):Jt(u),h=c.length,l=0;l<h;)s=c[l++],d&&!a.call(u,s)||(n[s]=u[s]);return n}:wi;lt({target:"Object",stat:!0,forced:Object.assign!==_i},{assign:_i});Ct.Object.assign;function Ei(s){return function(t){for(var e,n=rt(t),r=Jt(n),i=r.length,o=0,a=[];o<i;)e=r[o++],d&&!Ti.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var Ti=_t.f,Si={entries:Ei(!0),values:Ei(!1)},Ii=Si.entries;lt({target:"Object",stat:!0},{entries:function(t){return Ii(t)}});Ct.Object.entries;var Ci=Si.values;lt({target:"Object",stat:!0},{values:function(t){return Ci(t)}});Ct.Object.values;function Ni(t){if(function(t){var e;return v(t)&&(void 0!==(e=t[ki])?!!e:"RegExp"==V(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}function Ai(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Di]=!1,"/./"[e](n)}catch(t){}}return!1}var ki=B("match"),Di=B("match");lt({target:"String",proto:!0,forced:!Ai("includes")},{includes:function(t,e){return!!~String(et(this)).indexOf(Ni(t),1<arguments.length?e:void 0)}});Mr("String","includes");var Ri="".startsWith,Oi=Math.min;lt({target:"String",proto:!0,forced:!Ai("startsWith")},{startsWith:function(t,e){var n=String(et(this));Ni(t);var r=at(Oi(1<arguments.length?e:void 0,n.length)),i=String(t);return Ri?Ri.call(n,i,r):n.slice(r,r+i.length)===i}});Mr("String","startsWith");lt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(et(this)),n="",r=tt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});Mr("String","repeat");function Pi(t){if(!v(t))return!1;var e=t[Li];return void 0!==e?!!e:Nr(t)}var Mi,xi=B("species"),Li=B("isConcatSpreadable"),Fi=9007199254740991,Ui="Maximum allowed index exceeded",qi=!m(function(){var t=[];return t[Li]=!1,t.concat()[0]!==t}),Vi=(Mi="concat",!m(function(){var t=[];return(t.constructor={})[xi]=function(){return{foo:1}},1!==t[Mi](Boolean).foo}));lt({target:"Array",proto:!0,forced:!qi||!Vi},{concat:function(t){var e,n,r,i,o,a=ft(this),s=Ir(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Pi(o=-1===e?a:arguments[e])){if(i=at(o.length),Fi<u+i)throw TypeError(Ui);for(n=0;n<i;n++,u++)n in o&&qr(s,u,o[n])}else{if(Fi<=u)throw TypeError(Ui);qr(s,u++,o)}return s.length=u,s}});function Bi(t){var e=Ct.Symbol||(Ct.Symbol={});c(e,t)||Ji(e,t,{value:Xi.f(t)})}function ji(t,e){var n=po[t]=re(ao[eo]);return ro(n,{type:to,tag:t,description:e}),d||(n.description=e),n}function Wi(e,t){p(e);var n=rt(t),r=Jt(n).concat(Io(n));return $i(r,function(t){d&&!So.call(n,t)||To(e,t,n[t])}),e}function Ki(t,e){var n=rt(t),r=o(e,!0);if(n!==oo||!c(po,r)||c(yo,r)){var i=co(n,r);return!i||!c(po,r)||c(n,Zi)&&n[Zi][r]||(i.enumerable=!0),i}}function Qi(t){var e=lo(rt(t)),n=[];return $i(e,function(t){c(po,t)||c(P,t)||n.push(t)}),n}var Hi=Pt.f,Gi={}.toString,zi="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Yi={f:function(t){return zi&&"[object Window]"==Gi.call(t)?function(t){try{return Hi(t)}catch(t){return zi.slice()}}(t):Hi(rt(t))}},Xi={f:B},Ji=T.f,$i=Dr.forEach,Zi=r("hidden"),to="Symbol",eo="prototype",no=B("toPrimitive"),ro=W.set,io=W.getterFor(to),oo=Object[eo],ao=b.Symbol,so=b.JSON,uo=so&&so.stringify,co=It.f,ho=T.f,lo=Yi.f,fo=_t.f,po=I("symbols"),yo=I("op-symbols"),mo=I("string-to-symbol-registry"),vo=I("symbol-to-string-registry"),go=I("wks"),bo=b.QObject,wo=!bo||!bo[eo]||!bo[eo].findChild,_o=d&&m(function(){return 7!=re(ho({},"a",{get:function(){return ho(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=co(oo,e);r&&delete oo[e],ho(t,e,n),r&&t!==oo&&ho(oo,e,r)}:ho,Eo=H&&"symbol"==typeof ao.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof ao},To=function(t,e,n){t===oo&&To(yo,e,n),p(t);var r=o(e,!0);return p(n),c(po,r)?(n.enumerable?(c(t,Zi)&&t[Zi][r]&&(t[Zi][r]=!1),n=re(n,{enumerable:g(0,!1)})):(c(t,Zi)||ho(t,Zi,g(1,{})),t[Zi][r]=!0),_o(t,r,n)):ho(t,r,n)},So=function(t){var e=o(t,!0),n=fo.call(this,e);return!(this===oo&&c(po,e)&&!c(yo,e))&&(!(n||!c(this,e)||!c(po,e)||c(this,Zi)&&this[Zi][e])||n)},Io=function(t){var e=t===oo,n=lo(e?yo:rt(t)),r=[];return $i(n,function(t){!c(po,t)||e&&!c(oo,t)||r.push(po[t])}),r};H||(K((ao=function(t){if(this instanceof ao)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=s(e),r=function(t){this===oo&&r.call(yo,t),c(this,Zi)&&c(this[Zi],n)&&(this[Zi][n]=!1),_o(this,n,g(1,t))};return d&&wo&&_o(oo,n,{configurable:!0,set:r}),ji(n,e)})[eo],"toString",function(){return io(this).tag}),_t.f=So,T.f=To,It.f=Ki,Pt.f=Yi.f=Qi,Mt.f=Io,d&&(ho(ao[eo],"description",{configurable:!0,get:function(){return io(this).description}}),K(oo,"propertyIsEnumerable",So,{unsafe:!0})),Xi.f=function(t){return ji(B(t),t)}),lt({global:!0,wrap:!0,forced:!H,sham:!H},{Symbol:ao}),$i(Jt(go),function(t){Bi(t)}),lt({target:to,stat:!0,forced:!H},{for:function(t){var e=String(t);if(c(mo,e))return mo[e];var n=ao(e);return mo[e]=n,vo[n]=e,n},keyFor:function(t){if(!Eo(t))throw TypeError(t+" is not a symbol");if(c(vo,t))return vo[t]},useSetter:function(){wo=!0},useSimple:function(){wo=!1}}),lt({target:"Object",stat:!0,forced:!H,sham:!d},{create:function(t,e){return void 0===e?re(t):Wi(re(t),e)},defineProperty:To,defineProperties:Wi,getOwnPropertyDescriptor:Ki}),lt({target:"Object",stat:!0,forced:!H},{getOwnPropertyNames:Qi,getOwnPropertySymbols:Io}),lt({target:"Object",stat:!0,forced:m(function(){Mt.f(1)})},{getOwnPropertySymbols:function(t){return Mt.f(ft(t))}}),so&&lt({target:"JSON",stat:!0,forced:!H||m(function(){var t=ao();return"[null]"!=uo([t])||"{}"!=uo({a:t})||"{}"!=uo(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(v(e)||void 0!==t)&&!Eo(t))return Nr(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Eo(e))return e}),r[1]=e,uo.apply(so,r)}}),ao[eo][no]||S(ao[eo],no,ao[eo].valueOf),ie(ao,to),P[Zi]=!0,Bi("asyncIterator");var Co=T.f,No=b.Symbol;if(!(!d||"function"!=typeof No||"description"in No.prototype&&void 0===No().description)){var Ao={},ko=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof ko?new No(e):void 0===e?No():No(e);return""===e&&(Ao[n]=!0),n};ct(ko,No);var Do=ko.prototype=No.prototype;Do.constructor=ko;var Ro=Do.toString,Oo="Symbol(test)"==String(No("test")),Po=/^Symbol\((.*)\)[^)]+$/;Co(Do,"description",{configurable:!0,get:function(){var t=v(this)?this.valueOf():this,e=Ro.call(t);if(c(Ao,t))return"";var n=Oo?e.slice(7,-1):e.replace(Po,"$1");return""===n?void 0:n}}),lt({global:!0,forced:!0},{Symbol:ko})}Bi("hasInstance"),Bi("isConcatSpreadable"),Bi("iterator"),Bi("match"),Bi("matchAll"),Bi("replace"),Bi("search"),Bi("species"),Bi("split"),Bi("toPrimitive"),Bi("toStringTag"),Bi("unscopables"),ie(Math,"Math",!0),ie(b.JSON,"JSON",!0);Ct.Symbol;Bi("asyncDispose"),Bi("dispose"),Bi("observable"),Bi("patternMatch"),Bi("replaceAll");Xi.f("iterator");function Mo(r,t,e,i,o){function n(t){var n=s[t];K(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!v(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!v(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!v(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=b[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Bt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Fo.REQUIRED=!0;else if(Bt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=en(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){Ve(t,u,r);var n=function(t,e,n){var r,i;return fe&&"function"==typeof(r=e.constructor)&&r!==n&&v(i=r.prototype)&&i!==n.prototype&&fe(t,i),t}(new a,t,u);return null!=e&&Xe(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,lt({global:!0,forced:u!=a},h),ie(u,r),o||e.setStrong(u,r,i),u}function xo(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return qe(this),(r=void 0!==u)&&qe(u),null==t?new this:(i=[],r?(o=0,a=je(u,2<s?n:void 0,2),Xe(t,function(t){i.push(a(t,o++))})):Xe(t,i.push,i),new this(i))}var Lo=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Fo=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=T.f,r=s("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!v(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!c(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!c(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return Lo&&a.REQUIRED&&o(t)&&!c(t,r)&&n(t),t}};P[r]=!0}),Uo=(Fo.REQUIRED,Fo.fastKey,Fo.getWeakData,Fo.onFreeze,T.f),qo=Fo.fastKey,Vo=W.set,Bo=W.getterFor,jo={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=qo(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),d?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){Ve(t,a,n),Vo(t,{type:n,index:re(null),first:void 0,last:void 0,size:0}),d||(t.size=0),null!=e&&Xe(e,t[i],t,r)}),s=Bo(n),u=function(t,e){var n,r=s(t),i=qo(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Fe(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,d?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),d?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=je(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Fe(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),d&&Uo(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Bo(e),o=Bo(r);se(t,e,function(t,e){Vo(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),Ue(e)}};Mo("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},jo,!0),Ct.Map;lt({target:"Map",stat:!0},{from:xo});function Wo(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}lt({target:"Map",stat:!0},{of:Wo});function Ko(){for(var t,e=p(this),n=qe(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}lt({target:"Map",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Ko.apply(this,arguments)}});function Qo(t){return Map.prototype.entries.call(t)}lt({target:"Map",proto:!0,real:!0,forced:!1},{every:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3);return!Xe(r,function(t,e){if(!i(e,t,n))return Xe.stop()},void 0,!0,!0).stopped}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{filter:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3),o=new(nn(n,ot("Map"))),a=qe(o.set);return Xe(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{find:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3);return Xe(r,function(t,e){if(i(e,t,n))return Xe.stop(e)},void 0,!0,!0).result}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{findKey:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3);return Xe(r,function(t,e){if(i(e,t,n))return Xe.stop(t)},void 0,!0,!0).result}}),lt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;qe(n);var i=qe(r.has),o=qe(r.get),a=qe(r.set);return Xe(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});lt({target:"Map",proto:!0,real:!0,forced:!1},{includes:function(n){return Xe(Qo(p(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return Xe.stop()},void 0,!0,!0).stopped}}),lt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;qe(e);var r=qe(n.set);return Xe(t,function(t){r.call(n,e(t),t)}),n}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{keyOf:function(n){return Xe(Qo(p(this)),function(t,e){if(e===n)return Xe.stop(t)},void 0,!0,!0).result}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{mapKeys:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3),o=new(nn(n,ot("Map"))),a=qe(o.set);return Xe(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{mapValues:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3),o=new(nn(n,ot("Map"))),a=qe(o.set);return Xe(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{merge:function(t){for(var e=p(this),n=qe(e.set),r=0;r<arguments.length;)Xe(arguments[r++],n,e,!0);return e}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{reduce:function(n,t){var r,e,i=p(this),o=Qo(i);if(qe(n),1<arguments.length)r=t;else{if((e=o.next()).done)throw TypeError("Reduce of empty map with no initial value");r=e.value[1]}return Xe(o,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{some:function(t,e){var n=p(this),r=Qo(n),i=je(t,1<arguments.length?e:void 0,3);return Xe(r,function(t,e){if(i(e,t,n))return Xe.stop()},void 0,!0,!0).stopped}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{update:function(t,e,n){var r=p(this),i=arguments.length;qe(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):qe(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}}),lt({target:"Map",proto:!0,real:!0,forced:!1},{updateOrInsert:function(t,e,n){var r=p(this);qe(e),qe(n);var i=r.has(t)?e(r.get(t)):n();return r.set(t,i),i}});Mo("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},jo),Ct.Set;lt({target:"Set",stat:!0},{from:xo}),lt({target:"Set",stat:!0},{of:Wo});lt({target:"Set",proto:!0,real:!0,forced:!1},{addAll:function(){return function(){for(var t=p(this),e=qe(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Ko.apply(this,arguments)}});function Ho(t){return Set.prototype.values.call(t)}lt({target:"Set",proto:!0,real:!0,forced:!1},{every:function(t,e){var n=p(this),r=Ho(n),i=je(t,1<arguments.length?e:void 0,3);return!Xe(r,function(t){if(!i(t,t,n))return Xe.stop()},void 0,!1,!0).stopped}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{difference:function(t){var e=p(this),n=new(nn(e,ot("Set")))(e),r=qe(n.delete);return Xe(t,function(t){r.call(n,t)}),n}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{filter:function(t,e){var n=p(this),r=Ho(n),i=je(t,1<arguments.length?e:void 0,3),o=new(nn(n,ot("Set"))),a=qe(o.add);return Xe(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{find:function(t,e){var n=p(this),r=Ho(n),i=je(t,1<arguments.length?e:void 0,3);return Xe(r,function(t){if(i(t,t,n))return Xe.stop(t)},void 0,!1,!0).result}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{intersection:function(t){var e=p(this),n=new(nn(e,ot("Set"))),r=qe(e.has),i=qe(n.add);return Xe(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{isDisjointFrom:function(t){var e=p(this),n=qe(e.has);return!Xe(t,function(t){if(!0===n.call(e,t))return Xe.stop()}).stopped}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{isSubsetOf:function(t){var e=function(t){var e=We(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return p(e.call(t))}(this),n=p(t),r=n.has;return"function"!=typeof r&&(n=new(ot("Set"))(t),r=qe(n.has)),!Xe(e,function(t){if(!1===r.call(n,t))return Xe.stop()},void 0,!1,!0).stopped}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{isSupersetOf:function(t){var e=p(this),n=qe(e.has);return!Xe(t,function(t){if(!1===n.call(e,t))return Xe.stop()}).stopped}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{join:function(t){var e=p(this),n=Ho(e),r=void 0===t?",":String(t),i=[];return Xe(n,i.push,i,!1,!0),i.join(r)}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{map:function(t,e){var n=p(this),r=Ho(n),i=je(t,1<arguments.length?e:void 0,3),o=new(nn(n,ot("Set"))),a=qe(o.add);return Xe(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{reduce:function(e,t){var n,r,i=p(this),o=Ho(i);if(qe(e),1<arguments.length)n=t;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return Xe(o,function(t){n=e(n,t,t,i)},void 0,!1,!0),n}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{some:function(t,e){var n=p(this),r=Ho(n),i=je(t,1<arguments.length?e:void 0,3);return Xe(r,function(t){if(i(t,t,n))return Xe.stop()},void 0,!1,!0).stopped}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{symmetricDifference:function(t){var e=p(this),n=new(nn(e,ot("Set")))(e),r=qe(n.delete),i=qe(n.add);return Xe(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),lt({target:"Set",proto:!0,real:!0,forced:!1},{union:function(t){var e=p(this),n=new(nn(e,ot("Set")))(e);return Xe(t,qe(n.add),n),n}});var Go=Math.floor;lt({target:"Number",stat:!0},{isInteger:function(t){return!v(t)&&isFinite(t)&&Go(t)===t}});Ct.Number.isInteger;var zo=function(t,e){return(zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Yo(t,e){function n(){this.constructor=t}zo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Xo=function(){return(Xo=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Jo(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function $o(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function Zo(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ta(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function ea(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ta(arguments[e]));return t}function na(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function ra(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function ia(t){try{return ua.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var oa={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},aa=function(t,e){if(!t)throw sa(e)},sa=function(t){return new Error("Firebase Database ("+oa.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},ua={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ra(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function ca(t){return ha(void 0,t)}function ha(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=ha(t[n],e[n]));return t}var la=(fa.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},fa);function fa(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function pa(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function da(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pa())}function ya(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ma(){return!0===oa.NODE_ADMIN}var va,ga=(Yo(ba,va=Error),ba);function ba(t,e){var n=va.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,ba.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,wa.prototype.create),n}var wa=(_a.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Ea,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new ga(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},_a);function _a(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Ea=/\{\$([^}]+)}/g;function Ta(t){return JSON.parse(t)}function Sa(t){return JSON.stringify(t)}function Ia(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ta(ia(o[0])||""),n=Ta(ia(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Ca(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Na(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Aa(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ka(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Da=(Ra.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Ra.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},Ra.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},Ra.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},Ra);function Ra(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Oa(t,e){var n=new Pa(t,e);return n.subscribe.bind(n)}var Pa=(Ma.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},Ma.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},Ma.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Ma.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=xa),void 0===r.error&&(r.error=xa),void 0===r.complete&&(r.complete=xa);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Ma.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Ma.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Ma.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Ma.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Ma);function Ma(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function xa(){}function La(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Fa(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Ua(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Fa(t,e,r)+"must be a valid function.")}function qa(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Fa(t,e,r)+"must be a valid context object.")}function Va(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var Ba,ja;function Wa(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(ja=Ba=Ba||{})[ja.DEBUG=0]="DEBUG",ja[ja.VERBOSE=1]="VERBOSE",ja[ja.INFO=2]="INFO",ja[ja.WARN=3]="WARN",ja[ja.ERROR=4]="ERROR",ja[ja.SILENT=5]="SILENT";function Ka(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Ba.DEBUG:case Ba.VERBOSE:console.log.apply(console,Wa(["["+i+"]  "+t.name+":"],n));break;case Ba.INFO:console.info.apply(console,Wa(["["+i+"]  "+t.name+":"],n));break;case Ba.WARN:console.warn.apply(console,Wa(["["+i+"]  "+t.name+":"],n));break;case Ba.ERROR:console.error.apply(console,Wa(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var Qa,Ha=Ba.INFO,Ga=(Object.defineProperty(za.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Ba))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(za.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),za.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Wa([this,Ba.DEBUG],t))},za.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Wa([this,Ba.VERBOSE],t))},za.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Wa([this,Ba.INFO],t))},za.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Wa([this,Ba.WARN],t))},za.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,Wa([this,Ba.ERROR],t))},za);function za(t){this.name=t,this._logLevel=Ha,this._logHandler=Ka}var Ya=((Qa={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Qa["bad-app-name"]="Illegal App name: '{$appName}",Qa["duplicate-app"]="Firebase App named '{$appName}' already exists",Qa["app-deleted"]="Firebase App named '{$appName}' already deleted",Qa["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Qa),Xa=new wa("app","Firebase",Ya),Ja="[DEFAULT]",$a=(Object.defineProperty(Za.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(Za.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Za.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),Za.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},Za.prototype._getService=function(t,e){if(void 0===e&&(e=Ja),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==Ja?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},Za.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=Ja),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},Za.prototype.extendApp=function(t){if(ha(this,t),t.INTERNAL){if(t.INTERNAL.addAuthTokenListener){for(var e=0,n=this.tokenListeners_;e<n.length;e++){var r=n[e];this.INTERNAL.addAuthTokenListener(r)}this.tokenListeners_=[]}if(t.INTERNAL.analytics){for(var i=0,o=this.analyticsEventRequests_;i<o.length;i++){var a=o[i];this.INTERNAL.analytics.logEvent.apply(void 0,a)}this.analyticsEventRequests_=[]}}},Za.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Xa.create("app-deleted",{appName:this.name_})},Za);function Za(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.services_={},this.tokenListeners_=[],this.analyticsEventRequests_=[],this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=ca(t);var i=this;this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){r.tokenListeners_.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){r.tokenListeners_=r.tokenListeners_.filter(function(t){return t!==e})},analytics:{logEvent:function(){i.analyticsEventRequests_.push(arguments)}}}}$a.prototype.name&&$a.prototype.options||$a.prototype.delete||console.log("dc");var ts="7.2.0",es=new Ga("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){es.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ns=self.firebase.SDK_VERSION;ns&&0<=ns.indexOf("LITE")&&es.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var rs=function t(){var e=function(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={}),"object"==typeof e&&null!==e||(e={name:e});var n=e;void 0===n.name&&(n.name=Ja);var r=n.name;if("string"!=typeof r||!r)throw Xa.create("bad-app-name",{appName:String(r)});if(Ca(o,r))throw Xa.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:ts,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),s[n])return es.debug("There were multiple attempts to register service "+n+"."),c[n];function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw Xa.create("invalid-app-argument",{appName:n});return t[n]()}return s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)})),void 0!==e&&ha(o,e),c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!Ca(o,t=t||Ja))throw Xa.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(0,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}($a);return e.INTERNAL=Xo(Xo({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){ha(e,t)},createSubscribe:Oa,ErrorFactory:wa,deepExtend:ha}),e}(),is=rs.initializeApp;rs.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&es.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),is.apply(void 0,t)};var fl=rs;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.o=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ja(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ja(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ja(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),g=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).fd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function M(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=x(t,e)}function V(t,e){var n;return(n=0<=(e=x(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function vt(){this.a="",this.b=Et}function gt(t){return t instanceof vt&&t.constructor===vt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}vt.prototype.qa=!0,vt.prototype.pa=function(){return this.a.toString()},vt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof vt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var _t,Et={};function Tt(t){var e=new vt;return e.a=t,e}Tt("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function Mt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function xt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));M(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||Ft())(t):l.setImmediate(t)}}(),qt||(Ot(),qt=!0),Vt.add(t,e)}Dt("<br>");var qt=!1,Vt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(E(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Wt,ee(this,Kt,t)},t.Pc=function(t){this.a=Wt,ee(this,Qt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.ta=this.ta,this.la=this.la}S(ue,C);var he=0;function le(t){if(!t.ta&&(t.ta=!0,t.xa(),0!=he))t[e]||(t[e]=++g)}function fe(t){return fe[" "](t),t}ce.prototype.ta=!(ue.prototype.name="cancel"),ce.prototype.xa=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ve=Ct("Edge"),ge=ve||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=l.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",p,e),l.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},S(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Le,this.ra=this.Ia=!1}function Ue(t){t.ra=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ra&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ra){var e=t.src;if(e&&e[xe])Ve(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ra&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&ze(t),n.call(r,e)}function $e(t,e){if(t.ra)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new qe(this),(this.Sb=this).Wa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ra&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ve(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(y(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Sb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.xa=function(){if(nn.qb.xa.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.l),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)vn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(h(t))xn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',xt(a.name),'"'),a.type){o.push(' type="',xt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||v(o)&&0<o.nodeType?r(o):L(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=gt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof vt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(M(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof vt||e instanceof vt||(e="object"==typeof e&&e.qa?e.pa():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=gt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=gt(e).toString(),a&&(ge&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+xt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(gt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Vc:"FirebaseCore-web",Xc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return l.navigator&&l.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function vr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function gr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&vr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Er(t){return void 0===t?null:Qn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",l)&&!mr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function Mr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var xr={};Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==xr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,qr(t[n]));return e}function Vr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,Lr(this,zr,t),Lr(this,Gr,qr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=wn(t=_n(t),ti)||null,n=wn(t,ei)||null,r=wn(t,ii)||null;if(r=r&&ai[r]||null,!e||!n||!r)throw new Yr("argument-error",ti+", "+ei+"and "+ii+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ni)||null,languageCode:wn(t,ri)||null,tenantId:wn(t,oi)||null})}var ti="apiKey",ei="oobCode",ni="continueUrl",ri="languageCode",ii="mode",oi="tenantId",ai={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Br,verifyEmail:"VERIFY_EMAIL"};function si(t){try{return new Zr(t)}catch(t){return null}}function ui(t){var e=t[pi];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ci];if(n&&"object"==typeof n){e=n[mi];var r=n[di];if(n=n[yi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",di+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",yi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",mi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ci+" property must be a non null object when specified.");if(this.f=null,(e=t[fi])&&"object"==typeof e){if("string"==typeof(e=e[vi])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",vi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",fi+" property must be a non null object when specified.");if(void 0!==(e=t[li])&&"boolean"!=typeof e)throw new Yr("argument-error",li+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var ci="android",hi="dynamicLinkDomain",li="handleCodeInApp",fi="iOS",pi="url",di="installApp",yi="minimumVersion",mi="packageName",vi="bundleId";function gi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var bi=null,wi=null;function _i(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=wi[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!bi){bi={},wi={};for(var t=0;t<65;t++)bi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wi[bi[t]]=t)&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ei(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ti(t){return(t=Si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ei(t):null}function Si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(_i(t))}catch(t){}return null}Ei.prototype.R=function(){return this.c},Ei.prototype.g=function(){return this.b};var Ii,Ci={ad:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},cd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},dd:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ni(t){for(var e in Ci)if(Ci[e].id===t)return{firebaseEndpoint:(t=Ci[e]).bb,secureTokenEndpoint:t.ib};return null}Ii=Ni("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),ki=["client_id","response_type","scope","redirect_uri","state"],Di={Wc:{Oa:"locale",Da:500,Ca:600,Pa:"facebook.com",hb:ki},Yc:{Oa:null,Da:500,Ca:620,Pa:"github.com",hb:ki},Zc:{Oa:"hl",Da:515,Ca:680,Pa:"google.com",hb:ki},ed:{Oa:"lang",Da:485,Ca:705,Pa:"twitter.com",hb:Ai}};function Ri(t){for(var e in Di)if(Di[e].Pa==t)return Di[e];return null}function Oi(t){var e={};e["facebook.com"]=Fi,e["google.com"]=qi,e["github.com"]=Ui,e["twitter.com"]=Vi;var n=t&&t[Mi];try{if(n)return e[n]?new e[n](t):new Li(t);if(void 0!==t[Pi])return new xi(t)}catch(t){}return null}var Pi="idToken",Mi="providerId";function xi(t){var e=t[Mi];if(!e&&t[Pi]){var n=Ti(t[Pi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Li(t){xi.call(this,t),Lr(this,"profile",qr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Fi(t){if(Li.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(Li.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function qi(t){if(Li.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Vi(t){if(Li.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Bi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function ji(){}function Wi(t,n){return t.then(function(t){if(t[Oa]){var e=Ti(t[Oa]);if(!e||n!=e.f)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Ki(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Qi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ki(t.providerId,t.pendingToken)}catch(t){}return null}function Gi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Gi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Xi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.cb=(Ri(t)||{}).Oa||null,this.ab=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');Xi.call(this,t,[])}function $i(t){Xi.call(this,t,ki),this.a=[]}function Zi(){$i.call(this,"facebook.com")}function to(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){$i.call(this,"github.com")}function no(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){$i.call(this,"google.com"),this.wa("profile")}function io(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Xi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Gi("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=si(t=Bi(t)))&&t.operation===Br?t:null}function fo(t){if(!(t.Ua&&t.Ta||t.Fa&&t.ba))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function yo(t){return t.a.Fa&&t.a.ba?{temporaryProof:t.a.Fa,phoneNumber:t.a.ba}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function mo(t){try{this.a=t||fl.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function vo(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new fo({Ua:t,Ta:e})}function go(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Fa:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ki(e,a):new Gi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new $i(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function bo(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function wo(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function _o(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody,t.tenantId):null}function Eo(){this.b=null,this.a=[]}S(Li,xi),S(Fi,Li),S(Ui,Li),S(qi,Li),S(Vi,Li),Ki.prototype.na=function(t){return Xa(t,Qi(this))},Ki.prototype.b=function(t,e){var n=Qi(this);return n.idToken=e,Ja(t,n)},Ki.prototype.f=function(t,e){return Wi($a(t,Qi(this)),e)},Ki.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Gi.prototype.na=function(t){return Xa(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Ja(t,n)},Gi.prototype.f=function(t,e){return Wi($a(t,zi(this)),e)},Gi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Xi.prototype.Ea=function(t){return this.zb=H(t),this},S(Ji,Xi),S($i,Xi),$i.prototype.wa=function(t){return q(this.a,t)||this.a.push(t),this},$i.prototype.Hb=function(){return W(this.a)},$i.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Gi(this.providerId,n,this.providerId)},S(Zi,$i),Lr(Zi,"PROVIDER_ID","facebook.com"),Lr(Zi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(eo,$i),Lr(eo,"PROVIDER_ID","github.com"),Lr(eo,"GITHUB_SIGN_IN_METHOD","github.com"),S(ro,$i),Lr(ro,"PROVIDER_ID","google.com"),Lr(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),S(oo,Xi),Lr(oo,"PROVIDER_ID","twitter.com"),Lr(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Ts,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,vs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Wi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Va(yo(this))},fo.prototype.b=function(t,e){var n=yo(this);return n.idToken=e,Ns(t,Is,n)},fo.prototype.f=function(t,e){var n=yo(this);return n.operation="REAUTH",Wi(t=Ns(t,Cs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Va=function(e,n){var r=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,ys,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(mo,{PROVIDER_ID:"phone"}),Fr(mo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var To,So=null;function Io(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Mt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Mt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function Co(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&Lr(this,"email",t.Ab),t.ba&&Lr(this,"phoneNumber",t.ba),t.credential&&Lr(this,"credential",t.credential),t.Qb&&Lr(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:go(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new Co(e,n,t.message)}return null}function Ao(){}function ko(t){return t.c||(t.c=t.b())}function Do(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Oo(){}function Po(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Ib,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function Mo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function xo(t,e,n){this.reset(t,e,n,void 0,void 0)}function Lo(t){this.f=t,this.b=this.c=this.a=null}function Fo(t,e){this.name=t,this.value=e}S(Io,Yr),S(Co,Yr),Co.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&z(t,e),t},Co.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,S(Do,Ao),Do.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Do.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},To=new Do,S(Oo,Ao),Oo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Po;throw Error("Unsupported browser")},Oo.prototype.b=function(){return{}},(t=Po.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Mo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Mo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Mo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},xo.prototype.a=null,xo.prototype.reset=function(t,e,n,r,i){delete this.a},Fo.prototype.toString=function(){return this.name};var Uo=new Fo("SEVERE",1e3),qo=new Fo("WARNING",900),Vo=new Fo("CONFIG",700),Bo=new Fo("FINE",500);Lo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new xo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo,Wo={},Ko=null;function Qo(t){var e;if(Ko||(Ko=new Lo(""),(Wo[""]=Ko).c=Vo),!(e=Wo[t])){e=new Lo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Qo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Wo[t]=e}return e}function Ho(t,e){t&&t.log(Bo,e,void 0)}function Go(t){this.f=t}function zo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Qo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(Go,Ao),Go.prototype.a=function(){return new zo(this.f)},Go.prototype.b=(jo={},function(){return jo}),S(zo,nn);var Yo=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Ma.bind(t))}function Jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,$o(t)}function $o(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Zo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=zo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,$o(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Jo(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,$o(this)),this.a&&(this.readyState=3,$o(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Ma.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Ma.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Jo(this,!0):$o(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Jo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Jo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(qo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(qo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(qo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Zo,nn);var ta="";Zo.prototype.b=Qo("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ra(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():To.a(),e.w=e.B?ko(e.B):ko(To),e.a.onreadystatechange=_(e.Lb,e);try{Ho(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Ho(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||h(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=ia,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),r=l.FormData&&t instanceof l.FormData,!q(na,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Ho(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ga,e)):e.o=sn(e.Ga,e.g,e)),Ho(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Ho(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ia(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Ho(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Ho(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!ea.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Ho(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function pa(t){var e=Sa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function da(t,e,n){t.a=!0,t.c=n,t.f=!e,ga(t)}function ya(t){if(t.a){if(!t.u)throw new ba(t);t.u=!1}}function ma(t,e,n,r){t.g.push([e,n,r]),t.a&&ga(t)}function va(t){return U(t.g,function(t){return m(t[1])})}function ga(e){if(e.h&&e.a&&va(e)){var n=e.h,r=Ea[n];r&&(l.clearTimeout(r.a),delete Ea[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,va(e)||(r=!0)}}e.c=n,t&&(s=_(e.m,e,!0),t=_(e.m,e,!1),n instanceof pa?(ma(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new _a(n),Ea[n.a]=n,e.h=n.a)}function ba(){C.call(this)}function wa(){C.call(this)}function _a(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Zo.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ho(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ho(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.xa=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Zo.qb.xa.call(this)},t.Lb=function(){this.ta||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ho(this.b,"Can not get response: "+t.message),null}},pa.prototype.cancel=function(t){if(this.a)this.c instanceof pa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),ya(this),da(this,!1,t))}},pa.prototype.m=function(t,e){this.i=!1,da(this,t,e)},pa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ma(this,r,function(t){t instanceof wa?o.cancel():i(t)}),o.then(t,e,n)},pa.prototype.$goog_Thenable=!0,S(ba,C),ba.prototype.message="Deferred has already fired",ba.prototype.name="AlreadyCalledError",S(wa,C),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",_a.prototype.c=function(){throw delete Ea[this.a],this.b};var Ea={};function Ta(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ga:void 0},a=new pa(o);return e=window.setTimeout(function(){Ia(i,!0);var t=new Aa(Na,"Timeout reached for loading script "+r);ya(a),da(a,!1,t)},5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ia(i,!1,e),ya(a),da(a,!0,null))},i.onerror=function(){Ia(i,!0,e);var t=new Aa(Ca,"Error while loading script "+r);ya(a),da(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){M(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Sa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ia(t,!0,this.Ga)}}function Ia(t,e,n){null!=n&&l.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ca=0,Na=1;function Aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ka(t){this.f=t}function Da(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Pa,this.g=H(t.secureTokenHeaders||Ma),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||xa,this.a=H(t.firebaseHeaders||La),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,sr()?this.f=new Go(self):cr()?this.f=new ka(n):this.f=new Oo,this.b=null}S(Aa,C),S(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Ra,Oa="idToken",Pa=new Ar(3e4,6e4),Ma={"Content-Type":"application/x-www-form-urlencoded"},xa=new Ar(3e4,6e4),La={"Content-Type":"application/json"};function Fa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function qa(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ra=Ra||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ma(t,null,e,void 0)}(Ta(nt(Va,{onload:Ba})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.m,t)))(e,n,r,i,o,a)}Da.prototype.R=function(){return this.b},Da.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Zo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Ho(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ra(a,t,e,r,i)};var Va=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ba="__fcb"+Math.floor(1e6*Math.random()).toString();function ja(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Wa(t){"email"in t&&ja(t)}function Ka(t){if(!t[Oa])throw new Yr("internal-error")}function Qa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Da.prototype.m=function(t,n,r,i,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Da.prototype.ob=function(){return Ns(this,gs,{})},Da.prototype.rb=function(t,e){return Ns(this,ms,{idToken:t,email:e})},Da.prototype.sb=function(t,e){return Ns(this,vs,{idToken:t,password:e})};var Ha={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ga(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function za(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=As(t.errorMessage)),e)throw e;if(!t[Oa])throw new Yr("internal-error")}function Xa(t,e){return e.returnIdpCredential=!0,Ns(t,bs,e)}function Ja(t,e){return e.returnIdpCredential=!0,Ns(t,_s,e)}function $a(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Za(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Da.prototype).tb=function(t,r){var i={idToken:t},o=[];return K(Ha,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),Ns(this,ms,i)},t.kb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Va=function(t){return Ns(this,Ss,t)},t.$a=function(t,e){return Ns(this,ds,{oobCode:t,newPassword:e})},t.Ka=function(t){return Ns(this,es,{oobCode:t})},t.Xa=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Za,fa:"email",F:!0},es={endpoint:"resetPassword",D:Za,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(ja(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0,F:!0},rs={endpoint:"createAuthUri",F:!0},is={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:ja,K:Ka,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:ja,K:Ka,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ps={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},ds={endpoint:"resetPassword",D:Za,fa:"email",F:!0},ys={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ms={endpoint:"setAccountInfo",V:["idToken"],D:Wa,T:!0},vs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Wa(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0},gs={endpoint:"signupNewUser",K:Ka,T:!0,F:!0},bs={endpoint:"verifyAssertion",D:Ga,Qa:za,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Ga,Qa:za,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw As(t.errorMessage);if(!t[Oa])throw new Yr("internal-error")},T:!0,F:!0},_s={endpoint:"verifyAssertion",D:function(t){if(Ga(t),!t.idToken)throw new Yr("internal-error")},Qa:za,K:Ya,T:!0},Es={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},K:Ka,T:!0,F:!0},Ts={endpoint:"verifyPassword",D:function(t){if(ja(t),!t.password)throw new Yr("wrong-password")},K:Ka,T:!0,F:!0},Ss={endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0},Is={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Qa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Ka(t)}},Cs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new Yr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,r,i,o,n){var a=_n(t.h+e);bn(a,"key",t.c),n&&bn(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){qa(t,a.toString(),function(t){t?t.error?n(ks(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Tr(i)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Yr("internal-error");return r[e.fa]})}function As(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Er(t)),new Yr("internal-error",e)}function Ds(t){this.b=t,this.a=null,this.fb=function(o){return(Ms=Ms||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Os.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(Ta(r=nt(Rs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ms=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Ps.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Rs=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Os=new Ar(3e4,6e4),Ps=new Ar(5e3,15e3),Ms=null;function xs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ls(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Fs(t){try{return fl.app(t).auth().Aa()}catch(t){return[]}}function Us(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function qs(t){var s=Jn();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Io(Jn())})}function Vs(i){return i.l||(i.l=ir().then(function(){if(!i.o){var t=i.c,e=i.h,n=Fs(i.b),r=new xs(i.u,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.o=r.toString()}i.i=new Ds(i.o),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=_o(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.l}function Bs(t){return t.m||(t.v=t.c?dr(t.c,Fs(t.b)):null,t.m=new Da(t.f,Ni(t.h),t.v)),t.m}function js(t,e,n,r,i,o,a,s,u,c,h){return(t=new Ls(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function Ws(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ks(t){this.b=t,this.a={},this.f=_(this.c,this)}xs.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Ls.prototype.nb=function(t){return this.h=t,this},Ls.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.ab=n,bn(t,"providerId",this.a.providerId),n=Tr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.ab&&!n[e.cb]&&(n[e.cb]=e.ab),Q(n)||bn(t,"customParameters",Er(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&bn(t,"scopes",e.join(","))),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Fs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return Vs(t).then(function(){return function(e,n){return e.fb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Ob=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,r,i,o,a,s){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ia().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=qs(Bs(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){bo(n),a||$n(js(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=qs(Bs(this)));var i=this;return this.a.then(function(){bo(e),$n(js(i.u,i.f,i.b,t,e,Jn(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return Vs(this).then(function(){return t.i.fb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Rb=function(){return!0},t.ya=function(t){this.g.push(t)},t.La=function(e){B(this.g,function(t){return t==e})},(t=Ws.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Er(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Qs,Hs=[];function Gs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function zs(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function Xs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Js(r,c),t}).s(function(t){throw Js(r,c),t})}function Js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function $s(){if(!eu())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var r=this;sr()&&self?(this.l=function(){var e=sr()?self:null;if(L(Hs,function(t){t.b==e&&(n=t)}),!n){var n=new Ks(e);Hs.push(n)}return n}(),Gs(this.l,"keyChanged",function(t,n){return au(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:q(e,n.key)}})}),Gs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Ys(new zs(t)),Xs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&q(t[0].value,"keyChanged")&&(r.o=!0)}).s(function(){}))})}function Zs(r){return new jt(function(e,n){var t=r.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Zs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Zs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function iu(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Xs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(r){return tu(r).then(function(t){var i=nu(ru(t,!1));return i.getAll?iu(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ir(),n="__sak"+e;return Qs=Qs||new $s,(i=Qs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.S(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.$(function(e){L(r.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ur();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function pu(){if(!function(){var t="Node"==ur();if(!(t=du()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=du()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function du(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function yu(){var t={};t.Browser=gu,t.Node=bu,t.ReactNative=wu,t.Worker=_u,this.a=t[ur()]}Ks.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},zs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)Js(this,this.a[0]);this.b=!0},(t=$s.prototype).set=function(n,r){var i,o=!1,a=this;return tu(this).then(function(t){return iu((t=nu(ru(i=t,!0))).get(n))}).then(function(t){var e=nu(ru(i,!0));return t?(t.value=r,iu(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,iu(e.add(t)))}).then(function(){return a.c[n]=r,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return iu(nu(ru(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,r=this;return tu(this).then(function(t){return n=!0,r.b++,iu(nu(ru(t,!0)).delete(e))}).then(function(){return delete r.c[e],ou(r,e)}).ka(function(){n&&r.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&L(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Ke(l.window,"storage",t)},t.ea=function(t){l.window&&Ge(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var mu,vu,gu={C:hu,Sa:pu},bu={C:hu,Sa:pu},wu={C:Ws,Sa:fu},_u={C:hu,Sa:fu},Eu={$c:"local",NONE:"none",bd:"session"};function Tu(){var t=!(Cr(yr())||!ar()),e=_r(),n=vr();this.m=t,this.h=e,this.l=n,this.a={},t=mu=mu||new yu;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.C:new uu(sr()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new cu}this.u=new cu,this.f=_(this.Pb,this),this.b={}}function Su(){return vu=vu||new Tu}function Iu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Cu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Cu(e,n),"local"==e.C&&(t.b[n]=null),Iu(t,e.C).S(n)}function Au(t){t.c&&(clearInterval(t.c),t.c=null)}function ku(t){this.a=t,this.b=Su()}(t=Tu.prototype).get=function(t,e){return Iu(this,t.C).get(Cu(t,e))},t.set=function(e,t,n){var r=Cu(e,n),i=this,o=Iu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=Cu(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),Q(this.a)&&(Iu(this,"local").$(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.l||function(r){Au(r),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Cu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(Iu(this,"local").ea(this.f),Au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Za(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Iu(this,"local").ea(this.f):Au(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Za(e))},me&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.Za,this))},t.Za=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var Du,Ru={name:"authEvent",C:"local"};function Ou(){this.a=Su()}function Pu(t,e){this.b=Mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Du||(Du=l.Int32Array?new Int32Array(Bu):Bu),this.reset()}S(Pu,function(){this.b=-1});for(var Mu=64,xu=Mu-1,Lu=[],Fu=0;Fu<xu;Fu++)Lu[Fu]=0;var Uu=j(128,Lu);function qu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Du[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Vu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(qu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(qu(t),i=0)}}t.c=i,t.g+=n}Pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ju(){Pu.call(this,8,Wu)}S(ju,Pu);var Wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Ku(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Ou,this.g=new ku(this.h),this.f=null,this.b=[],this.a=this.c=null}function Qu(t){return new Yr("invalid-cordova-configuration",t)}function Hu(t){var e=new ju;Vu(e,t),t=[];var n=8*e.g;e.c<56?Vu(e,Uu,56-e.c):Vu(e,Uu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(qu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function zu(r){return r.f||(r.f=r.ia().then(function(){return new jt(function(n){r.ya(function t(e){return n(e),r.La(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Yu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Bi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Gu(i,e)})}var o=new wo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(i).then(function(){t||Gu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},So=So||new Eo,function(t){var n=So;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(r)})})),r.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return _o(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function Xu(t){this.a=t,this.b=Su()}(t=Ku.prototype).ia=function(){return this.Ba?this.Ba:this.Ba=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",l))throw Qu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",l))throw Qu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",l))throw Qu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",l))throw Qu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new Yr("redirect-operation-pending"));var i=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return bo(e),zu(i)}).then(function(){return function(n,t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,r,null,o,new Yr("no-auth-event"),null,i),s=mr("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yr("invalid-cordova-configuration");var u=mr("BuildInfo.displayName",l),c={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Hu(o),c.sessionId=o;var h=js(n.u,n.i,n.l,t,e,null,r,n.m,c,n.o,i);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new jt(function(e,t){s=function(){var t=mr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.ya(s),u=function(){a=a||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},c=function(){kr()&&u()},o.addEventListener("resume",u,!1),yr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(i).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.La(s),i.c=null})},t.ya=function(e){this.b.push(e),zu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.La=function(e){B(this.b,function(t){return t==e})};var Ju={name:"pendingRedirect",C:"session"};function $u(t){return Nu(t.b,Ju,t.a)}function Zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.o,this),this.b=new pc,this.w=new gc,this.g=new Xu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ii)}function tc(t,e,n,r){var i=fl.SDK_VERSION||null;return or()?new Ku(t,e,n,i,r):new Us(t,e,n,i,r)}function ec(e){e.f||(e.f=!0,e.a.ya(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||dc(n.b)}function rc(n,t){q(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Ju,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?$u(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function ic(t,e){B(t.h,function(t){return t==e})}Zu.prototype.reset=function(){this.f=!1,this.a.La(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Zu.prototype.o=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return dc(this.b),e};var oc=new Ar(2e3,1e4),ac=new Ar(3e4,6e4);function sc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.ya(t.l))},function(){t.reset()},i,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,r,i){var o;return function(t){return t.b.set(Ju,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,r,i).s(function(t){if(uc(t))throw new Yr("operation-not-supported-in-this-environment");return o=t,$u(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new jt(function(){}):$u(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},oc.get())}Zu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var r=e+":"+n;return lc[r]||(lc[r]=new Zu(t,e,n)),lc[r]}function pc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function dc(t){t.g||(t.g=!0,vc(t,!1,null,null))}function yc(t){t.g&&!t.i&&vc(t,!1,null,null)}function mc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function vc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):mc(t,n):mc(t,{user:null}),t.f=[],t.c=[]}function gc(){}function bc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,Lr(this,"verificationId",t)}function _c(t,e,n,r){return new mo(t).Va(e,n).then(function(t){return new wc(t,r)})}function Ec(t){var e=Si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Tc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Sc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ic(t){this.f=t,this.b=this.a=null,this.c=0}function Cc(t,e){var n=e[Oa],r=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nc(t){return T()+1e3*parseInt(t,10)}function Ac(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?qa(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(ks(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.g,t.u.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function kc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Dc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Oc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.a=new Da(this.l,Ni(Ii),t),this.b=new Ic(this.a),qc(this,e[Oa]),Cc(this.b,e),Lr(this,"refreshToken",this.b.a),jc(this,n||{}),nn.call(this),this.J=!1,this.o&&gr()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Tc(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-T()-3e5;return 0<t?t:0})}(this),this.W=_(this.Ha,this);var r=this;this.ga=null,this.va=function(t){r.sa(t.g)},this.Z=null,this.P=[],this.ua=function(t){Mc(r,t.c)},this.Y=null}function Pc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.va),(t.Z=e)&&Ke(e,"languageCodeChanged",t.va)}function Mc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?dr(fl.SDK_VERSION,t.P):null)}function xc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.ua),(t.Y=e)&&Ke(e,"frameworkChanged",t.ua)}function Lc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Ke(t,"tokenChanged",t.W))}function Uc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function qc(t,e){t.ma=e,Lr(t,"_lat",e)}function Vc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then(function(){return t})}function Bc(t){t.i&&!t.J&&(t.J=!0,rc(t.i,t))}function jc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Wc(){}function Kc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Qc(t){return F(t.providerData,function(t){return t.providerId})}function Hc(t,e){e&&(Gc(t,e.providerId),t.providerData.push(e))}function Gc(t,e){B(t.providerData,function(t){return t.providerId==e})}function zc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Yc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Lr(e,"metadata",function(t){return new kc(t.a,t.b)}(t.metadata)):Lr(e,"metadata",new kc),L(t.providerData,function(t){Hc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),Lr(e,"refreshToken",e.b.a))}function Xc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(_(t.zc,t))}(n,t).then(function(){return e||zc(n,"isAnonymous",!1),t})})}function Jc(t,e){e[Oa]&&t.ma!=e[Oa]&&(Cc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),qc(t,e[Oa]),zc(t,"refreshToken",t.b.a))}function $c(t,e){return Xc(t).then(function(){if(q(Qc(t),e))return Vc(t).then(function(){throw new Yr("provider-already-linked")})})}function Zc(t,e,n){return Ur({user:t,credential:go(e),additionalUserInfo:e=Oi(e),operationType:n})}function th(t,e){return Jc(t,e),t.reload().then(function(){return t})}function eh(n,r,t,e,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ri(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.o&&t.isOAuthProvider&&(s=js(n.o,n.l,n.m,r,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=er(s,o&&o.Da,o&&o.Ca);return e=e().then(function(){if(rh(n),!i)return n.G().then(function(){})}).then(function(){return sc(n.i,u,r,t,a,!!s,n.tenantId)}).then(function(){return new jt(function(t,e){n.ja(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),ih(n,e,i)}function nh(e,t,n,r,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(rh(e),!i)return e.G().then(function(){})}).then(function(){return e.ca=a,Vc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),ih(e,r,i)}function rh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function ih(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(r),r.ka(function(){V(t.I,r)}),r}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Oa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Oc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Hc(r,Ur(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ah(t){this.a=t,this.b=Su()}pc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},pc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(vc(this,!0,null,t.a),Yt()):e.za(n,r)?function(e,t,n){n=n.za(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then(function(t){vc(e,s,t,null)}).s(function(t){vc(e,s,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(vc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},pc.prototype.oa=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,vc(t,!0,null,e))})}(n))})},gc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.za(n,r)?function(t,e){var n=t.b,r=t.c;e.za(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=vo(this.verificationId,t),this.a(t)},Tc.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(Sc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Tc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ic.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ic.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?Ac(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Rc,Oe),S(Oc,nn),Oc.prototype.sa=function(t){this.ga=t,Fa(this.a,t)},Oc.prototype.ha=function(){return this.ga},Oc.prototype.Aa=function(){return W(this.P)},Oc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Lr(Oc.prototype,"providerId","firebase"),(t=Oc.prototype).reload=function(){var t=this;return ih(this,Kc(this).then(function(){return Xc(t).then(function(){return Vc(t)}).then(Wc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Ec(t)})},t.G=function(t){var e=this;return ih(this,Kc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ma&&(qc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),zc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");jc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Dc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Hc(this,e[n]);zc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.gb(t)},t.gb=function(t){var e=this,n=null;return ih(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=Zc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.eb(t)},t.eb=function(e){var n=this,r=null;return ih(this,$c(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Zc(n,t,"link"),th(n,t)}).then(function(){return r}))},t.sc=function(t,e){var n=this;return ih(this,$c(this,"phone").then(function(){return _c(Lc(n),t,e,_(n.eb,n))}))},t.Bc=function(t,e){var n=this;return ih(this,Yt().then(function(){return _c(Lc(n),t,e,_(n.gb,n))}),!0)},t.rb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.Sc=function(e){var n=this;return ih(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return Jc(n,t),n.reload()}))},t.sb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Kc(this);var n=this;return ih(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Jc(n,t),zc(n,"displayName",t.displayName||null),zc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),Vc(n)}).then(Wc))},t.Qc=function(e){var n=this;return ih(this,Xc(this).then(function(t){return q(Qc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Qc(n),function(t){e[t]||Gc(n,t)}),e[mo.PROVIDER_ID]||Lr(n,"phoneNumber",null),Vc(n)}):Vc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return ih(this,this.G().then(function(t){return Ns(e.a,is,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Pc(e,null),xc(e,null),e.I=[],e.B=!0,Uc(e),Lr(e,"refreshToken",null),e.i&&ic(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?_(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return $c(e,t.providerId).then(function(){return Vc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return $c(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return Ja(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Zc(i,t,"link"),th(i,t)}).then(function(){return o}),ih(this,t)},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ih(this,Yt().then(function(){return Wi($a(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=Zc(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,r=null;return ih(this,this.G().then(function(t){return r=t,void 0===e||Q(e)?{}:gi(new ui(e))}).then(function(t){return n.a.jb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&z(e,this.metadata.A()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=Su(),this.c=null,this.f=function(e){var n=fh("local"),r=fh("session"),i=fh("none");return function(n,r,i){var o=Cu(r,i),a=Iu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,_(this.g,this))}function hh(t,e){var n,r=[];for(n in Eu)Eu[n]!==e&&r.push(Nu(t.b,fh(Eu[n]),t.a));return r.push(Nu(t.b,lh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],E(t,a),o);else n(i)})}(r)}ch.prototype.g=function(){var e=this,n=fh("local");mh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function ph(t,e){return mh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function dh(t){return mh(t,function(){return Nu(t.b,t.c,t.a)})}function yh(t,e){return mh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function mh(t,e){return t.f=t.f.then(e,e),t.f}function vh(t){if(this.l=!1,Lr(this,"settings",new bc),Lr(this,"app",t),!Ih(this).options||!Ih(this).options.apiKey)throw new Yr("invalid-api-key");t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.b=new Da(Ih(this).options&&Ih(this).options.apiKey,Ni(Ii),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(_(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(_(this.pc,this)),Th(this,null),this.h=new ch(Ih(this).options.apiKey+":"+Ih(this).name),this.w=new ah(Ih(this).options.apiKey+":"+Ih(this).name),this.Y=kh(this,function(n){var t=Ih(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ih(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return kh(e,t)}(n).then(function(){return yh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return ph(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:dh(n.h)})):null}).then(function(t){Th(n,t||null)});return kh(n,e)}(this)),this.i=kh(this,function(e){return e.Y.then(function(){return _h(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=_(this.Nc,this),this.ub=_(this.aa,this),this.ua=_(this.bc,this),this.va=_(this.mc,this),this.Ha=_(this.nc,this),this.a=null,function(e){var n=Ih(e).options.authDomain,r=Ih(e).options.apiKey;n&&gr()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,r,Ih(e).name),rc(e.a,e),Ch(e)&&Bc(Ch(e)),e.B){Bc(e.B);var t=e.B;t.sa(e.ha()),Pc(t,e),Mc(t=e.B,e.I),xc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.sa(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function gh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function bh(t){Oe.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||Xt(new Yr("auth-domain-config-required"))}function _h(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ur(t):null});return kh(t,e)}function Eh(e,t){var n={};return n.apiKey=Ih(e).options.apiKey,n.authDomain=Ih(e).options.authDomain,n.appName=Ih(e).name,e.Y.then(function(){return function(t,e,n,r){var i=new Oc(t,e);return n&&(i.da=n),r&&Mc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.Aa())}).then(function(t){return Ch(e)&&t.uid==Ch(e).uid?Yc(Ch(e),t):(Th(e,t),Bc(t)),e.aa(t)}).then(function(){Ah(e)})}function Th(t,e){Ch(t)&&(function(t,e){B(t.O,function(t){return t==e})}(Ch(t),t.ub),Ge(Ch(t),"tokenChanged",t.ua),Ge(Ch(t),"userDeleted",t.va),Ge(Ch(t),"userInvalidated",t.Ha),Uc(Ch(t))),e&&(e.O.push(t.ub),Ke(e,"tokenChanged",t.ua),Ke(e,"userDeleted",t.va),Ke(e,"userInvalidated",t.Ha),0<t.o&&Fc(e)),Lr(t,"currentUser",e),e&&(e.sa(t.ha()),Pc(e,t),Mc(e,t.I),xc(e,t))}function Sh(e,t){var n=null,r=null;return kh(e,t.then(function(t){return n=go(t),r=Oi(t),Eh(e,t)}).then(function(){return Ur({user:Ch(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ih(t){return t.app}function Ch(t){return t.currentUser}function Nh(t){return Ch(t)&&Ch(t)._lat||null}function Ah(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){V(t.O,e)}),e}function Dh(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in Eu)if(Eu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!vr()&&"none"!==t)throw n}}(e),mh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,hh(r,e)}).then(function(){if(r.c=fh(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(vh,nn),S(gh,Oe),S(bh,Oe),(t=vh.prototype).mb=function(t){return t=this.h.mb(t),kh(this,t)},t.sa=function(t){this.Z===t||this.l||(this.Z=t,Fa(this.b,this.Z),this.dispatchEvent(new gh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.sa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?dr(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new bh(this.I))},t.Aa=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ih(this).options.apiKey,authDomain:Ih(this).options.authDomain,appName:Ih(this).name,currentUser:Ch(this)&&Ch(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Xa(i.b,t).then(function(t){return o=go(t),a=Oi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Eh(i,t)}).then(function(){return Ur({user:Ch(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ri(e.providerId),r=Ir(),i=null;(!_r()||ar())&&Ih(this).options.authDomain&&e.isOAuthProvider&&(i=js(Ih(this).options.authDomain,Ih(this).options.apiKey,Ih(this).name,"signInViaPopup",e,null,r,fl.SDK_VERSION||null,null,null,this.R()));var o=er(i,t&&t.Da,t&&t.Ca);return kh(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,r,!!i,n.R())}).then(function(){return new jt(function(t,e){n.ja("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=hc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Mc=function(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return kh(this,wh(this).then(function(){return function(t){return mh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return _h(this).then(function(t){return e.a&&yc(e.a.b),t}).s(function(t){throw e.a&&yc(e.a.b),t})},t.Rc=function(t){if(!t)return Xt(new Yr("null-user"));if(this.P!=t.tenantId)return Xt(new Yr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ih(this).options.apiKey,n.authDomain=Ih(this).options.authDomain,n.appName=Ih(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Oa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Oc(e,o),n&&(e.da=n),r&&Mc(e,r),Yc(e,t),e}(t,n,e.w,e.Aa());return kh(this,this.i.then(function(){if(Ih(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ch(e)&&t.uid==Ch(e).uid?(Yc(Ch(e),t),e.aa(t)):(Th(e,r),Bc(r),e.aa(r))}).then(function(){Ah(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&yc(t.a.b),Ch(t)?(Th(t,null),dh(t.h).then(function(){Ah(t)})):Yt()});return kh(this,e)},t.Nc=function(){var r=this;return yh(this.h,Ih(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Ch(r)&&t){e=Ch(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Ch(r),t),Ch(r).G();(Ch(r)||t)&&(Th(r,t),t&&(Bc(t),t.da=r.w),r.a&&rc(r.a,r),Ah(r))}})},t.aa=function(t){return ph(this.h,t)},t.bc=function(){Ah(this),this.aa(Ch(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ch(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&q(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Ch(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Ch(e)?Ch(e).G(t).then(function(t){return{accessToken:t}}):null});return kh(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Es,{token:t}))}).then(function(t){var e=t.user;return zc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Ts,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return Sh(e,t.na(e.b))})},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Ch(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):Sh(n,n.b.ob()).then(function(t){var e=t.user;return zc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Ch(this)&&Ch(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ch(this)&&Fc(Ch(this))},t.Ec=function(e){var n=this;L(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Ch(this)&&Uc(Ch(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||q(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){B(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(ic(this.a,this),yc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ns(t,rs,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var r=this;return kh(this,Yt().then(function(){var t=new ui(n);if(!t.c)throw new Yr("argument-error",li+" must be true when sending sign in link to email");return gi(t)}).then(function(t){return r.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return kh(this,this.b.$a(t,e).then(function(){}))},t.Ka=function(t){return kh(this,this.b.Ka(t).then(function(t){return new Vr(t)}))},t.Xa=function(t){return kh(this,this.b.Xa(t).then(function(){}))},t.kb=function(e,t){var n=this;return kh(this,Yt().then(function(){return void 0===t||Q(t)?{}:gi(new ui(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return kh(this,_c(this,t,e,_(this.Ra,this)))},t.Jc=function(n,r){var i=this;return kh(this,Yt().then(function(){var t=r||Jn(),e=ho(n,t);if(!(t=lo(t)))throw new Yr("argument-error","Invalid email link!");if(t.tenantId!==i.R())throw new Yr("tenant-id-mismatch");return i.Ra(e)}))},Dh.prototype.render=function(){},Dh.prototype.reset=function(){},Dh.prototype.getResponse=function(){},Dh.prototype.execute=function(){};var Oh=null;function Ph(t,e){return(e=Mh(e))&&t.a[e]||null}function Mh(t){return(t=void 0===t?1e12:t)?t.toString():null}function xh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function Lh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new xh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Ph(this,t);t=Mh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Ph(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Ph(this,t))&&t.execute()},xh.prototype.getResponse=function(){return Lh(this),this.b},xh.prototype.execute=function(){Lh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},xh.prototype.delete=function(){Lh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Fh.prototype.g=function(){return Yt(Oh=Oh||new Rh)},Fh.prototype.c=function(){};var Uh=null;function qh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Vh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Bh=new Ar(3e4,6e4);qh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Bh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(Ta(nt(Vh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},qh.prototype.c=function(){this.b--};var jh=null;function Wh(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new Fh:jh=jh||new qh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Hh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Gh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Da(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var u=this.a[Kh];this.a[Kh]=function(t){if(zh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Qh];this.a[Qh]=function(){if(zh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,l);"function"==typeof t&&t()}}}var Kh="callback",Qh="expired-callback",Hh="sitekey",Gh="size";function zh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){V(t.h,e)}),e}function Xh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||fl.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Aa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?dr(fl.SDK_VERSION,o):null,Wh.call(this,n,t,e,function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e},o,Ni(Ii),r)}function $h(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Zh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Wh.prototype).Ba=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ps,{})}).then(function(t){e.a[Hh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Xh(this);var n=this;return Yh(this,this.Ba().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=Vn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Xh(this);var i=this;return Yh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.l,function(t){return t==e})}(i,n),e(t))};i.l.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Jh,Wh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:v}}function rl(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function il(t,e){return{name:t||"",M:"null",optional:!!e,N:i}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function sl(e,n,t,r){return{name:t||"",M:e.M+" or "+n.M,optional:!!r,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var r=e[n].name;t[r]=ll(r,t[n],e[n].j)}}function cl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){$h(t,[n],[r],!0),this[e]=r},r,n,e[n].Ya),enumerable:!0})}}function hl(t,e,n,r){t[e]=ll(e,n,r)}function ll(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return $h(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ul(vh.prototype,{Xa:{name:"applyActionCode",j:[tl("code")]},Ka:{name:"checkActionCode",j:[tl("code")]},$a:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Oc)}},il(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(vh.prototype,{lc:{name:"languageCode",Ya:sl(tl(),il(),"languageCode")},ti:{name:"tenantId",Ya:sl(tl(),il(),"tenantId")}}),(vh.Persistence=Eu).LOCAL="local",vh.Persistence.SESSION="session",vh.Persistence.NONE="none",ul(Oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},eb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},gb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Dh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(bc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Ya:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(ji,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Zi.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Zi,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(ro.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(ro,"credential",io,[sl(tl(),sl(nl(),il()),"idToken"),sl(tl(),il(),"accessToken",!0)]),ul(oo.prototype,{Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul($i.prototype,{wa:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),il()),"optionsOrIdToken"),sl(tl(),il(),"accessToken",!0)]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Gi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Ki.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(mo,"credential",vo,[tl("verificationId"),tl("verificationCode")]),ul(mo.prototype,{Va:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yr.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Co.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Io.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Zr,"parseLink",si,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Br,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:vh,AuthCredential:ji,Error:Yr};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Zi,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",ro,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",$i,[tl("providerId")]),hl(t,"SAMLAuthProvider",Ji,[tl("providerId")]),hl(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof vh)}}]),hl(t,"RecaptchaVerifier",Jh,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Zr,[]),fl.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new vh(t)).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Wb,t),removeAuthTokenListener:_(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),fl.INTERNAL.extendNamespace({User:Oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var os=(as.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Sa(e))},as.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ta(e)},as.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},as.prototype.prefixedName_=function(t){return this.prefix_+t},as.prototype.toString=function(){return this.domStorage_.toString()},as);function as(t){this.domStorage_=t,this.prefix_="firebase:"}var ss=(us.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},us.prototype.get=function(t){return Ca(this.cache_,t)?this.cache_[t]:null},us.prototype.remove=function(t){delete this.cache_[t]},us);function us(){this.cache_={},this.isInMemoryStorage=!0}function cs(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new os(e)}}catch(t){}return new ss}function hs(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;aa(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Da;n.update(e);var r=n.digest();return ua.encodeByteArray(r)}function ls(t,e){aa(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Ss.logLevel=Ba.VERBOSE,As=Ss.log.bind(Ss),e&&Ts.set("logging_enabled",!0)):"function"==typeof t?As=t:(As=null,Ts.remove("logging_enabled"))}function fs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===ks&&(ks=!1,null===As&&!0===Ts.get("logging_enabled")&&ls(!0)),As){var n=Ns.apply(null,t);As(n)}}function ps(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];fs.apply(void 0,ea([n],t))}}function ds(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Ns.apply(void 0,ea(t));Ss.error(n)}function ys(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Ns.apply(void 0,ea(t));throw Ss.error(n),new Error(n)}function ms(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Ns.apply(void 0,ea(t));Ss.warn(n)}function vs(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function gs(t,e){return t===e?0:t<e?-1:1}function bs(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Sa(e))}function ws(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var _s,Es=cs("localStorage"),Ts=cs("sessionStorage"),Ss=new Ga("@firebase/database"),Is="FIREBASE_DATABASE_EMULATOR_HOST",Cs=(_s=1,function(){return _s++}),Ns=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Ns.apply(null,t[r]):"object"==typeof t[r]?n+=Sa(t[r]):n+=t[r],n+=" ";return n},As=null,ks=!0,Ds="[MIN_NAME]",Rs="[MAX_NAME]",Os=function(t,e){if(t===e)return 0;if(t===Ds||e===Rs)return-1;if(e===Ds||t===Rs)return 1;var n=qs(t),r=qs(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ps=function(t){if("object"!=typeof t||null===t)return Sa(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Sa(e[i]),r+=":",r+=Ps(t[e[i]]);return r+="}"};function Ms(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function xs(t){var e,n,r,i,o,a,s;for(aa(!vs(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Ls(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw ms("Exception was thrown by user callback.",t),e},Math.floor(0))}}function Fs(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Us=new RegExp("^-?(0*)\\d{1,10}$"),qs=function(t){if(Us.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Vs=(Object.defineProperty(Bs,"Empty",{get:function(){return new Bs("")},enumerable:!0,configurable:!0}),Bs.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Bs.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Bs.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Bs(this.pieces_,t)},Bs.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Bs.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Bs.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Bs.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Bs.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Bs(t,0)},Bs.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Bs)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Bs(e,0)},Bs.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Bs.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Bs.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Bs.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Os(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Bs.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Bs.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Bs);function Bs(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var js=(Object.defineProperty(Ws,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Ws,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Ws.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Va(t),this.checkValid_()},Ws.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Va(t),0<this.parts_.length&&(this.byteLength_-=1)},Ws.prototype.checkValid_=function(){if(this.byteLength_>Ws.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Ws.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Ws.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ws.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Ws.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Ws);function Ws(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Va(this.parts_[n]);this.checkValid_()}var Ks="firebaseio.com",Qs="websocket",Hs="long_polling",Gs=(zs.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},zs.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},zs.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},zs.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},zs.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Es.set("host:"+this.host,this.internalHost))},zs.prototype.connectionURL=function(t,e){var n;if(aa("string"==typeof t,"typeof type must == string"),aa("object"==typeof e,"typeof params must == object"),t===Qs)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Hs)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Ms(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},zs.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},zs.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},zs);function zs(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Es.get("host:"+t)||this.host}function Ys(t){var e=su(t),n=e.namespace;"firebase"===e.domain&&ys(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||ys("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ms("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Gs(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Vs(e.pathString)}}function Xs(t){return"string"==typeof t&&0!==t.length&&!uu.test(t)}function Js(t){return"string"==typeof t&&0!==t.length&&!cu.test(t)}function $s(t){return null===t||"string"==typeof t||"number"==typeof t&&!vs(t)||t&&"object"==typeof t&&Ca(t,".sv")}function Zs(t,e,n,r,i){i&&void 0===n||lu(Fa(t,e,i),n,r)}function tu(t,e,n,r,i){if(!i||void 0!==n){var o=Fa(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Ms(n,function(t,e){var n=new Vs(t);if(lu(o,e,r.child(n)),".priority"===n.getBack()&&!$s(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Xs(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Vs.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function eu(t,e,n,r){if(!r||void 0!==n){if(vs(n))throw new Error(Fa(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!$s(n))throw new Error(Fa(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function nu(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Fa(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ru(t,e,n,r){if(!(r&&void 0===n||Xs(n)))throw new Error(Fa(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function iu(t,e,n,r){if(!(r&&void 0===n||Js(n)))throw new Error(Fa(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function ou(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function au(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Xs(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),Js(t)}(r))throw new Error(Fa(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var su=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=Zo(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):ms("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},uu=/[\[\].#$\/\u0000-\u001F\u007F]/,cu=/[\[\].#$\u0000-\u001F\u007F]/,hu=10485760,lu=function(n,t,e){var r=e instanceof Vs?new js(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(vs(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>hu/3&&Va(t)>hu)throw new Error(n+"contains a string greater than "+hu+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Ms(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!Xs(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),lu(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},fu=(pu.prototype.cancel=function(t){La("OnDisconnect.cancel",0,1,arguments.length),Ua("OnDisconnect.cancel",1,t,!0);var e=new la;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},pu.prototype.remove=function(t){La("OnDisconnect.remove",0,1,arguments.length),ou("OnDisconnect.remove",this.path_),Ua("OnDisconnect.remove",1,t,!0);var e=new la;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},pu.prototype.set=function(t,e){La("OnDisconnect.set",1,2,arguments.length),ou("OnDisconnect.set",this.path_),Zs("OnDisconnect.set",1,t,this.path_,!1),Ua("OnDisconnect.set",2,e,!0);var n=new la;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},pu.prototype.setWithPriority=function(t,e,n){La("OnDisconnect.setWithPriority",2,3,arguments.length),ou("OnDisconnect.setWithPriority",this.path_),Zs("OnDisconnect.setWithPriority",1,t,this.path_,!1),eu("OnDisconnect.setWithPriority",2,e,!1),Ua("OnDisconnect.setWithPriority",3,n,!0);var r=new la;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},pu.prototype.update=function(t,e){if(La("OnDisconnect.update",1,2,arguments.length),ou("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ms("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}tu("OnDisconnect.update",1,t,this.path_,!1),Ua("OnDisconnect.update",2,e,!0);var i=new la;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},pu);function pu(t,e){this.repo_=t,this.path_=e}var du=(yu.prototype.toJSON=function(){return La("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},yu);function yu(t,e){this.committed=t,this.snapshot=e}var mu,vu,gu,bu=(mu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",vu=0,gu=[],function(t){var e,n=t===vu;vu=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=mu.charAt(t%64),t=Math.floor(t/64);aa(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===gu[e];e--)gu[e]=0;gu[e]++}else for(e=0;e<12;e++)gu[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=mu.charAt(gu[e]);return aa(20===i.length,"nextPushId: Length should be 20."),i}),wu=(_u.Wrap=function(t,e){return new _u(t,e)},_u);function _u(t,e){this.name=t,this.node=e}var Eu,Tu=(Su.prototype.getCompare=function(){return this.compare.bind(this)},Su.prototype.indexedValueChanged=function(t,e){var n=new wu(Ds,t),r=new wu(Ds,e);return 0!==this.compare(n,r)},Su.prototype.minPost=function(){return wu.MIN},Su);function Su(){}var Iu,Cu=(Yo(Nu,Iu=Tu),Object.defineProperty(Nu,"__EMPTY_NODE",{get:function(){return Eu},set:function(t){Eu=t},enumerable:!0,configurable:!0}),Nu.prototype.compare=function(t,e){return Os(t.name,e.name)},Nu.prototype.isDefinedOn=function(t){throw sa("KeyIndex.isDefinedOn not expected to be called.")},Nu.prototype.indexedValueChanged=function(t,e){return!1},Nu.prototype.minPost=function(){return wu.MIN},Nu.prototype.maxPost=function(){return new wu(Rs,Eu)},Nu.prototype.makePost=function(t,e){return aa("string"==typeof t,"KeyIndex indexValue must always be a string."),new wu(t,Eu)},Nu.prototype.toString=function(){return".key"},Nu);function Nu(){return null!==Iu&&Iu.apply(this,arguments)||this}var Au,ku=new Cu;function Du(t){return"number"==typeof t?"number:"+xs(t):"string:"+t}function Ru(t){if(t.isLeafNode()){var e=t.val();aa("string"==typeof e||"number"==typeof e||"object"==typeof e&&Ca(e,".sv"),"Priority must be a string or number.")}else aa(t===Au||t.isEmpty(),"priority of unexpected type.");aa(t===Au||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Ou,Pu,Mu,xu,Lu=(Object.defineProperty(Fu,"__childrenNodeConstructor",{get:function(){return Ou},set:function(t){Ou=t},enumerable:!0,configurable:!0}),Fu.prototype.isLeafNode=function(){return!0},Fu.prototype.getPriority=function(){return this.priorityNode_},Fu.prototype.updatePriority=function(t){return new Fu(this.value_,t)},Fu.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Fu.__childrenNodeConstructor.EMPTY_NODE},Fu.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Fu.__childrenNodeConstructor.EMPTY_NODE},Fu.prototype.hasChild=function(){return!1},Fu.prototype.getPredecessorChildName=function(t,e){return null},Fu.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Fu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Fu.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(aa(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Fu.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Fu.prototype.isEmpty=function(){return!1},Fu.prototype.numChildren=function(){return 0},Fu.prototype.forEachChild=function(t,e){return!1},Fu.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Fu.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Du(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?xs(this.value_):this.value_,this.lazyHash_=hs(t)}return this.lazyHash_},Fu.prototype.getValue=function(){return this.value_},Fu.prototype.compareTo=function(t){return t===Fu.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Fu.__childrenNodeConstructor?-1:(aa(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Fu.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Fu.VALUE_TYPE_ORDER.indexOf(e),i=Fu.VALUE_TYPE_ORDER.indexOf(n);return aa(0<=r,"Unknown leaf type: "+e),aa(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Fu.prototype.withIndex=function(){return this},Fu.prototype.isIndexed=function(){return!0},Fu.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Fu.VALUE_TYPE_ORDER=["object","boolean","number","string"],Fu);function Fu(t,e){void 0===e&&(e=Fu.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,aa(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ru(this.priorityNode_)}function Uu(){return null!==xu&&xu.apply(this,arguments)||this}var qu=new(Yo(Uu,xu=Tu),Uu.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Os(t.name,e.name):i},Uu.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Uu.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Uu.prototype.minPost=function(){return wu.MIN},Uu.prototype.maxPost=function(){return new wu(Rs,new Lu("[PRIORITY-POST]",Mu))},Uu.prototype.makePost=function(t,e){var n=Pu(t);return new wu(e,new Lu("[PRIORITY-POST]",n))},Uu.prototype.toString=function(){return".priority"},Uu),Vu=(Bu.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Bu.prototype.hasNext=function(){return 0<this.nodeStack_.length},Bu.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Bu);function Bu(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var ju=(Wu.prototype.copy=function(t,e,n,r,i){return new Wu(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Wu.prototype.count=function(){return this.left.count()+1+this.right.count()},Wu.prototype.isEmpty=function(){return!1},Wu.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Wu.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Wu.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},Wu.prototype.minKey=function(){return this.min_().key},Wu.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Wu.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},Wu.prototype.removeMin_=function(){if(this.left.isEmpty())return Hu.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},Wu.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Hu.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},Wu.prototype.isRed_=function(){return this.color},Wu.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},Wu.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},Wu.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},Wu.prototype.rotateLeft_=function(){var t=this.copy(null,null,Wu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Wu.prototype.rotateRight_=function(){var t=this.copy(null,null,Wu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Wu.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Wu.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},Wu.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},Wu.RED=!0,Wu.BLACK=!1,Wu);function Wu(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Wu.RED,this.left=null!=r?r:Hu.EMPTY_NODE,this.right=null!=i?i:Hu.EMPTY_NODE}var Ku=(Qu.prototype.copy=function(t,e,n,r,i){return this},Qu.prototype.insert=function(t,e,n){return new ju(t,e,null)},Qu.prototype.remove=function(t,e){return this},Qu.prototype.count=function(){return 0},Qu.prototype.isEmpty=function(){return!0},Qu.prototype.inorderTraversal=function(t){return!1},Qu.prototype.reverseTraversal=function(t){return!1},Qu.prototype.minKey=function(){return null},Qu.prototype.maxKey=function(){return null},Qu.prototype.check_=function(){return 0},Qu.prototype.isRed_=function(){return!1},Qu);function Qu(){}var Hu=(Gu.prototype.insert=function(t,e){return new Gu(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ju.BLACK,null,null))},Gu.prototype.remove=function(t){return new Gu(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ju.BLACK,null,null))},Gu.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},Gu.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Gu.prototype.isEmpty=function(){return this.root_.isEmpty()},Gu.prototype.count=function(){return this.root_.count()},Gu.prototype.minKey=function(){return this.root_.minKey()},Gu.prototype.maxKey=function(){return this.root_.maxKey()},Gu.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},Gu.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},Gu.prototype.getIterator=function(t){return new Vu(this.root_,null,this.comparator_,!1,t)},Gu.prototype.getIteratorFrom=function(t,e){return new Vu(this.root_,t,this.comparator_,!1,e)},Gu.prototype.getReverseIteratorFrom=function(t,e){return new Vu(this.root_,t,this.comparator_,!0,e)},Gu.prototype.getReverseIterator=function(t){return new Vu(this.root_,null,this.comparator_,!0,t)},Gu.EMPTY_NODE=new Ku,Gu);function Gu(t,e){void 0===e&&(e=Gu.EMPTY_NODE),this.comparator_=t,this.root_=e}var zu=Math.log(2),Yu=(Xu.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},Xu);function Xu(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/zu,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var Ju,$u,Zu=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new ju(r,n.node,ju.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new ju(r,n.node,ju.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new ju(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,ju.BLACK):(r(a,ju.BLACK),r(a,ju.RED))}return n}(new Yu(c.length));return new Hu(e||t,n)},tc={},ec=(Object.defineProperty(nc,"Default",{get:function(){return aa(qu,"ChildrenNode.ts has not been loaded"),Ju=Ju||new nc({".priority":tc},{".priority":qu})},enumerable:!0,configurable:!0}),nc.prototype.get=function(t){var e=Na(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Hu?e:null},nc.prototype.hasIndex=function(t){return Ca(this.indexSet_,t.toString())},nc.prototype.addIndex=function(t,e){aa(t!==ku,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(wu.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Zu(r,t.getCompare()):tc;var s=t.toString(),u=Xo({},this.indexSet_);u[s]=t;var c=Xo({},this.indexes_);return c[s]=n,new nc(c,u)},nc.prototype.addToIndexes=function(u,c){var h=this;return new nc(ka(this.indexes_,function(t,e){var n=Na(h.indexSet_,e);if(aa(n,"Missing index implementation for "+e),t===tc){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(wu.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),Zu(r,n.getCompare())}return tc}var a=c.get(u.name),s=t;return a&&(s=s.remove(new wu(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},nc.prototype.removeFromIndexes=function(n,r){return new nc(ka(this.indexes_,function(t){if(t===tc)return t;var e=r.get(n.name);return e?t.remove(new wu(n.name,e)):t}),this.indexSet_)},nc);function nc(t,e){this.indexes_=t,this.indexSet_=e}function rc(t,e){return Os(t.name,e.name)}function ic(t,e){return Os(t,e)}var oc,ac=(Object.defineProperty(sc,"EMPTY_NODE",{get:function(){return $u=$u||new sc(new Hu(ic),null,ec.Default)},enumerable:!0,configurable:!0}),sc.prototype.isLeafNode=function(){return!1},sc.prototype.getPriority=function(){return this.priorityNode_||$u},sc.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new sc(this.children_,t,this.indexMap_)},sc.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?$u:e},sc.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},sc.prototype.hasChild=function(t){return null!==this.children_.get(t)},sc.prototype.updateImmediateChild=function(t,e){if(aa(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new wu(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?$u:this.priorityNode_,new sc(i,n,o)},sc.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;aa(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},sc.prototype.isEmpty=function(){return this.children_.isEmpty()},sc.prototype.numChildren=function(){return this.children_.count()},sc.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(qu,function(t,e){r[t]=e.val(n),i++,a&&sc.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},sc.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Du(this.getPriority().val())+":"),this.forEachChild(qu,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":hs(r)}return this.lazyHash_},sc.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new wu(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},sc.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},sc.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new wu(e,this.children_.get(e)):null},sc.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},sc.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new wu(e,this.children_.get(e)):null},sc.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},sc.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},sc.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,wu.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},sc.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},sc.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,wu.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},sc.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===cc?-1:0},sc.prototype.withIndex=function(t){if(t===ku||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new sc(this.children_,this.priorityNode_,e)},sc.prototype.isIndexed=function(t){return t===ku||this.indexMap_.hasIndex(t)},sc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(qu),r=e.getIterator(qu),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},sc.prototype.resolveIndex_=function(t){return t===ku?null:this.indexMap_.get(t.toString())},sc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,sc);function sc(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ru(this.priorityNode_),this.children_.isEmpty()&&aa(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function uc(){return oc.call(this,new Hu(ic),ac.EMPTY_NODE,ec.Default)||this}var cc=new(Yo(uc,oc=ac),uc.prototype.compareTo=function(t){return t===this?0:1},uc.prototype.equals=function(t){return t===this},uc.prototype.getPriority=function(){return this},uc.prototype.getImmediateChild=function(t){return ac.EMPTY_NODE},uc.prototype.isEmpty=function(){return!1},uc);Object.defineProperties(wu,{MIN:{value:new wu(Ds,ac.EMPTY_NODE)},MAX:{value:new wu(Rs,cc)}}),Cu.__EMPTY_NODE=ac.EMPTY_NODE,Lu.__childrenNodeConstructor=ac,Au=cc,Mu=cc;var hc,lc=!0;function fc(r,t){if(void 0===t&&(t=null),null===r)return ac.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),aa(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Lu(r,fc(t));if(r instanceof Array||!lc){var i=ac.EMPTY_NODE;return Ms(r,function(t,e){if(Ca(r,t)&&"."!==t.substring(0,1)){var n=fc(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(fc(t))}var o=[],a=!1;if(Ms(r,function(t,e){if("."!==t.substring(0,1)){var n=fc(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new wu(t,n)))}}),0==o.length)return ac.EMPTY_NODE;var e=Zu(o,rc,function(t){return t.name},ic);if(a){var n=Zu(o,qu.getCompare());return new ac(e,fc(t),new ec({".priority":n},{".priority":qu}))}return new ac(e,fc(t),ec.Default)}function pc(){return null!==hc&&hc.apply(this,arguments)||this}Pu=fc;var dc,yc=new(Yo(pc,hc=Tu),pc.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Os(t.name,e.name):n},pc.prototype.isDefinedOn=function(t){return!0},pc.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},pc.prototype.minPost=function(){return wu.MIN},pc.prototype.maxPost=function(){return wu.MAX},pc.prototype.makePost=function(t,e){var n=fc(t);return new wu(e,n)},pc.prototype.toString=function(){return".value"},pc),mc=(Yo(vc,dc=Tu),vc.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},vc.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},vc.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Os(t.name,e.name):i},vc.prototype.makePost=function(t,e){var n=fc(t),r=ac.EMPTY_NODE.updateChild(this.indexPath_,n);return new wu(e,r)},vc.prototype.maxPost=function(){var t=ac.EMPTY_NODE.updateChild(this.indexPath_,cc);return new wu(Rs,t)},vc.prototype.toString=function(){return this.indexPath_.slice().join("/")},vc);function vc(t){var e=dc.call(this)||this;return e.indexPath_=t,aa(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var gc=(bc.prototype.val=function(){return La("DataSnapshot.val",0,0,arguments.length),this.node_.val()},bc.prototype.exportVal=function(){return La("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},bc.prototype.toJSON=function(){return La("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},bc.prototype.exists=function(){return La("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},bc.prototype.child=function(t){La("DataSnapshot.child",0,1,arguments.length),t=String(t),iu("DataSnapshot.child",1,t,!1);var e=new Vs(t),n=this.ref_.child(e);return new bc(this.node_.getChild(e),n,qu)},bc.prototype.hasChild=function(t){La("DataSnapshot.hasChild",1,1,arguments.length),iu("DataSnapshot.hasChild",1,t,!1);var e=new Vs(t);return!this.node_.getChild(e).isEmpty()},bc.prototype.getPriority=function(){return La("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},bc.prototype.forEach=function(n){var r=this;return La("DataSnapshot.forEach",1,1,arguments.length),Ua("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new bc(e,r.ref_.child(t),qu))})},bc.prototype.hasChildren=function(){return La("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(bc.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),bc.prototype.numChildren=function(){return La("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},bc.prototype.getRef=function(){return La("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(bc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),bc);function bc(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var wc=(_c.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},_c.prototype.getEventType=function(){return this.eventType},_c.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},_c.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Sa(this.snapshot.exportVal())},_c);function _c(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Ec=(Tc.prototype.getPath=function(){return this.path},Tc.prototype.getEventType=function(){return"cancel"},Tc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Tc.prototype.toString=function(){return this.path.toString()+":cancel"},Tc);function Tc(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Sc=(Ic.prototype.respondsTo=function(t){return"value"===t},Ic.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new wc("value",this,new gc(t.snapshotNode,e.getRef(),n))},Ic.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){aa(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},Ic.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ec(this,t,e):null},Ic.prototype.matches=function(t){return t instanceof Ic&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},Ic.prototype.hasAnyCallback=function(){return null!==this.callback_},Ic);function Ic(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Cc,Nc=(Ac.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Ca(this.callbacks_,e)},Ac.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ec(this,t,e):null},Ac.prototype.createEvent=function(t,e){aa(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new wc(t.type,this,new gc(t.snapshotNode,n,r),t.prevName)},Ac.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){aa(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Ac.prototype.matches=function(e){var n=this;if(e instanceof Ac){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Ac.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Ac);function Ac(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var kc=(Object.defineProperty(Dc,"__referenceConstructor",{get:function(){return aa(Cc,"Reference.ts has not been loaded"),Cc},set:function(t){Cc=t},enumerable:!0,configurable:!0}),Dc.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ku){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Ds)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Rs)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===qu){if(null!=e&&!$s(e)||null!=n&&!$s(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(aa(t.getIndex()instanceof mc||t.getIndex()===yc,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Dc.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Dc.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Dc.prototype.getQueryParams=function(){return this.queryParams_},Dc.prototype.getRef=function(){return La("Query.ref",0,0,arguments.length),new Dc.__referenceConstructor(this.repo,this.path)},Dc.prototype.on=function(t,e,n,r){La("Query.on",2,4,arguments.length),nu("Query.on",1,t,!1),Ua("Query.on",2,e,!1);var i=Dc.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Dc.prototype.onValueEvent=function(t,e,n){var r=new Sc(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Dc.prototype.onChildEvent=function(t,e,n){var r=new Nc(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Dc.prototype.off=function(t,e,n){La("Query.off",0,3,arguments.length),nu("Query.off",1,t,!0),Ua("Query.off",2,e,!0),qa("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Sc(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Nc(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Dc.prototype.once=function(e,n,t,r){var i=this;La("Query.once",1,4,arguments.length),nu("Query.once",1,e,!1),Ua("Query.once",2,n,!0);var o=Dc.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new la;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},Dc.prototype.limitToFirst=function(t){if(La("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Dc(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Dc.prototype.limitToLast=function(t){if(La("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Dc(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Dc.prototype.orderByChild=function(t){if(La("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');iu("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Vs(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new mc(e),r=this.queryParams_.orderBy(n);return Dc.validateQueryEndpoints_(r),new Dc(this.repo,this.path,r,!0)},Dc.prototype.orderByKey=function(){La("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ku);return Dc.validateQueryEndpoints_(t),new Dc(this.repo,this.path,t,!0)},Dc.prototype.orderByPriority=function(){La("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(qu);return Dc.validateQueryEndpoints_(t),new Dc(this.repo,this.path,t,!0)},Dc.prototype.orderByValue=function(){La("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(yc);return Dc.validateQueryEndpoints_(t),new Dc(this.repo,this.path,t,!0)},Dc.prototype.startAt=function(t,e){void 0===t&&(t=null),La("Query.startAt",0,2,arguments.length),Zs("Query.startAt",1,t,this.path,!0),ru("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Dc.validateLimit_(n),Dc.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Dc(this.repo,this.path,n,this.orderByCalled_)},Dc.prototype.endAt=function(t,e){void 0===t&&(t=null),La("Query.endAt",0,2,arguments.length),Zs("Query.endAt",1,t,this.path,!0),ru("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Dc.validateLimit_(n),Dc.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Dc(this.repo,this.path,n,this.orderByCalled_)},Dc.prototype.equalTo=function(t,e){if(La("Query.equalTo",1,2,arguments.length),Zs("Query.equalTo",1,t,this.path,!1),ru("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Dc.prototype.toString=function(){return La("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Dc.prototype.toJSON=function(){return La("Query.toJSON",0,1,arguments.length),this.toString()},Dc.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Dc.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Ps(t);return"{}"===e?"default":e},Dc.prototype.isEqual=function(t){if(La("Query.isEqual",1,1,arguments.length),!(t instanceof Dc))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Dc.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Ua(t,3,r.cancel,!0),r.context=n,qa(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Fa(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Dc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Dc);function Dc(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var Rc=(Oc.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Oc.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Oc);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Oc.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(qu,function(t,e){n.remember(new Vs(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Oc.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Vs(r.toString()+"/"+t);e.forEachTree(n,i)})},Oc.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Oc);function Oc(){this.value=null,this.children=new Map}function Pc(t,e){return t&&"object"==typeof t?(aa(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Mc,xc,Lc=function(t,r){var i,e=t.getPriority().val(),n=Pc(e,r);if(t.isLeafNode()){var o=t,a=Pc(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Lu(a,fc(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Lu(n))),s.forEachChild(qu,function(t,e){var n=Lc(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(xc=Mc=Mc||{})[xc.OVERWRITE=0]="OVERWRITE",xc[xc.MERGE=1]="MERGE",xc[xc.ACK_USER_WRITE=2]="ACK_USER_WRITE",xc[xc.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Fc=(Uc.User=new Uc(!0,!1,null,!1),Uc.Server=new Uc(!1,!0,null,!1),Uc.forServerTaggedQuery=function(t){return new Uc(!1,!0,t,!0)},Uc);function Uc(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,aa(!r||e,"Tagged queries must be from server.")}var qc,Vc=(Bc.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return aa(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Vs(t));return new Bc(Vs.Empty,e,this.revert)}return aa(this.path.getFront()===t,"operationForChild called for unrelated child."),new Bc(this.path.popFront(),this.affectedTree,this.revert)},Bc);function Bc(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Mc.ACK_USER_WRITE,this.source=Fc.User}var jc=(Wc.fromObject=function(t){var n=Wc.Empty;return Ms(t,function(t,e){n=n.set(new Vs(t),e)}),n},Wc.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Wc.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Vs.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Vs(n).child(i.path),value:i.value}},Wc.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},Wc.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):Wc.Empty},Wc.prototype.set=function(t,e){if(t.isEmpty())return new Wc(e,this.children);var n=t.getFront(),r=(this.children.get(n)||Wc.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new Wc(this.value,i)},Wc.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?Wc.Empty:new Wc(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?Wc.Empty:new Wc(this.value,i)}return this},Wc.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},Wc.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||Wc.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Wc(this.value,i)},Wc.prototype.fold=function(t){return this.fold_(Vs.Empty,t)},Wc.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},Wc.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Vs.Empty,e)},Wc.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},Wc.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Vs.Empty,e)},Wc.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):Wc.Empty},Wc.prototype.foreach=function(t){this.foreach_(Vs.Empty,t)},Wc.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},Wc.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},Wc.Empty=new Wc(null),Wc);function Wc(t,e){void 0===e&&(e=qc=qc||new Hu(gs)),this.value=t,this.children=e}var Kc=(Qc.prototype.operationForChild=function(t){return this.path.isEmpty()?new Qc(this.source,Vs.Empty):new Qc(this.source,this.path.popFront())},Qc);function Qc(t,e){this.source=t,this.path=e,this.type=Mc.LISTEN_COMPLETE}var Hc=(Gc.prototype.operationForChild=function(t){return this.path.isEmpty()?new Gc(this.source,Vs.Empty,this.snap.getImmediateChild(t)):new Gc(this.source,this.path.popFront(),this.snap)},Gc);function Gc(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Mc.OVERWRITE}var zc=(Yc.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Vs(t));return e.isEmpty()?null:e.value?new Hc(this.source,Vs.Empty,e.value):new Yc(this.source,Vs.Empty,e)}return aa(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new Yc(this.source,this.path.popFront(),this.children)},Yc.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Yc);function Yc(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Mc.MERGE}var Xc=(Jc.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Jc.prototype.isFiltered=function(){return this.filtered_},Jc.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},Jc.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},Jc.prototype.getNode=function(){return this.node_},Jc);function Jc(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var $c=(Zc.prototype.updateEventSnap=function(t,e,n){return new Zc(new Xc(t,e,n),this.serverCache_)},Zc.prototype.updateServerSnap=function(t,e,n){return new Zc(this.eventCache_,new Xc(t,e,n))},Zc.prototype.getEventCache=function(){return this.eventCache_},Zc.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Zc.prototype.getServerCache=function(){return this.serverCache_},Zc.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Zc.Empty=new Zc(new Xc(ac.EMPTY_NODE,!1,!1),new Xc(ac.EMPTY_NODE,!1,!1)),Zc);function Zc(t,e){this.eventCache_=t,this.serverCache_=e}var th=(eh.valueChange=function(t){return new eh(eh.VALUE,t)},eh.childAddedChange=function(t,e){return new eh(eh.CHILD_ADDED,e,t)},eh.childRemovedChange=function(t,e){return new eh(eh.CHILD_REMOVED,e,t)},eh.childChangedChange=function(t,e,n){return new eh(eh.CHILD_CHANGED,e,t,n)},eh.childMovedChange=function(t,e){return new eh(eh.CHILD_MOVED,e,t)},eh.CHILD_ADDED="child_added",eh.CHILD_REMOVED="child_removed",eh.CHILD_CHANGED="child_changed",eh.CHILD_MOVED="child_moved",eh.VALUE="value",eh);function eh(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var nh=(rh.prototype.updateChild=function(t,e,n,r,i,o){aa(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(th.childRemovedChange(e,a)):aa(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(th.childAddedChange(e,n)):o.trackChildChange(th.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},rh.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(qu,function(t,e){n.hasChild(t)||i.trackChildChange(th.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(qu,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(th.childChangedChange(t,e,n))}else i.trackChildChange(th.childAddedChange(t,e))})),n.withIndex(this.index_)},rh.prototype.updatePriority=function(t,e){return t.isEmpty()?ac.EMPTY_NODE:t.updatePriority(e)},rh.prototype.filtersNodes=function(){return!1},rh.prototype.getIndexedFilter=function(){return this},rh.prototype.getIndex=function(){return this.index_},rh);function rh(t){this.index_=t}var ih=(oh.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;aa(e==th.CHILD_ADDED||e==th.CHILD_CHANGED||e==th.CHILD_REMOVED,"Only child changes supported for tracking"),aa(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==th.CHILD_ADDED&&i==th.CHILD_REMOVED)this.changeMap.set(n,th.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==th.CHILD_REMOVED&&i==th.CHILD_ADDED)this.changeMap.delete(n);else if(e==th.CHILD_REMOVED&&i==th.CHILD_CHANGED)this.changeMap.set(n,th.childRemovedChange(n,r.oldSnap));else if(e==th.CHILD_CHANGED&&i==th.CHILD_ADDED)this.changeMap.set(n,th.childAddedChange(n,t.snapshotNode));else{if(e!=th.CHILD_CHANGED||i!=th.CHILD_CHANGED)throw sa("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,th.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},oh.prototype.getChanges=function(){return Array.from(this.changeMap.values())},oh);function oh(){this.changeMap=new Map}function ah(){}var sh=new(ah.prototype.getCompleteChild=function(t){return null},ah.prototype.getChildAfterChild=function(t,e,n){return null},ah),uh=(ch.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new Xc(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},ch.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},ch);function ch(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var hh=function(t,e){this.viewCache=t,this.changes=e},lh=(fh.prototype.assertIndexed=function(t){aa(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),aa(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},fh.prototype.applyOperation=function(t,e,n,r){var i,o,a=new ih;if(e.type===Mc.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(aa(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Mc.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(aa(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Mc.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Mc.LISTEN_COMPLETE)throw sa("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return fh.maybeAddValueEvent_(t,i,h),new hh(i,h)},fh.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(th.valueChange(e.getCompleteEventSnap()))}},fh.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(aa(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof ac?u:ac.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){aa(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},fh.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,sh,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new uh(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},fh.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new uh(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):ac.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},fh.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},fh.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);fh.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);fh.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},fh.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},fh.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:jc.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Vs(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Vs(t),i,a,s,u,c)}}),l},fh.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=jc.Empty;return s.getNode().forEachChild(ku,function(t,e){u=u.set(new Vs(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=jc.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},fh.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,sh,r)},fh.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new uh(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();aa(h instanceof ac,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,ac.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Vs.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},fh);function fh(t){this.filter_=t}var ph=(dh.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===th.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(th.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,th.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,th.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,th.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,th.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,th.VALUE,t,n,e),i},dh.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},dh.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},dh.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw sa("Should only compare child_ events.");var n=new wu(t.childName,t.snapshotNode),r=new wu(e.childName,e.snapshotNode);return this.index_.compare(n,r)},dh);function dh(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var yh,mh=(vh.prototype.getQuery=function(){return this.query_},vh.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},vh.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},vh.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},vh.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},vh.prototype.removeEventRegistration=function(t,n){var r=[];if(n){aa(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},vh.prototype.applyOperation=function(t,e,n){t.type===Mc.MERGE&&null!==t.source.queryId&&(aa(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),aa(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),aa(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},vh.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(qu,function(t,e){n.push(th.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(th.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},vh.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},vh);function vh(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new nh(n.getIndex()),i=n.getNodeFilter();this.processor_=new lh(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(ac.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ac.EMPTY_NODE,a.getNode(),null),c=new Xc(s,o.isFullyInitialized(),r.filtersNodes()),h=new Xc(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new $c(h,c),this.eventGenerator_=new ph(this.query_)}var gh=(Object.defineProperty(bh,"__referenceConstructor",{get:function(){return aa(yh,"Reference.ts has not been loaded"),yh},set:function(t){aa(!yh,"__referenceConstructor has already been defined"),yh=t},enumerable:!0,configurable:!0}),bh.prototype.isEmpty=function(){return 0===this.views.size},bh.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return aa(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=Zo(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},bh.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof ac?n.calcCompleteEventChildren(r):ac.EMPTY_NODE,!1);var c=new $c(new Xc(s,u,!1),new Xc(r,i,!1));a=new mh(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},bh.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=Zo(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ta(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new bh.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},bh.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=Zo(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},bh.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=Zo(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},bh.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},bh.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},bh.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},bh.prototype.getCompleteView=function(){var e,t;try{for(var n=Zo(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},bh);function bh(){this.views=new Map}var wh=(_h.prototype.addWrite=function(t,e){if(t.isEmpty())return new _h(new jc(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Vs.relativePath(r,t);return i=i.updateChild(o,e),new _h(this.writeTree_.set(r,i))}var a=new jc(e);return new _h(this.writeTree_.setTree(t,a))},_h.prototype.addWrites=function(n,t){var r=this;return Ms(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},_h.prototype.removeWrite=function(t){return t.isEmpty()?_h.Empty:new _h(this.writeTree_.setTree(t,jc.Empty))},_h.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},_h.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Vs.relativePath(e.path,t)):null},_h.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(qu,function(t,e){n.push(new wu(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new wu(t,e.value))}),n},_h.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new _h(null!=e?new jc(e):this.writeTree_.subtree(t))},_h.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},_h.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(aa(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(Vs.Empty,this.writeTree_,t)},_h.Empty=new _h(new jc(null)),_h);function _h(t){this.writeTree_=t}var Eh=(Th.prototype.childWrites=function(t){return new Sh(t,this)},Th.prototype.addOverwrite=function(t,e,n,r){aa(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Th.prototype.addMerge=function(t,e,n){aa(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Th.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Th.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});aa(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Ms(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Th.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Th.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Vs.Empty)){var o=Th.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||ac.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Vs.Empty)){var u=t||ac.EMPTY_NODE;return s.apply(u)}return null},Th.prototype.calcCompleteEventChildren=function(t,e){var r=ac.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(qu,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(qu,function(t,e){var n=i.childCompoundWrite(new Vs(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},Th.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){aa(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Th.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Th.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Th.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Vs.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Th.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Th.prototype.resetTree_=function(){this.visibleWrites_=Th.layerTree_(this.allWrites_,Th.DefaultFilter_,Vs.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Th.DefaultFilter_=function(t){return t.visible},Th.layerTree_=function(t,e,n){for(var r=wh.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Vs.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Vs.relativePath(a,n),r=r.addWrite(Vs.Empty,o.snap.getChild(s)));else{if(!o.children)throw sa("WriteRecord should have .snap or .children");if(n.contains(a))s=Vs.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Vs.relativePath(a,n)).isEmpty())r=r.addWrites(Vs.Empty,o.children);else{var u=Na(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Vs.Empty,c)}}}}}return r},Th);function Th(){this.visibleWrites_=wh.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Sh=(Ih.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Ih.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Ih.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Ih.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Ih.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Ih.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Ih.prototype.child=function(t){return new Ih(this.treePath_.child(t),this.writeTree_)},Ih);function Ih(t,e){this.treePath_=t,this.writeTree_=e}var Ch=(Nh.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new Hc(Fc.User,t,e)):[]},Nh.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=jc.fromObject(e);return this.applyOperationToSyncPoints_(new zc(Fc.User,t,r))},Nh.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=jc.Empty;return null!=n.snap?r=r.set(Vs.Empty,!0):Ms(n.children,function(t,e){r=r.set(new Vs(t),e)}),this.applyOperationToSyncPoints_(new Vc(n.path,r,e))}return[]},Nh.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Hc(Fc.Server,t,e))},Nh.prototype.applyServerMerge=function(t,e){var n=jc.fromObject(e);return this.applyOperationToSyncPoints_(new zc(Fc.Server,t,n))},Nh.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Kc(Fc.Server,t))},Nh.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Nh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Vs.relativePath(o,t),u=new Hc(Fc.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},Nh.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=Nh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Vs.relativePath(o,t),u=jc.fromObject(e),c=new zc(Fc.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},Nh.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=Nh.parseQueryKey_(n),i=r.path,o=r.queryId,a=Vs.relativePath(i,t),s=new Kc(Fc.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},Nh.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Vs.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Vs.Empty)):(a=new gh,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=ac.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Vs.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=Nh.makeQueryKey_(t);aa(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=Nh.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},Nh.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(Nh.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(Nh.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(Nh.makeQueryKey_(t));r.listenProvider_.stopListening(Nh.queryForListening_(t),e)})),this.removeTags_(u)}return a},Nh.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Vs.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},Nh.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Ms(n,function(t,e){r=r.concat(e)}),r})},Nh.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=Nh.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Nh.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},Nh.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(Nh.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)aa(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Ms(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(Nh.queryForListening_(c),this.tagForQuery_(c))}return o},Nh.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||ac.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},Nh.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},Nh.parseQueryKey_=function(t){var e=t.indexOf("$");return aa(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Vs(t.substr(0,e))}},Nh.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},Nh.prototype.tagForQuery_=function(t){var e=Nh.makeQueryKey_(t);return this.queryToTagMap.get(e)},Nh.getNextQueryTag_=function(){return Nh.nextQueryTag_++},Nh.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);aa(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},Nh.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Vs.Empty))},Nh.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Vs.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Vs.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},Nh.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Vs.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Vs.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},Nh.nextQueryTag_=1,Nh);function Nh(t){this.listenProvider_=t,this.syncPointTree_=jc.Empty,this.pendingWriteTree_=new Eh,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Ah=(kh.prototype.getNode=function(t){return this.rootNode_.getChild(t)},kh.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},kh);function kh(){this.rootNode_=ac.EMPTY_NODE}var Dh=(Rh.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(fs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Rh.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Rh.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Rh.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ms(t)},Rh);function Rh(t){this.app_=t}var Oh=function(t){this.accessToken=t},Ph=(Mh.prototype.getToken=function(t){return Promise.resolve(new Oh("owner"))},Mh.prototype.addTokenChangeListener=function(t){},Mh.prototype.removeTokenChangeListener=function(t){},Mh.prototype.notifyForInvalidToken=function(){ms('Database emulator unexpectedly rejected fake "owner" credentials.')},Mh);function Mh(t){this.app_=t}var xh=(Lh.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Ca(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Lh.prototype.get=function(){return ca(this.counters_)},Lh);function Lh(){this.counters_={}}var Fh=(Uh.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new xh),this.collections_[e]},Uh.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Uh.collections_={},Uh.reporters_={},Uh);function Uh(){}var qh=(Vh.prototype.get=function(){var t=this.collection_.get(),n=Xo({},t);return this.last_&&Ms(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Vh);function Vh(t){this.collection_=t,this.last_=null}var Bh=(jh.prototype.includeStat=function(t){this.statsToReport_[t]=!0},jh.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Ms(t,function(t,e){0<e&&Ca(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Fs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},jh);function jh(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new qh(t);var n=1e4+2e4*Math.random();Fs(this.reportStats_.bind(this),Math.floor(n))}var Wh=(Kh.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Qh(i)),e.add(r)}e&&this.eventLists_.push(e)},Kh.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},Kh.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},Kh.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},Kh);function Kh(){this.eventLists_=[],this.recursionDepth_=0}var Qh=(Hh.prototype.add=function(t){this.events_.push(t)},Hh.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();As&&fs("event: "+e.toString()),Ls(n)}}},Hh.prototype.getPath=function(){return this.path_},Hh);function Hh(t){this.path_=t,this.events_=[]}var Gh=(zh.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=ea(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},zh.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},zh.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},zh.prototype.validateEventType_=function(e){aa(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},zh);function zh(t){this.allowedEvents_=t,this.listeners_={},aa(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var Yh,Xh=(Yo(Jh,Yh=Gh),Jh.getInstance=function(){return new Jh},Jh.prototype.getInitialEvent=function(t){return aa("visible"===t,"Unknown event type: "+t),[this.visible_]},Jh);function Jh(){var e,t,n=Yh.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var $h,Zh=(Yo(tl,$h=Gh),tl.getInstance=function(){return new tl},tl.prototype.getInitialEvent=function(t){return aa("online"===t,"Unknown event type: "+t),[this.online_]},tl.prototype.currentlyOnline=function(){return this.online_},tl);function tl(){var t=$h.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||da()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var el=(nl.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},nl.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Ls(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},nl);function nl(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var rl=(il.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new el(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new ol(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ta(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ta(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Ks)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},il.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},il.forceAllow=function(){il.forceAllow_=!0},il.forceDisallow=function(){il.forceDisallow_=!0},il.isAvailable=function(){return!!il.forceAllow_||!(il.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},il.prototype.markConnectionHealthy=function(){},il.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},il.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},il.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},il.prototype.send=function(t){var e=Sa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=ra(t);return ua.encodeByteArray(e,!0)}(e),r=ws(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},il.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},il.prototype.incrementIncomingBytes_=function(t){var e=Sa(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},il);function il(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ps(t),this.stats_=Fh.getCollection(e),this.urlFn=function(t){return e.connectionURL(Hs,t)}}var ol=(al.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||fs("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},al.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},al.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},al.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},al.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},al.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},al.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){fs("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},al);function al(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Cs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=al.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){fs("frame writing exception"),t.stack&&fs(t.stack),fs(t)}}var sl="";var ul=null;"undefined"!=typeof MozWebSocket?ul=MozWebSocket:"undefined"!=typeof WebSocket&&(ul=WebSocket);var cl=(hl.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Ks)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Qs,r)},hl.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Es.set("previous_websocket_failure",!0);try{if(ma()){var r=oa.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+sl+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new ul(this.connURL,[],i)}else this.mySock=new ul(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},hl.prototype.start=function(){},hl.forceDisallow=function(){hl.forceDisallow_=!0},hl.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==ul&&!hl.forceDisallow_},hl.previouslyFailed=function(){return Es.isInMemoryStorage||!0===Es.get("previous_websocket_failure")},hl.prototype.markConnectionHealthy=function(){Es.remove("previous_websocket_failure")},hl.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ta(e);this.onMessage(n)}},hl.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},hl.prototype.extractFrameCount_=function(t){if(aa(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},hl.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},hl.prototype.send=function(t){this.resetKeepAlive();var e=Sa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=ws(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},hl.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},hl.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},hl.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},hl.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},hl.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},hl.responsesRequiredToBeHealthy=2,hl.healthyTimeout=3e4,hl);function hl(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ps(this.connId),this.stats_=Fh.getCollection(e),this.connURL=hl.connectionURL_(e,n,r)}var ll=(Object.defineProperty(pl,"ALL_TRANSPORTS",{get:function(){return[rl,cl]},enumerable:!0,configurable:!0}),pl.prototype.initTransports_=function(t){var e,n,r=cl&&cl.isAvailable(),i=r&&!cl.previouslyFailed();if(t.webSocketOnly&&(r||ms("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[cl];else{var o=this.transports_=[];try{for(var a=Zo(pl.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},pl.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},pl.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},pl);function pl(t){this.initTransports_(t)}var dl=(yl.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Fs(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},yl.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},yl.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},yl.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},yl.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},yl.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},yl.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},yl.prototype.onSecondaryMessageReceived_=function(t){var e=bs("t",t),n=bs("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},yl.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},yl.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},yl.prototype.onPrimaryMessageReceived_=function(t){var e=bs("t",t),n=bs("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},yl.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},yl.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},yl.prototype.onControl_=function(t){var e=bs("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?ds("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ds("Unknown control packet command: "+e)}},yl.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&ms("Protocol version mismatch detected"),this.tryStartUpgrade_())},yl.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},yl.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Fs(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},yl.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},yl.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Fs(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},yl.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},yl.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},yl.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Es.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},yl.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},yl.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},yl.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},yl.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},yl);function yl(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ps("c:"+this.id+":"),this.transportManager_=new ll(e),this.log_("Connection created"),this.start_()}var ml=(vl.prototype.put=function(t,e,n,r){},vl.prototype.merge=function(t,e,n,r){},vl.prototype.refreshAuthToken=function(t){},vl.prototype.onDisconnectPut=function(t,e,n){},vl.prototype.onDisconnectMerge=function(t,e,n){},vl.prototype.onDisconnectCancel=function(t,e){},vl.prototype.reportStats=function(t){},vl);function vl(){}var gl,bl=(Yo(wl,gl=ml),wl.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Sa(i)),aa(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},wl.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),aa(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),aa(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},wl.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;wl.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},wl.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Ca(t,"w")){var n=Na(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();ms("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},wl.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},wl.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Ia(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},wl.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Ia(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},wl.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),aa(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},wl.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},wl.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},wl.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},wl.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},wl.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},wl.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},wl.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},wl.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},wl.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},wl.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},wl.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Sa(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},wl.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):ds("Unrecognized action received from server: "+Sa(t)+"\nAre you using the latest client?")},wl.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},wl.prototype.scheduleConnect_=function(t){var e=this;aa(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},wl.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},wl.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},wl.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},wl.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+wl.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){aa(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?fs("getToken() completed but was canceled"):(fs("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new dl(i,o.repoInfo_,e,n,r,function(t){ms(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},wl.prototype.interrupt=function(t){fs("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},wl.prototype.resume=function(t){fs("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Aa(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},wl.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},wl.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},wl.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Ps(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},wl.prototype.removeListen_=function(t,e){var n,r=new Vs(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},wl.prototype.onAuthRevoked_=function(t,e){fs("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},wl.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},wl.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=Zo(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,Zo(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},wl.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+sl.replace(/\./g,"-")]=1,da()?t["framework.cordova"]=1:ya()&&(t["framework.reactnative"]=1),this.reportStats(t)},wl.prototype.shouldReconnect_=function(){var t=Zh.getInstance().currentlyOnline();return Aa(this.interruptReasons_)&&t},wl.nextPersistentConnectionId_=0,wl.nextConnectionId_=0,wl);function wl(t,e,n,r,i,o){var a=gl.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=wl.nextPersistentConnectionId_++,a.log_=ps("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!ma())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),Xh.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Zh.getInstance().on("online",a.onOnline_,a),a}var _l,El=(Yo(Tl,_l=ml),Tl.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Tl.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(aa(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Tl.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=Tl.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Na(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Tl.prototype.unlisten=function(t,e){var n=Tl.getListenId_(t,e);delete this.listens_[n]},Tl.prototype.refreshAuthToken=function(t){},Tl.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ta(r.responseText)}catch(t){ms("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&ms("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},Tl);function Tl(t,e,n){var r=_l.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=ps("p:rest:"),r.listens_={},r}var Sl="repo_interrupt",Il=(Cl.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Cl.prototype.name=function(){return this.repoInfo_.namespace},Cl.prototype.serverTime=function(){var t=this.infoData_.getNode(new Vs(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Cl.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Cl.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Vs(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=ka(e,function(t){return fc(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=fc(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=ka(e,function(t){return fc(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=fc(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Cl.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Cl.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Cl.prototype.onServerInfoUpdate_=function(t){var n=this;Ms(t,function(t,e){n.updateInfo_(t,e)})},Cl.prototype.updateInfo_=function(t,e){var n=new Vs("/.info/"+t),r=fc(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Cl.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Cl.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=fc(t,e),s=Lc(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||ms("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Cl.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Ms(t,function(t,e){r=!1;var n=fc(e);u[t]=Lc(n,i)}),r)fs("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||ms("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Ms(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},Cl.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new Rc;return t.forEachTree(new Vs(""),function(t,e){r.remember(t,Lc(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(Vs.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new Rc,this.eventQueue_.raiseEventsForChangedPath(Vs.Empty,i)},Cl.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},Cl.prototype.onDisconnectSet=function(n,t,r){var i=this,o=fc(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Cl.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=fc(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Cl.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Aa(n))return fs("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Ms(n,function(t,e){var n=fc(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},Cl.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Cl.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Cl.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Sl)},Cl.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Sl)},Cl.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new qh(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Ms(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},Cl.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Cl.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),fs.apply(void 0,ea([n],t))},Cl.prototype.callOnCompleteCallback=function(r,i,o){r&&Ls(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(Cl.prototype,"database",{get:function(){return this.__database||(this.__database=new Ql(this))},enumerable:!0,configurable:!0}),Cl);function Cl(t,e,n){var r,a=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Wh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Rc,this.persistentConnection_=null,r="undefined"!=typeof process&&process.env[Is]?new Ph(n):new Dh(n),this.stats_=Fh.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new El(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Sa(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new bl(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Fh.getOrCreateReporter(t,function(){return new Bh(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Ah,this.infoSyncTree_=new Ch({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ch({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var Nl=(Al.prototype.getStartPost=function(){return this.startPost_},Al.prototype.getEndPost=function(){return this.endPost_},Al.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Al.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new wu(e,n))||(n=ac.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Al.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=ac.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(ac.EMPTY_NODE);var i=this;return e.forEachChild(qu,function(t,e){i.matches(new wu(t,e))||(r=r.updateImmediateChild(t,ac.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Al.prototype.updatePriority=function(t,e){return t},Al.prototype.filtersNodes=function(){return!0},Al.prototype.getIndexedFilter=function(){return this.indexedFilter_},Al.prototype.getIndex=function(){return this.index_},Al.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Al.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Al);function Al(t){this.indexedFilter_=new nh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Al.getStartPost_(t),this.endPost_=Al.getEndPost_(t)}var kl=(Dl.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new wu(e,n))||(n=ac.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},Dl.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=ac.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=ac.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(ac.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,ac.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},Dl.prototype.updatePriority=function(t,e){return t},Dl.prototype.filtersNodes=function(){return!0},Dl.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},Dl.prototype.getIndex=function(){return this.index_},Dl.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;aa(s.numChildren()==this.limit_,"");var u=new wu(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(th.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(th.childRemovedChange(e,l));var d=s.updateImmediateChild(e,ac.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(th.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(th.childRemovedChange(c.name,c.node)),i.trackChildChange(th.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,ac.EMPTY_NODE)):t},Dl);function Dl(t){this.rangedFilter_=new Nl(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Rl=(Ol.prototype.hasStart=function(){return this.startSet_},Ol.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Ol.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Ol.prototype.getIndexStartValue=function(){return aa(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Ol.prototype.getIndexStartName=function(){return aa(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ds},Ol.prototype.hasEnd=function(){return this.endSet_},Ol.prototype.getIndexEndValue=function(){return aa(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Ol.prototype.getIndexEndName=function(){return aa(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rs},Ol.prototype.hasLimit=function(){return this.limitSet_},Ol.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Ol.prototype.getLimit=function(){return aa(this.limitSet_,"Only valid if limit has been set"),this.limit_},Ol.prototype.getIndex=function(){return this.index_},Ol.prototype.copy_=function(){var t=new Ol;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Ol.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Ol.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Ol.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Ol.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Ol.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Ol.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Ol.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Ol.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Ol.prototype.getQueryObject=function(){var t=Ol.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==qu&&(e[t.INDEX]=this.index_.toString()),e},Ol.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Ol.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==qu},Ol.prototype.getNodeFilter=function(){return this.loadsAllData()?new nh(this.getIndex()):this.hasLimit()?new kl(this):new Nl(this)},Ol.prototype.toRestQueryStringParameters=function(){var t,e=Ol.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===qu?e.PRIORITY_INDEX:this.index_===yc?e.VALUE_INDEX:this.index_===ku?e.KEY_INDEX:(aa(this.index_ instanceof mc,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Sa(t),this.startSet_&&(n[e.START_AT]=Sa(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Sa(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Sa(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Sa(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Ol.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Ol.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Ol.DEFAULT=new Ol,Ol);function Ol(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=qu}var Pl,Ml=(Yo(xl,Pl=kc),xl.prototype.getKey=function(){return La("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},xl.prototype.child=function(t){return La("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Vs||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),iu(t,e,n,r)}("Reference.child",1,t,!1):iu("Reference.child",1,t,!1)),new xl(this.repo,this.path.child(t))},xl.prototype.getParent=function(){La("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new xl(this.repo,t)},xl.prototype.getRoot=function(){La("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},xl.prototype.databaseProp=function(){return this.repo.database},xl.prototype.set=function(t,e){La("Reference.set",1,2,arguments.length),ou("Reference.set",this.path),Zs("Reference.set",1,t,this.path,!1),Ua("Reference.set",2,e,!0);var n=new la;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},xl.prototype.update=function(t,e){if(La("Reference.update",1,2,arguments.length),ou("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ms("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}tu("Reference.update",1,t,this.path,!1),Ua("Reference.update",2,e,!0);var i=new la;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},xl.prototype.setWithPriority=function(t,e,n){if(La("Reference.setWithPriority",2,3,arguments.length),ou("Reference.setWithPriority",this.path),Zs("Reference.setWithPriority",1,t,this.path,!1),eu("Reference.setWithPriority",2,e,!1),Ua("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new la;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},xl.prototype.remove=function(t){return La("Reference.remove",0,1,arguments.length),ou("Reference.remove",this.path),Ua("Reference.remove",1,t,!0),this.set(null,t)},xl.prototype.transaction=function(t,r,e){if(La("Reference.transaction",1,3,arguments.length),ou("Reference.transaction",this.path),Ua("Reference.transaction",1,t,!1),Ua("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Fa(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new la;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new du(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},xl.prototype.setPriority=function(t,e){La("Reference.setPriority",1,2,arguments.length),ou("Reference.setPriority",this.path),eu("Reference.setPriority",1,t,!1),Ua("Reference.setPriority",2,e,!0);var n=new la;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},xl.prototype.push=function(t,e){La("Reference.push",0,2,arguments.length),ou("Reference.push",this.path),Zs("Reference.push",1,t,this.path,!0),Ua("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=bu(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},xl.prototype.onDisconnect=function(){return ou("Reference.onDisconnect",this.path),new fu(this.repo,this.path)},Object.defineProperty(xl.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(xl.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(xl.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(xl.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),xl);function xl(t,e){if(!(t instanceof Il))throw new Error("new Reference() no longer supported - use app.database().");return Pl.call(this,t,e,Rl.DEFAULT,!1)||this}kc.__referenceConstructor=Ml,gh.__referenceConstructor=Ml;var Ll,Fl,Ul=function(){this.children={},this.childCount=0,this.value=null},ql=(Vl.prototype.subTree=function(t){for(var e,n=t instanceof Vs?t:new Vs(t),r=this;null!==(e=n.getFront());)r=new Vl(e,r,Na(r.node_.children,e)||new Ul),n=n.popFront();return r},Vl.prototype.getValue=function(){return this.node_.value},Vl.prototype.setValue=function(t){aa(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Vl.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Vl.prototype.hasChildren=function(){return 0<this.node_.childCount},Vl.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Vl.prototype.forEachChild=function(n){var r=this;Ms(this.node_.children,function(t,e){n(new Vl(t,r,e))})},Vl.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},Vl.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Vl.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},Vl.prototype.path=function(){return new Vs(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Vl.prototype.name=function(){return this.name_},Vl.prototype.parent=function(){return this.parent_},Vl.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Vl.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Ca(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Vl);function Vl(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Ul),this.name_=t,this.parent_=e,this.node_=n}(Fl=Ll=Ll||{})[Fl.RUN=0]="RUN",Fl[Fl.SENT=1]="SENT",Fl[Fl.COMPLETED=2]="COMPLETED",Fl[Fl.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Fl[Fl.NEEDS_ABORT=4]="NEEDS_ABORT",Il.MAX_TRANSACTION_RETRIES_=25,Il.prototype.transactions_init_=function(){this.transactionQueueTree_=new ql},Il.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new Ml(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Cs(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new gc(a.currentInputSnapshot,new Ml(this,a.path),qu);a.onComplete(null,!1,c)}}else{lu("transaction failed: Data returned ",u,a.path),a.status=Ll.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Ca(u,".priority"))f=Na(u,".priority"),aa($s(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||ac.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=fc(u,f),y=Lc(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Il.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||ac.EMPTY_NODE},Il.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);aa(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Ll.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Il.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];aa(o.status===Ll.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=Ll.SENT,o.retryCount++;var a=Vs.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=Ll.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new Ml(c,u[r].path),a=new gc(i,o,qu);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Ls(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===Ll.SENT_NEEDS_ABORT?u[r].status=Ll.NEEDS_ABORT:u[r].status=Ll.RUN;else{ms("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=Ll.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Il.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Il.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Ll.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Vs.relativePath(e,s.path),c=!1,h=void 0;if(aa(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Ll.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Ll.RUN)if(s.retryCount>=Il.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){lu("transaction failed: Data returned ",f,s.path);var p=fc(f);"object"==typeof f&&null!=f&&Ca(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Lc(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Ll.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new Ml(this,t[a].path),g=t[a].currentInputSnapshot,b=new gc(g,v,qu);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Ls(r[a]);this.sendReadyTransactions_()}},Il.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Il.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Il.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Il.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Ll.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Il.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Il.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===Ll.SENT_NEEDS_ABORT);else if(e[o].status===Ll.SENT)aa(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Ll.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(aa(e[o].status===Ll.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Ls(n[o])}};var Bl,jl="databaseURL",Wl=(Kl.getInstance=function(){return Bl=Bl||new Kl},Kl.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},Kl.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},Kl.prototype.databaseFromApp=function(t,e){var n=e||t.options[jl];void 0===n&&ys("Can't determine Firebase Database URL.  Be sure to include "+jl+" option when calling firebase.initializeApp().");var r=Ys(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env[Is]),o&&(n="http://"+o+"?ns="+i.namespace,i=(r=Ys(n)).repoInfo),au("Invalid Firebase Database URL",1,r),r.path.isEmpty()||ys("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},Kl.prototype.deleteRepo=function(t){var e=Na(this.repos_,t.app.name);e&&Na(e,t.repoInfo_.toURLString())===t||ys("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},Kl.prototype.createRepo=function(t,e){var n=Na(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Na(n,t.toURLString());return r&&ys("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Il(t,this.useRestClient_,e),n[t.toURLString()]=r},Kl.prototype.forceRestClient=function(t){this.useRestClient_=t},Kl);function Kl(){this.repos_={},this.useRestClient_=!1}var Ql=(Object.defineProperty(Hl.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Hl.prototype.ref=function(t){return this.checkDeleted_("ref"),La("database.ref",0,1,arguments.length),t instanceof Ml?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},Hl.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),La(e,1,1,arguments.length);var n=Ys(t);au(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&ys(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Hl.prototype.checkDeleted_=function(t){null===this.repo_&&ys("Cannot call "+t+" on a deleted database.")},Hl.prototype.goOffline=function(){La("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Hl.prototype.goOnline=function(){La("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Hl.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Hl);function Hl(t){(this.repo_=t)instanceof Il||ys("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ml(t,Vs.Empty),this.INTERNAL=new Gl(this)}var Gl=(zl.prototype.delete=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return this.database.checkDeleted_("delete"),Wl.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},zl);function zl(t){this.database=t}var Yl=Object.freeze({__proto__:null,forceLongPolling:function(){cl.forceDisallow(),rl.forceAllow()},forceWebSockets:function(){rl.forceDisallow()},isWebSocketsAvailable:function(){return cl.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),Xl=bl;bl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},bl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var Jl,$l,Zl=dl,tf=Gs,ef=Object.freeze({__proto__:null,DataConnection:Xl,RealTimeConnection:Zl,hijackHash:function(i){var o=bl.prototype.put;return bl.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){bl.prototype.put=o}},ConnectionTarget:tf,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Wl.getInstance().forceRestClient(t)}}),nf=Ql.ServerValue;Jl=($l=fl).SDK_VERSION,sl=Jl,$l.INTERNAL.registerService("database",function(t,e,n){return Wl.getInstance().databaseFromApp(t,n)},{Reference:Ml,Query:kc,Database:Ql,DataSnapshot:gc,enableLogging:ls,INTERNAL:Yl,ServerValue:nf,TEST_ACCESS:ef},null,!0);var rf,of="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},af=af||{},sf=of;function uf(t){return"string"==typeof t}function cf(t){return"number"==typeof t}function hf(t,e){t=t.split("."),e=e||sf;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function lf(){}function ff(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function pf(t){return"array"==ff(t)}function df(t){var e=ff(t);return"array"==e||"object"==e&&"number"==typeof t.length}function yf(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var mf="closure_uid_"+(1e9*Math.random()>>>0),vf=0;function gf(t,e,n){return t.call.apply(t.bind,arguments)}function bf(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function wf(t,e,n){return(wf=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?gf:bf).apply(null,arguments)}function _f(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Ef=Date.now||function(){return+new Date};function Tf(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Sf(){this.j=this.j,this.i=this.i}Sf.prototype.j=!1,Sf.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[mf]||(this[mf]=++vf)},Sf.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var If=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(uf(t))return uf(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Cf=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=uf(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Nf(){return Array.prototype.concat.apply([],arguments)}function Af(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function kf(t){return/^[\s\xa0]*$/.test(t)}var Df,Rf=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Of(t,e){return-1!=t.indexOf(e)}function Pf(t,e){return t<e?-1:e<t?1:0}t:{var Mf=sf.navigator;if(Mf){var xf=Mf.userAgent;if(xf){Df=xf;break t}}Df=""}function Lf(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ff(t){var e,n={};for(e in t)n[e]=t[e];return n}var Uf="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function qf(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Uf.length;i++)e=Uf[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Vf(t){return Vf[" "](t),t}Vf[" "]=lf;var Bf,jf,Wf=Of(Df,"Opera"),Kf=Of(Df,"Trident")||Of(Df,"MSIE"),Qf=Of(Df,"Edge"),Hf=Qf||Kf,Gf=Of(Df,"Gecko")&&!(Of(Df.toLowerCase(),"webkit")&&!Of(Df,"Edge"))&&!(Of(Df,"Trident")||Of(Df,"MSIE"))&&!Of(Df,"Edge"),zf=Of(Df.toLowerCase(),"webkit")&&!Of(Df,"Edge");function Yf(){var t=sf.document;return t?t.documentMode:void 0}t:{var Xf="",Jf=(jf=Df,Gf?/rv:([^\);]+)(\)|;)/.exec(jf):Qf?/Edge\/([\d\.]+)/.exec(jf):Kf?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(jf):zf?/WebKit\/(\S+)/.exec(jf):Wf?/(?:Version)[ \/]?(\S+)/.exec(jf):void 0);if(Jf&&(Xf=Jf?Jf[1]:""),Kf){var $f=Yf();if(null!=$f&&$f>parseFloat(Xf)){Bf=String($f);break t}}Bf=Xf}var Zf,tp={};function ep(s){return function(t,e){var n=tp;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=Rf(String(Bf)).split("."),n=Rf(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Pf(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Pf(0==o[2].length,0==a[2].length)||Pf(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var np=sf.document;Zf=np&&Kf?Yf()||("CSS1Compat"==np.compatMode?parseInt(Bf,10):5):void 0;var rp=!Kf||9<=Number(Zf),ip=Kf&&!ep("9"),op=function(){if(!sf.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{sf.addEventListener("test",lf,e),sf.removeEventListener("test",lf,e)}catch(t){}return t}();function ap(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function sp(t,e){if(ap.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Gf){t:{try{Vf(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=uf(t.pointerType)?t.pointerType:up[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}ap.prototype.b=function(){this.Ja=!1},Tf(sp,ap);var up={2:"touch",3:"pen",4:"mouse"};sp.prototype.b=function(){sp.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ip)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var cp="closure_listenable_"+(1e6*Math.random()|0),hp=0;function lp(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++hp,this.X=this.Z=!1}function fp(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function pp(t){this.src=t,this.a={},this.b=0}function dp(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=If(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(fp(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function yp(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}pp.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=yp(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new lp(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var mp="closure_lm_"+(1e6*Math.random()|0),vp={};function gp(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(pf(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Cp(r);return e&&e[cp]?e.Ba(n,r,yf(i)?!!i.capture:!!i,o):bp(e,n,r,!0,i,o)}(t,e,n,r,i);if(pf(e)){for(var o=0;o<e.length;o++)gp(t,e[o],n,r,i);return null}return n=Cp(n),t&&t[cp]?t.Aa(e,n,yf(r)?!!r.capture:!!r,i):bp(t,e,n,!1,r,i)}function bp(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=yf(i)?!!i.capture:!!i;if(a&&!rp)return null;var s=Sp(t);if(s||(t[mp]=s=new pp(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Tp,n=rp?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)op||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(_p(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function wp(t){if(!cf(t)&&t&&!t.X){var e=t.src;if(e&&e[cp])dp(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(_p(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Sp(e))?(dp(n,t),0==n.b&&(n.src=null,e[mp]=null)):fp(t)}}}function _p(t){return t in vp?vp[t]:vp[t]="on"+t}function Ep(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&wp(t),n.call(r,e)}function Tp(t,e){return!!t.X||(rp?Ep(t,new sp(e,this)):Ep(t,e=new sp(e||hf("window.event"),this)))}function Sp(t){return(t=t[mp])instanceof pp?t:null}var Ip="__closure_events_fn_"+(1e9*Math.random()>>>0);function Cp(e){return"function"==ff(e)?e:(e[Ip]||(e[Ip]=function(t){return e.handleEvent(t)}),e[Ip])}function Np(){Sf.call(this),this.c=new pp(this),(this.J=this).B=null}function Ap(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&dp(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Tf(Np,Sf),Np.prototype[cp]=!0,(rf=Np.prototype).addEventListener=function(t,e,n,r){gp(this,t,e,n,r)},rf.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(pf(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=yf(i)?!!i.capture:!!i,r=Cp(r),e&&e[cp]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=yp(a=e.a[n],r,i,o))&&(fp(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Sp(e))&&(n=e.a[n.toString()],e=-1,n&&(e=yp(n,r,i,o)),(r=-1<e?n[e]:null)&&wp(r))}(this,t,e,n,r)},rf.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(uf(t))t=new ap(t,n);else if(t instanceof ap)t.target=t.target||n;else{var i=t;qf(t=new ap(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Ap(a,r,!0,t)&&i}if(i=Ap(a=t.a=n,r,!0,t)&&i,i=Ap(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ap(a=t.a=e[o],r,!1,t)&&i;return i},rf.G=function(){if(Np.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)fp(n[r]);delete e.a[t],e.b--}}this.B=null},rf.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},rf.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var kp=sf.JSON.stringify;function Dp(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Rp(){this.b=this.a=null}Dp.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Op,Pp=new Dp(function(){return new Mp},function(t){t.reset()});function Mp(){this.next=this.b=this.a=null}function xp(t){sf.setTimeout(function(){throw t},0)}function Lp(t,e){Op||function(){var t=sf.Promise.resolve(void 0);Op=function(){t.then(qp)}}(),Fp||(Op(),Fp=!0),Up.add(t,e)}Rp.prototype.add=function(t,e){var n=Pp.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Mp.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Fp=!(Mp.prototype.reset=function(){this.next=this.b=this.a=null}),Up=new Rp;function qp(){for(var t;r=n=void 0,r=null,(n=Up).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){xp(t)}var e=Pp;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Fp=!1}function Vp(t,e){Np.call(this),this.b=t||1,this.a=e||sf,this.f=wf(this.gb,this),this.g=Ef()}function Bp(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function jp(t,e,n){if("function"==ff(t))n&&(t=wf(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=wf(t.handleEvent,t)}return 2147483647<Number(e)?-1:sf.setTimeout(t,e||0)}function Wp(t,e,n){Sf.call(this),this.f=null!=n?wf(t,n):t,this.c=e,this.b=wf(this.ab,this),this.a=[]}function Kp(t){t.U=jp(t.b,t.c),t.f.apply(null,t.a)}function Qp(t){Sf.call(this),this.b=t,this.a={}}Tf(Vp,Np),(rf=Vp.prototype).ba=!1,rf.L=null,rf.gb=function(){if(this.ba){var t=Ef()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Bp(this),this.start()))}},rf.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Ef())},rf.G=function(){Vp.N.G.call(this),Bp(this),delete this.a},Tf(Wp,Sf),(rf=Wp.prototype).ea=!1,rf.U=null,rf.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Kp(this)},rf.G=function(){Wp.N.G.call(this),this.U&&(sf.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},rf.ab=function(){this.U=null,this.ea&&(this.ea=!1,Kp(this))},Tf(Qp,Sf);var Hp=[];function Gp(t,e,n,r){pf(n)||(n&&(Hp[0]=n.toString()),n=Hp);for(var i=0;i<n.length;i++){var o=gp(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function zp(t){Lf(t.a,function(t,e){this.a.hasOwnProperty(e)&&wp(t)},t),t.a={}}function Yp(){}Qp.prototype.G=function(){Qp.N.G.call(this),zp(this)},Qp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xp=new Np;function Jp(t){ap.call(this,"serverreachability",t)}function $p(t){Xp.dispatchEvent(new Jp(Xp,t))}function Zp(t){ap.call(this,"statevent",t)}function td(t){Xp.dispatchEvent(new Zp(Xp,t))}function ed(t){ap.call(this,"timingevent",t)}function nd(t,e){if("function"!=ff(t))throw Error("Fn must not be null and must be a function");return sf.setTimeout(function(){t()},e)}Tf(Jp,ap),Tf(Zp,ap),Tf(ed,ap);var rd={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},id={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function od(){}function ad(t){var e;return(e=t.a)||(e=t.a={}),e}function sd(){}od.prototype.a=null;var ud,cd={OPEN:"a",ib:"b",Na:"c",rb:"d"};function hd(){ap.call(this,"d")}function ld(){ap.call(this,"c")}function fd(){}function pd(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Qp(this),this.O=dd,t=Hf?125:void 0,this.P=new Vp(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Tf(hd,ap),Tf(ld,ap),Tf(fd,od),ud=new fd;var dd=45e3,yd={},md={};function vd(t,e,n){t.F=1,t.f=jd(xd(e)),t.l=n,t.H=!0,bd(t,null)}function gd(t,e,n,r){t.F=1,t.f=jd(xd(e)),t.l=null,t.H=n,bd(t,r)}function bd(t,e){t.v=Ef(),Ed(t),t.D=xd(t.f),Bd(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Wp(wf(t.Ka,t,t.a),t.J)),Gp(t.I,t.a,"readystatechange",t.eb),e=t.h?Ff(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),$p(1)}function wd(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=_d(t,n);if(i==md){4==e&&(t.c=4,td(14),r=!1);break}if(i==yd){t.c=4,td(15),r=!1;break}Nd(t,i)}4==e&&0==n.length&&(t.c=1,td(16),r=!1),t.b=t.b&&r,r||(Cd(t),Id(t))}function _d(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?md:(n=Number(e.substring(n,r)),isNaN(n)?yd:(r+=1)+n>e.length?md:(e=e.substr(r,n),t.A=r+n,e))}function Ed(t){t.R=Ef()+t.O,Td(t,t.O)}function Td(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=nd(wf(t.bb,t),e)}function Sd(t){t.i&&(sf.clearTimeout(t.i),t.i=null)}function Id(t){t.g.Da()||t.m||t.g.na(t)}function Cd(t){Sd(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Bp(t.P),zp(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Nd(t,e){try{t.g.Ga(t,e),$p(4)}catch(t){}}function Ad(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(df(t)||uf(t))Cf(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(df(t)||uf(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(uf(t))return t.split("");if(df(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function kd(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof kd)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Dd(t,e){Od(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Rd(t))}function Rd(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Od(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Od(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Od(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(rf=pd.prototype).setTimeout=function(t){this.O=t},rf.eb=function(t){t=t.target;var e=this.B;e&&3==My(t)?e.Ua():this.Ka(t)},rf.Ka=function(t){try{if(t==this.a)t:{var e=My(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!Hf&&!this.a.aa())){this.m||4!=e||7==n||$p(8==n||r<=0?3:2),Sd(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=xy(this.a,"X-HTTP-Initial-Response");if(a&&!kf(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,td(12),Cd(this),Id(this);break t}this.s=!0,Nd(this,s)}this.H?(wd(this,e,o),Hf&&this.b&&3==e&&(Gp(this.I,this.P,"tick",this.cb),this.P.start())):Nd(this,o),4==e&&Cd(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ed(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,td(12)):(this.c=0,td(13)),Cd(this),Id(this)}}}catch(t){}},rf.cb=function(){if(this.a){var t=My(this.a),e=this.a.aa();this.A<e.length&&(Sd(this),wd(this,t,e),this.b&&4!=t&&Ed(this))}},rf.cancel=function(){this.m=!0,Cd(this)},rf.bb=function(){this.i=null;var t=Ef();0<=t-this.R?(2!=this.F&&($p(3),td(17)),Cd(this),this.c=2,Id(this)):Td(this,this.R-t)},(rf=kd.prototype).C=function(){Rd(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},rf.K=function(){return Rd(this),this.a.concat()},rf.get=function(t,e){return Od(this.b,t)?this.b[t]:e},rf.set=function(t,e){Od(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},rf.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Pd=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Md(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Md?(this.h=void 0!==e?e:t.h,Ld(this,t.f),this.j=t.j,Fd(this,t.b),Ud(this,t.i),this.a=t.a,qd(this,ny(t.c)),this.g=t.g):t&&(n=String(t).match(Pd))?(this.h=!!e,Ld(this,n[1]||"",!0),this.j=Wd(n[2]||""),Fd(this,n[3]||"",!0),Ud(this,n[4]),this.a=Wd(n[5]||"",!0),qd(this,n[6]||"",!0),this.g=Wd(n[7]||"")):(this.h=!!e,this.c=new Jd(null,this.h))}function xd(t){return new Md(t)}function Ld(t,e,n){t.f=n?Wd(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Fd(t,e,n){t.b=n?Wd(e,!0):e}function Ud(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function qd(t,e,n){e instanceof Jd?(t.c=e,function(t,e){e&&!t.f&&($d(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Zd(this,e),ey(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Kd(e,Yd)),t.c=new Jd(e,t.h))}function Vd(t,e,n){t.c.set(e,n)}function Bd(t,e,n){pf(n)||(n=[String(n)]),ey(t.c,e,n)}function jd(t){return Vd(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ef()).toString(36)),t}function Wd(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Kd(t,e,n){return uf(t)?(t=encodeURI(t).replace(e,Qd),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Qd(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Md.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Kd(e,Hd,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Kd(e,Hd,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Kd(n,"/"==n.charAt(0)?zd:Gd,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Kd(n,Xd)),t.join("")},Md.prototype.resolve=function(t){var e=xd(this),n=!!t.f;n?Ld(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Fd(e,t.b):n=null!=t.i;var r=t.a;if(n)Ud(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Of(i,"./")||Of(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?qd(e,ny(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Hd=/[#\/\?@]/g,Gd=/[#\?:]/g,zd=/[#\?]/g,Yd=/[#\?@]/g,Xd=/#/g;function Jd(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function $d(n){n.a||(n.a=new kd,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Zd(t,e){$d(t),e=ry(t,e),Od(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Dd(t.a,e))}function ty(t,e){return $d(t),e=ry(t,e),Od(t.a.b,e)}function ey(t,e,n){Zd(t,e),0<n.length&&(t.c=null,t.a.set(ry(t,e),Af(n)),t.b+=n.length)}function ny(t){var e=new Jd;return e.c=t.c,t.a&&(e.a=new kd(t.a),e.b=t.b),e}function ry(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function iy(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function oy(t){var e=t.a.F.a;if(null!=e)td(4),e?(td(10),Gy(t.a,t,!1)):(td(11),Gy(t.a,t,!0));else{t.b=new pd(t,void 0,void 0),t.b.h=t.h,e=$y(e=t.a,e.Y()?t.f:null,t.i),td(4),Bd(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Vd(e,n,r),gd(t.b,e,!1,t.f)}}function ay(){this.a=this.b=null}function sy(){this.a=new kd}function uy(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[mf]||(t[mf]=++vf)):e.charAt(0)+t}function cy(t,e){this.b=t,this.a=e}function hy(t){this.g=t||ly,t=sf.PerformanceNavigationTiming?0<(t=sf.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(sf.ka&&sf.ka.Ea&&sf.ka.Ea()&&sf.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new sy),this.b=null,this.c=[]}(rf=Jd.prototype).add=function(t,e){$d(this),this.c=null,t=ry(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},rf.forEach=function(n,r){$d(this),this.a.forEach(function(t,e){Cf(t,function(t){n.call(r,t,e,this)},this)},this)},rf.K=function(){$d(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},rf.C=function(t){$d(this);var e=[];if(uf(t))ty(this,t)&&(e=Nf(e,this.a.get(ry(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Nf(e,t[n])}return e},rf.set=function(t,e){return $d(this),this.c=null,ty(this,t=ry(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},rf.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},rf.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Tf(function(){},function(){}),(rf=iy.prototype).M=null,rf.$=function(t){return this.a.$(t)},rf.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},rf.Da=function(){return!1},rf.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=xy(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=xy(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void Xy(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Xy(e,2)}else 1==this.M&&(this.g?td(6):"11111"==e?(td(5),this.g=!0,(!Kf||10<=Number(Zf))&&(this.c=200,this.b.cancel(),td(11),Gy(this.a,this,!0))):(td(7),this.g=!1))},rf.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,oy(this)):1==this.M&&(this.g?(td(11),Gy(this.a,this,!0)):(td(10),Gy(this.a,this,!1)));else{0==this.M?td(8):1==this.M&&td(9);var t=this.a;t.m=this.c,Xy(t,2)}},rf.Y=function(){return this.a.Y()},rf.ma=function(){return this.a.ma()},sy.prototype.add=function(t){this.a.set(uy(t),t)},sy.prototype.C=function(){return this.a.C()};var ly=10;function fy(t,e){!t.a&&(Of(e,"spdy")||Of(e,"quic")||Of(e,"h2"))&&(t.f=t.g,t.a=new sy,t.b&&(my(t,t.b),t.b=null))}function py(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function dy(t){return t.b?1:t.a?t.a.a.c:0}function yy(t,e){return t=t.b?t.b==e:!!t.a&&(e=uy(e),Od(t.a.a.b,e))}function my(t,e){t.a?t.a.add(e):t.b=e}function vy(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=uy(e),n=Od(t.a.a.b,n)),n&&Dd(t.a.a,uy(e)))}function gy(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Af(t.c);var e=t.c;return Cf(t.a.C(),function(t){e=e.concat(t.j)}),e}function by(){}function wy(){this.a=new by}function _y(t,r,e){var i=e||"";try{Ad(t,function(t,e){var n=t;yf(t)&&(n=kp(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Ey(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}hy.prototype.cancel=function(){this.c=gy(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Cf(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},by.prototype.stringify=function(t){return sf.JSON.stringify(t,void 0)},by.prototype.parse=function(t){return sf.JSON.parse(t,void 0)};var Ty=sf.JSON.parse;function Sy(t){Np.call(this),this.headers=new kd,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Iy,this.D=this.F=!1}Tf(Sy,Np);var Iy="",Cy=/^https?$/i,Ny=["POST","PUT"];function Ay(t){return"content-type"==t.toLowerCase()}function ky(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Dy(t),Oy(t)}function Dy(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Ry(t){if(t.b&&void 0!==af&&(!t.s[1]||4!=My(t)||2!=t.T()))if(t.l&&4==My(t))jp(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==My(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Pd)[1]||null;if(!o&&sf.self&&sf.self.location){var a=sf.self.location.protocol;o=a.substr(0,a.length-1)}i=!Cy.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Dy(t))}finally{Oy(t)}}}function Oy(t,e){if(t.a){Py(t);var n=t.a,r=t.s[0]?lf:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Py(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(sf.clearTimeout(t.m),t.m=null)}function My(t){return t.a?t.a.readyState:0}function xy(t,e){return t.a?t.a.getResponseHeader(e):null}function Ly(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return Lf(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),uf(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Vd(t,e,n),t}function Fy(t){this.f=[],this.F=new ay,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!hf("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=hf("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=hf("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=hf("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=hf("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new hy(t&&t.concurrentRequestLimit),this.ja=new wy,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Uy(t){if(qy(t),3==t.u){var e=t.P++,n=xd(t.B);Vd(n,"SID",t.H),Vd(n,"RID",e),Vd(n,"TYPE","terminate"),Wy(t,n),(e=new pd(t,e,void 0)).F=2,e.f=jd(xd(n)),n=!1,sf.navigator&&sf.navigator.sendBeacon&&(n=sf.navigator.sendBeacon(e.f.toString(),"")),!n&&sf.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Ef(),Ed(e)}Jy(t)}function qy(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(sf.clearTimeout(t.l),t.l=null),zy(t),t.b.cancel(),t.h&&(cf(t.h)&&sf.clearTimeout(t.h),t.h=null)}function Vy(t,e){t.f.push(new cy(t.Ra++,e)),3==t.u&&By(t)}function By(t){py(t.b)||t.h||(t.h=!0,Lp(t.Ia,t),t.A=0)}function jy(t,e){var n;n=e?e.W:t.P++;var r=xd(t.B);Vd(r,"SID",t.H),Vd(r,"RID",n),Vd(r,"AID",t.O),Wy(t,r),t.g&&t.i&&Ly(r,t.g,t.i),n=new pd(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Ky(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),my(t.b,n),vd(n,r,e)}function Wy(t,n){t.c&&Ad({},function(t,e){Vd(n,e,t)})}function Ky(t,e,n){n=Math.min(t.f.length,n);var r=t.c?wf(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{_y(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Qy(t){t.a||t.l||(t.S=1,Lp(t.Ha,t),t.v=0)}function Hy(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=nd(wf(t.Ha,t),Yy(t,t.v)),t.v++,!0)}function Gy(t,e,n){var r=e.l;r&&fy(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=$y(t,null,t.ha),By(t)}function zy(t){null!=t.s&&(sf.clearTimeout(t.s),t.s=null)}function Yy(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function Xy(t,e){if(2==e){var n=null;t.c&&(n=null);var r=wf(t.fb,t);n||(n=new Md("//www.google.com/images/cleardot.gif"),sf.location&&"http"==sf.location.protocol||Ld(n,"https"),jd(n)),function(t,e){var n=new Yp;if(sf.Image){var r=new Image;r.onload=_f(Ey,n,r,"TestLoadImage: loaded",!0,e),r.onerror=_f(Ey,n,r,"TestLoadImage: error",!1,e),r.onabort=_f(Ey,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=_f(Ey,n,r,"TestLoadImage: timeout",!1,e),sf.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else td(2);t.u=0,t.c&&t.c.ta(e),Jy(t),qy(t)}function Jy(t){t.u=0,t.m=-1,t.c&&(0==gy(t.b).length&&0==t.f.length||(t.b.c.length=0,Af(t.f),t.f.length=0),t.c.sa())}function $y(t,e,n){var r=function(t){return t instanceof Md?xd(t):new Md(t,void 0)}(n);if(""!=r.b)e&&Fd(r,e+"."+r.b),Ud(r,r.i);else{var i,o=sf.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Md(null,void 0);return t&&Ld(i,t),e&&Fd(i,e),n&&Ud(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Lf(t.V,function(t,e){Vd(r,e,t)}),e=t.j,n=t.I,e&&n&&Vd(r,e,n),Vd(r,"VER",t.wa),Wy(t,r),r}function Zy(){}function tm(){if(Kf&&!(10<=Number(Zf)))throw Error("Environmental error: no available transport.")}function em(t,e){Np.call(this),this.a=new Fy(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!kf(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!kf(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new im(this)}function nm(t){hd.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function rm(){ld.call(this),this.status=1}function im(t){this.a=t}(rf=Sy.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ad(this.H):ad(ud),this.a.onreadystatechange=wf(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void ky(this,t)}t=n||"";var i=new kd(this.headers);r&&Ad(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Ay,n=t.length,r=uf(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:uf(t)?t.charAt(e):t[e]}(i.K()),n=sf.FormData&&t instanceof sf.FormData,0<=If(Ny,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Py(this),0<this.o&&((this.D=function(t){return Kf&&ep(9)&&cf(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=wf(this.Ca,this)):this.m=jp(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){ky(this,t)}},rf.Ca=function(){void 0!==af&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},rf.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Oy(this))},rf.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Oy(this,!0)),Sy.N.G.call(this)},rf.Fa=function(){this.j||(this.w||this.l||this.g?Ry(this):this.$a())},rf.$a=function(){Ry(this)},rf.T=function(){try{return 2<My(this)?this.a.status:-1}catch(t){return-1}},rf.za=function(){try{return 2<My(this)?this.a.statusText:""}catch(t){return""}},rf.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},rf.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ty(e)}},rf.ya=function(){return this.h},rf.Ya=function(){return uf(this.f)?this.f:String(this.f)},(rf=Fy.prototype).wa=8,rf.u=1,rf.Da=function(){return 0==this.u},rf.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new pd(this,t,void 0),r=this.i;if(this.J&&(r?qf(r=Ff(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&uf(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Ky(this,n,e),Vd(i=xd(this.B),"RID",t),Vd(i,"CVER",22),this.o&&this.j&&Vd(i,"X-HTTP-Session-Id",this.j),Wy(this,i),this.g&&r&&Ly(i,this.g,r),my(this.b,n),this.W?(Vd(i,"$req",e),Vd(i,"SID","null"),n.S=!0,vd(n,i,null)):vd(n,i,e),this.u=2}}else 3==this.u&&(t?jy(this,t):0==this.f.length||py(this.b)||jy(this))},rf.Ha=function(){this.l=null,this.a=new pd(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=xd(this.pa);Vd(t,"RID","rpc"),Vd(t,"SID",this.H),Vd(t,"CI",this.ia?"0":"1"),Vd(t,"AID",this.O),Wy(this,t),Vd(t,"TYPE","xmlhttp"),this.g&&this.i&&Ly(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),gd(this.a,t,!0,this.ga)},rf.Ga=function(t,e){if(0!=this.u&&(this.a==t||yy(this.b,t)))if(this.m=t.o,!t.s&&yy(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(pf(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;zy(this),this.a.cancel(),this.a=null}Hy(this),td(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=nd(wf(this.Za,this),6e3));if(dy(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else Xy(this,11)}else if(!t.s&&this.a!=t||zy(this),!kf(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&cf(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=xy(r,"X-Client-Wire-Protocol"))&&fy(this.b,i),this.j&&(r=xy(r,"X-HTTP-Session-Id")))&&(this.I=r,Vd(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=$y(this,this.Y()?this.ga:null,this.ha),r.s?(vy(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Sd(r),Ed(r)),this.a=r):Qy(this),0<this.f.length&&By(this)}else"stop"!=r[0]&&"close"!=r[0]||Xy(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Xy(this,7):Uy(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},rf.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Hy(this),td(19))},rf.na=function(t){var e=null;if(this.a==t){zy(this),this.a=null;var n=2}else{if(!yy(this.b,t))return;e=t.j,vy(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Ef()-t.v,Xp.dispatchEvent(new ed(Xp,t.l?t.l.length:0,e,this.A)),By(this)):Qy(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(dy(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=nd(wf(t.Ia,t,e),Yy(t,t.A)),t.A++,!0))}(this,t)||2==n&&Hy(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Xy(this,5);break;case 4:Xy(this,10);break;case 3:Xy(this,6);break;default:Xy(this,2)}}},rf.fb=function(t){td(t?2:1)},rf.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Sy(this.La)).F=this.R,t},rf.ma=function(){return!!this.c&&!0},rf.Y=function(){return this.R},(rf=Zy.prototype).va=function(){},rf.ua=function(){},rf.ta=function(){},rf.sa=function(){},rf.Ta=function(){},tm.prototype.a=function(t,e){return new em(t,e)},Tf(em,Np),(rf=em.prototype).addEventListener=function(t,e,n,r){em.N.addEventListener.call(this,t,e,n,r)},rf.removeEventListener=function(t,e,n,r){em.N.removeEventListener.call(this,t,e,n,r)},rf.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;td(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new iy(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Ly(e,t.g,t.i)),(t=t.w).i=n,e=$y(t.a,null,t.i),td(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,oy(t)):(Bd(e,"MODE","init"),!t.a.o&&t.a.j&&Bd(e,"X-HTTP-Session-Id",t.a.j),t.b=new pd(t,void 0,void 0),t.b.h=t.h,gd(t.b,e,!1,null),t.M=0)},rf.close=function(){Uy(this.a)},rf.Xa=function(t){if(uf(t)){var e={};e.__data__=t,Vy(this.a,e)}else this.h?((e={}).__data__=kp(t),Vy(this.a,e)):Vy(this.a,t)},rf.G=function(){this.a.c=null,delete this.f,Uy(this.a),delete this.a,em.N.G.call(this)},Tf(nm,hd),Tf(rm,ld),Tf(im,Zy),im.prototype.va=function(){this.a.dispatchEvent("a")},im.prototype.ua=function(t){this.a.dispatchEvent(new nm(t))},im.prototype.ta=function(t){this.a.dispatchEvent(new rm(t))},im.prototype.sa=function(){this.a.dispatchEvent("b")};var om=_f(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},tm);tm.prototype.createWebChannel=tm.prototype.a,em.prototype.send=em.prototype.Xa,em.prototype.open=em.prototype.Wa,em.prototype.close=em.prototype.close,rd.NO_ERROR=0,rd.TIMEOUT=8,rd.HTTP_ERROR=6,id.COMPLETE="complete",(sd.EventType=cd).OPEN="a",cd.CLOSE="b",cd.ERROR="c",cd.MESSAGE="d",Np.prototype.listen=Np.prototype.Aa,Sy.prototype.listenOnce=Sy.prototype.Ba,Sy.prototype.getLastError=Sy.prototype.Ya,Sy.prototype.getLastErrorCode=Sy.prototype.ya,Sy.prototype.getStatus=Sy.prototype.T,Sy.prototype.getStatusText=Sy.prototype.za,Sy.prototype.getResponseJson=Sy.prototype.Va,Sy.prototype.getResponseText=Sy.prototype.aa,Sy.prototype.send=Sy.prototype.ca;var am,sm,um={createWebChannelTransport:om,ErrorCode:rd,EventType:id,WebChannel:sd,XhrIo:Sy},cm=um.createWebChannelTransport,hm=um.ErrorCode,lm=um.EventType,fm=um.WebChannel,pm=um.XhrIo,dm=fl.SDK_VERSION,ym=new Ga("@firebase/firestore");function mm(){return ym.logLevel===Ba.DEBUG?am.DEBUG:ym.logLevel===Ba.SILENT?am.SILENT:am.ERROR}function vm(t){switch(t){case am.DEBUG:ym.logLevel=Ba.DEBUG;break;case am.ERROR:ym.logLevel=Ba.ERROR;break;case am.SILENT:ym.logLevel=Ba.SILENT;break;default:ym.error("Firestore ("+dm+"): Invalid value passed to `setLogLevel`")}}function gm(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(ym.logLevel<=Ba.DEBUG){var i=n.map(wm);ym.debug.apply(ym,na(["Firestore ("+dm+") ["+t+"]: "+e],i))}}function bm(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ym.logLevel<=Ba.ERROR){var r=e.map(wm);ym.error.apply(ym,na(["Firestore ("+dm+"): "+t],r))}}function wm(e){if("string"==typeof e)return e;var t=Tm.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function _m(t){var e="FIRESTORE ("+dm+") INTERNAL ASSERTION FAILED: "+t;throw bm(e),new Error(e)}function Em(t,e){t||_m(e)}(sm=am=am||{})[sm.DEBUG=0]="DEBUG",sm[sm.ERROR=1]="ERROR",sm[sm.SILENT=2]="SILENT";var Tm=(Sm.setPlatform=function(t){Sm.platform&&_m("Platform already defined"),Sm.platform=t},Sm.getPlatform=function(){return Sm.platform||_m("Platform not set"),Sm.platform},Sm);function Sm(){}function Im(){return Tm.getPlatform().emptyByteString}var Cm,Nm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Am=(Yo(km,Cm=Error),km);function km(t,e){var n=Cm.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Dm(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Am(Nm.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Rm(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Om(t,e){return void 0!==t?t:e}function Pm(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Mm(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xm(t){for(var e in Em(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Lm(t,e){if(0!==e.length)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Zm(e.length,"argument")+".")}function Fm(t,e,n){if(e.length!==n)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires "+Zm(n,"argument")+", but was called with "+Zm(e.length,"argument")+".")}function Um(t,e,n){if(e.length<n)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Zm(n,"argument")+", but was called with "+Zm(e.length,"argument")+".")}function qm(t,e,n,r){if(e.length<n||e.length>r)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Zm(e.length,"argument")+".")}function Vm(t,e,n,r){Hm(t,e,$m(n)+" argument",r)}function Bm(t,e,n,r){void 0!==r&&Vm(t,e,n,r)}function jm(t,e,n,r){Hm(t,e,n+" option",r)}function Wm(t,e,n,r){void 0!==r&&jm(t,e,n,r)}function Km(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+zm(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+zm(r[o]))}(t,e,n,r,i)}function Qm(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(zm(u))}var c=zm(r);throw new Am(Nm.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Hm(t,e,n,r){if(!("object"===e?Gm(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=zm(r);throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Gm(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function zm(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":_m("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Ym(t,e,n){if(void 0===n)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+$m(e)+" argument, but it was undefined.")}function Xm(n,t,r){Mm(t,function(t,e){if(r.indexOf(t)<0)throw new Am(Nm.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Jm(t,e,n,r){var i=zm(r);return new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires its "+$m(n)+" argument to be a "+e+", but it was: "+i)}function $m(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Zm(t,e){return t+" "+e+(1===t?"":"s")}var tv=(ev.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Em(20===e.length,"Invalid auto ID: "+e),e},ev);function ev(){}function nv(t,e){return t<e?-1:e<t?1:0}function rv(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function iv(t){return t+"\0"}function ov(){if("undefined"==typeof Uint8Array)throw new Am(Nm.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function av(){if(!Tm.getPlatform().base64Available)throw new Am(Nm.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var sv=(uv.fromBase64String=function(t){Fm("Blob.fromBase64String",arguments,1),Vm("Blob.fromBase64String","string",1,t),av();try{return new uv(Tm.getPlatform().atob(t))}catch(t){throw new Am(Nm.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},uv.fromUint8Array=function(t){if(Fm("Blob.fromUint8Array",arguments,1),ov(),!(t instanceof Uint8Array))throw Jm("Blob.fromUint8Array","Uint8Array",1,t);return new uv(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},uv.prototype.toBase64=function(){return Fm("Blob.toBase64",arguments,0),av(),Tm.getPlatform().btoa(this._binaryString)},uv.prototype.toUint8Array=function(){Fm("Blob.toUint8Array",arguments,0),ov();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},uv.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},uv.prototype.isEqual=function(t){return this._binaryString===t._binaryString},uv.prototype._compareTo=function(t){return nv(this._binaryString,t._binaryString)},uv);function uv(t){av(),this._binaryString=t}var cv=Dm(sv,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),hv=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},lv="(default)",fv=(Object.defineProperty(pv.prototype,"isDefaultDatabase",{get:function(){return this.database===lv},enumerable:!0,configurable:!0}),pv.prototype.isEqual=function(t){return t instanceof pv&&t.projectId===this.projectId&&t.database===this.database},pv.prototype.compareTo=function(t){return nv(this.projectId,t.projectId)||nv(this.database,t.database)},pv);function pv(t,e){this.projectId=t,this.database=e||lv}var dv=(yv.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},yv.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},yv.INVALID=-1,yv);function yv(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var mv="__name__",vv=(Object.defineProperty(gv.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),gv.prototype.isEqual=function(t){return 0===gv.comparator(this,t)},gv.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof gv?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},gv.prototype.limit=function(){return this.offset+this.length},gv.prototype.popFirst=function(t){return t=void 0===t?1:t,Em(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},gv.prototype.popLast=function(){return Em(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},gv.prototype.firstSegment=function(){return Em(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},gv.prototype.lastSegment=function(){return this.get(this.length-1)},gv.prototype.get=function(t){return Em(t<this.length,"Index out of range"),this.segments[this.offset+t]},gv.prototype.isEmpty=function(){return 0===this.length},gv.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},gv.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},gv.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},gv.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},gv.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},gv);function gv(t,e,n){void 0===e?e=0:e>t.length&&_m("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&_m("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var bv,wv=(Yo(_v,bv=vv),_v.prototype.construct=function(t,e,n){return new _v(t,e,n)},_v.prototype.canonicalString=function(){return this.toArray().join("/")},_v.prototype.toString=function(){return this.canonicalString()},_v.fromString=function(t){if(0<=t.indexOf("//"))throw new Am(Nm.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new _v(t.split("/").filter(function(t){return 0<t.length}))},_v.EMPTY_PATH=new _v([]),_v);function _v(){return null!==bv&&bv.apply(this,arguments)||this}var Ev,Tv=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Sv=(Yo(Iv,Ev=vv),Iv.prototype.construct=function(t,e,n){return new Iv(t,e,n)},Iv.isValidIdentifier=function(t){return Tv.test(t)},Iv.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Iv.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Iv.prototype.toString=function(){return this.canonicalString()},Iv.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===mv},Iv.keyField=function(){return new Iv([mv])},Iv.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Am(Nm.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Am(Nm.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Am(Nm.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Am(Nm.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Iv(e)},Iv.EMPTY_PATH=new Iv([]),Iv);function Iv(){return null!==Ev&&Ev.apply(this,arguments)||this}var Cv=(Nv.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Nv.prototype.isEqual=function(t){return null!==t&&0===wv.comparator(this.path,t.path)},Nv.prototype.toString=function(){return this.path.toString()},Nv.comparator=function(t,e){return wv.comparator(t.path,e.path)},Nv.isDocumentKey=function(t){return t.length%2==0},Nv.fromSegments=function(t){return new Nv(new wv(t.slice()))},Nv.fromPathString=function(t){return new Nv(wv.fromString(t))},Nv.EMPTY=new Nv(new wv([])),Nv);function Nv(t){this.path=t,Em(Nv.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Av,kv,Dv=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(kv=Av=Av||{}).All="all",kv.ListenStreamIdle="listen_stream_idle",kv.ListenStreamConnectionBackoff="listen_stream_connection_backoff",kv.WriteStreamIdle="write_stream_idle",kv.WriteStreamConnectionBackoff="write_stream_connection_backoff",kv.OnlineStateTimeout="online_state_timeout",kv.ClientMetadataRefresh="client_metadata_refresh",kv.LruGarbageCollection="lru_garbage_collection",kv.RetryTransaction="retry_transaction";var Rv=(Ov.createAndSchedule=function(t,e,n,r,i){var o=new Ov(t,e,Date.now()+n,r,i);return o.start(n),o},Ov.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Ov.prototype.skipDelay=function(){return this.handleDelayElapsed()},Ov.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Am(Nm.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ov.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Ov.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Ov);function Ov(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Dv,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var Pv=(Object.defineProperty(Mv.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Mv.prototype.enqueueAndForget=function(t){this.enqueue(t)},Mv.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Mv.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Mv.prototype.enqueueAndInitiateShutdown=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Mv.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Mv.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw bm("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},Mv.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Em(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Rv.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Mv.prototype.verifyNotFailed=function(){this.failure&&_m("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Mv.prototype.verifyOperationInProgress=function(){Em(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Mv.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Mv.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Mv.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Em(r===Av.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Av.All&&n.timerId===r)break}return i.drain()})},Mv.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Mv.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Em(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Mv);function Mv(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var xv="",Lv="",Fv="",Uv="";function qv(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Bv(e)),e=Vv(t.get(n),e);return Bv(e)}function Vv(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=xv+Fv;break;case xv:n+=xv+Uv;break;default:n+=o}}return n}function Bv(t){return t+xv+Lv}function jv(t){var e=t.length;if(Em(2<=e,"Invalid path "+t),2===e)return Em(t.charAt(0)===xv&&t.charAt(1)===Lv,"Non-empty path "+t+" had length 2"),wv.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(xv,o);switch((a<0||n<a)&&_m('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Lv:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Fv:i+=t.substring(o,a),i+="\0";break;case Uv:i+=t.substring(o,a+1);break;default:_m('Invalid encoded resource path: "'+t+'"')}o=a+2}return new wv(r)}var Wv=(Kv.now=function(){return Kv.fromMillis(Date.now())},Kv.fromDate=function(t){return Kv.fromMillis(t.getTime())},Kv.fromMillis=function(t){var e=Math.floor(t/1e3);return new Kv(e,1e6*(t-1e3*e))},Kv.prototype.toDate=function(){return new Date(this.toMillis())},Kv.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Kv.prototype._compareTo=function(t){return this.seconds===t.seconds?nv(this.nanoseconds,t.nanoseconds):nv(this.seconds,t.seconds)},Kv.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Kv.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Kv);function Kv(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Am(Nm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Am(Nm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Am(Nm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Am(Nm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var Qv=(Hv.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new Hv(new Wv(e,t%1e6*1e3))},Hv.fromTimestamp=function(t){return new Hv(t)},Hv.forDeletedDoc=function(){return Hv.MIN},Hv.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Hv.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Hv.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Hv.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Hv.prototype.toTimestamp=function(){return this.timestamp},Hv.MIN=new Hv(new Wv(0,0)),Hv);function Hv(t){this.timestamp=t}var Gv=(zv.prototype.insert=function(t,e){return new zv(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jv.BLACK,null,null))},zv.prototype.remove=function(t){return new zv(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jv.BLACK,null,null))},zv.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},zv.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},zv.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(zv.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),zv.prototype.minKey=function(){return this.root.minKey()},zv.prototype.maxKey=function(){return this.root.maxKey()},zv.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},zv.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},zv.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},zv.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},zv.prototype.getIterator=function(){return new Yv(this.root,null,this.comparator,!1)},zv.prototype.getIteratorFrom=function(t){return new Yv(this.root,t,this.comparator,!1)},zv.prototype.getReverseIterator=function(){return new Yv(this.root,null,this.comparator,!0)},zv.prototype.getReverseIteratorFrom=function(t){return new Yv(this.root,t,this.comparator,!0)},zv);function zv(t,e){this.comparator=t,this.root=e||Jv.EMPTY}var Yv=(Xv.prototype.getNext=function(){Em(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Xv.prototype.hasNext=function(){return 0<this.nodeStack.length},Xv.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Xv);function Xv(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var Jv=($v.prototype.copy=function(t,e,n,r,i){return new $v(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},$v.prototype.isEmpty=function(){return!1},$v.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},$v.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},$v.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},$v.prototype.minKey=function(){return this.min().key},$v.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},$v.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},$v.prototype.removeMin=function(){if(this.left.isEmpty())return $v.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},$v.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return $v.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},$v.prototype.isRed=function(){return this.color},$v.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},$v.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},$v.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},$v.prototype.rotateLeft=function(){var t=this.copy(null,null,$v.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},$v.prototype.rotateRight=function(){var t=this.copy(null,null,$v.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},$v.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},$v.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},$v.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw _m("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw _m("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw _m("Black depths differ");return t+(this.isRed()?0:1)},$v.EMPTY=null,$v.RED=!0,$v.BLACK=!1,$v);function $v(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:$v.RED,this.left=null!=r?r:$v.EMPTY,this.right=null!=i?i:$v.EMPTY,this.size=this.left.size+1+this.right.size}var Zv=(Object.defineProperty(tg.prototype,"key",{get:function(){throw _m("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(tg.prototype,"value",{get:function(){throw _m("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(tg.prototype,"color",{get:function(){throw _m("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(tg.prototype,"left",{get:function(){throw _m("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(tg.prototype,"right",{get:function(){throw _m("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),tg.prototype.copy=function(t,e,n,r,i){return this},tg.prototype.insert=function(t,e,n){return new Jv(t,e)},tg.prototype.remove=function(t,e){return this},tg.prototype.isEmpty=function(){return!0},tg.prototype.inorderTraversal=function(t){return!1},tg.prototype.reverseTraversal=function(t){return!1},tg.prototype.minKey=function(){return null},tg.prototype.maxKey=function(){return null},tg.prototype.isRed=function(){return!1},tg.prototype.checkMaxDepth=function(){return!0},tg.prototype.check=function(){return 0},tg);function tg(){this.size=0}Jv.EMPTY=new Zv;var eg=(ng.fromMapKeys=function(t){var e=new ng(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},ng.prototype.has=function(t){return null!==this.data.get(t)},ng.prototype.first=function(){return this.data.minKey()},ng.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(ng.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ng.prototype.indexOf=function(t){return this.data.indexOf(t)},ng.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},ng.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},ng.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},ng.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},ng.prototype.getIterator=function(){return new rg(this.data.getIterator())},ng.prototype.getIteratorFrom=function(t){return new rg(this.data.getIteratorFrom(t))},ng.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},ng.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},ng.prototype.isEmpty=function(){return this.data.isEmpty()},ng.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},ng.prototype.isEqual=function(t){if(!(t instanceof ng))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},ng.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ng.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ng.prototype.copy=function(t){var e=new ng(this.comparator);return e.data=t,e},ng);function ng(t){this.comparator=t,this.data=new Gv(this.comparator)}var rg=(ig.prototype.getNext=function(){return this.iter.getNext().key},ig.prototype.hasNext=function(){return this.iter.hasNext()},ig);function ig(t){this.iter=t}var og=new Gv(Cv.comparator);function ag(){return og}function sg(){return ag()}var ug=new Gv(Cv.comparator);function cg(){return ug}var hg=new Gv(Cv.comparator);function lg(){return hg}var fg=new eg(Cv.comparator);function pg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=fg,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var dg=new eg(nv);function yg(){return dg}var mg=(vg.prototype.applyToRemoteDocument=function(t,e,n){e&&Em(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Em(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},vg.prototype.applyToLocalView=function(t,e){e&&Em(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},vg.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},vg.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},pg())},vg.prototype.isEqual=function(t){return this.batchId===t.batchId&&rv(this.mutations,t.mutations)&&rv(this.baseMutations,t.baseMutations)},vg);function vg(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Em(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var gg=(bg.from=function(t,e,n,r){Em(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=lg(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new bg(t,e,n,r,i)},bg);function bg(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var wg=(_g.prototype.catch=function(t){return this.next(void 0,t)},_g.prototype.next=function(r,i){var o=this;return this.callbackAttached&&_m("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new _g(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},_g.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},_g.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof _g?e:_g.resolve(e)}catch(t){return _g.reject(t)}},_g.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):_g.resolve(e)},_g.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):_g.reject(e)},_g.resolve=function(n){return new _g(function(t,e){t(n)})},_g.reject=function(n){return new _g(function(t,e){e(n)})},_g.waitFor=function(t){return new _g(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},_g.or=function(t){for(var n=_g.resolve(!1),e=function(e){n=n.next(function(t){return t?_g.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},_g.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},_g);function _g(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Eg=(Tg.forUser=function(t,e,n,r){return Em(""!==t.uid,"UserID must not be an empty string."),new Tg(t.isAuthenticated()?t.uid:"",e,n,r)},Tg.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ng(t).iterate({index:Xw.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Tg.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Cg(n),kg(e).put(t)})},Tg.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Tg.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Cg(n),kg(e).put(t)})},Tg.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=Ag(u),d=Ng(u);return d.add({}).next(function(t){Em("number"==typeof t,"Auto-generated key is not a number");var e=new mg(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=$w.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,$w.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return wg.waitFor(r).next(function(){return e})})},Tg.prototype.lookupMutationBatch=function(t,e){var n=this;return Ng(t).get(e).next(function(t){return t?(Em(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Tg.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?wg.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},Tg.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Ng(t).iterate({index:Xw.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Em(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},Tg.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ng(t).iterate({index:Xw.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Tg.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ng(t).loadAll(Xw.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Tg.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=$w.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Ag(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=jv(i);if(r===c.userId&&u.path.isEqual(a))return Ng(s).get(o).next(function(t){if(!t)throw _m("Dangling document-mutation reference found: "+e+" which points to "+o);Em(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},Tg.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new eg(nv),i=[];return t.forEach(function(s){var t=$w.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Ag(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=jv(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),wg.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Tg.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Em(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Em(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=$w.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new eg(nv);return Ag(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=jv(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},Tg.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Ng(t).get(e).next(function(t){if(null===t)throw _m("Dangling document-mutation reference found, which points to "+e);Em(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),wg.waitFor(i).next(function(){return r})},Tg.prototype.removeMutationBatch=function(e,n){var r=this;return Ig(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),wg.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},Tg.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Tg.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return wg.resolve();var e=IDBKeyRange.lowerBound($w.prefixForUser(o.userId)),i=[];return Ag(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=jv(t[1]);i.push(r)}else n.done()}).next(function(){Em(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Tg.prototype.containsKey=function(t,e){return Sg(t,this.userId,e)},Tg.prototype.getMutationQueueMetadata=function(t){var e=this;return kg(t).get(this.userId).next(function(t){return t||new zw(e.userId,-1,"")})},Tg);function Tg(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Sg(t,o,e){var n=$w.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Ag(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Ig(t,e,n){var r=t.store(Xw.store),i=t.store($w.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Em(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=$w.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return wg.waitFor(o).next(function(){return c})}function Cg(t){return t instanceof Uint8Array?(Em("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Ng(t){return W_.getStore(t,Xw.store)}function Ag(t){return W_.getStore(t,$w.store)}function kg(t){return W_.getStore(t,zw.store)}var Dg,Rg;(Rg=Dg=Dg||{})[Rg.QueryCache=0]="QueryCache",Rg[Rg.SyncEngine=1]="SyncEngine";var Og=(Pg.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Pg.prototype.after=function(t){return this.seek(t+2),this.next()},Pg.prototype.seek=function(t){Em((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Pg.forQueryCache=function(){return new Pg(Dg.QueryCache,2)},Pg.forSyncEngine=function(){return new Pg(Dg.SyncEngine)},Pg);function Pg(t,e){Em((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Mg="SimpleDb",xg=(Lg.openOrCreate=function(o,t,a){return Em(Lg.isAvailable(),"IndexedDB not supported in current environment."),gm(Mg,"Opening database:",o),new wg(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Lg(e))},i.onblocked=function(){r(new Am(Nm.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Am(Nm.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){gm(Mg,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;a.createOrUpgrade(e,i.transaction,t.oldVersion,jw).next(function(){gm(Mg,"Database upgrade to version "+jw+" complete")})}}).toPromise()},Lg.delete=function(t){return gm(Mg,"Removing database:",t),Wg(window.indexedDB.deleteDatabase(t)).toPromise()},Lg.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=pa(),e=Lg.getIOSVersion(t),n=0<e&&e<10,r=Lg.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Lg.getStore=function(t,e){return t.store(e)},Lg.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Lg.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Lg.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Lg.prototype.runTransaction=function(t,e,n){var r=qg.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),wg.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Lg.prototype.close=function(){this.db.close()},Lg);function Lg(t){this.db=t,12.2===Lg.getIOSVersion(pa())&&bm("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Fg=(Object.defineProperty(Ug.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Ug.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Ug.prototype.done=function(){this.shouldStop=!0},Ug.prototype.skip=function(t){this.nextKey=t},Ug.prototype.delete=function(){return Wg(this.dbCursor.delete())},Ug);function Ug(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var qg=(Vg.open=function(t,e,n){return new Vg(t.transaction(n,e))},Object.defineProperty(Vg.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Vg.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(gm(Mg,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Vg.prototype.store=function(t){var e=this.transaction.objectStore(t);return Em(!!e,"Object store not part of transaction: "+t),new Bg(e)},Vg);function Vg(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Dv,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=Qg(t.target.error);n.completionDeferred.reject(e)}}var Bg=(jg.prototype.put=function(t,e){return Wg(void 0!==e?(gm(Mg,"PUT",this.store.name,t,e),this.store.put(e,t)):(gm(Mg,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},jg.prototype.add=function(t){return gm(Mg,"ADD",this.store.name,t,t),Wg(this.store.add(t))},jg.prototype.get=function(e){var n=this;return Wg(this.store.get(e)).next(function(t){return void 0===t&&(t=null),gm(Mg,"GET",n.store.name,e,t),t})},jg.prototype.delete=function(t){return gm(Mg,"DELETE",this.store.name,t),Wg(this.store.delete(t))},jg.prototype.count=function(){return gm(Mg,"COUNT",this.store.name),Wg(this.store.count())},jg.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},jg.prototype.deleteAll=function(t,e){gm(Mg,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},jg.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},jg.prototype.iterateSerial=function(i){var t=this.cursor({});return new wg(function(n,r){t.onerror=function(t){var e=Qg(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},jg.prototype.iterateCursor=function(t,a){var s=[];return new wg(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Fg(e),r=a(e.primaryKey,e.value,n);if(r instanceof wg){var i=r.catch(function(t){return n.done(),wg.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return wg.waitFor(s)})},jg.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Em(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},jg.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},jg);function jg(t){this.store=t}function Wg(t){return new wg(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Qg(t.target.error);r(e)}})}var Kg=!1;function Qg(t){var e=xg.getIOSVersion(pa());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Am("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Kg||(Kg=!0,setTimeout(function(){throw r},0)),r}}return t}var Hg=(Gg.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},Gg.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Qv.fromTimestamp(new Wv(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Gg.prototype.getHighestSequenceNumber=function(t){return Xg(t.simpleDbTransaction)},Gg.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},Gg.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},Gg.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},Gg.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return zg(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Em(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},Gg.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return zg(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return wg.waitFor(u)}).next(function(){return s})},Gg.prototype.forEachTarget=function(t,r){var i=this;return zg(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},Gg.prototype.retrieveMetadata=function(t){return Yg(t.simpleDbTransaction)},Gg.prototype.saveMetadata=function(t,e){return function(t){return W_.getStore(t,h_.store)}(t).put(h_.key,e)},Gg.prototype.saveQueryData=function(t,e){return zg(t).put(this.serializer.toDbTarget(e))},Gg.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Gg.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},Gg.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return zg(t).iterate({range:n,index:a_.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},Gg.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=Jg(n);return t.forEach(function(t){var e=qv(t.path);o.push(a.put(new u_(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),wg.waitFor(o)},Gg.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=Jg(n);return wg.forEach(t,function(t){var e=qv(t.path);return wg.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},Gg.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Jg(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Gg.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Jg(t),o=pg();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=jv(t[1]),i=new Cv(r);o=o.add(i)}).next(function(){return o})},Gg.prototype.containsKey=function(t,e){var n=qv(e.path),r=IDBKeyRange.bound([n],[iv(n)],!1,!0),i=0;return Jg(t).iterate({index:u_.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gg.prototype.getQueryDataForTarget=function(t,e){var n=this;return zg(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},Gg);function Gg(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Og.forQueryCache()}function zg(t){return W_.getStore(t,a_.store)}function Yg(t){return xg.getStore(t,h_.store).get(h_.key).next(function(t){return Em(null!==t,"Missing metadata row."),t})}function Xg(t){return Yg(t).next(function(t){return t.highestListenSequenceNumber})}function Jg(t){return W_.getStore(t,u_.store)}var $g=(Zg.fromSet=function(t){return new Zg(t)},Zg.fromArray=function(t){var e=new eg(Sv.comparator);return t.forEach(function(t){return e=e.add(t)}),new Zg(e)},Zg.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},Zg.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Zg);function Zg(t){this.fields=t}var tb=(eb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},eb);function eb(t,e){this.field=t,this.transform=e}var nb,rb,ib=function(t,e){this.version=t,this.transformResults=e};(rb=nb=nb||{})[rb.Set=0]="Set",rb[rb.Patch=1]="Patch",rb[rb.Transform=2]="Transform",rb[rb.Delete=3]="Delete";var ob=(ab.exists=function(t){return new ab(void 0,t)},ab.updateTime=function(t){return new ab(t)},Object.defineProperty(ab.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),ab.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof gw&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof gw:(Em(this.isNone,"Precondition should be empty"),!0)},ab.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},ab.NONE=new ab,ab);function ab(t,e){this.updateTime=t,this.exists=e,Em(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var sb=(ub.prototype.verifyKeyMatches=function(t){null!=t&&Em(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},ub.getPostMutationVersion=function(t){return t instanceof gw?t.version:Qv.MIN},ub);function ub(){}var cb,hb=(Yo(lb,cb=sb),lb.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Em(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new gw(this.key,n,{hasCommittedMutations:!0},this.value)},lb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=sb.getPostMutationVersion(t);return new gw(this.key,r,{hasLocalMutations:!0},this.value)},lb.prototype.extractBaseValue=function(t){return null},lb.prototype.isEqual=function(t){return t instanceof lb&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},lb);function lb(t,e,n){var r=cb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=nb.Set,r}var fb,pb=(Yo(db,fb=sb),db.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Em(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Sw(this.key,e.version);var n=this.patchDocument(t);return new gw(this.key,e.version,{hasCommittedMutations:!0},n)},db.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=sb.getPostMutationVersion(t),i=this.patchDocument(t);return new gw(this.key,r,{hasLocalMutations:!0},i)},db.prototype.extractBaseValue=function(t){return null},db.prototype.isEqual=function(t){return t instanceof db&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},db.prototype.patchDocument=function(t){var e;return e=t instanceof gw?t.data():hw.EMPTY,this.patchObject(e)},db.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},db);function db(t,e,n,r){var i=fb.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=nb.Patch,i}var yb,mb=(Yo(vb,yb=sb),vb.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Em(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Sw(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new gw(this.key,i,{hasCommittedMutations:!0},o)},vb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new gw(this.key,r.version,{hasLocalMutations:!0},o)},vb.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof gw?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?hw.EMPTY.set(i.field,a):e.set(i.field,a))}return e},vb.prototype.isEqual=function(t){return t instanceof vb&&this.key.isEqual(t.key)&&rv(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},vb.prototype.requireDocument=function(t){Em(t instanceof gw,"Unknown MaybeDocument type "+t);var e=t;return Em(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},vb.prototype.serverTransformResults=function(t,e){var n=[];Em(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof gw&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},vb.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof gw&&(u=e.field(a.field)),null===u&&n instanceof gw&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},vb.prototype.transformObject=function(t,e){Em(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},vb);function vb(t,e){var n=yb.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=nb.Transform,n.precondition=ob.exists(!0),n}var gb,bb,wb,_b,Eb,Tb=(Yo(Sb,gb=sb),Sb.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Em(null==e.transformResults,"Transform results received by DeleteMutation."),new _w(this.key,e.version,{hasCommittedMutations:!0})},Sb.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Em(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new _w(this.key,Qv.forDeletedDoc())):t},Sb.prototype.extractBaseValue=function(t){return null},Sb.prototype.isEqual=function(t){return t instanceof Sb&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Sb);function Sb(t,e){var n=gb.call(this)||this;return n.key=t,n.precondition=e,n.type=nb.Delete,n}(wb=bb=bb||{})[wb.NullValue=0]="NullValue",wb[wb.BooleanValue=1]="BooleanValue",wb[wb.NumberValue=2]="NumberValue",wb[wb.TimestampValue=3]="TimestampValue",wb[wb.StringValue=4]="StringValue",wb[wb.BlobValue=5]="BlobValue",wb[wb.RefValue=6]="RefValue",wb[wb.GeoPointValue=7]="GeoPointValue",wb[wb.ArrayValue=8]="ArrayValue",wb[wb.ObjectValue=9]="ObjectValue",(Eb=_b=_b||{})[Eb.Default=0]="Default",Eb[Eb.Estimate=1]="Estimate",Eb[Eb.Previous=2]="Previous";var Ib=(Cb.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Cb(_b.Estimate,e);case"previous":return new Cb(_b.Previous,e);case"none":case void 0:return new Cb(_b.Default,e);default:return _m("fromSnapshotOptions() called with invalid options.")}},Cb);function Cb(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Nb=(Ab.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Ab.prototype.defaultCompareTo=function(t){return Em(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),nv(this.typeOrder,t.typeOrder)},Ab);function Ab(){}var kb,Db=(Yo(Rb,kb=Nb),Rb.prototype.value=function(t){return null},Rb.prototype.isEqual=function(t){return t instanceof Rb},Rb.prototype.compareTo=function(t){return t instanceof Rb?0:this.defaultCompareTo(t)},Rb.INSTANCE=new Rb,Rb);function Rb(){var t=kb.call(this)||this;return t.typeOrder=bb.NullValue,t.internalValue=null,t}var Ob,Pb=(Yo(Mb,Ob=Nb),Mb.prototype.value=function(t){return this.internalValue},Mb.prototype.isEqual=function(t){return t instanceof Mb&&this.internalValue===t.internalValue},Mb.prototype.compareTo=function(t){return t instanceof Mb?nv(this,t):this.defaultCompareTo(t)},Mb.of=function(t){return t?Mb.TRUE:Mb.FALSE},Mb.TRUE=new Mb(!0),Mb.FALSE=new Mb(!1),Mb);function Mb(t){var e=Ob.call(this)||this;return e.internalValue=t,e.typeOrder=bb.BooleanValue,e}var xb,Lb=(Yo(Fb,xb=Nb),Fb.prototype.value=function(t){return this.internalValue},Fb.prototype.compareTo=function(t){return t instanceof Fb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Fb);function Fb(t){var e=xb.call(this)||this;return e.internalValue=t,e.typeOrder=bb.NumberValue,e}function Ub(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var qb,Vb=(Yo(Bb,qb=Lb),Bb.prototype.isEqual=function(t){return t instanceof Bb&&Ub(this.internalValue,t.internalValue)},Bb);function Bb(){return null!==qb&&qb.apply(this,arguments)||this}var jb,Wb=(Yo(Kb,jb=Lb),Kb.prototype.isEqual=function(t){return t instanceof Kb&&Ub(this.internalValue,t.internalValue)},Kb.NAN=new Kb(NaN),Kb.POSITIVE_INFINITY=new Kb(1/0),Kb.NEGATIVE_INFINITY=new Kb(-1/0),Kb);function Kb(){return null!==jb&&jb.apply(this,arguments)||this}var Qb,Hb=(Yo(Gb,Qb=Nb),Gb.prototype.value=function(t){return this.internalValue},Gb.prototype.isEqual=function(t){return t instanceof Gb&&this.internalValue===t.internalValue},Gb.prototype.compareTo=function(t){return t instanceof Gb?nv(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Gb);function Gb(t){var e=Qb.call(this)||this;return e.internalValue=t,e.typeOrder=bb.StringValue,e}var zb,Yb=(Yo(Xb,zb=Nb),Xb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Xb.prototype.isEqual=function(t){return t instanceof Xb&&this.internalValue.isEqual(t.internalValue)},Xb.prototype.compareTo=function(t){return t instanceof Xb?this.internalValue._compareTo(t.internalValue):t instanceof $b?-1:this.defaultCompareTo(t)},Xb);function Xb(t){var e=zb.call(this)||this;return e.internalValue=t,e.typeOrder=bb.TimestampValue,e}var Jb,$b=(Yo(Zb,Jb=Nb),Zb.prototype.value=function(t){return t&&t.serverTimestampBehavior===_b.Estimate?new Yb(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===_b.Previous&&this.previousValue?this.previousValue.value(t):null},Zb.prototype.isEqual=function(t){return t instanceof Zb&&this.localWriteTime.isEqual(t.localWriteTime)},Zb.prototype.compareTo=function(t){return t instanceof Zb?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Yb?1:this.defaultCompareTo(t)},Zb.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Zb);function Zb(t,e){var n=Jb.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=bb.TimestampValue,n}var tw,ew=(Yo(nw,tw=Nb),nw.prototype.value=function(t){return this.internalValue},nw.prototype.isEqual=function(t){return t instanceof nw&&this.internalValue.isEqual(t.internalValue)},nw.prototype.compareTo=function(t){return t instanceof nw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},nw);function nw(t){var e=tw.call(this)||this;return e.internalValue=t,e.typeOrder=bb.BlobValue,e}var rw,iw=(Yo(ow,rw=Nb),ow.prototype.value=function(t){return this.key},ow.prototype.isEqual=function(t){return t instanceof ow&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},ow.prototype.compareTo=function(t){if(t instanceof ow){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Cv.comparator(this.key,t.key)}return this.defaultCompareTo(t)},ow);function ow(t,e){var n=rw.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=bb.RefValue,n}var aw,sw=(Yo(uw,aw=Nb),uw.prototype.value=function(t){return this.internalValue},uw.prototype.isEqual=function(t){return t instanceof uw&&this.internalValue.isEqual(t.internalValue)},uw.prototype.compareTo=function(t){return t instanceof uw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},uw);function uw(t){var e=aw.call(this)||this;return e.internalValue=t,e.typeOrder=bb.GeoPointValue,e}var cw,hw=(Yo(lw,cw=Nb),lw.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},lw.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},lw.prototype.isEqual=function(t){if(t instanceof lw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},lw.prototype.compareTo=function(t){if(t instanceof lw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=nv(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return nv(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},lw.prototype.set=function(t,e){if(Em(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof lw||(n=lw.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},lw.prototype.delete=function(t){if(Em(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new lw(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof lw){var n=e.delete(t.popFirst());return new lw(this.internalValue.insert(t.firstSegment(),n))}return this},lw.prototype.contains=function(t){return null!==this.field(t)},lw.prototype.field=function(t){Em(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof lw?e.internalValue.get(t):null}),e},lw.prototype.fieldMask=function(){var i=new eg(Sv.comparator);return this.internalValue.forEach(function(t,e){var n=new Sv([t]);if(e instanceof lw){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),$g.fromSet(i)},lw.prototype.toString=function(){return this.internalValue.toString()},lw.prototype.child=function(t){return this.internalValue.get(t)||void 0},lw.prototype.setChild=function(t,e){return new lw(this.internalValue.insert(t,e))},lw.EMPTY=new lw(new Gv(nv)),lw);function lw(t){var e=cw.call(this)||this;return e.internalValue=t,e.typeOrder=bb.ObjectValue,e}var fw,pw=(Yo(dw,fw=Nb),dw.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},dw.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},dw.prototype.forEach=function(t){this.internalValue.forEach(t)},dw.prototype.isEqual=function(t){if(t instanceof dw){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},dw.prototype.compareTo=function(t){if(t instanceof dw){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return nv(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},dw.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},dw);function dw(t){var e=fw.call(this)||this;return e.internalValue=t,e.typeOrder=bb.ArrayValue,e}var yw=(mw.compareByKey=function(t,e){return Cv.comparator(t.key,e.key)},mw);function mw(t,e){this.key=t,this.version=e}var vw,gw=(Yo(bw,vw=yw),bw.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},bw.prototype.data=function(){var n=this;if(!this.objectValue){var r=hw.EMPTY;Mm(this.proto.fields||{},function(t,e){r=r.set(new Sv([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},bw.prototype.value=function(){return this.data().value()},bw.prototype.isEqual=function(t){return t instanceof bw&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},bw.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(bw.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),bw.prototype.getProtoField=function(t){Em(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},bw.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):_m("Trying to compare documents on fields that don't exist")},bw);function bw(t,e,n,r,i,o){var a=vw.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Em(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var ww,_w=(Yo(Ew,ww=yw),Ew.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ew.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ew.prototype.isEqual=function(t){return t instanceof Ew&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ew);function Ew(t,e,n){var r=ww.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Tw,Sw=(Yo(Iw,Tw=yw),Iw.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Iw.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Iw.prototype.isEqual=function(t){return t instanceof Iw&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Iw);function Iw(){return null!==Tw&&Tw.apply(this,arguments)||this}var Cw=(Nw.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Nw.prototype.has=function(t){return void 0!==this.get(t)},Nw.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Nw.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Nw.prototype.forEach=function(s){Mm(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Nw.prototype.isEmpty=function(){return xm(this.inner)},Nw);function Nw(t){this.mapKeyFn=t,this.inner={}}var Aw=(Object.defineProperty(kw.prototype,"readTime",{get:function(){return Em(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Em(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),kw.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},kw.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},kw.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?wg.resolve(n):this.getFromCache(t,e)},kw.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},kw.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},kw.prototype.assertNotApplied=function(){Em(!this.changesApplied,"Changes have already been applied.")},kw);function kw(){this.changes=new Cw(function(t){return t.toString()}),this.changesApplied=!1}var Dw,Rw=(Ow.prototype.start=function(t){return this.synchronizeLastProcessedReadTime(t)},Ow.prototype.addEntry=function(t,e,n){var r=this;return xw(t).put(Lw(e),n).next(function(){r.indexManager.addToCollectionParentIndex(t,e.path.popLast())})},Ow.prototype.removeEntry=function(t,e){var n=xw(t),r=Lw(e);return n.delete(r)},Ow.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},Ow.prototype.getEntry=function(t,e){var n=this;return xw(t).get(Lw(e)).next(function(t){return n.maybeDecodeDocument(t)})},Ow.prototype.getSizedEntry=function(t,e){var n=this;return xw(t).get(Lw(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:Fw(t)}:null})},Ow.prototype.getEntries=function(t,e){var r=this,i=sg();return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);i=i.insert(t,n)}).next(function(){return i})},Ow.prototype.getSizedEntries=function(t,e){var r=this,i=sg(),o=new Gv(Cv.comparator);return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);o=n?(i=i.insert(t,n),o.insert(t,Fw(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},Ow.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return wg.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return xw(t).iterate({range:n},function(t,e,n){for(var r=Cv.fromSegments(t);a&&Cv.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Ow.prototype.getDocumentsMatchingQuery=function(t,i,e){var o=this;Em(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=cg(),s=i.path.length+1,n={};if(e.isEqual(Qv.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(e);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=n_.collectionReadTimeIndex}return xw(t).iterate(n,function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof gw&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Ow.prototype.getNewDocumentChanges=function(t){var r=this,i=ag(),e=this.serializer.toDbTimestampKey(this.lastProcessedReadTime),n=xw(t),o=IDBKeyRange.lowerBound(e,!0);return n.iterate({index:n_.readTimeIndex,range:o},function(t,e){var n=r.serializer.fromDbRemoteDocument(e);i=i.insert(n.key,n),r.lastProcessedReadTime=r.serializer.fromDbTimestampKey(e.readTime)}).next(function(){return i})},Ow.prototype.synchronizeLastProcessedReadTime=function(t){var r=this,e=xg.getStore(t,n_.store);return this.lastProcessedReadTime=Qv.forDeletedDoc(),e.iterate({index:n_.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r.lastProcessedReadTime=r.serializer.fromDbTimestampKey(e.readTime)),n.done()})},Ow.prototype.newChangeBuffer=function(t){return new Ow.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},Ow.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ow.prototype.getMetadata=function(t){return Mw(t).get(i_.key).next(function(t){return Em(!!t,"Missing document cache metadata"),t})},Ow.prototype.setMetadata=function(t,e){return Mw(t).put(i_.key,e)},Ow.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof _w&&e.version.isEqual(Qv.forDeletedDoc())?null:e}return null},Ow.RemoteDocumentChangeBuffer=(Yo(Pw,Dw=Aw),Pw.prototype.applyChanges=function(a){var s=this,u=[],c=0;return this.changes.forEach(function(t,e){var n=s.documentSizes.get(t);if(Em(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Em(!s.readTime.isEqual(Qv.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(e,s.readTime),i=Fw(r);c+=i-n,u.push(s.documentCache.addEntry(a,t,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new _w(t,Qv.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,t,o))}else u.push(s.documentCache.removeEntry(a,t))}),u.push(this.documentCache.updateMetadata(a,c)),wg.waitFor(u)},Pw.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},Pw.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},Pw),Ow);function Ow(t,e){this.serializer=t,this.indexManager=e,this.lastProcessedReadTime=Qv.MIN}function Pw(t,e){var n=Dw.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Cw(function(t){return t.toString()}),n}function Mw(t){return W_.getStore(t,i_.store)}function xw(t){return W_.getStore(t,n_.store)}function Lw(t){return t.path.toArray()}function Fw(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _m("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Uw=(qw.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),wg.resolve()},qw.prototype.getCollectionParents=function(t,e){return wg.resolve(this.collectionParentIndex.getEntries(e))},qw);function qw(){this.collectionParentIndex=new Vw}var Vw=(Bw.prototype.add=function(t){Em(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new eg(wv.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},Bw.prototype.getEntries=function(t){return(this.index[t]||new eg(wv.comparator)).toArray()},Bw);function Bw(){this.index={}}var jw=9,Ww=(Kw.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Em(n<r&&0<=n&&r<=jw,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new qg(e);n<1&&1<=r&&(function(t){t.createObjectStore(Hw.store)}(t),function(t){t.createObjectStore(zw.store,{keyPath:zw.keyPath}),t.createObjectStore(Xw.store,{keyPath:Xw.keyPath,autoIncrement:!0}).createIndex(Xw.userMutationsIndex,Xw.userMutationsKeyPath,{unique:!0}),t.createObjectStore($w.store)}(t),d_(t),function(t){t.createObjectStore(n_.store)}(t));var a=wg.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(u_.store),t.deleteObjectStore(a_.store),t.deleteObjectStore(h_.store)}(t),d_(t)),a=a.next(function(){return function(t){var e=t.store(h_.store),n=new h_(0,0,Qv.MIN.toTimestamp(),0);return e.put(h_.key,n)}(o)})),n<4&&4<=r&&(0!==n&&(a=a.next(function(){return function(r,i){return i.store(Xw.store).loadAll().next(function(t){r.deleteObjectStore(Xw.store),r.createObjectStore(Xw.store,{keyPath:Xw.keyPath,autoIncrement:!0}).createIndex(Xw.userMutationsIndex,Xw.userMutationsKeyPath,{unique:!0});var e=i.store(Xw.store),n=t.map(function(t){return e.put(t)});return wg.waitFor(n)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(y_.store,{keyPath:y_.keyPath})}(t)})),n<5&&5<=r&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&6<=r&&(a=a.next(function(){return function(t){t.createObjectStore(i_.store)}(t),i.addDocumentGlobal(o)})),n<7&&7<=r&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&8<=r&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&9<=r&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(n_.store);e.createIndex(n_.readTimeIndex,n_.readTimeIndexPath,{unique:!1}),e.createIndex(n_.collectionReadTimeIndex,n_.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},Kw.prototype.addDocumentGlobal=function(e){var n=0;return e.store(n_.store).iterate(function(t,e){n+=Fw(e)}).next(function(){var t=new i_(n);return e.store(i_.store).put(i_.key,t)})},Kw.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(zw.store),e=r.store(Xw.store);return t.loadAll().next(function(t){return wg.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(Xw.userMutationsIndex,t).next(function(t){return wg.forEach(t,function(t){Em(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return Ig(r,n.userId,e).next(function(){})})})})})},Kw.prototype.ensureSequenceNumbers=function(t){var a=t.store(u_.store),e=t.store(n_.store);return Xg(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new wv(t),r=function(t){return[0,qv(t)]}(n);o.push(a.get(r).next(function(t){return t?wg.resolve():function(t){return a.put(new u_(0,qv(t),i))}(n)}))}).next(function(){return wg.waitFor(o)})})},Kw.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:qv(n)})}}t.createObjectStore(f_.store,{keyPath:f_.keyPath});var r=e.store(f_.store),o=new Vw;return e.store(n_.store).iterate({keysOnly:!0},function(t,e){var n=new wv(t);return i(n.popLast())}).next(function(){return e.store($w.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],jv(n));return i(r.popLast())})})},Kw);function Kw(t){this.serializer=t}var Qw=function(t,e){this.seconds=t,this.nanoseconds=e},Hw=(Gw.store="owner",Gw.key="owner",Gw);function Gw(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var zw=(Yw.store="mutationQueues",Yw.keyPath="userId",Yw);function Yw(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Xw=(Jw.store="mutations",Jw.keyPath="batchId",Jw.userMutationsIndex="userMutationsIndex",Jw.userMutationsKeyPath=["userId","batchId"],Jw);function Jw(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var $w=(Zw.prefixForUser=function(t){return[t]},Zw.prefixForPath=function(t,e){return[t,qv(e)]},Zw.key=function(t,e,n){return[t,qv(e),n]},Zw.store="documentMutations",Zw.PLACEHOLDER=new Zw,Zw);function Zw(){}var t_=function(t,e){this.path=t,this.readTime=e},e_=function(t,e){this.path=t,this.version=e},n_=(r_.store="remoteDocuments",r_.readTimeIndex="readTimeIndex",r_.readTimeIndexPath="readTime",r_.collectionReadTimeIndex="collectionReadTimeIndex",r_.collectionReadTimeIndexPath=["parentPath","readTime"],r_);function r_(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var i_=(o_.store="remoteDocumentGlobal",o_.key="remoteDocumentGlobalKey",o_);function o_(t){this.byteSize=t}var a_=(s_.store="targets",s_.keyPath="targetId",s_.queryTargetsIndexName="queryTargetsIndex",s_.queryTargetsKeyPath=["canonicalId","targetId"],s_);function s_(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var u_=(c_.store="targetDocuments",c_.keyPath=["targetId","path"],c_.documentTargetsIndex="documentTargetsIndex",c_.documentTargetsKeyPath=["path","targetId"],c_);function c_(t,e,n){this.targetId=t,this.path=e,Em(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var h_=(l_.key="targetGlobalKey",l_.store="targetGlobal",l_);function l_(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var f_=(p_.store="collectionParents",p_.keyPath=["collectionId","parent"],p_);function p_(t,e){this.collectionId=t,this.parent=e}function d_(t){t.createObjectStore(u_.store,{keyPath:u_.keyPath}).createIndex(u_.documentTargetsIndex,u_.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(a_.store,{keyPath:a_.keyPath}).createIndex(a_.queryTargetsIndexName,a_.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(h_.store)}var y_=(m_.store="clientMetadata",m_.keyPath="clientId",m_);function m_(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var v_,g_,b_=na(na(na([zw.store,Xw.store,$w.store,n_.store,a_.store,Hw.store,h_.store,u_.store],[y_.store]),[i_.store]),[f_.store]),w_=(__.prototype.addToCollectionParentIndex=function(t,e){if(Em(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Em(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return E_(t).put({collectionId:n,parent:qv(r)})}return wg.resolve()},__.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[iv(i),""],!1,!0);return E_(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(jv(r.parent))}return o})},__);function __(){this.collectionParentsCache=new Vw}function E_(t){return W_.getStore(t,f_.store)}(g_=v_=v_||{})[g_.Listen=0]="Listen",g_[g_.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",g_[g_.LimboResolution=2]="LimboResolution";var T_=(S_.prototype.withSequenceNumber=function(t){return new S_(this.query,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},S_.prototype.withResumeToken=function(t,e){return new S_(this.query,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},S_.prototype.withLastLimboFreeSnapshotVersion=function(t){return new S_(this.query,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},S_.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},S_);function S_(t,e,n,r,i,o,a){void 0===i&&(i=Qv.MIN),void 0===o&&(o=Qv.MIN),void 0===a&&(a=Im()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var I_=(C_.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Cv.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new _w(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Cv.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Sw(e,n)):_m("Unexpected DbRemoteDocument")},C_.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof gw){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new n_(null,null,i,o,n,r)}if(t instanceof _w){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new n_(null,new t_(a,s),null,o,n,r)}if(t instanceof Sw){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new n_(new e_(a,u),null,null,!0,n,r)}return _m("Unexpected MaybeDocument")},C_.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},C_.prototype.fromDbTimestampKey=function(t){var e=new Wv(t[0],t[1]);return Qv.fromTimestamp(e)},C_.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Qw(e.seconds,e.nanoseconds)},C_.prototype.fromDbTimestamp=function(t){var e=new Wv(t.seconds,t.nanoseconds);return Qv.fromTimestamp(e)},C_.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Xw(t,e.batchId,e.localWriteTime.toMillis(),r,i)},C_.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Wv.fromMillis(t.localWriteTimeMs);return new mg(t.batchId,i,n,r)},C_.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(qv(t.path))}),e},C_.prototype.fromDbResourcePaths=function(t){for(var e=pg(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Cv(jv(i)))}return e},C_.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):Qv.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new T_(e,t.targetId,v_.Listen,t.lastListenSequenceNumber,n,r,i)},C_.prototype.toDbTarget=function(t){Em(v_.Listen===t.purpose,"Only queries with purpose "+v_.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Em("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new a_(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,i,e)},C_);function C_(t){this.remoteSerializer=t}function N_(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=nv(n,i);return 0===a?nv(r,o):a}var A_=(k_.prototype.nextIndex=function(){return++this.previousIndex},k_.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();N_(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(k_.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),k_);function k_(t){this.maxElements=t,this.buffer=new eg(N_),this.previousIndex=0}var D_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},R_=(O_.withCacheSize=function(t){return new O_(t,O_.DEFAULT_COLLECTION_PERCENTILE,O_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},O_.COLLECTION_DISABLED=-1,O_.MINIMUM_CACHE_SIZE_BYTES=1048576,O_.DEFAULT=new O_(O_.DEFAULT_CACHE_SIZE_BYTES=41943040,O_.DEFAULT_COLLECTION_PERCENTILE=10,O_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),O_.DISABLED=new O_(O_.COLLECTION_DISABLED,0,0),O_);function O_(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var P_=(M_.prototype.start=function(){Em(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==R_.COLLECTION_DISABLED&&this.scheduleGC()},M_.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(M_.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),M_.prototype.scheduleGC=function(){var t=this;Em(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;gm("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Av.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Q_)})},M_);function M_(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var x_=(L_.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},L_.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return wg.resolve(dv.INVALID);var r=new A_(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},L_.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},L_.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},L_.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===R_.COLLECTION_DISABLED?(gm("LruGarbageCollector","Garbage collection skipped; disabled"),wg.resolve(D_)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(gm("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),D_):r.runGarbageCollection(e,n)})},L_.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},L_.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(gm("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),mm()<=am.DEBUG&&gm("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),wg.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},L_);function L_(t,e){this.delegate=t,this.params=e}var F_,U_="IndexedDbPersistence",q_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",V_="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",B_=(Yo(j_,F_=function(){}),j_);function j_(t,e){var n=F_.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var W_=(K_.getStore=function(t,e){if(t instanceof B_)return xg.getStore(t.simpleDbTransaction,e);throw _m("IndexedDbPersistence must use instances of IndexedDbTransaction")},K_.createIndexedDbPersistence=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:if(!K_.isAvailable())throw new Am(Nm.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new K_(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},K_.prototype.start=function(){var e=this;return Em(!this.started,"IndexedDbPersistence double-started!"),Em(null!==this.window,"Expected 'window' to be defined"),xg.openOrCreate(this.dbName,jw,new Ww(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.startRemoteDocumentCache()}).then(function(){return e.simpleDb.runTransaction("readonly",[h_.store],function(t){return Xg(t).next(function(t){e.listenSequence=new dv(t,e.sequenceNumberSyncer)})})}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},K_.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",b_,function(t){return e.remoteDocumentCache.start(t)})},K_.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return Jo(t,void 0,void 0,function(){return $o(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},K_.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return Jo(t,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},K_.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Jo(e,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},K_.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",b_,function(n){return G_(n).put(new y_(r.clientId,Date.now(),r.networkEnabled,r.inForeground)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},K_.prototype.verifyPrimaryLease=function(t){var e=this;return H_(t).get(Hw.key).next(function(t){return wg.resolve(e.isLocalClient(t))})},K_.prototype.removeClientMetadata=function(t){return G_(t).delete(this.clientId)},K_.prototype.maybeGarbageCollectMultiClientState=function(){return Jo(this,void 0,void 0,function(){var n,r,i=this;return $o(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),r=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=K_.getStore(t,y_.store);return e.loadAll().next(function(t){return n=i.filterActiveClients(t,18e5),r=t.filter(function(t){return-1===n.indexOf(t)}),wg.forEach(r,function(t){return e.delete(t.clientId)})})})]);case 1:t.sent(),r.forEach(function(t){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},K_.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Av.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},K_.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},K_.prototype.canActAsPrimary=function(e){var i=this;return H_(e).get(Hw.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Am(Nm.FAILED_PRECONDITION,V_);return!1}}return!(!i.networkEnabled||!i.inForeground)||G_(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&gm(U_,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},K_.prototype.shutdown=function(){return Jo(this,void 0,void 0,function(){var e=this;return $o(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Hw.store,y_.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},K_.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},K_.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[y_.store],function(t){return G_(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},K_.clearPersistence=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return K_.isAvailable()?(e=n+K_.MAIN_DATABASE,[4,xg.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(K_.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),K_.prototype.getMutationQueue=function(t){return Em(this.started,"Cannot initialize MutationQueue before persistence is started."),Eg.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},K_.prototype.getQueryCache=function(){return Em(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},K_.prototype.getRemoteDocumentCache=function(){return Em(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},K_.prototype.getIndexManager=function(){return Em(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},K_.prototype.runTransaction=function(n,t,r){var i=this;return gm(U_,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",b_,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw bm("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Am(Nm.FAILED_PRECONDITION,q_);return r(new B_(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new B_(e,i.listenSequence.next()))})})},K_.prototype.verifyAllowTabSynchronization=function(t){var e=this;return H_(t).get(Hw.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Am(Nm.FAILED_PRECONDITION,V_)})},K_.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Hw(this.clientId,this.allowTabSynchronization,Date.now());return H_(t).put(Hw.key,e)},K_.isAvailable=function(){return xg.isAvailable()},K_.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},K_.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=H_(t);return n.get(Hw.key).next(function(t){return e.isLocalClient(t)?(gm(U_,"Releasing primary lease."),n.delete(Hw.key)):wg.resolve()})},K_.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(bm("Detected an update time that is in the future: "+t+" > "+n),1))},K_.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},K_.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Em(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},K_.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},K_.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Em("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},K_.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return gm(U_,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return bm(U_,"Failed to get zombied client id.",t),!1}},K_.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){bm("Failed to set zombie client id.",t)}},K_.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},K_.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},K_.MAIN_DATABASE="main",K_);function K_(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new z_(this,i),this.dbName=e+K_.MAIN_DATABASE,this.serializer=new I_(a),this.document=r.document,this.queryCache=new Hg(this.referenceDelegate,this.serializer),this.indexManager=new w_,this.remoteDocumentCache=new Rw(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new Am(Nm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function Q_(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){if(!function(t){return t.code===Nm.FAILED_PRECONDITION&&t.message===q_}(e))throw e;return gm(U_,"Unexpectedly lost primary lease"),[2]})})}function H_(t){return t.store(Hw.store)}function G_(t){return t.store(y_.store)}var z_=(Y_.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},Y_.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Y_.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Y_.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},Y_.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Y_.prototype.addReference=function(t,e){return X_(t,e)},Y_.prototype.removeReference=function(t,e){return X_(t,e)},Y_.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Y_.prototype.removeMutationReference=function(t,e){return X_(t,e)},Y_.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?wg.resolve(!0):function(e,n){var r=!1;return kg(e).iterateSerial(function(t){return Sg(e,t,n).next(function(t){return t&&(r=!0),wg.resolve(!t)})}).next(function(){return r})}(t,e)},Y_.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),Jg(r).delete(function(t){return[0,qv(t.path)]}(e))})});s.push(n)}}).next(function(){return wg.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},Y_.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getQueryCache().updateQueryData(t,n)},Y_.prototype.updateLimboDocument=function(t,e){return X_(t,e)},Y_.prototype.forEachOrphanedDocument=function(t,o){var a,e=Jg(t),s=dv.INVALID;return e.iterate({index:u_.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==dv.INVALID&&o(new Cv(jv(a)),s),s=i,a=r):s=dv.INVALID}).next(function(){s!==dv.INVALID&&o(new Cv(jv(a)),s)})},Y_.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Y_);function Y_(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new x_(this,e)}function X_(t,e){return Jg(t).put(function(t,e){return new u_(0,qv(t.path),e)}(e,t.currentSequenceNumber))}var J_=($_.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},$_.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},$_.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=sg();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},$_.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},$_.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=ag();return e.forEach(function(t,e){e=e||new _w(t,Qv.forDeletedDoc()),n=n.insert(t,e)}),n})},$_.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},$_.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Cv(e)).next(function(t){var e=cg();return t instanceof gw&&(e=e.insert(t.key,t)),e})},$_.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Em(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=cg();return this.indexManager.getCollectionParents(n,a).next(function(t){return wg.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(a));return o.getDocumentsMatchingCollectionQuery(n,e,i).next(function(t){t.forEach(function(t,e){s=s.insert(t,e)})})}).next(function(){return s})})},$_.prototype.getDocumentsMatchingCollectionQuery=function(e,n,t){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,t).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof gw?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},$_.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=pg(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof pb&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof gw&&(c=c.insert(t,e))}),c})},$_);function $_(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var Z_=(tE.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},tE.prototype.addReference=function(t,e){var n=new eE(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},tE.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},tE.prototype.removeReference=function(t,e){this.removeRef(new eE(t,e))},tE.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},tE.prototype.removeReferencesForId=function(t){var e=this,n=Cv.EMPTY,r=new eE(n,t),i=new eE(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},tE.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},tE.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},tE.prototype.referencesForId=function(t){var e=Cv.EMPTY,n=new eE(e,t),r=new eE(e,t+1),i=pg();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},tE.prototype.containsKey=function(t){var e=new eE(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},tE);function tE(){this.refsByKey=new eg(eE.compareByKey),this.refsByTarget=new eg(eE.compareByTargetId)}var eE=(nE.compareByKey=function(t,e){return Cv.comparator(t.key,e.key)||nv(t.targetOrBatchId,e.targetOrBatchId)},nE.compareByTargetId=function(t,e){return nv(t.targetOrBatchId,e.targetOrBatchId)||Cv.comparator(t.key,e.key)},nE);function nE(t,e){this.key=t,this.targetOrBatchId=e}var rE="LocalStore",iE=(oE.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new J_(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.queryEngine.setLocalDocumentsView(m.localDocuments),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=pg(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},oE.prototype.localWrite=function(s){var u=this,c=Wv.now(),t=s.reduce(function(t,e){return t.add(e.key)},pg());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return u.localDocuments.getDocuments(a,t).next(function(n){for(var t=[],e=0,r=s;e<r.length;e++){var i=r[e],o=i.extractBaseValue(n.get(i.key));null!=o&&t.push(new pb(i.key,o,o.fieldMask(),ob.exists(!0)))}return u.mutationQueue.addMutationBatch(a,c,t,s).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},oE.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):wg.resolve(null)})})},oE.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},oE.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Em(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},oE.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},oE.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},oE.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},oE.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},oE.prototype.applyRemoteEvent=function(s){var u=this,c=this.remoteDocuments.newChangeBuffer({trackRemovals:!0}),h=s.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[];Pm(s.targetChanges,function(t,e){var n=u.queryDataByTarget[t];if(n){a.push(u.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return u.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);u.queryDataByTarget[t]=i,oE.shouldPersistQueryData(n,i,e)&&a.push(u.queryCache.updateQueryData(o,i))}}});var i=ag(),n=pg();if(s.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(c.getEntries(o,n).next(function(r){s.documentUpdates.forEach(function(t,e){var n=r.get(t);e instanceof _w&&e.version.isEqual(Qv.MIN)?(c.removeEntry(t,h),i=i.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(Qv.MIN.isEqual(h)&&bm(rE,"Cannot add a document when the remote version is zero"),c.addEntry(e,h),i=i.insert(t,e)):gm(rE,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual(Qv.MIN)){var t=u.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Em(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),u.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return wg.waitFor(a).next(function(){return c.apply(o)}).next(function(){return u.localDocuments.getLocalViewOfDocuments(o,i)})})},oE.shouldPersistQueryData=function(t,e,n){return Em(0<e.resumeToken.length,"Attempted to persist query data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},oE.prototype.notifyLocalViewChanges=function(t){var a=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(o){return wg.forEach(t,function(t){var e=t.targetId;if(a.localViewReferences.addReferences(t.addedKeys,e),a.localViewReferences.removeReferences(t.removedKeys,e),!t.fromCache){var n=a.queryDataByTarget[e];Em(void 0!==n,"Can't set limbo-free snapshot version for unknown target: "+e);var r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);a.queryDataByTarget[e]=i}return wg.forEach(t.removedKeys,function(t){return a.persistence.referenceDelegate.removeReference(o,t)})})})},oE.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},oE.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},oE.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,wg.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new T_(r,t,v_.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Em(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n,i.targetIdByQuery.set(r,n.targetId),n})})},oE.prototype.getQueryData=function(t,e){var n=this.targetIdByQuery.get(e);return void 0!==n?wg.resolve(this.queryDataByTarget[n]):this.queryCache.getQueryData(t,e)},oE.prototype.releaseQuery=function(i,o){var a=this,t=o?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(e){var t=a.targetIdByQuery.get(i);Em(void 0!==t,"Tried to release nonexistent query: "+i);var n=a.queryDataByTarget[t],r=a.localViewReferences.removeReferencesForId(t);return delete a.queryDataByTarget[t],a.targetIdByQuery.delete(i),o?wg.resolve():wg.forEach(r,function(t){return a.persistence.referenceDelegate.removeReference(e,t)}).next(function(){a.persistence.referenceDelegate.removeTarget(e,n)})})},oE.prototype.executeQuery=function(t,n){var r=this,i=Qv.MIN,o=pg();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.getQueryData(e,t).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.queryCache.getMatchingKeysForTargetId(e,t.targetId).next(function(t){o=t})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:Qv.MIN,n?o:pg())}).next(function(t){return{documents:t,remoteKeys:o}})})},oE.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},oE.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},oE.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},oE.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},oE.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=wg.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Em(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e,i.commitVersion):Em(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},oE.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},oE.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},oE.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},oE.RESUME_TOKEN_MAX_AGE_MICROS=3e8,oE);function oE(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new Z_,this.queryDataByTarget={},this.targetIdByQuery=new Cw(function(t){return t.canonicalId()}),Em(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new J_(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var aE=(sE.prototype.checkEmpty=function(t){return wg.resolve(0===this.mutationQueue.length)},sE.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Em(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Em(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,wg.resolve()},sE.prototype.getLastStreamToken=function(t){return wg.resolve(this.lastStreamToken)},sE.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,wg.resolve()},sE.prototype.addMutationBatch=function(t,e,n,r){Em(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Em(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new mg(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new eE(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return wg.resolve(o)},sE.prototype.lookupMutationBatch=function(t,e){return wg.resolve(this.findMutationBatch(e))},sE.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Em(null!=n,"Failed to find local mutation batch."),wg.resolve(n.keys())},sE.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return wg.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},sE.prototype.getHighestUnacknowledgedBatchId=function(){return wg.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},sE.prototype.getAllMutationBatches=function(t){return wg.resolve(this.mutationQueue.slice())},sE.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new eE(n,0),i=new eE(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Em(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Em(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),wg.resolve(o)},sE.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new eg(nv);return e.forEach(function(e){var t=new eE(e,0),n=new eE(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Em(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),wg.resolve(this.findMutationBatches(i))},sE.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Em(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Cv.isDocumentKey(i)||(i=i.child(""));var o=new eE(new Cv(i),0),a=new eg(nv);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),wg.resolve(this.findMutationBatches(a))},sE.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},sE.prototype.removeMutationBatch=function(n,r){var i=this;Em(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return wg.forEach(r.mutations,function(t){var e=new eE(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},sE.prototype.removeCachedMutationKeys=function(t){},sE.prototype.containsKey=function(t,e){var n=new eE(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return wg.resolve(e.isEqual(r&&r.key))},sE.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Em(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),wg.resolve()},sE.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Em(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},sE.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},sE.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Em(n.batchId===t,"If found batch must match"),n},sE);function sE(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Im(),this.batchesByDocumentKey=new eg(eE.compareByKey)}var uE=(cE.prototype.getTargetCount=function(t){return wg.resolve(this.targetCount)},cE.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),wg.resolve()},cE.prototype.getLastRemoteSnapshotVersion=function(t){return wg.resolve(this.lastRemoteSnapshotVersion)},cE.prototype.getHighestSequenceNumber=function(t){return wg.resolve(this.highestSequenceNumber)},cE.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,wg.resolve(e)},cE.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),wg.resolve()},cE.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},cE.prototype.addQueryData=function(t,e){return Em(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,wg.resolve()},cE.prototype.updateQueryData=function(t,e){return Em(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),wg.resolve()},cE.prototype.removeQueryData=function(t,e){return Em(0<this.targetCount,"Removing a target from an empty cache"),Em(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,wg.resolve()},cE.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),wg.waitFor(s).next(function(){return a})},cE.prototype.getQueryCount=function(t){return wg.resolve(this.targetCount)},cE.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return wg.resolve(n)},cE.prototype.getQueryDataForTarget=function(t,e){return _m("Not yet implemented.")},cE.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),wg.waitFor(i)},cE.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),wg.waitFor(i)},cE.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),wg.resolve()},cE.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return wg.resolve(n)},cE.prototype.containsKey=function(t,e){return wg.resolve(this.references.containsKey(e))},cE);function cE(t){this.persistence=t,this.queries=new Cw(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Qv.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Z_,this.targetCount=0,this.targetIdGenerator=Og.forQueryCache()}var hE,lE=(fE.prototype.addEntry=function(t,e,n){Em(!n.isEqual(Qv.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.newDocumentChanges=this.newDocumentChanges.add(r),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},fE.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.newDocumentChanges=this.newDocumentChanges.add(t),this.docs=this.docs.remove(t),this.size-=e.size)},fE.prototype.getEntry=function(t,e){var n=this.docs.get(e);return wg.resolve(n?n.maybeDocument:null)},fE.prototype.getEntries=function(t,e){var n=this,r=sg();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),wg.resolve(r)},fE.prototype.getDocumentsMatchingQuery=function(t,e,n){Em(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=cg(),i=new Cv(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof gw&&e.matches(c)&&(r=r.insert(c.key,c))}return wg.resolve(r)},fE.prototype.forEachDocumentKey=function(t,e){return wg.forEach(this.docs,function(t){return e(t)})},fE.prototype.getNewDocumentChanges=function(t){var r=this,i=ag();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new _w(t,Qv.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=pg(),wg.resolve(i)},fE.prototype.newChangeBuffer=function(t){return new fE.RemoteDocumentChangeBuffer(this)},fE.prototype.getSize=function(t){return wg.resolve(this.size)},fE.RemoteDocumentChangeBuffer=(Yo(pE,hE=Aw),pE.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e,r.readTime)):r.documentCache.removeEntry(t)}),wg.waitFor(i)},pE.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},pE.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},pE),fE);function fE(t,e){this.indexManager=t,this.sizer=e,this.docs=new Gv(Cv.comparator),this.newDocumentChanges=pg(),this.size=0}function pE(t){var e=hE.call(this)||this;return e.documentCache=t,e}var dE=(yE.createLruPersistence=function(t,e,n){return new yE(t,function(t){return new bE(t,new I_(e),n)})},yE.createEagerPersistence=function(t){return new yE(t,function(t){return new vE(t)})},yE.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(yE.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),yE.prototype.getActiveClients=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return[2,[this.clientId]]})})},yE.prototype.setPrimaryStateListener=function(t){return t(!0)},yE.prototype.setDatabaseDeletedListener=function(){},yE.prototype.setNetworkEnabled=function(t){},yE.prototype.getIndexManager=function(){return this.indexManager},yE.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new aE(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},yE.prototype.getQueryCache=function(){return this.queryCache},yE.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},yE.prototype.runTransaction=function(t,e,n){var r=this;gm("MemoryPersistence","Starting transaction:",t);var i=new mE(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},yE.prototype.mutationQueuesContainKey=function(e,n){return wg.or(function(t){var n=[];return Mm(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},yE);function yE(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new dv(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new uE(this);this.indexManager=new Uw,this.remoteDocumentCache=new lE(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var mE=function(t){this.currentSequenceNumber=t},vE=(Object.defineProperty(gE.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw _m("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),gE.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},gE.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),wg.resolve()},gE.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),wg.resolve()},gE.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),wg.resolve()},gE.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},gE.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},gE.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wg.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},gE.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},gE.prototype.documentSize=function(t){return 0},gE.prototype.isReferenced=function(t,e){var n=this;return wg.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return wg.resolve(n.inMemoryPins.containsKey(e))}])},gE);function gE(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var bE=(wE.prototype.onTransactionStarted=function(){},wE.prototype.onTransactionCommitted=function(t){return wg.resolve()},wE.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},wE.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},wE.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},wE.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return wg.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?wg.resolve():r(e)})})},wE.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},wE.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},wE.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},wE.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),wg.resolve()},wE.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getQueryCache().updateQueryData(t,n)},wE.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),wg.resolve()},wE.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),wg.resolve()},wE.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),wg.resolve()},wE.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw _m("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},wE.prototype.isPinned=function(t,e,n){var r=this;return wg.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return wg.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return wg.resolve(void 0!==t&&n<t)}])},wE.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},wE);function wE(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Cw(function(t){return qv(t.path)}),this.garbageCollector=new x_(this,n)}var _E=(EE.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},EE.prototype.getDocumentsMatchingQuery=function(t,e,n,r){return Em(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),this.localDocumentsView.getDocumentsMatchingQuery(t,e,Qv.MIN)},EE);function EE(){}var TE=Number,SE=TE.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),IE=TE.MAX_SAFE_INTEGER||Math.pow(2,53)-1,CE=TE.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function NE(t){return null==t}function AE(t){return CE(t)&&t<=IE&&SE<=t}var kE=(DE.prototype.reset=function(){this.currentBaseMs=0},DE.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},DE.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&gm("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},DE.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},DE.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},DE);function DE(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var RE,OE,PE="PersistentStream";(OE=RE=RE||{})[OE.Initial=0]="Initial",OE[OE.Starting=1]="Starting",OE[OE.Open=2]="Open",OE[OE.Error=3]="Error",OE[OE.Backoff=4]="Backoff";var ME=(xE.prototype.isStarted=function(){return this.state===RE.Starting||this.state===RE.Open||this.state===RE.Backoff},xE.prototype.isOpen=function(){return this.state===RE.Open},xE.prototype.start=function(){this.state!==RE.Error?(Em(this.state===RE.Initial,"Already started"),this.auth()):this.performBackoff()},xE.prototype.stop=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(RE.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},xE.prototype.inhibitBackoff=function(){Em(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=RE.Initial,this.backoff.reset()},xE.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},xE.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},xE.prototype.handleIdleCloseTimer=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return this.isOpen()?[2,this.close(RE.Initial)]:[2]})})},xE.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},xE.prototype.close=function(e,n){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return Em(this.isStarted(),"Only started streams should be closed."),Em(e===RE.Error||NE(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==RE.Error?this.backoff.reset():n&&n.code===Nm.RESOURCE_EXHAUSTED?(bm(n.toString()),bm("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Nm.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},xE.prototype.tearDown=function(){},xE.prototype.auth=function(){var n=this;Em(this.state===RE.Initial,"Must be in initial state to auth"),this.state=RE.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Am(Nm.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},xE.prototype.startStream=function(t){var e=this;Em(this.state===RE.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Em(e.state===RE.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=RE.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},xE.prototype.performBackoff=function(){var t=this;Em(this.state===RE.Error,"Should only perform backoff when in Error state"),this.state=RE.Backoff,this.backoff.backoffAndRun(function(){return Jo(t,void 0,void 0,function(){return $o(this,function(t){return Em(this.state===RE.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=RE.Initial,this.start(),Em(this.isStarted(),"PersistentStream should have started"),[2]})})})},xE.prototype.handleStreamClose=function(t){return Em(this.isStarted(),"Can't handle server close on non-started stream"),gm(PE,"close with error: "+t),this.stream=null,this.close(RE.Error,t)},xE.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(gm(PE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},xE);function xE(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=RE.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new kE(t,e)}var LE,FE=(Yo(UE,LE=ME),UE.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},UE.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},UE.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},UE.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},UE);function UE(t,e,n,r,i){var o=LE.call(this,t,Av.ListenStreamConnectionBackoff,Av.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var qE,VE=(Yo(BE,qE=ME),Object.defineProperty(BE.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),BE.prototype.start=function(){this.handshakeComplete_=!1,qE.prototype.start.call(this)},BE.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},BE.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},BE.prototype.onMessage=function(t){if(Em(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Em(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},BE.prototype.writeHandshake=function(){Em(this.isOpen(),"Writing handshake requires an opened stream"),Em(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},BE.prototype.writeMutations=function(t){var e=this;Em(this.isOpen(),"Writing mutations requires an opened stream"),Em(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Em(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},BE);function BE(t,e,n,r,i){var o=qE.call(this,t,Av.WriteStreamConnectionBackoff,Av.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Im(),o}var jE=(WE.prototype.newPersistentWriteStream=function(t){return new VE(this.queue,this.connection,this.credentials,this.serializer,t)},WE.prototype.newPersistentWatchStream=function(t){return new FE(this.queue,this.connection,this.credentials,this.serializer,t)},WE.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},WE.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=ag();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Em(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},WE.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Nm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},WE.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Nm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},WE);function WE(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var KE,QE,HE,GE,zE=(YE.prototype.lookup=function(r){return Jo(this,void 0,void 0,function(){var e,n=this;return $o(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Am(Nm.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof _w||t instanceof gw?n.recordVersion(t):_m("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},YE.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},YE.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},YE.prototype.delete=function(t){this.write([new Tb(t,this.precondition(t))]),this.writtenDocs.add(t)},YE.prototype.commit=function(){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Am(Nm.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},YE.prototype.recordVersion=function(t){var e;if(t instanceof gw)e=t.version;else{if(!(t instanceof _w))throw _m("Document in a transaction was a "+t.constructor.name);e=Qv.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Am(Nm.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},YE.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?ob.updateTime(e):ob.NONE},YE.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return ob.exists(!0);if(e.isEqual(Qv.forDeletedDoc()))throw new Am(Nm.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ob.updateTime(e)},YE.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},YE.prototype.ensureCommitNotCalled=function(){Em(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},YE);function YE(t){this.datastore=t,this.readVersions=lg(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(QE=KE=KE||{})[QE.Unknown=0]="Unknown",QE[QE.Online=1]="Online",QE[QE.Offline=2]="Offline",(GE=HE=HE||{})[GE.RemoteStore=0]="RemoteStore",GE[GE.SharedClientState=1]="SharedClientState";var XE,JE,$E=(ZE.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(KE.Unknown),Em(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Av.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Em(t.state===KE.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(KE.Offline),Promise.resolve()}))},ZE.prototype.handleWatchStreamFailure=function(t){this.state===KE.Online?(this.setAndBroadcast(KE.Unknown),Em(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Em(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(KE.Offline)))},ZE.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===KE.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},ZE.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},ZE.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(bm(e),this.shouldWarnClientIsOffline=!1):gm("OnlineStateTracker",e)},ZE.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},ZE);function ZE(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=KE.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function tT(t){switch(t){case Nm.OK:return _m("Treated status OK as error");case Nm.CANCELLED:case Nm.UNKNOWN:case Nm.DEADLINE_EXCEEDED:case Nm.RESOURCE_EXHAUSTED:case Nm.INTERNAL:case Nm.UNAVAILABLE:case Nm.UNAUTHENTICATED:return!1;case Nm.INVALID_ARGUMENT:case Nm.NOT_FOUND:case Nm.ALREADY_EXISTS:case Nm.PERMISSION_DENIED:case Nm.FAILED_PRECONDITION:case Nm.ABORTED:case Nm.OUT_OF_RANGE:case Nm.UNIMPLEMENTED:case Nm.DATA_LOSS:return!0;default:return _m("Unknown status code: "+t)}}function eT(t){if(void 0===t)return bm("GRPC error has no .code"),Nm.UNKNOWN;switch(t){case XE.OK:return Nm.OK;case XE.CANCELLED:return Nm.CANCELLED;case XE.UNKNOWN:return Nm.UNKNOWN;case XE.DEADLINE_EXCEEDED:return Nm.DEADLINE_EXCEEDED;case XE.RESOURCE_EXHAUSTED:return Nm.RESOURCE_EXHAUSTED;case XE.INTERNAL:return Nm.INTERNAL;case XE.UNAVAILABLE:return Nm.UNAVAILABLE;case XE.UNAUTHENTICATED:return Nm.UNAUTHENTICATED;case XE.INVALID_ARGUMENT:return Nm.INVALID_ARGUMENT;case XE.NOT_FOUND:return Nm.NOT_FOUND;case XE.ALREADY_EXISTS:return Nm.ALREADY_EXISTS;case XE.PERMISSION_DENIED:return Nm.PERMISSION_DENIED;case XE.FAILED_PRECONDITION:return Nm.FAILED_PRECONDITION;case XE.ABORTED:return Nm.ABORTED;case XE.OUT_OF_RANGE:return Nm.OUT_OF_RANGE;case XE.UNIMPLEMENTED:return Nm.UNIMPLEMENTED;case XE.DATA_LOSS:return Nm.DATA_LOSS;default:return _m("Unknown status code: "+t)}}(JE=XE=XE||{})[JE.OK=0]="OK",JE[JE.CANCELLED=1]="CANCELLED",JE[JE.UNKNOWN=2]="UNKNOWN",JE[JE.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",JE[JE.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",JE[JE.NOT_FOUND=5]="NOT_FOUND",JE[JE.ALREADY_EXISTS=6]="ALREADY_EXISTS",JE[JE.PERMISSION_DENIED=7]="PERMISSION_DENIED",JE[JE.UNAUTHENTICATED=16]="UNAUTHENTICATED",JE[JE.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",JE[JE.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",JE[JE.ABORTED=10]="ABORTED",JE[JE.OUT_OF_RANGE=11]="OUT_OF_RANGE",JE[JE.UNIMPLEMENTED=12]="UNIMPLEMENTED",JE[JE.INTERNAL=13]="INTERNAL",JE[JE.UNAVAILABLE=14]="UNAVAILABLE",JE[JE.DATA_LOSS=15]="DATA_LOSS";var nT,rT,iT,oT,aT=(sT.emptySet=function(t){return new sT(t.comparator)},sT.prototype.has=function(t){return null!=this.keyedMap.get(t)},sT.prototype.get=function(t){return this.keyedMap.get(t)},sT.prototype.first=function(){return this.sortedSet.minKey()},sT.prototype.last=function(){return this.sortedSet.maxKey()},sT.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},sT.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(sT.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),sT.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},sT.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},sT.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},sT.prototype.isEqual=function(t){if(!(t instanceof sT))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},sT.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},sT.prototype.copy=function(t,e){var n=new sT;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},sT);function sT(n){this.comparator=n?function(t,e){return n(t,e)||Cv.comparator(t.key,e.key)}:function(t,e){return Cv.comparator(t.key,e.key)},this.keyedMap=cg(),this.sortedSet=new Gv(this.comparator)}(rT=nT=nT||{})[rT.Added=0]="Added",rT[rT.Removed=1]="Removed",rT[rT.Modified=2]="Modified",rT[rT.Metadata=3]="Metadata",(oT=iT=iT||{})[oT.Local=0]="Local",oT[oT.Synced=1]="Synced";var uT=(cT.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==nT.Added&&n.type===nT.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===nT.Metadata&&n.type!==nT.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===nT.Modified&&n.type===nT.Modified?this.changeMap=this.changeMap.insert(e,{type:nT.Modified,doc:t.doc}):t.type===nT.Modified&&n.type===nT.Added?this.changeMap=this.changeMap.insert(e,{type:nT.Added,doc:t.doc}):t.type===nT.Removed&&n.type===nT.Added?this.changeMap=this.changeMap.remove(e):t.type===nT.Removed&&n.type===nT.Modified?this.changeMap=this.changeMap.insert(e,{type:nT.Removed,doc:n.doc}):t.type===nT.Added&&n.type===nT.Removed?this.changeMap=this.changeMap.insert(e,{type:nT.Modified,doc:t.doc}):_m("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},cT.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},cT);function cT(){this.changeMap=new Gv(Cv.comparator)}var hT=(lT.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:nT.Added,doc:t})}),new lT(t,e,aT.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(lT.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),lT.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},lT);function lT(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var fT=(pT.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=dT.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new pT(Qv.MIN,r,yg(),ag(),pg())},pT);function pT(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var dT=(yT.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new yT(Im(),e,pg(),pg(),pg())},yT);function yT(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var mT,vT,gT=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},bT=function(t,e){this.targetId=t,this.existenceFilter=e};(vT=mT=mT||{})[vT.NoChange=0]="NoChange",vT[vT.Added=1]="Added",vT[vT.Removed=2]="Removed",vT[vT.Current=3]="Current",vT[vT.Reset=4]="Reset";var wT=function(t,e,n,r){void 0===n&&(n=Im()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},_T=(Object.defineProperty(ET.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(ET.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(ET.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(ET.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),ET.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},ET.prototype.toTargetChange=function(){var n=pg(),r=pg(),i=pg();return this.documentChanges.forEach(function(t,e){switch(e){case nT.Added:n=n.add(t);break;case nT.Modified:r=r.add(t);break;case nT.Removed:i=i.add(t);break;default:_m("Encountered invalid change type: "+e)}}),new dT(this._resumeToken,this._current,n,r,i)},ET.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=CT()},ET.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},ET.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},ET.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},ET.prototype.recordTargetResponse=function(){this.pendingResponses-=1},ET.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},ET);function ET(){this.pendingResponses=0,this.documentChanges=CT(),this._resumeToken=Im(),this._current=!1,this._hasPendingChanges=!0}var TT=(ST.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof gw?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof _w&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},ST.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case mT.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case mT.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case mT.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Em(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case mT.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case mT.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:_m("Unknown target watch change state: "+n.state)}})},ST.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Pm(this.targetStates,e)},ST.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Cv(i.path);this.removeDocumentFromTarget(e,o,new _w(o,Qv.forDeletedDoc()))}else Em(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},ST.prototype.createRemoteEvent=function(i){var o=this,a={};Pm(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new Cv(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new _w(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=pg();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===v_.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new fT(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=ag(),this.pendingDocumentTargetMapping=IT(),this.pendingTargetResets=new eg(nv),t},ST.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?nT.Modified:nT.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},ST.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,nT.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},ST.prototype.removeTarget=function(t){delete this.targetStates[t]},ST.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},ST.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},ST.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new _T),this.targetStates[t]},ST.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new eg(nv),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},ST.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||gm("WatchChangeAggregator","Detected inactive target",t),e},ST.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},ST.prototype.resetTarget=function(e){var n=this;Em(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new _T,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},ST.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},ST);function ST(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=ag(),this.pendingDocumentTargetMapping=IT(),this.pendingTargetResets=new eg(nv)}function IT(){return new Gv(Cv.comparator)}function CT(){return new Gv(Cv.comparator)}var NT="RemoteStore",AT=(kT.prototype.start=function(){return this.enableNetwork()},kT.prototype.enableNetwork=function(){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(KE.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},kT.prototype.disableNetwork=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(KE.Offline),[2]}})})},kT.prototype.disableNetworkInternal=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(gm(NT,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},kT.prototype.shutdown=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return gm(NT,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(KE.Unknown),[2]}})})},kT.prototype.listen=function(t){Em(!Rm(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},kT.prototype.unlisten=function(t){Em(Rm(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),xm(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(KE.Unknown))},kT.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},kT.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},kT.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},kT.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},kT.prototype.startWatchStream=function(){Em(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new TT(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},kT.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!xm(this.listenTargets)},kT.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},kT.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},kT.prototype.onWatchStreamOpen=function(){return Jo(this,void 0,void 0,function(){var n=this;return $o(this,function(t){return Pm(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},kT.prototype.onWatchStreamClose=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return void 0===e&&Em(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(KE.Unknown),[2]})})},kT.prototype.onWatchStreamChange=function(n,r){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(KE.Online),n instanceof wT&&n.state===mT.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof gT?this.watchChangeAggregator.handleDocumentChange(n):n instanceof bT?this.watchChangeAggregator.handleExistenceFilter(n):(Em(n instanceof wT,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(Qv.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},kT.prototype.raiseWatchSnapshot=function(r){var i=this;Em(!r.isEqual(Qv.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Pm(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(Im(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new T_(e.query,t,v_.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},kT.prototype.handleTargetError=function(t){var n=this;Em(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return Jo(n,void 0,void 0,function(){return $o(this,function(t){return Rm(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},kT.prototype.fillWritePipeline=function(){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},kT.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},kT.prototype.outstandingWrites=function(){return this.writePipeline.length},kT.prototype.addToWritePipeline=function(t){Em(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},kT.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},kT.prototype.startWriteStream=function(){Em(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},kT.prototype.onWriteStreamOpen=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return this.writeStream.writeHandshake(),[2]})})},kT.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(Q_)},kT.prototype.onMutationResult=function(t,e){var n=this;Em(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=gg.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},kT.prototype.onWriteStreamClose=function(n){return Jo(this,void 0,void 0,function(){var e=this;return $o(this,function(t){return void 0===n&&Em(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},kT.prototype.handleHandshakeError=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return tT(e.code)?(gm(NT,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Im(),[2,this.localStore.setLastStreamToken(Im()).catch(Q_)]):[2]})})},kT.prototype.handleWriteError=function(r){return Jo(this,void 0,void 0,function(){var e,n=this;return $o(this,function(t){return function(t){return tT(t)&&t!==Nm.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},kT.prototype.createTransaction=function(){return new zE(this.datastore)},kT.prototype.restartNetwork=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(KE.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},kT.prototype.handleCredentialChange=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(gm(NT,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},kT.prototype.applyPrimaryState=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(KE.Unknown),t.label=4;case 4:return[2]}})})},kT);function kT(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return Jo(o,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(gm(NT,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new $E(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var DT=(Object.defineProperty(RT.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(RT.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),RT.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},RT.prototype._compareTo=function(t){return nv(this._lat,t._lat)||nv(this._long,t._long)},RT);function RT(t,e){if(Fm("GeoPoint",arguments,2),Vm("GeoPoint","number",1,t),Vm("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Am(Nm.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Am(Nm.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var OT=(PT.atPath=function(t){return new PT(t)},Object.defineProperty(PT.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[sS]:this.memoizedOrderBy=[new oS(t),sS];else{Em(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:eS.ASCENDING;this.memoizedOrderBy.push(a===eS.ASCENDING?sS:uS)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),PT.prototype.addFilter=function(t){Em(null==this.getInequalityFilterField()||!(t instanceof UT)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Em(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new PT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},PT.prototype.addOrderBy=function(t){Em(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new PT(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},PT.prototype.withLimit=function(t){return new PT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},PT.prototype.withStartAt=function(t){return new PT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},PT.prototype.withEndAt=function(t){return new PT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},PT.prototype.asCollectionQueryAtPath=function(t){return new PT(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},PT.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},PT.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";NE(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},PT.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),NE(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},PT.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},PT.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Em(n,"orderBy used that doesn't compare on key field"),0},PT.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},PT.prototype.hasLimit=function(){return!NE(this.limit)},PT.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},PT.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof UT&&n.isInequality())return n.field}return null},PT.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof UT&&0<=t.indexOf(r.op))return r.op}return null},PT.prototype.isDocumentQuery=function(){return Cv.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},PT.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},PT.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Cv.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},PT.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},PT.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},PT.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},PT.prototype.assertValidBound=function(t){Em(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},PT);function PT(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function MT(){}var xT=(LT.fromString=function(t){switch(t){case"<":return LT.LESS_THAN;case"<=":return LT.LESS_THAN_OR_EQUAL;case"==":return LT.EQUAL;case">=":return LT.GREATER_THAN_OR_EQUAL;case">":return LT.GREATER_THAN;case"array-contains":return LT.ARRAY_CONTAINS;case"in":return LT.IN;case"array-contains-any":return LT.ARRAY_CONTAINS_ANY;default:return _m("Unknown FieldFilter operator: "+t)}},LT.prototype.toString=function(){return this.name},LT.prototype.isEqual=function(t){return this.name===t.name},LT.LESS_THAN=new LT("<"),LT.LESS_THAN_OR_EQUAL=new LT("<="),LT.EQUAL=new LT("=="),LT.GREATER_THAN=new LT(">"),LT.GREATER_THAN_OR_EQUAL=new LT(">="),LT.ARRAY_CONTAINS=new LT("array-contains"),LT.IN=new LT("in"),LT.ARRAY_CONTAINS_ANY=new LT("array-contains-any"),LT);function LT(t){this.name=t}var FT,UT=(Yo(qT,FT=MT),qT.create=function(t,e,n){if(t.isKeyField())return e===xT.IN?(Em(n instanceof pw,"Comparing on key with IN, but filter value not an ArrayValue"),Em(n.internalValue.every(function(t){return t instanceof iw}),"Comparing on key with IN, but an array value was not a RefValue"),new KT(t,n)):(Em(n instanceof iw,"Comparing on key, but filter value not a RefValue"),Em(e!==xT.ARRAY_CONTAINS&&e!==xT.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new BT(t,e,n));if(n.isEqual(Db.INSTANCE)){if(e!==xT.EQUAL)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new qT(t,e,n)}if(n.isEqual(Wb.NAN)){if(e!==xT.EQUAL)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new qT(t,e,n)}return e===xT.ARRAY_CONTAINS?new GT(t,n):e===xT.IN?(Em(n instanceof pw,"IN filter has invalid value: "+n.toString()),new XT(t,n)):e===xT.ARRAY_CONTAINS_ANY?(Em(n instanceof pw,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new ZT(t,n)):new qT(t,e,n)},qT.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},qT.prototype.matchesComparison=function(t){switch(this.op){case xT.LESS_THAN:return t<0;case xT.LESS_THAN_OR_EQUAL:return t<=0;case xT.EQUAL:return 0===t;case xT.GREATER_THAN:return 0<t;case xT.GREATER_THAN_OR_EQUAL:return 0<=t;default:return _m("Unknown FieldFilter operator: "+this.op)}},qT.prototype.isInequality=function(){return 0<=[xT.LESS_THAN,xT.LESS_THAN_OR_EQUAL,xT.GREATER_THAN,xT.GREATER_THAN_OR_EQUAL].indexOf(this.op)},qT.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},qT.prototype.isEqual=function(t){return t instanceof qT&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},qT.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},qT);function qT(t,e,n){var r=FT.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var VT,BT=(Yo(jT,VT=UT),jT.prototype.matches=function(t){var e=this.value,n=Cv.comparator(t.key,e.key);return this.matchesComparison(n)},jT);function jT(){return null!==VT&&VT.apply(this,arguments)||this}var WT,KT=(Yo(QT,WT=UT),QT.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},QT);function QT(t,e){var n=WT.call(this,t,xT.IN,e)||this;return n.value=e,n}var HT,GT=(Yo(zT,HT=UT),zT.prototype.matches=function(t){var e=t.field(this.field);return e instanceof pw&&e.contains(this.value)},zT);function zT(t,e){return HT.call(this,t,xT.ARRAY_CONTAINS,e)||this}var YT,XT=(Yo(JT,YT=UT),JT.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},JT);function JT(t,e){var n=YT.call(this,t,xT.IN,e)||this;return n.value=e,n}var $T,ZT=(Yo(tS,$T=UT),tS.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof pw&&n.internalValue.some(function(t){return e.value.contains(t)})},tS);function tS(t,e){var n=$T.call(this,t,xT.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var eS=(nS.prototype.toString=function(){return this.name},nS.ASCENDING=new nS("asc"),nS.DESCENDING=new nS("desc"),nS);function nS(t){this.name=t}var rS=(iS.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},iS.prototype.sortsBeforeDocument=function(t,e){Em(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Em(o instanceof iw,"Bound has a non-key value where the key path is being used."),n=Cv.comparator(o.key,e.key);else{var a=e.field(i.field);Em(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===eS.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},iS.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},iS);function iS(t,e){this.position=t,this.before=e}var oS=(aS.prototype.compare=function(t,e){var n=this.isKeyOrderBy?gw.compareByKey(t,e):gw.compareByField(this.field,t,e);switch(this.dir){case eS.ASCENDING:return n;case eS.DESCENDING:return-1*n;default:return _m("Unknown direction: "+this.dir)}},aS.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},aS.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},aS.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},aS);function aS(t,e){this.field=t,void 0===e&&(e=eS.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var sS=new oS(Sv.keyField(),eS.ASCENDING),uS=new oS(Sv.keyField(),eS.DESCENDING),cS=(hS.prototype.applyToLocalView=function(t,e){return new $b(e,t)},hS.prototype.applyToRemoteDocument=function(t,e){return e},hS.prototype.computeBaseValue=function(t){return null},hS.prototype.isEqual=function(t){return t instanceof hS},hS.instance=new hS,hS);function hS(){}var lS=(fS.prototype.applyToLocalView=function(t,e){return this.apply(t)},fS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},fS.prototype.apply=function(t){for(var n=vS(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new pw(n)},fS.prototype.computeBaseValue=function(t){return null},fS.prototype.isEqual=function(t){return t instanceof fS&&rv(t.elements,this.elements)},fS);function fS(t){this.elements=t}var pS=(dS.prototype.applyToLocalView=function(t,e){return this.apply(t)},dS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},dS.prototype.apply=function(t){for(var n=vS(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new pw(n)},dS.prototype.computeBaseValue=function(t){return null},dS.prototype.isEqual=function(t){return t instanceof dS&&rv(t.elements,this.elements)},dS);function dS(t){this.elements=t}var yS=(mS.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Vb&&this.operand instanceof Vb){var r=n.internalValue+this.operand.internalValue;return new Vb(r)}return r=n.internalValue+this.operand.internalValue,new Wb(r)},mS.prototype.applyToRemoteDocument=function(t,e){return Em(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},mS.prototype.computeBaseValue=function(t){return t instanceof Lb?t:new Vb(0)},mS.prototype.isEqual=function(t){return t instanceof mS&&this.operand.isEqual(t.operand)},mS);function mS(t){this.operand=t}function vS(t){return t instanceof pw?t.internalValue.slice():[]}var gS=(bS.prototype.isEqual=function(t){return t&&t.count===this.count},bS);function bS(t){this.count=t}var wS,_S,ES=((wS={})[eS.ASCENDING.name]="ASCENDING",wS[eS.DESCENDING.name]="DESCENDING",wS),TS=((_S={})[xT.LESS_THAN.name]="LESS_THAN",_S[xT.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",_S[xT.GREATER_THAN.name]="GREATER_THAN",_S[xT.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",_S[xT.EQUAL.name]="EQUAL",_S[xT.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",_S[xT.IN.name]="IN",_S[xT.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",_S),SS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function IS(t,e){Em(!NE(t),e+" is missing")}function CS(t){return"number"==typeof t?t:"string"==typeof t?Number(t):_m("can't parse "+t)}var NS=(AS.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},AS.prototype.unsafeCastProtoByteString=function(t){return t},AS.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Nm.UNKNOWN:eT(t.code);return new Am(e,t.message||"")},AS.prototype.toInt32Value=function(t){return this.options.useProto3Json||NE(t)?t:{value:t}},AS.prototype.fromInt32Value=function(t){var e;return NE(e="object"==typeof t?t.value:t)?null:e},AS.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},AS.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Em(!!t,"Cannot deserialize null or undefined timestamp.");var e=CS(t.seconds||"0"),n=t.nanos||0;return new Wv(e,n)},AS.prototype.fromIso8601String=function(t){var e=0,n=SS.exec(t);if(Em(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Wv(o,e)},AS.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},AS.prototype.fromBlob=function(t){return"string"==typeof t?(Em(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),sv.fromBase64String(t)):(Em(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),sv.fromUint8Array(t))},AS.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},AS.prototype.fromVersion=function(t){return Em(!!t,"Trying to deserialize version that isn't set"),Qv.fromTimestamp(this.fromTimestamp(t))},AS.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},AS.prototype.fromResourceName=function(t){var e=wv.fromString(t);return Em(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},AS.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},AS.prototype.fromName=function(t){var e=this.fromResourceName(t);return Em(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Em(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Cv(this.extractLocalPathFromResourceName(e))},AS.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},AS.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?wv.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(AS.prototype,"encodedDatabaseId",{get:function(){return new wv(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),AS.prototype.fullyQualifiedPrefixPath=function(t){return new wv(["projects",t.projectId,"databases",t.database])},AS.prototype.extractLocalPathFromResourceName=function(t){return Em(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},AS.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},AS.prototype.toValue=function(t){if(t instanceof Db)return{nullValue:"NULL_VALUE"};if(t instanceof Pb)return{booleanValue:t.value()};if(t instanceof Vb)return{integerValue:""+t.value()};if(t instanceof Wb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Hb?{stringValue:t.value()}:t instanceof hw?{mapValue:this.toMapValue(t)}:t instanceof pw?{arrayValue:this.toArrayValue(t)}:t instanceof Yb?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof sw?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ew?{bytesValue:this.toBytes(t.value())}:t instanceof iw?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:_m("Unknown FieldValue "+JSON.stringify(t))},AS.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Db.INSTANCE;if("booleanValue"in t)return Pb.of(t.booleanValue);if("integerValue"in t)return new Vb(CS(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Wb.NAN;if("Infinity"===t.doubleValue)return Wb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Wb.NEGATIVE_INFINITY}return new Wb(t.doubleValue)}if("stringValue"in t)return new Hb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){IS(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new pw(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return IS(t.timestampValue,"timestampValue"),new Yb(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){IS(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new sw(new DT(r,i))}if("bytesValue"in t){IS(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new ew(o)}if("referenceValue"in t){IS(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new fv(a.get(1),a.get(3)),u=new Cv(this.extractLocalPathFromResourceName(a));return new iw(s,u)}return _m("Unknown Value proto "+JSON.stringify(t))},AS.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},AS.prototype.toDocument=function(t){return Em(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},AS.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new gw(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},AS.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},AS.prototype.fromFields=function(t){var n=this,e=t,r=hw.EMPTY;return Mm(e,function(t,e){r=r.set(new Sv([t]),n.fromValue(e))}),r},AS.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},AS.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},AS.prototype.fromFound=function(t){var e=this;Em(!!t.found,"Tried to deserialize a found document from a missing document."),IS(t.found.name,"doc.found.name"),IS(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new gw(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},AS.prototype.fromMissing=function(t){Em(!!t.missing,"Tried to deserialize a missing document from a found document."),Em(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new _w(e,n)},AS.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):_m("invalid batch get response: "+JSON.stringify(t))},AS.prototype.toWatchTargetChangeState=function(t){switch(t){case mT.Added:return"ADD";case mT.Current:return"CURRENT";case mT.NoChange:return"NO_CHANGE";case mT.Removed:return"REMOVE";case mT.Reset:return"RESET";default:return _m("Unknown WatchTargetChangeState: "+t)}},AS.prototype.toTestWatchChange=function(t){if(t instanceof bT)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof gT){if(t.newDoc instanceof gw){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof _w)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof wT){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return XE.OK;switch(t){case Nm.OK:return XE.OK;case Nm.CANCELLED:return XE.CANCELLED;case Nm.UNKNOWN:return XE.UNKNOWN;case Nm.DEADLINE_EXCEEDED:return XE.DEADLINE_EXCEEDED;case Nm.RESOURCE_EXHAUSTED:return XE.RESOURCE_EXHAUSTED;case Nm.INTERNAL:return XE.INTERNAL;case Nm.UNAVAILABLE:return XE.UNAVAILABLE;case Nm.UNAUTHENTICATED:return XE.UNAUTHENTICATED;case Nm.INVALID_ARGUMENT:return XE.INVALID_ARGUMENT;case Nm.NOT_FOUND:return XE.NOT_FOUND;case Nm.ALREADY_EXISTS:return XE.ALREADY_EXISTS;case Nm.PERMISSION_DENIED:return XE.PERMISSION_DENIED;case Nm.FAILED_PRECONDITION:return XE.FAILED_PRECONDITION;case Nm.ABORTED:return XE.ABORTED;case Nm.OUT_OF_RANGE:return XE.OUT_OF_RANGE;case Nm.UNIMPLEMENTED:return XE.UNIMPLEMENTED;case Nm.DATA_LOSS:return XE.DATA_LOSS;default:return _m("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return _m("Unrecognized watch change: "+JSON.stringify(t))},AS.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){IS(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new wT(r,i,o,s||null)}else if("documentChange"in t){IS(t.documentChange,"documentChange"),IS(t.documentChange.document,"documentChange.name"),IS(t.documentChange.document.name,"documentChange.document.name"),IS(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new gw(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new gT(f,p,l.key,l)}else if("documentDelete"in t){IS(t.documentDelete,"documentDelete"),IS(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):Qv.forDeletedDoc(),l=new _w(c,h),p=d.removedTargetIds||[],e=new gT([],p,l.key,l)}else if("documentRemove"in t){IS(t.documentRemove,"documentRemove"),IS(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),p=y.removedTargetIds||[],e=new gT([],p,c,null)}else{if(!("filter"in t))return _m("Unknown change type "+JSON.stringify(t));IS(t.filter,"filter"),IS(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new gS(v),b=m.targetId;e=new bT(b,g)}return e},AS.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?mT.NoChange:"ADD"===t?mT.Added:"REMOVE"===t?mT.Removed:"CURRENT"===t?mT.Current:"RESET"===t?mT.Reset:_m("Got unexpected TargetChange.state: "+t)},AS.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Qv.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Qv.MIN:e.readTime?this.fromVersion(e.readTime):Qv.MIN},AS.prototype.toMutation=function(t){var e,n=this;if(t instanceof hb)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Tb)e={delete:this.toName(t.key)};else if(t instanceof pb)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof mb))return _m("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},AS.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):ob.NONE;if(t.update){IS(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new pb(r,i,o,n)}return new hb(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Tb(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Em(!0===n.exists,'Transforms only support precondition "exists == true"'),new mb(r,a)}return _m("unknown mutation proto: "+JSON.stringify(t))},AS.prototype.toPrecondition=function(t){return Em(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:_m("Unknown precondition")},AS.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?ob.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ob.exists(t.exists):ob.NONE},AS.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Qv.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new ib(r,i)},AS.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Em(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},AS.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof cS)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof lS)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof pS)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof yS)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw _m("Unknown transform: "+t.transform)},AS.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Em("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=cS.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new lS(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new pS(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Em(i instanceof Lb,"NUMERIC_ADD transform requires a NumberValue"),n=new yS(i)}else _m("Unknown transform proto: "+JSON.stringify(t));var o=Sv.fromServerFormat(t.fieldPath);return new tb(o,n)},AS.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},AS.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Em(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return OT.atPath(this.fromQueryPath(n))},AS.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Em(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Em(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},AS.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Em(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new OT(e,i,s,a,u,c,h)},AS.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},AS.prototype.toLabel=function(t){switch(t){case v_.Listen:return null;case v_.ExistenceFilterMismatch:return"existence-filter-mismatch";case v_.LimboResolution:return"limbo-document";default:return _m("Unrecognized query purpose: "+t)}},AS.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},AS.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof UT?e.toUnaryOrFieldFilter(t):_m("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},AS.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):_m("Unknown filter: "+JSON.stringify(t)):[]},AS.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},AS.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},AS.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},AS.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new rS(r,n)},AS.prototype.toDirection=function(t){return ES[t.name]},AS.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return eS.ASCENDING;case"DESCENDING":return eS.DESCENDING;default:return}},AS.prototype.toOperatorName=function(t){return TS[t.name]},AS.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return xT.EQUAL;case"GREATER_THAN":return xT.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return xT.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return xT.LESS_THAN;case"LESS_THAN_OR_EQUAL":return xT.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return xT.ARRAY_CONTAINS;case"IN":return xT.IN;case"ARRAY_CONTAINS_ANY":return xT.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return _m("Unspecified operator");default:return _m("Unknown operator")}},AS.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},AS.prototype.fromFieldPathReference=function(t){return Sv.fromServerFormat(t.fieldPath)},AS.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},AS.prototype.fromPropertyOrder=function(t){return new oS(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},AS.prototype.fromFieldFilter=function(t){return UT.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},AS.prototype.toUnaryOrFieldFilter=function(t){if(t.op===xT.EQUAL){if(t.value.isEqual(Wb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Db.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},AS.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return UT.create(e,xT.EQUAL,Wb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return UT.create(n,xT.EQUAL,Db.INSTANCE);case"OPERATOR_UNSPECIFIED":return _m("Unspecified filter");default:return _m("Unknown filter")}},AS.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},AS.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Sv.fromServerFormat(t)});return $g.fromArray(e)},AS);function AS(t,e){this.databaseId=t,this.options=e}var kS=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},DS=(RS.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new kS,this.queries.set(e,r)),r.listeners.push(t),Em(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},RS.prototype.unlisten=function(o){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},RS.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},RS.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},RS.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},RS.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},RS.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},RS.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},RS);function RS(t){this.syncEngine=t,this.queries=new Cw(function(t){return t.canonicalId()}),this.onlineState=KE.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var OS=(PS.prototype.onViewSnapshot=function(t){if(Em(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==nT.Metadata&&e.push(i)}t=new hT(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},PS.prototype.onError=function(t){this.queryObserver.error(t)},PS.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},PS.prototype.shouldRaiseInitialEvent=function(t,e){if(Em(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==KE.Offline;return this.options.waitForSyncWhenOnline&&n?(Em(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===KE.Offline},PS.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},PS.prototype.raiseInitialEvent=function(t){Em(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=hT.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},PS);function PS(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=KE.Unknown,this.options=n||{}}var MS=(xS.fromSnapshot=function(t,e){for(var n=pg(),r=pg(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case nT.Added:n=n.add(a.doc.key);break;case nT.Removed:r=r.add(a.doc.key)}}return new xS(t,e.fromCache,n,r)},xS);function xS(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var LS=function(t){this.key=t},FS=function(t){this.key=t},US=(Object.defineProperty(qS.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),qS.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new uT,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof gw?e:null;r&&(Em(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:nT.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:nT.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:nT.Added,doc:r}),a=!0):n&&!r&&(u.track({type:nT.Removed,doc:n}),a=!0,p&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:nT.Removed,doc:n})}return Em(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},qS.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},qS.prototype.applyChanges=function(t,e,n){var r=this;Em(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case nT.Added:return 1;case nT.Modified:case nT.Metadata:return 2;case nT.Removed:return 0;default:return _m("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?iT.Synced:iT.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new hT(this.query,t.documentSet,i,o,t.mutatedKeys,s===iT.Local,u,!1),limboChanges:a}:{limboChanges:a}},qS.prototype.applyOnlineStateChange=function(t){return this.current&&t===KE.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new uT,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},qS.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},qS.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Em(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},qS.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=pg(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new FS(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new LS(t))}),r},qS.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=pg();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},qS.prototype.computeInitialSnapshot=function(){return hT.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===iT.Local)},qS);function qS(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=pg(),this.mutatedKeys=pg(),this.documentSet=new aT(t.docComparator.bind(t))}var VS=(BS.prototype.run=function(){this.runWithBackOff()},BS.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return Jo(t,void 0,void 0,function(){var e,n,r=this;return $o(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},BS.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!NE(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},BS.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},BS.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!tT(e)},BS);function BS(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new kE(this.asyncQueue,Av.RetryTransaction)}var jS="SyncEngine",WS=function(t,e,n){this.query=t,this.targetId=e,this.view=n},KS=function(t){this.key=t,this.receivedDocument=!1},QS=(Object.defineProperty(HS.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),HS.prototype.subscribe=function(t){Em(null!==t,"SyncEngine listener cannot be null"),Em(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},HS.prototype.listen=function(a){return Jo(this,void 0,void 0,function(){var e,n,r,i,o;return $o(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},HS.prototype.initializeViewAndComputeSnapshot=function(u,c){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s;return $o(this,function(t){switch(t.label){case 0:return e=u.query,[4,this.localStore.executeQuery(e,!0)];case 1:return n=t.sent(),r=new US(e,n.remoteKeys),i=r.computeDocChanges(n.documents),o=dT.createSynthesizedTargetChangeForCurrentChange(u.targetId,c&&this.onlineState!==KE.Offline),Em(0===(a=r.applyChanges(i,!0===this.isPrimary,o)).limboChanges.length,"View returned limbo docs before target ack from the server."),Em(!!a.snapshot,"applyChanges for new view should always return a snapshot"),s=new WS(e,u.targetId,r),this.queryViewsByQuery.set(e,s),this.queryViewsByTarget[u.targetId]=s,[2,a.snapshot]}})})},HS.prototype.synchronizeViewAndComputeSnapshot=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return e=t.sent(),n=r.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},HS.prototype.unlisten=function(r){return Jo(this,void 0,void 0,function(){var e,n=this;return $o(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Em(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Q_)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},HS.prototype.write=function(n,r){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},HS.prototype.runTransaction=function(t,e,n){new VS(t,this.remoteStore,e,n).run()},HS.prototype.applyRemoteEvent=function(n){return Jo(this,void 0,void 0,function(){var e,r=this;return $o(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),Mm(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Em(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Em(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Em(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Q_(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},HS.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===HE.RemoteStore||!this.isPrimary&&t===HE.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Em(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},HS.prototype.rejectListen=function(u,c){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return $o(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new Gv(Cv.comparator)).insert(n,new _w(n,Qv.forDeletedDoc())),i=pg().add(n),o=new fT(Qv.MIN,{},new eg(nv),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Em(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(Q_)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},HS.prototype.applyBatchState=function(n,r,i){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(gm(jS,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):_m("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},HS.prototype.applySuccessfulWrite=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,Q_(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},HS.prototype.rejectFailedWrite=function(n,r){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,Q_(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},HS.prototype.registerPendingWritesCallback=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||gm(jS,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},HS.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},HS.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new Am(Nm.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},HS.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new Gv(nv)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},HS.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Em(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},HS.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},HS.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},HS.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof LS?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof FS?(gm(jS,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):_m("Unknown limbo change: "+JSON.stringify(i))}},HS.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){gm(jS,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=OT.atPath(e.path);this.limboResolutionsByTarget[n]=new KS(e),this.remoteStore.listen(new T_(r,n,v_.LimboResolution,dv.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},HS.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},HS.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return Jo(this,void 0,void 0,function(){var o,a,e,s=this;return $o(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(t){var e=t.documents;return i.view.computeDocChanges(e,n)}):n}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=MS.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},HS.prototype.assertSubscribed=function(t){Em(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},HS.prototype.handleCredentialChange=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},HS.prototype.applyPrimaryState=function(c){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return $o(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Pm(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},HS.prototype.resetLimboDocuments=function(){var e=this;Pm(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Gv(Cv.comparator)},HS.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(h){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return $o(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=h,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return t.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=t.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Em(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Em(!!(c=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:t.sent(),t.label=9;case 9:e.push(a),t.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},HS.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},HS.prototype.applyTargetState=function(i,o,a){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:if(this.isPrimary)return gm(jS,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[i])return[3,7];switch(o){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=fT.createSynthesizedRemoteEventForCurrentChange(i,"current"===o),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,7];case 4:return r=this.queryViewsByTarget[i],this.removeAndCleanupQuery(r),[4,this.localStore.releaseQuery(r.query,!0)];case 5:return t.sent(),this.syncEngineListener.onWatchError(r.query,a),[3,7];case 6:_m("Unexpected target state: "+o),t.label=7;case 7:return[2]}})})},HS.prototype.applyActiveTargetsChange=function(l,f){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return $o(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Em(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return Em(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return $o(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(Q_)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},HS.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},HS.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},HS.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?pg().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:pg()},HS);function HS(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Cw(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Gv(Cv.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Z_,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Og.forSyncEngine(),this.isPrimary=void 0,this.onlineState=KE.Unknown}var GS=(zS.prototype.isAuthenticated=function(){return null!=this.uid},zS.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},zS.prototype.isEqual=function(t){return t.uid===this.uid},zS.UNAUTHENTICATED=new zS(null),zS.GOOGLE_CREDENTIALS=new zS("google-credentials-uid"),zS.FIRST_PARTY=new zS("first-party-uid"),zS);function zS(t){this.uid=t}var YS="SharedClientState",XS="firestore_clients",JS="firestore_mutations",$S="firestore_targets",ZS=(tI.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Am(r.error.code,r.error.message)),i?new tI(t,e,r.state,o):(bm(YS,"Failed to parse mutation state for ID '"+e+"': "+n),null)},tI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},tI);function tI(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Em(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var eI=(nI.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Am(n.error.code,n.error.message)),r?new nI(t,n.state,i):(bm(YS,"Failed to parse target state for ID '"+t+"': "+e),null)},nI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},nI);function nI(t,e,n){this.targetId=t,this.state=e,Em(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var rI=(iI.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=yg(),o=0;r&&o<n.activeTargetIds.length;++o)r=AE(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new iI(t,i):(bm(YS,"Failed to parse client data for instance '"+t+"': "+e),null)},iI);function iI(t,e){this.clientId=t,this.activeTargetIds=e}var oI=(aI.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in KE&&"string"==typeof e.clientId?new aI(e.clientId,KE[e.onlineState]):(bm(YS,"Failed to parse online state: "+t),null)},aI);function aI(t,e){this.clientId=t,this.onlineState=e}var sI=(uI.prototype.addQueryTarget=function(t){Em(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},uI.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},uI.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},uI);function uI(){this.activeTargetIds=yg()}var cI=(hI.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},hI.prototype.start=function(){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return $o(this,function(t){switch(t.label){case 0:return Em(!this.started,"WebStorageSharedClientState already started"),Em(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Em(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=rI.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},hI.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},hI.prototype.getAllActiveQueryTargets=function(){var n=yg();return Mm(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},hI.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},hI.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},hI.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},hI.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=eI.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},hI.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},hI.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},hI.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},hI.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},hI.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},hI.prototype.setOnlineState=function(t){this.persistOnlineState(t)},hI.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},hI.prototype.getItem=function(t){var e=this.storage.getItem(t);return gm(YS,"READ",t,e),e},hI.prototype.setItem=function(t,e){gm(YS,"SET",t,e),this.storage.setItem(t,e)},hI.prototype.removeItem=function(t){gm(YS,"REMOVE",t),this.storage.removeItem(t)},hI.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(gm(YS,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void bm("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Jo(t,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Em(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=dv.INVALID;if(null!=t)try{var n=JSON.parse(t);Em("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){bm(YS,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==dv.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(hI.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),hI.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},hI.prototype.persistMutationState=function(t,e,n){var r=new ZS(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},hI.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},hI.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:KE[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},hI.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new eI(t,e,n);this.setItem(r,i.toWebStorageJSON())},hI.prototype.toWebStorageClientStateKey=function(t){return Em(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),XS+"_"+this.persistenceKey+"_"+t},hI.prototype.toWebStorageQueryTargetMetadataKey=function(t){return $S+"_"+this.persistenceKey+"_"+t},hI.prototype.toWebStorageMutationBatchKey=function(t){var e=JS+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},hI.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},hI.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Em(null!==n,"Cannot parse client state key '"+t+"'"),rI.fromWebStorageEntry(n,e)},hI.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Em(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ZS.fromWebStorageEntry(new GS(i),r,e)},hI.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Em(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return eI.fromWebStorageEntry(r,e)},hI.prototype.fromWebStorageOnlineState=function(t){return oI.fromWebStorageEntry(t)},hI.prototype.handleMutationBatchEvent=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return e.user.uid!==this.currentUser.uid?(gm(YS,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},hI.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},hI.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return Jo(n,void 0,void 0,function(){return $o(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return Jo(n,void 0,void 0,function(){return $o(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},hI.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},hI);function hI(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!hI.isAvailable(this.platform))throw new Am(Nm.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new sI,this.clientStateKeyRe=new RegExp("^"+XS+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+JS+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+$S+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var lI=(fI.prototype.addPendingMutation=function(t){},fI.prototype.updateMutationState=function(t,e,n){},fI.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},fI.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},fI.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},fI.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},fI.prototype.clearQueryState=function(t){delete this.queryState[t]},fI.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},fI.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},fI.prototype.start=function(){return this.localState=new sI,Promise.resolve()},fI.prototype.handleUserChange=function(t,e,n){},fI.prototype.setOnlineState=function(t){},fI.prototype.shutdown=function(){},fI.prototype.writeSequenceNumber=function(t){},fI);function fI(){this.localState=new sI,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var pI="FirestoreClient",dI=(yI.prototype.lruParams=function(){return R_.withCacheSize(this.cacheSizeBytes)},yI);function yI(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var mI=function(){},vI=(gI.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new Dv,i=new Dv,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},gI.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},gI.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof dI?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},gI.prototype.canFallback=function(t){return t instanceof Am?t.code===Nm.FAILED_PRECONDITION||t.code===Nm.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},gI.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Am(Nm.FAILED_PRECONDITION,"The client has already been terminated.")},gI.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=W_.buildStoragePrefix(this.databaseInfo),a=new NS(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Jo(t,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!cI.isAvailable(this.platform))throw new Am(Nm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new cI(this.asyncQueue,this.platform,o,this.clientId,r):new lI,[4,W_.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},gI.prototype.startMemoryPersistence=function(){return this.persistence=dE.createEagerPersistence(this.clientId),this.sharedClientState=new lI,Promise.resolve(null)},gI.prototype.initializeRest=function(c,h){var t=this;return gm(pI,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return Jo(t,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return $o(this,function(t){switch(t.label){case 0:return e=new _E,this.localStore=new iE(this.persistence,e,c),h&&(this.lruScheduler=new P_(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new jE(this.asyncQueue,u,this.credentials,r),o=function(t){return s.syncEngine.applyOnlineStateChange(t,HE.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,HE.SharedClientState)},this.remoteStore=new AT(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new QS(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new DS(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return Jo(s,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return Jo(s,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},gI.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),gm(pI,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},gI.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},gI.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return Jo(t,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},gI.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Dv;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},gI.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new OS(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},gI.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},gI.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof gw)return t;if(t instanceof _w)return null;throw new Am(Nm.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},gI.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return Jo(t,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return e=t.sent(),n=new US(i,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},gI.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Dv;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},gI.prototype.databaseId=function(){return this.databaseInfo.databaseId},gI.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},gI.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(gI.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),gI.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Dv;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},gI);function gI(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=tv.newId()}var bI=(wI.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},wI.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},wI.prototype.mute=function(){this.muted=!0},wI.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},wI);function wI(t){this.observer=t,this.muted=!1}var _I=(EI.documentId=function(){return EI._DOCUMENT_ID},EI.prototype.isEqual=function(t){if(!(t instanceof EI))throw Jm("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},EI._DOCUMENT_ID=new EI(Sv.keyField().canonicalString()),EI);function EI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Zm(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Vm("FieldPath","string",n,t[n]),0===t[n].length)throw new Am(Nm.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Sv(t)}var TI=new RegExp("[~\\*/\\[\\]]");var SI=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},II=(CI.prototype.getToken=function(){return Promise.resolve(null)},CI.prototype.invalidateToken=function(){},CI.prototype.setChangeListener=function(t){Em(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(GS.UNAUTHENTICATED)},CI.prototype.removeChangeListener=function(){Em(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},CI);function CI(){this.changeListener=null}var NI=(AI.prototype.getToken=function(){var e=this;Em(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Am(Nm.ABORTED,"getToken aborted due to token change.");return t?(Em("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new SI(t.accessToken,e.currentUser)):null})},AI.prototype.invalidateToken=function(){this.forceRefresh=!0},AI.prototype.setChangeListener=function(t){Em(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(this.currentUser)},AI.prototype.removeChangeListener=function(){Em(null!=this.tokenListener,"removeChangeListener() called twice"),Em(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},AI.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Em(null===t||"string"==typeof t,"Received invalid UID: "+t),new GS(t)},AI);function AI(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=GS.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.currentUser=this.getUser(),this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var kI=(Object.defineProperty(DI.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),DI);function DI(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=GS.FIRST_PARTY}var RI=(OI.prototype.getToken=function(){return Promise.resolve(new kI(this.gapi,this.sessionIndex))},OI.prototype.setChangeListener=function(t){t(GS.FIRST_PARTY)},OI.prototype.removeChangeListener=function(){},OI.prototype.invalidateToken=function(){},OI);function OI(t,e){this.gapi=t,this.sessionIndex=e}function PI(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var MI=(xI.delete=function(){return Lm("FieldValue.delete",arguments),FI.instance},xI.serverTimestamp=function(){return Lm("FieldValue.serverTimestamp",arguments),VI.instance},xI.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Um("FieldValue.arrayUnion",arguments,1),new WI(t)},xI.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Um("FieldValue.arrayRemove",arguments,1),new HI(t)},xI.increment=function(t){return Vm("FieldValue.increment","number",1,t),Fm("FieldValue.increment",arguments,1),new YI(t)},xI.prototype.isEqual=function(t){return this===t},xI);function xI(t){this._methodName=t}var LI,FI=(Yo(UI,LI=MI),UI.instance=new UI,UI);function UI(){return LI.call(this,"FieldValue.delete")||this}var qI,VI=(Yo(BI,qI=MI),BI.instance=new BI,BI);function BI(){return qI.call(this,"FieldValue.serverTimestamp")||this}var jI,WI=(Yo(KI,jI=MI),KI);function KI(t){var e=jI.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var QI,HI=(Yo(GI,QI=MI),GI);function GI(t){var e=QI.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var zI,YI=(Yo(XI,zI=MI),XI);function XI(t){var e=zI.call(this,"FieldValue.increment")||this;return e._operand=t,e}var JI=Dm(MI,"Use FieldValue.<field>() instead."),$I=/^__.*__$/,ZI=(tC.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new pb(t,this.data,this.fieldMask,e)):n.push(new hb(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new mb(t,this.fieldTransforms)),n},tC);function tC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var eC,nC,rC=(iC.prototype.toMutations=function(t,e){var n=[new pb(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new mb(t,this.fieldTransforms)),n},iC);function iC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function oC(t){switch(t){case eC.Set:case eC.MergeSet:case eC.Update:return!0;case eC.Argument:return!1;default:throw _m("Unexpected case for UserDataSource: "+t)}}(nC=eC=eC||{})[nC.Set=0]="Set",nC[nC.Update=1]="Update",nC[nC.MergeSet=2]="MergeSet",nC[nC.Argument=3]="Argument";var aC=(sC.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new sC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},sC.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new sC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},sC.prototype.childContextForArray=function(t){return new sC(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},sC.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Am(Nm.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},sC.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},sC.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},sC.prototype.validatePathSegment=function(t){if(oC(this.dataSource)&&$I.test(t))throw this.createError("Document fields cannot begin and end with __")},sC);function sC(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var uC=function(t,e){this.databaseId=t,this.key=e},cC=(hC.prototype.parseSetData=function(t,e){var n=new aC(eC.Set,t,Sv.EMPTY_PATH);fC("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new ZI(r,null,n.fieldTransforms)},hC.prototype.parseMergeData=function(t,e,n){var r=new aC(eC.MergeSet,t,Sv.EMPTY_PATH);fC("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new eg(Sv.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof _I)l=h._internalPath;else{if("string"!=typeof h)throw _m("Expected stringOrFieldPath to be a string or a FieldPath");l=dC(t,h)}if(!r.contains(l))throw new Am(Nm.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=$g.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=$g.fromArray(r.fieldMask),o=r.fieldTransforms;return new ZI(a,i,o)},hC.prototype.parseUpdateData=function(o,t){var a=this,s=new aC(eC.Update,o,Sv.EMPTY_PATH);fC("Data must be an object, but it was:",s,t);var u=new eg(Sv.comparator),c=hw.EMPTY;Mm(t,function(t,e){var n=dC(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof FI)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=$g.fromSet(u);return new rC(c,e,s.fieldTransforms)},hC.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new aC(eC.Update,t,Sv.EMPTY_PATH),o=[pC(t,e)],a=[n];if(r.length%2!=0)throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(pC(t,r[s])),a.push(r[s+1]);var u=new eg(Sv.comparator),c=hw.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof FI)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=$g.fromSet(u);return new rC(c,d,i.fieldTransforms)},hC.prototype.parseQueryValue=function(t,e){var n=new aC(eC.Argument,t,Sv.EMPTY_PATH),r=this.parseData(e,n);return Em(null!=r,"Parsed data should not be null."),Em(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},hC.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=yC(t);throw e.createError(n)}},hC.prototype.parseData=function(t,e){if(lC(t=this.runPreConverter(t,e)))return fC("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof MI)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},hC.prototype.parseObject=function(t,r){var i=this,o=new Gv(nv);return xm(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Mm(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new hw(o)},hC.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Db.INSTANCE),n.push(s),r++}return new pw(n)},hC.prototype.parseSentinelFieldValue=function(t,e){if(!oC(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof FI){if(e.dataSource!==eC.MergeSet)throw e.dataSource===eC.Update?(Em(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof VI)e.fieldTransforms.push(new tb(e.path,cS.instance));else if(t instanceof WI){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new lS(n);e.fieldTransforms.push(new tb(e.path,r))}else if(t instanceof HI){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new pS(n);e.fieldTransforms.push(new tb(e.path,i))}else if(t instanceof YI){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new yS(o);e.fieldTransforms.push(new tb(e.path,a))}else _m("Unknown FieldValue type: "+t)},hC.prototype.parseScalarValue=function(t,e){if(null===t)return Db.INSTANCE;if("number"==typeof t)return AE(t)?new Vb(t):new Wb(t);if("boolean"==typeof t)return Pb.of(t);if("string"==typeof t)return new Hb(t);if(t instanceof Date)return new Yb(Wv.fromDate(t));if(t instanceof Wv)return new Yb(new Wv(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof DT)return new sw(t);if(t instanceof sv)return new ew(t);if(t instanceof uC)return new iw(t.databaseId,t.key);throw e.createError("Unsupported field value: "+zm(t))},hC.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new aC(eC.Argument,r,Sv.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},hC);function hC(t){this.preConverter=t}function lC(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Wv||t instanceof DT||t instanceof sv||t instanceof uC||t instanceof MI)}function fC(t,e,n){if(!lC(n)||!Gm(n)){var r=zm(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function pC(t,e){if(e instanceof _I)return e._internalPath;if("string"==typeof e)return dC(t,e);throw new Am(Nm.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function dC(e,t){try{return function(e){if(0<=e.search(TI))throw new Am(Nm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(_I.bind.apply(_I,na([void 0],e.split("."))))}catch(t){throw new Am(Nm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=yC(t);throw new Am(Nm.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function yC(t){return t instanceof Error?t.message:t.toString()}var mC=R_.COLLECTION_DISABLED,vC=(gC.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},gC);function gC(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Am(Nm.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else jm("settings","non-empty string","host",t.host),this.host=t.host,Wm("settings","boolean","ssl",t.ssl),this.ssl=Om(t.ssl,!0);if(Xm("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Wm("settings","object","credentials",t.credentials),this.credentials=t.credentials,Wm("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?bm("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&bm("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Om(t.timestampsInSnapshots,!0),Wm("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=R_.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==mC&&t.cacheSizeBytes<R_.MINIMUM_CACHE_SIZE_BYTES)throw new Am(Nm.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+R_.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Wm("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var bC=(wC.prototype.settings=function(t){if(Fm("Firestore.settings",arguments,1),Vm("Firestore.settings","object",1,t),Rm(t,"persistence"))throw new Am(Nm.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new vC(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Am(Nm.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new II;switch(t.type){case"gapi":var e=t.client;return Em(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new RI(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Am(Nm.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},wC.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},wC.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},wC.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Am(Nm.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&bm("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Om(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new dI(this._settings.cacheSizeBytes,e))},wC.prototype.clearPersistence=function(){var t=this,n=W_.buildStoragePrefix(this.makeDatabaseInfo()),r=new Dv;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return Jo(t,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Am(Nm.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,W_.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},wC.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(wC.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),wC.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},wC.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),PI(t))return this.onSnapshotsInSyncInternal(t);Vm("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},wC.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new bI({next:function(){t.next&&t.next()},error:function(t){throw _m("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},wC.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new mI),this._firestoreClient},wC.prototype.makeDatabaseInfo=function(){return new hv(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},wC.prototype.configureClient=function(t){Em(!!this._settings.host,"FirestoreSettings.host is not set"),Em(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new vI(Tm.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},wC.prototype.createDataConverter=function(r){return new cC(function(t){if(t instanceof IC){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new Am(Nm.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new uC(r,t._key)}return t})},wC.databaseIdFromApp=function(t){var e=t.options;if(!Rm(e,"projectId"))throw new Am(Nm.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Am(Nm.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new fv(n)},Object.defineProperty(wC.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Am(Nm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),wC.prototype.collection=function(t){return Fm("Firestore.collection",arguments,1),Vm("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new qC(wv.fromString(t),this)},wC.prototype.doc=function(t){return Fm("Firestore.doc",arguments,1),Vm("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),IC.forPath(wv.fromString(t),this)},wC.prototype.collectionGroup=function(t){if(Fm("Firestore.collectionGroup",arguments,1),Vm("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Am(Nm.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new MC(new OT(wv.EMPTY_PATH,t),this)},wC.prototype.runTransaction=function(e){var n=this;return Fm("Firestore.runTransaction",arguments,1),Vm("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new _C(n,t))})},wC.prototype.batch=function(){return this.ensureClientConfigured(),new TC(this)},Object.defineProperty(wC,"logLevel",{get:function(){switch(mm()){case am.DEBUG:return"debug";case am.ERROR:return"error";case am.SILENT:return"silent";default:return _m("Unknown log level: "+mm())}},enumerable:!0,configurable:!0}),wC.setLogLevel=function(t){switch(Fm("Firestore.setLogLevel",arguments,1),Vm("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":vm(am.DEBUG);break;case"error":vm(am.ERROR);break;case"silent":vm(am.SILENT);break;default:throw new Am(Nm.INVALID_ARGUMENT,"Invalid log level: "+t)}},wC.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},wC);function wC(t){var e=this;if(this._firebaseApp=null,this._queue=new Pv,this.INTERNAL={delete:function(){return Jo(e,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=wC.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new NI(n)}else{var r=t;if(!r.projectId)throw new Am(Nm.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new fv(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new II}this._settings=new vC({}),this._dataConverter=this.createDataConverter(this._databaseId)}var _C=(EC.prototype.get=function(t){var n=this;Fm("Transaction.get",arguments,1);var r=KC("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return _m("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof _w)return new kC(n._firestore,r._key,null,!1,!1);if(e instanceof gw)return new kC(n._firestore,r._key,e,!1,!1);throw _m("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},EC.prototype.set=function(t,e,n){qm("Transaction.set",arguments,2,3);var r=KC("Transaction.set",t,this._firestore),i=(n=BC("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},EC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof _I?(Um("Transaction.update",arguments,3),r=KC("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Fm("Transaction.update",arguments,2),r=KC("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},EC.prototype.delete=function(t){Fm("Transaction.delete",arguments,1);var e=KC("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},EC);function EC(t,e){this._firestore=t,this._transaction=e}var TC=(SC.prototype.set=function(t,e,n){qm("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=KC("WriteBatch.set",t,this._firestore),i=(n=BC("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,ob.NONE)),this},SC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof _I?(Um("WriteBatch.update",arguments,3),r=KC("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Fm("WriteBatch.update",arguments,2),r=KC("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,ob.exists(!0))),this},SC.prototype.delete=function(t){Fm("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=KC("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Tb(e._key,ob.NONE)),this},SC.prototype.commit=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},SC.prototype.verifyNotCommitted=function(){if(this._committed)throw new Am(Nm.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},SC);function SC(t){this._firestore=t,this._mutations=[],this._committed=!1}var IC=(CC.forPath=function(t,e){if(t.length%2!=0)throw new Am(Nm.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new CC(new Cv(t),e)},Object.defineProperty(CC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(CC.prototype,"parent",{get:function(){return new qC(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(CC.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),CC.prototype.collection=function(t){if(Fm("DocumentReference.collection",arguments,1),Vm("DocumentReference.collection","non-empty string",1,t),!t)throw new Am(Nm.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=wv.fromString(t);return new qC(this._key.path.child(e),this.firestore)},CC.prototype.isEqual=function(t){if(!(t instanceof CC))throw Jm("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},CC.prototype.set=function(t,e){qm("DocumentReference.set",arguments,1,2);var n=(e=BC("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,ob.NONE))},CC.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof _I?(Um("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Fm("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,ob.exists(!0)))},CC.prototype.delete=function(){return Fm("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Tb(this._key,ob.NONE)])},CC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];qm("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||PI(t[i])||(Xm("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Wm("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=PI(t[i])?t[i]:(Vm("DocumentReference.onSnapshot","function",i,t[i]),Bm("DocumentReference.onSnapshot","function",i+1,t[i+1]),Bm("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},CC.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new bI({next:function(t){if(n.next){Em(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new kC(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(OT.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},CC.prototype.get=function(n){var r=this;return qm("DocumentReference.get",arguments,0,1),WC("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new kC(r.firestore,r._key,t,!0,t instanceof gw&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},CC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Am(Nm.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Am(Nm.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},CC);function CC(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var NC=(AC.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},AC);function AC(t,e){this.hasPendingWrites=t,this.fromCache=e}var kC=(DC.prototype.data=function(t){return qm("DocumentSnapshot.data",arguments,0,1),t=jC("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),Ib.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},DC.prototype.get=function(t,e){if(qm("DocumentSnapshot.get",arguments,1,2),e=jC("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(pC("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Ib.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(DC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(DC.prototype,"ref",{get:function(){return new IC(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(DC.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(DC.prototype,"metadata",{get:function(){return new NC(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),DC.prototype.isEqual=function(t){if(!(t instanceof DC))throw Jm("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},DC.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},DC.prototype.convertValue=function(t,e){if(t instanceof hw)return this.convertObject(t,e);if(t instanceof pw)return this.convertArray(t,e);if(t instanceof iw){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||bm("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new IC(n,this._firestore)}return t.value(e)},DC.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},DC);function DC(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var RC,OC=(Yo(PC,RC=kC),PC.prototype.data=function(t){var e=RC.prototype.data.call(this,t);return Em("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},PC);function PC(){return null!==RC&&RC.apply(this,arguments)||this}var MC=(xC.prototype.where=function(t,e,n){Fm("Query.where",arguments,3),Ym("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Am(Nm.INVALID_ARGUMENT,"Invalid value "+zm(r)+" provided to function "+t+"() for its "+$m(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e);var r,i=pC("Query.where",t),o=xT.fromString(e);if(i.isKeyField()){if(o===xT.ARRAY_CONTAINS||o===xT.ARRAY_CONTAINS_ANY)throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===xT.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new pw(a)}else r=this.parseDocumentIdValue(n)}else o!==xT.IN&&o!==xT.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=UT.create(i,o,r);return this.validateNewFilter(h),new xC(this._query.addFilter(h),this.firestore)},xC.prototype.orderBy=function(t,e){var n;if(qm("Query.orderBy",arguments,1,2),Bm("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=eS.ASCENDING;else{if("desc"!==e)throw new Am(Nm.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=eS.DESCENDING}if(null!==this._query.startAt)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=pC("Query.orderBy",t),i=new oS(r,n);return this.validateNewOrderBy(i),new xC(this._query.addOrderBy(i),this.firestore)},xC.prototype.limit=function(t){if(Fm("Query.limit",arguments,1),Vm("Query.limit","number",1,t),t<=0)throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new xC(this._query.withLimit(t),this.firestore)},xC.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Um("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new xC(this._query.withStartAt(r),this.firestore)},xC.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Um("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new xC(this._query.withStartAt(r),this.firestore)},xC.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Um("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new xC(this._query.withEndAt(r),this.firestore)},xC.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Um("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new xC(this._query.withEndAt(r),this.firestore)},xC.prototype.isEqual=function(t){if(!(t instanceof xC))throw Jm("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},xC.prototype.boundFromDocOrFields=function(t,e,n,r){if(Ym(t,1,e),e instanceof kC){if(0<n.length)throw new Am(Nm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Am(Nm.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},xC.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new iw(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof $b)throw new Am(Nm.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new rS(r,n)},xC.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Am(Nm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(wv.fromString(a));if(!Cv.isDocumentKey(s))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Cv(s);i.push(new iw(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new rS(i,n)},xC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];qm("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||PI(t[i])||(Xm("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Wm("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=PI(t[i])?t[i]:(Vm("Query.onSnapshot","function",i,t[i]),Bm("Query.onSnapshot","function",i+1,t[i+1]),Bm("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},xC.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new bI({next:function(t){e.next&&e.next(new LC(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},xC.prototype.get=function(n){var r=this;return qm("Query.get",arguments,0,1),WC("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new LC(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},xC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Am(Nm.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},xC.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(wv.fromString(t));if(!Cv.isDocumentKey(e))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new iw(this.firestore._databaseId,new Cv(e))}if(t instanceof IC){var n=t;return new iw(this.firestore._databaseId,n._key)}throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+zm(t)+".")},xC.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Am(Nm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},xC.prototype.validateNewFilter=function(t){if(t instanceof UT){var e=[xT.ARRAY_CONTAINS,xT.ARRAY_CONTAINS_ANY],n=[xT.IN,xT.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Am(Nm.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Am(Nm.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},xC.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},xC.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Am(Nm.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},xC);function xC(t,e){this._query=t,this.firestore=e}var LC=(Object.defineProperty(FC.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(FC.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(FC.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),FC.prototype.forEach=function(e,n){var r=this;qm("QuerySnapshot.forEach",arguments,1,2),Vm("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(FC.prototype,"query",{get:function(){return new MC(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),FC.prototype.docChanges=function(t){t&&(Xm("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Wm("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Am(Nm.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new OC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Em(t.type===nT.Added,"Invalid event type for first snapshot"),Em(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==nT.Metadata}).map(function(t){var e=new OC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==nT.Added&&(Em(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==nT.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case nT.Added:return"added";case nT.Modified:case nT.Metadata:return"modified";case nT.Removed:return"removed";default:return _m("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},FC.prototype.isEqual=function(t){if(!(t instanceof FC))throw Jm("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},FC.prototype.convertToDocumentImpl=function(t){return new OC(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},FC);function FC(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new NC(n.hasPendingWrites,n.fromCache)}na(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(LC.prototype.docChanges,t,{get:function(){return function(){throw new Am(Nm.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var UC,qC=(Yo(VC,UC=MC),Object.defineProperty(VC.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(VC.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new IC(new Cv(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(VC.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),VC.prototype.doc=function(t){if(qm("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=tv.newId()),Vm("CollectionReference.doc","non-empty string",1,t),""===t)throw new Am(Nm.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=wv.fromString(t);return IC.forPath(this._query.path.child(e),this.firestore)},VC.prototype.add=function(t){Fm("CollectionReference.add",arguments,1),Vm("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},VC);function VC(t,e){var n=UC.call(this,OT.atPath(t),e)||this;if(t.length%2!=1)throw new Am(Nm.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function BC(t,e){if(void 0===e)return{merge:!1};if(Xm(t,e,["merge","mergeFields"]),Wm(t,"boolean","merge",e.merge),Km(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof _I}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Am(Nm.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function jC(t,e){return void 0===e?{}:(Xm(t,e,["serverTimestamps"]),Qm(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function WC(t,e){Bm(t,"object",1,e),e&&(Xm(t,e,["source"]),Qm(t,0,"source",e.source,["default","server","cache"]))}function KC(t,e,n){if(e instanceof IC){if(e.firestore!==n)throw new Am(Nm.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Jm(t,"DocumentReference",1,e)}var QC=Dm(bC,"Use firebase.firestore() instead."),HC=Dm(_C,"Use firebase.firestore().runTransaction() instead."),GC=Dm(TC,"Use firebase.firestore().batch() instead."),zC=Dm(IC,"Use firebase.firestore().doc() instead."),YC=Dm(kC),XC=Dm(OC),JC=Dm(MC),$C=Dm(LC),ZC=Dm(qC,"Use firebase.firestore().collection() instead."),tN={Firestore:QC,GeoPoint:DT,Timestamp:Wv,Blob:cv,Transaction:HC,WriteBatch:GC,DocumentReference:zC,DocumentSnapshot:YC,Query:JC,QueryDocumentSnapshot:XC,QuerySnapshot:$C,CollectionReference:ZC,FieldPath:_I,FieldValue:JI,setLogLevel:bC.setLogLevel,CACHE_SIZE_UNLIMITED:mC};function eN(t){t.INTERNAL.registerService("firestore",function(t){return new bC(t)},function(t){Em(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(tN))}var nN=(rN.prototype.addCallback=function(t){},rN.prototype.shutdown=function(){},rN);function rN(){}var iN="ConnectivityMonitor",oN=(aN.prototype.addCallback=function(t){this.callbacks.push(t)},aN.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},aN.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},aN.prototype.onNetworkAvailable=function(){gm(iN,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},aN.prototype.onNetworkUnavailable=function(){gm(iN,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},aN.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},aN);function aN(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var sN=(uN.prototype.onOpen=function(t){Em(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},uN.prototype.onClose=function(t){Em(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},uN.prototype.onMessage=function(t){Em(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},uN.prototype.close=function(){this.closeFn()},uN.prototype.send=function(t){this.sendFn(t)},uN.prototype.callOnOpen=function(){Em(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},uN.prototype.callOnClose=function(t){Em(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},uN.prototype.callOnMessage=function(t){Em(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},uN);function uN(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var cN="Connection",hN={BatchGetDocuments:"batchGet",Commit:"commit"},lN="gl-js/ fire/"+dm,fN=(pN.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=lN},pN.prototype.invokeRPC=function(s,r,u){var c=this,h=this.makeUrl(s);return new Promise(function(i,o){var a=new pm;a.listenOnce(lm.COMPLETE,function(){try{switch(a.getLastErrorCode()){case hm.NO_ERROR:var t=a.getResponseJson();gm(cN,"XHR received:",JSON.stringify(t)),i(t);break;case hm.TIMEOUT:gm(cN,'RPC "'+s+'" timed out'),o(new Am(Nm.DEADLINE_EXCEEDED,"Request time out"));break;case hm.HTTP_ERROR:var e=a.getStatus();if(gm(cN,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Nm).indexOf(e)?e:Nm.UNKNOWN}(n.status);o(new Am(r,n.message))}else o(new Am(Nm.UNKNOWN,"Server responded with status "+a.getStatus()))}else gm(cN,'RPC "'+s+'" failed'),o(new Am(Nm.UNAVAILABLE,"Connection failed."));break;default:_m('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{gm(cN,'RPC "'+s+'" completed.')}});var t=Xo({},r);delete t.database;var e=JSON.stringify(t);gm(cN,"XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c.modifyHeadersForRequest(n,u),a.send(h,"POST",e,n,15)})},pN.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},pN.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=cm(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),ya()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}gm(cN,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new sN({sendFn:function(t){c?gm(cN,"Not sending because WebChannel is closed:",t):(u||(gm(cN,"Opening WebChannel transport."),s.open(),u=!0),gm(cN,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(fm.EventType.OPEN,function(){c||gm(cN,"WebChannel transport opened.")}),a(fm.EventType.CLOSE,function(){c||(c=!0,gm(cN,"WebChannel transport closed"),h.callOnClose())}),a(fm.EventType.ERROR,function(t){c||(c=!0,gm(cN,"WebChannel transport errored:",t),h.callOnClose(new Am(Nm.UNAVAILABLE,"The operation could not be completed")))}),a(fm.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Em(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){gm(cN,"WebChannel received error:",r);var i=r.status,o=function(t){var e=XE[t];if(void 0!==e)return eT(e)}(i),a=r.message;void 0===o&&(o=Nm.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Am(o,a)),s.close()}else gm(cN,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},pN.prototype.makeUrl=function(t){var e=hN[t];Em(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},pN);function pN(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var dN=(Object.defineProperty(yN.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(yN.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),yN.prototype.loadConnection=function(t){return Promise.resolve(new fN(t))},yN.prototype.newConnectivityMonitor=function(){return oN.isAvailable()?new oN:new nN},yN.prototype.newSerializer=function(t){return new NS(t,{useProto3Json:!0})},yN.prototype.formatJSON=function(t){return JSON.stringify(t)},yN.prototype.atob=function(t){return atob(t)},yN.prototype.btoa=function(t){return btoa(t)},yN);function yN(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Tm.setPlatform(new dN),eN(fl);var mN,vN={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},gN=(Yo(bN,mN=Error),bN);function bN(t,e,n){var r=mN.call(this,e)||this;return Object.setPrototypeOf(r,bN.prototype),r.code=t,r.details=n,r}var wN=(_N.prototype.getAuthToken=function(){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},_N.prototype.getInstanceIdToken=function(){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},_N.prototype.getContext=function(){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},_N);function _N(t){this.app=t}function EN(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var TN=(SN.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return EN(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},SN.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?EN(t,function(t){return e.decode(t)}):t},SN);function SN(){}var IN=(Object.defineProperty(CN.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),CN.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},CN.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},CN.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},CN.prototype.postJSON=function(r,i,o){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},CN.prototype.call=function(c,h,l){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return $o(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new gN("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new gN("cancelled","Firebase Functions instance was deleted.");if(s=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!vN[s])return new gN("internal","internal");r=vN[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new gN(r,i,o)}(a.status,a.json,this.serializer))throw s;if(!a.json)throw new gN("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new gN("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},CN);function CN(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new TN,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new wN(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var NN;function AN(t,e,n){return new IN(t,n)}function kN(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function DN(n,r,i){var o,t=new Promise(function(t,e){kN(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function RN(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function ON(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return DN(this[n],t,arguments)})})}function PN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function MN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=DN(t,e,n);return r.then(function(t){if(t)return new LN(t,r.request)})}(this[n],t,arguments)})})}function xN(t){this._index=t}function LN(t,e){this._cursor=t,this._request=e}function FN(t){this._store=t}function UN(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function qN(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new UN(n)}function VN(t){this._db=t}NN={Functions:IN},fl.INTERNAL.registerService("functions",AN,NN,void 0,!0),RN(xN,"_index",["name","keyPath","multiEntry","unique"]),ON(xN,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),MN(xN,"_index",IDBIndex,["openCursor","openKeyCursor"]),RN(LN,"_cursor",["direction","key","primaryKey","value"]),ON(LN,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(LN.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),kN(e._request).then(function(t){if(t)return new LN(t,e._request)})})})}),FN.prototype.createIndex=function(){return new xN(this._store.createIndex.apply(this._store,arguments))},FN.prototype.index=function(){return new xN(this._store.index.apply(this._store,arguments))},RN(FN,"_store",["name","keyPath","indexNames","autoIncrement"]),ON(FN,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),MN(FN,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),PN(FN,"_store",IDBObjectStore,["deleteIndex"]),UN.prototype.objectStore=function(){return new FN(this._tx.objectStore.apply(this._tx,arguments))},RN(UN,"_tx",["objectStoreNames","mode"]),PN(UN,"_tx",IDBTransaction,["abort"]),qN.prototype.createObjectStore=function(){return new FN(this._db.createObjectStore.apply(this._db,arguments))},RN(qN,"_db",["name","version","objectStoreNames"]),PN(qN,"_db",IDBDatabase,["deleteObjectStore","close"]),VN.prototype.transaction=function(){return new UN(this._db.transaction.apply(this._db,arguments))},RN(VN,"_db",["name","version","objectStoreNames"]),PN(VN,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[FN,xN].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[xN,FN].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var BN,jN=1e4,WN="w:0.3.0",KN="FIS_v2",QN="https://firebaseinstallations.googleapis.com/v1",HN=36e5,GN=((BN={})["missing-app-config-values"]="Missing App configuration values.",BN["create-installation-failed"]="Could not register Firebase Installation.",BN["generate-token-failed"]="Could not generate Auth Token.",BN["not-registered"]="Firebase Installation is not registered.",BN["installation-not-found"]="Firebase Installation not found.",BN["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',BN["app-offline"]="Could not process request. Application offline.",BN["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",BN),zN=new wa("installations","Installations",GN);function YN(t){return t instanceof ga&&t.code.includes("request-failed")}function XN(t){if(!t||!t.options)throw zN.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw zN.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function JN(t){var e=t.projectId;return QN+"/projects/"+e+"/installations"}function $N(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function ZN(r,i){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,zN.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function tA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function eA(t,e){var n=e.refreshToken,r=tA(t);return r.append("Authorization",function(t){return KN+" "+t}(n)),r}function nA(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function rA(e){return new Promise(function(t){setTimeout(t,e)})}var iA=/^[cdef][\w-]{21}$/,oA="";function aA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,ea(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return iA.test(e)?e:oA}catch(t){return oA}}var sA,uA="firebase-installations-database",cA=1,hA="firebase-installations-store",lA=null;function fA(){return lA=lA||function(t,e,n){var r=DN(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new qN(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new VN(t)})}(uA,cA,function(t){switch(t.oldVersion){case 0:t.createObjectStore(hA)}})}function pA(i,o){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return e=mA(i),[4,fA()];case 1:return n=t.sent(),[4,(r=n.transaction(hA,"readwrite")).objectStore(hA).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function dA(i){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return e=mA(i),[4,fA()];case 1:return n=t.sent(),[4,(r=n.transaction(hA,"readwrite")).objectStore(hA).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function yA(s,u){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return e=mA(s),[4,fA()];case 1:return n=t.sent(),r=n.transaction(hA,"readwrite"),[4,(i=r.objectStore(hA)).get(e)];case 2:return o=t.sent(),void 0!==(a=u(o))?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function mA(t){return t.appName+"!"+t.appId}function vA(i){return Jo(this,void 0,void 0,function(){var r,e,n;return $o(this,function(t){switch(t.label){case 0:return[4,yA(i,function(t){var e=function(t){return bA(t||{fid:aA(),registrationStatus:0})}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,gA(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,rA(100)];case 3:return t.sent(),[4,gA(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw zN.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(zN.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return e=JN(s),n=tA(s),r={fid:u,authVersion:KN,appId:s.appId,sdkVersion:WN},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,nA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:$N(a.authToken)}];case 3:return[4,ZN("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,pA(r,e)];case 2:return YN(n=t.sent())&&409===n.serverCode?[4,dA(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,pA(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==oA?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function gA(t){return yA(t,function(t){if(!t)throw zN.create("installation-not-found");return bA(t)})}function bA(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+jN<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function wA(s,u){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return JN(t)+"/"+n+"/authTokens:generate"}(s,u),n=eA(s,u),r={installation:{sdkVersion:WN}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,nA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,$N(a)];case 3:return[4,ZN("Generate Auth Token",o)];case 4:throw t.sent()}})})}function _A(i,o){return void 0===o&&(o=!1),Jo(this,void 0,void 0,function(){var r,e,n;return $o(this,function(t){switch(t.label){case 0:return[4,yA(i,function(t){if(!TA(t))throw zN.create("not-registered");var e=t.authToken;if(!o&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+HN}(t)}(e))return t;if(1===e.requestStatus)return r=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,EA(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,rA(100)];case 3:return t.sent(),[4,EA(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw zN.create("generate-token-failed");return[2,n]}})})}(i),t;if(!navigator.onLine)throw zN.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return Xo(Xo({},t),{authToken:e})}(t);return r=function(i,o){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,wA(i,o)];case 1:return e=t.sent(),r=Xo(Xo({},o),{authToken:e}),[4,pA(i,r)];case 2:return t.sent(),[2,e];case 3:return!YN(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,dA(i)];case 4:return t.sent(),[3,7];case 5:return r=Xo(Xo({},o),{authToken:{requestStatus:0}}),[4,pA(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function EA(t){return yA(t,function(t){if(!TA(t))throw zN.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+jN<Date.now()}(t.authToken)?Xo(Xo({},t),{authToken:{requestStatus:0}}):t})}function TA(t){return void 0!==t&&2===t.registrationStatus}function SA(n,r){return void 0===r&&(r=!1),Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,function(i){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return[4,vA(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw zN.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=XN(n))];case 1:return t.sent(),[2,_A(e,r)]}})})}function IA(o,a){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return JN(t)+"/"+n}(o,a),n=eA(o,a),r={method:"DELETE",headers:n},[4,nA(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,ZN("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}fl.INTERNAL.registerService("installations",function(e){return XN(e),{app:e,getId:function(){return function(o){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return[4,vA(e=XN(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&_A(e).catch(function(){}),[2,r.fid]}})})}(e)},getToken:function(t){return SA(e,t)},delete:function(){return function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,yA(e=XN(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw zN.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw zN.create("app-offline");case 3:return[4,IA(e,n)];case 4:return t.sent(),[4,dA(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(e)}}});var CA,NA,AA=((sA={})["only-available-in-window"]="This method is available in a Window context.",sA["only-available-in-sw"]="This method is available in a service worker context.",sA["should-be-overriden"]="This method should be overriden by extended classes.",sA["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",sA["permission-default"]="The required permissions were not granted and dismissed instead.",sA["permission-blocked"]="The required permissions were not granted and blocked instead.",sA["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",sA["notifications-blocked"]="Notifications have been blocked.",sA["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",sA["sw-registration-expected"]="A service worker registration was the expected input.",sA["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",sA["invalid-saved-token"]="Unable to access details of the saved token.",sA["sw-reg-redundant"]="The service worker being used for push was made redundant.",sA["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",sA["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",sA["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",sA["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",sA["token-update-no-token"]="FCM returned no token when updating the user to push.",sA["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",sA["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",sA["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",sA["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",sA["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",sA["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",sA["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",sA["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",sA["failed-to-delete-token"]="Unable to delete the currently saved token.",sA["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",sA["bad-scope"]="The service worker scope must be a string with at least one character.",sA["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",sA["bad-subscription"]="The subscription must be a valid PushSubscription.",sA["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",sA["failed-delete-vapid-key"]="The VAPID key could not be deleted.",sA["invalid-public-vapid-key"]="The public VAPID key must be a string.",sA["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",sA["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",sA),kA=new wa("messaging","Messaging",AA),DA=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),RA="google.c.a.c_id";function OA(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function PA(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,ea(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(NA=CA=CA||{}).PUSH_MSG_RECEIVED="push-msg-received",NA.NOTIFICATION_CLICKED="notification-clicked";var MA=(xA.prototype.getToken=function(s,u,c){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return[4,FA(s)];case 1:e=t.sent(),n=UA(u,c),r={method:"POST",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(LA(s),r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),kA.create("token-subscribe-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,kA.create("token-subscribe-failed",{errorInfo:a});if(!i.token)throw kA.create("token-subscribe-no-token");return[2,i.token]}})})},xA.prototype.updateToken=function(s,u,c,h){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return[4,FA(u)];case 1:e=t.sent(),n=UA(c,h),r={method:"PATCH",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(LA(u)+"/"+s.fcmToken,r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),kA.create("token-update-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,kA.create("token-update-failed",{errorInfo:a});if(!i.token)throw kA.create("token-update-no-token");return[2,i.token]}})})},xA.prototype.deleteToken=function(a,s){return Jo(this,void 0,void 0,function(){var e,n,r,i,o;return $o(this,function(t){switch(t.label){case 0:return[4,FA(a)];case 1:e=t.sent(),n={method:"DELETE",headers:e},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(LA(a)+"/"+s.fcmToken,n)];case 3:return[4,t.sent().json()];case 4:if((r=t.sent()).error)throw i=r.error.message,kA.create("token-unsubscribe-failed",{errorInfo:i});return[3,6];case 5:throw o=t.sent(),kA.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})},xA);function xA(){}function LA(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.options.projectId+"/registrations"}function FA(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,n.installations().getToken()];case 1:return e=t.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}})})}function UA(t,e){var n=PA(t.getKey("p256dh")),r=PA(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return OA(e.buffer,DA.buffer)||(i.web.applicationPubKey=PA(e)),i}function qA(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var VA="undefined",BA="fcm_token_object_Store";function jA(e){var n=indexedDB.open(VA);n.onerror=function(t){},n.onsuccess=function(t){!function(n,r){if(n.objectStoreNames.contains(BA)){var t=n.transaction(BA).objectStore(BA),i=new MA,o=t.openCursor();o.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},o.onsuccess=function(){var t=o.result;if(t){var e=t.value;i.deleteToken(r,e),t.continue()}else n.close(),indexedDB.deleteDatabase(VA)}}}(n.result,e)}}var WA=(KA.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},KA.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},KA.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},KA.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},KA.prototype.closeDatabase=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},KA.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},KA.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},KA);function KA(){this.dbPromise=null}var QA,HA=(Yo(GA,QA=WA),GA.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(i=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),i.createIndex("fcmToken","fcmToken",{unique:!0});case 1:jA(this.app);case 2:var r=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=Xo({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=qA(e.vapidKey)),"string"==typeof e.auth&&(n.auth=qA(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=qA(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var i,o=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();o.onsuccess=function(){var t=o.result;if(t){var e=t.value,n=Xo({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},GA.prototype.getTokenDetailsFromToken=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){if(!e)throw kA.create("bad-token");return zA({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},GA.prototype.getTokenDetailsFromSWScope=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){if(!e)throw kA.create("bad-scope");return zA({swScope:e}),[2,this.get(e)]})})},GA.prototype.saveTokenDetails=function(e){return Jo(this,void 0,void 0,function(){return $o(this,function(t){if(!e.swScope)throw kA.create("bad-scope");if(!e.vapidKey)throw kA.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw kA.create("bad-subscription");if(!e.fcmSenderId)throw kA.create("bad-sender-id");if(!e.fcmToken)throw kA.create("bad-token");return zA(e),[2,this.put(e)]})})},GA.prototype.deleteToken=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(kA.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw kA.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},GA);function GA(t){var e=QA.call(this)||this;return e.app=t,e.dbName="fcm_token_details_db",e.dbVersion=4,e.objectStoreName="fcm_token_object_Store",e}function zA(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw kA.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw kA.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw kA.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw kA.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw kA.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw kA.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw kA.create("bad-sender-id")}var YA,XA=(Yo(JA,YA=WA),JA.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},JA.prototype.getVapidFromSWScope=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw kA.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},JA.prototype.saveVapidDetails=function(n,r){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){if("string"!=typeof n||0===n.length)throw kA.create("bad-scope");if(null===r||65!==r.length)throw kA.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},JA.prototype.deleteVapidDetails=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw kA.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},JA);function JA(){var t=null!==YA&&YA.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var $A=(ZA.prototype.getToken=function(){return Jo(this,void 0,void 0,function(){var e,n,r,i,o;return $o(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw kA.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},ZA.prototype.manageExistingToken=function(e,n,r,i){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!OA(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=OA(t.getKey("auth"),n.auth),o=OA(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[3,1];case 1:return[4,this.deleteTokenFromDB(i.fcmToken)];case 2:return t.sent(),[2,this.getNewToken(e,n,r)];case 3:return[2]}})})},ZA.prototype.updateToken=function(i,o,a,s){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(s,this.app,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},ZA.prototype.getNewToken=function(r,i,o){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,this.subscriptionManager.getToken(this.app,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e]}})})},ZA.prototype.deleteToken=function(r){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},ZA.prototype.deleteTokenFromDB=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.subscriptionManager.deleteToken(this.app,e)];case 2:return t.sent(),[2]}})})},ZA.prototype.getPushSubscription=function(n,r){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,n.pushManager.getSubscription()];case 1:return(e=t.sent())?[2,e]:[2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})]}})})},ZA.prototype.requestPermission=function(){throw kA.create("only-available-in-window")},ZA.prototype.useServiceWorker=function(t){throw kA.create("only-available-in-window")},ZA.prototype.usePublicVapidKey=function(t){throw kA.create("only-available-in-window")},ZA.prototype.onMessage=function(t,e,n){throw kA.create("only-available-in-window")},ZA.prototype.onTokenRefresh=function(t,e,n){throw kA.create("only-available-in-window")},ZA.prototype.setBackgroundMessageHandler=function(t){throw kA.create("only-available-in-sw")},ZA.prototype.delete=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},ZA.prototype.getNotificationPermission_=function(){return Notification.permission},ZA.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},ZA.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},ZA.prototype.getSubscriptionManager=function(){return this.subscriptionManager},ZA);function ZA(t){var e=this;if(this.app=t,this.vapidDetailsModel=new XA,this.subscriptionManager=new MA,!t.options.messagingSenderId||"string"!=typeof t.options.messagingSenderId)throw kA.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new HA(t)}var tk,ek="FCM_MSG",nk=(Yo(rk,tk=$A),rk.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},rk.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},rk.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},rk.prototype.onPush_=function(s){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},rk.prototype.onSubChange_=function(t){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),kA.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},rk.prototype.onNotificationClick_=function(o){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:if(!(o.notification&&o.notification.data&&o.notification.data[ek]))return[2];if(o.action)return[2];if(o.stopImmediatePropagation(),o.notification.close(),!(e=o.notification.data[ek]).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&RA in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=t.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[4,function(e){return new Promise(function(t){setTimeout(t,e)})}(3e3)];case 3:return t.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=t.sent(),t.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,i=ok(CA.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},rk.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=Xo({},t.notification);return n.data=Xo(Xo({},t.notification.data),((e={})[ek]=t,e)),n}},rk.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw kA.create("bg-handler-function-expected");this.bgMessageHandler=t},rk.prototype.getWindowClient_=function(o){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,ik()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},rk.prototype.attemptToMessageClient_=function(e,n){return Jo(this,void 0,void 0,function(){return $o(this,function(t){if(!e)throw kA.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},rk.prototype.hasVisibleClients_=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,ik()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},rk.prototype.sendMessageToWindowClients_=function(i){return Jo(this,void 0,void 0,function(){var e,n,r=this;return $o(this,function(t){switch(t.label){case 0:return[4,ik()];case 1:return e=t.sent(),n=ok(CA.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},rk.prototype.getSWRegistration_=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return[2,self.registration]})})},rk.prototype.getPublicVapidKey_=function(){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw kA.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,DA]:[2,n]}})})},rk);function rk(t){var e=tk.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function ik(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function ok(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var ak,sk,uk=(Yo(ck,ak=$A),ck.prototype.requestPermission=function(){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?kA.create("permission-blocked"):kA.create("permission-default")}})})},ck.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw kA.create("sw-registration-expected");if(null!=this.registrationToUse)throw kA.create("use-sw-before-get-token");this.registrationToUse=t},ck.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw kA.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw kA.create("use-public-key-before-get-token");var e=qA(t);if(65!==e.length)throw kA.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},ck.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},ck.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},ck.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(kA.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(kA.create("sw-reg-redundant"));else t(r);else e(kA.create("no-sw-in-reg"))})},ck.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw kA.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},ck.prototype.getPublicVapidKey_=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,DA]})})},ck.prototype.setupSWMessageListener_=function(){var a=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data.firebaseMessagingType&&t.data.firebaseMessagingData){var e=t.data,n=e.firebaseMessagingType,r=e.firebaseMessagingData;a.messageObserver&&a.messageObserver.next(r);var i=r.data;if(i&&RA in i&&"1"===i["google.c.a.e"]){var o=function(t){switch(t){case CA.NOTIFICATION_CLICKED:return"notification_open";case CA.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n);a.app.INTERNAL.analytics.logEvent(o,{message_name:i["google.c.a.c_l"],message_id:i[RA],message_time:i["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}},!1)},ck);function ck(t){var e=ak.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Oa(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Oa(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function hk(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}sk={isSupported:hk},fl.INTERNAL.registerService("messaging",function(t){if(!hk())throw kA.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new nk(t):new uk(t)},sk);var lk="firebasestorage.googleapis.com",fk="storageBucket",pk=(dk.prototype.codeProp=function(){return this.code},dk.prototype.codeEquals=function(t){return mk(t)===this.codeProp()},dk.prototype.serverResponseProp=function(){return this.serverResponse_},dk.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(dk.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(dk.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(dk.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(dk.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),dk);function dk(t,e){this.code_=mk(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var yk={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function mk(t){return"storage/"+t}function vk(){return new pk(yk.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function gk(){return new pk(yk.CANCELED,"User canceled the upload/download.")}function bk(){return new pk(yk.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function wk(t,e,n){return new pk(yk.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function _k(){return new pk(yk.APP_DELETED,"The Firebase app was deleted.")}function Ek(t,e){return new pk(yk.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Tk(t){throw new pk(yk.INTERNAL_ERROR,"Internal error: "+t)}var Sk={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Ik(t){switch(t){case Sk.RAW:case Sk.BASE64:case Sk.BASE64URL:case Sk.DATA_URL:return;default:throw"Expected one of the event types: ["+Sk.RAW+", "+Sk.BASE64+", "+Sk.BASE64URL+", "+Sk.DATA_URL+"]."}}var Ck=function(t,e){this.data=t,this.contentType=e||null};function Nk(t,e){switch(t){case Sk.RAW:return new Ck(Ak(e));case Sk.BASE64:case Sk.BASE64URL:return new Ck(kk(t,e));case Sk.DATA_URL:return new Ck(function(t){var e=new Dk(t);return e.base64?kk(Sk.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Ek(Sk.DATA_URL,"Malformed data URL.")}return Ak(e)}(e.rest)}(e),function(t){return new Dk(t).contentType}(e))}throw vk()}function Ak(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function kk(e,t){switch(e){case Sk.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Ek(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Sk.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw Ek(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw Ek(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Dk=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Ek(Sk.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var Rk,Ok,Pk={STATE_CHANGED:"state_changed"},Mk="running",xk="pausing",Lk="paused",Fk="success",Uk="canceling",qk="canceled",Vk="error",Bk={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function jk(t){switch(t){case Mk:case xk:case Uk:return Bk.RUNNING;case Lk:return Bk.PAUSED;case Fk:return Bk.SUCCESS;case qk:return Bk.CANCELED;case Vk:default:return Bk.ERROR}}function Wk(t){return null!=t}function Kk(t){return void 0!==t}function Qk(t){return"function"==typeof t}function Hk(t){return"object"==typeof t}function Gk(t){return"string"==typeof t||t instanceof String}function zk(t){return"number"==typeof t||t instanceof Number}function Yk(t){return Xk()&&t instanceof Blob}function Xk(){return"undefined"!=typeof Blob}(Ok=Rk=Rk||{})[Ok.NO_ERROR=0]="NO_ERROR",Ok[Ok.NETWORK_ERROR=1]="NETWORK_ERROR",Ok[Ok.ABORT=2]="ABORT";var Jk=($k.prototype.send=function(t,e,n,r){if(this.sent_)throw Tk("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),Wk(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return Wk(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},$k.prototype.getErrorCode=function(){if(!this.sent_)throw Tk("cannot .getErrorCode() before sending");return this.errorCode_},$k.prototype.getStatus=function(){if(!this.sent_)throw Tk("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},$k.prototype.getResponseText=function(){if(!this.sent_)throw Tk("cannot .getResponseText() before sending");return this.xhr_.responseText},$k.prototype.abort=function(){this.xhr_.abort()},$k.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},$k.prototype.addUploadProgressListener=function(t){Wk(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},$k.prototype.removeUploadProgressListener=function(t){Wk(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},$k);function $k(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Rk.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=Rk.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=Rk.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var Zk=(tD.prototype.createXhrIo=function(){return new Jk},tD);function tD(){}function eD(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Xk())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var nD=(rD.prototype.size=function(){return this.size_},rD.prototype.type=function(){return this.type_},rD.prototype.slice=function(t,e){if(Yk(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new rD(n)}return new rD(new Uint8Array(this.data_.buffer,t,e-t),!0)},rD.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(Xk()){var n=t.map(function(t){return t instanceof rD?t.data_:t});return new rD(eD.apply(null,n))}var r=t.map(function(t){return Gk(t)?Nk(Sk.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new rD(o,!0)},rD.prototype.uploadData=function(){return this.data_},rD);function rD(t,e){var n=0,r="";Yk(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var iD=(Object.defineProperty(oD.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(oD.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),oD.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},oD.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},oD.makeFromBucketSpec=function(e){var t;try{t=oD.makeFromUrl(e)}catch(t){return new oD(e,"")}if(""===t.path)return t;throw function(t){return new pk(yk.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},oD.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=lk.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new oD(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new pk(yk.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},oD);function oD(t,e){this.bucket=t,this.path_=e}function aD(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return Hk(t)&&!Array.isArray(t)}(e)?e:null}function sD(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function uD(t){return"https://"+lk+"/v0"+t}function cD(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function hD(t,e){return e}var lD=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||hD},fD=null;function pD(){if(fD)return fD;var t=[];t.push(new lD("bucket")),t.push(new lD("generation")),t.push(new lD("metageneration")),t.push(new lD("name","fullPath",!0));var e=new lD("name");e.xform=function(t,e){return function(t){return!Gk(t)||t.length<2?t:sD(t)}(e)},t.push(e);var n=new lD("size");return n.xform=function(t,e){return Wk(e)?Number(e):e},t.push(n),t.push(new lD("timeCreated")),t.push(new lD("updated")),t.push(new lD("md5Hash",null,!0)),t.push(new lD("cacheControl",null,!0)),t.push(new lD("contentDisposition",null,!0)),t.push(new lD("contentEncoding",null,!0)),t.push(new lD("contentLanguage",null,!0)),t.push(new lD("contentType",null,!0)),t.push(new lD("metadata","customMetadata",!0)),fD=t}function dD(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new iD(t,e);return i.makeStorageReference(n)}})}(r,t),r}function yD(t,e,n){var r=aD(e);return null===r?null:dD(t,r,n)}function mD(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function vD(t){if(!Hk(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!Hk(n))throw"Expected object for 'customMetadata' mapping."}else if(Hk(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var gD="maxResults",bD=1e3,wD="pageToken",_D="prefixes",ED="items";function TD(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new pk(yk.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+fk+"' property when initializing the app?");if(e[_D])for(var i=0,o=e[_D];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new iD(r,a));n.prefixes.push(s)}if(e[ED])for(var u=0,c=e[ED];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new iD(r,h.name));n.items.push(s)}return n}function SD(t){if(!Hk(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===gD){if(!zk(n=t[gD])||!Number.isInteger(n)||t[gD]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[gD])throw"Expected maxResults to be less than or equal to "+bD+"."}else{if(e!==wD)throw"Unknown option: "+e;if(t[wD]&&!Gk(t[wD]))throw"Expected pageToken to be string."}var n}var ID=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function CD(t){if(!t)throw vk()}function ND(r,i){return function(t,e){var n=yD(r,e,i);return CD(null!==n),n}}function AD(r){return function(t,e){var n=function(t,e){var n=aD(e);return null===n?null:TD(t,n)}(r,e);return CD(null!==n),n}}function kD(r,i){return function(t,e){var n=yD(r,e,i);return CD(null!==n),function(r,t){var e=aD(t);if(null===e)return null;if(!Gk(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return uD("/b/"+i(e)+"/o/"+i(n))+cD({alt:"media",token:t})})[0]}(n,e)}}function DD(r){return function(t,e){var n;return(n=401===t.getStatus()?new pk(yk.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new pk(yk.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new pk(yk.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function RD(r){var i=DD(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new pk(yk.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function OD(t,e,n){var r=uD(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new ID(r,"GET",ND(t,n),i);return o.errorHandler=RD(e),o}function PD(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var MD=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function xD(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){CD(!1)}return CD(!!n&&-1!==(e||["active"]).indexOf(n)),n}function LD(t,a,e,s,n,u,r,i){var c=new MD(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new pk(yk.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw bk();var y=a.maxUploadRetryTime(),m=new ID(e,"POST",function(t,e){var n,r=xD(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?ND(a,u)(t,e):null,new MD(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=DD(t),m}var FD=function(t,e,n){if(Qk(t)||Wk(e)||Wk(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},UD=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function qD(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new pk(yk.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?wk(o,e,t.message):wk(o,e,t)}}var VD=function(e,t){var n=this;this.validator=function(t){n.optional&&!Kk(t)||e(t)},this.optional=!!t};function BD(t,e){function n(t){if(!Gk(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new VD(r,e)}function jD(t){return new VD(vD,t)}function WD(){return new VD(function(t){if(!(zk(t)&&0<=t))throw"Expected a number 0 or greater."})}function KD(e,t){return new VD(function(t){if(!(null===t||Wk(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function QD(t){return new VD(function(t){if(!(null===t||Qk(t)))throw"Expected a Function."},t)}function HD(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var GD=(zD.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},zD.prototype.shouldDoResumable_=function(t){return 262144<t.size()},zD.prototype.start_=function(){this.state_===Mk&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},zD.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case Mk:e(t);break;case Uk:n.transition_(qk);break;case xk:n.transition_(Lk)}})},zD.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=PD(e,r,i),s={name:a.fullPath},u=uD(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=mD(a,n),l=t.maxUploadRetryTime(),f=new ID(u,"POST",function(t){var e;xD(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){CD(!1)}return CD(Gk(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=DD(e),f}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},zD.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=function(t,e,n,i){var r=t.maxUploadRetryTime(),o=new ID(n,"POST",function(t){var e=xD(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){CD(!1)}n||CD(!1);var r=Number(n);return CD(!isNaN(r)),new MD(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=DD(e),o}(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},zD.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new MD(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=LD(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(Vk)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(Fk)):r.completeTransitions_()},r.errorHandler_)})},zD.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},zD.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=OD(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(Fk)},r.metadataErrorHandler_)})},zD.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=PD(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+mD(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=nD.getBlob(c,r,h);if(null===l)throw bk();var f={name:u.fullPath},p=uD(o),d=t.maxUploadRetryTime(),y=new ID(p,"POST",ND(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=DD(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(Fk)},r.errorHandler_)})},zD.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},zD.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Uk:case xk:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Mk:var e=this.state_===Lk;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Lk:this.state_=t,this.notifyObservers_();break;case qk:this.error_=gk(),this.state_=t,this.notifyObservers_();break;case Vk:case Fk:this.state_=t,this.notifyObservers_()}},zD.prototype.completeTransitions_=function(){switch(this.state_){case xk:this.transition_(Lk);break;case Uk:this.transition_(qk);break;case Mk:this.start_()}},Object.defineProperty(zD.prototype,"snapshot",{get:function(){var t=jk(this.state_);return new UD(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),zD.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=QD(!0).validator,a=KD(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(Kk(t.next)||Kk(t.error)||Kk(t.complete)))throw"";return}catch(t){throw r}}qD("on",[BD(function(){if(t!==Pk.STATE_CHANGED)throw"Expected one of the event types: ["+Pk.STATE_CHANGED+"]."}),KD(s,!0),QD(!0),QD(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&qD("on",i,arguments);var r=new FD(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[KD(function(t){if(null===t)throw r;s(t)}),QD(!0),QD(!0)];return Kk(e)||Kk(n)||Kk(o)?c(null)(e,n,o):c(h)},zD.prototype.then=function(t,e){return this.promise_.then(t,e)},zD.prototype.catch=function(t){return this.then(null,t)},zD.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},zD.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},zD.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},zD.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(jk(this.state_)){case Bk.SUCCESS:HD(this.resolve_.bind(null,this.snapshot))();break;case Bk.CANCELED:case Bk.ERROR:HD(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},zD.prototype.notifyObserver_=function(t){switch(jk(this.state_)){case Bk.RUNNING:case Bk.PAUSED:t.next&&HD(t.next.bind(t,this.snapshot))();break;case Bk.SUCCESS:t.complete&&HD(t.complete.bind(t))();break;case Bk.CANCELED:case Bk.ERROR:t.error&&HD(t.error.bind(t,this.error_))();break;default:t.error&&HD(t.error.bind(t,this.error_))()}},zD.prototype.resume=function(){qD("resume",[],arguments);var t=this.state_===Lk||this.state_===xk;return t&&this.transition_(Mk),t},zD.prototype.pause=function(){qD("pause",[],arguments);var t=this.state_===Mk;return t&&this.transition_(xk),t},zD.prototype.cancel=function(){qD("cancel",[],arguments);var t=this.state_===Mk||this.state_===xk;return t&&this.transition_(Uk),t},zD);function zD(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Mk,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(yk.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Vk))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(yk.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Vk))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var YD=(XD.prototype.toString=function(){return qD("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},XD.prototype.newRef=function(t,e){return new XD(t,e)},XD.prototype.mappings=function(){return pD()},XD.prototype.child=function(t){qD("child",[BD()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new iD(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(XD.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new iD(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(XD.prototype,"root",{get:function(){var t=new iD(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(XD.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(XD.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(XD.prototype,"name",{get:function(){return sD(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(XD.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),XD.prototype.put=function(t,e){return void 0===e&&(e=null),qD("put",[new VD(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Xk()&&t instanceof Blob))throw"Expected Blob or File."}),jD(!0)],arguments),this.throwIfRoot_("put"),new GD(this,this.authWrapper,this.location,this.mappings(),new nD(t),e)},XD.prototype.putString=function(t,e,n){void 0===e&&(e=Sk.RAW),qD("putString",[BD(),BD(Ik,!0),jD(!0)],arguments),this.throwIfRoot_("putString");var r=Nk(e,t),i=Object.assign({},n);return!Wk(i.contentType)&&Wk(r.contentType)&&(i.contentType=r.contentType),new GD(this,this.authWrapper,this.location,this.mappings(),new nD(r.data,!0),i)},XD.prototype.delete=function(){var n=this;return qD("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=uD(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new ID(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=RD(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},XD.prototype.listAll=function(){qD("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},XD.prototype.listAllHelper=function(o,a){return Jo(this,void 0,void 0,function(){var e,n,r,i;return $o(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},XD.prototype.list=function(r){qD("list",[function(t){return new VD(SD,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=uD(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new ID(a,"GET",AD(t),s);return u.urlParams=o,u.errorHandler=DD(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},XD.prototype.getMetadata=function(){var n=this;return qD("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=OD(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},XD.prototype.updateMetadata=function(n){var r=this;return qD("updateMetadata",[jD()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=uD(e.fullServerUrl()),o=mD(n,r),a=t.maxOperationRetryTime(),s=new ID(i,"PATCH",ND(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=RD(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},XD.prototype.getDownloadURL=function(){var n=this;return qD("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=uD(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new ID(r,"GET",kD(t,n),i);return o.errorHandler=RD(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new pk(yk.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},XD.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new pk(yk.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},XD);function XD(t,e){this.authWrapper=t,this.location=e instanceof iD?e:iD.makeFromUrl(e)}var JD=($D.prototype.getPromise=function(){return this.promise_},$D.prototype.cancel=function(t){},$D);function $D(t){this.promise_=Promise.reject(t)}var ZD=(tR.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},tR.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},tR);function tR(){this.map=new Map,this.id=-9007199254740991}var eR=(nR.extractBucket_=function(t){var e=t[fk]||null;return null==e?null:iD.makeFromBucketSpec(e).bucket},nR.prototype.getAuthToken=function(){return null!==this.app_&&Wk(this.app_.INTERNAL)&&Wk(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},nR.prototype.bucket=function(){if(this.deleted_)throw _k();return this.bucket_},nR.prototype.service=function(){return this.service_},nR.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},nR.prototype.makeRequest=function(t,e){if(this.deleted_)return new JD(_k());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},nR.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},nR.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},nR.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},nR.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},nR.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},nR);function nR(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;Wk(o)&&(this.bucket_=nR.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new ZD}var rR=(iR.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());Kk(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=vk()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?_k():gk()):i(n=new pk(yk.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new oR(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,na([null,t],e)):s()||o?c.call.apply(c,na([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new oR(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===Rk.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new oR(r,t))}else{var i=t.getErrorCode()===Rk.ABORT;o(!1,new oR(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},iR.prototype.getPromise=function(){return this.promise_},iR.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},iR.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},iR);function iR(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var oR=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function aR(t,e,n){var r=cD(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==fl?fl.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new rR(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var sR=(uR.prototype.ref=function(t){if(qD("ref",[BD(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new YD(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},uR.prototype.refFromURL=function(t){return qD("refFromURL",[BD(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{iD.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new YD(this.authWrapper_,t)},Object.defineProperty(uR.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),uR.prototype.setMaxUploadRetryTime=function(t){qD("setMaxUploadRetryTime",[WD()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},uR.prototype.setMaxOperationRetryTime=function(t){qD("setMaxOperationRetryTime",[WD()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(uR.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(uR.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),uR);function uR(t,e,n){if(this.bucket_=null,this.authWrapper_=new eR(t,function(t,e){return new YD(t,e)},aR,this,e),this.app_=t,null!=n)this.bucket_=iD.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new iD(r,""))}this.internals_=new cR(this)}var cR=(hR.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},hR);function hR(t){this.service_=t}var lR;function fR(t,e,n){return new sR(t,new Zk,n)}lR={TaskState:Bk,TaskEvent:Pk,StringFormat:Sk,Storage:sR,Reference:YD},fl.INTERNAL.registerService("storage",fR,lR,void 0,!0);var pR,dR,yR,mR,vR="0.2.20",gR="FB-PERF-TRACE-MEASURE",bR="@firebase/performance/config",wR="@firebase/performance/configexpire",_R="Performance",ER=((pR={})["trace started"]="Trace {$traceName} was started before.",pR["trace stopped"]="Trace {$traceName} is not running.",pR["no window"]="Window is not available.",pR["no app id"]="App id is not available.",pR["no project id"]="Project id is not available.",pR["no api key"]="Api key is not available.",pR["invalid cc log"]="Attempted to queue invalid cc event",pR["FB not default"]="Performance can only start when Firebase app instance is the default one.",pR["RC response not ok"]="RC response is not ok",pR["invalid attribute name"]="Attribute name {$attributeName} is invalid.",pR["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",pR["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",pR),TR=new wa("performance",_R,ER),SR=(IR.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},IR.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},IR.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},IR.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},IR.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},IR.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},IR.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},IR.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},IR.getInstance=function(){return void 0===dR&&(dR=new IR(yR)),dR},IR);function IR(t){if(!t)throw TR.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var CR,NR,AR,kR=(DR.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw TR.create("no app id");return t},DR.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw TR.create("no project id");return t},DR.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw TR.create("no api key");return t},DR.getInstance=function(){return void 0===mR&&(mR=new DR),mR},DR);function DR(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function RR(){return CR}(AR=NR=NR||{})[AR.UNKNOWN=0]="UNKNOWN",AR[AR.VISIBLE=1]="VISIBLE",AR[AR.HIDDEN=2]="HIDDEN",AR[AR.PRERENDER=3]="PRERENDER",AR[AR.UNLOADED=4]="UNLOADED";var OR=["firebase_","google_","ga_"],PR=new RegExp("^[a-zA-Z]\\w*$");function MR(){switch(SR.getInstance().document.visibilityState){case"visible":return NR.VISIBLE;case"hidden":return NR.HIDDEN;case"prerender":return NR.PRERENDER;default:return NR.UNKNOWN}}var xR=new Ga(_R);xR.logLevel=Ba.INFO;var LR="0.0.1",FR={loggingEnabled:!0},UR="FIREBASE_INSTALLATIONS_AUTH";function qR(t){var e=function(){var t=SR.getInstance().localStorage,e=t.getItem(wR);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(bR);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(BR(e),Promise.resolve()):function(r){return function(){var t=kR.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+kR.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+kR.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:UR+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:kR.getInstance().getAppId(),app_version:vR,sdk_version:LR})});return fetch(n).then(function(t){if(t.ok)return t.json();throw TR.create("RC response not ok")})}).catch(function(){xR.info(VR)})}(t).then(function(t){return BR(t)}).then(function(t){return function(t){if(!t)return;var e=SR.getInstance().localStorage;e.setItem(bR,JSON.stringify(t)),e.setItem(wR,String(Date.now()+60*kR.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var VR="Could not fetch config, will use default configs";function BR(t){if(!t)return t;var e=kR.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=FR.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=jR(e.tracesSamplingRate),e.logNetworkAfterSampling=jR(e.networkRequestsSamplingRate),t}function jR(t){return Math.random()<=t}var WR,KR=1;function QR(){return KR=2,WR=WR||function(){var n=SR.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=kR.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){CR=t}),t}()}).then(function(t){return qR(t)}).then(function(){return HR()},function(){return HR()})}function HR(){KR=3}var GR,zR=1e4,YR=3,XR=YR,JR=[];function $R(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw TR.create("invalid cc log");JR=na(JR,[t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function ZR(){if(GR)return GR;var t=$R(nO);return(GR=new Ga("@firebase/performance/cc")).logHandler=t,GR}function tO(t){var e=kR.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&SR.getInstance().requiredApisAvailable()&&(t.isAuto&&MR()!==NR.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===KR?eO(t):QR().then(function(){return eO(t)},function(){return eO(t)})))}function eO(t){RR()&&setTimeout(function(){return ZR().log(t,1)},0)}function nO(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:rO(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=iO(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=iO(n));var r={application_info:rO(),trace_metric:e};return JSON.stringify(r)}(t)}function rO(){return{google_app_id:kR.getInstance().getAppId(),app_instance_id:RR(),web_app_info:{sdk_version:vR,page_url:SR.getInstance().getUrl(),service_worker_status:function(){var t=SR.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:MR(),effective_connection_type:function(){var t=SR.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function iO(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==XR){if(!JR.length)return r(zR);var t=na(JR);JR=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:kR.getInstance().logSource,log_event:e};fetch(kR.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||xR.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?zR:Math.max(zR,e);XR=YR,r(n)}).catch(function(){JR=na(t,JR),XR--,xR.info("Tries left: "+XR+"."),r(zR)})}},t)}(5500);var oO=["_fp","_fcp","_fid"];var aO=(sO.prototype.start=function(){if(1!==this.state)throw TR.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},sO.prototype.stop=function(){if(2!==this.state)throw TR.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),tO(this)},sO.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Xo({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}tO(this)},sO.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},sO.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<oO.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw TR.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},sO.prototype.getMetric=function(t){return this.counters[t]||0},sO.prototype.putAttribute=function(t,e){var n=function(e){return!(0===e.length||40<e.length||OR.some(function(t){return e.startsWith(t)})||!e.match(PR))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw TR.create("invalid attribute name",{attributeName:t});if(!r)throw TR.create("invalid attribute value",{attributeValue:e})}},sO.prototype.getAttribute=function(t){return this.customAttributes[t]},sO.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},sO.prototype.getAttributes=function(){return Xo({},this.customAttributes)},sO.prototype.setStartTime=function(t){this.startTimeUs=t},sO.prototype.setDuration=function(t){this.durationUs=t},sO.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},sO.createOobTrace=function(t,e,n){var r=SR.getInstance().getUrl();if(r){var i=new sO("_wt_"+r,!0),o=Math.floor(1e3*SR.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}tO(i)}},sO.createUserTimingTrace=function(t){tO(new sO(t,!1,t))},sO);function sO(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=SR.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||gR+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function uO(t){var e=t;if(e&&void 0!==e.responseStart){var n=SR.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=kR.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return ZR().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var cO=5e3;function hO(){RR()&&(setTimeout(function(){return function(){var t=SR.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){aO.createOobTrace(e,n),r=void 0},cO);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),aO.createOobTrace(e,n,t))})}else aO.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=SR.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){uO(r[n])}t.setupObserver("resource",uO)}()},0),setTimeout(function(){return function(){for(var t=SR.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){lO(r[n])}t.setupObserver("measure",lO)}()},0))}function lO(t){var e=t.name;e.substring(0,gR.length)!==gR&&aO.createUserTimingTrace(e)}var fO=(pO.prototype.trace=function(t){return new aO(t)},Object.defineProperty(pO.prototype,"instrumentationEnabled",{get:function(){return kR.getInstance().instrumentationEnabled},set:function(t){kR.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(pO.prototype,"dataCollectionEnabled",{get:function(){return kR.getInstance().dataCollectionEnabled},set:function(t){kR.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),pO);function pO(t){this.app=t,SR.getInstance().requiredApisAvailable()?QR().then(hO,hO):xR.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}fl.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw TR.create("FB not default");if("undefined"==typeof window)throw TR.create("no window");return function(t){yR=t}(window),kR.getInstance().firebaseAppInstance=t,new fO(t)},{});var dO,yO,mO,vO,gO,bO="measurementId",wO="firebase_id",_O="origin";function EO(t){return Array.isArray(window[t])}function TO(t,n,e){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[n].push(arguments)};return window[e]&&"function"==typeof window[e]&&(r=window[e]),window[e]=function(f,p){return function(t,e,n){if(t===dO.EVENT){var r=[];if(n&&n.send_to){var i=n.send_to;Array.isArray(i)||(i=[i]);for(var o=0,a=i;o<a.length;o++){var s=a[o],u=p[s];if(!u){r=[];break}r.push(u)}}if(0===r.length)for(var c=0,h=Object.values(p);c<h.length;c++){var l=h[c];r.push(l)}Promise.all(r).then(function(){return f(dO.EVENT,e,n||{})}).catch(function(t){return console.error(t)})}else if(t===dO.CONFIG){(p[e]||Promise.resolve()).then(function(){f(dO.CONFIG,e,n)}).catch(function(t){return console.error(t)})}else f(dO.SET,e)}}(r,t),{gtagCore:r,wrappedGtag:window[e]}}(yO=dO=dO||{}).EVENT="event",yO.SET="set",yO.CONFIG="config",(vO=mO=mO||{}).ADD_PAYMENT_INFO="add_payment_info",vO.ADD_TO_CART="add_to_cart",vO.ADD_TO_WISHLIST="add_to_wishlist",vO.BEGIN_CHECKOUT="begin_checkout",vO.CHECKOUT_PROGRESS="checkout_progress",vO.EXCEPTION="exception",vO.GENERATE_LEAD="generate_lead",vO.LOGIN="login",vO.PAGE_VIEW="page_view",vO.PURCHASE="purchase",vO.REFUND="refund",vO.REMOVE_FROM_CART="remove_from_cart",vO.SCREEN_VIEW="screen_view",vO.SEARCH="search",vO.SELECT_CONTENT="select_content",vO.SET_CHECKOUT_OPTION="set_checkout_option",vO.SHARE="share",vO.SIGN_UP="sign_up",vO.TIMING_COMPLETE="timing_complete",vO.VIEW_ITEM="view_item",vO.VIEW_ITEM_LIST="view_item_list",vO.VIEW_PROMOTION="view_promotion",vO.VIEW_SEARCH_RESULTS="view_search_results";var SO,IO,CO=((gO={})["no-ga-id"]='"'+bO+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',gO["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",gO["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",gO),NO=new wa("analytics","Analytics",CO),AO={},kO="dataLayer",DO="gtag",RO=!1;function OO(t){if(RO)throw NO.create("already-initialized");t.dataLayerName&&(kO=t.dataLayerName),t.gtagName&&(DO=t.gtagName)}function PO(e,t){if(!e.options[bO])throw NO.create("no-ga-id");var r=e.options[bO];if(null!=AO[r])throw NO.create("already-exists",{id:r});if(!RO){EO(kO)||function(t){var e=document.createElement("script");e.src="https://www.googletagmanager.com/gtag/js?l="+t,e.async=!0,document.head.appendChild(e)}(kO),function(t){EO(t)?window[t]:window[t]=[]}(kO);var n=TO(AO,kO,DO),i=n.wrappedGtag,o=n.gtagCore;IO=i,SO=o,RO=!0}AO[r]=function(r,i){return Jo(this,void 0,void 0,function(){var e,n;return $o(this,function(t){switch(t.label){case 0:return[4,r.installations().getId()];case 1:return e=t.sent(),i("js",new Date),i(dO.CONFIG,r.options[bO],((n={})[wO]=e,n[_O]="firebase",n.update=!0,n)),[2]}})})}(e,SO);var a={app:e,logEvent:function(t,e,n){return function(t,e,n,r,i){var o=r||{};i&&i.global||(o=Xo(Xo({},r),{send_to:e})),t(dO.EVENT,n,o||{})}(IO,r,t,e,n)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(dO.SET,{screen_name:n}):t(dO.CONFIG,e,{update:!0,screen_name:n})}(IO,r,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(dO.SET,{user_id:n}):t(dO.CONFIG,e,{update:!0,user_id:n})}(IO,r,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(dO.SET,i)}else t(dO.CONFIG,e,{update:!0,user_properties:n})}(IO,r,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(e.options[bO],t)}};return t({INTERNAL:{analytics:{logEvent:a.logEvent}}}),a}fl.INTERNAL.registerService("analytics",PO,{settings:OO,EventName:mO},void 0,!1);var MO,xO=(LO.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},LO.prototype.fetch=function(a){return Jo(this,void 0,void 0,function(){var e,n,r,i,o;return $o(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=t.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(a.cacheMaxAgeMillis,n)?[2,r]:(a.eTag=r&&r.eTag,[4,this.client.fetch(a)]);case 2:return i=t.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return t.sent(),[2,i]}})})},LO);function LO(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}var FO=((MO={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",MO["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",MO["registration-api-key"]="Undefined API key. Check Firebase app initialization.",MO["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",MO["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",MO["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",MO["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",MO["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",MO["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",MO["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',MO["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',MO["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",MO["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",MO),UO=new wa("remoteconfig","Remote Config",FO);var qO=(VO.prototype.fetch=function(w){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,y,m,v,g,b;return $o(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=t.sent(),n=e[0],r=e[1],i=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",o=i+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":w.eTag||"*"},s={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:function(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}()},u={method:"POST",headers:a,body:JSON.stringify(s)},c=fetch(o,u),h=new Promise(function(t,e){w.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",e(t)})}),t.label=2;case 2:return t.trys.push([2,5,,6]),[4,Promise.race([c,h])];case 3:return t.sent(),[4,c];case 4:return l=t.sent(),[3,6];case 5:throw f=t.sent(),p="fetch-client-network","AbortError"===f.name&&(p="fetch-timeout"),UO.create(p,{originalErrorMessage:f.message});case 6:if(d=l.status,y=l.headers.get("ETag")||void 0,200!==l.status)return[3,11];g=void 0,t.label=7;case 7:return t.trys.push([7,9,,10]),[4,l.json()];case 8:return g=t.sent(),[3,10];case 9:throw b=t.sent(),UO.create("fetch-client-parse",{originalErrorMessage:b.message});case 10:m=g.entries,v=g.state,t.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===v?d=500:"NO_CHANGE"===v?d=304:"NO_TEMPLATE"!==v&&"EMPTY_CONFIG"!==v||(m={}),304!==d&&200!==d)throw UO.create("fetch-status",{httpStatus:d});return[2,{status:d,eTag:y,config:m}]}})})},VO);function VO(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var BO=(jO.prototype.addEventListener=function(t){this.listeners.push(t)},jO.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},jO);function jO(){this.listeners=[]}var WO=["1","true","t","yes","y","on"],KO=(QO.prototype.asString=function(){return this._value},QO.prototype.asBoolean=function(){return"static"!==this._source&&0<=WO.indexOf(this._value.toLowerCase())},QO.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},QO.prototype.getSource=function(){return this._source},QO);function QO(t,e){void 0===e&&(e=""),this._source=t,this._value=e}var HO=(GO.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=Ba.DEBUG;break;case"silent":this._logger.logLevel=Ba.SILENT;break;default:this._logger.logLevel=Ba.ERROR}},Object.defineProperty(GO.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(GO.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),GO.prototype.activate=function(){return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return e=t.sent(),n=e[0],r=e[1],n&&n.config&&n.eTag&&n.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(n.config),this._storage.setActiveConfigEtag(n.eTag)])]:[2,!1];case 2:return t.sent(),[2,!0]}})})},GO.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},GO.prototype.fetch=function(){return Jo(this,void 0,void 0,function(){var e=this;return $o(this,function(t){return[2,new Promise(function(o,a){return Jo(e,void 0,void 0,function(){var e,n,r,i=this;return $o(this,function(t){switch(t.label){case 0:e=new BO,setTimeout(function(){return Jo(i,void 0,void 0,function(){return $o(this,function(t){return e.abort(),[2]})})},this.settings.fetchTimeoutMillis),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:e})];case 2:return t.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return t.sent(),o(),[3,6];case 4:return n=t.sent(),r=function(t,e){return t instanceof ga&&-1!==t.code.indexOf(e)}(n,"fetch-throttle")?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(r)];case 5:return t.sent(),a(n),[3,6];case 6:return[2]}})})})]})})},GO.prototype.fetchAndActivate=function(){return Jo(this,void 0,void 0,function(){return $o(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},GO.prototype.getAll=function(){var n=this;return function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(Xo(Xo({},t),e))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},GO.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},GO.prototype.getNumber=function(t){return this.getValue(t).asNumber()},GO.prototype.getString=function(t){return this.getValue(t).asString()},GO.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new KO("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new KO("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new KO("static"))},GO);function GO(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function zO(t,e){var n=t.target.error||void 0;return UO.create(e,{originalErrorMessage:n&&n.message})}var YO="app_namespace_store",XO="firebase_remote_config",JO=1;var $O=(ZO.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},ZO.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},ZO.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},ZO.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},ZO.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},ZO.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},ZO.prototype.getActiveConfig=function(){return this.get("active_config")},ZO.prototype.setActiveConfig=function(t){return this.set("active_config",t)},ZO.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},ZO.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},ZO.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},ZO.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},ZO.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},ZO.prototype.get=function(s){return Jo(this,void 0,void 0,function(){var o,a=this;return $o(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(n,e){var t=o.transaction([YO],"readonly").objectStore(YO),r=a.createCompositeKey(s);try{var i=t.get(r);i.onerror=function(t){e(zO(t,"storage-get"))},i.onsuccess=function(t){var e=t.target.result;n(e?e.value:void 0)}}catch(t){e(UO.create("storage-get",{originalErrorMessage:t&&t.message}))}})]}})})},ZO.prototype.set=function(s,u){return Jo(this,void 0,void 0,function(){var o,a=this;return $o(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([YO],"readwrite").objectStore(YO),r=a.createCompositeKey(s);try{var i=n.put({compositeKey:r,value:u});i.onerror=function(t){e(zO(t,"storage-set"))},i.onsuccess=function(){t()}}catch(t){e(UO.create("storage-set",{originalErrorMessage:t&&t.message}))}})]}})})},ZO.prototype.delete=function(s){return Jo(this,void 0,void 0,function(){var o,a=this;return $o(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([YO],"readwrite").objectStore(YO),r=a.createCompositeKey(s);try{var i=n.delete(r);i.onerror=function(t){e(zO(t,"storage-delete"))},i.onsuccess=function(){t()}}catch(t){e(UO.create("storage-delete",{originalErrorMessage:t&&t.message}))}})]}})})},ZO.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},ZO);function ZO(t,e,n,r){void 0===r&&(r=new Promise(function(e,n){var t=indexedDB.open(XO,JO);t.onerror=function(t){n(zO(t,"storage-open"))},t.onsuccess=function(t){e(t.target.result)},t.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(YO,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}var tP=(eP.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},eP.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},eP.prototype.getActiveConfig=function(){return this.activeConfig},eP.prototype.loadFromStorage=function(){return Jo(this,void 0,void 0,function(){var e,n,r,i,o,a;return $o(this,function(t){switch(t.label){case 0:return e=this.storage.getLastFetchStatus(),n=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,e];case 1:return(i=t.sent())&&(this.lastFetchStatus=i),[4,n];case 2:return(o=t.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,r];case 3:return(a=t.sent())&&(this.activeConfig=a),[2]}})})},eP.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},eP.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},eP.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},eP);function eP(t){this.storage=t}var nP=(rP.prototype.fetch=function(n){return Jo(this,void 0,void 0,function(){var e;return $o(this,function(t){switch(t.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=t.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(n,e)]}})})},rP.prototype.attemptFetch=function(i,t){var o=t.throttleEndTimeMillis,a=t.backoffCount;return Jo(this,void 0,void 0,function(){var e,n,r;return $o(this,function(t){switch(t.label){case 0:return[4,function(i,o){return new Promise(function(t,e){var n=Math.max(o-Date.now(),0),r=setTimeout(t,n);i.addEventListener(function(){clearTimeout(r),e(UO.create("fetch-throttle",{throttleEndTimeMillis:o}))})})}(i.signal,o)];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this.client.fetch(i)];case 3:return e=t.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return t.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof ga))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(n=t.sent()))throw n;return r={throttleEndTimeMillis:Date.now()+function(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}(a),backoffCount:a+1},[4,this.storage.setThrottleMetadata(r)];case 6:return t.sent(),[2,this.attemptFetch(i,r)];case 7:return[2]}})})},rP);function rP(t,e){this.client=t,this.storage=e}var iP;return(iP=fl).INTERNAL.registerService("remoteConfig",function(t,e,n){if("undefined"==typeof window)throw UO.create("registration-window");var r=t.options,i=r.projectId,o=r.apiKey,a=r.appId;if(!i)throw UO.create("registration-project-id");if(!o)throw UO.create("registration-api-key");if(!a)throw UO.create("registration-app-id");n=n||"firebase";var s=new $O(a,t.name,n),u=new tP(s),c=new Ga("@firebase/remote-config");c.logLevel=Ba.ERROR;var h=new qO(t.installations(),iP.SDK_VERSION,n,i,o,a),l=new nP(h,s),f=new xO(l,s,u,c),p=new HO(t,f,u,s,c);return p.ensureInitialized(),p},void 0,void 0,!0),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),fl});
//# sourceMappingURL=firebase.js.map
