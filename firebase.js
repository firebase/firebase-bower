!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new E(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function u(t){return Boolean(t&&void 0!==t.length)}function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void c(r.promise,t)}s(r.promise,e)}else(1===n._state?s:c)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void f(function(t,e){return function(){t.apply(e,arguments)}}(n,t),e)}e._state=1,e._value=t,h(e)}catch(t){c(e,t)}}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new l(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!u(e))return i(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){if(!u(i))return e(new TypeError("Promise.race accepts an array"));for(var n=0,r=i.length;n<r;n++)o.resolve(i[n]).then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=n):p.Promise=o;function d(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function y(t){return F.call(t).slice(8,-1)}function g(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function b(t){return q(g(t))}function w(t){return"object"==typeof t?null!==t:"function"==typeof t}function _(t,e){if(!w(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!w(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function E(t,e){return V.call(t,e)}function T(t){return j?B.createElement(t):{}}function S(t){if(!w(t))throw TypeError(String(t)+" is not an object");return t}function I(e,n){try{z(O,e,n)}catch(t){O[e]=n}return n}function C(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++tt+et).toString(36)}function N(t){return nt[t]||(nt[t]=C(t))}var A,k,D,R="object",O=d(typeof globalThis==R&&globalThis)||d(typeof window==R&&window)||d(typeof self==R&&self)||d(typeof t==R&&t)||Function("return this")(),P=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),x={}.propertyIsEnumerable,M=Object.getOwnPropertyDescriptor,L={f:M&&!x.call({1:2},1)?function(t){var e=M(this,t);return!!e&&e.enumerable}:x},F={}.toString,U="".split,q=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==y(t)?U.call(t,""):Object(t)}:Object,V={}.hasOwnProperty,B=O.document,j=w(B)&&w(B.createElement),W=!P&&!m(function(){return 7!=Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a}),K=Object.getOwnPropertyDescriptor,Q={f:P?K:function(t,e){if(t=b(t),e=_(e,!0),W)try{return K(t,e)}catch(t){}if(E(t,e))return v(!L.f.call(t,e),t[e])}},H=Object.defineProperty,G={f:P?H:function(t,e,n){if(S(t),e=_(e,!0),S(n),W)try{return H(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},z=P?function(t,e,n){return G.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},Y=!1,X=e(function(t){var e="__core-js_shared__",n=O[e]||I(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),J=X("native-function-to-string",Function.toString),$=O.WeakMap,Z="function"==typeof $&&/native code/.test(J.call($)),tt=0,et=Math.random(),nt=X("keys"),rt={},it=O.WeakMap;if(Z){var ot=new it,at=ot.get,st=ot.has,ut=ot.set;A=function(t,e){return ut.call(ot,t,e),e},k=function(t){return at.call(ot,t)||{}},D=function(t){return st.call(ot,t)}}else{var ct=N("state");rt[ct]=!0,A=function(t,e){return z(t,ct,e),e},k=function(t){return E(t,ct)?t[ct]:{}},D=function(t){return E(t,ct)}}function ht(t){return"function"==typeof t?t:void 0}function lt(t,e){return arguments.length<2?ht(At[t])||ht(O[t]):At[t]&&At[t][e]||O[t]&&O[t][e]}function ft(t){return isNaN(t=+t)?0:(0<t?Dt:kt)(t)}function pt(t){return 0<t?Rt(ft(t),9007199254740991):0}function dt(s){return function(t,e,n){var r,i=b(t),o=pt(i.length),a=function(t,e){var n=ft(t);return n<0?Ot(n+e,0):Pt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function yt(t,e){var n,r=b(t),i=0,o=[];for(n in r)!E(rt,n)&&E(r,n)&&o.push(n);for(;e.length>i;)E(r,n=e[i++])&&(~xt(o,n)||o.push(n));return o}function mt(t,e){for(var n=qt(e),r=G.f,i=Q.f,o=0;o<n.length;o++){var a=n[o];E(t,a)||r(t,a,i(e,a))}}function vt(t,e){var n=jt[Bt(t)];return n==Kt||n!=Wt&&("function"==typeof e?m(e):!!e)}function gt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?O:c?O[s]||I(s,{}):(O[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Ht(n,r))&&a.value:n[r],!Qt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;mt(o,i)}(t.sham||i&&i.sham)&&z(o,"sham",!0),Nt(n,r,o,t)}}function bt(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function wt(r,i,t){if(bt(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function _t(t){return Object(g(t))}function Et(t){return Xt[t]||(Xt[t]=zt&&Yt[t]||(zt?Yt:C)("Symbol."+t))}function Tt(t,e){var n;return Gt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Gt(n.prototype)?w(n)&&null===(n=n[Jt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function St(p){var d=1==p,y=2==p,m=3==p,v=4==p,g=6==p,b=5==p||g;return function(t,e,n,r){for(var i,o,a=_t(t),s=q(a),u=wt(e,n,3),c=pt(s.length),h=0,l=r||Tt,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:$t.call(f,i)}else if(v)return!1;return g?-1:m||v?v:f}}function It(){}var Ct={set:A,get:k,has:D,enforce:function(t){return D(t)?k(t):A(t,{})},getterFor:function(n){return function(t){var e;if(!w(t)||(e=k(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},Nt=e(function(t){var e=Ct.get,s=Ct.enforce,u=String(J).split("toString");X("inspectSource",function(t){return J.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||E(n,"name")||z(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==O?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:z(t,e,n)):o?t[e]=n:I(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||J.call(this)})}),At=O,kt=Math.ceil,Dt=Math.floor,Rt=Math.min,Ot=Math.max,Pt=Math.min,xt={includes:dt(!0),indexOf:dt(!1)}.indexOf,Mt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=Mt.concat("length","prototype"),Ft={f:Object.getOwnPropertyNames||function(t){return yt(t,Lt)}},Ut={f:Object.getOwnPropertySymbols},qt=lt("Reflect","ownKeys")||function(t){var e=Ft.f(S(t)),n=Ut.f;return n?e.concat(n(t)):e},Vt=/#|\.prototype\./,Bt=vt.normalize=function(t){return String(t).replace(Vt,".").toLowerCase()},jt=vt.data={},Wt=vt.NATIVE="N",Kt=vt.POLYFILL="P",Qt=vt,Ht=Q.f,Gt=Array.isArray||function(t){return"Array"==y(t)},zt=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Yt=O.Symbol,Xt=X("wks"),Jt=Et("species"),$t=[].push,Zt={forEach:St(0),map:St(1),filter:St(2),some:St(3),every:St(4),find:St(5),findIndex:St(6)},te=Object.keys||function(t){return yt(t,Mt)},ee=P?Object.defineProperties:function(t,e){S(t);for(var n,r=te(e),i=r.length,o=0;o<i;)G.f(t,n=r[o++],e[n]);return t},ne=lt("document","documentElement"),re=N("IE_PROTO"),ie="prototype",oe=function(){var t,e=T("iframe"),n=Mt.length,r="script";for(e.style.display="none",ne.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),oe=t.F;n--;)delete oe[ie][Mt[n]];return oe()},ae=Object.create||function(t,e){var n;return null!==t?(It[ie]=S(t),n=new It,It[ie]=null,n[re]=t):n=oe(),void 0===e?n:ee(n,e)};rt[re]=!0;var se=Et("unscopables"),ue=Array.prototype;null==ue[se]&&z(ue,se,ae(null));function ce(t){ue[se][t]=!0}var he=Zt.find,le="find",fe=!0;le in[]&&Array(1)[le](function(){fe=!1}),gt({target:"Array",proto:!0,forced:fe},{find:function(t,e){return he(this,t,1<arguments.length?e:void 0)}}),ce(le);function pe(t,e,n){return wt(de,O[t].prototype[e],n)}var de=Function.call,ye=(pe("Array","find"),Zt.findIndex),me="findIndex",ve=!0;me in[]&&Array(1)[me](function(){ve=!1}),gt({target:"Array",proto:!0,forced:ve},{findIndex:function(t,e){return ye(this,t,1<arguments.length?e:void 0)}}),ce(me);function ge(s){return function(t,e){var n,r,i=String(g(t)),o=ft(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}pe("Array","findIndex");var be,we,_e,Ee={codeAt:ge(!1),charAt:ge(!0)},Te=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Se=N("IE_PROTO"),Ie=Object.prototype,Ce=Te?Object.getPrototypeOf:function(t){return t=_t(t),E(t,Se)?t[Se]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ie:null},Ne=Et("iterator"),Ae=!1;[].keys&&("next"in(_e=[].keys())?(we=Ce(Ce(_e)))!==Object.prototype&&(be=we):Ae=!0),null==be&&(be={}),E(be,Ne)||z(be,Ne,function(){return this});function ke(t,e,n){t&&!E(t=n?t:t.prototype,Me)&&xe(t,Me,{configurable:!0,value:e})}function De(){return this}function Re(){return this}function Oe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!Ve&&t in p)return p[t];switch(t){case"keys":case je:case We:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ae(Fe,{next:v(1,n)}),ke(t,r,!1),Le[r]=De}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Be]||p["@@iterator"]||i&&p[i],y=!Ve&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=Ce(m.call(new t)),qe!==Object.prototype&&u.next&&(Ce(u)!==qe&&(Ue?Ue(u,qe):"function"!=typeof u[Be]&&z(u,Be,Re)),ke(u,l,!0))),i==je&&d&&d.name!==je&&(f=!0,y=function(){return d.call(this)}),p[Be]!==y&&z(p,Be,y),Le[e]=y,i)if(c={values:s(je),keys:o?y:s("keys"),entries:s(We)},a)for(h in c)!Ve&&!f&&h in p||Nt(p,h,c[h]);else gt({target:e,proto:!0,forced:Ve||f},c);return c}var Pe={IteratorPrototype:be,BUGGY_SAFARI_ITERATORS:Ae},xe=G.f,Me=Et("toStringTag"),Le={},Fe=Pe.IteratorPrototype,Ue=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return S(t),function(t){if(!w(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),qe=Pe.IteratorPrototype,Ve=Pe.BUGGY_SAFARI_ITERATORS,Be=Et("iterator"),je="values",We="entries",Ke=Ee.charAt,Qe="String Iterator",He=Ct.set,Ge=Ct.getterFor(Qe);Oe(String,"String",function(t){He(this,{type:Qe,string:String(t),index:0})},function(){var t,e=Ge(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ke(n,r),e.index+=t.length,{value:t,done:!1})});function ze(e,t,n,r){try{return r?t(S(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&S(i.call(e)),t}}function Ye(t){return void 0!==t&&(Le.Array===t||tn[Ze]===t)}function Xe(t,e,n){var r=_(e);r in t?G.f(t,r,v(0,n)):t[r]=n}function Je(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),en))?n:nn?y(e):"Object"==(r=y(e))&&"function"==typeof e.callee?"Arguments":r}function $e(t){if(null!=t)return t[rn]||t["@@iterator"]||Le[Je(t)]}var Ze=Et("iterator"),tn=Array.prototype,en=Et("toStringTag"),nn="Arguments"==y(function(){return arguments}()),rn=Et("iterator"),on=Et("iterator"),an=!1;try{var sn=0,un={next:function(){return{done:!!sn++}},return:function(){an=!0}};un[on]=function(){return this},Array.from(un,function(){throw 2})}catch(To){}function cn(t,e){if(!e&&!an)return!1;var n=!1;try{var r={};r[on]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}var hn=!cn(function(t){Array.from(t)});gt({target:"Array",stat:!0,forced:hn},{from:function(t,e,n){var r,i,o,a,s=_t(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=$e(s);if(l&&(h=wt(h,2<c?n:void 0,2)),null==p||u==Array&&Ye(p))for(i=new u(r=pt(s.length));f<r;f++)Xe(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Xe(i,f,l?ze(a,h,[o.value,f],!0):o.value);return i.length=f,i}});At.Array.from;var ln=Object.assign,fn=!ln||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=ln({},t)[n]||te(ln({},e)).join("")!=r})?function(t,e){for(var n=_t(t),r=arguments.length,i=1,o=Ut.f,a=L.f;i<r;)for(var s,u=q(arguments[i++]),c=o?te(u).concat(o(u)):te(u),h=c.length,l=0;l<h;)s=c[l++],P&&!a.call(u,s)||(n[s]=u[s]);return n}:ln;gt({target:"Object",stat:!0,forced:Object.assign!==fn},{assign:fn});At.Object.assign;function pn(s){return function(t){for(var e,n=b(t),r=te(n),i=r.length,o=0,a=[];o<i;)e=r[o++],P&&!dn.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var dn=L.f,yn={entries:pn(!0),values:pn(!1)},mn=yn.entries;gt({target:"Object",stat:!0},{entries:function(t){return mn(t)}});At.Object.entries;var vn=yn.values;gt({target:"Object",stat:!0},{values:function(t){return vn(t)}});At.Object.values;function gn(t){if(function(t){var e;return w(t)&&(void 0!==(e=t[bn])?!!e:"RegExp"==y(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}var bn=Et("match"),wn=Et("match"),_n="".startsWith,En=Math.min;gt({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[wn]=!1,"/./"[e](n)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(g(this));gn(t);var r=pt(En(1<arguments.length?e:void 0,n.length)),i=String(t);return _n?_n.call(n,i,r):n.slice(r,r+i.length)===i}});pe("String","startsWith");gt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(g(this)),n="",r=ft(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});pe("String","repeat");function Tn(t){if(!w(t))return!1;var e=t[Cn];return void 0!==e?!!e:Gt(t)}var Sn,In=Et("species"),Cn=Et("isConcatSpreadable"),Nn=9007199254740991,An="Maximum allowed index exceeded",kn=!m(function(){var t=[];return t[Cn]=!1,t.concat()[0]!==t}),Dn=(Sn="concat",!m(function(){var t=[];return(t.constructor={})[In]=function(){return{foo:1}},1!==t[Sn](Boolean).foo}));gt({target:"Array",proto:!0,forced:!kn||!Dn},{concat:function(t){var e,n,r,i,o,a=_t(this),s=Tt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Tn(o=-1===e?a:arguments[e])){if(i=pt(o.length),Nn<u+i)throw TypeError(An);for(n=0;n<i;n++,u++)n in o&&Xe(s,u,o[n])}else{if(Nn<=u)throw TypeError(An);Xe(s,u++,o)}return s.length=u,s}});var Rn={};Rn[Et("toStringTag")]="z";var On="[object z]"!==String(Rn)?function(){return"[object "+Je(this)+"]"}:Rn.toString,Pn=Object.prototype;On!==Pn.toString&&Nt(Pn,"toString",On,{unsafe:!0});function xn(t){var e=At.Symbol||(At.Symbol={});E(e,t)||Kn(e,t,{value:Wn.f(t)})}function Mn(t,e){var n=ar[t]=ae(Zn[zn]);return Xn(n,{type:Gn,tag:t,description:e}),P||(n.description=e),n}function Ln(e,t){S(e);var n=b(t),r=te(n).concat(vr(n));return Qn(r,function(t){P&&!mr.call(n,t)||yr(e,t,n[t])}),e}function Fn(t,e){var n=b(t),r=_(e,!0);if(n!==$n||!E(ar,r)||E(sr,r)){var i=nr(n,r);return!i||!E(ar,r)||E(n,Hn)&&n[Hn][r]||(i.enumerable=!0),i}}function Un(t){var e=ir(b(t)),n=[];return Qn(e,function(t){E(ar,t)||E(rt,t)||n.push(t)}),n}var qn=Ft.f,Vn={}.toString,Bn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],jn={f:function(t){return Bn&&"[object Window]"==Vn.call(t)?function(t){try{return qn(t)}catch(t){return Bn.slice()}}(t):qn(b(t))}},Wn={f:Et},Kn=G.f,Qn=Zt.forEach,Hn=N("hidden"),Gn="Symbol",zn="prototype",Yn=Et("toPrimitive"),Xn=Ct.set,Jn=Ct.getterFor(Gn),$n=Object[zn],Zn=O.Symbol,tr=O.JSON,er=tr&&tr.stringify,nr=Q.f,rr=G.f,ir=jn.f,or=L.f,ar=X("symbols"),sr=X("op-symbols"),ur=X("string-to-symbol-registry"),cr=X("symbol-to-string-registry"),hr=X("wks"),lr=O.QObject,fr=!lr||!lr[zn]||!lr[zn].findChild,pr=P&&m(function(){return 7!=ae(rr({},"a",{get:function(){return rr(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=nr($n,e);r&&delete $n[e],rr(t,e,n),r&&t!==$n&&rr($n,e,r)}:rr,dr=zt&&"symbol"==typeof Zn.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Zn},yr=function(t,e,n){t===$n&&yr(sr,e,n),S(t);var r=_(e,!0);return S(n),E(ar,r)?(n.enumerable?(E(t,Hn)&&t[Hn][r]&&(t[Hn][r]=!1),n=ae(n,{enumerable:v(0,!1)})):(E(t,Hn)||rr(t,Hn,v(1,{})),t[Hn][r]=!0),pr(t,r,n)):rr(t,r,n)},mr=function(t){var e=_(t,!0),n=or.call(this,e);return!(this===$n&&E(ar,e)&&!E(sr,e))&&(!(n||!E(this,e)||!E(ar,e)||E(this,Hn)&&this[Hn][e])||n)},vr=function(t){var e=t===$n,n=ir(e?sr:b(t)),r=[];return Qn(n,function(t){!E(ar,t)||e&&!E($n,t)||r.push(ar[t])}),r};zt||(Nt((Zn=function(t){if(this instanceof Zn)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=C(e),r=function(t){this===$n&&r.call(sr,t),E(this,Hn)&&E(this[Hn],n)&&(this[Hn][n]=!1),pr(this,n,v(1,t))};return P&&fr&&pr($n,n,{configurable:!0,set:r}),Mn(n,e)})[zn],"toString",function(){return Jn(this).tag}),L.f=mr,G.f=yr,Q.f=Fn,Ft.f=jn.f=Un,Ut.f=vr,P&&(rr(Zn[zn],"description",{configurable:!0,get:function(){return Jn(this).description}}),Nt($n,"propertyIsEnumerable",mr,{unsafe:!0})),Wn.f=function(t){return Mn(Et(t),t)}),gt({global:!0,wrap:!0,forced:!zt,sham:!zt},{Symbol:Zn}),Qn(te(hr),function(t){xn(t)}),gt({target:Gn,stat:!0,forced:!zt},{for:function(t){var e=String(t);if(E(ur,e))return ur[e];var n=Zn(e);return ur[e]=n,cr[n]=e,n},keyFor:function(t){if(!dr(t))throw TypeError(t+" is not a symbol");if(E(cr,t))return cr[t]},useSetter:function(){fr=!0},useSimple:function(){fr=!1}}),gt({target:"Object",stat:!0,forced:!zt,sham:!P},{create:function(t,e){return void 0===e?ae(t):Ln(ae(t),e)},defineProperty:yr,defineProperties:Ln,getOwnPropertyDescriptor:Fn}),gt({target:"Object",stat:!0,forced:!zt},{getOwnPropertyNames:Un,getOwnPropertySymbols:vr}),gt({target:"Object",stat:!0,forced:m(function(){Ut.f(1)})},{getOwnPropertySymbols:function(t){return Ut.f(_t(t))}}),tr&&gt({target:"JSON",stat:!0,forced:!zt||m(function(){var t=Zn();return"[null]"!=er([t])||"{}"!=er({a:t})||"{}"!=er(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(w(e)||void 0!==t)&&!dr(t))return Gt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!dr(e))return e}),r[1]=e,er.apply(tr,r)}}),Zn[zn][Yn]||z(Zn[zn],Yn,Zn[zn].valueOf),ke(Zn,Gn),rt[Hn]=!0,xn("asyncIterator");var gr=G.f,br=O.Symbol;if(!(!P||"function"!=typeof br||"description"in br.prototype&&void 0===br().description)){var wr={},_r=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof _r?new br(e):void 0===e?br():br(e);return""===e&&(wr[n]=!0),n};mt(_r,br);var Er=_r.prototype=br.prototype;Er.constructor=_r;var Tr=Er.toString,Sr="Symbol(test)"==String(br("test")),Ir=/^Symbol\((.*)\)[^)]+$/;gr(Er,"description",{configurable:!0,get:function(){var t=w(this)?this.valueOf():this,e=Tr.call(t);if(E(wr,t))return"";var n=Sr?e.slice(7,-1):e.replace(Ir,"$1");return""===n?void 0:n}}),gt({global:!0,forced:!0},{Symbol:_r})}xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split"),xn("toPrimitive"),xn("toStringTag"),xn("unscopables"),ke(Math,"Math",!0),ke(O.JSON,"JSON",!0);At.Symbol;xn("dispose"),xn("observable"),xn("patternMatch"),xn("replaceAll");var Cr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Nr="Array Iterator",Ar=Ct.set,kr=Ct.getterFor(Nr),Dr=Oe(Array,"Array",function(t,e){Ar(this,{type:Nr,target:b(t),index:0,kind:e})},function(){var t=kr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");Le.Arguments=Le.Array,ce("keys"),ce("values"),ce("entries");var Rr=Et("iterator"),Or=Et("toStringTag"),Pr=Dr.values;for(var xr in Cr){var Mr=O[xr],Lr=Mr&&Mr.prototype;if(Lr){if(Lr[Rr]!==Pr)try{z(Lr,Rr,Pr)}catch(To){Lr[Rr]=Pr}if(Lr[Or]||z(Lr,Or,xr),Cr[xr])for(var Fr in Dr)if(Lr[Fr]!==Dr[Fr])try{z(Lr,Fr,Dr[Fr])}catch(To){Lr[Fr]=Dr[Fr]}}}Wn.f("iterator");function Ur(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function qr(r,t,e,i,o){function n(t){var n=s[t];Nt(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!w(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=O[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Qt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Wr.REQUIRED=!0;else if(Qt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=cn(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){Ur(t,u,r);var n=function(t,e,n){var r,i;return Ue&&"function"==typeof(r=e.constructor)&&r!==n&&w(i=r.prototype)&&i!==n.prototype&&Ue(t,i),t}(new a,t,u);return null!=e&&Kr(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,gt({global:!0,forced:u!=a},h),ke(u,r),o||e.setStrong(u,r,i),u}function Vr(t,e,n){for(var r in e)Nt(t,r,e[r],n);return t}function Br(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return bt(this),(r=void 0!==u)&&bt(u),null==t?new this:(i=[],r?(o=0,a=wt(u,2<s?n:void 0,2),Kr(t,function(t){i.push(a(t,o++))})):Kr(t,i.push,i),new this(i))}var jr=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Wr=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=G.f,r=C("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!w(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!E(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!E(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return jr&&a.REQUIRED&&o(t)&&!E(t,r)&&n(t),t}};rt[r]=!0}),Kr=(Wr.REQUIRED,Wr.fastKey,Wr.getWeakData,Wr.onFreeze,e(function(t){function f(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=wt(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=$e(t)))throw TypeError("Target is not iterable");if(Ye(a)){for(s=0,u=pt(t.length);s<u;s++)if((c=r?l(S(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=ze(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}})),Qr=Et("species"),Hr=G.f,Gr=Wr.fastKey,zr=Ct.set,Yr=Ct.getterFor,Xr={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Gr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),P?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){Ur(t,a,n),zr(t,{type:n,index:ae(null),first:void 0,last:void 0,size:0}),P||(t.size=0),null!=e&&Kr(e,t[i],t,r)}),s=Yr(n),u=function(t,e){var n,r=s(t),i=Gr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Vr(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,P?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),P?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=wt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Vr(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),P&&Hr(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Yr(e),o=Yr(r);Oe(t,e,function(t,e){zr(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),function(t){var e=lt(t),n=G.f;P&&e&&!e[Qr]&&n(e,Qr,{configurable:!0,get:function(){return this}})}(e)}};qr("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xr,!0),At.Map;gt({target:"Map",stat:!0},{from:Br});function Jr(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}gt({target:"Map",stat:!0},{of:Jr});function $r(){for(var t=S(this),e=bt(t.delete),n=!0,r=0,i=arguments.length;r<i;r++)n=n&&e.call(t,arguments[r]);return!!n}gt({target:"Map",proto:!0,real:!0,forced:Y},{deleteAll:function(){return $r.apply(this,arguments)}});function Zr(t){return Map.prototype.entries.call(t)}gt({target:"Map",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return!Kr(r,function(t,e){if(!i(e,t,n))return Kr.stop()},void 0,!0,!0).stopped}});function ti(t,e){var n,r=S(t).constructor;return void 0===r||null==(n=S(r)[ei])?e:bt(n)}var ei=Et("species");gt({target:"Map",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop(e)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{findKey:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;bt(n);var i=bt(r.has),o=bt(r.get),a=bt(r.set);return Kr(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});gt({target:"Map",proto:!0,real:!0,forced:Y},{includes:function(n){return Kr(Zr(S(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return Kr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;bt(e);var r=bt(n.set);return Kr(t,function(t){r.call(n,e(t),t)}),n}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{keyOf:function(n){return Kr(Zr(S(this)),function(t,e){if(e===n)return Kr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapKeys:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapValues:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{merge:function(t){for(var e=S(this),n=bt(e.set),r=0;r<arguments.length;)Kr(arguments[r++],n,e,!0);return e}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{reduce:function(n,t){var r,e,i=S(this),o=Zr(i);if(bt(n),1<arguments.length)r=t;else{if((e=o.next()).done)throw TypeError("Reduce of empty map with no initial value");r=e.value[1]}return Kr(o,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{update:function(t,e,n){var r=S(this),i=arguments.length;bt(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):bt(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}});qr("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xr),At.Set;gt({target:"Set",stat:!0},{from:Br}),gt({target:"Set",stat:!0},{of:Jr});gt({target:"Set",proto:!0,real:!0,forced:Y},{addAll:function(){return function(){for(var t=S(this),e=bt(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{deleteAll:function(){return $r.apply(this,arguments)}});function ni(t){return Set.prototype.values.call(t)}gt({target:"Set",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return!Kr(r,function(t){if(!i(t,t,n))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{difference:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e),r=bt(n.delete);return Kr(t,function(t){r.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Set"))),a=bt(o.add);return Kr(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t){if(i(t,t,n))return Kr.stop(t)},void 0,!1,!0).result}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{intersection:function(t){var e=S(this),n=new(ti(e,lt("Set"))),r=bt(e.has),i=bt(n.add);return Kr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isDisjointFrom:function(t){var e=S(this),n=bt(e.has);return!Kr(t,function(t){if(!0===n.call(e,t))return Kr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSubsetOf:function(t){var e=function(t){var e=$e(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return S(e.call(t))}(this),n=S(t),r=n.has;return"function"!=typeof r&&(n=new(lt("Set"))(t),r=bt(n.has)),!Kr(e,function(t){if(!1===r.call(n,t))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSupersetOf:function(t){var e=S(this),n=bt(e.has);return!Kr(t,function(t){if(!1===n.call(e,t))return Kr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{join:function(t){var e=S(this),n=ni(e),r=void 0===t?",":String(t),i=[];return Kr(n,i.push,i,!1,!0),i.join(r)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{map:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Set"))),a=bt(o.add);return Kr(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{reduce:function(e,t){var n,r,i=S(this),o=ni(i);if(bt(e),1<arguments.length)n=t;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return Kr(o,function(t){n=e(n,t,t,i)},void 0,!1,!0),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t){if(i(t,t,n))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{symmetricDifference:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e),r=bt(n.delete),i=bt(n.add);return Kr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{union:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e);return Kr(t,bt(n.add),n),n}});var ri=function(t,e){return(ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ii(t,e){function n(){this.constructor=t}ri(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oi=function(){return(oi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ai(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function si(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ui(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ci(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function hi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ci(arguments[e]));return t}function li(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function fi(t){try{return mi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var pi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},di=function(t,e){if(!t)throw yi(e)},yi=function(t){return new Error("Firebase Database ("+pi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},mi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(li(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function vi(t){return gi(void 0,t)}function gi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=gi(t[n],e[n]));return t}var bi=(wi.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},wi);function wi(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function _i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ei(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_i())}function Ti(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Si(){return!0===pi.NODE_ADMIN}var Ii,Ci=(ii(Ni,Ii=Error),Ni);function Ni(t,e){var n=Ii.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Ni.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ai.prototype.create),n}var Ai=(ki.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Di,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Ci(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},ki);function ki(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Di=/\{\$([^}]+)}/g;function Ri(t){return JSON.parse(t)}function Oi(t){return JSON.stringify(t)}function Pi(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ri(fi(o[0])||""),n=Ri(fi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function xi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mi(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Li(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Fi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Ui=(qi.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},qi.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},qi.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},qi.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},qi);function qi(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Vi(t,e){var n=new Bi(t,e);return n.subscribe.bind(n)}var Bi=(ji.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},ji.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},ji.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},ji.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Wi),void 0===r.error&&(r.error=Wi),void 0===r.complete&&(r.complete=Wi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},ji.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},ji.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},ji.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},ji.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},ji);function ji(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Wi(){}function Ki(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Qi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Hi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Qi(t,e,r)+"must be a valid function.")}function Gi(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Qi(t,e,r)+"must be a valid context object.")}function zi(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var Yi,Xi;(Xi=Yi=Yi||{})[Xi.DEBUG=0]="DEBUG",Xi[Xi.VERBOSE=1]="VERBOSE",Xi[Xi.INFO=2]="INFO",Xi[Xi.WARN=3]="WARN",Xi[Xi.ERROR=4]="ERROR",Xi[Xi.SILENT=5]="SILENT";function Ji(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Yi.DEBUG:case Yi.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var $i,Zi=Yi.INFO,to=(Object.defineProperty(eo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Yi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(eo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),eo.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.DEBUG].concat(t))},eo.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.VERBOSE].concat(t))},eo.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.INFO].concat(t))},eo.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.WARN].concat(t))},eo.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.ERROR].concat(t))},eo);function eo(t){this.name=t,this._logLevel=Zi,this._logHandler=Ji}var no=(($i={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",$i["bad-app-name"]="Illegal App name: '{$appName}",$i["duplicate-app"]="Firebase App named '{$appName}' already exists",$i["app-deleted"]="Firebase App named '{$appName}' already deleted",$i["duplicate-service"]="Firebase service named '{$appName}' already registered",$i["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",$i),ro=new Ai("app","Firebase",no),io="[DEFAULT]",oo=[],ao=(Object.defineProperty(so.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(so.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(so.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),so.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},so.prototype._getService=function(t,e){if(void 0===e&&(e=io),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==io?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},so.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=io),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},so.prototype.extendApp=function(t){var e=this;gi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(oo.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),oo=[])},so.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ro.create("app-deleted",{appName:this.name_})},so);function so(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=vi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){oo.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){oo=oo.filter(function(t){return t!==e})}}}ao.prototype.name&&ao.prototype.options||ao.prototype.delete||console.log("dc");var uo="6.4.0";var co=new to("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){co.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ho=self.firebase.SDK_VERSION;ho&&0<=ho.indexOf("LITE")&&co.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var lo=function t(){var e=function(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={}),"object"==typeof e&&null!==e||(e={name:e});var n=e;void 0===n.name&&(n.name=io);var r=n.name;if("string"!=typeof r||!r)throw ro.create("bad-app-name",{appName:String(r)});if(xi(o,r))throw ro.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:uo,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),s[n])throw ro.create("duplicate-service",{appName:n});function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw ro.create("invalid-app-argument",{appName:n});return t[n]()}return s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)})),void 0!==e&&gi(o,e),c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!xi(o,t=t||io))throw ro.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(0,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}(ao);return e.INTERNAL=oi({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){gi(e,t)},createSubscribe:Vi,ErrorFactory:Ai,deepExtend:gi}),e}(),fo=lo.initializeApp;lo.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&co.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),fo.apply(void 0,t)};var il=lo;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.o),reject:t(this.g)}},s.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.u(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.l(t):this.h(t)}},s.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},s.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.u=function(t){var e=this.f();t.Ha(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ha(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ha=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ha(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ha(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},h=this||self;function l(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),g=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.mb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).ad=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||h).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var M=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(l(t))return l(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=l(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=l(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=l(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=M(t,e)}function V(t,e){var n;return(n=0<=(e=M(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=l(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.na=!0,Y.prototype.ma=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.na=!0,tt.prototype.ma=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function vt(){this.a="",this.b=Et}function gt(t){return t instanceof vt&&t.constructor===vt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}vt.prototype.na=!0,vt.prototype.ma=function(){return this.a.toString()},vt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof vt?t:(t="object"==typeof t&&t.na?t.ma():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var _t,Et={};function Tt(t){var e=new vt;return e.a=t,e}Tt("about:blank");t:{var St=h.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.na=!0,Nt.prototype.ma=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Mt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){h.setTimeout(function(){throw t},0)}function Ft(){var t=h.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));x(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){h.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).ub;n.ub=null,t()}},function(t){r.next={ub:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(h.Promise&&h.Promise.resolve){var t=h.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(h.setImmediate)||h.Window&&h.Window.prototype&&!Ct("Edge")&&h.Window.prototype.setImmediate==h.setImmediate?(Rt=Rt||Ft())(t):h.setImmediate(t)}}(),qt||(Ot(),qt=!0),Vt.add(t,e)}Dt("<br>");var qt=!1,Vt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(E(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Cb:!0,value:n}:{Cb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Jc,t.Kc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Ub,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ha=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Jc=function(t){this.a=Wt,ee(this,Kt,t)},t.Kc=function(t){this.a=Wt,ee(this,Qt,t)},t.Ub=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.qa=this.qa,this.ia=this.ia}S(ue,C);var he=0;function le(t){if(!t.qa&&(t.qa=!0,t.va(),0!=he))t[e]||(t[e]=++g)}function fe(t){return fe[" "](t),t}ce.prototype.qa=!(ue.prototype.name="cancel"),ce.prototype.va=function(){if(this.ia)for(;this.ia.length;)this.ia.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ve=Ct("Edge"),ge=ve||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=h.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=h.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",p,e),h.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Ib=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=l(t.pointerType)?t.pointerType:xe[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Ib=!1},S(Pe,Oe);var xe=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.mb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var Me="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++Le,this.oa=this.Ga=!1}function Ue(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ga=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ga=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[Me]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[Me]?on(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[Me]?(t=t.m,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[Me])Ve(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.La||t.src;return t.Ga&&ze(t),n.call(r,e)}function $e(t,e){if(t.oa)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=h,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.m=new qe(this),(this.Nb=this).Ua=null}function rn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.La||a.src;a.Ga&&Ve(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ib}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw h.clearTimeout(r),t})}function cn(t){if(t.S&&"function"==typeof t.S)return t.S();if(l(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||l(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[Me]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Ua;if(n)for(e=[];n;n=n.Ua)e.push(n);n=this.Nb;var r=t.type||t;if(l(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.va=function(){if(nn.mb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Ua=null},(t=ln.prototype).S=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.m),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(xn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return l(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)vn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function xn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function Mn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){xn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.U=function(){On(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){On(this);var e=[];if(l(t))Mn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,Mn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return l(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.na&&(t=t.ma()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Mt(a.name),'"'),a.type){o.push(' type="',Mt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(l(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(l(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||v(o)&&0<o.nodeType?r(o):L(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return h.window&&h.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||h.window;var n="about:blank";t&&(n=gt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||h.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof vt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof vt||e instanceof vt||(e="object"==typeof e&&e.na?e.ma():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=gt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=gt(e).toString(),a&&(ge&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Mt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(gt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==h.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=h.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==h.WorkerGlobalScope&&"function"==typeof h.importScripts}function ur(){return il.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":il.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Qc:"FirebaseCore-web",Sc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return h.navigator&&h.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||h;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function vr(){try{var t=h.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!h.indexedDB}catch(t){return sr()&&!!h.indexedDB}return!1}function gr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&vr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return h.location&&h.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Er(t){return void 0===t?null:Qn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=h.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=h.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",h)&&!mr("fireauth.iframe",h))}Ar.prototype.get=function(){var t=h.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function xr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==Mr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,qr(t[n]));return e}function Vr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,Lr(this,zr,t),Lr(this,Gr,qr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=t[ii];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ti];if(n&&"object"==typeof n){e=n[si];var r=n[oi];if(n=n[ai],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",oi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",ai+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",si+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ti+" property must be a non null object when specified.");if(this.f=null,(e=t[ri])&&"object"==typeof e){if("string"==typeof(e=e[ui])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",ui+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",ri+" property must be a non null object when specified.");if(void 0!==(e=t[ni])&&"boolean"!=typeof e)throw new Yr("argument-error",ni+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ei])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",ei+" property must be a non empty string when specified.");this.i=t||null}var ti="android",ei="dynamicLinkDomain",ni="handleCodeInApp",ri="iOS",ii="url",oi="installApp",ai="minimumVersion",si="packageName",ui="bundleId";function ci(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var hi=null,li=null;function fi(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=li[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!hi){hi={},li={};for(var t=0;t<65;t++)hi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(li[hi[t]]=t)&&(li["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function pi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function di(t){return(t=yi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new pi(t):null}function yi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(fi(t))}catch(t){}return null}pi.prototype.f=function(){return this.b};var mi,vi={Wc:{Za:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://securetoken.googleapis.com/v1/token",id:"p"},Yc:{Za:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Zc:{Za:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",fb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function gi(t){for(var e in vi)if(vi[e].id===t)return{firebaseEndpoint:(t=vi[e]).Za,secureTokenEndpoint:t.fb};return null}mi=gi("__EID__")?"__EID__":void 0;var bi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),wi=["client_id","response_type","scope","redirect_uri","state"],_i={Rc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",eb:wi},Tc:{Ma:null,Ba:500,Aa:620,Na:"github.com",eb:wi},Uc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",eb:wi},$c:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",eb:bi}};function Ei(t){for(var e in _i)if(_i[e].Na==t)return _i[e];return null}function Ti(t){var e={};e["facebook.com"]=Ai,e["google.com"]=Di,e["github.com"]=ki,e["twitter.com"]=Ri;var n=t&&t[Ii];try{if(n)return e[n]?new e[n](t):new Ni(t);if(void 0!==t[Si])return new Ci(t)}catch(t){}return null}var Si="idToken",Ii="providerId";function Ci(t){var e=t[Ii];if(!e&&t[Si]){var n=di(t[Si]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Ni(t){Ci.call(this,t),Lr(this,"profile",qr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Ai(t){if(Ni.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function ki(t){if(Ni.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function Di(t){if(Ni.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ri(t){if(Ni.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Oi(t){this.a=_n(t)}function Pi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function xi(){}function Mi(t,n){return t.then(function(t){if(t[Sa]){var e=di(t[Sa]);if(!e||n!=e.c)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Li(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Fi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Ui(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Li(t.providerId,t.pendingToken)}catch(t){}return null}function qi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function Vi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Bi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new qi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function ji(t,e){this.Ac=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.vb={},this.$a=(Ei(t)||{}).Ma||null,this.Ya=null}function Wi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');ji.call(this,t,[])}function Ki(t){ji.call(this,t,wi),this.a=[]}function Qi(){Ki.call(this,"facebook.com")}function Hi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Qi).credential({accessToken:e})}function Gi(){Ki.call(this,"github.com")}function zi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Gi).credential({accessToken:e})}function Yi(){Ki.call(this,"google.com"),this.ua("profile")}function Xi(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new Yi).credential({idToken:n,accessToken:e})}function Ji(){ji.call(this,"twitter.com",bi)}function $i(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new qi("twitter.com",n,"twitter.com")}function Zi(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===eo.EMAIL_LINK_SIGN_IN_METHOD?eo.EMAIL_LINK_SIGN_IN_METHOD:eo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function to(t){return t&&t.email&&t.password?new Zi(t.email,t.password,t.signInMethod):null}function eo(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function no(t,e){if(!(e=ro(e)))throw new Yr("argument-error","Invalid email link!");return new Zi(t,e,eo.EMAIL_LINK_SIGN_IN_METHOD)}function ro(t){var e=wn((t=new Oi(t=Pi(t))).a,"oobCode")||null;return"signIn"===(wn(t.a,"mode")||null)&&e?e:null}function io(t){if(!(t.Sa&&t.Ra||t.Da&&t.$))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function oo(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new io(n)}return null}function ao(t){return t.a.Da&&t.a.$?{temporaryProof:t.a.Da,phoneNumber:t.a.$}:{sessionInfo:t.a.Sa,code:t.a.Ra}}function so(t){try{this.a=t||il.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function uo(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new io({Sa:t,Ra:e})}function co(t){if(t.temporaryProof&&t.phoneNumber)return new io({Da:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Xi(o,n);case"facebook.com":return Hi(n);case"github.com":return zi(n);case"twitter.com":return $i(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Li(e,a):new qi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Ki(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function ho(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function lo(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function fo(t){return(t=t||{}).type?new lo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody):null}function po(){this.b=null,this.a=[]}S(Ni,Ci),S(Ai,Ni),S(ki,Ni),S(Di,Ni),S(Ri,Ni),Li.prototype.ka=function(t){return ja(t,Fi(this))},Li.prototype.b=function(t,e){var n=Fi(this);return n.idToken=e,Wa(t,n)},Li.prototype.f=function(t,e){return Mi(Ka(t,Fi(this)),e)},Li.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},qi.prototype.ka=function(t){return ja(t,Vi(this))},qi.prototype.b=function(t,e){var n=Vi(this);return n.idToken=e,Wa(t,n)},qi.prototype.f=function(t,e){return Mi(Ka(t,Vi(this)),e)},qi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},ji.prototype.Ca=function(t){return this.vb=H(t),this},S(Wi,ji),S(Ki,ji),Ki.prototype.ua=function(t){return q(this.a,t)||this.a.push(t),this},Ki.prototype.Db=function(){return W(this.a)},Ki.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new qi(this.providerId,n,this.providerId)},S(Qi,Ki),Lr(Qi,"PROVIDER_ID","facebook.com"),Lr(Qi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(Gi,Ki),Lr(Gi,"PROVIDER_ID","github.com"),Lr(Gi,"GITHUB_SIGN_IN_METHOD","github.com"),S(Yi,Ki),Lr(Yi,"PROVIDER_ID","google.com"),Lr(Yi,"GOOGLE_SIGN_IN_METHOD","google.com"),S(Ji,ji),Lr(Ji,"PROVIDER_ID","twitter.com"),Lr(Ji,"TWITTER_SIGN_IN_METHOD","twitter.com"),Zi.prototype.ka=function(t){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,$a,{email:this.a,oobCode:this.c}):bs(t,ys,{email:this.a,password:this.c})},Zi.prototype.b=function(t,e){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,Za,{idToken:e,email:this.a,oobCode:this.c}):bs(t,cs,{idToken:e,email:this.a,password:this.c})},Zi.prototype.f=function(t,e){return Mi(this.ka(t),e)},Zi.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(eo,{PROVIDER_ID:"password"}),Fr(eo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(eo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),io.prototype.ka=function(t){return t.Ta(ao(this))},io.prototype.b=function(t,e){var n=ao(this);return n.idToken=e,bs(t,vs,n)},io.prototype.f=function(t,e){var n=ao(this);return n.operation="REAUTH",Mi(t=bs(t,gs,n),e)},io.prototype.A=function(){var t={providerId:"phone"};return this.a.Sa&&(t.verificationId=this.a.Sa),this.a.Ra&&(t.verificationCode=this.a.Ra),this.a.Da&&(t.temporaryProof=this.a.Da),this.a.$&&(t.phoneNumber=this.a.$),t},so.prototype.Ta=function(e,n){var r=this.a.c;return Yt(n.verify()).then(function(t){if(!l(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return bs(t,ss,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(so,{PROVIDER_ID:"phone"}),Fr(so,{PHONE_SIGN_IN_METHOD:"phone"}),lo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},lo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.A()}};var yo,mo=null;function vo(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function go(t,e,n){Yr.call(this,t,n),(t=e||{}).wb&&Lr(this,"email",t.wb),t.$&&Lr(this,"phoneNumber",t.$),t.credential&&Lr(this,"credential",t.credential)}function bo(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:co(t)};if(t.email)n.wb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new go(e,n,t.message)}return null}function wo(){}function _o(t){return t.c||(t.c=t.b())}function Eo(){}function To(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function So(){}function Io(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.ac,this),this.a.onerror=_(this.Eb,this),this.a.onprogress=_(this.bc,this),this.a.ontimeout=_(this.fc,this)}function Co(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function No(t,e,n){this.reset(t,e,n,void 0,void 0)}function Ao(t){this.f=t,this.b=this.c=this.a=null}function ko(t,e){this.name=t,this.value=e}S(vo,Yr),S(go,Yr),go.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.A();return e&&z(t,e),t},go.prototype.toJSON=function(){return this.A()},wo.prototype.c=null,S(Eo,wo),Eo.prototype.a=function(){var t=To(this);return t?new ActiveXObject(t):new XMLHttpRequest},Eo.prototype.b=function(){var t={};return To(this)&&(t[0]=!0,t[1]=!0),t},yo=new Eo,S(So,wo),So.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Io;throw Error("Unsupported browser")},So.prototype.b=function(){return{}},(t=Io.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.ac=function(){this.status=200,this.response=this.responseText=this.a.responseText,Co(this,4)},t.Eb=function(){this.status=500,this.response=this.responseText="",Co(this,4)},t.fc=function(){this.Eb()},t.bc=function(){this.status=200,Co(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},No.prototype.a=null,No.prototype.reset=function(t,e,n,r,i){delete this.a},ko.prototype.toString=function(){return this.name};var Do=new ko("SEVERE",1e3),Ro=new ko("WARNING",900),Oo=new ko("CONFIG",700),Po=new ko("FINE",500);Ao.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new No(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var xo,Mo={},Lo=null;function Fo(t){var e;if(Lo||(Lo=new Ao(""),(Mo[""]=Lo).c=Oo),!(e=Mo[t])){e=new Ao(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Fo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Mo[t]=e}return e}function Uo(t,e){t&&t.log(Po,e,void 0)}function qo(t){this.f=t}function Vo(t){nn.call(this),this.u=t,this.readyState=Bo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Fo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(qo,wo),qo.prototype.a=function(){return new Vo(this.f)},qo.prototype.b=(xo={},function(){return xo}),S(Vo,nn);var Bo=0;function jo(t){t.c.read().then(t.$b.bind(t)).catch(t.Ka.bind(t))}function Wo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Ko(t)}function Ko(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Qo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Ho,this.v=this.O=!1}(t=Vo.prototype).open=function(t,e){if(this.readyState!=Bo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Ko(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.ec.bind(this),this.Ka.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Wo(this,!1)),this.readyState=Bo},t.ec=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Ko(this)),this.a&&(this.readyState=3,Ko(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.cc.bind(this),this.Ka.bind(this)):void 0!==h.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,jo(this)):t.text().then(this.dc.bind(this),this.Ka.bind(this)))))},t.$b=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Wo(this,!0):Ko(this),3==this.readyState&&jo(this)}},t.dc=function(t){this.a&&(this.response=this.responseText=t,Wo(this,!0))},t.cc=function(t){this.a&&(this.response=t,Wo(this,!0))},t.Ka=function(t){var e=this.h;e&&e.log(Ro,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Wo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Ro,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Ro,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Qo,nn);var Ho="";Qo.prototype.b=Fo("goog.net.XhrIo");var Go=/^https?$/i,zo=["POST","PUT"];function Yo(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.N=n,e.G=!1,e.c=!0,e.a=e.B?e.B.a():yo.a(),e.w=e.B?_o(e.B):_o(yo),e.a.onreadystatechange=_(e.Hb,e);try{Uo(e.b,ia(e,"Opening Xhr")),e.I=!0,e.a.open(n,String(t),!0),e.I=!1}catch(t){return Uo(e.b,ia(e,"Error opening Xhr: "+t.message)),void Jo(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||l(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=Xo,n=t.length,r=l(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:l(t)?t.charAt(e):t[e]}(o.U()),r=h.FormData&&t instanceof h.FormData,!q(zo,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.o&&(e.a.responseType=e.o),"withCredentials"in e.a&&e.a.withCredentials!==e.O&&(e.a.withCredentials=e.O);try{ea(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Uo(e.b,ia(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ea,e)):e.u=sn(e.Ea,e.g,e)),Uo(e.b,ia(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Uo(e.b,ia(e,"Send error: "+t.message)),Jo(e,t)}}function Xo(t){return"content-type"==t.toLowerCase()}function Jo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,$o(t),ta(t)}function $o(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Zo(e){if(e.c&&void 0!==u)if(e.w[1]&&4==na(e)&&2==ra(e))Uo(e.b,ia(e,"Local request error detected and ignored"));else if(e.i&&4==na(e))sn(e.Hb,0,e);else if(e.dispatchEvent("readystatechange"),4==na(e)){Uo(e.b,ia(e,"Request complete")),e.c=!1;try{var t,n=ra(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&h.self&&h.self.location){var a=h.self.location.protocol;o=a.substr(0,a.length-1)}i=!Go.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<na(e)?e.a.statusText:""}catch(t){Uo(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+ra(e)+"]",$o(e)}}finally{ta(e)}}}function ta(e,t){if(e.a){ea(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Do,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ea(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(h.clearTimeout(t.u),t.u=null)}function na(t){return t.a?t.a.readyState:0}function ra(t){try{return 2<na(t)?t.a.status:-1}catch(t){return-1}}function ia(t,e){return e+" ["+t.N+" "+t.l+" "+ra(t)+"]"}function oa(t){var e=ma;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.m=0}function aa(t,e,n){t.a=!0,t.c=n,t.f=!e,ha(t)}function sa(t){if(t.a){if(!t.l)throw new la(t);t.l=!1}}function ua(t,e,n,r){t.g.push([e,n,r]),t.a&&ha(t)}function ca(t){return U(t.g,function(t){return m(t[1])})}function ha(e){if(e.h&&e.a&&ca(e)){var n=e.h,r=da[n];r&&(h.clearTimeout(r.a),delete da[n]),e.h=0}e.b&&(e.b.m--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.u,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof h.Promise&&n instanceof h.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ca(e)||(r=!0)}}e.c=n,t&&(s=_(e.o,e,!0),t=_(e.o,e,!1),n instanceof oa?(ua(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new pa(n),da[n.a]=n,e.h=n.a)}function la(){C.call(this)}function fa(){C.call(this)}function pa(t){this.a=h.setTimeout(_(this.c,this),0),this.b=t}(t=Qo.prototype).Ea=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Uo(this.b,ia(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Uo(this.b,ia(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ta(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ta(this,!0)),Qo.mb.va.call(this)},t.Hb=function(){this.qa||(this.I||this.i||this.f?Zo(this):this.tc())},t.tc=function(){Zo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Ho:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Do,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Uo(this.b,"Can not get response: "+t.message),null}},oa.prototype.cancel=function(t){if(this.a)this.c instanceof oa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new fa(this),sa(this),aa(this,!1,t))}},oa.prototype.o=function(t,e){this.i=!1,aa(this,t,e)},oa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ua(this,r,function(t){t instanceof fa?o.cancel():i(t)}),o.then(t,e,n)},oa.prototype.$goog_Thenable=!0,S(la,C),la.prototype.message="Deferred has already fired",la.prototype.name="AlreadyCalledError",S(fa,C),fa.prototype.message="Deferred was canceled",fa.prototype.name="CanceledError",pa.prototype.c=function(){throw delete da[this.a],this.b};var da={};function ya(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Jb:i,Ea:void 0},a=new oa(o);return e=window.setTimeout(function(){va(i,!0);var t=new wa(ba,"Timeout reached for loading script "+r);sa(a),aa(a,!1,t)},5e3),o.Ea=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(va(i,!1,e),sa(a),aa(a,!0,null))},i.onerror=function(){va(i,!0,e);var t=new wa(ga,"Error while loading script "+r);sa(a),aa(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=h.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function ma(){if(this&&this.Jb){var t=this.Jb;t&&"SCRIPT"==t.tagName&&va(t,!0,this.Ea)}}function va(t,e,n){null!=n&&h.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ga=0,ba=1;function wa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function _a(t){this.f=t}function Ea(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ia,this.f=H(t.secureTokenHeaders||Ca),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Na,this.a=H(t.firebaseHeaders||Aa),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==ur(),!(n=h.XMLHttpRequest||n&&il.INTERNAL.node&&il.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,sr()?this.c=new qo(self):cr()?this.c=new _a(n):this.c=new So}S(wa,C),S(_a,wo),_a.prototype.a=function(){return new this.f},_a.prototype.b=function(){return{}};var Ta,Sa="idToken",Ia=new Ar(3e4,6e4),Ca={"Content-Type":"application/x-www-form-urlencoded"},Na=new Ar(3e4,6e4),Aa={"Content-Type":"application/json"};function ka(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Da(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Ra(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ta=Ta||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{h[Pa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ua(t,null,e,void 0)}(ya(nt(Oa,{onload:Pa})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.l,t)))(e,n,r,i,o,a)}Ea.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===h.fetch||void 0===h.Headers||void 0===h.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Qo(this.c);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Uo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),Yo(a,t,e,r,i)};var Oa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Pa="__fcb"+Math.floor(1e6*Math.random()).toString();function xa(t){if(!l(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Ma(t){"email"in t&&xa(t)}function La(t){if(!t[Sa])throw new Yr("internal-error")}function Fa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Ea.prototype.l=function(t,n,r,i,o){var a=this;Ta.then(function(){window.gapi.client.setApiKey(a.b);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Ea.prototype.kb=function(){return bs(this,hs,{})},Ea.prototype.nb=function(t,e){return bs(this,us,{idToken:t,email:e})},Ea.prototype.ob=function(t,e){return bs(this,cs,{idToken:t,password:e})};var Ua={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function qa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function Va(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Mn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ba(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=bo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=bo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=bo(t)):t.errorMessage&&(e=ws(t.errorMessage)),e)throw e;if(!t[Sa])throw new Yr("internal-error")}function ja(t,e){return e.returnIdpCredential=!0,bs(t,ls,e)}function Wa(t,e){return e.returnIdpCredential=!0,bs(t,ps,e)}function Ka(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,bs(t,fs,e)}function Qa(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Ea.prototype).pb=function(t,r){var i={idToken:t},o=[];return K(Ua,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),bs(this,us,i)},t.hb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),bs(this,rs,t)},t.ib=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),bs(this,es,t)},t.gb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),bs(this,ns,t)},t.Ta=function(t){return bs(this,ms,t)},t.Xa=function(t,e){return bs(this,as,{oobCode:t,newPassword:e})},t.Ia=function(t){return bs(this,Ga,{oobCode:t})},t.Va=function(t){return bs(this,Ha,{oobCode:t})};var Ha={endpoint:"setAccountInfo",D:Qa,da:"email"},Ga={endpoint:"resetPassword",D:Qa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")}},za={endpoint:"signupNewUser",D:function(t){if(xa(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},Ya={endpoint:"createAuthUri"},Xa={endpoint:"deleteAccount",T:["idToken"]},Ja={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},$a={endpoint:"emailLinkSignin",T:["email","oobCode"],D:xa,J:La,R:!0},Za={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],D:xa,J:La,R:!0},ts={endpoint:"getAccountInfo"},es={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},ns={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},da:"email"},rs={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},is={sb:!0,endpoint:"getProjectConfig",Gb:"GET"},os={sb:!0,endpoint:"getRecaptchaParam",Gb:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},as={endpoint:"resetPassword",D:Qa,da:"email"},ss={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},us={endpoint:"setAccountInfo",T:["idToken"],D:Ma,R:!0},cs={endpoint:"setAccountInfo",T:["idToken"],D:function(t){if(Ma(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},hs={endpoint:"signupNewUser",J:La,R:!0},ls={endpoint:"verifyAssertion",D:qa,Oa:Va,J:Ba,R:!0},fs={endpoint:"verifyAssertion",D:qa,Oa:Va,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw ws(t.errorMessage);if(!t[Sa])throw new Yr("internal-error")},R:!0},ps={endpoint:"verifyAssertion",D:function(t){if(qa(t),!t.idToken)throw new Yr("internal-error")},Oa:Va,J:Ba,R:!0},ds={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},J:La,R:!0},ys={endpoint:"verifyPassword",D:function(t){if(xa(t),!t.password)throw new Yr("wrong-password")},J:La,R:!0},ms={endpoint:"verifyPhoneNumber",D:Fa,J:La},vs={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Fa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",bo(t);La(t)}},gs={Tb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Fa,J:La};function bs(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Xt(new Yr("internal-error"));var r,i=e.Gb||"POST";return Yt(n).then(e.D).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,r,i,o,n){var a=_n(t.g+e);bn(a,"key",t.b),n&&bn(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Ra(t,a.toString(),function(t){t?t.error?n(_s(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Tr(i)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Tb,e.sb||!1)}).then(function(t){return r=t,e.Oa?e.Oa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new Yr("internal-error");return r[e.da]})}function ws(t){return _s({error:{errors:[{message:t}],code:400,message:t}})}function _s(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Er(t)),new Yr("internal-error",e)}function Es(t){this.b=t,this.a=null,this.bb=function(o){return(Cs=Cs||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Ss.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();h[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(ya(r=nt(Ts,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Cs=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Is.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Ts=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Ss=new Ar(3e4,6e4),Is=new Ar(5e3,15e3),Cs=null;function Ns(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function As(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ks(t){try{return il.app(t).auth().ya()}catch(t){return[]}}function Ds(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function Rs(t){var s=Jn();return function(t){return bs(t,is,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new vo(Jn())})}function Os(i){return i.m||(i.m=ir().then(function(){if(!i.u){var t=i.c,e=i.h,n=ks(i.b),r=new Ns(i.l,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.u=r.toString()}i.i=new Es(i.u),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.bb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=fo(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.m}function Ps(t){return t.o||(t.v=t.c?dr(t.c,ks(t.b)):null,t.o=new Ea(t.f,gi(t.h),t.v)),t.o}function xs(t,e,n,r,i,o,a,s,u,c){return(t=new As(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=H(u||null),t.f=c,t.toString()}function Ms(t){if(this.a=t||il.INTERNAL.reactNative&&il.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ls(t){this.b=t,this.a={},this.f=_(this.c,this)}Ns.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):xn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):xn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):xn(this.a.a,"fw"),this.a.toString()},As.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.l),bn(t,"appName",this.c),bn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=il.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.Ya=n,bn(t,"providerId",this.a.providerId),n=Tr((e=this.a).vb))n[r]=n[r].toString();r=e.Ac,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.$a&&e.Ya&&!n[e.$a]&&(n[e.$a]=e.Ya),Q(n)||bn(t,"customParameters",Er(n))}if("function"==typeof this.a.Db&&((e=this.a.Db()).length&&bn(t,"scopes",e.join(","))),this.i?bn(t,"redirectUrl",this.i):xn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):xn(t.a,"eventId"),this.h?bn(t,"v",this.h):xn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.f?bn(t,"eid",this.f):xn(t.a,"eid"),(a=ks(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Ds.prototype).Bb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.fa().then(function(){(function(t){var e={type:"webStorageSupport"};return Os(t).then(function(){return function(e,n){return e.bb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Kb=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Fb=function(){return!1},t.zb=function(e,t,n,r,i,o,a){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.fa().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Rs(Ps(this)));var s=this;return this.a.then(function(){var t=s.fa().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){ho(n),a||$n(xs(s.l,s.f,s.b,t,n,null,o,s.c,void 0,s.h),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ab=function(t,e,n){this.a||(this.a=Rs(Ps(this)));var r=this;return this.a.then(function(){ho(e),$n(xs(r.l,r.f,r.b,t,e,Jn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.fa=function(){var t=this;return Os(this).then(function(){return t.i.bb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Mb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ja=function(e){B(this.g,function(t){return t==e})},(t=Ms.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Er(e)))},t.P=function(t){return Yt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Fs,Us=[];function qs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Vs(t){this.a=t}function Bs(t){this.c=t,this.b=!1,this.a=[]}function js(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Ws(r,c),t}).s(function(t){throw Ws(r,c),t})}function Ws(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function Ks(){if(!Gs())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=h.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var r=this;sr()&&self?(this.m=function(){var e=sr()?self:null;if(L(Us,function(t){t.b==e&&(n=t)}),!n){var n=new Ls(e);Us.push(n)}return n}(),qs(this.m,"keyChanged",function(t,n){return $s(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:q(e,n.key)}})}),qs(this.m,"ping",function(){return Yt(["keyChanged"])})):function(){var t=h.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Bs(new Vs(t)),js(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&q(t[0].value,"keyChanged")&&(r.u=!0)}).s(function(){}))})}function Qs(r){return new jt(function(e,n){var t=r.l.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Qs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Hs(t){return t.o||(t.o=Qs(t)),t.o}function Gs(){try{return!!h.indexedDB}catch(t){return!1}}function zs(t){return t.objectStore("firebaseLocalStorage")}function Ys(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Xs(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Js(t,e){return t.g&&t.h&&function(){var t=h.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?js(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Yt()}function $s(r){return Hs(r).then(function(t){var i=zs(Ys(t,!1));return i.getAll?Xs(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function Zs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function tu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(Gs()){var e=Ir(),n="__sak"+e;return Fs=Fs||new Ks,(i=Fs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.P(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.Y(function(e){L(r.a,function(t){t(e)})}),t})}function eu(){this.a={},this.type="inMemory"}function nu(){if(!function(){var t="Node"==ur();if(!(t=ru()||t&&il.INTERNAL.node&&il.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=ru()||il.INTERNAL.node.localStorage,this.type="localStorage"}function ru(){try{var t=h.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function iu(){this.type="nullStorage"}function ou(){if(!function(){var t="Node"==ur();if(!(t=au()||t&&il.INTERNAL.node&&il.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=au()||il.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function au(){try{var t=h.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function su(){var t={};t.Browser=hu,t.Node=lu,t.ReactNative=fu,t.Worker=pu,this.a=t[ur()]}Ls.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Cb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},Vs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Bs.prototype.close=function(){for(;0<this.a.length;)Ws(this,this.a[0]);this.b=!0},(t=Ks.prototype).set=function(n,r){var i,o=!1,a=this;return Hs(this).then(function(t){return Xs((t=zs(Ys(i=t,!0))).get(n))}).then(function(t){var e=zs(Ys(i,!0));return t?(t.value=r,Xs(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,Xs(e.add(t)))}).then(function(){return a.c[n]=r,Js(a,n)}).ha(function(){o&&a.b--})},t.get=function(e){return Hs(this).then(function(t){return Xs(zs(Ys(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.P=function(e){var n=!1,r=this;return Hs(this).then(function(t){return n=!0,r.b++,Xs(zs(Ys(t,!0)).delete(e))}).then(function(){return delete r.c[e],Js(r,e)}).ha(function(){n&&r.b--})},t.Y=function(t){0==this.a.length&&function(t){Zs(t),function e(){t.f=setTimeout(function(){t.i=$s(t).then(function(e){0<e.length&&L(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&Zs(this)},(t=tu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.P=function(e){return this.b.then(function(t){return t.P(e)})},t.Y=function(t){this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e})},(t=eu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.P=function(t){return delete this.a[t],Yt()},t.Y=function(){},t.ca=function(){},(t=nu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(t){h.window&&Ke(h.window,"storage",t)},t.ca=function(t){h.window&&Ge(h.window,"storage",t)},(t=iu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.P=function(){return Yt()},t.Y=function(){},t.ca=function(){},(t=ou.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var uu,cu,hu={C:nu,Qa:ou},lu={C:nu,Qa:ou},fu={C:Ms,Qa:iu},pu={C:nu,Qa:iu},du={Vc:"local",NONE:"none",Xc:"session"};function yu(){var t=!(Cr(yr())||!ar()),e=_r(),n=vr();this.o=t,this.h=e,this.m=n,this.a={},t=uu=uu||new su;try{this.g=!Xn()&&Rr()||!h.indexedDB?new t.a.C:new tu(sr()?new eu:new t.a.C)}catch(t){this.g=new eu,this.h=!0}try{this.i=new t.a.Qa}catch(t){this.i=new eu}this.l=new eu,this.f=_(this.Lb,this),this.b={}}function mu(){return cu=cu||new yu}function vu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function gu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function bu(t,e,n){return n=gu(e,n),"local"==e.C&&(t.b[n]=null),vu(t,e.C).P(n)}function wu(t){t.c&&(clearInterval(t.c),t.c=null)}function _u(t){this.a=t,this.b=mu()}(t=yu.prototype).get=function(t,e){return vu(this,t.C).get(gu(t,e))},t.set=function(e,t,n){var r=gu(e,n),i=this,o=vu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=gu(t,e),this.m&&(this.b[t]=h.localStorage.getItem(t)),Q(this.a)&&(vu(this,"local").Y(this.f),this.h||(Xn()||!Rr())&&h.indexedDB||!this.m||function(r){wu(r),r.c=setInterval(function(){for(var t in r.a){var e=h.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Lb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=gu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(vu(this,"local").ca(this.f),wu(this))},t.Lb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=h.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Wa(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?vu(this,"local").ca(this.f):wu(this),this.o)if(n=h.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?h.localStorage.setItem(e,r):h.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===h.localStorage.getItem(e)||(o.b[e]=h.localStorage.getItem(e),o.Wa(e))},me&&Ie&&10==Ie&&h.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.Wa,this))},t.Wa=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var Eu,Tu={name:"authEvent",C:"local"};function Su(){this.a=mu()}function Iu(t,e){this.b=Cu,this.f=h.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=h.Int32Array?new Int32Array(64):Array(64),void 0!==Eu||(Eu=h.Int32Array?new Int32Array(Pu):Pu),this.reset()}S(Iu,function(){this.b=-1});for(var Cu=64,Nu=Cu-1,Au=[],ku=0;ku<Nu;ku++)Au[ku]=0;var Du=j(128,Au);function Ru(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Eu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Ou(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(l(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Ru(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Ru(t),i=0)}}t.c=i,t.g+=n}Iu.prototype.reset=function(){this.g=this.c=0,this.a=h.Int32Array?new Int32Array(this.h):W(this.h)};var Pu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function xu(){Iu.call(this,8,Mu)}S(xu,Iu);var Mu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Lu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new Su,this.g=new _u(this.h),this.f=null,this.b=[],this.a=this.c=null}function Fu(t){return new Yr("invalid-cordova-configuration",t)}function Uu(t){var e=new xu;Ou(e,t),t=[];var n=8*e.g;e.c<56?Ou(e,Du,56-e.c):Ou(e,Du,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Ru(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function qu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Vu(r){return r.f||(r.f=r.fa().then(function(){return new jt(function(n){r.wa(function t(e){return n(e),r.Ja(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Bu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Pi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new lo(t.c,t.b,null,null,n):new lo(t.c,t.b,e,t.f)),e=n||o}qu(i,e)})}var o=new lo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Bu(i).then(function(){t||qu(i,o)})}),r=h.handleOpenURL;h.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",h).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},mo=mo||new po,function(t){var n=mo;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",h))&&t(null,n.b))}(e)}(r)})})),r.f}function Bu(e){var n=null;return function(t){return t.b.get(Tu,t.a).then(function(t){return fo(t)})}(e.g).then(function(t){return n=t,bu((t=e.g).b,Tu,t.a)}).then(function(){return n})}function ju(t){this.a=t,this.b=mu()}(t=Lu.prototype).fa=function(){return this.za?this.za:this.za=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=h.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",h))throw Fu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",h))throw Fu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",h))throw Fu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",h))throw Fu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Bb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.zb=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Mb=function(){return!1},t.Kb=function(){return!0},t.Fb=function(){return!0},t.Ab=function(t,e,n){if(this.c)return Xt(new Yr("redirect-operation-pending"));var r=this,i=h.document,o=null,a=null,s=null,u=null;return this.c=Yt().then(function(){return ho(e),Vu(r)}).then(function(){return function(n,t,e,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new lo(t,r,null,i,new Yr("no-auth-event")),a=mr("BuildInfo.packageName",h);if("string"!=typeof a)throw new Yr("invalid-cordova-configuration");var s=mr("BuildInfo.displayName",h),u={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))u.ibi=a;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));u.apn=a}s&&(u.appDisplayName=s),i=Uu(i),u.sessionId=i;var c=xs(n.l,n.i,n.m,t,e,null,r,n.o,u,n.u);return n.fa().then(function(){var t=n.h;return n.v.a.set(Tu,o.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",h);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",h)))throw new Yr("invalid-cordova-configuration");e(c)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",h)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(c,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new jt(function(e,t){a=function(){var t=mr("cordova.plugins.browsertab.close",h);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(a),s=function(){o=o||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},u=function(){kr()&&s()},i.addEventListener("resume",s,!1),yr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",u,!1)}).s(function(t){return Bu(r).then(function(){throw t})})}).ha(function(){s&&i.removeEventListener("resume",s,!1),u&&i.removeEventListener("visibilitychange",u,!1),o&&o.cancel(),a&&r.Ja(a),r.c=null})},t.wa=function(e){this.b.push(e),Vu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new lo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.Ja=function(e){B(this.b,function(t){return t==e})};var Wu={name:"pendingRedirect",C:"session"};function Ku(t){return bu(t.b,Wu,t.a)}function Qu(t,e,n){this.i={},this.v=0,this.B=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=_(this.u,this),this.b=new oc,this.w=new hc,this.g=new ju(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=Hu(this.B,this.l,this.o,mi)}function Hu(t,e,n,r){var i=il.SDK_VERSION||null;return or()?new Lu(t,e,n,i,r):new Ds(t,e,n,i,r)}function Gu(e){e.f||(e.f=!0,e.a.wa(e.m));var n=e.a;return e.a.fa().s(function(t){throw e.a==n&&e.reset(),t})}function zu(n){n.a.Kb()&&Gu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));tc(t)&&n.u(e)}),n.a.Fb()||ac(n.b)}function Yu(n,t){q(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Wu,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?Ku(n.g).then(function(){Gu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));tc(t)&&n.u(e)})}):zu(n)}).s(function(){zu(n)})}function Xu(t,e){B(t.h,function(t){return t==e})}Qu.prototype.reset=function(){this.f=!1,this.a.Ja(this.m),this.a=Hu(this.B,this.l,this.o),this.i={}},Qu.prototype.u=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.tb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return ac(this.b),e};var Ju=new Ar(2e3,1e4),$u=new Ar(3e4,6e4);function Zu(t,e,n,r,i,o){return t.a.zb(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function tc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function ec(e,t,n,r){var i;return function(t){return t.b.set(Wu,"pending",t.a)}(e.g).then(function(){return e.a.Ab(t,n,r).s(function(t){if(tc(t))throw new Yr("operation-not-supported-in-this-environment");return i=t,Ku(e.g).then(function(){throw i})}).then(function(){return e.a.Mb()?new jt(function(){}):Ku(e.g).then(function(){return e.la()}).then(function(){}).s(function(){})})})}function nc(t,e,n,r,i){return t.a.Bb(r,function(t){e.ga(n,null,t,i)},Ju.get())}Qu.prototype.la=function(){return this.b.la()};var rc={};function ic(t,e,n){var r=e+":"+n;return rc[r]||(rc[r]=new Qu(t,e,n)),rc[r]}function oc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function ac(t){t.g||(t.g=!0,cc(t,!1,null,null))}function sc(t){t.g&&!t.i&&cc(t,!1,null,null)}function uc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function cc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):uc(t,n):uc(t,{user:null}),t.f=[],t.c=[]}function hc(){}function lc(){this.qb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.qb},set:function(t){this.qb=t},enumerable:!1})}function fc(t,e){this.a=e,Lr(this,"verificationId",t)}function pc(t,e,n,r){return new so(t).Ta(e,n).then(function(t){return new fc(t,r)})}function dc(t){var e=yi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function yc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function mc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function vc(t){this.f=t,this.b=this.a=null,this.c=0}function gc(t,e){var n=e[Sa],r=e.refreshToken;e=bc(e.expiresIn),t.b=n,t.c=e,t.a=r}function bc(t){return T()+1e3*parseInt(t,10)}function wc(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?Ra(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?n(_s(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.f,t.m.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=bc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function _c(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Ec(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Tc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Sc(t,e,n){this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=il.SDK_VERSION?dr(il.SDK_VERSION):null,this.a=new Ea(this.l,gi(mi),t),this.c=new vc(this.a),Rc(this,e[Sa]),gc(this.c,e),Lr(this,"refreshToken",this.c.a),xc(this,n||{}),nn.call(this),this.I=!1,this.u&&gr()&&(this.i=ic(this.u,this.l,this.o)),this.N=[],this.h=null,this.w=function(e){return new yc(function(){return e.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.c.c-T()-3e5;return 0<t?t:0})}(this),this.V=_(this.Fa,this);var r=this;this.ja=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){Cc(r,t.c)},this.W=null}function Ic(t,e){t.X&&Ge(t.X,"languageCodeChanged",t.ta),(t.X=e)&&Ke(e,"languageCodeChanged",t.ta)}function Cc(t,e){t.O=e,Da(t.a,il.SDK_VERSION?dr(il.SDK_VERSION,t.O):null)}function Nc(t,e){t.W&&Ge(t.W,"frameworkChanged",t.sa),(t.W=e)&&Ke(e,"frameworkChanged",t.sa)}function Ac(e){try{return il.app(e.o).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.o+"'!")}}function kc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.V),Ke(t,"tokenChanged",t.V))}function Dc(t){Ge(t,"tokenChanged",t.V),t.w.stop()}function Rc(t,e){t.ra=e,Lr(t,"_lat",e)}function Oc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return $t(e).then(function(){return t})}function Pc(t){t.i&&!t.I&&(t.I=!0,Yu(t.i,t))}function xc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new _c(e.createdAt,e.lastLoginAt),providerData:[]})}function Mc(){}function Lc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Fc(t){return F(t.providerData,function(t){return t.providerId})}function Uc(t,e){e&&(qc(t,e.providerId),t.providerData.push(e))}function qc(t,e){B(t.providerData,function(t){return t.providerId==e})}function Vc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Bc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,providerData:[]}),t.metadata?Lr(e,"metadata",function(t){return new _c(t.a,t.b)}(t.metadata)):Lr(e,"metadata",new _c),L(t.providerData,function(t){Uc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.c,t.c),Lr(e,"refreshToken",e.c.a))}function jc(n){return n.F().then(function(t){var e=n.isAnonymous;return function(t,e){return bs(t.a,ts,{idToken:e}).then(_(t.uc,t))}(n,t).then(function(){return e||Vc(n,"isAnonymous",!1),t})})}function Wc(t,e){e[Sa]&&t.ra!=e[Sa]&&(gc(t.c,e),t.dispatchEvent(new Tc("tokenChanged")),Rc(t,e[Sa]),Vc(t,"refreshToken",t.c.a))}function Kc(t,e){return jc(t).then(function(){if(q(Fc(t),e))return Oc(t).then(function(){throw new Yr("provider-already-linked")})})}function Qc(t,e,n){return Ur({user:t,credential:co(e),additionalUserInfo:e=Ti(e),operationType:n})}function Hc(t,e){return Wc(t,e),t.reload().then(function(){return t})}function Gc(n,r,t,e,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ei(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.u&&t.isOAuthProvider&&(s=xs(n.u,n.l,n.o,r,t,null,a,il.SDK_VERSION||null));var u=er(s,o&&o.Ba,o&&o.Aa);return e=e().then(function(){if(Yc(n),!i)return n.F().then(function(){})}).then(function(){return Zu(n.i,u,r,t,a,!!s)}).then(function(){return new jt(function(t,e){n.ga(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.b=nc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),Xc(n,e,i)}function zc(e,t,n,r,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(Yc(e),!i)return e.F().then(function(){})}).then(function(){return e.aa=a,Oc(e)}).then(function(t){return e.ba&&(t=(t=e.ba).b.set(Zc,e.A(),t.a)),t}).then(function(){return ec(e.i,t,n,a)}).s(function(t){if(o=t,e.ba)return th(e.ba);throw o}).then(function(){if(o)throw o}),Xc(e,r,i)}function Yc(t){if(!t.i||!t.I){if(t.i&&!t.I)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function Xc(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Tc("userInvalidated")),e.h=t),t})}(t,e,n);return t.G.push(r),r.ha(function(){V(t.G,r)}),r}function Jc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Sa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Sc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Uc(r,Ur(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function $c(t){this.a=t,this.b=mu()}oc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},oc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(cc(this,!0,null,t.a),Yt()):e.xa(n,r)?function(e,t,n){n=n.xa(t.c,t.b);var r=t.g,i=t.f,o=t.h,a=!!t.c.match(/Redirect$/);n(r,i,o).then(function(t){cc(e,a,t,null)}).s(function(t){cc(e,a,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(cc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},oc.prototype.la=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un($u.get()).then(function(){t.b||(t.g=!0,cc(t,!0,null,e))})}(n))})},hc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ga(t.c,null,t.a,t.b),Yt()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ga(r,t,null,n)}).s(function(t){e.ga(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},fc.prototype.confirm=function(t){return t=uo(this.verificationId,t),this.a(t)},yc.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(mc(n,t)).then(function(){return e=h.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},yc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},vc.prototype.A=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},vc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?wc(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},_c.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Tc,Oe),S(Sc,nn),Sc.prototype.pa=function(t){this.ja=t,ka(this.a,t)},Sc.prototype.ea=function(){return this.ja},Sc.prototype.ya=function(){return W(this.O)},Sc.prototype.Fa=function(){this.w.b&&(this.w.stop(),this.w.start())},Lr(Sc.prototype,"providerId","firebase"),(t=Sc.prototype).reload=function(){var t=this;return Xc(this,Lc(this).then(function(){return jc(t).then(function(){return Oc(t)}).then(Mc)}))},t.Zb=function(t){return this.F(t).then(function(t){return new dc(t)})},t.F=function(t){var e=this;return Xc(this,Lc(this).then(function(){return e.c.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ra&&(Rc(e,t.accessToken),e.dispatchEvent(new Tc("tokenChanged"))),Vc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.uc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");xc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Ec(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Uc(this,e[n]);Vc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.vc=function(t){return xr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.cb(t)},t.cb=function(t){var e=this,n=null;return Xc(this,t.f(this.a,this.uid).then(function(t){return Wc(e,t),n=Qc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.mc=function(t){return xr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.ab(t)},t.ab=function(e){var n=this,r=null;return Xc(this,Kc(this,e.providerId).then(function(){return n.F()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Qc(n,t,"link"),Hc(n,t)}).then(function(){return r}))},t.nc=function(t,e){var n=this;return Xc(this,Kc(this,"phone").then(function(){return pc(Ac(n),t,e,_(n.ab,n))}))},t.wc=function(t,e){var n=this;return Xc(this,Yt().then(function(){return pc(Ac(n),t,e,_(n.cb,n))}),!0)},t.nb=function(e){var n=this;return Xc(this,this.F().then(function(t){return n.a.nb(t,e)}).then(function(t){return Wc(n,t),n.reload()}))},t.Nc=function(e){var n=this;return Xc(this,this.F().then(function(t){return e.b(n.a,t)}).then(function(t){return Wc(n,t),n.reload()}))},t.ob=function(e){var n=this;return Xc(this,this.F().then(function(t){return n.a.ob(t,e)}).then(function(t){return Wc(n,t),n.reload()}))},t.pb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Lc(this);var n=this;return Xc(this,this.F().then(function(t){return n.a.pb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Wc(n,t),Vc(n,"displayName",t.displayName||null),Vc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),Oc(n)}).then(Mc))},t.Lc=function(e){var n=this;return Xc(this,jc(this).then(function(t){return q(Fc(n),e)?function(t,e,n){return bs(t,Ja,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Fc(n),function(t){e[t]||qc(n,t)}),e[so.PROVIDER_ID]||Lr(n,"phoneNumber",null),Oc(n)}):Oc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return Xc(this,this.F().then(function(t){return bs(e.a,Xa,{idToken:t})}).then(function(){e.dispatchEvent(new Tc("userDeleted"))})).then(function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");Ic(e,null),Nc(e,null),e.G=[],e.B=!0,Dc(e),Lr(e,"refreshToken",null),e.i&&Xu(e.i,e)})},t.tb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ga=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.xb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.yb,this):"linkViaRedirect"==t&&(this.aa||null)==e?_(this.xb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?_(this.yb,this):null},t.oc=function(t){var e=this;return Gc(this,"linkViaPopup",t,function(){return Kc(e,t.providerId).then(function(){return Oc(e)})},!1)},t.xc=function(t){return Gc(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.pc=function(t){var e=this;return zc(this,"linkViaRedirect",t,function(){return Kc(e,t.providerId)},!1)},t.yc=function(t){return zc(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.xb=function(e,n,r){var i=this;this.b&&(this.b.cancel(),this.b=null);var o=null,t=this.F().then(function(t){return Wa(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Qc(i,t,"link"),Hc(i,t)}).then(function(){return o});return Xc(this,t)},t.yb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Xc(this,Yt().then(function(){return Mi(Ka(r.a,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Qc(r,t,"reauthenticate"),Wc(r,t),r.h=null,r.reload()}).then(function(){return i}),!0)},t.gb=function(e){var n=this,r=null;return Xc(this,this.F().then(function(t){return r=t,void 0===e||Q(e)?{}:ci(new Zr(e))}).then(function(t){return n.a.gb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.c.A(),redirectEventId:this.aa||null};return this.metadata&&z(e,this.metadata.A()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var Zc={name:"redirectUser",C:"session"};function th(t){return bu(t.b,Zc,t.a)}function eh(t){this.a=t,this.b=mu(),this.c=null,this.f=function(e){var n=ih("local"),r=ih("session"),i=ih("none");return function(n,r,i){var o=gu(r,i),a=vu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(h.localStorage.getItem(o))}catch(t){}if(e&&!t)return h.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&h.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(rh,e.a).then(function(t){return t?ih(t):n})})})}).then(function(t){return e.c=t,nh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(ih("local"),this.a,_(this.g,this))}function nh(t,e){var n,r=[];for(n in du)du[n]!==e&&r.push(bu(t.b,ih(du[n]),t.a));return r.push(bu(t.b,rh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],E(t,a),o);else n(i)})}(r)}eh.prototype.g=function(){var e=this,n=ih("local");uh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return nh(e,"local").then(function(){e.c=n})})})};var rh={name:"persistence",C:"session"};function ih(t){return{name:"authUser",C:t}}function oh(t,e){return uh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function ah(t){return uh(t,function(){return bu(t.b,t.c,t.a)})}function sh(t,e){return uh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Jc(t||{})})})}function uh(t,e){return t.f=t.f.then(e,e),t.f}function ch(t){if(this.l=!1,Lr(this,"settings",new lc),Lr(this,"app",t),!vh(this).options||!vh(this).options.apiKey)throw new Yr("invalid-api-key");t=il.SDK_VERSION?dr(il.SDK_VERSION):null,this.c=new Ea(vh(this).options&&vh(this).options.apiKey,gi(mi),t),this.N=[],this.o=[],this.I=[],this.Pb=il.INTERNAL.createSubscribe(_(this.ic,this)),this.O=void 0,this.Qb=il.INTERNAL.createSubscribe(_(this.jc,this)),yh(this,null),this.h=new eh(vh(this).options.apiKey+":"+vh(this).name),this.w=new $c(vh(this).options.apiKey+":"+vh(this).name),this.V=_h(this,function(n){var t=vh(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(Zc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Jc(t||{})})}(e.w,vh(e).options.authDomain).then(function(t){return(e.B=t)&&(t.ba=e.w),th(e.w)});return _h(e,t)}(n).then(function(){return sh(n.h,t)}).then(function(e){return e?(e.ba=n.w,n.B&&(n.B.aa||null)==(e.aa||null)?e:e.reload().then(function(){return oh(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:ah(n.h)})):null}).then(function(t){yh(n,t||null)});return _h(n,e)}(this)),this.i=_h(this,function(e){return e.V.then(function(){return ph(e)}).s(function(){}).then(function(){if(!e.l)return e.ja()}).s(function(){}).then(function(){if(!e.l){e.X=!0;var t=e.h;t.b.addListener(ih("local"),t.a,e.ja)}})}(this)),this.X=!1,this.ja=_(this.Ic,this),this.Fa=_(this.Z,this),this.ra=_(this.Xb,this),this.sa=_(this.gc,this),this.ta=_(this.hc,this),this.a=null,function(e){var n=vh(e).options.authDomain,r=vh(e).options.apiKey;n&&gr()&&(e.Ob=e.V.then(function(){if(!e.l){if(e.a=ic(n,r,vh(e).name),Yu(e.a,e),gh(e)&&Pc(gh(e)),e.B){Pc(e.B);var t=e.B;t.pa(e.ea()),Ic(t,e),Cc(t=e.B,e.G),Nc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.qc,this),this.u=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function hh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function lh(t){Oe.call(this,"frameworkChanged"),this.c=t}function fh(t){return t.Ob||Xt(new Yr("auth-domain-config-required"))}function ph(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=fh(t).then(function(){return t.a.la()}).then(function(t){return t?Ur(t):null});return _h(t,e)}function dh(e,t){var n={};return n.apiKey=vh(e).options.apiKey,n.authDomain=vh(e).options.authDomain,n.appName=vh(e).name,e.V.then(function(){return function(t,e,n,r){var i=new Sc(t,e);return n&&(i.ba=n),r&&Cc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.ya())}).then(function(t){return gh(e)&&t.uid==gh(e).uid?Bc(gh(e),t):(yh(e,t),Pc(t)),e.Z(t)}).then(function(){wh(e)})}function yh(t,e){gh(t)&&(function(t,e){B(t.N,function(t){return t==e})}(gh(t),t.Fa),Ge(gh(t),"tokenChanged",t.ra),Ge(gh(t),"userDeleted",t.sa),Ge(gh(t),"userInvalidated",t.ta),Dc(gh(t))),e&&(e.N.push(t.Fa),Ke(e,"tokenChanged",t.ra),Ke(e,"userDeleted",t.sa),Ke(e,"userInvalidated",t.ta),0<t.u&&kc(e)),Lr(t,"currentUser",e),e&&(e.pa(t.ea()),Ic(e,t),Cc(e,t.G),Nc(e,t))}function mh(e,t){var n=null,r=null;return _h(e,t.then(function(t){return n=co(t),r=Ti(t),dh(e,t)}).then(function(){return Ur({user:gh(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function vh(t){return t.app}function gh(t){return t.currentUser}function bh(t){return gh(t)&&gh(t)._lat||null}function wh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](bh(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](bh(t))}}function _h(t,e){return t.N.push(e),e.ha(function(){V(t.N,e)}),e}function Eh(){}function Th(){this.a={},this.b=1e12}eh.prototype.jb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in du)if(du[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!vr()&&"none"!==t)throw n}}(e),uh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,nh(r,e)}).then(function(){if(r.c=ih(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(ch,nn),S(hh,Oe),S(lh,Oe),(t=ch.prototype).jb=function(t){return t=this.h.jb(t),_h(this,t)},t.pa=function(t){this.W===t||this.l||(this.W=t,ka(this.c,this.W),this.dispatchEvent(new hh(this.ea())))},t.ea=function(){return this.W},t.Oc=function(){var t=h.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.qc=function(t){this.G.push(t),Da(this.c,il.SDK_VERSION?dr(il.SDK_VERSION,this.G):null),this.dispatchEvent(new lh(this.G))},t.ya=function(){return W(this.G)},t.toJSON=function(){return{apiKey:vh(this).options.apiKey,authDomain:vh(this).options.authDomain,appName:vh(this).name,currentUser:gh(this)&&gh(this).A()}},t.tb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ga=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.Wb,this):null},t.Wb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=ja(r.c,t).then(function(t){return i=co(t),o=Ti(t),t});return _h(this,t=r.V.then(function(){return a}).then(function(t){return dh(r,t)}).then(function(){return Ur({user:gh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Gc=function(e){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ei(e.providerId),r=Ir(),i=null;(!_r()||ar())&&vh(this).options.authDomain&&e.isOAuthProvider&&(i=xs(vh(this).options.authDomain,vh(this).options.apiKey,vh(this).name,"signInViaPopup",e,null,r,il.SDK_VERSION||null));var o=er(i,t&&t.Ba,t&&t.Aa);return _h(this,t=fh(this).then(function(t){return Zu(t,o,"signInViaPopup",e,r,!!i)}).then(function(){return new jt(function(t,e){n.ga("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.b=nc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Hc=function(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return _h(this,fh(this).then(function(){return function(t){return uh(t,function(){return t.b.set(rh,t.c.C,t.a)})}(e.h)}).then(function(){return ec(e.a,"signInViaRedirect",t)}))},t.la=function(){var e=this;return ph(this).then(function(t){return e.a&&sc(e.a.b),t}).s(function(t){throw e.a&&sc(e.a.b),t})},t.Mc=function(t){if(!t)return Xt(new Yr("null-user"));var e=this,n={};n.apiKey=vh(this).options.apiKey,n.authDomain=vh(this).options.authDomain,n.appName=vh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.c,o={};return o[Sa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Sc(e,o),n&&(e.ba=n),r&&Cc(e,r),Bc(e,t),e}(t,n,e.w,e.ya());return _h(this,this.i.then(function(){if(vh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return gh(e)&&t.uid==gh(e).uid?(Bc(gh(e),t),e.Z(t)):(yh(e,r),Pc(r),e.Z(r))}).then(function(){wh(e)}))},t.lb=function(){var t=this,e=this.i.then(function(){return t.a&&sc(t.a.b),gh(t)?(yh(t,null),ah(t.h).then(function(){wh(t)})):Yt()});return _h(this,e)},t.Ic=function(){var r=this;return sh(this.h,vh(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=gh(r)&&t){e=gh(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Bc(gh(r),t),gh(r).F();(gh(r)||t)&&(yh(r,t),t&&(Pc(t),t.ba=r.w),r.a&&Yu(r.a,r),wh(r))}})},t.Z=function(t){return oh(this.h,t)},t.Xb=function(){wh(this),this.Z(gh(this))},t.gc=function(){this.lb()},t.hc=function(){this.lb()},t.ic=function(t){var e=this;this.addAuthTokenListener(function(){t.next(gh(e))})},t.jc=function(t){var e=this;!function(t,e){t.I.push(e),_h(t,t.i.then(function(){!t.l&&q(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(bh(t)))}))}(this,function(){t.next(gh(e))})},t.sc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){m(t)?t(gh(r)):m(t.next)&&t.next(gh(r))}),this.Pb(t,e,n)},t.rc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),m(t)?t(gh(r)):m(t.next)&&t.next(gh(r))}),this.Qb(t,e,n)},t.Yb=function(t){var e=this,n=this.i.then(function(){return gh(e)?gh(e).F(t).then(function(t){return{accessToken:t}}):null});return _h(this,n)},t.Cc=function(t){var n=this;return this.i.then(function(){return mh(n,bs(n.c,ds,{token:t}))}).then(function(t){var e=t.user;return Vc(e,"isAnonymous",!1),n.Z(e),t})},t.Dc=function(t,e){var n=this;return this.i.then(function(){return mh(n,bs(n.c,ys,{email:t,password:e}))})},t.Sb=function(t,e){var n=this;return this.i.then(function(){return mh(n,bs(n.c,za,{email:t,password:e}))})},t.Pa=function(t){var e=this;return this.i.then(function(){return mh(e,t.ka(e.c))})},t.Bc=function(t){return xr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Pa(t)},t.kb=function(){var n=this;return this.i.then(function(){var t=gh(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):mh(n,n.c.kb()).then(function(t){var e=t.user;return Vc(e,"isAnonymous",!0),n.Z(e),t})})},t.getUid=function(){return gh(this)&&gh(this).uid||null},t.Rb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&gh(this)&&kc(gh(this))},t.zc=function(e){var n=this;L(this.o,function(t){t==e&&n.u--}),this.u<0&&(this.u=0),0==this.u&&gh(this)&&Dc(gh(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),_h(this,this.i.then(function(){e.l||q(e.o,t)&&t(bh(e))}))},t.removeAuthTokenListener=function(e){B(this.o,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(ih("local"),t.a,this.ja),this.a&&(Xu(this.a,this),sc(this.a.b)),Promise.resolve()},t.Vb=function(t){return _h(this,function(t,e){return bs(t,Ya,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.c,t))},t.kc=function(t){return!!ro(t)},t.ib=function(e,n){var r=this;return _h(this,Yt().then(function(){var t=new Zr(n);if(!t.c)throw new Yr("argument-error",ni+" must be true when sending sign in link to email");return ci(t)}).then(function(t){return r.c.ib(e,t)}).then(function(){}))},t.Pc=function(t){return this.Ia(t).then(function(t){return t.data.email})},t.Xa=function(t,e){return _h(this,this.c.Xa(t,e).then(function(){}))},t.Ia=function(t){return _h(this,this.c.Ia(t).then(function(t){return new Vr(t)}))},t.Va=function(t){return _h(this,this.c.Va(t).then(function(){}))},t.hb=function(e,t){var n=this;return _h(this,Yt().then(function(){return void 0===t||Q(t)?{}:ci(new Zr(t))}).then(function(t){return n.c.hb(e,t)}).then(function(){}))},t.Fc=function(t,e){return _h(this,pc(this,t,e,_(this.Pa,this)))},t.Ec=function(e,n){var r=this;return _h(this,Yt().then(function(){var t=no(e,n||Jn());return r.Pa(t)}))},Eh.prototype.render=function(){},Eh.prototype.reset=function(){},Eh.prototype.getResponse=function(){},Eh.prototype.execute=function(){};var Sh=null;function Ih(t,e){return(e=Ch(e))&&t.a[e]||null}function Ch(t){return(t=void 0===t?1e12:t)?t.toString():null}function Nh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function Ah(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function kh(){}Th.prototype.render=function(t,e){return this.a[this.b.toString()]=new Nh(t,e),this.b++},Th.prototype.reset=function(t){var e=Ih(this,t);t=Ch(t),e&&t&&(e.delete(),delete this.a[t])},Th.prototype.getResponse=function(t){return(t=Ih(this,t))?t.getResponse():null},Th.prototype.execute=function(t){(t=Ih(this,t))&&t.execute()},Nh.prototype.getResponse=function(){return Ah(this),this.b},Nh.prototype.execute=function(){Ah(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},Nh.prototype.delete=function(){Ah(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},kh.prototype.g=function(){return Yt(Sh=Sh||new Th)},kh.prototype.c=function(){};var Dh=null;function Rh(){this.b=h.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Oh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Ph=new Ar(3e4,6e4);Rh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Ph.get());!h.grecaptcha||i!==o.f&&!o.b?(h[o.a]=function(){if(h.grecaptcha){o.f=i;var n=h.grecaptcha.render;h.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(h.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete h[o.a]},Yt(ya(nt(Oh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(h.grecaptcha))})},Rh.prototype.c=function(){this.b--};var xh=null;function Mh(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.l=e,this.g=null,a=a?Dh=Dh||new kh:xh=xh||new Rh,this.o=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Uh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[qh],!h.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Ea(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.m=[];var u=this.a[Lh];this.a[Lh]=function(t){if(Vh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,h);"function"==typeof e&&e(t)}};var c=this.a[Fh];this.a[Fh]=function(){if(Vh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,h);"function"==typeof t&&t()}}}var Lh="callback",Fh="expired-callback",Uh="sitekey",qh="size";function Vh(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function Bh(t,e){return t.h.push(e),e.ha(function(){V(t.h,e)}),e}function jh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Wh(t,e,n){var r=!1;try{this.b=n||il.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=il.SDK_VERSION?dr(il.SDK_VERSION,o):null,Mh.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,gi(mi),r)}function Kh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Qh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Qh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Mh.prototype).za=function(){var e=this;return this.f?this.f:this.f=Bh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.o.g(e.v())}).then(function(t){return e.g=t,bs(e.u,os,{})}).then(function(t){e.a[Uh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){jh(this);var n=this;return Bh(this,this.za().then(function(){if(null===n.c){var t=n.l;if(!n.i){var e=Vn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){jh(this);var i=this;return Bh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.m,function(t){return t==e})}(i,n),e(t))};i.m.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){jh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){jh(this),this.B=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Wh,Mh);var Qh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Hh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:l}}function Gh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:n}}function zh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:v}}function Yh(t,e){return{name:t||"",K:"a function",optional:!!e,M:m}}function Xh(t,e){return{name:t||"",K:"null",optional:!!e,M:i}}function Jh(n){return{name:n?n+"Credential":"credential",K:n?"a valid "+n+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.ka||!e)}}}function $h(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&l(t.type)&&m(t.verify))}}}function Zh(e,n,t,r){return{name:t||"",K:e.K+" or "+n.K,optional:!!r,M:function(t){return e.M(t)||n.M(t)}}}function tl(t,e){for(var n in e){var r=e[n].name;t[r]=rl(r,t[n],e[n].j)}}function el(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){Kh(t,[n],[r],!0),this[e]=r},r,n,e[n].rb),enumerable:!0})}}function nl(t,e,n,r){t[e]=rl(e,n,r)}function rl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Kh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}tl(ch.prototype,{Va:{name:"applyActionCode",j:[Hh("code")]},Ia:{name:"checkActionCode",j:[Hh("code")]},Xa:{name:"confirmPasswordReset",j:[Hh("code"),Hh("newPassword")]},Sb:{name:"createUserWithEmailAndPassword",j:[Hh("email"),Hh("password")]},Vb:{name:"fetchSignInMethodsForEmail",j:[Hh("email")]},la:{name:"getRedirectResult",j:[]},kc:{name:"isSignInWithEmailLink",j:[Hh("emailLink")]},rc:{name:"onAuthStateChanged",j:[Zh(zh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},sc:{name:"onIdTokenChanged",j:[Zh(zh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},hb:{name:"sendPasswordResetEmail",j:[Hh("email"),Zh(zh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},ib:{name:"sendSignInLinkToEmail",j:[Hh("email"),zh("actionCodeSettings")]},jb:{name:"setPersistence",j:[Hh("persistence")]},Bc:{name:"signInAndRetrieveDataWithCredential",j:[Jh()]},kb:{name:"signInAnonymously",j:[]},Pa:{name:"signInWithCredential",j:[Jh()]},Cc:{name:"signInWithCustomToken",j:[Hh("token")]},Dc:{name:"signInWithEmailAndPassword",j:[Hh("email"),Hh("password")]},Ec:{name:"signInWithEmailLink",j:[Hh("email"),Hh("emailLink",!0)]},Fc:{name:"signInWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},Gc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Hc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"updateCurrentUser",j:[Zh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof Sc)}},Xh(),"user")]},lb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Oc:{name:"useDeviceLanguage",j:[]},Pc:{name:"verifyPasswordResetCode",j:[Hh("code")]}}),el(ch.prototype,{lc:{name:"languageCode",rb:Zh(Hh(),Xh(),"languageCode")}}),(ch.Persistence=du).LOCAL="local",ch.Persistence.SESSION="session",ch.Persistence.NONE="none",tl(Sc.prototype,{delete:{name:"delete",j:[]},Zb:{name:"getIdTokenResult",j:[Gh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Gh("opt_forceRefresh",!0)]},mc:{name:"linkAndRetrieveDataWithCredential",j:[Jh()]},ab:{name:"linkWithCredential",j:[Jh()]},nc:{name:"linkWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},oc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},pc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},vc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Jh()]},cb:{name:"reauthenticateWithCredential",j:[Jh()]},wc:{name:"reauthenticateWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},xc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},yc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},gb:{name:"sendEmailVerification",j:[Zh(zh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Lc:{name:"unlink",j:[Hh("provider")]},nb:{name:"updateEmail",j:[Hh("email")]},ob:{name:"updatePassword",j:[Hh("password")]},Nc:{name:"updatePhoneNumber",j:[Jh("phone")]},pb:{name:"updateProfile",j:[zh("profile")]}}),tl(Th.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(Eh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(jt.prototype,{ha:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),el(lc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",rb:Gh("appVerificationDisabledForTesting")}}),tl(fc.prototype,{confirm:{name:"confirm",j:[Hh("verificationCode")]}}),nl(xi,"fromJSON",function(t){t=l(t)?JSON.parse(t):t;for(var e,n=[Bi,to,oo,Ui],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Zh(Hh(),zh(),"json")]),nl(eo,"credential",function(t,e){return new Zi(t,e)},[Hh("email"),Hh("password")]),tl(Zi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Qi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Qi,"credential",Hi,[Zh(Hh(),zh(),"token")]),nl(eo,"credentialWithLink",no,[Hh("email"),Hh("emailLink")]),tl(Gi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Gi,"credential",zi,[Zh(Hh(),zh(),"token")]),tl(Yi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Yi,"credential",Xi,[Zh(Hh(),Zh(zh(),Xh()),"idToken"),Zh(Hh(),Xh(),"accessToken",!0)]),tl(Ji.prototype,{Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Ji,"credential",$i,[Zh(Hh(),zh(),"token"),Hh("secret",!0)]),tl(Ki.prototype,{ua:{name:"addScope",j:[Hh("scope")]},credential:{name:"credential",j:[Zh(Hh(),Zh(zh(),Xh()),"optionsOrIdToken"),Zh(Hh(),Xh(),"accessToken",!0)]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),tl(qi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Li.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),nl(so,"credential",uo,[Hh("verificationId"),Hh("verificationCode")]),tl(so.prototype,{Ta:{name:"verifyPhoneNumber",j:[Hh("phoneNumber"),$h()]}}),tl(io.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Yr.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(go.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(vo.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Wh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===il||!il.INTERNAL||!il.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:ch,AuthCredential:xi,Error:Yr};nl(t,"EmailAuthProvider",eo,[]),nl(t,"FacebookAuthProvider",Qi,[]),nl(t,"GithubAuthProvider",Gi,[]),nl(t,"GoogleAuthProvider",Yi,[]),nl(t,"TwitterAuthProvider",Ji,[]),nl(t,"OAuthProvider",Ki,[Hh("providerId")]),nl(t,"SAMLAuthProvider",Wi,[Hh("providerId")]),nl(t,"PhoneAuthProvider",so,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof ch)}}]),nl(t,"RecaptchaVerifier",Wh,[Zh(Hh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),zh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof il.app.App)}}]),il.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new ch(t)).getUid,t),getToken:_(t.Yb,t),addAuthTokenListener:_(t.Rb,t),removeAuthTokenListener:_(t.zc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),il.INTERNAL.extendNamespace({User:Sc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var po=(yo.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Oi(e))},yo.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ri(e)},yo.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},yo.prototype.prefixedName_=function(t){return this.prefix_+t},yo.prototype.toString=function(){return this.domStorage_.toString()},yo);function yo(t){this.domStorage_=t,this.prefix_="firebase:"}var mo=(vo.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},vo.prototype.get=function(t){return xi(this.cache_,t)?this.cache_[t]:null},vo.prototype.remove=function(t){delete this.cache_[t]},vo);function vo(){this.cache_={},this.isInMemoryStorage=!0}function go(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new po(e)}}catch(t){}return new mo}function bo(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;di(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Ui;n.update(e);var r=n.digest();return mi.encodeByteArray(r)}function wo(t,e){di(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Po.logLevel=Yi.VERBOSE,Fo=Po.log.bind(Po),e&&Oo.set("logging_enabled",!0)):"function"==typeof t?Fo=t:(Fo=null,Oo.remove("logging_enabled"))}function _o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Uo&&(Uo=!1,null===Fo&&!0===Oo.get("logging_enabled")&&wo(!0)),Fo){var n=Lo.apply(null,t);Fo(n)}}function Eo(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_o.apply(void 0,hi([n],t))}}function To(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Lo.apply(void 0,hi(t));Po.error(n)}function So(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Lo.apply(void 0,hi(t));throw Po.error(n),new Error(n)}function Io(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Lo.apply(void 0,hi(t));Po.warn(n)}function Co(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function No(t,e){return t===e?0:t<e?-1:1}function Ao(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Oi(e))}function ko(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Do,Ro=go("localStorage"),Oo=go("sessionStorage"),Po=new to("@firebase/database"),xo="FIREBASE_DATABASE_EMULATOR_HOST",Mo=(Do=1,function(){return Do++}),Lo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Lo.apply(null,t[r]):"object"==typeof t[r]?n+=Oi(t[r]):n+=t[r],n+=" ";return n},Fo=null,Uo=!0,qo="[MIN_NAME]",Vo="[MAX_NAME]",Bo=function(t,e){if(t===e)return 0;if(t===qo||e===Vo)return-1;if(e===qo||t===Vo)return 1;var n=zo(t),r=zo(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},jo=function(t){if("object"!=typeof t||null===t)return Oi(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Oi(e[i]),r+=":",r+=jo(t[e[i]]);return r+="}"};function Wo(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Ko(t){var e,n,r,i,o,a,s;for(di(!Co(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Qo(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Io("Exception was thrown by user callback.",t),e},Math.floor(0))}}function Ho(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Go=new RegExp("^-?\\d{1,10}$"),zo=function(t){if(Go.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Yo=(Object.defineProperty(Xo,"Empty",{get:function(){return new Xo("")},enumerable:!0,configurable:!0}),Xo.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Xo.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Xo.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Xo(this.pieces_,t)},Xo.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Xo.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Xo.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Xo.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Xo.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Xo(t,0)},Xo.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Xo)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Xo(e,0)},Xo.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Xo.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Xo.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Xo.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Bo(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Xo.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Xo.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Xo);function Xo(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var Jo=(Object.defineProperty($o,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty($o,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),$o.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=zi(t),this.checkValid_()},$o.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=zi(t),0<this.parts_.length&&(this.byteLength_-=1)},$o.prototype.checkValid_=function(){if(this.byteLength_>$o.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+$o.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>$o.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+$o.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},$o.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},$o);function $o(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=zi(this.parts_[n]);this.checkValid_()}var Zo="firebaseio.com",ta="websocket",ea="long_polling",na=(ra.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},ra.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},ra.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},ra.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},ra.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ro.set("host:"+this.host,this.internalHost))},ra.prototype.connectionURL=function(t,e){var n;if(di("string"==typeof t,"typeof type must == string"),di("object"==typeof e,"typeof params must == object"),t===ta)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==ea)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Wo(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},ra.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},ra.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},ra);function ra(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Ro.get("host:"+t)||this.host}function ia(t){var e=ma(t),n=e.namespace;"firebase"===e.domain&&So(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||So("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Io("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new na(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Yo(e.pathString)}}function oa(t){return"string"==typeof t&&0!==t.length&&!va.test(t)}function aa(t){return"string"==typeof t&&0!==t.length&&!ga.test(t)}function sa(t){return null===t||"string"==typeof t||"number"==typeof t&&!Co(t)||t&&"object"==typeof t&&xi(t,".sv")}function ua(t,e,n,r,i){i&&void 0===n||wa(Qi(t,e,i),n,r)}function ca(t,e,n,r,i){if(!i||void 0!==n){var o=Qi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Wo(n,function(t,e){var n=new Yo(t);if(wa(o,e,r.child(n)),".priority"===n.getBack()&&!sa(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!oa(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Yo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function ha(t,e,n,r){if(!r||void 0!==n){if(Co(n))throw new Error(Qi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!sa(n))throw new Error(Qi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function la(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Qi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function fa(t,e,n,r){if(!(r&&void 0===n||oa(n)))throw new Error(Qi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function pa(t,e,n,r){if(!(r&&void 0===n||aa(n)))throw new Error(Qi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function da(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function ya(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!oa(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),aa(t)}(r))throw new Error(Qi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var ma=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ui(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Io("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},va=/[\[\].#$\/\u0000-\u001F\u007F]/,ga=/[\[\].#$\u0000-\u001F\u007F]/,ba=10485760,wa=function(n,t,e){var r=e instanceof Yo?new Jo(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(Co(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>ba/3&&zi(t)>ba)throw new Error(n+"contains a string greater than "+ba+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Wo(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!oa(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),wa(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},_a=(Ea.prototype.cancel=function(t){Ki("OnDisconnect.cancel",0,1,arguments.length),Hi("OnDisconnect.cancel",1,t,!0);var e=new bi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Ea.prototype.remove=function(t){Ki("OnDisconnect.remove",0,1,arguments.length),da("OnDisconnect.remove",this.path_),Hi("OnDisconnect.remove",1,t,!0);var e=new bi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Ea.prototype.set=function(t,e){Ki("OnDisconnect.set",1,2,arguments.length),da("OnDisconnect.set",this.path_),ua("OnDisconnect.set",1,t,this.path_,!1),Hi("OnDisconnect.set",2,e,!0);var n=new bi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Ea.prototype.setWithPriority=function(t,e,n){Ki("OnDisconnect.setWithPriority",2,3,arguments.length),da("OnDisconnect.setWithPriority",this.path_),ua("OnDisconnect.setWithPriority",1,t,this.path_,!1),ha("OnDisconnect.setWithPriority",2,e,!1),Hi("OnDisconnect.setWithPriority",3,n,!0);var r=new bi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Ea.prototype.update=function(t,e){if(Ki("OnDisconnect.update",1,2,arguments.length),da("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Io("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ca("OnDisconnect.update",1,t,this.path_,!1),Hi("OnDisconnect.update",2,e,!0);var i=new bi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Ea);function Ea(t,e){this.repo_=t,this.path_=e}var Ta=(Sa.prototype.toJSON=function(){return Ki("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Sa);function Sa(t,e){this.committed=t,this.snapshot=e}var Ia,Ca,Na,Aa=(Ia="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ca=0,Na=[],function(t){var e,n=t===Ca;Ca=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Ia.charAt(t%64),t=Math.floor(t/64);di(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Na[e];e--)Na[e]=0;Na[e]++}else for(e=0;e<12;e++)Na[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Ia.charAt(Na[e]);return di(20===i.length,"nextPushId: Length should be 20."),i}),ka=(Da.Wrap=function(t,e){return new Da(t,e)},Da);function Da(t,e){this.name=t,this.node=e}var Ra,Oa=(Pa.prototype.getCompare=function(){return this.compare.bind(this)},Pa.prototype.indexedValueChanged=function(t,e){var n=new ka(qo,t),r=new ka(qo,e);return 0!==this.compare(n,r)},Pa.prototype.minPost=function(){return ka.MIN},Pa);function Pa(){}var xa,Ma=(ii(La,xa=Oa),Object.defineProperty(La,"__EMPTY_NODE",{get:function(){return Ra},set:function(t){Ra=t},enumerable:!0,configurable:!0}),La.prototype.compare=function(t,e){return Bo(t.name,e.name)},La.prototype.isDefinedOn=function(t){throw yi("KeyIndex.isDefinedOn not expected to be called.")},La.prototype.indexedValueChanged=function(t,e){return!1},La.prototype.minPost=function(){return ka.MIN},La.prototype.maxPost=function(){return new ka(Vo,Ra)},La.prototype.makePost=function(t,e){return di("string"==typeof t,"KeyIndex indexValue must always be a string."),new ka(t,Ra)},La.prototype.toString=function(){return".key"},La);function La(){return null!==xa&&xa.apply(this,arguments)||this}var Fa,Ua=new Ma;function qa(t){return"number"==typeof t?"number:"+Ko(t):"string:"+t}function Va(t){if(t.isLeafNode()){var e=t.val();di("string"==typeof e||"number"==typeof e||"object"==typeof e&&xi(e,".sv"),"Priority must be a string or number.")}else di(t===Fa||t.isEmpty(),"priority of unexpected type.");di(t===Fa||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Ba,ja,Wa,Ka,Qa=(Object.defineProperty(Ha,"__childrenNodeConstructor",{get:function(){return Ba},set:function(t){Ba=t},enumerable:!0,configurable:!0}),Ha.prototype.isLeafNode=function(){return!0},Ha.prototype.getPriority=function(){return this.priorityNode_},Ha.prototype.updatePriority=function(t){return new Ha(this.value_,t)},Ha.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Ha.__childrenNodeConstructor.EMPTY_NODE},Ha.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Ha.__childrenNodeConstructor.EMPTY_NODE},Ha.prototype.hasChild=function(){return!1},Ha.prototype.getPredecessorChildName=function(t,e){return null},Ha.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Ha.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Ha.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(di(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Ha.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Ha.prototype.isEmpty=function(){return!1},Ha.prototype.numChildren=function(){return 0},Ha.prototype.forEachChild=function(t,e){return!1},Ha.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Ha.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+qa(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Ko(this.value_):this.value_,this.lazyHash_=bo(t)}return this.lazyHash_},Ha.prototype.getValue=function(){return this.value_},Ha.prototype.compareTo=function(t){return t===Ha.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ha.__childrenNodeConstructor?-1:(di(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Ha.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Ha.VALUE_TYPE_ORDER.indexOf(e),i=Ha.VALUE_TYPE_ORDER.indexOf(n);return di(0<=r,"Unknown leaf type: "+e),di(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Ha.prototype.withIndex=function(){return this},Ha.prototype.isIndexed=function(){return!0},Ha.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Ha.VALUE_TYPE_ORDER=["object","boolean","number","string"],Ha);function Ha(t,e){void 0===e&&(e=Ha.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,di(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Va(this.priorityNode_)}function Ga(){return null!==Ka&&Ka.apply(this,arguments)||this}var za=new(ii(Ga,Ka=Oa),Ga.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Bo(t.name,e.name):i},Ga.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Ga.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Ga.prototype.minPost=function(){return ka.MIN},Ga.prototype.maxPost=function(){return new ka(Vo,new Qa("[PRIORITY-POST]",Wa))},Ga.prototype.makePost=function(t,e){var n=ja(t);return new ka(e,new Qa("[PRIORITY-POST]",n))},Ga.prototype.toString=function(){return".priority"},Ga),Ya=(Xa.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Xa.prototype.hasNext=function(){return 0<this.nodeStack_.length},Xa.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Xa);function Xa(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Ja=($a.prototype.copy=function(t,e,n,r,i){return new $a(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},$a.prototype.count=function(){return this.left.count()+1+this.right.count()},$a.prototype.isEmpty=function(){return!1},$a.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},$a.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},$a.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},$a.prototype.minKey=function(){return this.min_().key},$a.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},$a.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},$a.prototype.removeMin_=function(){if(this.left.isEmpty())return es.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},$a.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return es.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},$a.prototype.isRed_=function(){return this.color},$a.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},$a.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},$a.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},$a.prototype.rotateLeft_=function(){var t=this.copy(null,null,$a.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},$a.prototype.rotateRight_=function(){var t=this.copy(null,null,$a.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},$a.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},$a.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},$a.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},$a.RED=!0,$a.BLACK=!1,$a);function $a(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:$a.RED,this.left=null!=r?r:es.EMPTY_NODE,this.right=null!=i?i:es.EMPTY_NODE}var Za=(ts.prototype.copy=function(t,e,n,r,i){return this},ts.prototype.insert=function(t,e,n){return new Ja(t,e,null)},ts.prototype.remove=function(t,e){return this},ts.prototype.count=function(){return 0},ts.prototype.isEmpty=function(){return!0},ts.prototype.inorderTraversal=function(t){return!1},ts.prototype.reverseTraversal=function(t){return!1},ts.prototype.minKey=function(){return null},ts.prototype.maxKey=function(){return null},ts.prototype.check_=function(){return 0},ts.prototype.isRed_=function(){return!1},ts);function ts(){}var es=(ns.prototype.insert=function(t,e){return new ns(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ja.BLACK,null,null))},ns.prototype.remove=function(t){return new ns(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ja.BLACK,null,null))},ns.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},ns.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},ns.prototype.isEmpty=function(){return this.root_.isEmpty()},ns.prototype.count=function(){return this.root_.count()},ns.prototype.minKey=function(){return this.root_.minKey()},ns.prototype.maxKey=function(){return this.root_.maxKey()},ns.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},ns.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},ns.prototype.getIterator=function(t){return new Ya(this.root_,null,this.comparator_,!1,t)},ns.prototype.getIteratorFrom=function(t,e){return new Ya(this.root_,t,this.comparator_,!1,e)},ns.prototype.getReverseIteratorFrom=function(t,e){return new Ya(this.root_,t,this.comparator_,!0,e)},ns.prototype.getReverseIterator=function(t){return new Ya(this.root_,null,this.comparator_,!0,t)},ns.EMPTY_NODE=new Za,ns);function ns(t,e){void 0===e&&(e=ns.EMPTY_NODE),this.comparator_=t,this.root_=e}var rs=Math.log(2),is=(os.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},os);function os(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/rs,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var as,ss,us=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Ja(r,n.node,Ja.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Ja(r,n.node,Ja.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new Ja(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Ja.BLACK):(r(a,Ja.BLACK),r(a,Ja.RED))}return n}(new is(c.length));return new es(e||t,n)},cs={},hs=(Object.defineProperty(ls,"Default",{get:function(){return di(za,"ChildrenNode.ts has not been loaded"),as=as||new ls({".priority":cs},{".priority":za})},enumerable:!0,configurable:!0}),ls.prototype.get=function(t){var e=Mi(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof es?e:null},ls.prototype.hasIndex=function(t){return xi(this.indexSet_,t.toString())},ls.prototype.addIndex=function(t,e){di(t!==Ua,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(ka.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?us(r,t.getCompare()):cs;var s=t.toString(),u=oi({},this.indexSet_);u[s]=t;var c=oi({},this.indexes_);return c[s]=n,new ls(c,u)},ls.prototype.addToIndexes=function(u,c){var h=this;return new ls(Fi(this.indexes_,function(t,e){var n=Mi(h.indexSet_,e);if(di(n,"Missing index implementation for "+e),t===cs){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(ka.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),us(r,n.getCompare())}return cs}var a=c.get(u.name),s=t;return a&&(s=s.remove(new ka(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},ls.prototype.removeFromIndexes=function(n,r){return new ls(Fi(this.indexes_,function(t){if(t===cs)return t;var e=r.get(n.name);return e?t.remove(new ka(n.name,e)):t}),this.indexSet_)},ls);function ls(t,e){this.indexes_=t,this.indexSet_=e}function fs(t,e){return Bo(t.name,e.name)}function ps(t,e){return Bo(t,e)}var ds,ys=(Object.defineProperty(ms,"EMPTY_NODE",{get:function(){return ss=ss||new ms(new es(ps),null,hs.Default)},enumerable:!0,configurable:!0}),ms.prototype.isLeafNode=function(){return!1},ms.prototype.getPriority=function(){return this.priorityNode_||ss},ms.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new ms(this.children_,t,this.indexMap_)},ms.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?ss:e},ms.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},ms.prototype.hasChild=function(t){return null!==this.children_.get(t)},ms.prototype.updateImmediateChild=function(t,e){if(di(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new ka(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?ss:this.priorityNode_,new ms(i,n,o)},ms.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;di(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},ms.prototype.isEmpty=function(){return this.children_.isEmpty()},ms.prototype.numChildren=function(){return this.children_.count()},ms.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(za,function(t,e){r[t]=e.val(n),i++,a&&ms.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},ms.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+qa(this.getPriority().val())+":"),this.forEachChild(za,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":bo(r)}return this.lazyHash_},ms.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ka(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},ms.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},ms.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ka(e,this.children_.get(e)):null},ms.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},ms.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ka(e,this.children_.get(e)):null},ms.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},ms.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},ms.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,ka.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},ms.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},ms.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,ka.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},ms.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===gs?-1:0},ms.prototype.withIndex=function(t){if(t===Ua||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new ms(this.children_,this.priorityNode_,e)},ms.prototype.isIndexed=function(t){return t===Ua||this.indexMap_.hasIndex(t)},ms.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(za),r=e.getIterator(za),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},ms.prototype.resolveIndex_=function(t){return t===Ua?null:this.indexMap_.get(t.toString())},ms.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,ms);function ms(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Va(this.priorityNode_),this.children_.isEmpty()&&di(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function vs(){return ds.call(this,new es(ps),ys.EMPTY_NODE,hs.Default)||this}var gs=new(ii(vs,ds=ys),vs.prototype.compareTo=function(t){return t===this?0:1},vs.prototype.equals=function(t){return t===this},vs.prototype.getPriority=function(){return this},vs.prototype.getImmediateChild=function(t){return ys.EMPTY_NODE},vs.prototype.isEmpty=function(){return!1},vs);Object.defineProperties(ka,{MIN:{value:new ka(qo,ys.EMPTY_NODE)},MAX:{value:new ka(Vo,gs)}}),Ma.__EMPTY_NODE=ys.EMPTY_NODE,Qa.__childrenNodeConstructor=ys,Fa=gs,Wa=gs;var bs,ws=!0;function _s(r,t){if(void 0===t&&(t=null),null===r)return ys.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),di(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Qa(r,_s(t));if(r instanceof Array||!ws){var i=ys.EMPTY_NODE;return Wo(r,function(t,e){if(xi(r,t)&&"."!==t.substring(0,1)){var n=_s(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(_s(t))}var o=[],a=!1;if(Wo(r,function(t,e){if("."!==t.substring(0,1)){var n=_s(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new ka(t,n)))}}),0==o.length)return ys.EMPTY_NODE;var e=us(o,fs,function(t){return t.name},ps);if(a){var n=us(o,za.getCompare());return new ys(e,_s(t),new hs({".priority":n},{".priority":za}))}return new ys(e,_s(t),hs.Default)}function Es(){return null!==bs&&bs.apply(this,arguments)||this}ja=_s;var Ts,Ss=new(ii(Es,bs=Oa),Es.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Bo(t.name,e.name):n},Es.prototype.isDefinedOn=function(t){return!0},Es.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Es.prototype.minPost=function(){return ka.MIN},Es.prototype.maxPost=function(){return ka.MAX},Es.prototype.makePost=function(t,e){var n=_s(t);return new ka(e,n)},Es.prototype.toString=function(){return".value"},Es),Is=(ii(Cs,Ts=Oa),Cs.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Cs.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Cs.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Bo(t.name,e.name):i},Cs.prototype.makePost=function(t,e){var n=_s(t),r=ys.EMPTY_NODE.updateChild(this.indexPath_,n);return new ka(e,r)},Cs.prototype.maxPost=function(){var t=ys.EMPTY_NODE.updateChild(this.indexPath_,gs);return new ka(Vo,t)},Cs.prototype.toString=function(){return this.indexPath_.slice().join("/")},Cs);function Cs(t){var e=Ts.call(this)||this;return e.indexPath_=t,di(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Ns=(As.prototype.val=function(){return Ki("DataSnapshot.val",0,0,arguments.length),this.node_.val()},As.prototype.exportVal=function(){return Ki("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},As.prototype.toJSON=function(){return Ki("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},As.prototype.exists=function(){return Ki("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},As.prototype.child=function(t){Ki("DataSnapshot.child",0,1,arguments.length),t=String(t),pa("DataSnapshot.child",1,t,!1);var e=new Yo(t),n=this.ref_.child(e);return new As(this.node_.getChild(e),n,za)},As.prototype.hasChild=function(t){Ki("DataSnapshot.hasChild",1,1,arguments.length),pa("DataSnapshot.hasChild",1,t,!1);var e=new Yo(t);return!this.node_.getChild(e).isEmpty()},As.prototype.getPriority=function(){return Ki("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},As.prototype.forEach=function(n){var r=this;return Ki("DataSnapshot.forEach",1,1,arguments.length),Hi("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new As(e,r.ref_.child(t),za))})},As.prototype.hasChildren=function(){return Ki("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(As.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),As.prototype.numChildren=function(){return Ki("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},As.prototype.getRef=function(){return Ki("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(As.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),As);function As(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var ks=(Ds.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Ds.prototype.getEventType=function(){return this.eventType},Ds.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ds.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Oi(this.snapshot.exportVal())},Ds);function Ds(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Rs=(Os.prototype.getPath=function(){return this.path},Os.prototype.getEventType=function(){return"cancel"},Os.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Os.prototype.toString=function(){return this.path.toString()+":cancel"},Os);function Os(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Ps=(xs.prototype.respondsTo=function(t){return"value"===t},xs.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new ks("value",this,new Ns(t.snapshotNode,e.getRef(),n))},xs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){di(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},xs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Rs(this,t,e):null},xs.prototype.matches=function(t){return t instanceof xs&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},xs.prototype.hasAnyCallback=function(){return null!==this.callback_},xs);function xs(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Ms,Ls=(Fs.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,xi(this.callbacks_,e)},Fs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Rs(this,t,e):null},Fs.prototype.createEvent=function(t,e){di(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new ks(t.type,this,new Ns(t.snapshotNode,n,r),t.prevName)},Fs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){di(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Fs.prototype.matches=function(e){var n=this;if(e instanceof Fs){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Fs.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Fs);function Fs(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var Us=(Object.defineProperty(qs,"__referenceConstructor",{get:function(){return di(Ms,"Reference.ts has not been loaded"),Ms},set:function(t){Ms=t},enumerable:!0,configurable:!0}),qs.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Ua){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=qo)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Vo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===za){if(null!=e&&!sa(e)||null!=n&&!sa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(di(t.getIndex()instanceof Is||t.getIndex()===Ss,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},qs.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},qs.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},qs.prototype.getQueryParams=function(){return this.queryParams_},qs.prototype.getRef=function(){return Ki("Query.ref",0,0,arguments.length),new qs.__referenceConstructor(this.repo,this.path)},qs.prototype.on=function(t,e,n,r){Ki("Query.on",2,4,arguments.length),la("Query.on",1,t,!1),Hi("Query.on",2,e,!1);var i=qs.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},qs.prototype.onValueEvent=function(t,e,n){var r=new Ps(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},qs.prototype.onChildEvent=function(t,e,n){var r=new Ls(t,e,n);this.repo.addEventCallbackForQuery(this,r)},qs.prototype.off=function(t,e,n){Ki("Query.off",0,3,arguments.length),la("Query.off",1,t,!0),Hi("Query.off",2,e,!0),Gi("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Ps(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Ls(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},qs.prototype.once=function(e,n,t,r){var i=this;Ki("Query.once",1,4,arguments.length),la("Query.once",1,e,!1),Hi("Query.once",2,n,!0);var o=qs.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new bi;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},qs.prototype.limitToFirst=function(t){if(Ki("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new qs(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},qs.prototype.limitToLast=function(t){if(Ki("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new qs(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},qs.prototype.orderByChild=function(t){if(Ki("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');pa("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Yo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Is(e),r=this.queryParams_.orderBy(n);return qs.validateQueryEndpoints_(r),new qs(this.repo,this.path,r,!0)},qs.prototype.orderByKey=function(){Ki("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Ua);return qs.validateQueryEndpoints_(t),new qs(this.repo,this.path,t,!0)},qs.prototype.orderByPriority=function(){Ki("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(za);return qs.validateQueryEndpoints_(t),new qs(this.repo,this.path,t,!0)},qs.prototype.orderByValue=function(){Ki("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ss);return qs.validateQueryEndpoints_(t),new qs(this.repo,this.path,t,!0)},qs.prototype.startAt=function(t,e){void 0===t&&(t=null),Ki("Query.startAt",0,2,arguments.length),ua("Query.startAt",1,t,this.path,!0),fa("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(qs.validateLimit_(n),qs.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new qs(this.repo,this.path,n,this.orderByCalled_)},qs.prototype.endAt=function(t,e){void 0===t&&(t=null),Ki("Query.endAt",0,2,arguments.length),ua("Query.endAt",1,t,this.path,!0),fa("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(qs.validateLimit_(n),qs.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new qs(this.repo,this.path,n,this.orderByCalled_)},qs.prototype.equalTo=function(t,e){if(Ki("Query.equalTo",1,2,arguments.length),ua("Query.equalTo",1,t,this.path,!1),fa("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},qs.prototype.toString=function(){return Ki("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},qs.prototype.toJSON=function(){return Ki("Query.toJSON",0,1,arguments.length),this.toString()},qs.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},qs.prototype.queryIdentifier=function(){var t=this.queryObject(),e=jo(t);return"{}"===e?"default":e},qs.prototype.isEqual=function(t){if(Ki("Query.isEqual",1,1,arguments.length),!(t instanceof qs))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},qs.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Hi(t,3,r.cancel,!0),r.context=n,Gi(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Qi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(qs.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),qs);function qs(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var Vs=(Bs.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Bs.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Bs);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Bs.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(za,function(t,e){n.remember(new Yo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Bs.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Yo(r.toString()+"/"+t);e.forEachTree(n,i)})},Bs.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Bs);function Bs(){this.value=null,this.children=new Map}function js(t,e){return t&&"object"==typeof t?(di(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Ws,Ks,Qs=function(t,r){var i,e=t.getPriority().val(),n=js(e,r);if(t.isLeafNode()){var o=t,a=js(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Qa(a,_s(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Qa(n))),s.forEachChild(za,function(t,e){var n=Qs(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(Ks=Ws=Ws||{})[Ks.OVERWRITE=0]="OVERWRITE",Ks[Ks.MERGE=1]="MERGE",Ks[Ks.ACK_USER_WRITE=2]="ACK_USER_WRITE",Ks[Ks.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Hs=(Gs.User=new Gs(!0,!1,null,!1),Gs.Server=new Gs(!1,!0,null,!1),Gs.forServerTaggedQuery=function(t){return new Gs(!1,!0,t,!0)},Gs);function Gs(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,di(!r||e,"Tagged queries must be from server.")}var zs,Ys=(Xs.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return di(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Yo(t));return new Xs(Yo.Empty,e,this.revert)}return di(this.path.getFront()===t,"operationForChild called for unrelated child."),new Xs(this.path.popFront(),this.affectedTree,this.revert)},Xs);function Xs(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ws.ACK_USER_WRITE,this.source=Hs.User}var Js=($s.fromObject=function(t){var n=$s.Empty;return Wo(t,function(t,e){n=n.set(new Yo(t),e)}),n},$s.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},$s.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Yo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Yo(n).child(i.path),value:i.value}},$s.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},$s.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):$s.Empty},$s.prototype.set=function(t,e){if(t.isEmpty())return new $s(e,this.children);var n=t.getFront(),r=(this.children.get(n)||$s.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new $s(this.value,i)},$s.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?$s.Empty:new $s(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?$s.Empty:new $s(this.value,i)}return this},$s.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},$s.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||$s.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new $s(this.value,i)},$s.prototype.fold=function(t){return this.fold_(Yo.Empty,t)},$s.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},$s.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Yo.Empty,e)},$s.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},$s.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Yo.Empty,e)},$s.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):$s.Empty},$s.prototype.foreach=function(t){this.foreach_(Yo.Empty,t)},$s.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},$s.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},$s.Empty=new $s(null),$s);function $s(t,e){void 0===e&&(e=zs=zs||new es(No)),this.value=t,this.children=e}var Zs=(tu.prototype.operationForChild=function(t){return this.path.isEmpty()?new tu(this.source,Yo.Empty):new tu(this.source,this.path.popFront())},tu);function tu(t,e){this.source=t,this.path=e,this.type=Ws.LISTEN_COMPLETE}var eu=(nu.prototype.operationForChild=function(t){return this.path.isEmpty()?new nu(this.source,Yo.Empty,this.snap.getImmediateChild(t)):new nu(this.source,this.path.popFront(),this.snap)},nu);function nu(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ws.OVERWRITE}var ru=(iu.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Yo(t));return e.isEmpty()?null:e.value?new eu(this.source,Yo.Empty,e.value):new iu(this.source,Yo.Empty,e)}return di(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new iu(this.source,this.path.popFront(),this.children)},iu.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},iu);function iu(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ws.MERGE}var ou=(au.prototype.isFullyInitialized=function(){return this.fullyInitialized_},au.prototype.isFiltered=function(){return this.filtered_},au.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},au.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},au.prototype.getNode=function(){return this.node_},au);function au(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var su=(uu.prototype.updateEventSnap=function(t,e,n){return new uu(new ou(t,e,n),this.serverCache_)},uu.prototype.updateServerSnap=function(t,e,n){return new uu(this.eventCache_,new ou(t,e,n))},uu.prototype.getEventCache=function(){return this.eventCache_},uu.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},uu.prototype.getServerCache=function(){return this.serverCache_},uu.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},uu.Empty=new uu(new ou(ys.EMPTY_NODE,!1,!1),new ou(ys.EMPTY_NODE,!1,!1)),uu);function uu(t,e){this.eventCache_=t,this.serverCache_=e}var cu=(hu.valueChange=function(t){return new hu(hu.VALUE,t)},hu.childAddedChange=function(t,e){return new hu(hu.CHILD_ADDED,e,t)},hu.childRemovedChange=function(t,e){return new hu(hu.CHILD_REMOVED,e,t)},hu.childChangedChange=function(t,e,n){return new hu(hu.CHILD_CHANGED,e,t,n)},hu.childMovedChange=function(t,e){return new hu(hu.CHILD_MOVED,e,t)},hu.CHILD_ADDED="child_added",hu.CHILD_REMOVED="child_removed",hu.CHILD_CHANGED="child_changed",hu.CHILD_MOVED="child_moved",hu.VALUE="value",hu);function hu(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var lu=(fu.prototype.updateChild=function(t,e,n,r,i,o){di(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(cu.childRemovedChange(e,a)):di(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(cu.childAddedChange(e,n)):o.trackChildChange(cu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},fu.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(za,function(t,e){n.hasChild(t)||i.trackChildChange(cu.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(za,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(cu.childChangedChange(t,e,n))}else i.trackChildChange(cu.childAddedChange(t,e))})),n.withIndex(this.index_)},fu.prototype.updatePriority=function(t,e){return t.isEmpty()?ys.EMPTY_NODE:t.updatePriority(e)},fu.prototype.filtersNodes=function(){return!1},fu.prototype.getIndexedFilter=function(){return this},fu.prototype.getIndex=function(){return this.index_},fu);function fu(t){this.index_=t}var pu=(du.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;di(e==cu.CHILD_ADDED||e==cu.CHILD_CHANGED||e==cu.CHILD_REMOVED,"Only child changes supported for tracking"),di(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==cu.CHILD_ADDED&&i==cu.CHILD_REMOVED)this.changeMap.set(n,cu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==cu.CHILD_REMOVED&&i==cu.CHILD_ADDED)this.changeMap.delete(n);else if(e==cu.CHILD_REMOVED&&i==cu.CHILD_CHANGED)this.changeMap.set(n,cu.childRemovedChange(n,r.oldSnap));else if(e==cu.CHILD_CHANGED&&i==cu.CHILD_ADDED)this.changeMap.set(n,cu.childAddedChange(n,t.snapshotNode));else{if(e!=cu.CHILD_CHANGED||i!=cu.CHILD_CHANGED)throw yi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,cu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},du.prototype.getChanges=function(){return Array.from(this.changeMap.values())},du);function du(){this.changeMap=new Map}function yu(){}var mu=new(yu.prototype.getCompleteChild=function(t){return null},yu.prototype.getChildAfterChild=function(t,e,n){return null},yu),vu=(gu.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ou(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},gu.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},gu);function gu(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var bu=function(t,e){this.viewCache=t,this.changes=e},wu=(_u.prototype.assertIndexed=function(t){di(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),di(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},_u.prototype.applyOperation=function(t,e,n,r){var i,o,a=new pu;if(e.type===Ws.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(di(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Ws.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(di(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Ws.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Ws.LISTEN_COMPLETE)throw yi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return _u.maybeAddValueEvent_(t,i,h),new bu(i,h)},_u.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(cu.valueChange(e.getCompleteEventSnap()))}},_u.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(di(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof ys?u:ys.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){di(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},_u.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,mu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new vu(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},_u.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new vu(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):ys.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},_u.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},_u.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);_u.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);_u.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},_u.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},_u.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:Js.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Yo(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Yo(t),i,a,s,u,c)}}),l},_u.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=Js.Empty;return s.getNode().forEachChild(Ua,function(t,e){u=u.set(new Yo(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=Js.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},_u.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,mu,r)},_u.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new vu(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();di(h instanceof ys,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,ys.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Yo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},_u);function _u(t){this.filter_=t}var Eu=(Tu.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===cu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(cu.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,cu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,cu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,cu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,cu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,cu.VALUE,t,n,e),i},Tu.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Tu.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Tu.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw yi("Should only compare child_ events.");var n=new ka(t.childName,t.snapshotNode),r=new ka(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Tu);function Tu(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Su,Iu=(Cu.prototype.getQuery=function(){return this.query_},Cu.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Cu.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Cu.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Cu.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Cu.prototype.removeEventRegistration=function(t,n){var r=[];if(n){di(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Cu.prototype.applyOperation=function(t,e,n){t.type===Ws.MERGE&&null!==t.source.queryId&&(di(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),di(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),di(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Cu.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(za,function(t,e){n.push(cu.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(cu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Cu.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Cu);function Cu(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new lu(n.getIndex()),i=n.getNodeFilter();this.processor_=new wu(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(ys.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ys.EMPTY_NODE,a.getNode(),null),c=new ou(s,o.isFullyInitialized(),r.filtersNodes()),h=new ou(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new su(h,c),this.eventGenerator_=new Eu(this.query_)}var Nu=(Object.defineProperty(Au,"__referenceConstructor",{get:function(){return di(Su,"Reference.ts has not been loaded"),Su},set:function(t){di(!Su,"__referenceConstructor has already been defined"),Su=t},enumerable:!0,configurable:!0}),Au.prototype.isEmpty=function(){return 0===this.views.size},Au.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return di(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ui(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Au.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof ys?n.calcCompleteEventChildren(r):ys.EMPTY_NODE,!1);var c=new su(new ou(s,u,!1),new ou(r,i,!1));a=new Iu(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Au.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ui(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ci(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Au.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Au.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ui(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},Au.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ui(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Au.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Au.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Au.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Au.prototype.getCompleteView=function(){var e,t;try{for(var n=ui(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},Au);function Au(){this.views=new Map}var ku=(Du.prototype.addWrite=function(t,e){if(t.isEmpty())return new Du(new Js(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Yo.relativePath(r,t);return i=i.updateChild(o,e),new Du(this.writeTree_.set(r,i))}var a=new Js(e);return new Du(this.writeTree_.setTree(t,a))},Du.prototype.addWrites=function(n,t){var r=this;return Wo(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},Du.prototype.removeWrite=function(t){return t.isEmpty()?Du.Empty:new Du(this.writeTree_.setTree(t,Js.Empty))},Du.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Du.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Yo.relativePath(e.path,t)):null},Du.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(za,function(t,e){n.push(new ka(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new ka(t,e.value))}),n},Du.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Du(null!=e?new Js(e):this.writeTree_.subtree(t))},Du.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Du.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(di(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(Yo.Empty,this.writeTree_,t)},Du.Empty=new Du(new Js(null)),Du);function Du(t){this.writeTree_=t}var Ru=(Ou.prototype.childWrites=function(t){return new Pu(t,this)},Ou.prototype.addOverwrite=function(t,e,n,r){di(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Ou.prototype.addMerge=function(t,e,n){di(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Ou.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Ou.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});di(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Wo(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Ou.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Ou.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Yo.Empty)){var o=Ou.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||ys.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Yo.Empty)){var u=t||ys.EMPTY_NODE;return s.apply(u)}return null},Ou.prototype.calcCompleteEventChildren=function(t,e){var r=ys.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(za,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(za,function(t,e){var n=i.childCompoundWrite(new Yo(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},Ou.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){di(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Ou.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Ou.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Ou.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Yo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Ou.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Ou.prototype.resetTree_=function(){this.visibleWrites_=Ou.layerTree_(this.allWrites_,Ou.DefaultFilter_,Yo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Ou.DefaultFilter_=function(t){return t.visible},Ou.layerTree_=function(t,e,n){for(var r=ku.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Yo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Yo.relativePath(a,n),r=r.addWrite(Yo.Empty,o.snap.getChild(s)));else{if(!o.children)throw yi("WriteRecord should have .snap or .children");if(n.contains(a))s=Yo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Yo.relativePath(a,n)).isEmpty())r=r.addWrites(Yo.Empty,o.children);else{var u=Mi(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Yo.Empty,c)}}}}}return r},Ou);function Ou(){this.visibleWrites_=ku.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Pu=(xu.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},xu.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},xu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},xu.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},xu.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},xu.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},xu.prototype.child=function(t){return new xu(this.treePath_.child(t),this.writeTree_)},xu);function xu(t,e){this.treePath_=t,this.writeTree_=e}var Mu=(Lu.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new eu(Hs.User,t,e)):[]},Lu.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Js.fromObject(e);return this.applyOperationToSyncPoints_(new ru(Hs.User,t,r))},Lu.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Js.Empty;return null!=n.snap?r=r.set(Yo.Empty,!0):Wo(n.children,function(t,e){r=r.set(new Yo(t),e)}),this.applyOperationToSyncPoints_(new Ys(n.path,r,e))}return[]},Lu.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new eu(Hs.Server,t,e))},Lu.prototype.applyServerMerge=function(t,e){var n=Js.fromObject(e);return this.applyOperationToSyncPoints_(new ru(Hs.Server,t,n))},Lu.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Zs(Hs.Server,t))},Lu.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Lu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Yo.relativePath(o,t),u=new eu(Hs.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},Lu.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=Lu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Yo.relativePath(o,t),u=Js.fromObject(e),c=new ru(Hs.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},Lu.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=Lu.parseQueryKey_(n),i=r.path,o=r.queryId,a=Yo.relativePath(i,t),s=new Zs(Hs.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},Lu.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Yo.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Yo.Empty)):(a=new Nu,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=ys.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Yo.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=Lu.makeQueryKey_(t);di(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=Lu.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},Lu.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(Lu.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(Lu.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(Lu.makeQueryKey_(t));r.listenProvider_.stopListening(Lu.queryForListening_(t),e)})),this.removeTags_(u)}return a},Lu.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Yo.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},Lu.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Wo(n,function(t,e){r=r.concat(e)}),r})},Lu.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=Lu.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Lu.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},Lu.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(Lu.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)di(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Wo(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(Lu.queryForListening_(c),this.tagForQuery_(c))}return o},Lu.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||ys.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},Lu.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},Lu.parseQueryKey_=function(t){var e=t.indexOf("$");return di(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Yo(t.substr(0,e))}},Lu.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},Lu.prototype.tagForQuery_=function(t){var e=Lu.makeQueryKey_(t);return this.queryToTagMap.get(e)},Lu.getNextQueryTag_=function(){return Lu.nextQueryTag_++},Lu.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);di(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},Lu.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Yo.Empty))},Lu.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Yo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Yo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},Lu.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Yo.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Yo.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},Lu.nextQueryTag_=1,Lu);function Lu(t){this.listenProvider_=t,this.syncPointTree_=Js.Empty,this.pendingWriteTree_=new Ru,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Fu=(Uu.prototype.getNode=function(t){return this.rootNode_.getChild(t)},Uu.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},Uu);function Uu(){this.rootNode_=ys.EMPTY_NODE}var qu=(Vu.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(_o("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Vu.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Vu.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Vu.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Io(t)},Vu);function Vu(t){this.app_=t}var Bu=function(t){this.accessToken=t},ju=(Wu.prototype.getToken=function(t){return Promise.resolve(new Bu("owner"))},Wu.prototype.addTokenChangeListener=function(t){},Wu.prototype.removeTokenChangeListener=function(t){},Wu.prototype.notifyForInvalidToken=function(){Io('Database emulator unexpectedly rejected fake "owner" credentials.')},Wu);function Wu(t){this.app_=t}var Ku=(Qu.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),xi(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Qu.prototype.get=function(){return vi(this.counters_)},Qu);function Qu(){this.counters_={}}var Hu=(Gu.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ku),this.collections_[e]},Gu.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Gu.collections_={},Gu.reporters_={},Gu);function Gu(){}var zu=(Yu.prototype.get=function(){var t=this.collection_.get(),n=oi({},t);return this.last_&&Wo(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Yu);function Yu(t){this.collection_=t,this.last_=null}var Xu=(Ju.prototype.includeStat=function(t){this.statsToReport_[t]=!0},Ju.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Wo(t,function(t,e){0<e&&xi(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Ho(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Ju);function Ju(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new zu(t);var n=1e4+2e4*Math.random();Ho(this.reportStats_.bind(this),Math.floor(n))}var $u=(Zu.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new tc(i)),e.add(r)}e&&this.eventLists_.push(e)},Zu.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},Zu.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},Zu.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},Zu);function Zu(){this.eventLists_=[],this.recursionDepth_=0}var tc=(ec.prototype.add=function(t){this.events_.push(t)},ec.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Fo&&_o("event: "+e.toString()),Qo(n)}}},ec.prototype.getPath=function(){return this.path_},ec);function ec(t){this.path_=t,this.events_=[]}var nc=(rc.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=hi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},rc.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},rc.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},rc.prototype.validateEventType_=function(e){di(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},rc);function rc(t){this.allowedEvents_=t,this.listeners_={},di(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var ic,oc=(ii(ac,ic=nc),ac.getInstance=function(){return new ac},ac.prototype.getInitialEvent=function(t){return di("visible"===t,"Unknown event type: "+t),[this.visible_]},ac);function ac(){var e,t,n=ic.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var sc,uc=(ii(cc,sc=nc),cc.getInstance=function(){return new cc},cc.prototype.getInitialEvent=function(t){return di("online"===t,"Unknown event type: "+t),[this.online_]},cc.prototype.currentlyOnline=function(){return this.online_},cc);function cc(){var t=sc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ei()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var hc=(lc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},lc.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Qo(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},lc);function lc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var fc=(pc.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new hc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new dc(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Zo)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},pc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},pc.forceAllow=function(){pc.forceAllow_=!0},pc.forceDisallow=function(){pc.forceDisallow_=!0},pc.isAvailable=function(){return pc.forceAllow_||!pc.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Si()},pc.prototype.markConnectionHealthy=function(){},pc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},pc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},pc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},pc.prototype.send=function(t){var e=Oi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=li(t);return mi.encodeByteArray(e,!0)}(e),r=ko(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},pc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},pc.prototype.incrementIncomingBytes_=function(t){var e=Oi(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},pc);function pc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Eo(t),this.stats_=Hu.getCollection(e),this.urlFn=function(t){return e.connectionURL(ea,t)}}var dc=(yc.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||_o("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},yc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},yc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},yc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},yc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},yc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},yc.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){_o("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},yc);function yc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Mo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=yc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){_o("frame writing exception"),t.stack&&_o(t.stack),_o(t)}}var mc="";var vc=null;"undefined"!=typeof MozWebSocket?vc=MozWebSocket:"undefined"!=typeof WebSocket&&(vc=WebSocket);var gc=(bc.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Zo)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(ta,r)},bc.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ro.set("previous_websocket_failure",!0);try{if(Si()){var r=pi.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+mc+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new vc(this.connURL,[],i)}else this.mySock=new vc(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},bc.prototype.start=function(){},bc.forceDisallow=function(){bc.forceDisallow_=!0},bc.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==vc&&!bc.forceDisallow_},bc.previouslyFailed=function(){return Ro.isInMemoryStorage||!0===Ro.get("previous_websocket_failure")},bc.prototype.markConnectionHealthy=function(){Ro.remove("previous_websocket_failure")},bc.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ri(e);this.onMessage(n)}},bc.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},bc.prototype.extractFrameCount_=function(t){if(di(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},bc.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},bc.prototype.send=function(t){this.resetKeepAlive();var e=Oi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=ko(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},bc.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},bc.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},bc.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},bc.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},bc.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},bc.responsesRequiredToBeHealthy=2,bc.healthyTimeout=3e4,bc);function bc(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Eo(this.connId),this.stats_=Hu.getCollection(e),this.connURL=bc.connectionURL_(e,n,r)}var wc=(Object.defineProperty(_c,"ALL_TRANSPORTS",{get:function(){return[fc,gc]},enumerable:!0,configurable:!0}),_c.prototype.initTransports_=function(t){var e,n,r=gc&&gc.isAvailable(),i=r&&!gc.previouslyFailed();if(t.webSocketOnly&&(r||Io("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[gc];else{var o=this.transports_=[];try{for(var a=ui(_c.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},_c.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},_c.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},_c);function _c(t){this.initTransports_(t)}var Ec=(Tc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Ho(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Tc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Tc.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},Tc.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},Tc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Tc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Tc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Tc.prototype.onSecondaryMessageReceived_=function(t){var e=Ao("t",t),n=Ao("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Tc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Tc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Tc.prototype.onPrimaryMessageReceived_=function(t){var e=Ao("t",t),n=Ao("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Tc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Tc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Tc.prototype.onControl_=function(t){var e=Ao("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?To("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):To("Unknown control packet command: "+e)}},Tc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Io("Protocol version mismatch detected"),this.tryStartUpgrade_())},Tc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Tc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ho(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Tc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Tc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ho(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Tc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Tc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Tc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ro.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Tc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Tc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Tc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Tc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Tc);function Tc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Eo("c:"+this.id+":"),this.transportManager_=new wc(e),this.log_("Connection created"),this.start_()}var Sc=(Ic.prototype.put=function(t,e,n,r){},Ic.prototype.merge=function(t,e,n,r){},Ic.prototype.refreshAuthToken=function(t){},Ic.prototype.onDisconnectPut=function(t,e,n){},Ic.prototype.onDisconnectMerge=function(t,e,n){},Ic.prototype.onDisconnectCancel=function(t,e){},Ic.prototype.reportStats=function(t){},Ic);function Ic(){}var Cc,Nc=(ii(Ac,Cc=Sc),Ac.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Oi(i)),di(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Ac.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),di(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),di(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Ac.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Ac.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Ac.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&xi(t,"w")){var n=Mi(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Io("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Ac.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Ac.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Pi(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Ac.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Pi(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Ac.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),di(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Ac.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Ac.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Ac.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Ac.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Ac.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Ac.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Ac.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Ac.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Ac.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Ac.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Ac.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Oi(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Ac.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):To("Unrecognized action received from server: "+Oi(t)+"\nAre you using the latest client?")},Ac.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Ac.prototype.scheduleConnect_=function(t){var e=this;di(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Ac.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Ac.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Ac.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Ac.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ac.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){di(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?_o("getToken() completed but was canceled"):(_o("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new Ec(i,o.repoInfo_,e,n,r,function(t){Io(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Ac.prototype.interrupt=function(t){_o("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Ac.prototype.resume=function(t){_o("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Li(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Ac.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Ac.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Ac.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return jo(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Ac.prototype.removeListen_=function(t,e){var n,r=new Yo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Ac.prototype.onAuthRevoked_=function(t,e){_o("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Ac.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Ac.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ui(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ui(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Ac.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+mc.replace(/\./g,"-")]=1,Ei()?t["framework.cordova"]=1:Ti()&&(t["framework.reactnative"]=1),this.reportStats(t)},Ac.prototype.shouldReconnect_=function(){var t=uc.getInstance().currentlyOnline();return Li(this.interruptReasons_)&&t},Ac.nextPersistentConnectionId_=0,Ac.nextConnectionId_=0,Ac);function Ac(t,e,n,r,i,o){var a=Cc.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Ac.nextPersistentConnectionId_++,a.log_=Eo("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Si())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),oc.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&uc.getInstance().on("online",a.onOnline_,a),a}var kc,Dc=(ii(Rc,kc=Sc),Rc.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Rc.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(di(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Rc.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=Rc.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Mi(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Rc.prototype.unlisten=function(t,e){var n=Rc.getListenId_(t,e);delete this.listens_[n]},Rc.prototype.refreshAuthToken=function(t){},Rc.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ri(r.responseText)}catch(t){Io("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&Io("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},Rc);function Rc(t,e,n){var r=kc.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Eo("p:rest:"),r.listens_={},r}var Oc="repo_interrupt",Pc=(xc.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},xc.prototype.name=function(){return this.repoInfo_.namespace},xc.prototype.serverTime=function(){var t=this.infoData_.getNode(new Yo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},xc.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},xc.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Yo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Fi(e,function(t){return _s(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=_s(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Fi(e,function(t){return _s(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=_s(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},xc.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},xc.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},xc.prototype.onServerInfoUpdate_=function(t){var n=this;Wo(t,function(t,e){n.updateInfo_(t,e)})},xc.prototype.updateInfo_=function(t,e){var n=new Yo("/.info/"+t),r=_s(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},xc.prototype.getNextWriteId_=function(){return this.nextWriteId_++},xc.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=_s(t,e),s=Qs(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Io("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},xc.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Wo(t,function(t,e){r=!1;var n=_s(e);u[t]=Qs(n,i)}),r)_o("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Io("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Wo(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},xc.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new Vs;return t.forEachTree(new Yo(""),function(t,e){r.remember(t,Qs(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(Yo.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new Vs,this.eventQueue_.raiseEventsForChangedPath(Yo.Empty,i)},xc.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},xc.prototype.onDisconnectSet=function(n,t,r){var i=this,o=_s(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},xc.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=_s(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},xc.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Li(n))return _o("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Wo(n,function(t,e){var n=_s(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},xc.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xc.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xc.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Oc)},xc.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Oc)},xc.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new zu(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Wo(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},xc.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},xc.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),_o.apply(void 0,hi([n],t))},xc.prototype.callOnCompleteCallback=function(r,i,o){r&&Qo(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(xc.prototype,"database",{get:function(){return this.__database||(this.__database=new Zc(this))},enumerable:!0,configurable:!0}),xc);function xc(t,e,n){var r,a=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new $u,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Vs,this.persistentConnection_=null,r="undefined"!=typeof process&&process.env[xo]?new ju(n):new qu(n),this.stats_=Hu.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Dc(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Oi(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Nc(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Hu.getOrCreateReporter(t,function(){return new Xu(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Fu,this.infoSyncTree_=new Mu({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Mu({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var Mc=(Lc.prototype.getStartPost=function(){return this.startPost_},Lc.prototype.getEndPost=function(){return this.endPost_},Lc.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Lc.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new ka(e,n))||(n=ys.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Lc.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=ys.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(ys.EMPTY_NODE);var i=this;return e.forEachChild(za,function(t,e){i.matches(new ka(t,e))||(r=r.updateImmediateChild(t,ys.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Lc.prototype.updatePriority=function(t,e){return t},Lc.prototype.filtersNodes=function(){return!0},Lc.prototype.getIndexedFilter=function(){return this.indexedFilter_},Lc.prototype.getIndex=function(){return this.index_},Lc.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Lc.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Lc);function Lc(t){this.indexedFilter_=new lu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Lc.getStartPost_(t),this.endPost_=Lc.getEndPost_(t)}var Fc=(Uc.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new ka(e,n))||(n=ys.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},Uc.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=ys.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=ys.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(ys.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,ys.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},Uc.prototype.updatePriority=function(t,e){return t},Uc.prototype.filtersNodes=function(){return!0},Uc.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},Uc.prototype.getIndex=function(){return this.index_},Uc.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;di(s.numChildren()==this.limit_,"");var u=new ka(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(cu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(cu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,ys.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(cu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(cu.childRemovedChange(c.name,c.node)),i.trackChildChange(cu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,ys.EMPTY_NODE)):t},Uc);function Uc(t){this.rangedFilter_=new Mc(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var qc=(Vc.prototype.hasStart=function(){return this.startSet_},Vc.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Vc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Vc.prototype.getIndexStartValue=function(){return di(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Vc.prototype.getIndexStartName=function(){return di(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:qo},Vc.prototype.hasEnd=function(){return this.endSet_},Vc.prototype.getIndexEndValue=function(){return di(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Vc.prototype.getIndexEndName=function(){return di(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Vo},Vc.prototype.hasLimit=function(){return this.limitSet_},Vc.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Vc.prototype.getLimit=function(){return di(this.limitSet_,"Only valid if limit has been set"),this.limit_},Vc.prototype.getIndex=function(){return this.index_},Vc.prototype.copy_=function(){var t=new Vc;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Vc.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Vc.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Vc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Vc.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Vc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Vc.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Vc.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Vc.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Vc.prototype.getQueryObject=function(){var t=Vc.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==za&&(e[t.INDEX]=this.index_.toString()),e},Vc.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Vc.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==za},Vc.prototype.getNodeFilter=function(){return this.loadsAllData()?new lu(this.getIndex()):this.hasLimit()?new Fc(this):new Mc(this)},Vc.prototype.toRestQueryStringParameters=function(){var t,e=Vc.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===za?e.PRIORITY_INDEX:this.index_===Ss?e.VALUE_INDEX:this.index_===Ua?e.KEY_INDEX:(di(this.index_ instanceof Is,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Oi(t),this.startSet_&&(n[e.START_AT]=Oi(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Oi(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Oi(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Oi(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Vc.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Vc.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Vc.DEFAULT=new Vc,Vc);function Vc(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=za}var Bc,jc=(ii(Wc,Bc=Us),Wc.prototype.getKey=function(){return Ki("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Wc.prototype.child=function(t){return Ki("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Yo||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),pa(t,e,n,r)}("Reference.child",1,t,!1):pa("Reference.child",1,t,!1)),new Wc(this.repo,this.path.child(t))},Wc.prototype.getParent=function(){Ki("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Wc(this.repo,t)},Wc.prototype.getRoot=function(){Ki("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Wc.prototype.databaseProp=function(){return this.repo.database},Wc.prototype.set=function(t,e){Ki("Reference.set",1,2,arguments.length),da("Reference.set",this.path),ua("Reference.set",1,t,this.path,!1),Hi("Reference.set",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Wc.prototype.update=function(t,e){if(Ki("Reference.update",1,2,arguments.length),da("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Io("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ca("Reference.update",1,t,this.path,!1),Hi("Reference.update",2,e,!0);var i=new bi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Wc.prototype.setWithPriority=function(t,e,n){if(Ki("Reference.setWithPriority",2,3,arguments.length),da("Reference.setWithPriority",this.path),ua("Reference.setWithPriority",1,t,this.path,!1),ha("Reference.setWithPriority",2,e,!1),Hi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new bi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Wc.prototype.remove=function(t){return Ki("Reference.remove",0,1,arguments.length),da("Reference.remove",this.path),Hi("Reference.remove",1,t,!0),this.set(null,t)},Wc.prototype.transaction=function(t,r,e){if(Ki("Reference.transaction",1,3,arguments.length),da("Reference.transaction",this.path),Hi("Reference.transaction",1,t,!1),Hi("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Qi(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new bi;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Ta(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},Wc.prototype.setPriority=function(t,e){Ki("Reference.setPriority",1,2,arguments.length),da("Reference.setPriority",this.path),ha("Reference.setPriority",1,t,!1),Hi("Reference.setPriority",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Wc.prototype.push=function(t,e){Ki("Reference.push",0,2,arguments.length),da("Reference.push",this.path),ua("Reference.push",1,t,this.path,!0),Hi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Aa(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Wc.prototype.onDisconnect=function(){return da("Reference.onDisconnect",this.path),new _a(this.repo,this.path)},Object.defineProperty(Wc.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Wc.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Wc.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Wc.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Wc);function Wc(t,e){if(!(t instanceof Pc))throw new Error("new Reference() no longer supported - use app.database().");return Bc.call(this,t,e,qc.DEFAULT,!1)||this}Us.__referenceConstructor=jc,Nu.__referenceConstructor=jc;var Kc,Qc,Hc=function(){this.children={},this.childCount=0,this.value=null},Gc=(zc.prototype.subTree=function(t){for(var e,n=t instanceof Yo?t:new Yo(t),r=this;null!==(e=n.getFront());)r=new zc(e,r,Mi(r.node_.children,e)||new Hc),n=n.popFront();return r},zc.prototype.getValue=function(){return this.node_.value},zc.prototype.setValue=function(t){di(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},zc.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},zc.prototype.hasChildren=function(){return 0<this.node_.childCount},zc.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},zc.prototype.forEachChild=function(n){var r=this;Wo(this.node_.children,function(t,e){n(new zc(t,r,e))})},zc.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},zc.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},zc.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},zc.prototype.path=function(){return new Yo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},zc.prototype.name=function(){return this.name_},zc.prototype.parent=function(){return this.parent_},zc.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},zc.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=xi(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},zc);function zc(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Hc),this.name_=t,this.parent_=e,this.node_=n}(Qc=Kc=Kc||{})[Qc.RUN=0]="RUN",Qc[Qc.SENT=1]="SENT",Qc[Qc.COMPLETED=2]="COMPLETED",Qc[Qc.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Qc[Qc.NEEDS_ABORT=4]="NEEDS_ABORT",Pc.MAX_TRANSACTION_RETRIES_=25,Pc.prototype.transactions_init_=function(){this.transactionQueueTree_=new Gc},Pc.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new jc(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Mo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Ns(a.currentInputSnapshot,new jc(this,a.path),za);a.onComplete(null,!1,c)}}else{wa("transaction failed: Data returned ",u,a.path),a.status=Kc.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&xi(u,".priority"))f=Mi(u,".priority"),di(sa(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||ys.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=_s(u,f),y=Qs(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Pc.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||ys.EMPTY_NODE},Pc.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);di(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Kc.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Pc.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];di(o.status===Kc.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=Kc.SENT,o.retryCount++;var a=Yo.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=Kc.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new jc(c,u[r].path),a=new Ns(i,o,za);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Qo(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===Kc.SENT_NEEDS_ABORT?u[r].status=Kc.NEEDS_ABORT:u[r].status=Kc.RUN;else{Io("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=Kc.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Pc.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Pc.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Kc.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Yo.relativePath(e,s.path),c=!1,h=void 0;if(di(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Kc.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Kc.RUN)if(s.retryCount>=Pc.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){wa("transaction failed: Data returned ",f,s.path);var p=_s(f);"object"==typeof f&&null!=f&&xi(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Qs(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Kc.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new jc(this,t[a].path),g=t[a].currentInputSnapshot,b=new Ns(g,v,za);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Qo(r[a]);this.sendReadyTransactions_()}},Pc.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Pc.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Pc.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Pc.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Kc.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Pc.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Pc.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===Kc.SENT_NEEDS_ABORT);else if(e[o].status===Kc.SENT)di(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Kc.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(di(e[o].status===Kc.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Qo(n[o])}};var Yc,Xc="databaseURL",Jc=($c.getInstance=function(){return Yc=Yc||new $c},$c.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},$c.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},$c.prototype.databaseFromApp=function(t,e){var n=e||t.options[Xc];void 0===n&&So("Can't determine Firebase Database URL.  Be sure to include "+Xc+" option when calling firebase.initializeApp().");var r=ia(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env[xo]),o&&(n="http://"+o+"?ns="+i.namespace,i=(r=ia(n)).repoInfo),ya("Invalid Firebase Database URL",1,r),r.path.isEmpty()||So("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},$c.prototype.deleteRepo=function(t){var e=Mi(this.repos_,t.app.name);e&&Mi(e,t.repoInfo_.toURLString())===t||So("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},$c.prototype.createRepo=function(t,e){var n=Mi(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Mi(n,t.toURLString());return r&&So("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Pc(t,this.useRestClient_,e),n[t.toURLString()]=r},$c.prototype.forceRestClient=function(t){this.useRestClient_=t},$c);function $c(){this.repos_={},this.useRestClient_=!1}var Zc=(Object.defineProperty(th.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),th.prototype.ref=function(t){return this.checkDeleted_("ref"),Ki("database.ref",0,1,arguments.length),t instanceof jc?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},th.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Ki(e,1,1,arguments.length);var n=ia(t);ya(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&So(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},th.prototype.checkDeleted_=function(t){null===this.repo_&&So("Cannot call "+t+" on a deleted database.")},th.prototype.goOffline=function(){Ki("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},th.prototype.goOnline=function(){Ki("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},th.ServerValue={TIMESTAMP:{".sv":"timestamp"}},th);function th(t){(this.repo_=t)instanceof Pc||So("Don't call new Database() directly - please use firebase.database()."),this.root_=new jc(t,Yo.Empty),this.INTERNAL=new eh(this)}var eh=(nh.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.database.checkDeleted_("delete"),Jc.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},nh);function nh(t){this.database=t}var rh=Object.freeze({forceLongPolling:function(){gc.forceDisallow(),fc.forceAllow()},forceWebSockets:function(){fc.forceDisallow()},isWebSocketsAvailable:function(){return gc.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),ih=Nc;Nc.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Nc.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var oh,ah,sh=Ec,uh=na,ch=Object.freeze({DataConnection:ih,RealTimeConnection:sh,hijackHash:function(i){var o=Nc.prototype.put;return Nc.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Nc.prototype.put=o}},ConnectionTarget:uh,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Jc.getInstance().forceRestClient(t)}}),hh=Zc.ServerValue;oh=(ah=il).SDK_VERSION,mc=oh,ah.INTERNAL.registerService("database",function(t,e,n){return Jc.getInstance().databaseFromApp(t,n)},{Reference:jc,Query:Us,Database:Zc,DataSnapshot:Ns,enableLogging:wo,INTERNAL:rh,ServerValue:hh,TEST_ACCESS:ch},null,!0);var lh,fh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ph=ph||{},dh=fh;function yh(t){return"string"==typeof t}function mh(t){return"number"==typeof t}function vh(t,e){t=t.split("."),e=e||dh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function gh(){}function bh(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function wh(t){return"array"==bh(t)}function _h(t){var e=bh(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Eh(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Th="closure_uid_"+(1e9*Math.random()>>>0),Sh=0;function Ih(t,e,n){return t.call.apply(t.bind,arguments)}function Ch(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Nh(t,e,n){return(Nh=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ih:Ch).apply(null,arguments)}function Ah(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var kh=Date.now||function(){return+new Date};function Dh(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Rh(){this.j=this.j,this.i=this.i}Rh.prototype.j=!1,Rh.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Th]||(this[Th]=++Sh)},Rh.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Oh=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(yh(t))return yh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Ph=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=yh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function xh(){return Array.prototype.concat.apply([],arguments)}function Mh(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Lh(t){return/^[\s\xa0]*$/.test(t)}var Fh,Uh=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function qh(t,e){return-1!=t.indexOf(e)}function Vh(t,e){return t<e?-1:e<t?1:0}t:{var Bh=dh.navigator;if(Bh){var jh=Bh.userAgent;if(jh){Fh=jh;break t}}Fh=""}function Wh(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Kh(t){var e,n={};for(e in t)n[e]=t[e];return n}var Qh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Hh(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Qh.length;i++)e=Qh[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Gh(t){return Gh[" "](t),t}Gh[" "]=gh;var zh,Yh,Xh=qh(Fh,"Opera"),Jh=qh(Fh,"Trident")||qh(Fh,"MSIE"),$h=qh(Fh,"Edge"),Zh=$h||Jh,tl=qh(Fh,"Gecko")&&!(qh(Fh.toLowerCase(),"webkit")&&!qh(Fh,"Edge"))&&!(qh(Fh,"Trident")||qh(Fh,"MSIE"))&&!qh(Fh,"Edge"),el=qh(Fh.toLowerCase(),"webkit")&&!qh(Fh,"Edge");function nl(){var t=dh.document;return t?t.documentMode:void 0}t:{var rl="",ol=(Yh=Fh,tl?/rv:([^\);]+)(\)|;)/.exec(Yh):$h?/Edge\/([\d\.]+)/.exec(Yh):Jh?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Yh):el?/WebKit\/(\S+)/.exec(Yh):Xh?/(?:Version)[ \/]?(\S+)/.exec(Yh):void 0);if(ol&&(rl=ol?ol[1]:""),Jh){var al=nl();if(null!=al&&al>parseFloat(rl)){zh=String(al);break t}}zh=rl}var sl,ul={};function cl(s){return function(t,e){var n=ul;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=Uh(String(zh)).split("."),n=Uh(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Vh(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Vh(0==o[2].length,0==a[2].length)||Vh(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var hl=dh.document;sl=hl&&Jh?nl()||("CSS1Compat"==hl.compatMode?parseInt(zh,10):5):void 0;var ll=!Jh||9<=Number(sl),fl=Jh&&!cl("9"),pl=function(){if(!dh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{dh.addEventListener("test",gh,e),dh.removeEventListener("test",gh,e)}catch(t){}return t}();function dl(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function yl(t,e){if(dl.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(tl){t:{try{Gh(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=yh(t.pointerType)?t.pointerType:ml[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}dl.prototype.b=function(){this.Ja=!1},Dh(yl,dl);var ml={2:"touch",3:"pen",4:"mouse"};yl.prototype.b=function(){yl.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,fl)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var vl="closure_listenable_"+(1e6*Math.random()|0),gl=0;function bl(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++gl,this.X=this.Z=!1}function wl(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function _l(t){this.src=t,this.a={},this.b=0}function El(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Oh(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(wl(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Tl(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}_l.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Tl(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new bl(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Sl="closure_lm_"+(1e6*Math.random()|0),Il={};function Cl(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(wh(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=xl(r);return e&&e[vl]?e.Ba(n,r,Eh(i)?!!i.capture:!!i,o):Nl(e,n,r,!0,i,o)}(t,e,n,r,i);if(wh(e)){for(var o=0;o<e.length;o++)Cl(t,e[o],n,r,i);return null}return n=xl(n),t&&t[vl]?t.Aa(e,n,Eh(r)?!!r.capture:!!r,i):Nl(t,e,n,!1,r,i)}function Nl(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Eh(i)?!!i.capture:!!i;if(a&&!ll)return null;var s=Ol(t);if(s||(t[Sl]=s=new _l(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Rl,n=ll?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)pl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(kl(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Al(t){if(!mh(t)&&t&&!t.X){var e=t.src;if(e&&e[vl])El(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(kl(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ol(e))?(El(n,t),0==n.b&&(n.src=null,e[Sl]=null)):wl(t)}}}function kl(t){return t in Il?Il[t]:Il[t]="on"+t}function Dl(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Al(t),n.call(r,e)}function Rl(t,e){return!!t.X||(ll?Dl(t,new yl(e,this)):Dl(t,e=new yl(e||vh("window.event"),this)))}function Ol(t){return(t=t[Sl])instanceof _l?t:null}var Pl="__closure_events_fn_"+(1e9*Math.random()>>>0);function xl(e){return"function"==bh(e)?e:(e[Pl]||(e[Pl]=function(t){return e.handleEvent(t)}),e[Pl])}function Ml(){Rh.call(this),this.c=new _l(this),(this.J=this).B=null}function Ll(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&El(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Dh(Ml,Rh),Ml.prototype[vl]=!0,(lh=Ml.prototype).addEventListener=function(t,e,n,r){Cl(this,t,e,n,r)},lh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(wh(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Eh(i)?!!i.capture:!!i,r=xl(r),e&&e[vl]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Tl(a=e.a[n],r,i,o))&&(wl(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Ol(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Tl(n,r,i,o)),(r=-1<e?n[e]:null)&&Al(r))}(this,t,e,n,r)},lh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(yh(t))t=new dl(t,n);else if(t instanceof dl)t.target=t.target||n;else{var i=t;Hh(t=new dl(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Ll(a,r,!0,t)&&i}if(i=Ll(a=t.a=n,r,!0,t)&&i,i=Ll(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ll(a=t.a=e[o],r,!1,t)&&i;return i},lh.G=function(){if(Ml.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)wl(n[r]);delete e.a[t],e.b--}}this.B=null},lh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},lh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Fl=dh.JSON.stringify;function Ul(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function ql(){this.b=this.a=null}Ul.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Vl,Bl=new Ul(function(){return new jl},function(t){t.reset()});function jl(){this.next=this.b=this.a=null}function Wl(t){dh.setTimeout(function(){throw t},0)}function Kl(t,e){Vl||function(){var t=dh.Promise.resolve(void 0);Vl=function(){t.then(Gl)}}(),Ql||(Vl(),Ql=!0),Hl.add(t,e)}ql.prototype.add=function(t,e){var n=Bl.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},jl.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ql=!(jl.prototype.reset=function(){this.next=this.b=this.a=null}),Hl=new ql;function Gl(){for(var t;r=n=void 0,r=null,(n=Hl).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Wl(t)}var e=Bl;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Ql=!1}function zl(t,e){Ml.call(this),this.b=t||1,this.a=e||dh,this.f=Nh(this.gb,this),this.g=kh()}function Yl(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Xl(t,e,n){if("function"==bh(t))n&&(t=Nh(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Nh(t.handleEvent,t)}return 2147483647<Number(e)?-1:dh.setTimeout(t,e||0)}function Jl(t,e,n){Rh.call(this),this.f=null!=n?Nh(t,n):t,this.c=e,this.b=Nh(this.ab,this),this.a=[]}function $l(t){t.U=Xl(t.b,t.c),t.f.apply(null,t.a)}function Zl(t){Rh.call(this),this.b=t,this.a={}}Dh(zl,Ml),(lh=zl.prototype).ba=!1,lh.L=null,lh.gb=function(){if(this.ba){var t=kh()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Yl(this),this.start()))}},lh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=kh())},lh.G=function(){zl.N.G.call(this),Yl(this),delete this.a},Dh(Jl,Rh),(lh=Jl.prototype).ea=!1,lh.U=null,lh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:$l(this)},lh.G=function(){Jl.N.G.call(this),this.U&&(dh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},lh.ab=function(){this.U=null,this.ea&&(this.ea=!1,$l(this))},Dh(Zl,Rh);var tf=[];function ef(t,e,n,r){wh(n)||(n&&(tf[0]=n.toString()),n=tf);for(var i=0;i<n.length;i++){var o=Cl(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function nf(t){Wh(t.a,function(t,e){this.a.hasOwnProperty(e)&&Al(t)},t),t.a={}}function rf(){}Zl.prototype.G=function(){Zl.N.G.call(this),nf(this)},Zl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var of=new Ml;function af(t){dl.call(this,"serverreachability",t)}function sf(t){of.dispatchEvent(new af(of,t))}function uf(t){dl.call(this,"statevent",t)}function cf(t){of.dispatchEvent(new uf(of,t))}function hf(t){dl.call(this,"timingevent",t)}function lf(t,e){if("function"!=bh(t))throw Error("Fn must not be null and must be a function");return dh.setTimeout(function(){t()},e)}Dh(af,dl),Dh(uf,dl),Dh(hf,dl);var ff={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},pf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function df(){}function yf(t){var e;return(e=t.a)||(e=t.a={}),e}function mf(){}df.prototype.a=null;var vf,gf={OPEN:"a",ib:"b",Na:"c",rb:"d"};function bf(){dl.call(this,"d")}function wf(){dl.call(this,"c")}function _f(){}function Ef(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Zl(this),this.O=Tf,t=Zh?125:void 0,this.P=new zl(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Dh(bf,dl),Dh(wf,dl),Dh(_f,df),vf=new _f;var Tf=45e3,Sf={},If={};function Cf(t,e,n){t.F=1,t.f=Jf(Kf(e)),t.l=n,t.H=!0,Af(t,null)}function Nf(t,e,n,r){t.F=1,t.f=Jf(Kf(e)),t.l=null,t.H=n,Af(t,r)}function Af(t,e){t.v=kh(),Rf(t),t.D=Kf(t.f),Xf(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Jl(Nh(t.Ka,t,t.a),t.J)),ef(t.I,t.a,"readystatechange",t.eb),e=t.h?Kh(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),sf(1)}function kf(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Df(t,n);if(i==If){4==e&&(t.c=4,cf(14),r=!1);break}if(i==Sf){t.c=4,cf(15),r=!1;break}Lf(t,i)}4==e&&0==n.length&&(t.c=1,cf(16),r=!1),t.b=t.b&&r,r||(Mf(t),xf(t))}function Df(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?If:(n=Number(e.substring(n,r)),isNaN(n)?Sf:(r+=1)+n>e.length?If:(e=e.substr(r,n),t.A=r+n,e))}function Rf(t){t.R=kh()+t.O,Of(t,t.O)}function Of(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=lf(Nh(t.bb,t),e)}function Pf(t){t.i&&(dh.clearTimeout(t.i),t.i=null)}function xf(t){t.g.Da()||t.m||t.g.na(t)}function Mf(t){Pf(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Yl(t.P),nf(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Lf(t,e){try{t.g.Ga(t,e),sf(4)}catch(t){}}function Ff(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_h(t)||yh(t))Ph(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(_h(t)||yh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(yh(t))return t.split("");if(_h(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Uf(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Uf)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qf(t,e){Bf(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Vf(t))}function Vf(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Bf(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Bf(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Bf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(lh=Ef.prototype).setTimeout=function(t){this.O=t},lh.eb=function(t){t=t.target;var e=this.B;e&&3==Wp(t)?e.Ua():this.Ka(t)},lh.Ka=function(t){try{if(t==this.a)t:{var e=Wp(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!Zh&&!this.a.aa())){this.m||4!=e||7==n||sf(8==n||r<=0?3:2),Pf(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Kp(this.a,"X-HTTP-Initial-Response");if(a&&!Lh(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,cf(12),Mf(this),xf(this);break t}this.s=!0,Lf(this,s)}this.H?(kf(this,e,o),Zh&&this.b&&3==e&&(ef(this.I,this.P,"tick",this.cb),this.P.start())):Lf(this,o),4==e&&Mf(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Rf(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,cf(12)):(this.c=0,cf(13)),Mf(this),xf(this)}}}catch(t){}},lh.cb=function(){if(this.a){var t=Wp(this.a),e=this.a.aa();this.A<e.length&&(Pf(this),kf(this,t,e),this.b&&4!=t&&Rf(this))}},lh.cancel=function(){this.m=!0,Mf(this)},lh.bb=function(){this.i=null;var t=kh();0<=t-this.R?(2!=this.F&&(sf(3),cf(17)),Mf(this),this.c=2,xf(this)):Of(this,this.R-t)},(lh=Uf.prototype).C=function(){Vf(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},lh.K=function(){return Vf(this),this.a.concat()},lh.get=function(t,e){return Bf(this.b,t)?this.b[t]:e},lh.set=function(t,e){Bf(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},lh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var jf=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Wf(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Wf?(this.h=void 0!==e?e:t.h,Qf(this,t.f),this.j=t.j,Hf(this,t.b),Gf(this,t.i),this.a=t.a,zf(this,lp(t.c)),this.g=t.g):t&&(n=String(t).match(jf))?(this.h=!!e,Qf(this,n[1]||"",!0),this.j=$f(n[2]||""),Hf(this,n[3]||"",!0),Gf(this,n[4]),this.a=$f(n[5]||"",!0),zf(this,n[6]||"",!0),this.g=$f(n[7]||"")):(this.h=!!e,this.c=new ap(null,this.h))}function Kf(t){return new Wf(t)}function Qf(t,e,n){t.f=n?$f(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Hf(t,e,n){t.b=n?$f(e,!0):e}function Gf(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function zf(t,e,n){e instanceof ap?(t.c=e,function(t,e){e&&!t.f&&(sp(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(up(this,e),hp(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Zf(e,ip)),t.c=new ap(e,t.h))}function Yf(t,e,n){t.c.set(e,n)}function Xf(t,e,n){wh(n)||(n=[String(n)]),hp(t.c,e,n)}function Jf(t){return Yf(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^kh()).toString(36)),t}function $f(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Zf(t,e,n){return yh(t)?(t=encodeURI(t).replace(e,tp),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tp(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Wf.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Zf(e,ep,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Zf(e,ep,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Zf(n,"/"==n.charAt(0)?rp:np,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Zf(n,op)),t.join("")},Wf.prototype.resolve=function(t){var e=Kf(this),n=!!t.f;n?Qf(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Hf(e,t.b):n=null!=t.i;var r=t.a;if(n)Gf(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(qh(i,"./")||qh(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?zf(e,lp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ep=/[#\/\?@]/g,np=/[#\?:]/g,rp=/[#\?]/g,ip=/[#\?@]/g,op=/#/g;function ap(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function sp(n){n.a||(n.a=new Uf,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function up(t,e){sp(t),e=fp(t,e),Bf(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qf(t.a,e))}function cp(t,e){return sp(t),e=fp(t,e),Bf(t.a.b,e)}function hp(t,e,n){up(t,e),0<n.length&&(t.c=null,t.a.set(fp(t,e),Mh(n)),t.b+=n.length)}function lp(t){var e=new ap;return e.c=t.c,t.a&&(e.a=new Uf(t.a),e.b=t.b),e}function fp(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function pp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function dp(t){var e=t.a.F.a;if(null!=e)cf(4),e?(cf(10),nd(t.a,t,!1)):(cf(11),nd(t.a,t,!0));else{t.b=new Ef(t,void 0,void 0),t.b.h=t.h,e=sd(e=t.a,e.Y()?t.f:null,t.i),cf(4),Xf(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Yf(e,n,r),Nf(t.b,e,!1,t.f)}}function yp(){this.a=this.b=null}function mp(){this.a=new Uf}function vp(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Th]||(t[Th]=++Sh)):e.charAt(0)+t}function gp(t,e){this.b=t,this.a=e}function bp(t){this.g=t||wp,t=dh.PerformanceNavigationTiming?0<(t=dh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(dh.ka&&dh.ka.Ea&&dh.ka.Ea()&&dh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new mp),this.b=null,this.c=[]}(lh=ap.prototype).add=function(t,e){sp(this),this.c=null,t=fp(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},lh.forEach=function(n,r){sp(this),this.a.forEach(function(t,e){Ph(t,function(t){n.call(r,t,e,this)},this)},this)},lh.K=function(){sp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},lh.C=function(t){sp(this);var e=[];if(yh(t))cp(this,t)&&(e=xh(e,this.a.get(fp(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=xh(e,t[n])}return e},lh.set=function(t,e){return sp(this),this.c=null,cp(this,t=fp(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},lh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},lh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Dh(function(){},function(){}),(lh=pp.prototype).M=null,lh.$=function(t){return this.a.$(t)},lh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},lh.Da=function(){return!1},lh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Kp(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Kp(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void od(e,2)}this.f=r[0]}else(e=this.a).m=this.c,od(e,2)}else 1==this.M&&(this.g?cf(6):"11111"==e?(cf(5),this.g=!0,(!Jh||10<=Number(sl))&&(this.c=200,this.b.cancel(),cf(11),nd(this.a,this,!0))):(cf(7),this.g=!1))},lh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,dp(this)):1==this.M&&(this.g?(cf(11),nd(this.a,this,!0)):(cf(10),nd(this.a,this,!1)));else{0==this.M?cf(8):1==this.M&&cf(9);var t=this.a;t.m=this.c,od(t,2)}},lh.Y=function(){return this.a.Y()},lh.ma=function(){return this.a.ma()},mp.prototype.add=function(t){this.a.set(vp(t),t)},mp.prototype.C=function(){return this.a.C()};var wp=10;function _p(t,e){!t.a&&(qh(e,"spdy")||qh(e,"quic")||qh(e,"h2"))&&(t.f=t.g,t.a=new mp,t.b&&(Ip(t,t.b),t.b=null))}function Ep(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Tp(t){return t.b?1:t.a?t.a.a.c:0}function Sp(t,e){return t=t.b?t.b==e:!!t.a&&(e=vp(e),Bf(t.a.a.b,e))}function Ip(t,e){t.a?t.a.add(e):t.b=e}function Cp(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=vp(e),n=Bf(t.a.a.b,n)),n&&qf(t.a.a,vp(e)))}function Np(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Mh(t.c);var e=t.c;return Ph(t.a.C(),function(t){e=e.concat(t.j)}),e}function Ap(){}function kp(){this.a=new Ap}function Dp(t,r,e){var i=e||"";try{Ff(t,function(t,e){var n=t;Eh(t)&&(n=Fl(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Rp(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bp.prototype.cancel=function(){this.c=Np(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Ph(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Ap.prototype.stringify=function(t){return dh.JSON.stringify(t,void 0)},Ap.prototype.parse=function(t){return dh.JSON.parse(t,void 0)};var Op=dh.JSON.parse;function Pp(t){Ml.call(this),this.headers=new Uf,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=xp,this.D=this.F=!1}Dh(Pp,Ml);var xp="",Mp=/^https?$/i,Lp=["POST","PUT"];function Fp(t){return"content-type"==t.toLowerCase()}function Up(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qp(t),Bp(t)}function qp(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Vp(t){if(t.b&&void 0!==ph&&(!t.s[1]||4!=Wp(t)||2!=t.T()))if(t.l&&4==Wp(t))Xl(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Wp(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(jf)[1]||null;if(!o&&dh.self&&dh.self.location){var a=dh.self.location.protocol;o=a.substr(0,a.length-1)}i=!Mp.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",qp(t))}finally{Bp(t)}}}function Bp(t,e){if(t.a){jp(t);var n=t.a,r=t.s[0]?gh:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function jp(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(dh.clearTimeout(t.m),t.m=null)}function Wp(t){return t.a?t.a.readyState:0}function Kp(t,e){return t.a?t.a.getResponseHeader(e):null}function Qp(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return Wh(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),yh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Yf(t,e,n),t}function Hp(t){this.f=[],this.F=new yp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!vh("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=vh("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=vh("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=vh("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=vh("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new bp(t&&t.concurrentRequestLimit),this.ja=new kp,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Gp(t){if(zp(t),3==t.u){var e=t.P++,n=Kf(t.B);Yf(n,"SID",t.H),Yf(n,"RID",e),Yf(n,"TYPE","terminate"),$p(t,n),(e=new Ef(t,e,void 0)).F=2,e.f=Jf(Kf(n)),n=!1,dh.navigator&&dh.navigator.sendBeacon&&(n=dh.navigator.sendBeacon(e.f.toString(),"")),!n&&dh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=kh(),Rf(e)}ad(t)}function zp(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(dh.clearTimeout(t.l),t.l=null),rd(t),t.b.cancel(),t.h&&(mh(t.h)&&dh.clearTimeout(t.h),t.h=null)}function Yp(t,e){t.f.push(new gp(t.Ra++,e)),3==t.u&&Xp(t)}function Xp(t){Ep(t.b)||t.h||(t.h=!0,Kl(t.Ia,t),t.A=0)}function Jp(t,e){var n;n=e?e.W:t.P++;var r=Kf(t.B);Yf(r,"SID",t.H),Yf(r,"RID",n),Yf(r,"AID",t.O),$p(t,r),t.g&&t.i&&Qp(r,t.g,t.i),n=new Ef(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Zp(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ip(t.b,n),Cf(n,r,e)}function $p(t,n){t.c&&Ff({},function(t,e){Yf(n,e,t)})}function Zp(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Nh(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Dp(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function td(t){t.a||t.l||(t.S=1,Kl(t.Ha,t),t.v=0)}function ed(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=lf(Nh(t.Ha,t),id(t,t.v)),t.v++,!0)}function nd(t,e,n){var r=e.l;r&&_p(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=sd(t,null,t.ha),Xp(t)}function rd(t){null!=t.s&&(dh.clearTimeout(t.s),t.s=null)}function id(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function od(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Nh(t.fb,t);n||(n=new Wf("//www.google.com/images/cleardot.gif"),dh.location&&"http"==dh.location.protocol||Qf(n,"https"),Jf(n)),function(t,e){var n=new rf;if(dh.Image){var r=new Image;r.onload=Ah(Rp,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Ah(Rp,n,r,"TestLoadImage: error",!1,e),r.onabort=Ah(Rp,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ah(Rp,n,r,"TestLoadImage: timeout",!1,e),dh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else cf(2);t.u=0,t.c&&t.c.ta(e),ad(t),zp(t)}function ad(t){t.u=0,t.m=-1,t.c&&(0==Np(t.b).length&&0==t.f.length||(t.b.c.length=0,Mh(t.f),t.f.length=0),t.c.sa())}function sd(t,e,n){var r=function(t){return t instanceof Wf?Kf(t):new Wf(t,void 0)}(n);if(""!=r.b)e&&Hf(r,e+"."+r.b),Gf(r,r.i);else{var i,o=dh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Wf(null,void 0);return t&&Qf(i,t),e&&Hf(i,e),n&&Gf(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Wh(t.V,function(t,e){Yf(r,e,t)}),e=t.j,n=t.I,e&&n&&Yf(r,e,n),Yf(r,"VER",t.wa),$p(t,r),r}function ud(){}function cd(){if(Jh&&!(10<=Number(sl)))throw Error("Environmental error: no available transport.")}function hd(t,e){Ml.call(this),this.a=new Hp(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Lh(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Lh(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new pd(this)}function ld(t){bf.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function fd(){wf.call(this),this.status=1}function pd(t){this.a=t}(lh=Pp.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?yf(this.H):yf(vf),this.a.onreadystatechange=Nh(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Up(this,t)}t=n||"";var i=new Uf(this.headers);r&&Ff(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Fp,n=t.length,r=yh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:yh(t)?t.charAt(e):t[e]}(i.K()),n=dh.FormData&&t instanceof dh.FormData,0<=Oh(Lp,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jp(this),0<this.o&&((this.D=function(t){return Jh&&cl(9)&&mh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Nh(this.Ca,this)):this.m=Xl(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Up(this,t)}},lh.Ca=function(){void 0!==ph&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},lh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Bp(this))},lh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Bp(this,!0)),Pp.N.G.call(this)},lh.Fa=function(){this.j||(this.w||this.l||this.g?Vp(this):this.$a())},lh.$a=function(){Vp(this)},lh.T=function(){try{return 2<Wp(this)?this.a.status:-1}catch(t){return-1}},lh.za=function(){try{return 2<Wp(this)?this.a.statusText:""}catch(t){return""}},lh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},lh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Op(e)}},lh.ya=function(){return this.h},lh.Ya=function(){return yh(this.f)?this.f:String(this.f)},(lh=Hp.prototype).wa=8,lh.u=1,lh.Da=function(){return 0==this.u},lh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Ef(this,t,void 0),r=this.i;if(this.J&&(r?Hh(r=Kh(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&yh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zp(this,n,e),Yf(i=Kf(this.B),"RID",t),Yf(i,"CVER",22),this.o&&this.j&&Yf(i,"X-HTTP-Session-Id",this.j),$p(this,i),this.g&&r&&Qp(i,this.g,r),Ip(this.b,n),this.W?(Yf(i,"$req",e),Yf(i,"SID","null"),n.S=!0,Cf(n,i,null)):Cf(n,i,e),this.u=2}}else 3==this.u&&(t?Jp(this,t):0==this.f.length||Ep(this.b)||Jp(this))},lh.Ha=function(){this.l=null,this.a=new Ef(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Kf(this.pa);Yf(t,"RID","rpc"),Yf(t,"SID",this.H),Yf(t,"CI",this.ia?"0":"1"),Yf(t,"AID",this.O),$p(this,t),Yf(t,"TYPE","xmlhttp"),this.g&&this.i&&Qp(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Nf(this.a,t,!0,this.ga)},lh.Ga=function(t,e){if(0!=this.u&&(this.a==t||Sp(this.b,t)))if(this.m=t.o,!t.s&&Sp(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(wh(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;rd(this),this.a.cancel(),this.a=null}ed(this),cf(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=lf(Nh(this.Za,this),6e3));if(Tp(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else od(this,11)}else if(!t.s&&this.a!=t||rd(this),!Lh(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&mh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Kp(r,"X-Client-Wire-Protocol"))&&_p(this.b,i),this.j&&(r=Kp(r,"X-HTTP-Session-Id")))&&(this.I=r,Yf(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=sd(this,this.Y()?this.ga:null,this.ha),r.s?(Cp(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Pf(r),Rf(r)),this.a=r):td(this),0<this.f.length&&Xp(this)}else"stop"!=r[0]&&"close"!=r[0]||od(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?od(this,7):Gp(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},lh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,ed(this),cf(19))},lh.na=function(t){var e=null;if(this.a==t){rd(this),this.a=null;var n=2}else{if(!Sp(this.b,t))return;e=t.j,Cp(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=kh()-t.v,of.dispatchEvent(new hf(of,t.l?t.l.length:0,e,this.A)),Xp(this)):td(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Tp(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=lf(Nh(t.Ia,t,e),id(t,t.A)),t.A++,!0))}(this,t)||2==n&&ed(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:od(this,5);break;case 4:od(this,10);break;case 3:od(this,6);break;default:od(this,2)}}},lh.fb=function(t){cf(t?2:1)},lh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Pp(this.La)).F=this.R,t},lh.ma=function(){return!!this.c&&!0},lh.Y=function(){return this.R},(lh=ud.prototype).va=function(){},lh.ua=function(){},lh.ta=function(){},lh.sa=function(){},lh.Ta=function(){},cd.prototype.a=function(t,e){return new hd(t,e)},Dh(hd,Ml),(lh=hd.prototype).addEventListener=function(t,e,n,r){hd.N.addEventListener.call(this,t,e,n,r)},lh.removeEventListener=function(t,e,n,r){hd.N.removeEventListener.call(this,t,e,n,r)},lh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;cf(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new pp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Qp(e,t.g,t.i)),(t=t.w).i=n,e=sd(t.a,null,t.i),cf(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,dp(t)):(Xf(e,"MODE","init"),!t.a.o&&t.a.j&&Xf(e,"X-HTTP-Session-Id",t.a.j),t.b=new Ef(t,void 0,void 0),t.b.h=t.h,Nf(t.b,e,!1,null),t.M=0)},lh.close=function(){Gp(this.a)},lh.Xa=function(t){if(yh(t)){var e={};e.__data__=t,Yp(this.a,e)}else this.h?((e={}).__data__=Fl(t),Yp(this.a,e)):Yp(this.a,t)},lh.G=function(){this.a.c=null,delete this.f,Gp(this.a),delete this.a,hd.N.G.call(this)},Dh(ld,bf),Dh(fd,wf),Dh(pd,ud),pd.prototype.va=function(){this.a.dispatchEvent("a")},pd.prototype.ua=function(t){this.a.dispatchEvent(new ld(t))},pd.prototype.ta=function(t){this.a.dispatchEvent(new fd(t))},pd.prototype.sa=function(){this.a.dispatchEvent("b")};var dd=Ah(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},cd);cd.prototype.createWebChannel=cd.prototype.a,hd.prototype.send=hd.prototype.Xa,hd.prototype.open=hd.prototype.Wa,hd.prototype.close=hd.prototype.close,ff.NO_ERROR=0,ff.TIMEOUT=8,ff.HTTP_ERROR=6,pf.COMPLETE="complete",(mf.EventType=gf).OPEN="a",gf.CLOSE="b",gf.ERROR="c",gf.MESSAGE="d",Ml.prototype.listen=Ml.prototype.Aa,Pp.prototype.listenOnce=Pp.prototype.Ba,Pp.prototype.getLastError=Pp.prototype.Ya,Pp.prototype.getLastErrorCode=Pp.prototype.ya,Pp.prototype.getStatus=Pp.prototype.T,Pp.prototype.getStatusText=Pp.prototype.za,Pp.prototype.getResponseJson=Pp.prototype.Va,Pp.prototype.getResponseText=Pp.prototype.aa,Pp.prototype.send=Pp.prototype.ca;var yd,md,vd={createWebChannelTransport:dd,ErrorCode:ff,EventType:pf,WebChannel:mf,XhrIo:Pp},gd=vd.createWebChannelTransport,bd=vd.ErrorCode,wd=vd.EventType,_d=vd.WebChannel,Ed=vd.XhrIo,Td=il.SDK_VERSION,Sd=new to("@firebase/firestore");function Id(){return Sd.logLevel===Yi.DEBUG?yd.DEBUG:Sd.logLevel===Yi.SILENT?yd.SILENT:yd.ERROR}function Cd(t){switch(t){case yd.DEBUG:Sd.logLevel=Yi.DEBUG;break;case yd.ERROR:Sd.logLevel=Yi.ERROR;break;case yd.SILENT:Sd.logLevel=Yi.SILENT;break;default:Sd.error("Firestore ("+Td+"): Invalid value passed to `setLogLevel`")}}function Nd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Sd.logLevel<=Yi.DEBUG){var i=n.map(kd);Sd.debug.apply(Sd,["Firestore ("+Td+") ["+t+"]: "+e].concat(i))}}function Ad(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Sd.logLevel<=Yi.ERROR){var r=e.map(kd);Sd.error.apply(Sd,["Firestore ("+Td+"): "+t].concat(r))}}function kd(e){if("string"==typeof e)return e;var t=Od.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Dd(t){var e="FIRESTORE ("+Td+") INTERNAL ASSERTION FAILED: "+t;throw Ad(e),new Error(e)}function Rd(t,e){t||Dd(e)}(md=yd=yd||{})[md.DEBUG=0]="DEBUG",md[md.ERROR=1]="ERROR",md[md.SILENT=2]="SILENT";var Od=(Pd.setPlatform=function(t){Pd.platform&&Dd("Platform already defined"),Pd.platform=t},Pd.getPlatform=function(){return Pd.platform||Dd("Platform not set"),Pd.platform},Pd);function Pd(){}function xd(){return Od.getPlatform().emptyByteString}var Md,Ld={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fd=(ii(Ud,Md=Error),Ud);function Ud(t,e){var n=Md.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function qd(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Fd(Ld.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Vd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Bd(t,e){return void 0!==t?t:e}function jd(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Wd(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Kd(t){for(var e in Rd(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qd(t,e){if(0!==e.length)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+uy(e.length,"argument")+".")}function Hd(t,e,n){if(e.length!==n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires "+uy(n,"argument")+", but was called with "+uy(e.length,"argument")+".")}function Gd(t,e,n){if(e.length<n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires at least "+uy(n,"argument")+", but was called with "+uy(e.length,"argument")+".")}function zd(t,e,n,r){if(e.length<n||e.length>r)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+uy(e.length,"argument")+".")}function Yd(t,e,n,r){ey(t,e,sy(n)+" argument",r)}function Xd(t,e,n,r){void 0!==r&&Yd(t,e,n,r)}function Jd(t,e,n,r){ey(t,e,n+" option",r)}function $d(t,e,n,r){void 0!==r&&Jd(t,e,n,r)}function Zd(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+ry(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+ry(r[o]))}(t,e,n,r,i)}function ty(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(ry(u))}var c=ry(r);throw new Fd(Ld.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ey(t,e,n,r){if(!("object"===e?ny(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=ry(r);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ny(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ry(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Dd("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function iy(t,e,n){if(void 0===n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+sy(e)+" argument, but it was undefined.")}function oy(n,t,r){Wd(t,function(t,e){if(r.indexOf(t)<0)throw new Fd(Ld.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function ay(t,e,n,r){var i=ry(r);return new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+sy(n)+" argument to be a "+e+", but it was: "+i)}function sy(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function uy(t,e){return t+" "+e+(1===t?"":"s")}var cy=(hy.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Rd(20===e.length,"Invalid auto ID: "+e),e},hy);function hy(){}function ly(t,e){return t<e?-1:e<t?1:0}function fy(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function py(t){return t+"\0"}function dy(){if("undefined"==typeof Uint8Array)throw new Fd(Ld.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function yy(){if(!Od.getPlatform().base64Available)throw new Fd(Ld.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var my=(vy.fromBase64String=function(t){Hd("Blob.fromBase64String",arguments,1),Yd("Blob.fromBase64String","string",1,t),yy();try{return new vy(Od.getPlatform().atob(t))}catch(t){throw new Fd(Ld.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},vy.fromUint8Array=function(t){if(Hd("Blob.fromUint8Array",arguments,1),dy(),!(t instanceof Uint8Array))throw ay("Blob.fromUint8Array","Uint8Array",1,t);return new vy(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},vy.prototype.toBase64=function(){return Hd("Blob.toBase64",arguments,0),yy(),Od.getPlatform().btoa(this._binaryString)},vy.prototype.toUint8Array=function(){Hd("Blob.toUint8Array",arguments,0),dy();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},vy.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},vy.prototype.isEqual=function(t){return this._binaryString===t._binaryString},vy.prototype._compareTo=function(t){return ly(this._binaryString,t._binaryString)},vy);function vy(t){yy(),this._binaryString=t}var gy=qd(my,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),by=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},wy="(default)",_y=(Object.defineProperty(Ey.prototype,"isDefaultDatabase",{get:function(){return this.database===wy},enumerable:!0,configurable:!0}),Ey.prototype.isEqual=function(t){return t instanceof Ey&&t.projectId===this.projectId&&t.database===this.database},Ey.prototype.compareTo=function(t){return ly(this.projectId,t.projectId)||ly(this.database,t.database)},Ey);function Ey(t,e){this.projectId=t,this.database=e||wy}var Ty=(Sy.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Sy.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Sy.INVALID=-1,Sy);function Sy(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Iy="__name__",Cy=(Object.defineProperty(Ny.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Ny.prototype.isEqual=function(t){return 0===Ny.comparator(this,t)},Ny.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ny?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Ny.prototype.limit=function(){return this.offset+this.length},Ny.prototype.popFirst=function(t){return t=void 0===t?1:t,Rd(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Ny.prototype.popLast=function(){return Rd(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Ny.prototype.firstSegment=function(){return Rd(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Ny.prototype.lastSegment=function(){return this.get(this.length-1)},Ny.prototype.get=function(t){return Rd(t<this.length,"Index out of range"),this.segments[this.offset+t]},Ny.prototype.isEmpty=function(){return 0===this.length},Ny.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ny.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ny.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ny.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ny.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Ny);function Ny(t,e,n){void 0===e?e=0:e>t.length&&Dd("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Dd("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Ay,ky=(ii(Dy,Ay=Cy),Dy.prototype.construct=function(t,e,n){return new Dy(t,e,n)},Dy.prototype.canonicalString=function(){return this.toArray().join("/")},Dy.prototype.toString=function(){return this.canonicalString()},Dy.fromString=function(t){if(0<=t.indexOf("//"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Dy(t.split("/").filter(function(t){return 0<t.length}))},Dy.EMPTY_PATH=new Dy([]),Dy);function Dy(){return null!==Ay&&Ay.apply(this,arguments)||this}var Ry,Oy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Py=(ii(xy,Ry=Cy),xy.prototype.construct=function(t,e,n){return new xy(t,e,n)},xy.isValidIdentifier=function(t){return Oy.test(t)},xy.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),xy.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},xy.prototype.toString=function(){return this.canonicalString()},xy.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Iy},xy.keyField=function(){return new xy([Iy])},xy.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Fd(Ld.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Fd(Ld.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new xy(e)},xy.EMPTY_PATH=new xy([]),xy);function xy(){return null!==Ry&&Ry.apply(this,arguments)||this}var My=(Ly.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ly.prototype.isEqual=function(t){return null!==t&&0===ky.comparator(this.path,t.path)},Ly.prototype.toString=function(){return this.path.toString()},Ly.comparator=function(t,e){return ky.comparator(t.path,e.path)},Ly.isDocumentKey=function(t){return t.length%2==0},Ly.fromSegments=function(t){return new Ly(new ky(t.slice()))},Ly.fromPathString=function(t){return new Ly(ky.fromString(t))},Ly.EMPTY=new Ly(new ky([])),Ly);function Ly(t){this.path=t,Rd(Ly.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Fy,Uy,qy=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(Uy=Fy=Fy||{}).All="all",Uy.ListenStreamIdle="listen_stream_idle",Uy.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Uy.WriteStreamIdle="write_stream_idle",Uy.WriteStreamConnectionBackoff="write_stream_connection_backoff",Uy.OnlineStateTimeout="online_state_timeout",Uy.ClientMetadataRefresh="client_metadata_refresh",Uy.LruGarbageCollection="lru_garbage_collection";var Vy=(By.createAndSchedule=function(t,e,n,r,i){var o=new By(t,e,Date.now()+n,r,i);return o.start(n),o},By.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},By.prototype.skipDelay=function(){return this.handleDelayElapsed()},By.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Fd(Ld.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},By.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},By.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},By);function By(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new qy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var jy=(Object.defineProperty(Wy.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Wy.prototype.enqueueAndForget=function(t){this.enqueue(t)},Wy.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Wy.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Wy.prototype.enqueueAndInitiateShutdown=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Wy.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Wy.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Ad("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},Wy.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Rd(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Rd(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Vy.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Wy.prototype.verifyNotFailed=function(){this.failure&&Dd("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Wy.prototype.verifyOperationInProgress=function(){Rd(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Wy.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Wy.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Wy.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Rd(r===Fy.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Fy.All&&n.timerId===r)break}return i.drain()})},Wy.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Rd(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Wy);function Wy(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1}var Ky="",Qy="",Hy="",Gy="";function zy(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Xy(e)),e=Yy(t.get(n),e);return Xy(e)}function Yy(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Ky+Hy;break;case Ky:n+=Ky+Gy;break;default:n+=o}}return n}function Xy(t){return t+Ky+Qy}function Jy(t){var e=t.length;if(Rd(2<=e,"Invalid path "+t),2===e)return Rd(t.charAt(0)===Ky&&t.charAt(1)===Qy,"Non-empty path "+t+" had length 2"),ky.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Ky,o);switch((a<0||n<a)&&Dd('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Qy:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Hy:i+=t.substring(o,a),i+="\0";break;case Gy:i+=t.substring(o,a+1);break;default:Dd('Invalid encoded resource path: "'+t+'"')}o=a+2}return new ky(r)}var $y=(Zy.now=function(){return Zy.fromMillis(Date.now())},Zy.fromDate=function(t){return Zy.fromMillis(t.getTime())},Zy.fromMillis=function(t){var e=Math.floor(t/1e3);return new Zy(e,1e6*(t-1e3*e))},Zy.prototype.toDate=function(){return new Date(this.toMillis())},Zy.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Zy.prototype._compareTo=function(t){return this.seconds===t.seconds?ly(this.nanoseconds,t.nanoseconds):ly(this.seconds,t.seconds)},Zy.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Zy.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Zy);function Zy(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var tm=(em.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new em(new $y(e,t%1e6*1e3))},em.fromTimestamp=function(t){return new em(t)},em.forDeletedDoc=function(){return em.MIN},em.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},em.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},em.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},em.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},em.prototype.toTimestamp=function(){return this.timestamp},em.MIN=new em(new $y(0,0)),em);function em(t){this.timestamp=t}var nm=(rm.prototype.insert=function(t,e){return new rm(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,am.BLACK,null,null))},rm.prototype.remove=function(t){return new rm(this.comparator,this.root.remove(t,this.comparator).copy(null,null,am.BLACK,null,null))},rm.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},rm.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},rm.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(rm.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),rm.prototype.minKey=function(){return this.root.minKey()},rm.prototype.maxKey=function(){return this.root.maxKey()},rm.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},rm.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},rm.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},rm.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},rm.prototype.getIterator=function(){return new im(this.root,null,this.comparator,!1)},rm.prototype.getIteratorFrom=function(t){return new im(this.root,t,this.comparator,!1)},rm.prototype.getReverseIterator=function(){return new im(this.root,null,this.comparator,!0)},rm.prototype.getReverseIteratorFrom=function(t){return new im(this.root,t,this.comparator,!0)},rm);function rm(t,e){this.comparator=t,this.root=e||am.EMPTY}var im=(om.prototype.getNext=function(){Rd(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},om.prototype.hasNext=function(){return 0<this.nodeStack.length},om.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},om);function om(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var am=(sm.prototype.copy=function(t,e,n,r,i){return new sm(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},sm.prototype.isEmpty=function(){return!1},sm.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},sm.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},sm.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},sm.prototype.minKey=function(){return this.min().key},sm.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},sm.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},sm.prototype.removeMin=function(){if(this.left.isEmpty())return sm.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},sm.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return sm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},sm.prototype.isRed=function(){return this.color},sm.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},sm.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},sm.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},sm.prototype.rotateLeft=function(){var t=this.copy(null,null,sm.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},sm.prototype.rotateRight=function(){var t=this.copy(null,null,sm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},sm.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},sm.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},sm.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Dd("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Dd("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Dd("Black depths differ");return t+(this.isRed()?0:1)},sm.EMPTY=null,sm.RED=!0,sm.BLACK=!1,sm);function sm(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:sm.RED,this.left=null!=r?r:sm.EMPTY,this.right=null!=i?i:sm.EMPTY,this.size=this.left.size+1+this.right.size}var um=(Object.defineProperty(cm.prototype,"key",{get:function(){throw Dd("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(cm.prototype,"value",{get:function(){throw Dd("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(cm.prototype,"color",{get:function(){throw Dd("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(cm.prototype,"left",{get:function(){throw Dd("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(cm.prototype,"right",{get:function(){throw Dd("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),cm.prototype.copy=function(t,e,n,r,i){return this},cm.prototype.insert=function(t,e,n){return new am(t,e)},cm.prototype.remove=function(t,e){return this},cm.prototype.isEmpty=function(){return!0},cm.prototype.inorderTraversal=function(t){return!1},cm.prototype.reverseTraversal=function(t){return!1},cm.prototype.minKey=function(){return null},cm.prototype.maxKey=function(){return null},cm.prototype.isRed=function(){return!1},cm.prototype.checkMaxDepth=function(){return!0},cm.prototype.check=function(){return 0},cm);function cm(){this.size=0}am.EMPTY=new um;var hm=(lm.fromMapKeys=function(t){var e=new lm(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},lm.prototype.has=function(t){return null!==this.data.get(t)},lm.prototype.first=function(){return this.data.minKey()},lm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(lm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),lm.prototype.indexOf=function(t){return this.data.indexOf(t)},lm.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},lm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},lm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},lm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},lm.prototype.getIterator=function(){return new fm(this.data.getIterator())},lm.prototype.getIteratorFrom=function(t){return new fm(this.data.getIteratorFrom(t))},lm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},lm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},lm.prototype.isEmpty=function(){return this.data.isEmpty()},lm.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},lm.prototype.isEqual=function(t){if(!(t instanceof lm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},lm.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},lm.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},lm.prototype.copy=function(t){var e=new lm(this.comparator);return e.data=t,e},lm);function lm(t){this.comparator=t,this.data=new nm(this.comparator)}var fm=(pm.prototype.getNext=function(){return this.iter.getNext().key},pm.prototype.hasNext=function(){return this.iter.hasNext()},pm);function pm(t){this.iter=t}var dm=new nm(My.comparator);function ym(){return dm}function mm(){return ym()}var vm=new nm(My.comparator);function gm(){return vm}var bm=new nm(My.comparator);function wm(){return bm}var _m=new hm(My.comparator);function Em(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=_m,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Tm=new hm(ly);function Sm(){return Tm}var Im=(Cm.prototype.applyToRemoteDocument=function(t,e,n){e&&Rd(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Rd(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Cm.prototype.applyToLocalView=function(t,e){e&&Rd(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Cm.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Cm.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Em())},Cm.prototype.isEqual=function(t){return this.batchId===t.batchId&&fy(this.mutations,t.mutations)&&fy(this.baseMutations,t.baseMutations)},Cm);function Cm(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Rd(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Nm=(Am.from=function(t,e,n,r){Rd(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=wm(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Am(t,e,n,r,i)},Am);function Am(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var km=(Dm.prototype.catch=function(t){return this.next(void 0,t)},Dm.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Dd("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Dm(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Dm.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Dm.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Dm?e:Dm.resolve(e)}catch(t){return Dm.reject(t)}},Dm.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Dm.resolve(e)},Dm.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Dm.reject(e)},Dm.resolve=function(n){return new Dm(function(t,e){t(n)})},Dm.reject=function(n){return new Dm(function(t,e){e(n)})},Dm.waitFor=function(t){return new Dm(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Dm.or=function(t){for(var n=Dm.resolve(!1),e=function(e){n=n.next(function(t){return t?Dm.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Dm.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Dm);function Dm(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Rm=(Om.forUser=function(t,e,n,r){return Rd(""!==t.uid,"UserID must not be an empty string."),new Om(t.isAuthenticated()?t.uid:"",e,n,r)},Om.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Lm(t).iterate({index:Qv.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Om.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Mm(n),Um(e).put(t)})},Om.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Om.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Mm(n),Um(e).put(t)})},Om.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=Fm(u),d=Lm(u);return d.add({}).next(function(t){Rd("number"==typeof t,"Auto-generated key is not a number");var e=new Im(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=Gv.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,Gv.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return km.waitFor(r).next(function(){return e})})},Om.prototype.lookupMutationBatch=function(t,e){var n=this;return Lm(t).get(e).next(function(t){return t?(Rd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Om.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?km.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},Om.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Lm(t).iterate({index:Qv.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Rd(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},Om.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Lm(t).loadAll(Qv.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Om.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=Gv.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Fm(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Jy(i);if(r===c.userId&&u.path.isEqual(a))return Lm(s).get(o).next(function(t){if(!t)throw Dd("Dangling document-mutation reference found: "+e+" which points to "+o);Rd(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},Om.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new hm(ly),i=[];return t.forEach(function(s){var t=Gv.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Fm(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Jy(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),km.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Om.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Rd(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=Gv.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new hm(ly);return Fm(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Jy(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},Om.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Lm(t).get(e).next(function(t){if(null===t)throw Dd("Dangling document-mutation reference found, which points to "+e);Rd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),km.waitFor(i).next(function(){return r})},Om.prototype.removeMutationBatch=function(e,n){var r=this;return xm(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),km.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},Om.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Om.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return km.resolve();var e=IDBKeyRange.lowerBound(Gv.prefixForUser(o.userId)),i=[];return Fm(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Jy(t[1]);i.push(r)}else n.done()}).next(function(){Rd(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Om.prototype.containsKey=function(t,e){return Pm(t,this.userId,e)},Om.prototype.getMutationQueueMetadata=function(t){var e=this;return Um(t).get(this.userId).next(function(t){return t||new Wv(e.userId,-1,"")})},Om);function Om(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Pm(t,o,e){var n=Gv.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Fm(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function xm(t,e,n){var r=t.store(Qv.store),i=t.store(Gv.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Rd(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Gv.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return km.waitFor(o).next(function(){return c})}function Mm(t){return t instanceof Uint8Array?(Rd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Lm(t){return Vg.getStore(t,Qv.store)}function Fm(t){return Vg.getStore(t,Gv.store)}function Um(t){return Vg.getStore(t,Wv.store)}var qm,Vm;(Vm=qm=qm||{})[Vm.QueryCache=0]="QueryCache",Vm[Vm.SyncEngine=1]="SyncEngine";var Bm=(jm.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},jm.prototype.after=function(t){return this.seek(t+2),this.next()},jm.prototype.seek=function(t){Rd((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},jm.forQueryCache=function(){return new jm(qm.QueryCache,2)},jm.forSyncEngine=function(){return new jm(qm.SyncEngine)},jm);function jm(t,e){Rd((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Wm="SimpleDb",Km=(Qm.openOrCreate=function(o,t,a){return Rd(Qm.isAvailable(),"IndexedDB not supported in current environment."),Nd(Wm,"Opening database:",o),new km(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Qm(e))},i.onblocked=function(){r(new Fd(Ld.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Fd(Ld.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Nd(Wm,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new zm(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,Fv).next(function(){Nd(Wm,"Database upgrade to version "+Fv+" complete")})}}).toPromise()},Qm.delete=function(t){return Nd(Wm,"Removing database:",t),$m(window.indexedDB.deleteDatabase(t)).toPromise()},Qm.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=_i(),e=Qm.getIOSVersion(t),n=0<e&&e<10,r=Qm.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Qm.getStore=function(t,e){return t.store(e)},Qm.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Qm.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Qm.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Qm.prototype.runTransaction=function(t,e,n){var r=zm.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),km.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Qm.prototype.close=function(){this.db.close()},Qm);function Qm(t){this.db=t,12.2===Qm.getIOSVersion(_i())&&Ad("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Hm=(Object.defineProperty(Gm.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Gm.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Gm.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Gm.prototype.done=function(){this.shouldStop=!0},Gm.prototype.skip=function(t){this.nextKey=t},Gm.prototype.delete=function(){return $m(this.dbCursor.delete())},Gm);function Gm(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var zm=(Ym.open=function(t,e,n){return new Ym(t.transaction(n,e))},Object.defineProperty(Ym.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Ym.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Nd(Wm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ym.prototype.store=function(t){var e=this.transaction.objectStore(t);return Rd(!!e,"Object store not part of transaction: "+t),new Xm(e)},Ym);function Ym(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new qy,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=tv(t.target.error);n.completionDeferred.reject(e)}}var Xm=(Jm.prototype.put=function(t,e){return $m(void 0!==e?(Nd(Wm,"PUT",this.store.name,t,e),this.store.put(e,t)):(Nd(Wm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Jm.prototype.add=function(t){return Nd(Wm,"ADD",this.store.name,t,t),$m(this.store.add(t))},Jm.prototype.get=function(e){var n=this;return $m(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Nd(Wm,"GET",n.store.name,e,t),t})},Jm.prototype.delete=function(t){return Nd(Wm,"DELETE",this.store.name,t),$m(this.store.delete(t))},Jm.prototype.count=function(){return Nd(Wm,"COUNT",this.store.name),$m(this.store.count())},Jm.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Jm.prototype.deleteAll=function(t,e){Nd(Wm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Jm.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Jm.prototype.iterateSerial=function(i){var t=this.cursor({});return new km(function(n,r){t.onerror=function(t){var e=tv(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Jm.prototype.iterateCursor=function(t,a){var s=[];return new km(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Hm(e),r=a(e.primaryKey,e.value,n);if(r instanceof km){var i=r.catch(function(t){return n.done(),km.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return km.waitFor(s)})},Jm.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Rd(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Jm.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Jm);function Jm(t){this.store=t}function $m(t){return new km(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=tv(t.target.error);r(e)}})}var Zm=!1;function tv(t){var e=Km.getIOSVersion(_i());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Fd("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Zm||(Zm=!0,setTimeout(function(){throw r},0)),r}}return t}var ev=(nv.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},nv.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return tm.fromTimestamp(new $y(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},nv.prototype.getHighestSequenceNumber=function(t){return ov(t.simpleDbTransaction)},nv.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},nv.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},nv.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},nv.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return rv(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Rd(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},nv.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return rv(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return km.waitFor(u)}).next(function(){return s})},nv.prototype.forEachTarget=function(t,r){var i=this;return rv(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},nv.prototype.retrieveMetadata=function(t){return iv(t.simpleDbTransaction)},nv.prototype.saveMetadata=function(t,e){return function(t){return Vg.getStore(t,og.store)}(t).put(og.key,e)},nv.prototype.saveQueryData=function(t,e){return rv(t).put(this.serializer.toDbTarget(e))},nv.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},nv.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},nv.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return rv(t).iterate({range:n,index:eg.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},nv.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=av(n);return t.forEach(function(t){var e=zy(t.path);o.push(a.put(new rg(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),km.waitFor(o)},nv.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=av(n);return km.forEach(t,function(t){var e=zy(t.path);return km.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},nv.prototype.removeMatchingKeysForTargetId=function(t,e){var n=av(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},nv.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=av(t),o=Em();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Jy(t[1]),i=new My(r);o=o.add(i)}).next(function(){return o})},nv.prototype.containsKey=function(t,e){var n=zy(e.path),r=IDBKeyRange.bound([n],[py(n)],!1,!0),i=0;return av(t).iterate({index:rg.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},nv.prototype.getQueryDataForTarget=function(t,e){var n=this;return rv(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},nv);function nv(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Bm.forQueryCache()}function rv(t){return Vg.getStore(t,eg.store)}function iv(t){return Km.getStore(t,og.store).get(og.key).next(function(t){return Rd(null!==t,"Missing metadata row."),t})}function ov(t){return iv(t).next(function(t){return t.highestListenSequenceNumber})}function av(t){return Vg.getStore(t,rg.store)}var sv=(uv.compareByKey=function(t,e){return My.comparator(t.key,e.key)},uv);function uv(t,e){this.key=t,this.version=e}var cv,hv=(ii(lv,cv=sv),lv.prototype.field=function(t){return this.data.field(t)},lv.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},lv.prototype.value=function(){return this.data.value()},lv.prototype.isEqual=function(t){return t instanceof lv&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},lv.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(lv.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),lv.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Dd("Trying to compare documents on fields that don't exist")},lv);function lv(t,e,n,r,i){var o=cv.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}var fv,pv=(ii(dv,fv=sv),dv.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(dv.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),dv.prototype.isEqual=function(t){return t instanceof dv&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},dv);function dv(t,e,n){var r=fv.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var yv,mv=(ii(vv,yv=sv),vv.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(vv.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),vv.prototype.isEqual=function(t){return t instanceof vv&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},vv);function vv(){return null!==yv&&yv.apply(this,arguments)||this}var gv=(bv.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},bv.prototype.has=function(t){return void 0!==this.get(t)},bv.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},bv.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},bv.prototype.forEach=function(s){Wd(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},bv.prototype.isEmpty=function(){return Kd(this.inner)},bv);function bv(t){this.mapKeyFn=t,this.inner={}}var wv=(_v.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},_v.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?km.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},_v.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},_v.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},_v.prototype.assertChanges=function(){return Rd(null!==this.changes,"Changes have already been applied."),this.changes},_v);function _v(){this.changes=ym(),this.documentSizes=new gv(function(t){return t.toString()})}var Ev="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Tv=(Object.defineProperty(Sv.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),Sv.prototype.start=function(t){var e=Km.getStore(t,hg.store);return this.synchronizeLastDocumentChangeId(e)},Sv.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=kv(t),o=Em(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Rv(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Dv(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return km.waitFor(r)},Sv.prototype.removeEntry=function(t,e){var n=kv(t),r=Rv(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Ov(t)}):km.resolve(0)})},Sv.prototype.getEntry=function(t,e){var n=this;return kv(t).get(Rv(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},Sv.prototype.getSizedEntry=function(t,e){var n=this;return kv(t).get(Rv(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Ov(t)}:null})},Sv.prototype.getEntries=function(t,e){var n=this,r=mm();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},Sv.prototype.getSizedEntries=function(t,e){var n=this,r=mm(),i=new nm(My.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Ov(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},Sv.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return km.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return kv(t).iterate({range:n},function(t,e,n){for(var r=My.fromSegments(t);a&&My.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Sv.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;Rd(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=gm(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return kv(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof hv&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Sv.prototype.getNewDocumentChanges=function(e){var r=this;Rd(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Em(),i=ym(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Dv(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return km.reject(new Fd(Ld.DATA_LOSS,Ev))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new pv(n,tm.forDeletedDoc());i=i.insert(n,e)}))}),km.waitFor(t)}).next(function(){return i})},Sv.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Dv(t).delete(n)},Sv.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},Sv.prototype.newChangeBuffer=function(){return new Nv(this)},Sv.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Sv.prototype.getMetadata=function(t){return Iv(t).get(Zv.key).next(function(t){return Rd(!!t,"Missing document cache metadata"),t})},Sv.prototype.setMetadata=function(t,e){return Iv(t).put(Zv.key,e)},Sv.prototype.updateSize=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},Sv);function Sv(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function Iv(t){return Vg.getStore(t,Zv.store)}var Cv,Nv=(ii(Av,Cv=wv),Av.prototype.applyChanges=function(t){var o=this,e=this.assertChanges(),a=0,s=[];return e.forEach(function(t,e){var n=o.documentCache.serializer.toDbRemoteDocument(e),r=o.documentSizes.get(t);Rd(void 0!==r,"Attempting to change document "+t.toString()+" without having read it first");var i=Ov(n);a+=i-r,s.push({key:t,doc:n})}),this.documentCache.addEntries(t,s,a)},Av.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Av.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Av);function Av(t){var e=Cv.call(this)||this;return e.documentCache=t,e}function kv(t){return Vg.getStore(t,Jv.store)}function Dv(t){return Vg.getStore(t,hg.store)}function Rv(t){return t.path.toArray()}function Ov(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Dd("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Pv=(xv.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),km.resolve()},xv.prototype.getCollectionParents=function(t,e){return km.resolve(this.collectionParentIndex.getEntries(e))},xv);function xv(){this.collectionParentIndex=new Mv}var Mv=(Lv.prototype.add=function(t){Rd(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new hm(ky.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},Lv.prototype.getEntries=function(t){return(this.index[t]||new hm(ky.comparator)).toArray()},Lv);function Lv(){this.index={}}var Fv=8,Uv=(qv.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Rd(n<r&&0<=n&&r<=Fv,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(Bv.store)}(t),function(t){t.createObjectStore(Wv.store,{keyPath:Wv.keyPath}),t.createObjectStore(Qv.store,{keyPath:Qv.keyPath,autoIncrement:!0}).createIndex(Qv.userMutationsIndex,Qv.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Gv.store)}(t),cg(t),function(t){t.createObjectStore(Jv.store)}(t));var o=km.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(rg.store),t.deleteObjectStore(eg.store),t.deleteObjectStore(og.store)}(t),cg(t)),o=o.next(function(){return function(t){var e=t.store(og.store),n=new og(0,0,tm.MIN.toTimestamp(),0);return e.put(og.key,n)}(e)})),n<4&&4<=r&&(0!==n&&(o=o.next(function(){return function(r,i){return i.store(Qv.store).loadAll().next(function(t){r.deleteObjectStore(Qv.store),r.createObjectStore(Qv.store,{keyPath:Qv.keyPath,autoIncrement:!0}).createIndex(Qv.userMutationsIndex,Qv.userMutationsKeyPath,{unique:!0});var e=i.store(Qv.store),n=t.map(function(t){return e.put(t)});return km.waitFor(n)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(fg.store,{keyPath:fg.keyPath})}(t),function(t){t.createObjectStore(hg.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&5<=r&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(o=o.next(function(){return function(t){t.createObjectStore(Zv.store)}(t),i.addDocumentGlobal(e)})),n<7&&7<=r&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&8<=r&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},qv.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Jv.store).iterate(function(t,e){n+=Ov(e)}).next(function(){var t=new Zv(n);return e.store(Zv.store).put(Zv.key,t)})},qv.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Wv.store),e=r.store(Qv.store);return t.loadAll().next(function(t){return km.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(Qv.userMutationsIndex,t).next(function(t){return km.forEach(t,function(t){Rd(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return xm(r,n.userId,e).next(function(){})})})})})},qv.prototype.ensureSequenceNumbers=function(t){var a=t.store(rg.store),e=t.store(Jv.store);return ov(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new ky(t),r=function(t){return[0,zy(t)]}(n);o.push(a.get(r).next(function(t){return t?km.resolve():function(t){return a.put(new rg(0,zy(t),i))}(n)}))}).next(function(){return km.waitFor(o)})})},qv.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:zy(n)})}}t.createObjectStore(sg.store,{keyPath:sg.keyPath});var r=e.store(sg.store),o=new Mv;return e.store(Jv.store).iterate({keysOnly:!0},function(t,e){var n=new ky(t);return i(n.popLast())}).next(function(){return e.store(Gv.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Jy(n));return i(r.popLast())})})},qv);function qv(t){this.serializer=t}var Vv=function(t,e){this.seconds=t,this.nanoseconds=e},Bv=(jv.store="owner",jv.key="owner",jv);function jv(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Wv=(Kv.store="mutationQueues",Kv.keyPath="userId",Kv);function Kv(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Qv=(Hv.store="mutations",Hv.keyPath="batchId",Hv.userMutationsIndex="userMutationsIndex",Hv.userMutationsKeyPath=["userId","batchId"],Hv);function Hv(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Gv=(zv.prefixForUser=function(t){return[t]},zv.prefixForPath=function(t,e){return[t,zy(e)]},zv.key=function(t,e,n){return[t,zy(e),n]},zv.store="documentMutations",zv.PLACEHOLDER=new zv,zv);function zv(){}var Yv=function(t,e){this.path=t,this.readTime=e},Xv=function(t,e){this.path=t,this.version=e},Jv=($v.store="remoteDocuments",$v);function $v(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var Zv=(tg.store="remoteDocumentGlobal",tg.key="remoteDocumentGlobalKey",tg);function tg(t){this.byteSize=t}var eg=(ng.store="targets",ng.keyPath="targetId",ng.queryTargetsIndexName="queryTargetsIndex",ng.queryTargetsKeyPath=["canonicalId","targetId"],ng);function ng(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var rg=(ig.store="targetDocuments",ig.keyPath=["targetId","path"],ig.documentTargetsIndex="documentTargetsIndex",ig.documentTargetsKeyPath=["path","targetId"],ig);function ig(t,e,n){this.targetId=t,this.path=e,Rd(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var og=(ag.key="targetGlobalKey",ag.store="targetGlobal",ag);function ag(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var sg=(ug.store="collectionParents",ug.keyPath=["collectionId","parent"],ug);function ug(t,e){this.collectionId=t,this.parent=e}function cg(t){t.createObjectStore(rg.store,{keyPath:rg.keyPath}).createIndex(rg.documentTargetsIndex,rg.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(eg.store,{keyPath:eg.keyPath}).createIndex(eg.queryTargetsIndexName,eg.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(og.store)}var hg=(lg.store="remoteDocumentChanges",lg.keyPath="id",lg);function lg(t){this.changes=t}var fg=(pg.store="clientMetadata",pg.keyPath="clientId",pg);function pg(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var dg,yg,mg=[Wv.store,Qv.store,Gv.store,Jv.store,eg.store,Bv.store,og.store,rg.store].concat([fg.store,hg.store]).concat([Zv.store]).concat([sg.store]),vg=(gg.prototype.addToCollectionParentIndex=function(t,e){if(Rd(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Rd(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return bg(t).put({collectionId:n,parent:zy(r)})}return km.resolve()},gg.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[py(i),""],!1,!0);return bg(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Jy(r.parent))}return o})},gg);function gg(){this.collectionParentsCache=new Mv}function bg(t){return Vg.getStore(t,sg.store)}(yg=dg=dg||{})[yg.Listen=0]="Listen",yg[yg.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",yg[yg.LimboResolution=2]="LimboResolution";var wg=(_g.prototype.copy=function(t){return new _g(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},_g.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},_g);function _g(t,e,n,r,i,o){void 0===i&&(i=tm.MIN),void 0===o&&(o=xd()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var Eg=(Tg.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=My.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new pv(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=My.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new mv(e,n)):Dd("Unexpected DbRemoteDocument")},Tg.prototype.toDbRemoteDocument=function(t){if(t instanceof hv){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Jv(null,null,e,n)}if(t instanceof pv){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Jv(null,new Yv(r,i),null,n)}return t instanceof mv?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Jv(new Xv(r,i),null,null,!0)):Dd("Unexpected MaybeDocumment")},Tg.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Vv(e.seconds,e.nanoseconds)},Tg.prototype.fromDbTimestamp=function(t){var e=new $y(t.seconds,t.nanoseconds);return tm.fromTimestamp(e)},Tg.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Qv(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Tg.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=$y.fromMillis(t.localWriteTimeMs);return new Im(t.batchId,i,n,r)},Tg.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(zy(t.path))}),e},Tg.prototype.fromDbResourcePaths=function(t){for(var e=Em(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new My(Jy(i)))}return e},Tg.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new wg(e,t.targetId,dg.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},Tg.prototype.toDbTarget=function(t){Rd(dg.Listen===t.purpose,"Only queries with purpose "+dg.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Rd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new eg(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},Tg);function Tg(t){this.remoteSerializer=t}function Sg(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=ly(n,i);return 0===a?ly(r,o):a}var Ig=(Cg.prototype.nextIndex=function(){return++this.previousIndex},Cg.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Sg(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Cg.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Cg);function Cg(t){this.maxElements=t,this.buffer=new hm(Sg),this.previousIndex=0}var Ng={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ag=(kg.withCacheSize=function(t){return new kg(t,kg.DEFAULT_COLLECTION_PERCENTILE,kg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},kg.COLLECTION_DISABLED=-1,kg.MINIMUM_CACHE_SIZE_BYTES=1048576,kg.DEFAULT=new kg(kg.DEFAULT_CACHE_SIZE_BYTES=41943040,kg.DEFAULT_COLLECTION_PERCENTILE=10,kg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),kg.DISABLED=new kg(kg.COLLECTION_DISABLED,0,0),kg);function kg(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var Dg=(Rg.prototype.start=function(){Rd(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ag.COLLECTION_DISABLED&&this.scheduleGC()},Rg.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Rg.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Rg.prototype.scheduleGC=function(){var t=this;Rd(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Nd("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Fy.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(jg)})},Rg);function Rg(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var Og=(Pg.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},Pg.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return km.resolve(Ty.INVALID);var r=new Ig(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},Pg.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},Pg.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},Pg.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===Ag.COLLECTION_DISABLED?(Nd("LruGarbageCollector","Garbage collection skipped; disabled"),km.resolve(Ng)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Nd("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Ng):r.runGarbageCollection(e,n)})},Pg.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},Pg.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Nd("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Id()<=yd.DEBUG&&Nd("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),km.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},Pg);function Pg(t,e){this.delegate=t,this.params=e}var xg,Mg="IndexedDbPersistence",Lg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fg="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ug=(ii(qg,xg=function(){}),qg);function qg(t,e){var n=xg.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var Vg=(Bg.getStore=function(t,e){if(t instanceof Ug)return Km.getStore(t.simpleDbTransaction,e);throw Dd("IndexedDbPersistence must use instances of IndexedDbTransaction")},Bg.createIndexedDbPersistence=function(n,r,i,o,a,s){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new Bg(n,r,i,o,a,s)).start()];case 1:return t.sent(),[2,e]}})})},Bg.createMultiClientIndexedDbPersistence=function(n,r,i,o,a,s,u){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new Bg(n,r,i,o,a,s,u)).start()];case 1:return t.sent(),[2,e]}})})},Bg.prototype.start=function(){var n=this;return Rd(!this.started,"IndexedDbPersistence double-started!"),Rd(null!==this.window,"Expected 'window' to be defined"),Km.openOrCreate(this.dbName,Fv,new Uv(this.serializer)).then(function(t){return n.simpleDb=t,n.updateClientMetadataAndTryBecomePrimary()}).then(function(){return n.attachVisibilityHandler(),n.attachWindowUnloadHook(),n.scheduleClientMetadataAndPrimaryLeaseRefreshes(),n.startRemoteDocumentCache()}).then(function(){return n.simpleDb.runTransaction("readonly",[og.store],function(t){return ov(t).next(function(t){var e=n.multiClientParams?n.multiClientParams.sequenceNumberSyncer:void 0;n.listenSequence=new Ty(t,e)})})}).then(function(){n._started=!0}).catch(function(t){return n.simpleDb&&n.simpleDb.close(),Promise.reject(t)})},Bg.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",mg,function(t){return e.remoteDocumentCache.start(t)})},Bg.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Bg.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Bg.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Bg.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",mg,function(n){return Kg(n).put(new fg(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},Bg.prototype.verifyPrimaryLease=function(t){var e=this;return Wg(t).get(Bv.key).next(function(t){return km.resolve(e.isLocalClient(t))})},Bg.prototype.removeClientMetadata=function(t){return Kg(t).delete(this.clientId)},Bg.prototype.maybeGarbageCollectMultiClientState=function(){return ai(this,void 0,void 0,function(){var r,i,o=this;return si(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=Bg.getStore(n,fg.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return km.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,t);return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},Bg.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Fy.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Bg.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Bg.prototype.canActAsPrimary=function(e){var i=this;return Wg(e).get(Bv.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Fd(Ld.FAILED_PRECONDITION,Fg);return!1}}return!(!i.networkEnabled||!i.inForeground)||Kg(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Nd(Mg,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Bg.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Bv.store,fg.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Bg.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Bg.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[fg.store],function(t){return Kg(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},Bg.clearPersistence=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return Bg.isAvailable()?(e=n+Bg.MAIN_DATABASE,[4,Km.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Bg.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Bg.prototype.getMutationQueue=function(t){return Rd(this.started,"Cannot initialize MutationQueue before persistence is started."),Rm.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Bg.prototype.getQueryCache=function(){return Rd(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},Bg.prototype.getRemoteDocumentCache=function(){return Rd(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Bg.prototype.getIndexManager=function(){return Rd(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Bg.prototype.runTransaction=function(n,t,r){var i=this;return Nd(Mg,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",mg,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Ad("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Fd(Ld.FAILED_PRECONDITION,Lg);return r(new Ug(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new Ug(e,i.listenSequence.next()))})})},Bg.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Wg(t).get(Bv.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Fd(Ld.FAILED_PRECONDITION,Fg)})},Bg.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Bv(this.clientId,this.allowTabSynchronization,Date.now());return Wg(t).put(Bv.key,e)},Bg.isAvailable=function(){return Km.isAvailable()},Bg.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Bg.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Wg(t);return n.get(Bv.key).next(function(t){return e.isLocalClient(t)?(Nd(Mg,"Releasing primary lease."),n.delete(Bv.key)):km.resolve()})},Bg.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Ad("Detected an update time that is in the future: "+t+" > "+n),1))},Bg.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Bg.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Rd(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Bg.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Bg.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Rd("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Bg.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Nd(Mg,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Ad(Mg,"Failed to get zombied client id.",t),!1}},Bg.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Ad("Failed to set zombie client id.",t)}},Bg.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Bg.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Bg.MAIN_DATABASE="main",Bg);function Bg(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!Bg.isAvailable())throw new Fd(Ld.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new Yg(this,o),this.dbName=t+Bg.MAIN_DATABASE,this.serializer=new Eg(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new ev(this.referenceDelegate,this.serializer),this.indexManager=new vg,this.remoteDocumentCache=new Tv(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new Fd(Ld.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}function jg(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!function(t){return t.code===Ld.FAILED_PRECONDITION&&t.message===Lg}(e))throw e;return Nd(Mg,"Unexpectedly lost primary lease"),[2]})})}function Wg(t){return t.store(Bv.store)}function Kg(t){return t.store(fg.store)}var Qg,Hg,Gg,zg,Yg=(Xg.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},Xg.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Xg.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Xg.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},Xg.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Xg.prototype.addReference=function(t,e){return Jg(t,e)},Xg.prototype.removeReference=function(t,e){return Jg(t,e)},Xg.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Xg.prototype.removeMutationReference=function(t,e){return Jg(t,e)},Xg.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?km.resolve(!0):function(e,n){var r=!1;return Um(e).iterateSerial(function(t){return Pm(e,t,n).next(function(t){return t&&(r=!0),km.resolve(!t)})}).next(function(){return r})}(t,e)},Xg.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=0,s=0,u=[];return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return a++,o.removeOrphanedDocument(r,e).next(function(t){s+=t})});u.push(n)}}).next(function(){return km.waitFor(u)}).next(function(){return o.db.getRemoteDocumentCache().updateSize(r,-s)}).next(function(){return a})},Xg.prototype.removeOrphanedDocument=function(t,e){var n=0,r=this.db.getRemoteDocumentCache();return km.waitFor([av(t).delete(function(t){return[0,zy(t.path)]}(e)),r.removeEntry(t,e).next(function(t){n+=t})]).next(function(){return n})},Xg.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},Xg.prototype.updateLimboDocument=function(t,e){return Jg(t,e)},Xg.prototype.forEachOrphanedDocument=function(t,o){var a,e=av(t),s=Ty.INVALID;return e.iterate({index:rg.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Ty.INVALID&&o(new My(Jy(a)),s),s=i,a=r):s=Ty.INVALID}).next(function(){s!==Ty.INVALID&&o(new My(Jy(a)),s)})},Xg.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Xg);function Xg(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Og(this,e)}function Jg(t,e){return av(t).put(function(t,e){return new rg(0,zy(t.path),e)}(e,t.currentSequenceNumber))}(Hg=Qg=Qg||{})[Hg.NullValue=0]="NullValue",Hg[Hg.BooleanValue=1]="BooleanValue",Hg[Hg.NumberValue=2]="NumberValue",Hg[Hg.TimestampValue=3]="TimestampValue",Hg[Hg.StringValue=4]="StringValue",Hg[Hg.BlobValue=5]="BlobValue",Hg[Hg.RefValue=6]="RefValue",Hg[Hg.GeoPointValue=7]="GeoPointValue",Hg[Hg.ArrayValue=8]="ArrayValue",Hg[Hg.ObjectValue=9]="ObjectValue",(zg=Gg=Gg||{})[zg.Default=0]="Default",zg[zg.Estimate=1]="Estimate",zg[zg.Previous=2]="Previous";var $g=(Zg.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Zg(Gg.Estimate,e);case"previous":return new Zg(Gg.Previous,e);case"none":case void 0:return new Zg(Gg.Default,e);default:return Dd("fromSnapshotOptions() called with invalid options.")}},Zg);function Zg(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var tb=(eb.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},eb.prototype.defaultCompareTo=function(t){return Rd(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),ly(this.typeOrder,t.typeOrder)},eb);function eb(){}var nb,rb=(ii(ib,nb=tb),ib.prototype.value=function(t){return null},ib.prototype.isEqual=function(t){return t instanceof ib},ib.prototype.compareTo=function(t){return t instanceof ib?0:this.defaultCompareTo(t)},ib.INSTANCE=new ib,ib);function ib(){var t=nb.call(this)||this;return t.typeOrder=Qg.NullValue,t.internalValue=null,t}var ob,ab=(ii(sb,ob=tb),sb.prototype.value=function(t){return this.internalValue},sb.prototype.isEqual=function(t){return t instanceof sb&&this.internalValue===t.internalValue},sb.prototype.compareTo=function(t){return t instanceof sb?ly(this,t):this.defaultCompareTo(t)},sb.of=function(t){return t?sb.TRUE:sb.FALSE},sb.TRUE=new sb(!0),sb.FALSE=new sb(!1),sb);function sb(t){var e=ob.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.BooleanValue,e}var ub,cb=(ii(hb,ub=tb),hb.prototype.value=function(t){return this.internalValue},hb.prototype.compareTo=function(t){return t instanceof hb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},hb);function hb(t){var e=ub.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.NumberValue,e}function lb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var fb,pb=(ii(db,fb=cb),db.prototype.isEqual=function(t){return t instanceof db&&lb(this.internalValue,t.internalValue)},db);function db(){return null!==fb&&fb.apply(this,arguments)||this}var yb,mb=(ii(vb,yb=cb),vb.prototype.isEqual=function(t){return t instanceof vb&&lb(this.internalValue,t.internalValue)},vb.NAN=new vb(NaN),vb.POSITIVE_INFINITY=new vb(1/0),vb.NEGATIVE_INFINITY=new vb(-1/0),vb);function vb(){return null!==yb&&yb.apply(this,arguments)||this}var gb,bb=(ii(wb,gb=tb),wb.prototype.value=function(t){return this.internalValue},wb.prototype.isEqual=function(t){return t instanceof wb&&this.internalValue===t.internalValue},wb.prototype.compareTo=function(t){return t instanceof wb?ly(this.internalValue,t.internalValue):this.defaultCompareTo(t)},wb);function wb(t){var e=gb.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.StringValue,e}var _b,Eb=(ii(Tb,_b=tb),Tb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Tb.prototype.isEqual=function(t){return t instanceof Tb&&this.internalValue.isEqual(t.internalValue)},Tb.prototype.compareTo=function(t){return t instanceof Tb?this.internalValue._compareTo(t.internalValue):t instanceof Ib?-1:this.defaultCompareTo(t)},Tb);function Tb(t){var e=_b.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.TimestampValue,e}var Sb,Ib=(ii(Cb,Sb=tb),Cb.prototype.value=function(t){return t&&t.serverTimestampBehavior===Gg.Estimate?new Eb(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Gg.Previous&&this.previousValue?this.previousValue.value(t):null},Cb.prototype.isEqual=function(t){return t instanceof Cb&&this.localWriteTime.isEqual(t.localWriteTime)},Cb.prototype.compareTo=function(t){return t instanceof Cb?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Eb?1:this.defaultCompareTo(t)},Cb.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Cb);function Cb(t,e){var n=Sb.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Qg.TimestampValue,n}var Nb,Ab=(ii(kb,Nb=tb),kb.prototype.value=function(t){return this.internalValue},kb.prototype.isEqual=function(t){return t instanceof kb&&this.internalValue.isEqual(t.internalValue)},kb.prototype.compareTo=function(t){return t instanceof kb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},kb);function kb(t){var e=Nb.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.BlobValue,e}var Db,Rb=(ii(Ob,Db=tb),Ob.prototype.value=function(t){return this.key},Ob.prototype.isEqual=function(t){return t instanceof Ob&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Ob.prototype.compareTo=function(t){if(t instanceof Ob){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:My.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Ob);function Ob(t,e){var n=Db.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Qg.RefValue,n}var Pb,xb=(ii(Mb,Pb=tb),Mb.prototype.value=function(t){return this.internalValue},Mb.prototype.isEqual=function(t){return t instanceof Mb&&this.internalValue.isEqual(t.internalValue)},Mb.prototype.compareTo=function(t){return t instanceof Mb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Mb);function Mb(t){var e=Pb.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.GeoPointValue,e}var Lb,Fb=(ii(Ub,Lb=tb),Ub.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},Ub.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Ub.prototype.isEqual=function(t){if(t instanceof Ub){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Ub.prototype.compareTo=function(t){if(t instanceof Ub){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=ly(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return ly(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Ub.prototype.set=function(t,e){if(Rd(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Ub||(n=Ub.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Ub.prototype.delete=function(t){if(Rd(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ub(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Ub){var n=e.delete(t.popFirst());return new Ub(this.internalValue.insert(t.firstSegment(),n))}return this},Ub.prototype.contains=function(t){return null!==this.field(t)},Ub.prototype.field=function(t){Rd(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ub?e.internalValue.get(t):null}),e},Ub.prototype.fieldMask=function(){var i=new hm(Py.comparator);return this.internalValue.forEach(function(t,e){var n=new Py([t]);if(e instanceof Ub){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),jb.fromSet(i)},Ub.prototype.toString=function(){return this.internalValue.toString()},Ub.prototype.child=function(t){return this.internalValue.get(t)||void 0},Ub.prototype.setChild=function(t,e){return new Ub(this.internalValue.insert(t,e))},Ub.EMPTY=new Ub(new nm(ly)),Ub);function Ub(t){var e=Lb.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.ObjectValue,e}var qb,Vb=(ii(Bb,qb=tb),Bb.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},Bb.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Bb.prototype.forEach=function(t){this.internalValue.forEach(t)},Bb.prototype.isEqual=function(t){if(t instanceof Bb){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Bb.prototype.compareTo=function(t){if(t instanceof Bb){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return ly(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Bb.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Bb);function Bb(t){var e=qb.call(this)||this;return e.internalValue=t,e.typeOrder=Qg.ArrayValue,e}var jb=(Wb.fromSet=function(t){return new Wb(t)},Wb.fromArray=function(t){var e=new hm(Py.comparator);return t.forEach(function(t){return e=e.add(t)}),new Wb(e)},Wb.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},Wb.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Wb);function Wb(t){this.fields=t}var Kb=(Qb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Qb);function Qb(t,e){this.field=t,this.transform=e}var Hb,Gb,zb=function(t,e){this.version=t,this.transformResults=e};(Gb=Hb=Hb||{})[Gb.Set=0]="Set",Gb[Gb.Patch=1]="Patch",Gb[Gb.Transform=2]="Transform",Gb[Gb.Delete=3]="Delete";var Yb=(Xb.exists=function(t){return new Xb(void 0,t)},Xb.updateTime=function(t){return new Xb(t)},Object.defineProperty(Xb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Xb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof hv&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof hv:(Rd(this.isNone,"Precondition should be empty"),!0)},Xb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Xb.NONE=new Xb,Xb);function Xb(t,e){this.updateTime=t,this.exists=e,Rd(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Jb=($b.prototype.verifyKeyMatches=function(t){null!=t&&Rd(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},$b.getPostMutationVersion=function(t){return t instanceof hv?t.version:tm.MIN},$b);function $b(){}var Zb,tw=(ii(ew,Zb=Jb),ew.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new hv(this.key,n,this.value,{hasCommittedMutations:!0})},ew.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Jb.getPostMutationVersion(t);return new hv(this.key,r,this.value,{hasLocalMutations:!0})},ew.prototype.extractBaseValue=function(t){return null},ew.prototype.isEqual=function(t){return t instanceof ew&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},ew);function ew(t,e,n){var r=Zb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Hb.Set,r}var nw,rw=(ii(iw,nw=Jb),iw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new mv(this.key,e.version);var n=this.patchDocument(t);return new hv(this.key,e.version,n,{hasCommittedMutations:!0})},iw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Jb.getPostMutationVersion(t),i=this.patchDocument(t);return new hv(this.key,r,i,{hasLocalMutations:!0})},iw.prototype.extractBaseValue=function(t){return null},iw.prototype.isEqual=function(t){return t instanceof iw&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},iw.prototype.patchDocument=function(t){var e;return e=t instanceof hv?t.data:Fb.EMPTY,this.patchObject(e)},iw.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},iw);function iw(t,e,n,r){var i=nw.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Hb.Patch,i}var ow,aw=(ii(sw,ow=Jb),sw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Rd(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new mv(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new hv(this.key,i,o,{hasCommittedMutations:!0})},sw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new hv(this.key,r.version,o,{hasLocalMutations:!0})},sw.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof hv?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Fb.EMPTY.set(i.field,a):e.set(i.field,a))}return e},sw.prototype.isEqual=function(t){return t instanceof sw&&this.key.isEqual(t.key)&&fy(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},sw.prototype.requireDocument=function(t){Rd(t instanceof hv,"Unknown MaybeDocument type "+t);var e=t;return Rd(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},sw.prototype.serverTransformResults=function(t,e){var n=[];Rd(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof hv&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},sw.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof hv&&(u=e.field(a.field)),null===u&&n instanceof hv&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},sw.prototype.transformObject=function(t,e){Rd(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},sw);function sw(t,e){var n=ow.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Hb.Transform,n.precondition=Yb.exists(!0),n}var uw,cw=(ii(hw,uw=Jb),hw.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by DeleteMutation."),new pv(this.key,e.version,{hasCommittedMutations:!0})},hw.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Rd(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new pv(this.key,tm.forDeletedDoc())):t},hw.prototype.extractBaseValue=function(t){return null},hw.prototype.isEqual=function(t){return t instanceof hw&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},hw);function hw(t,e){var n=uw.call(this)||this;return n.key=t,n.precondition=e,n.type=Hb.Delete,n}var lw=(fw.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},fw.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},fw.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=mm();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},fw.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},fw.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=ym();return e.forEach(function(t,e){e=e||new pv(t,tm.forDeletedDoc()),n=n.insert(t,e)}),n})},fw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},fw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new My(e)).next(function(t){var e=gm();return t instanceof hv&&(e=e.insert(t.key,t)),e})},fw.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;Rd(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=gm();return this.indexManager.getCollectionParents(n,o).next(function(t){return km.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},fw.prototype.getDocumentsMatchingCollectionQuery=function(e,n){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof hv?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},fw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Em(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof rw&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof hv&&(c=c.insert(t,e))}),c})},fw);function fw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var pw=(dw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},dw.prototype.addReference=function(t,e){var n=new yw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},dw.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},dw.prototype.removeReference=function(t,e){this.removeRef(new yw(t,e))},dw.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},dw.prototype.removeReferencesForId=function(t){var e=this,n=My.EMPTY,r=new yw(n,t),i=new yw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},dw.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},dw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},dw.prototype.referencesForId=function(t){var e=My.EMPTY,n=new yw(e,t),r=new yw(e,t+1),i=Em();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},dw.prototype.containsKey=function(t){var e=new yw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},dw);function dw(){this.refsByKey=new hm(yw.compareByKey),this.refsByTarget=new hm(yw.compareByTargetId)}var yw=(mw.compareByKey=function(t,e){return My.comparator(t.key,e.key)||ly(t.targetOrBatchId,e.targetOrBatchId)},mw.compareByTargetId=function(t,e){return ly(t.targetOrBatchId,e.targetOrBatchId)||My.comparator(t.key,e.key)},mw);function mw(t,e){this.key=t,this.targetOrBatchId=e}var vw=(gw.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new lw(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Em(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},gw.prototype.localWrite=function(s){var u=this,c=$y.now(),t=s.reduce(function(t,e){return t.add(e.key)},Em());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return u.localDocuments.getDocuments(a,t).next(function(n){for(var t=[],e=0,r=s;e<r.length;e++){var i=r[e],o=i.extractBaseValue(n.get(i.key));null!=o&&t.push(new rw(i.key,o,o.fieldMask(),Yb.exists(!0)))}return u.mutationQueue.addMutationBatch(a,c,t,s).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},gw.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):km.resolve(null)})})},gw.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},gw.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Rd(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},gw.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},gw.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},gw.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},gw.prototype.applyRemoteEvent=function(u){var c=this,h=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[],s=Em();jd(u.targetChanges,function(t,e){var n=c.queryDataByTarget[t];if(n){e.addedDocuments.forEach(function(t){s=s.add(t)}),e.modifiedDocuments.forEach(function(t){s=s.add(t)}),a.push(c.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n;n=n.copy({resumeToken:r,snapshotVersion:u.snapshotVersion}),c.queryDataByTarget[t]=n,gw.shouldPersistQueryData(i,n,e)&&a.push(c.queryCache.updateQueryData(o,n))}}});var i=ym(),n=Em();u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(h.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||e.version.isEqual(tm.MIN)||s.has(e.key)&&!n.hasPendingWrites||0<=e.version.compareTo(n.version)?(h.addEntry(e),i=i.insert(t,e)):Nd("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})}));var e=u.snapshotVersion;if(!e.isEqual(tm.MIN)){var t=c.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Rd(0<=e.compareTo(t),"Watch stream reverted to previous snapshot?? "+e+" < "+t),c.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,e)});a.push(t)}return km.waitFor(a).next(function(){return h.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,i)})})},gw.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size)},gw.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return km.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),km.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},gw.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},gw.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},gw.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,km.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new wg(r,t,dg.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Rd(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},gw.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){Rd(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?km.resolve():km.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},gw.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},gw.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},gw.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},gw.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},gw.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},gw.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=km.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Rd(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):Rd(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},gw.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},gw.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},gw.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},gw.RESUME_TOKEN_MAX_AGE_MICROS=3e8,gw);function gw(t,e){this.persistence=t,this.localViewReferences=new pw,this.queryDataByTarget={},Rd(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new lw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var bw=(ww.prototype.checkEmpty=function(t){return km.resolve(0===this.mutationQueue.length)},ww.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Rd(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Rd(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,km.resolve()},ww.prototype.getLastStreamToken=function(t){return km.resolve(this.lastStreamToken)},ww.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,km.resolve()},ww.prototype.addMutationBatch=function(t,e,n,r){Rd(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Rd(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Im(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new yw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return km.resolve(o)},ww.prototype.lookupMutationBatch=function(t,e){return km.resolve(this.findMutationBatch(e))},ww.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Rd(null!=n,"Failed to find local mutation batch."),km.resolve(n.keys())},ww.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return km.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},ww.prototype.getAllMutationBatches=function(t){return km.resolve(this.mutationQueue.slice())},ww.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new yw(n,0),i=new yw(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Rd(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Rd(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),km.resolve(o)},ww.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new hm(ly);return e.forEach(function(e){var t=new yw(e,0),n=new yw(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Rd(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),km.resolve(this.findMutationBatches(i))},ww.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;My.isDocumentKey(i)||(i=i.child(""));var o=new yw(new My(i),0),a=new hm(ly);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),km.resolve(this.findMutationBatches(a))},ww.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},ww.prototype.removeMutationBatch=function(n,r){var i=this;Rd(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return km.forEach(r.mutations,function(t){var e=new yw(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},ww.prototype.removeCachedMutationKeys=function(t){},ww.prototype.containsKey=function(t,e){var n=new yw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return km.resolve(e.isEqual(r&&r.key))},ww.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Rd(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),km.resolve()},ww.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Rd(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},ww.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},ww.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Rd(n.batchId===t,"If found batch must match"),n},ww);function ww(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=xd(),this.batchesByDocumentKey=new hm(yw.compareByKey)}var _w=(Ew.prototype.getTargetCount=function(t){return km.resolve(this.targetCount)},Ew.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),km.resolve()},Ew.prototype.getLastRemoteSnapshotVersion=function(t){return km.resolve(this.lastRemoteSnapshotVersion)},Ew.prototype.getHighestSequenceNumber=function(t){return km.resolve(this.highestSequenceNumber)},Ew.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,km.resolve(e)},Ew.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),km.resolve()},Ew.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Ew.prototype.addQueryData=function(t,e){return Rd(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,km.resolve()},Ew.prototype.updateQueryData=function(t,e){return Rd(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),km.resolve()},Ew.prototype.removeQueryData=function(t,e){return Rd(0<this.targetCount,"Removing a target from an empty cache"),Rd(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,km.resolve()},Ew.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),km.waitFor(s).next(function(){return a})},Ew.prototype.getQueryCount=function(t){return km.resolve(this.targetCount)},Ew.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return km.resolve(n)},Ew.prototype.getQueryDataForTarget=function(t,e){return Dd("Not yet implemented.")},Ew.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),km.waitFor(i)},Ew.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),km.waitFor(i)},Ew.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),km.resolve()},Ew.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return km.resolve(n)},Ew.prototype.containsKey=function(t,e){return km.resolve(this.references.containsKey(e))},Ew);function Ew(t){this.persistence=t,this.queries=new gv(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=tm.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new pw,this.targetCount=0,this.targetIdGenerator=Bm.forQueryCache()}var Tw=(Sw.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,km.waitFor(r)},Sw.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,km.resolve(n.size)):km.resolve(0)},Sw.prototype.getEntry=function(t,e){var n=this.docs.get(e);return km.resolve(n?n.maybeDocument:null)},Sw.prototype.getSizedEntry=function(t,e){return km.resolve(this.docs.get(e))},Sw.prototype.getEntries=function(t,e){var n=this,r=mm();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),km.resolve(r)},Sw.prototype.getSizedEntries=function(t,e){var n=this,r=mm(),i=new nm(My.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),km.resolve({maybeDocuments:r,sizeMap:i})},Sw.prototype.getDocumentsMatchingQuery=function(t,e){Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=gm(),r=new My(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof hv&&e.matches(s)&&(n=n.insert(s.key,s))}return km.resolve(n)},Sw.prototype.forEachDocumentKey=function(t,e){return km.forEach(this.docs,function(t){return e(t)})},Sw.prototype.getNewDocumentChanges=function(t){var r=this,i=ym();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new pv(t,tm.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=Em(),km.resolve(i)},Sw.prototype.newChangeBuffer=function(){return new Cw(this.sizer,this)},Sw.prototype.getSize=function(t){return km.resolve(this.size)},Sw);function Sw(t,e){this.indexManager=t,this.sizer=e,this.docs=new nm(My.comparator),this.newDocumentChanges=Em(),this.size=0}var Iw,Cw=(ii(Nw,Iw=wv),Nw.prototype.applyChanges=function(t){var i=this,e=this.assertChanges(),o=0,a=[];return e.forEach(function(t,e){var n=i.documentSizes.get(t);Rd(void 0!==n,"Attempting to change document "+t.toString()+" without having read it first");var r=i.sizer(e);o+=r-n,a.push({maybeDocument:e,size:r})}),this.documentCache.addEntries(t,a,o)},Nw.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Nw.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Nw);function Nw(t,e){var n=Iw.call(this)||this;return n.sizer=t,n.documentCache=e,n}var Aw=(kw.createLruPersistence=function(t,e,n){return new kw(t,function(t){return new Pw(t,new Eg(e),n)})},kw.createEagerPersistence=function(t){return new kw(t,function(t){return new Rw(t)})},kw.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(kw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),kw.prototype.getActiveClients=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,[this.clientId]]})})},kw.prototype.setPrimaryStateListener=function(t){return t(!0)},kw.prototype.setDatabaseDeletedListener=function(){},kw.prototype.setNetworkEnabled=function(t){},kw.prototype.getIndexManager=function(){return this.indexManager},kw.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new bw(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},kw.prototype.getQueryCache=function(){return this.queryCache},kw.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},kw.prototype.runTransaction=function(t,e,n){var r=this;Nd("MemoryPersistence","Starting transaction:",t);var i=new Dw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},kw.prototype.mutationQueuesContainKey=function(e,n){return km.or(function(t){var n=[];return Wd(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},kw);function kw(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Ty(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new _w(this);this.indexManager=new Pv,this.remoteDocumentCache=new Tw(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var Dw=function(t){this.currentSequenceNumber=t},Rw=(Object.defineProperty(Ow.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Dd("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Ow.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Ow.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),km.resolve()},Ow.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),km.resolve()},Ow.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),km.resolve()},Ow.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},Ow.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Ow.prototype.onTransactionCommitted=function(n){var t=this,r=this.persistence.getRemoteDocumentCache();return km.forEach(this.orphanedDocuments,function(e){return t.isReferenced(n,e).next(function(t){return t?km.resolve():r.removeEntry(n,e).next(function(){})})}).next(function(){t._orphanedDocuments=null})},Ow.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Ow.prototype.documentSize=function(t){return 0},Ow.prototype.isReferenced=function(t,e){var n=this;return km.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return km.resolve(n.inMemoryPins.containsKey(e))}])},Ow);function Ow(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var Pw=(xw.prototype.onTransactionStarted=function(){},xw.prototype.onTransactionCommitted=function(t){return km.resolve()},xw.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},xw.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},xw.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},xw.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return km.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?km.resolve():r(e)})})},xw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},xw.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},xw.prototype.removeOrphanedDocuments=function(n,t){var r=this,i=0,o=this.persistence.getRemoteDocumentCache();return o.forEachDocumentKey(n,function(e){return r.isPinned(n,e,t).next(function(t){return t?km.resolve():(i++,o.removeEntry(n,e).next())})}).next(function(){return i})},xw.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),km.resolve()},xw.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},xw.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),km.resolve()},xw.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),km.resolve()},xw.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),km.resolve()},xw.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Dd("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},xw.prototype.isPinned=function(t,e,n){var r=this;return km.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return km.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return km.resolve(void 0!==t&&n<t)}])},xw.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},xw);function xw(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new gv(function(t){return zy(t.path)}),this.garbageCollector=new Og(this,n)}var Mw=Number,Lw=Mw.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Fw=Mw.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Uw=Mw.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function qw(t){return null==t}function Vw(t){return Uw(t)&&t<=Fw&&Lw<=t}var Bw=(jw.prototype.reset=function(){this.currentBaseMs=0},jw.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},jw.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Nd("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},jw.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},jw.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},jw);function jw(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Ww,Kw,Qw="PersistentStream";(Kw=Ww=Ww||{})[Kw.Initial=0]="Initial",Kw[Kw.Starting=1]="Starting",Kw[Kw.Open=2]="Open",Kw[Kw.Error=3]="Error",Kw[Kw.Backoff=4]="Backoff";var Hw=(Gw.prototype.isStarted=function(){return this.state===Ww.Starting||this.state===Ww.Open||this.state===Ww.Backoff},Gw.prototype.isOpen=function(){return this.state===Ww.Open},Gw.prototype.start=function(){this.state!==Ww.Error?(Rd(this.state===Ww.Initial,"Already started"),this.auth()):this.performBackoff()},Gw.prototype.stop=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Ww.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gw.prototype.inhibitBackoff=function(){Rd(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Ww.Initial,this.backoff.reset()},Gw.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},Gw.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Gw.prototype.handleIdleCloseTimer=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.isOpen()?[2,this.close(Ww.Initial)]:[2]})})},Gw.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Gw.prototype.close=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Rd(this.isStarted(),"Only started streams should be closed."),Rd(e===Ww.Error||qw(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==Ww.Error?this.backoff.reset():n&&n.code===Ld.RESOURCE_EXHAUSTED?(Ad(n.toString()),Ad("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Ld.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},Gw.prototype.tearDown=function(){},Gw.prototype.auth=function(){var n=this;Rd(this.state===Ww.Initial,"Must be in initial state to auth"),this.state=Ww.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Fd(Ld.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},Gw.prototype.startStream=function(t){var e=this;Rd(this.state===Ww.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Rd(e.state===Ww.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Ww.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Gw.prototype.performBackoff=function(){var t=this;Rd(this.state===Ww.Error,"Should only perform backoff when in Error state"),this.state=Ww.Backoff,this.backoff.backoffAndRun(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){return Rd(this.state===Ww.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Ww.Initial,this.start(),Rd(this.isStarted(),"PersistentStream should have started"),[2]})})})},Gw.prototype.handleStreamClose=function(t){return Rd(this.isStarted(),"Can't handle server close on non-started stream"),Nd(Qw,"close with error: "+t),this.stream=null,this.close(Ww.Error,t)},Gw.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Nd(Qw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Gw);function Gw(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Ww.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Bw(t,e,1e3,1.5,6e4)}var zw,Yw=(ii(Xw,zw=Hw),Xw.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},Xw.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},Xw.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},Xw.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},Xw);function Xw(t,e,n,r,i){var o=zw.call(this,t,Fy.ListenStreamConnectionBackoff,Fy.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Jw,$w=(ii(Zw,Jw=Hw),Object.defineProperty(Zw.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),Zw.prototype.start=function(){this.handshakeComplete_=!1,Jw.prototype.start.call(this)},Zw.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Zw.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},Zw.prototype.onMessage=function(t){if(Rd(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Rd(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Zw.prototype.writeHandshake=function(){Rd(this.isOpen(),"Writing handshake requires an opened stream"),Rd(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},Zw.prototype.writeMutations=function(t){var e=this;Rd(this.isOpen(),"Writing mutations requires an opened stream"),Rd(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Rd(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},Zw);function Zw(t,e,n,r,i){var o=Jw.call(this,t,Fy.WriteStreamConnectionBackoff,Fy.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=xd(),o}var t_=(e_.prototype.newPersistentWriteStream=function(t){return new $w(this.queue,this.connection,this.credentials,this.serializer,t)},e_.prototype.newPersistentWatchStream=function(t){return new Yw(this.queue,this.connection,this.credentials,this.serializer,t)},e_.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},e_.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=ym();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Rd(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},e_.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Ld.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},e_.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Ld.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},e_);function e_(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var n_,r_,i_,o_,a_=(s_.prototype.lookup=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Fd(Ld.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof pv||t instanceof hv?n.recordVersion(t):Dd("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},s_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},s_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},s_.prototype.delete=function(t){this.write([new cw(t,this.precondition(t))]),this.writtenDocs.add(t)},s_.prototype.commit=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Fd(Ld.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},s_.prototype.recordVersion=function(t){var e;if(t instanceof hv)e=t.version;else{if(!(t instanceof pv))throw Dd("Document in a transaction was a "+t.constructor.name);e=tm.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Fd(Ld.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},s_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Yb.updateTime(e):Yb.NONE},s_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Yb.exists(!0);if(e.isEqual(tm.forDeletedDoc()))throw new Fd(Ld.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yb.updateTime(e)},s_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},s_.prototype.ensureCommitNotCalled=function(){Rd(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},s_);function s_(t){this.datastore=t,this.readVersions=wm(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(r_=n_=n_||{})[r_.Unknown=0]="Unknown",r_[r_.Online=1]="Online",r_[r_.Offline=2]="Offline",(o_=i_=i_||{})[o_.RemoteStore=0]="RemoteStore",o_[o_.SharedClientState=1]="SharedClientState";var u_,c_,h_=(l_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(n_.Unknown),Rd(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Fy.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Rd(t.state===n_.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(n_.Offline),Promise.resolve()}))},l_.prototype.handleWatchStreamFailure=function(t){this.state===n_.Online?(this.setAndBroadcast(n_.Unknown),Rd(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Rd(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(n_.Offline)))},l_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===n_.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},l_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},l_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Ad(e),this.shouldWarnClientIsOffline=!1):Nd("OnlineStateTracker",e)},l_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},l_);function l_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=n_.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function f_(t){switch(t){case Ld.OK:return Dd("Treated status OK as error");case Ld.CANCELLED:case Ld.UNKNOWN:case Ld.DEADLINE_EXCEEDED:case Ld.RESOURCE_EXHAUSTED:case Ld.INTERNAL:case Ld.UNAVAILABLE:case Ld.UNAUTHENTICATED:return!1;case Ld.INVALID_ARGUMENT:case Ld.NOT_FOUND:case Ld.ALREADY_EXISTS:case Ld.PERMISSION_DENIED:case Ld.FAILED_PRECONDITION:case Ld.ABORTED:case Ld.OUT_OF_RANGE:case Ld.UNIMPLEMENTED:case Ld.DATA_LOSS:return!0;default:return Dd("Unknown status code: "+t)}}function p_(t){if(void 0===t)return Ad("GRPC error has no .code"),Ld.UNKNOWN;switch(t){case u_.OK:return Ld.OK;case u_.CANCELLED:return Ld.CANCELLED;case u_.UNKNOWN:return Ld.UNKNOWN;case u_.DEADLINE_EXCEEDED:return Ld.DEADLINE_EXCEEDED;case u_.RESOURCE_EXHAUSTED:return Ld.RESOURCE_EXHAUSTED;case u_.INTERNAL:return Ld.INTERNAL;case u_.UNAVAILABLE:return Ld.UNAVAILABLE;case u_.UNAUTHENTICATED:return Ld.UNAUTHENTICATED;case u_.INVALID_ARGUMENT:return Ld.INVALID_ARGUMENT;case u_.NOT_FOUND:return Ld.NOT_FOUND;case u_.ALREADY_EXISTS:return Ld.ALREADY_EXISTS;case u_.PERMISSION_DENIED:return Ld.PERMISSION_DENIED;case u_.FAILED_PRECONDITION:return Ld.FAILED_PRECONDITION;case u_.ABORTED:return Ld.ABORTED;case u_.OUT_OF_RANGE:return Ld.OUT_OF_RANGE;case u_.UNIMPLEMENTED:return Ld.UNIMPLEMENTED;case u_.DATA_LOSS:return Ld.DATA_LOSS;default:return Dd("Unknown status code: "+t)}}(c_=u_=u_||{})[c_.OK=0]="OK",c_[c_.CANCELLED=1]="CANCELLED",c_[c_.UNKNOWN=2]="UNKNOWN",c_[c_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",c_[c_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",c_[c_.NOT_FOUND=5]="NOT_FOUND",c_[c_.ALREADY_EXISTS=6]="ALREADY_EXISTS",c_[c_.PERMISSION_DENIED=7]="PERMISSION_DENIED",c_[c_.UNAUTHENTICATED=16]="UNAUTHENTICATED",c_[c_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",c_[c_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",c_[c_.ABORTED=10]="ABORTED",c_[c_.OUT_OF_RANGE=11]="OUT_OF_RANGE",c_[c_.UNIMPLEMENTED=12]="UNIMPLEMENTED",c_[c_.INTERNAL=13]="INTERNAL",c_[c_.UNAVAILABLE=14]="UNAVAILABLE",c_[c_.DATA_LOSS=15]="DATA_LOSS";var d_,y_,m_,v_,g_=(b_.emptySet=function(t){return new b_(t.comparator)},b_.prototype.has=function(t){return null!=this.keyedMap.get(t)},b_.prototype.get=function(t){return this.keyedMap.get(t)},b_.prototype.first=function(){return this.sortedSet.minKey()},b_.prototype.last=function(){return this.sortedSet.maxKey()},b_.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},b_.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(b_.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),b_.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},b_.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},b_.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},b_.prototype.isEqual=function(t){if(!(t instanceof b_))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},b_.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},b_.prototype.copy=function(t,e){var n=new b_;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},b_);function b_(n){this.comparator=n?function(t,e){return n(t,e)||My.comparator(t.key,e.key)}:function(t,e){return My.comparator(t.key,e.key)},this.keyedMap=gm(),this.sortedSet=new nm(this.comparator)}(y_=d_=d_||{})[y_.Added=0]="Added",y_[y_.Removed=1]="Removed",y_[y_.Modified=2]="Modified",y_[y_.Metadata=3]="Metadata",(v_=m_=m_||{})[v_.Local=0]="Local",v_[v_.Synced=1]="Synced";var w_=(__.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==d_.Added&&n.type===d_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===d_.Metadata&&n.type!==d_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===d_.Modified&&n.type===d_.Modified?this.changeMap=this.changeMap.insert(e,{type:d_.Modified,doc:t.doc}):t.type===d_.Modified&&n.type===d_.Added?this.changeMap=this.changeMap.insert(e,{type:d_.Added,doc:t.doc}):t.type===d_.Removed&&n.type===d_.Added?this.changeMap=this.changeMap.remove(e):t.type===d_.Removed&&n.type===d_.Modified?this.changeMap=this.changeMap.insert(e,{type:d_.Removed,doc:n.doc}):t.type===d_.Added&&n.type===d_.Removed?this.changeMap=this.changeMap.insert(e,{type:d_.Modified,doc:t.doc}):Dd("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},__.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},__);function __(){this.changeMap=new nm(My.comparator)}var E_=(T_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:d_.Added,doc:t})}),new T_(t,e,g_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(T_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),T_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},T_);function T_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var S_=(I_.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=C_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new I_(tm.MIN,r,Sm(),ym(),Em())},I_);function I_(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var C_=(N_.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new N_(xd(),e,Em(),Em(),Em())},N_);function N_(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var A_,k_,D_=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},R_=function(t,e){this.targetId=t,this.existenceFilter=e};(k_=A_=A_||{})[k_.NoChange=0]="NoChange",k_[k_.Added=1]="Added",k_[k_.Removed=2]="Removed",k_[k_.Current=3]="Current",k_[k_.Reset=4]="Reset";var O_=function(t,e,n,r){void 0===n&&(n=xd()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},P_=(Object.defineProperty(x_.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(x_.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(x_.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(x_.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),x_.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},x_.prototype.toTargetChange=function(){var n=Em(),r=Em(),i=Em();return this.documentChanges.forEach(function(t,e){switch(e){case d_.Added:n=n.add(t);break;case d_.Modified:r=r.add(t);break;case d_.Removed:i=i.add(t);break;default:Dd("Encountered invalid change type: "+e)}}),new C_(this._resumeToken,this._current,n,r,i)},x_.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=U_()},x_.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},x_.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},x_.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},x_.prototype.recordTargetResponse=function(){this.pendingResponses-=1},x_.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},x_);function x_(){this.pendingResponses=0,this.documentChanges=U_(),this._resumeToken=xd(),this._current=!1,this._hasPendingChanges=!0}var M_=(L_.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof hv?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof pv&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},L_.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case A_.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case A_.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case A_.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Rd(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case A_.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case A_.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Dd("Unknown target watch change state: "+n.state)}})},L_.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):jd(this.targetStates,e)},L_.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new My(i.path);this.removeDocumentFromTarget(e,o,new pv(o,tm.forDeletedDoc()))}else Rd(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},L_.prototype.createRemoteEvent=function(i){var o=this,a={};jd(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new My(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new pv(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Em();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===dg.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new S_(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=ym(),this.pendingDocumentTargetMapping=F_(),this.pendingTargetResets=new hm(ly),t},L_.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?d_.Modified:d_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},L_.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,d_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},L_.prototype.removeTarget=function(t){delete this.targetStates[t]},L_.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},L_.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},L_.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new P_),this.targetStates[t]},L_.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new hm(ly),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},L_.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Nd("WatchChangeAggregator","Detected inactive target",t),e},L_.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},L_.prototype.resetTarget=function(e){var n=this;Rd(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new P_,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},L_.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},L_);function L_(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=ym(),this.pendingDocumentTargetMapping=F_(),this.pendingTargetResets=new hm(ly)}function F_(){return new nm(My.comparator)}function U_(){return new nm(My.comparator)}var q_="RemoteStore",V_=(B_.prototype.start=function(){return this.enableNetwork()},B_.prototype.enableNetwork=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(n_.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},B_.prototype.disableNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(n_.Offline),[2]}})})},B_.prototype.disableNetworkInternal=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Nd(q_,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},B_.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Nd(q_,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(n_.Unknown),[2]}})})},B_.prototype.listen=function(t){Rd(!Vd(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},B_.prototype.unlisten=function(t){Rd(Vd(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Kd(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(n_.Unknown))},B_.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},B_.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},B_.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},B_.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},B_.prototype.startWatchStream=function(){Rd(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new M_(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},B_.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Kd(this.listenTargets)},B_.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},B_.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},B_.prototype.onWatchStreamOpen=function(){return ai(this,void 0,void 0,function(){var n=this;return si(this,function(t){return jd(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},B_.prototype.onWatchStreamClose=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return void 0===e&&Rd(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(n_.Unknown),[2]})})},B_.prototype.onWatchStreamChange=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(n_.Online),n instanceof O_&&n.state===A_.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof D_?this.watchChangeAggregator.handleDocumentChange(n):n instanceof R_?this.watchChangeAggregator.handleExistenceFilter(n):(Rd(n instanceof O_,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(tm.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},B_.prototype.raiseWatchSnapshot=function(r){var i=this;Rd(!r.isEqual(tm.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return jd(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.copy({resumeToken:e.resumeToken,snapshotVersion:r}))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.copy({resumeToken:xd()}),i.sendUnwatchRequest(t);var n=new wg(e.query,t,dg.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},B_.prototype.handleTargetError=function(t){var n=this;Rd(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ai(n,void 0,void 0,function(){return si(this,function(t){return Vd(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},B_.prototype.fillWritePipeline=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},B_.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},B_.prototype.outstandingWrites=function(){return this.writePipeline.length},B_.prototype.addToWritePipeline=function(t){Rd(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},B_.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},B_.prototype.startWriteStream=function(){Rd(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},B_.prototype.onWriteStreamOpen=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.writeStream.writeHandshake(),[2]})})},B_.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(jg)},B_.prototype.onMutationResult=function(t,e){var n=this;Rd(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Nm.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},B_.prototype.onWriteStreamClose=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){return void 0===n&&Rd(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},B_.prototype.handleHandshakeError=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return f_(e.code)?(Nd(q_,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=xd(),[2,this.localStore.setLastStreamToken(xd()).catch(jg)]):[2]})})},B_.prototype.handleWriteError=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){return function(t){return f_(t)&&t!==Ld.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},B_.prototype.createTransaction=function(){return new a_(this.datastore)},B_.prototype.restartNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(n_.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},B_.prototype.handleCredentialChange=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Nd(q_,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},B_.prototype.applyPrimaryState=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(n_.Unknown),t.label=4;case 4:return[2]}})})},B_);function B_(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ai(o,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Nd(q_,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new h_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var j_=(Object.defineProperty(W_.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(W_.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),W_.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},W_.prototype._compareTo=function(t){return ly(this._lat,t._lat)||ly(this._long,t._long)},W_);function W_(t,e){if(Hd("GeoPoint",arguments,2),Yd("GeoPoint","number",1,t),Yd("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Fd(Ld.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Fd(Ld.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var K_=(Q_.atPath=function(t){return new Q_(t)},Object.defineProperty(Q_.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[bE]:this.memoizedOrderBy=[new vE(t),bE];else{Rd(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:pE.ASCENDING;this.memoizedOrderBy.push(a===pE.ASCENDING?bE:wE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),Q_.prototype.addFilter=function(t){Rd(null==this.getInequalityFilterField()||!(t instanceof X_)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Rd(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},Q_.prototype.addOrderBy=function(t){Rd(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new Q_(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},Q_.prototype.withLimit=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},Q_.prototype.withStartAt=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},Q_.prototype.withEndAt=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},Q_.prototype.asCollectionQueryAtPath=function(t){return new Q_(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},Q_.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";qw(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},Q_.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),qw(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},Q_.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Q_.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Rd(n,"orderBy used that doesn't compare on key field"),0},Q_.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},Q_.prototype.hasLimit=function(){return!qw(this.limit)},Q_.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},Q_.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof X_&&n.isInequality())return n.field}return null},Q_.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof X_&&0<=t.indexOf(r.op))return r.op}return null},Q_.prototype.isDocumentQuery=function(){return My.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},Q_.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},Q_.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):My.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},Q_.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},Q_.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Q_.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},Q_.prototype.assertValidBound=function(t){Rd(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Q_);function Q_(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function H_(){}var G_=(z_.fromString=function(t){switch(t){case"<":return z_.LESS_THAN;case"<=":return z_.LESS_THAN_OR_EQUAL;case"==":return z_.EQUAL;case">=":return z_.GREATER_THAN_OR_EQUAL;case">":return z_.GREATER_THAN;case"array-contains":return z_.ARRAY_CONTAINS;case"in":return z_.IN;case"array-contains-any":return z_.ARRAY_CONTAINS_ANY;default:return Dd("Unknown FieldFilter operator: "+t)}},z_.prototype.toString=function(){return this.name},z_.prototype.isEqual=function(t){return this.name===t.name},z_.LESS_THAN=new z_("<"),z_.LESS_THAN_OR_EQUAL=new z_("<="),z_.EQUAL=new z_("=="),z_.GREATER_THAN=new z_(">"),z_.GREATER_THAN_OR_EQUAL=new z_(">="),z_.ARRAY_CONTAINS=new z_("array-contains"),z_.IN=new z_("in"),z_.ARRAY_CONTAINS_ANY=new z_("array-contains-any"),z_);function z_(t){this.name=t}var Y_,X_=(ii(J_,Y_=H_),J_.create=function(t,e,n){if(t.isKeyField())return e===G_.IN?(Rd(n instanceof Vb,"Comparing on key with IN, but filter value not an ArrayValue"),Rd(n.internalValue.every(function(t){return t instanceof Rb}),"Comparing on key with IN, but an array value was not a RefValue"),new nE(t,n)):(Rd(n instanceof Rb,"Comparing on key, but filter value not a RefValue"),Rd(e!==G_.ARRAY_CONTAINS&&e!==G_.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Z_(t,e,n));if(n.isEqual(rb.INSTANCE)){if(e!==G_.EQUAL)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new J_(t,e,n)}if(n.isEqual(mb.NAN)){if(e!==G_.EQUAL)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new J_(t,e,n)}return e===G_.ARRAY_CONTAINS?new oE(t,n):e===G_.IN?(Rd(n instanceof Vb,"IN filter has invalid value: "+n.toString()),new uE(t,n)):e===G_.ARRAY_CONTAINS_ANY?(Rd(n instanceof Vb,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new lE(t,n)):new J_(t,e,n)},J_.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},J_.prototype.matchesComparison=function(t){switch(this.op){case G_.LESS_THAN:return t<0;case G_.LESS_THAN_OR_EQUAL:return t<=0;case G_.EQUAL:return 0===t;case G_.GREATER_THAN:return 0<t;case G_.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Dd("Unknown FieldFilter operator: "+this.op)}},J_.prototype.isInequality=function(){return 0<=[G_.LESS_THAN,G_.LESS_THAN_OR_EQUAL,G_.GREATER_THAN,G_.GREATER_THAN_OR_EQUAL].indexOf(this.op)},J_.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},J_.prototype.isEqual=function(t){return t instanceof J_&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},J_.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},J_);function J_(t,e,n){var r=Y_.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var $_,Z_=(ii(tE,$_=X_),tE.prototype.matches=function(t){var e=this.value,n=My.comparator(t.key,e.key);return this.matchesComparison(n)},tE);function tE(){return null!==$_&&$_.apply(this,arguments)||this}var eE,nE=(ii(rE,eE=X_),rE.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},rE);function rE(t,e){var n=eE.call(this,t,G_.IN,e)||this;return n.value=e,n}var iE,oE=(ii(aE,iE=X_),aE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Vb&&e.contains(this.value)},aE);function aE(t,e){return iE.call(this,t,G_.ARRAY_CONTAINS,e)||this}var sE,uE=(ii(cE,sE=X_),cE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},cE);function cE(t,e){var n=sE.call(this,t,G_.IN,e)||this;return n.value=e,n}var hE,lE=(ii(fE,hE=X_),fE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Vb&&n.internalValue.some(function(t){return e.value.contains(t)})},fE);function fE(t,e){var n=hE.call(this,t,G_.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var pE=(dE.prototype.toString=function(){return this.name},dE.ASCENDING=new dE("asc"),dE.DESCENDING=new dE("desc"),dE);function dE(t){this.name=t}var yE=(mE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},mE.prototype.sortsBeforeDocument=function(t,e){Rd(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Rd(o instanceof Rb,"Bound has a non-key value where the key path is being used."),n=My.comparator(o.key,e.key);else{var a=e.field(i.field);Rd(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===pE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},mE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},mE);function mE(t,e){this.position=t,this.before=e}var vE=(gE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?hv.compareByKey(t,e):hv.compareByField(this.field,t,e);switch(this.dir){case pE.ASCENDING:return n;case pE.DESCENDING:return-1*n;default:return Dd("Unknown direction: "+this.dir)}},gE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},gE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},gE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},gE);function gE(t,e){this.field=t,void 0===e&&(e=pE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var bE=new vE(Py.keyField(),pE.ASCENDING),wE=new vE(Py.keyField(),pE.DESCENDING),_E=(EE.prototype.applyToLocalView=function(t,e){return new Ib(e,t)},EE.prototype.applyToRemoteDocument=function(t,e){return e},EE.prototype.computeBaseValue=function(t){return null},EE.prototype.isEqual=function(t){return t instanceof EE},EE.instance=new EE,EE);function EE(){}var TE=(SE.prototype.applyToLocalView=function(t,e){return this.apply(t)},SE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},SE.prototype.apply=function(t){for(var n=kE(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Vb(n)},SE.prototype.computeBaseValue=function(t){return null},SE.prototype.isEqual=function(t){return t instanceof SE&&fy(t.elements,this.elements)},SE);function SE(t){this.elements=t}var IE=(CE.prototype.applyToLocalView=function(t,e){return this.apply(t)},CE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},CE.prototype.apply=function(t){for(var n=kE(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Vb(n)},CE.prototype.computeBaseValue=function(t){return null},CE.prototype.isEqual=function(t){return t instanceof CE&&fy(t.elements,this.elements)},CE);function CE(t){this.elements=t}var NE=(AE.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof pb&&this.operand instanceof pb){var r=n.internalValue+this.operand.internalValue;return new pb(r)}return r=n.internalValue+this.operand.internalValue,new mb(r)},AE.prototype.applyToRemoteDocument=function(t,e){return Rd(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},AE.prototype.computeBaseValue=function(t){return t instanceof cb?t:new pb(0)},AE.prototype.isEqual=function(t){return t instanceof AE&&this.operand.isEqual(t.operand)},AE);function AE(t){this.operand=t}function kE(t){return t instanceof Vb?t.internalValue.slice():[]}var DE=(RE.prototype.isEqual=function(t){return t&&t.count===this.count},RE);function RE(t){this.count=t}var OE,PE,xE=((OE={})[pE.ASCENDING.name]="ASCENDING",OE[pE.DESCENDING.name]="DESCENDING",OE),ME=((PE={})[G_.LESS_THAN.name]="LESS_THAN",PE[G_.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",PE[G_.GREATER_THAN.name]="GREATER_THAN",PE[G_.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",PE[G_.EQUAL.name]="EQUAL",PE[G_.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",PE[G_.IN.name]="IN",PE[G_.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",PE),LE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function FE(t,e){Rd(!qw(t),e+" is missing")}function UE(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Dd("can't parse "+t)}var qE=(VE.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},VE.prototype.unsafeCastProtoByteString=function(t){return t},VE.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Ld.UNKNOWN:p_(t.code);return new Fd(e,t.message||"")},VE.prototype.toInt32Value=function(t){return qw(t)?void 0:{value:t}},VE.prototype.fromInt32Value=function(t){var e;return qw(e="object"==typeof t?t.value:t)?null:e},VE.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},VE.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Rd(!!t,"Cannot deserialize null or undefined timestamp.");var e=UE(t.seconds||"0"),n=t.nanos||0;return new $y(e,n)},VE.prototype.fromIso8601String=function(t){var e=0,n=LE.exec(t);if(Rd(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new $y(o,e)},VE.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},VE.prototype.fromBlob=function(t){return"string"==typeof t?(Rd(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),my.fromBase64String(t)):(Rd(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),my.fromUint8Array(t))},VE.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},VE.prototype.fromVersion=function(t){return Rd(!!t,"Trying to deserialize version that isn't set"),tm.fromTimestamp(this.fromTimestamp(t))},VE.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},VE.prototype.fromResourceName=function(t){var e=ky.fromString(t);return Rd(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},VE.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},VE.prototype.fromName=function(t){var e=this.fromResourceName(t);return Rd(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Rd(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new My(this.extractLocalPathFromResourceName(e))},VE.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},VE.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?ky.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(VE.prototype,"encodedDatabaseId",{get:function(){return new ky(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),VE.prototype.fullyQualifiedPrefixPath=function(t){return new ky(["projects",t.projectId,"databases",t.database])},VE.prototype.extractLocalPathFromResourceName=function(t){return Rd(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},VE.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},VE.prototype.toValue=function(t){if(t instanceof rb)return{nullValue:"NULL_VALUE"};if(t instanceof ab)return{booleanValue:t.value()};if(t instanceof pb)return{integerValue:""+t.value()};if(t instanceof mb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof bb?{stringValue:t.value()}:t instanceof Fb?{mapValue:this.toMapValue(t)}:t instanceof Vb?{arrayValue:this.toArrayValue(t)}:t instanceof Eb?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof xb?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ab?{bytesValue:this.toBytes(t.value())}:t instanceof Rb?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Dd("Unknown FieldValue "+JSON.stringify(t))},VE.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return rb.INSTANCE;if("booleanValue"in t)return ab.of(t.booleanValue);if("integerValue"in t)return new pb(UE(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return mb.NAN;if("Infinity"===t.doubleValue)return mb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return mb.NEGATIVE_INFINITY}return new mb(t.doubleValue)}if("stringValue"in t)return new bb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){FE(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Vb(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return FE(t.timestampValue,"timestampValue"),new Eb(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){FE(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new xb(new j_(r,i))}if("bytesValue"in t){FE(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Ab(o)}if("referenceValue"in t){FE(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new _y(a.get(1),a.get(3)),u=new My(this.extractLocalPathFromResourceName(a));return new Rb(s,u)}return Dd("Unknown Value proto "+JSON.stringify(t))},VE.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},VE.prototype.toDocument=function(t){return Rd(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},VE.prototype.fromDocument=function(t,e){return new hv(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},VE.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},VE.prototype.fromFields=function(t){var n=this,e=t,r=Fb.EMPTY;return Wd(e,function(t,e){r=r.set(new Py([t]),n.fromValue(e))}),r},VE.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},VE.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},VE.prototype.fromFound=function(t){Rd(!!t.found,"Tried to deserialize a found document from a missing document."),FE(t.found.name,"doc.found.name"),FE(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new hv(e,n,r,{},t.found)},VE.prototype.fromMissing=function(t){Rd(!!t.missing,"Tried to deserialize a missing document from a found document."),Rd(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new pv(e,n)},VE.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Dd("invalid batch get response: "+JSON.stringify(t))},VE.prototype.toWatchTargetChangeState=function(t){switch(t){case A_.Added:return"ADD";case A_.Current:return"CURRENT";case A_.NoChange:return"NO_CHANGE";case A_.Removed:return"REMOVE";case A_.Reset:return"RESET";default:return Dd("Unknown WatchTargetChangeState: "+t)}},VE.prototype.toTestWatchChange=function(t){if(t instanceof R_)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof D_){if(t.newDoc instanceof hv){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof pv)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof O_){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return u_.OK;switch(t){case Ld.OK:return u_.OK;case Ld.CANCELLED:return u_.CANCELLED;case Ld.UNKNOWN:return u_.UNKNOWN;case Ld.DEADLINE_EXCEEDED:return u_.DEADLINE_EXCEEDED;case Ld.RESOURCE_EXHAUSTED:return u_.RESOURCE_EXHAUSTED;case Ld.INTERNAL:return u_.INTERNAL;case Ld.UNAVAILABLE:return u_.UNAVAILABLE;case Ld.UNAUTHENTICATED:return u_.UNAUTHENTICATED;case Ld.INVALID_ARGUMENT:return u_.INVALID_ARGUMENT;case Ld.NOT_FOUND:return u_.NOT_FOUND;case Ld.ALREADY_EXISTS:return u_.ALREADY_EXISTS;case Ld.PERMISSION_DENIED:return u_.PERMISSION_DENIED;case Ld.FAILED_PRECONDITION:return u_.FAILED_PRECONDITION;case Ld.ABORTED:return u_.ABORTED;case Ld.OUT_OF_RANGE:return u_.OUT_OF_RANGE;case Ld.UNIMPLEMENTED:return u_.UNIMPLEMENTED;case Ld.DATA_LOSS:return u_.DATA_LOSS;default:return Dd("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Dd("Unrecognized watch change: "+JSON.stringify(t))},VE.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){FE(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new O_(n,r,i,a||null)}else if("documentChange"in t){FE(t.documentChange,"documentChange"),FE(t.documentChange.document,"documentChange.name"),FE(t.documentChange.document.name,"documentChange.document.name"),FE(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new hv(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new D_(f,p,l.key,l)}else if("documentDelete"in t){FE(t.documentDelete,"documentDelete"),FE(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):tm.forDeletedDoc(),l=new pv(u,c),p=d.removedTargetIds||[],e=new D_([],p,l.key,l)}else if("documentRemove"in t){FE(t.documentRemove,"documentRemove"),FE(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[],e=new D_([],p,u,null)}else{if(!("filter"in t))return Dd("Unknown change type "+JSON.stringify(t));FE(t.filter,"filter"),FE(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new DE(v),b=m.targetId;e=new R_(b,g)}return e},VE.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?A_.NoChange:"ADD"===t?A_.Added:"REMOVE"===t?A_.Removed:"CURRENT"===t?A_.Current:"RESET"===t?A_.Reset:Dd("Got unexpected TargetChange.state: "+t)},VE.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return tm.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?tm.MIN:e.readTime?this.fromVersion(e.readTime):tm.MIN},VE.prototype.toMutation=function(t){var e,n=this;if(t instanceof tw)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof cw)e={delete:this.toName(t.key)};else if(t instanceof rw)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof aw))return Dd("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},VE.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Yb.NONE;if(t.update){FE(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new rw(r,i,o,n)}return new tw(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new cw(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Rd(!0===n.exists,'Transforms only support precondition "exists == true"'),new aw(r,a)}return Dd("unknown mutation proto: "+JSON.stringify(t))},VE.prototype.toPrecondition=function(t){return Rd(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Dd("Unknown precondition")},VE.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Yb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Yb.exists(t.exists):Yb.NONE},VE.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new zb(r,i)},VE.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Rd(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},VE.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof _E)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof TE)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof IE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof NE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Dd("Unknown transform: "+t.transform)},VE.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Rd("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=_E.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new TE(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new IE(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Rd(i instanceof cb,"NUMERIC_ADD transform requires a NumberValue"),n=new NE(i)}else Dd("Unknown transform proto: "+JSON.stringify(t));var o=Py.fromServerFormat(t.fieldPath);return new Kb(o,n)},VE.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},VE.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Rd(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return K_.atPath(this.fromQueryPath(n))},VE.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Rd(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Rd(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},VE.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Rd(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new K_(e,i,s,a,u,c,h)},VE.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},VE.prototype.toLabel=function(t){switch(t){case dg.Listen:return null;case dg.ExistenceFilterMismatch:return"existence-filter-mismatch";case dg.LimboResolution:return"limbo-document";default:return Dd("Unrecognized query purpose: "+t)}},VE.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},VE.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof X_?e.toUnaryOrFieldFilter(t):Dd("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},VE.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Dd("Unknown filter: "+JSON.stringify(t)):[]},VE.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},VE.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},VE.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},VE.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new yE(r,n)},VE.prototype.toDirection=function(t){return xE[t.name]},VE.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return pE.ASCENDING;case"DESCENDING":return pE.DESCENDING;default:return}},VE.prototype.toOperatorName=function(t){return ME[t.name]},VE.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return G_.EQUAL;case"GREATER_THAN":return G_.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return G_.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return G_.LESS_THAN;case"LESS_THAN_OR_EQUAL":return G_.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return G_.ARRAY_CONTAINS;case"IN":return G_.IN;case"ARRAY_CONTAINS_ANY":return G_.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Dd("Unspecified operator");default:return Dd("Unknown operator")}},VE.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},VE.prototype.fromFieldPathReference=function(t){return Py.fromServerFormat(t.fieldPath)},VE.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},VE.prototype.fromPropertyOrder=function(t){return new vE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},VE.prototype.fromFieldFilter=function(t){return X_.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},VE.prototype.toUnaryOrFieldFilter=function(t){if(t.op===G_.EQUAL){if(t.value.isEqual(mb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(rb.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},VE.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return X_.create(e,G_.EQUAL,mb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return X_.create(n,G_.EQUAL,rb.INSTANCE);case"OPERATOR_UNSPECIFIED":return Dd("Unspecified filter");default:return Dd("Unknown filter")}},VE.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},VE.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Py.fromServerFormat(t)});return jb.fromArray(e)},VE);function VE(t,e){this.databaseId=t,this.options=e}var BE=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},jE=(WE.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new BE,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},WE.prototype.unlisten=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},WE.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(r);o.viewSnap=r}}},WE.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},WE.prototype.onOnlineStateChange=function(i){this.onlineState=i,this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)})},WE);function WE(t){this.syncEngine=t,this.queries=new gv(function(t){return t.canonicalId()}),this.onlineState=n_.Unknown,this.syncEngine.subscribe(this)}var KE=(QE.prototype.onViewSnapshot=function(t){if(Rd(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==d_.Metadata&&e.push(i)}t=new E_(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},QE.prototype.onError=function(t){this.queryObserver.error(t)},QE.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},QE.prototype.shouldRaiseInitialEvent=function(t,e){if(Rd(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==n_.Offline;return this.options.waitForSyncWhenOnline&&n?(Rd(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===n_.Offline},QE.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},QE.prototype.raiseInitialEvent=function(t){Rd(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=E_.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},QE);function QE(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=n_.Unknown,this.options=n||{}}var HE=(GE.fromSnapshot=function(t,e){for(var n=Em(),r=Em(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case d_.Added:n=n.add(a.doc.key);break;case d_.Removed:r=r.add(a.doc.key)}}return new GE(t,n,r)},GE);function GE(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var zE=function(t){this.key=t},YE=function(t){this.key=t},XE=(Object.defineProperty(JE.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),JE.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new w_,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof hv?e:null;r&&(Rd(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(u.track({type:d_.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:d_.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:d_.Added,doc:r}),a=!0):n&&!r&&(u.track({type:d_.Removed,doc:n}),a=!0,p&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:d_.Removed,doc:n})}return Rd(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},JE.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},JE.prototype.applyChanges=function(t,e,n){var r=this;Rd(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case d_.Added:return 1;case d_.Modified:case d_.Metadata:return 2;case d_.Removed:return 0;default:return Dd("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?m_.Synced:m_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new E_(this.query,t.documentSet,i,o,t.mutatedKeys,s===m_.Local,u,!1),limboChanges:a}:{limboChanges:a}},JE.prototype.applyOnlineStateChange=function(t){return this.current&&t===n_.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new w_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},JE.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},JE.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Rd(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},JE.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Em(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new YE(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new zE(t))}),r},JE.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Em();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},JE.prototype.computeInitialSnapshot=function(){return E_.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===m_.Local)},JE);function JE(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Em(),this.mutatedKeys=Em(),this.documentSet=new g_(t.docComparator.bind(t))}var $E="SyncEngine",ZE=function(t,e,n){this.query=t,this.targetId=e,this.view=n},tT=function(t){this.key=t,this.receivedDocument=!1},eT=(Object.defineProperty(nT.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),nT.prototype.subscribe=function(t){Rd(null!==t,"SyncEngine listener cannot be null"),Rd(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},nT.prototype.listen=function(a){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},nT.prototype.initializeViewAndComputeSnapshot=function(c,h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=c.query,[4,this.localStore.executeQuery(e)];case 1:return n=t.sent(),[4,this.localStore.remoteDocumentKeys(c.targetId)];case 2:return r=t.sent(),i=new XE(e,r),o=i.computeDocChanges(n),a=C_.createSynthesizedTargetChangeForCurrentChange(c.targetId,h&&this.onlineState!==n_.Offline),Rd(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),Rd(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new ZE(e,c.targetId,i),this.queryViewsByQuery.set(e,u),this.queryViewsByTarget[c.targetId]=u,[2,s.snapshot]}})})},nT.prototype.synchronizeViewAndComputeSnapshot=function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i.query)];case 1:return e=t.sent(),[4,this.localStore.remoteDocumentKeys(i.targetId)];case 2:return n=t.sent(),r=i.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,r.limboChanges),[2,r]}})})},nT.prototype.unlisten=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Rd(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(jg)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},nT.prototype.write=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},nT.prototype.runTransaction=function(o,a){return void 0===a&&(a=5),ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:if(Rd(0<=a,"Got negative number of retries for transaction."),e=this.remoteStore.createTransaction(),qw(n=o(e))||!n.catch||!n.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,n];case 2:return r=t.sent(),[4,e.commit()];case 3:return t.sent(),[2,r];case 4:return i=t.sent(),0<a&&this.isRetryableTransactionError(i)?[2,this.runTransaction(o,a-1)]:[2,Promise.reject(i)];case 5:return[2]}})})},nT.prototype.applyRemoteEvent=function(n){return ai(this,void 0,void 0,function(){var e,r=this;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),Wd(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Rd(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Rd(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Rd(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,jg(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},nT.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===i_.RemoteStore||!this.isPrimary&&t===i_.SharedClientState){var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Rd(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},nT.prototype.rejectListen=function(u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new nm(My.comparator)).insert(n,new pv(n,tm.forDeletedDoc())),i=Em().add(n),o=new S_(tm.MIN,{},new hm(ly),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Rd(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(jg)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},nT.prototype.applyBatchState=function(n,r,i){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Nd($E,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Dd("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},nT.prototype.applySuccessfulWrite=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,jg(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},nT.prototype.rejectFailedWrite=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,jg(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},nT.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new nm(ly)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},nT.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Rd(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},nT.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},nT.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},nT.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof zE?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof YE?(Nd($E,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Dd("Unknown limbo change: "+JSON.stringify(i))}},nT.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Nd($E,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=K_.atPath(e.path);this.limboResolutionsByTarget[n]=new tT(e),this.remoteStore.listen(new wg(r,n,dg.LimboResolution,Ty.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},nT.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},nT.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return ai(this,void 0,void 0,function(){var o,a,e,s=this;return si(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=HE.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},nT.prototype.assertSubscribed=function(t){Rd(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},nT.prototype.handleCredentialChange=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?[4,this.localStore.handleUserChange(r)]:[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},nT.prototype.applyPrimaryState=function(c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return si(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),jd(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},nT.prototype.resetLimboDocuments=function(){var e=this;jd(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new nm(My.comparator)},nT.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=h,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return t.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=t.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Rd(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Rd(!!(c=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:t.sent(),t.label=9;case 9:e.push(a),t.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},nT.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!f_(e)},nT.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},nT.prototype.applyTargetState=function(a,s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Nd($E,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[a])return[3,11];switch(s){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return t.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=S_.createSynthesizedRemoteEventForCurrentChange(a,"current"===s),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,11];case 4:return function(t){return t.code===Ld.DATA_LOSS&&t.message===Ev}(r=t.sent())?(i=[],jd(this.queryViewsByTarget,function(t){return i.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(i)]):[3,6];case 5:return t.sent(),[3,7];case 6:throw r;case 7:return[3,8];case 8:return o=this.queryViewsByTarget[a],this.removeAndCleanupQuery(o),[4,this.localStore.releaseQuery(o.query,!0)];case 9:return t.sent(),this.syncEngineListener.onWatchError(o.query,u),[3,11];case 10:Dd("Unexpected target state: "+s),t.label=11;case 11:return[2]}})})},nT.prototype.applyActiveTargetsChange=function(l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return si(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Rd(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return Rd(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return si(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(jg)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},nT.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},nT.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},nT.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Em().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Em()},nT);function nT(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new gv(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new nm(My.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new pw,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Bm.forSyncEngine(),this.isPrimary=void 0,this.onlineState=n_.Unknown}var rT=(iT.prototype.isAuthenticated=function(){return null!=this.uid},iT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},iT.prototype.isEqual=function(t){return t.uid===this.uid},iT.UNAUTHENTICATED=new iT(null),iT.GOOGLE_CREDENTIALS=new iT("google-credentials-uid"),iT.FIRST_PARTY=new iT("first-party-uid"),iT);function iT(t){this.uid=t}var oT="SharedClientState",aT="firestore_clients",sT="firestore_mutations",uT="firestore_targets",cT=(hT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Fd(r.error.code,r.error.message)),i?new hT(t,e,r.state,o):(Ad(oT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},hT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},hT);function hT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Rd(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var lT=(fT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Fd(n.error.code,n.error.message)),r?new fT(t,n.state,i):(Ad(oT,"Failed to parse target state for ID '"+t+"': "+e),null)},fT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},fT);function fT(t,e,n){this.targetId=t,this.state=e,Rd(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var pT=(dT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Sm(),o=0;r&&o<n.activeTargetIds.length;++o)r=Vw(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new dT(t,i):(Ad(oT,"Failed to parse client data for instance '"+t+"': "+e),null)},dT);function dT(t,e){this.clientId=t,this.activeTargetIds=e}var yT=(mT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in n_&&"string"==typeof e.clientId?new mT(e.clientId,n_[e.onlineState]):(Ad(oT,"Failed to parse online state: "+t),null)},mT);function mT(t,e){this.clientId=t,this.onlineState=e}var vT=(gT.prototype.addQueryTarget=function(t){Rd(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},gT.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},gT.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},gT);function gT(){this.activeTargetIds=Sm()}var bT=(wT.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},wT.prototype.start=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return si(this,function(t){switch(t.label){case 0:return Rd(!this.started,"WebStorageSharedClientState already started"),Rd(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Rd(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=pT.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},wT.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},wT.prototype.getAllActiveQueryTargets=function(){var n=Sm();return Wd(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},wT.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},wT.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},wT.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},wT.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=lT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},wT.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},wT.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},wT.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},wT.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},wT.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},wT.prototype.setOnlineState=function(t){this.persistOnlineState(t)},wT.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},wT.prototype.getItem=function(t){var e=this.storage.getItem(t);return Nd(oT,"READ",t,e),e},wT.prototype.setItem=function(t,e){Nd(oT,"SET",t,e),this.storage.setItem(t,e)},wT.prototype.removeItem=function(t){Nd(oT,"REMOVE",t),this.storage.removeItem(t)},wT.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Nd(oT,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Ad("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Rd(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Ty.INVALID;if(null!=t)try{var n=JSON.parse(t);Rd("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Ad(oT,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Ty.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(wT.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),wT.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},wT.prototype.persistMutationState=function(t,e,n){var r=new cT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},wT.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},wT.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:n_[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},wT.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new lT(t,e,n);this.setItem(r,i.toWebStorageJSON())},wT.prototype.toWebStorageClientStateKey=function(t){return Rd(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),aT+"_"+this.persistenceKey+"_"+t},wT.prototype.toWebStorageQueryTargetMetadataKey=function(t){return uT+"_"+this.persistenceKey+"_"+t},wT.prototype.toWebStorageMutationBatchKey=function(t){var e=sT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},wT.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},wT.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Rd(null!==n,"Cannot parse client state key '"+t+"'"),pT.fromWebStorageEntry(n,e)},wT.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Rd(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cT.fromWebStorageEntry(new rT(i),r,e)},wT.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Rd(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return lT.fromWebStorageEntry(r,e)},wT.prototype.fromWebStorageOnlineState=function(t){return yT.fromWebStorageEntry(t)},wT.prototype.handleMutationBatchEvent=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return e.user.uid!==this.currentUser.uid?(Nd(oT,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},wT.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},wT.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},wT.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},wT);function wT(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!wT.isAvailable(this.platform))throw new Fd(Ld.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new vT,this.clientStateKeyRe=new RegExp("^"+aT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+sT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+uT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var _T=(ET.prototype.addPendingMutation=function(t){},ET.prototype.updateMutationState=function(t,e,n){},ET.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},ET.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},ET.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},ET.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},ET.prototype.clearQueryState=function(t){delete this.queryState[t]},ET.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},ET.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},ET.prototype.start=function(){return this.localState=new vT,Promise.resolve()},ET.prototype.handleUserChange=function(t,e,n){},ET.prototype.setOnlineState=function(t){},ET.prototype.shutdown=function(){},ET.prototype.writeSequenceNumber=function(t){},ET);function ET(){this.localState=new vT,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var TT="FirestoreClient",ST=(IT.prototype.lruParams=function(){return Ag.withCacheSize(this.cacheSizeBytes)},IT);function IT(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var CT=function(){},NT=(AT.prototype.start=function(t){var n=this;this.verifyNotShutdown();var r=new qy,i=new qy,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},AT.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},AT.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ST?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},AT.prototype.canFallback=function(t){return t instanceof Fd?t.code===Ld.FAILED_PRECONDITION||t.code===Ld.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},AT.prototype.verifyNotShutdown=function(){if(this.asyncQueue.isShuttingDown)throw new Fd(Ld.FAILED_PRECONDITION,"The client has already been shutdown.")},AT.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=Vg.buildStoragePrefix(this.databaseInfo),a=new qE(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ai(t,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!bT.isAvailable(this.platform))throw new Fd(Ld.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=i.lruParams(),i.synchronizeTabs?(this.sharedClientState=new bT(this.asyncQueue,this.platform,o,this.clientId,r),[4,Vg.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return e=t.sent(),[3,4];case 2:return this.sharedClientState=new _T,[4,Vg.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n)];case 3:e=t.sent(),t.label=4;case 4:return[2,(this.persistence=e).referenceDelegate.garbageCollector]}})})})},AT.prototype.startMemoryPersistence=function(){return this.persistence=Aw.createEagerPersistence(this.clientId),this.sharedClientState=new _T,Promise.resolve(null)},AT.prototype.initializeRest=function(u,c){var t=this;return Nd(TT,"Initializing. user=",u.uid),this.platform.loadConnection(this.databaseInfo).then(function(s){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a=this;return si(this,function(t){switch(t.label){case 0:return this.localStore=new vw(this.persistence,u),c&&(this.lruScheduler=new Dg(c,this.asyncQueue,this.localStore)),e=this.platform.newConnectivityMonitor(),n=this.platform.newSerializer(this.databaseInfo.databaseId),r=new t_(this.asyncQueue,s,this.credentials,n),i=function(t){return a.syncEngine.applyOnlineStateChange(t,i_.RemoteStore)},o=function(t){return a.syncEngine.applyOnlineStateChange(t,i_.SharedClientState)},this.remoteStore=new V_(this.localStore,r,this.asyncQueue,i,e),this.syncEngine=new eT(this.localStore,this.remoteStore,this.sharedClientState,u),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new jE(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},AT.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Nd(TT,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},AT.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},AT.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},AT.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new KE(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},AT.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},AT.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof hv)return t;if(t instanceof pv)return null;throw new Fd(Ld.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},AT.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=Em(),n=new XE(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},AT.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new qy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},AT.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(AT.prototype,"clientShutdown",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),AT.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},AT);function AT(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=cy.newId()}var kT=(DT.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},DT.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},DT.prototype.mute=function(){this.muted=!0},DT.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},DT);function DT(t){this.observer=t,this.muted=!1}var RT=(OT.documentId=function(){return OT._DOCUMENT_ID},OT.prototype.isEqual=function(t){if(!(t instanceof OT))throw ay("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},OT._DOCUMENT_ID=new OT(Py.keyField().canonicalString()),OT);function OT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+uy(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Yd("FieldPath","string",n,t[n]),0===t[n].length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Py(t)}var PT=new RegExp("[~\\*/\\[\\]]");var xT=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},MT=(LT.prototype.getToken=function(){return Promise.resolve(null)},LT.prototype.invalidateToken=function(){},LT.prototype.setChangeListener=function(t){Rd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(rT.UNAUTHENTICATED)},LT.prototype.removeChangeListener=function(){Rd(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},LT);function LT(){this.changeListener=null}var FT=(UT.prototype.getToken=function(){var e=this;Rd(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Fd(Ld.ABORTED,"getToken aborted due to token change.");return t?(Rd("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new xT(t.accessToken,e.currentUser)):null})},UT.prototype.invalidateToken=function(){this.forceRefresh=!0},UT.prototype.setChangeListener=function(t){Rd(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},UT.prototype.removeChangeListener=function(){Rd(null!=this.tokenListener,"removeChangeListener() called twice"),Rd(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},UT.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Rd(null===t||"string"==typeof t,"Received invalid UID: "+t),new rT(t)},UT);function UT(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=rT.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var qT=(Object.defineProperty(VT.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),VT);function VT(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=rT.FIRST_PARTY}var BT=(jT.prototype.getToken=function(){return Promise.resolve(new qT(this.gapi,this.sessionIndex))},jT.prototype.setChangeListener=function(t){t(rT.FIRST_PARTY)},jT.prototype.removeChangeListener=function(){},jT.prototype.invalidateToken=function(){},jT);function jT(t,e){this.gapi=t,this.sessionIndex=e}function WT(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var KT=(QT.delete=function(){return Qd("FieldValue.delete",arguments),GT.instance},QT.serverTimestamp=function(){return Qd("FieldValue.serverTimestamp",arguments),XT.instance},QT.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Gd("FieldValue.arrayUnion",arguments,1),new ZT(t)},QT.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Gd("FieldValue.arrayRemove",arguments,1),new nS(t)},QT.increment=function(t){return Yd("FieldValue.increment","number",1,t),Hd("FieldValue.increment",arguments,1),new oS(t)},QT.prototype.isEqual=function(t){return this===t},QT);function QT(t){this._methodName=t}var HT,GT=(ii(zT,HT=KT),zT.instance=new zT,zT);function zT(){return HT.call(this,"FieldValue.delete")||this}var YT,XT=(ii(JT,YT=KT),JT.instance=new JT,JT);function JT(){return YT.call(this,"FieldValue.serverTimestamp")||this}var $T,ZT=(ii(tS,$T=KT),tS);function tS(t){var e=$T.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var eS,nS=(ii(rS,eS=KT),rS);function rS(t){var e=eS.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var iS,oS=(ii(aS,iS=KT),aS);function aS(t){var e=iS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var sS=qd(KT,"Use FieldValue.<field>() instead."),uS=/^__.*__$/,cS=(hS.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new rw(t,this.data,this.fieldMask,e)):n.push(new tw(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new aw(t,this.fieldTransforms)),n},hS);function hS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var lS,fS,pS=(dS.prototype.toMutations=function(t,e){var n=[new rw(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new aw(t,this.fieldTransforms)),n},dS);function dS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function yS(t){switch(t){case lS.Set:case lS.MergeSet:case lS.Update:return!0;case lS.Argument:return!1;default:throw Dd("Unexpected case for UserDataSource: "+t)}}(fS=lS=lS||{})[fS.Set=0]="Set",fS[fS.Update=1]="Update",fS[fS.MergeSet=2]="MergeSet",fS[fS.Argument=3]="Argument";var mS=(vS.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new vS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},vS.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new vS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},vS.prototype.childContextForArray=function(t){return new vS(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},vS.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Fd(Ld.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},vS.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},vS.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},vS.prototype.validatePathSegment=function(t){if(yS(this.dataSource)&&uS.test(t))throw this.createError("Document fields cannot begin and end with __")},vS);function vS(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var gS=function(t,e){this.databaseId=t,this.key=e},bS=(wS.prototype.parseSetData=function(t,e){var n=new mS(lS.Set,t,Py.EMPTY_PATH);ES("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new cS(r,null,n.fieldTransforms)},wS.prototype.parseMergeData=function(t,e,n){var r=new mS(lS.MergeSet,t,Py.EMPTY_PATH);ES("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new hm(Py.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof RT)l=h._internalPath;else{if("string"!=typeof h)throw Dd("Expected stringOrFieldPath to be a string or a FieldPath");l=SS(t,h)}if(!r.contains(l))throw new Fd(Ld.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=jb.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=jb.fromArray(r.fieldMask),o=r.fieldTransforms;return new cS(a,i,o)},wS.prototype.parseUpdateData=function(o,t){var a=this,s=new mS(lS.Update,o,Py.EMPTY_PATH);ES("Data must be an object, but it was:",s,t);var u=new hm(Py.comparator),c=Fb.EMPTY;Wd(t,function(t,e){var n=SS(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof GT)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=jb.fromSet(u);return new pS(c,e,s.fieldTransforms)},wS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new mS(lS.Update,t,Py.EMPTY_PATH),o=[TS(t,e)],a=[n];if(r.length%2!=0)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(TS(t,r[s])),a.push(r[s+1]);var u=new hm(Py.comparator),c=Fb.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof GT)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=jb.fromSet(u);return new pS(c,d,i.fieldTransforms)},wS.prototype.parseQueryValue=function(t,e){var n=new mS(lS.Argument,t,Py.EMPTY_PATH),r=this.parseData(e,n);return Rd(null!=r,"Parsed data should not be null."),Rd(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},wS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=IS(t);throw e.createError(n)}},wS.prototype.parseData=function(t,e){if(_S(t=this.runPreConverter(t,e)))return ES("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof KT)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},wS.prototype.parseObject=function(t,r){var i=this,o=new nm(ly);return Kd(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Wd(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new Fb(o)},wS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=rb.INSTANCE),n.push(s),r++}return new Vb(n)},wS.prototype.parseSentinelFieldValue=function(t,e){if(!yS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof GT){if(e.dataSource!==lS.MergeSet)throw e.dataSource===lS.Update?(Rd(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof XT)e.fieldTransforms.push(new Kb(e.path,_E.instance));else if(t instanceof ZT){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new TE(n);e.fieldTransforms.push(new Kb(e.path,r))}else if(t instanceof nS){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new IE(n);e.fieldTransforms.push(new Kb(e.path,i))}else if(t instanceof oS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new NE(o);e.fieldTransforms.push(new Kb(e.path,a))}else Dd("Unknown FieldValue type: "+t)},wS.prototype.parseScalarValue=function(t,e){if(null===t)return rb.INSTANCE;if("number"==typeof t)return Vw(t)?new pb(t):new mb(t);if("boolean"==typeof t)return ab.of(t);if("string"==typeof t)return new bb(t);if(t instanceof Date)return new Eb($y.fromDate(t));if(t instanceof $y)return new Eb(new $y(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof j_)return new xb(t);if(t instanceof my)return new Ab(t);if(t instanceof gS)return new Rb(t.databaseId,t.key);throw e.createError("Unsupported field value: "+ry(t))},wS.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new mS(lS.Argument,r,Py.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},wS);function wS(t){this.preConverter=t}function _S(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $y||t instanceof j_||t instanceof my||t instanceof gS||t instanceof KT)}function ES(t,e,n){if(!_S(n)||!ny(n)){var r=ry(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function TS(t,e){if(e instanceof RT)return e._internalPath;if("string"==typeof e)return SS(t,e);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function SS(e,t){try{return function(e){if(0<=e.search(PT))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(RT.bind.apply(RT,[void 0].concat(e.split("."))))}catch(t){throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=IS(t);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function IS(t){return t instanceof Error?t.message:t.toString()}var CS=Ag.COLLECTION_DISABLED,NS=(AS.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},AS);function AS(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Fd(Ld.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Jd("settings","non-empty string","host",t.host),this.host=t.host,$d("settings","boolean","ssl",t.ssl),this.ssl=Bd(t.ssl,!0);if(oy("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),$d("settings","object","credentials",t.credentials),this.credentials=t.credentials,$d("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Ad("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Ad("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Bd(t.timestampsInSnapshots,!0),$d("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ag.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==CS&&t.cacheSizeBytes<Ag.MINIMUM_CACHE_SIZE_BYTES)throw new Fd(Ld.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ag.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}$d("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var kS=(DS.prototype.settings=function(t){if(Hd("Firestore.settings",arguments,1),Yd("Firestore.settings","object",1,t),Vd(t,"persistence"))throw new Fd(Ld.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new NS(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Fd(Ld.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new MT;switch(t.type){case"gapi":var e=t.client;return Rd(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new BT(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Fd(Ld.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},DS.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},DS.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},DS.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Fd(Ld.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Ad("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Bd(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new ST(this._settings.cacheSizeBytes,e))},DS.prototype.clearPersistence=function(){var t=this,n=Vg.buildStoragePrefix(this.makeDatabaseInfo()),r=new qy;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new Fd(Ld.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Vg.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},DS.prototype._shutdown=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(DS.prototype,"_isShutdown",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientShutdown},enumerable:!0,configurable:!0}),DS.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new CT),this._firestoreClient},DS.prototype.makeDatabaseInfo=function(){return new by(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},DS.prototype.configureClient=function(t){Rd(!!this._settings.host,"FirestoreSettings.host is not set"),Rd(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new NT(Od.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},DS.prototype.createDataConverter=function(r){return new bS(function(t){if(t instanceof MS){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new Fd(Ld.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new gS(r,t._key)}return t})},DS.databaseIdFromApp=function(t){var e=t.options;if(!Vd(e,"projectId"))throw new Fd(Ld.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Fd(Ld.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new _y(n)},Object.defineProperty(DS.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Fd(Ld.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),DS.prototype.collection=function(t){return Hd("Firestore.collection",arguments,1),Yd("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new YS(ky.fromString(t),this)},DS.prototype.doc=function(t){return Hd("Firestore.doc",arguments,1),Yd("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),MS.forPath(ky.fromString(t),this)},DS.prototype.collectionGroup=function(t){if(Hd("Firestore.collectionGroup",arguments,1),Yd("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new KS(new K_(ky.EMPTY_PATH,t),this)},DS.prototype.runTransaction=function(e){var n=this;return Hd("Firestore.runTransaction",arguments,1),Yd("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new RS(n,t))})},DS.prototype.batch=function(){return this.ensureClientConfigured(),new PS(this)},Object.defineProperty(DS,"logLevel",{get:function(){switch(Id()){case yd.DEBUG:return"debug";case yd.ERROR:return"error";case yd.SILENT:return"silent";default:return Dd("Unknown log level: "+Id())}},enumerable:!0,configurable:!0}),DS.setLogLevel=function(t){switch(Hd("Firestore.setLogLevel",arguments,1),Yd("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Cd(yd.DEBUG);break;case"error":Cd(yd.ERROR);break;case"silent":Cd(yd.SILENT);break;default:throw new Fd(Ld.INVALID_ARGUMENT,"Invalid log level: "+t)}},DS.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},DS);function DS(t){var e=this;if(this._firebaseApp=null,this._queue=new jy,this.INTERNAL={delete:function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=DS.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new FT(n)}else{var r=t;if(!r.projectId)throw new Fd(Ld.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new _y(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new MT}this._settings=new NS({}),this._dataConverter=this.createDataConverter(this._databaseId)}var RS=(OS.prototype.get=function(t){var n=this;Hd("Transaction.get",arguments,1);var r=tI("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Dd("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof pv)return new qS(n._firestore,r._key,null,!1,!1);if(e instanceof hv)return new qS(n._firestore,r._key,e,!1,!1);throw Dd("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},OS.prototype.set=function(t,e,n){zd("Transaction.set",arguments,2,3);var r=tI("Transaction.set",t,this._firestore),i=(n=JS("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},OS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof RT?(Gd("Transaction.update",arguments,3),r=tI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Hd("Transaction.update",arguments,2),r=tI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},OS.prototype.delete=function(t){Hd("Transaction.delete",arguments,1);var e=tI("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},OS);function OS(t,e){this._firestore=t,this._transaction=e}var PS=(xS.prototype.set=function(t,e,n){zd("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=tI("WriteBatch.set",t,this._firestore),i=(n=JS("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Yb.NONE)),this},xS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof RT?(Gd("WriteBatch.update",arguments,3),r=tI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Hd("WriteBatch.update",arguments,2),r=tI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Yb.exists(!0))),this},xS.prototype.delete=function(t){Hd("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=tI("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new cw(e._key,Yb.NONE)),this},xS.prototype.commit=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},xS.prototype.verifyNotCommitted=function(){if(this._committed)throw new Fd(Ld.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},xS);function xS(t){this._firestore=t,this._mutations=[],this._committed=!1}var MS=(LS.forPath=function(t,e){if(t.length%2!=0)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new LS(new My(t),e)},Object.defineProperty(LS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(LS.prototype,"parent",{get:function(){return new YS(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(LS.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),LS.prototype.collection=function(t){if(Hd("DocumentReference.collection",arguments,1),Yd("DocumentReference.collection","non-empty string",1,t),!t)throw new Fd(Ld.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ky.fromString(t);return new YS(this._key.path.child(e),this.firestore)},LS.prototype.isEqual=function(t){if(!(t instanceof LS))throw ay("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},LS.prototype.set=function(t,e){zd("DocumentReference.set",arguments,1,2);var n=(e=JS("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Yb.NONE))},LS.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof RT?(Gd("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Hd("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Yb.exists(!0)))},LS.prototype.delete=function(){return Hd("DocumentReference.delete",arguments,0),this._firestoreClient.write([new cw(this._key,Yb.NONE)])},LS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zd("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||WT(t[i])||(oy("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),$d("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=WT(t[i])?t[i]:(Yd("DocumentReference.onSnapshot","function",i,t[i]),Xd("DocumentReference.onSnapshot","function",i+1,t[i+1]),Xd("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},LS.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new kT({next:function(t){if(n.next){Rd(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new qS(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(K_.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},LS.prototype.get=function(n){var r=this;return zd("DocumentReference.get",arguments,0,1),ZS("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new qS(r.firestore,r._key,t,!0,t instanceof hv&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},LS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Fd(Ld.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Fd(Ld.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},LS);function LS(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var FS=(US.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},US);function US(t,e){this.hasPendingWrites=t,this.fromCache=e}var qS=(VS.prototype.data=function(t){return zd("DocumentSnapshot.data",arguments,0,1),t=$S("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,$g.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},VS.prototype.get=function(t,e){if(zd("DocumentSnapshot.get",arguments,1,2),e=$S("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(TS("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,$g.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(VS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"ref",{get:function(){return new MS(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"metadata",{get:function(){return new FS(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),VS.prototype.isEqual=function(t){if(!(t instanceof VS))throw ay("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},VS.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},VS.prototype.convertValue=function(t,e){if(t instanceof Fb)return this.convertObject(t,e);if(t instanceof Vb)return this.convertArray(t,e);if(t instanceof Rb){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Ad("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new MS(n,this._firestore)}return t.value(e)},VS.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},VS);function VS(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var BS,jS=(ii(WS,BS=qS),WS.prototype.data=function(t){var e=BS.prototype.data.call(this,t);return Rd("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},WS);function WS(){return null!==BS&&BS.apply(this,arguments)||this}var KS=(QS.prototype.where=function(t,e,n){Hd("Query.where",arguments,3),iy("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid value "+ry(r)+" provided to function "+t+"() for its "+sy(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e);var r,i=TS("Query.where",t),o=G_.fromString(e);if(i.isKeyField()){if(o===G_.ARRAY_CONTAINS||o===G_.ARRAY_CONTAINS_ANY)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===G_.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Vb(a)}else r=this.parseDocumentIdValue(n)}else o!==G_.IN&&o!==G_.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=X_.create(i,o,r);return this.validateNewFilter(h),new QS(this._query.addFilter(h),this.firestore)},QS.prototype.orderBy=function(t,e){var n;if(zd("Query.orderBy",arguments,1,2),Xd("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=pE.ASCENDING;else{if("desc"!==e)throw new Fd(Ld.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=pE.DESCENDING}if(null!==this._query.startAt)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=TS("Query.orderBy",t),i=new vE(r,n);return this.validateNewOrderBy(i),new QS(this._query.addOrderBy(i),this.firestore)},QS.prototype.limit=function(t){if(Hd("Query.limit",arguments,1),Yd("Query.limit","number",1,t),t<=0)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new QS(this._query.withLimit(t),this.firestore)},QS.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new QS(this._query.withStartAt(r),this.firestore)},QS.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new QS(this._query.withStartAt(r),this.firestore)},QS.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new QS(this._query.withEndAt(r),this.firestore)},QS.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new QS(this._query.withEndAt(r),this.firestore)},QS.prototype.isEqual=function(t){if(!(t instanceof QS))throw ay("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},QS.prototype.boundFromDocOrFields=function(t,e,n,r){if(iy(t,1,e),e instanceof qS){if(0<n.length)throw new Fd(Ld.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Fd(Ld.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},QS.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Rb(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Ib)throw new Fd(Ld.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new yE(r,n)},QS.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Fd(Ld.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(ky.fromString(a));if(!My.isDocumentKey(s))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new My(s);i.push(new Rb(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new yE(i,n)},QS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zd("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||WT(t[i])||(oy("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),$d("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=WT(t[i])?t[i]:(Yd("Query.onSnapshot","function",i,t[i]),Xd("Query.onSnapshot","function",i+1,t[i+1]),Xd("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},QS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new kT({next:function(t){e.next&&e.next(new HS(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},QS.prototype.get=function(n){var r=this;return zd("Query.get",arguments,0,1),ZS("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new HS(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},QS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Fd(Ld.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},QS.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(ky.fromString(t));if(!My.isDocumentKey(e))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Rb(this.firestore._databaseId,new My(e))}if(t instanceof MS){var n=t;return new Rb(this.firestore._databaseId,n._key)}throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ry(t)+".")},QS.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},QS.prototype.validateNewFilter=function(t){if(t instanceof X_){var e=[G_.ARRAY_CONTAINS,G_.ARRAY_CONTAINS_ANY],n=[G_.IN,G_.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},QS.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},QS.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},QS);function QS(t,e){this._query=t,this.firestore=e}var HS=(Object.defineProperty(GS.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),GS.prototype.forEach=function(e,n){var r=this;zd("QuerySnapshot.forEach",arguments,1,2),Yd("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(GS.prototype,"query",{get:function(){return new KS(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),GS.prototype.docChanges=function(t){t&&(oy("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),$d("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Fd(Ld.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new jS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Rd(t.type===d_.Added,"Invalid event type for first snapshot"),Rd(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==d_.Metadata}).map(function(t){var e=new jS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==d_.Added&&(Rd(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==d_.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case d_.Added:return"added";case d_.Modified:case d_.Metadata:return"modified";case d_.Removed:return"removed";default:return Dd("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},GS.prototype.isEqual=function(t){if(!(t instanceof GS))throw ay("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},GS.prototype.convertToDocumentImpl=function(t){return new jS(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},GS);function GS(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new FS(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(HS.prototype.docChanges,t,{get:function(){return function(){throw new Fd(Ld.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var zS,YS=(ii(XS,zS=KS),Object.defineProperty(XS.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(XS.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new MS(new My(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(XS.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),XS.prototype.doc=function(t){if(zd("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=cy.newId()),Yd("CollectionReference.doc","non-empty string",1,t),""===t)throw new Fd(Ld.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=ky.fromString(t);return MS.forPath(this._query.path.child(e),this.firestore)},XS.prototype.add=function(t){Hd("CollectionReference.add",arguments,1),Yd("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},XS);function XS(t,e){var n=zS.call(this,K_.atPath(t),e)||this;if(t.length%2!=1)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function JS(t,e){if(void 0===e)return{merge:!1};if(oy(t,e,["merge","mergeFields"]),$d(t,"boolean","merge",e.merge),Zd(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof RT}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function $S(t,e){return void 0===e?{}:(oy(t,e,["serverTimestamps"]),ty(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ZS(t,e){Xd(t,"object",1,e),e&&(oy(t,e,["source"]),ty(t,0,"source",e.source,["default","server","cache"]))}function tI(t,e,n){if(e instanceof MS){if(e.firestore!==n)throw new Fd(Ld.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw ay(t,"DocumentReference",1,e)}var eI=qd(kS,"Use firebase.firestore() instead."),nI=qd(RS,"Use firebase.firestore().runTransaction() instead."),rI=qd(PS,"Use firebase.firestore().batch() instead."),iI=qd(MS,"Use firebase.firestore().doc() instead."),oI=qd(qS),aI=qd(jS),sI=qd(KS),uI=qd(HS),cI=qd(YS,"Use firebase.firestore().collection() instead."),hI={Firestore:eI,GeoPoint:j_,Timestamp:$y,Blob:gy,Transaction:nI,WriteBatch:rI,DocumentReference:iI,DocumentSnapshot:oI,Query:sI,QueryDocumentSnapshot:aI,QuerySnapshot:uI,CollectionReference:cI,FieldPath:RT,FieldValue:sS,setLogLevel:kS.setLogLevel,CACHE_SIZE_UNLIMITED:CS};function lI(t){t.INTERNAL.registerService("firestore",function(t){return new kS(t)},function(t){Rd(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(hI))}var fI=(pI.prototype.addCallback=function(t){},pI.prototype.shutdown=function(){},pI);function pI(){}var dI="ConnectivityMonitor",yI=(mI.prototype.addCallback=function(t){this.callbacks.push(t)},mI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},mI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},mI.prototype.onNetworkAvailable=function(){Nd(dI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},mI.prototype.onNetworkUnavailable=function(){Nd(dI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},mI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},mI);function mI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var vI=(gI.prototype.onOpen=function(t){Rd(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},gI.prototype.onClose=function(t){Rd(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},gI.prototype.onMessage=function(t){Rd(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},gI.prototype.close=function(){this.closeFn()},gI.prototype.send=function(t){this.sendFn(t)},gI.prototype.callOnOpen=function(){Rd(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},gI.prototype.callOnClose=function(t){Rd(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},gI.prototype.callOnMessage=function(t){Rd(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},gI);function gI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var bI="Connection",wI={BatchGetDocuments:"batchGet",Commit:"commit"},_I="gl-js/ fire/"+Td,EI=(TI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=_I},TI.prototype.invokeRPC=function(s,n,r){var u=this,c=this.makeUrl(s);return new Promise(function(i,o){var a=new Ed;a.listenOnce(wd.COMPLETE,function(){try{switch(a.getLastErrorCode()){case bd.NO_ERROR:var t=a.getResponseJson();Nd(bI,"XHR received:",JSON.stringify(t)),i(t);break;case bd.TIMEOUT:Nd(bI,'RPC "'+s+'" timed out'),o(new Fd(Ld.DEADLINE_EXCEEDED,"Request time out"));break;case bd.HTTP_ERROR:var e=a.getStatus();if(Nd(bI,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Ld).indexOf(e)?e:Ld.UNKNOWN}(n.status);o(new Fd(r,n.message))}else o(new Fd(Ld.UNKNOWN,"Server responded with status "+a.getStatus()))}else Nd(bI,'RPC "'+s+'" failed'),o(new Fd(Ld.UNAVAILABLE,"Connection failed."));break;default:Dd('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Nd(bI,'RPC "'+s+'" completed.')}});var t=JSON.stringify(n);Nd(bI,"XHR sending: ",c+" "+t);var e={"Content-Type":"text/plain"};u.modifyHeadersForRequest(e,r),a.send(c,"POST",t,e,15)})},TI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},TI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=gd(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ti()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Nd(bI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new vI({sendFn:function(t){c?Nd(bI,"Not sending because WebChannel is closed:",t):(u||(Nd(bI,"Opening WebChannel transport."),s.open(),u=!0),Nd(bI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(_d.EventType.OPEN,function(){c||Nd(bI,"WebChannel transport opened.")}),a(_d.EventType.CLOSE,function(){c||(c=!0,Nd(bI,"WebChannel transport closed"),h.callOnClose())}),a(_d.EventType.ERROR,function(t){c||(c=!0,Nd(bI,"WebChannel transport errored:",t),h.callOnClose(new Fd(Ld.UNAVAILABLE,"The operation could not be completed")))}),a(_d.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Rd(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Nd(bI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=u_[t];if(void 0!==e)return p_(e)}(i),a=r.message;void 0===o&&(o=Ld.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Fd(o,a)),s.close()}else Nd(bI,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},TI.prototype.makeUrl=function(t){var e=wI[t];Rd(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},TI);function TI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var SI=(Object.defineProperty(II.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(II.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),II.prototype.loadConnection=function(t){return Promise.resolve(new EI(t))},II.prototype.newConnectivityMonitor=function(){return yI.isAvailable()?new yI:new fI},II.prototype.newSerializer=function(t){return new qE(t,{useProto3Json:!0})},II.prototype.formatJSON=function(t){return JSON.stringify(t)},II.prototype.atob=function(t){return atob(t)},II.prototype.btoa=function(t){return btoa(t)},II);function II(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Od.setPlatform(new SI),lI(il);var CI,NI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},AI=(ii(kI,CI=Error),kI);function kI(t,e,n){var r=CI.call(this,e)||this;return Object.setPrototypeOf(r,kI.prototype),r.code=t,r.details=n,r}var DI=(RI.prototype.getAuthToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},RI.prototype.getInstanceIdToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},RI.prototype.getContext=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},RI);function RI(t){this.app=t}function OI(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var PI=(xI.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return OI(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},xI.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?OI(t,function(t){return e.decode(t)}):t},xI);function xI(){}var MI=(Object.defineProperty(LI.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),LI.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},LI.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},LI.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},LI.prototype.postJSON=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},LI.prototype.call=function(c,h,l){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new AI("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new AI("cancelled","Firebase Functions instance was deleted.");if(s=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!NI[s])return new AI("internal","internal");r=NI[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new AI(r,i,o)}(a.status,a.json,this.serializer))throw s;if(!a.json)throw new AI("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new AI("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},LI);function LI(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new PI,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new DI(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var FI,UI;function qI(t,e,n){return new MI(t,n)}FI={Functions:MI},il.INTERNAL.registerService("functions",qI,FI,void 0,!0);var VI,BI,jI,WI,KI=((UI={})["only-available-in-window"]="This method is available in a Window context.",UI["only-available-in-sw"]="This method is available in a service worker context.",UI["should-be-overriden"]="This method should be overriden by extended classes.",UI["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",UI["permission-default"]="The required permissions were not granted and dismissed instead.",UI["permission-blocked"]="The required permissions were not granted and blocked instead.",UI["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",UI["notifications-blocked"]="Notifications have been blocked.",UI["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",UI["sw-registration-expected"]="A service worker registration was the expected input.",UI["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",UI["invalid-saved-token"]="Unable to access details of the saved token.",UI["sw-reg-redundant"]="The service worker being used for push was made redundant.",UI["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",UI["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",UI["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",UI["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",UI["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",UI["token-update-no-token"]="FCM returned no token when updating the user to push.",UI["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",UI["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",UI["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",UI["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",UI["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",UI["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",UI["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",UI["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",UI["failed-to-delete-token"]="Unable to delete the currently saved token.",UI["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",UI["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",UI["bad-scope"]="The service worker scope must be a string with at least one character.",UI["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",UI["bad-subscription"]="The subscription must be a valid PushSubscription.",UI["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",UI["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",UI["failed-delete-vapid-key"]="The VAPID key could not be deleted.",UI["invalid-public-vapid-key"]="The public VAPID key must be a string.",UI["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",UI["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",UI),QI=new Ai("messaging","Messaging",KI),HI=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),GI="https://fcm.googleapis.com";function zI(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function YI(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,hi(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(BI=VI=VI||{}).TYPE_OF_MSG="firebase-messaging-msg-type",BI.DATA="firebase-messaging-msg-data",(WI=jI=jI||{}).PUSH_MSG_RECEIVED="push-msg-received",WI.NOTIFICATION_CLICKED="notification-clicked";var XI=(JI.prototype.getToken=function(h,l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=YI(l.getKey("p256dh")),n=YI(l.getKey("auth")),r="authorized_entity="+h+"&endpoint="+l.endpoint+"&encryption_key="+e+"&encryption_auth="+n,zI(f.buffer,HI.buffer)||(i=YI(f),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(GI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),QI.create("token-subscribe-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,QI.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw QI.create("token-subscribe-no-token");if(!s.pushSet)throw QI.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},JI.prototype.updateToken=function(h,l,f,p,d){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=YI(p.getKey("p256dh")),n=YI(p.getKey("auth")),r="push_set="+f+"&token="+l+"&authorized_entity="+h+"&endpoint="+p.endpoint+"&encryption_key="+e+"&encryption_auth="+n,zI(d.buffer,HI.buffer)||(i=YI(d),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(GI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),QI.create("token-update-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,QI.create("token-update-failed",{errorInfo:c});if(!s.token)throw QI.create("token-update-no-token");return[2,s.token]}})})},JI.prototype.deleteToken=function(s,u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:e="authorized_entity="+s+"&token="+u+"&pushSet="+c,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(GI+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,QI.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw a=t.sent(),QI.create("token-unsubscribe-failed",{errorInfo:a});case 5:return[2]}})})},JI);function JI(){}function $I(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var ZI="undefined",tC="fcm_token_object_Store";function eC(){var e=indexedDB.open(ZI);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(tC)){var t=n.transaction(tC).objectStore(tC),r=new XI,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(ZI)}}}(e.result)}}var nC=(rC.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},rC.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},rC.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},rC.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},rC.prototype.closeDatabase=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},rC.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},rC.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},rC);function rC(){this.dbPromise=null}var iC,oC=(ii(aC,iC=nC),aC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:eC();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=oi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=$I(e.vapidKey)),"string"==typeof e.auth&&(n.auth=$I(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=$I(e.p256dh).buffer),t.update(n),t.continue()}}}},aC.prototype.getTokenDetailsFromToken=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw QI.create("bad-token");return sC({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},aC.prototype.getTokenDetailsFromSWScope=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw QI.create("bad-scope");return sC({swScope:e}),[2,this.get(e)]})})},aC.prototype.saveTokenDetails=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e.swScope)throw QI.create("bad-scope");if(!e.vapidKey)throw QI.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw QI.create("bad-subscription");if(!e.fcmSenderId)throw QI.create("bad-sender-id");if(!e.fcmToken)throw QI.create("bad-token");if(!e.fcmPushSet)throw QI.create("bad-push-set");return sC(e),[2,this.put(e)]})})},aC.prototype.deleteToken=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(QI.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw QI.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},aC);function aC(){var t=null!==iC&&iC.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function sC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw QI.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw QI.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw QI.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw QI.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw QI.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw QI.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw QI.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw QI.create("bad-push-set")}var uC,cC=(ii(hC,uC=nC),hC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},hC.prototype.getVapidFromSWScope=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw QI.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},hC.prototype.saveVapidDetails=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){if("string"!=typeof n||0===n.length)throw QI.create("bad-scope");if(null===r||65!==r.length)throw QI.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},hC.prototype.deleteVapidDetails=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw QI.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},hC);function hC(){var t=null!==uC&&uC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var lC="messagingSenderId",fC=(pC.prototype.getToken=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw QI.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},pC.prototype.manageExistingToken=function(e,n,r,i){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!zI(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=zI(t.getKey("auth"),n.auth),o=zI(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},pC.prototype.updateToken=function(i,o,a,s){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},pC.prototype.getNewToken=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},pC.prototype.deleteToken=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},pC.prototype.deleteTokenFromDB=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},pC.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},pC.prototype.requestPermission=function(){throw QI.create("only-available-in-window")},pC.prototype.useServiceWorker=function(t){throw QI.create("only-available-in-window")},pC.prototype.usePublicVapidKey=function(t){throw QI.create("only-available-in-window")},pC.prototype.onMessage=function(t,e,n){throw QI.create("only-available-in-window")},pC.prototype.onTokenRefresh=function(t,e,n){throw QI.create("only-available-in-window")},pC.prototype.setBackgroundMessageHandler=function(t){throw QI.create("only-available-in-sw")},pC.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},pC.prototype.getNotificationPermission_=function(){return Notification.permission},pC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},pC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},pC.prototype.getIidModel=function(){return this.iidModel},pC);function pC(t){var e=this;if(!t.options[lC]||"string"!=typeof t.options[lC])throw QI.create("bad-sender-id");this.messagingSenderId=t.options[lC],this.tokenDetailsModel=new oC,this.vapidDetailsModel=new cC,this.iidModel=new XI,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var dC,yC="FCM_MSG",mC=(ii(vC,dC=fC),vC.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},vC.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},vC.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},vC.prototype.onPush_=function(s){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},vC.prototype.onSubChange_=function(t){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),QI.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},vC.prototype.onNotificationClick_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[yC]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[yC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=bC(jI.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},vC.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oi({},t.notification);return n.data=oi({},t.notification.data,((e={})[yC]=t,e)),n}},vC.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw QI.create("bg-handler-function-expected");this.bgMessageHandler=t},vC.prototype.getWindowClient_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,gC()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},vC.prototype.attemptToMessageClient_=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw QI.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},vC.prototype.hasVisibleClients_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,gC()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},vC.prototype.sendMessageToWindowClients_=function(i){return ai(this,void 0,void 0,function(){var e,n,r=this;return si(this,function(t){switch(t.label){case 0:return[4,gC()];case 1:return e=t.sent(),n=bC(jI.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},vC.prototype.getSWRegistration_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,self.registration]})})},vC.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw QI.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,HI]:[2,n]}})})},vC);function vC(t){var e=dC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function gC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function bC(t,e){var n;return(n={})[VI.TYPE_OF_MSG]=t,n[VI.DATA]=e,n}var wC,_C,EC=(ii(TC,wC=fC),TC.prototype.getToken=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),[3,5];case 4:return t.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw QI.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,wC.prototype.getToken.call(this)]}})})},TC.prototype.requestPermission=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?QI.create("permission-blocked"):QI.create("permission-default")}})})},TC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw QI.create("sw-registration-expected");if(null!=this.registrationToUse)throw QI.create("use-sw-before-get-token");this.registrationToUse=t},TC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw QI.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw QI.create("use-public-key-before-get-token");var e=$I(t);if(65!==e.length)throw QI.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},TC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},TC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},TC.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(QI.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(QI.create("sw-reg-redundant"));else t(r);else e(QI.create("no-sw-in-reg"))})},TC.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw QI.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},TC.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,HI]})})},TC.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[VI.TYPE_OF_MSG]){var e=t.data;switch(e[VI.TYPE_OF_MSG]){case jI.PUSH_MSG_RECEIVED:case jI.NOTIFICATION_CLICKED:var n=e[VI.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},TC);function TC(t){var e=wC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Vi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Vi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function SC(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}_C={isSupported:SC},il.INTERNAL.registerService("messaging",function(t){if(!SC())throw QI.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new mC(t):new EC(t)},_C);var IC="firebasestorage.googleapis.com",CC="storageBucket",NC=(AC.prototype.codeProp=function(){return this.code},AC.prototype.codeEquals=function(t){return DC(t)===this.codeProp()},AC.prototype.serverResponseProp=function(){return this.serverResponse_},AC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(AC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(AC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(AC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(AC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),AC);function AC(t,e){this.code_=DC(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var kC={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function DC(t){return"storage/"+t}function RC(){return new NC(kC.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function OC(){return new NC(kC.CANCELED,"User canceled the upload/download.")}function PC(){return new NC(kC.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function xC(t,e,n){return new NC(kC.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function MC(){return new NC(kC.APP_DELETED,"The Firebase app was deleted.")}function LC(t,e){return new NC(kC.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function FC(t){throw new NC(kC.INTERNAL_ERROR,"Internal error: "+t)}var UC={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function qC(t){switch(t){case UC.RAW:case UC.BASE64:case UC.BASE64URL:case UC.DATA_URL:return;default:throw"Expected one of the event types: ["+UC.RAW+", "+UC.BASE64+", "+UC.BASE64URL+", "+UC.DATA_URL+"]."}}var VC=function(t,e){this.data=t,this.contentType=e||null};function BC(t,e){switch(t){case UC.RAW:return new VC(jC(e));case UC.BASE64:case UC.BASE64URL:return new VC(WC(t,e));case UC.DATA_URL:return new VC(function(t){var e=new KC(t);return e.base64?WC(UC.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw LC(UC.DATA_URL,"Malformed data URL.")}return jC(e)}(e.rest)}(e),function(t){return new KC(t).contentType}(e))}throw RC()}function jC(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function WC(e,t){switch(e){case UC.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw LC(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case UC.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw LC(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw LC(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var KC=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw LC(UC.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var QC,HC,GC={STATE_CHANGED:"state_changed"},zC="running",YC="pausing",XC="paused",JC="success",$C="canceling",ZC="canceled",tN="error",eN={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function nN(t){switch(t){case zC:case YC:case $C:return eN.RUNNING;case XC:return eN.PAUSED;case JC:return eN.SUCCESS;case ZC:return eN.CANCELED;case tN:default:return eN.ERROR}}function rN(t){return null!=t}function iN(t){return void 0!==t}function oN(t){return"function"==typeof t}function aN(t){return"object"==typeof t}function sN(t){return"string"==typeof t||t instanceof String}function uN(t){return"number"==typeof t||t instanceof Number}function cN(t){return hN()&&t instanceof Blob}function hN(){return"undefined"!=typeof Blob}(HC=QC=QC||{})[HC.NO_ERROR=0]="NO_ERROR",HC[HC.NETWORK_ERROR=1]="NETWORK_ERROR",HC[HC.ABORT=2]="ABORT";var lN=(fN.prototype.send=function(t,e,n,r){if(this.sent_)throw FC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),rN(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return rN(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},fN.prototype.getErrorCode=function(){if(!this.sent_)throw FC("cannot .getErrorCode() before sending");return this.errorCode_},fN.prototype.getStatus=function(){if(!this.sent_)throw FC("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},fN.prototype.getResponseText=function(){if(!this.sent_)throw FC("cannot .getResponseText() before sending");return this.xhr_.responseText},fN.prototype.abort=function(){this.xhr_.abort()},fN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},fN.prototype.addUploadProgressListener=function(t){rN(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},fN.prototype.removeUploadProgressListener=function(t){rN(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},fN);function fN(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=QC.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=QC.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=QC.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var pN=(dN.prototype.createXhrIo=function(){return new lN},dN);function dN(){}function yN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(hN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var mN=(vN.prototype.size=function(){return this.size_},vN.prototype.type=function(){return this.type_},vN.prototype.slice=function(t,e){if(cN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new vN(n)}return new vN(new Uint8Array(this.data_.buffer,t,e-t),!0)},vN.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(hN()){var n=t.map(function(t){return t instanceof vN?t.data_:t});return new vN(yN.apply(null,n))}var r=t.map(function(t){return sN(t)?BC(UC.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new vN(o,!0)},vN.prototype.uploadData=function(){return this.data_},vN);function vN(t,e){var n=0,r="";cN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var gN=(Object.defineProperty(bN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(bN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),bN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},bN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},bN.makeFromBucketSpec=function(e){var t;try{t=bN.makeFromUrl(e)}catch(t){return new bN(e,"")}if(""===t.path)return t;throw function(t){return new NC(kC.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},bN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=IC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new bN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new NC(kC.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},bN);function bN(t,e){this.bucket=t,this.path_=e}function wN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return aN(t)&&!Array.isArray(t)}(e)?e:null}function _N(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function EN(t){return"https://"+IC+"/v0"+t}function TN(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function SN(t,e){return e}var IN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||SN},CN=null;function NN(){if(CN)return CN;var t=[];t.push(new IN("bucket")),t.push(new IN("generation")),t.push(new IN("metageneration")),t.push(new IN("name","fullPath",!0));var e=new IN("name");e.xform=function(t,e){return function(t){return!sN(t)||t.length<2?t:_N(t)}(e)},t.push(e);var n=new IN("size");return n.xform=function(t,e){return rN(e)?Number(e):e},t.push(n),t.push(new IN("timeCreated")),t.push(new IN("updated")),t.push(new IN("md5Hash",null,!0)),t.push(new IN("cacheControl",null,!0)),t.push(new IN("contentDisposition",null,!0)),t.push(new IN("contentEncoding",null,!0)),t.push(new IN("contentLanguage",null,!0)),t.push(new IN("contentType",null,!0)),t.push(new IN("metadata","customMetadata",!0)),CN=t}function AN(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new gN(t,e);return i.makeStorageReference(n)}})}(r,t),r}function kN(t,e,n){var r=wN(e);return null===r?null:AN(t,r,n)}function DN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function RN(t){if(!aN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!aN(n))throw"Expected object for 'customMetadata' mapping."}else if(aN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var ON="maxResults",PN=1e3,xN="pageToken",MN="prefixes",LN="items";function FN(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new NC(kC.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+CC+"' property when initializing the app?");if(e[MN])for(var i=0,o=e[MN];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new gN(r,a));n.prefixes.push(s)}if(e[LN])for(var u=0,c=e[LN];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new gN(r,h.name));n.items.push(s)}return n}function UN(t){if(!aN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===ON){if(!uN(n=t[ON])||!Number.isInteger(n)||t[ON]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[ON])throw"Expected maxResults to be less than or equal to "+PN+"."}else{if(e!==xN)throw"Unknown option: "+e;if(t[xN]&&!sN(t[xN]))throw"Expected pageToken to be string."}var n}var qN=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function VN(t){if(!t)throw RC()}function BN(r,i){return function(t,e){var n=kN(r,e,i);return VN(null!==n),n}}function jN(r){return function(t,e){var n=function(t,e){var n=wN(e);return null===n?null:FN(t,n)}(r,e);return VN(null!==n),n}}function WN(r,i){return function(t,e){var n=kN(r,e,i);return VN(null!==n),function(r,t){var e=wN(t);if(null===e)return null;if(!sN(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return EN("/b/"+i(e)+"/o/"+i(n))+TN({alt:"media",token:t})})[0]}(n,e)}}function KN(r){return function(t,e){var n;return(n=401===t.getStatus()?new NC(kC.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new NC(kC.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new NC(kC.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function QN(r){var i=KN(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new NC(kC.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function HN(t,e,n){var r=EN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new qN(r,"GET",BN(t,n),i);return o.errorHandler=QN(e),o}function GN(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var zN=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function YN(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){VN(!1)}return VN(!!n&&-1!==(e||["active"]).indexOf(n)),n}function XN(t,a,e,s,n,u,r,i){var c=new zN(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new NC(kC.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw PC();var y=a.maxUploadRetryTime(),m=new qN(e,"POST",function(t,e){var n,r=YN(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?BN(a,u)(t,e):null,new zN(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=KN(t),m}var JN=function(t,e,n){if(oN(t)||rN(e)||rN(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},$N=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function ZN(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new NC(kC.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?xC(o,e,t.message):xC(o,e,t)}}var tA=function(e,t){var n=this;this.validator=function(t){n.optional&&!iN(t)||e(t)},this.optional=!!t};function eA(t,e){function n(t){if(!sN(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new tA(r,e)}function nA(t){return new tA(RN,t)}function rA(){return new tA(function(t){if(!(uN(t)&&0<=t))throw"Expected a number 0 or greater."})}function iA(e,t){return new tA(function(t){if(!(null===t||rN(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function oA(t){return new tA(function(t){if(!(null===t||oN(t)))throw"Expected a Function."},t)}function aA(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var sA=(uA.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},uA.prototype.shouldDoResumable_=function(t){return 262144<t.size()},uA.prototype.start_=function(){this.state_===zC&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},uA.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case zC:e(t);break;case $C:n.transition_(ZC);break;case YC:n.transition_(XC)}})},uA.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=GN(e,r,i),s={name:a.fullPath},u=EN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=DN(a,n),l=t.maxUploadRetryTime(),f=new qN(u,"POST",function(t){var e;YN(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){VN(!1)}return VN(sN(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=KN(e),f}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},uA.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=function(t,e,n,i){var r=t.maxUploadRetryTime(),o=new qN(n,"POST",function(t){var e=YN(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){VN(!1)}n||VN(!1);var r=Number(n);return VN(!isNaN(r)),new zN(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=KN(e),o}(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},uA.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new zN(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=XN(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(tN)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(JC)):r.completeTransitions_()},r.errorHandler_)})},uA.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},uA.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=HN(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(JC)},r.metadataErrorHandler_)})},uA.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=GN(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+DN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=mN.getBlob(c,r,h);if(null===l)throw PC();var f={name:u.fullPath},p=EN(o),d=t.maxUploadRetryTime(),y=new qN(p,"POST",BN(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=KN(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(JC)},r.errorHandler_)})},uA.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},uA.prototype.transition_=function(t){if(this.state_!==t)switch(t){case $C:case YC:this.state_=t,null!==this.request_&&this.request_.cancel();break;case zC:var e=this.state_===XC;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case XC:this.state_=t,this.notifyObservers_();break;case ZC:this.error_=OC(),this.state_=t,this.notifyObservers_();break;case tN:case JC:this.state_=t,this.notifyObservers_()}},uA.prototype.completeTransitions_=function(){switch(this.state_){case YC:this.transition_(XC);break;case $C:this.transition_(ZC);break;case zC:this.start_()}},Object.defineProperty(uA.prototype,"snapshot",{get:function(){var t=nN(this.state_);return new $N(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),uA.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=oA(!0).validator,a=iA(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(iN(t.next)||iN(t.error)||iN(t.complete)))throw"";return}catch(t){throw r}}ZN("on",[eA(function(){if(t!==GC.STATE_CHANGED)throw"Expected one of the event types: ["+GC.STATE_CHANGED+"]."}),iA(s,!0),oA(!0),oA(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&ZN("on",i,arguments);var r=new JN(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[iA(function(t){if(null===t)throw r;s(t)}),oA(!0),oA(!0)];return iN(e)||iN(n)||iN(o)?c(null)(e,n,o):c(h)},uA.prototype.then=function(t,e){return this.promise_.then(t,e)},uA.prototype.catch=function(t){return this.then(null,t)},uA.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},uA.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},uA.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},uA.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(nN(this.state_)){case eN.SUCCESS:aA(this.resolve_.bind(null,this.snapshot))();break;case eN.CANCELED:case eN.ERROR:aA(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},uA.prototype.notifyObserver_=function(t){switch(nN(this.state_)){case eN.RUNNING:case eN.PAUSED:t.next&&aA(t.next.bind(t,this.snapshot))();break;case eN.SUCCESS:t.complete&&aA(t.complete.bind(t))();break;case eN.CANCELED:case eN.ERROR:t.error&&aA(t.error.bind(t,this.error_))();break;default:t.error&&aA(t.error.bind(t,this.error_))()}},uA.prototype.resume=function(){ZN("resume",[],arguments);var t=this.state_===XC||this.state_===YC;return t&&this.transition_(zC),t},uA.prototype.pause=function(){ZN("pause",[],arguments);var t=this.state_===zC;return t&&this.transition_(YC),t},uA.prototype.cancel=function(){ZN("cancel",[],arguments);var t=this.state_===zC||this.state_===YC;return t&&this.transition_($C),t},uA);function uA(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=zC,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(kC.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(tN))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(kC.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(tN))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var cA=(hA.prototype.toString=function(){return ZN("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},hA.prototype.newRef=function(t,e){return new hA(t,e)},hA.prototype.mappings=function(){return NN()},hA.prototype.child=function(t){ZN("child",[eA()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new gN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(hA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new gN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(hA.prototype,"root",{get:function(){var t=new gN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(hA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(hA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(hA.prototype,"name",{get:function(){return _N(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(hA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),hA.prototype.put=function(t,e){return void 0===e&&(e=null),ZN("put",[new tA(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||hN()&&t instanceof Blob))throw"Expected Blob or File."}),nA(!0)],arguments),this.throwIfRoot_("put"),new sA(this,this.authWrapper,this.location,this.mappings(),new mN(t),e)},hA.prototype.putString=function(t,e,n){void 0===e&&(e=UC.RAW),ZN("putString",[eA(),eA(qC,!0),nA(!0)],arguments),this.throwIfRoot_("putString");var r=BC(e,t),i=Object.assign({},n);return!rN(i.contentType)&&rN(r.contentType)&&(i.contentType=r.contentType),new sA(this,this.authWrapper,this.location,this.mappings(),new mN(r.data,!0),i)},hA.prototype.delete=function(){var n=this;return ZN("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=EN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new qN(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=QN(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},hA.prototype.listAll=function(){ZN("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},hA.prototype.listAllHelper=function(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},hA.prototype.list=function(r){ZN("list",[function(t){return new tA(UN,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=EN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new qN(a,"GET",jN(t),s);return u.urlParams=o,u.errorHandler=KN(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},hA.prototype.getMetadata=function(){var n=this;return ZN("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=HN(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},hA.prototype.updateMetadata=function(n){var r=this;return ZN("updateMetadata",[nA()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=EN(e.fullServerUrl()),o=DN(n,r),a=t.maxOperationRetryTime(),s=new qN(i,"PATCH",BN(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=QN(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},hA.prototype.getDownloadURL=function(){var n=this;return ZN("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=EN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new qN(r,"GET",WN(t,n),i);return o.errorHandler=QN(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new NC(kC.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},hA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new NC(kC.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},hA);function hA(t,e){this.authWrapper=t,this.location=e instanceof gN?e:gN.makeFromUrl(e)}var lA=(fA.prototype.getPromise=function(){return this.promise_},fA.prototype.cancel=function(t){},fA);function fA(t){this.promise_=Promise.reject(t)}var pA=(dA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},dA.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},dA);function dA(){this.map=new Map,this.id=-9007199254740991}var yA=(mA.extractBucket_=function(t){var e=t[CC]||null;return null==e?null:gN.makeFromBucketSpec(e).bucket},mA.prototype.getAuthToken=function(){return null!==this.app_&&rN(this.app_.INTERNAL)&&rN(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},mA.prototype.bucket=function(){if(this.deleted_)throw MC();return this.bucket_},mA.prototype.service=function(){return this.service_},mA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},mA.prototype.makeRequest=function(t,e){if(this.deleted_)return new lA(MC());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},mA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},mA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},mA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},mA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},mA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},mA);function mA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;rN(o)&&(this.bucket_=mA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new pA}var vA=(gA.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());iN(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=RC()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?MC():OC()):i(n=new NC(kC.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new bA(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new bA(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===QC.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new bA(r,t))}else{var i=t.getErrorCode()===QC.ABORT;o(!1,new bA(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},gA.prototype.getPromise=function(){return this.promise_},gA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},gA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},gA);function gA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var bA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function wA(t,e,n){var r=TN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==il?il.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new vA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var _A=(EA.prototype.ref=function(t){if(ZN("ref",[eA(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new cA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},EA.prototype.refFromURL=function(t){return ZN("refFromURL",[eA(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{gN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new cA(this.authWrapper_,t)},Object.defineProperty(EA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),EA.prototype.setMaxUploadRetryTime=function(t){ZN("setMaxUploadRetryTime",[rA()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},EA.prototype.setMaxOperationRetryTime=function(t){ZN("setMaxOperationRetryTime",[rA()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(EA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(EA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),EA);function EA(t,e,n){if(this.bucket_=null,this.authWrapper_=new yA(t,function(t,e){return new cA(t,e)},wA,this,e),this.app_=t,null!=n)this.bucket_=gN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new gN(r,""))}this.internals_=new TA(this)}var TA=(SA.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},SA);function SA(t){this.service_=t}var IA;function CA(t,e,n){return new _A(t,new pN,n)}function NA(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function AA(n,r,i){var o,t=new Promise(function(t,e){NA(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function kA(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function DA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return AA(this[n],t,arguments)})})}function RA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function OA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=AA(t,e,n);return r.then(function(t){if(t)return new xA(t,r.request)})}(this[n],t,arguments)})})}function PA(t){this._index=t}function xA(t,e){this._cursor=t,this._request=e}function MA(t){this._store=t}function LA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function FA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new LA(n)}function UA(t){this._db=t}IA={TaskState:eN,TaskEvent:GC,StringFormat:UC,Storage:_A,Reference:cA},il.INTERNAL.registerService("storage",CA,IA,void 0,!0),kA(PA,"_index",["name","keyPath","multiEntry","unique"]),DA(PA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),OA(PA,"_index",IDBIndex,["openCursor","openKeyCursor"]),kA(xA,"_cursor",["direction","key","primaryKey","value"]),DA(xA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(xA.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),NA(e._request).then(function(t){if(t)return new xA(t,e._request)})})})}),MA.prototype.createIndex=function(){return new PA(this._store.createIndex.apply(this._store,arguments))},MA.prototype.index=function(){return new PA(this._store.index.apply(this._store,arguments))},kA(MA,"_store",["name","keyPath","indexNames","autoIncrement"]),DA(MA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),OA(MA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),RA(MA,"_store",IDBObjectStore,["deleteIndex"]),LA.prototype.objectStore=function(){return new MA(this._tx.objectStore.apply(this._tx,arguments))},kA(LA,"_tx",["objectStoreNames","mode"]),RA(LA,"_tx",IDBTransaction,["abort"]),FA.prototype.createObjectStore=function(){return new MA(this._db.createObjectStore.apply(this._db,arguments))},kA(FA,"_db",["name","version","objectStoreNames"]),RA(FA,"_db",IDBDatabase,["deleteObjectStore","close"]),UA.prototype.transaction=function(){return new LA(this._db.transaction.apply(this._db,arguments))},kA(UA,"_db",["name","version","objectStoreNames"]),RA(UA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[MA,PA].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[PA,MA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var qA,VA=1e4,BA="w:0.2.4",jA="FIS_v2",WA="https://firebaseinstallations.googleapis.com/v1",KA=36e5,QA=((qA={})["missing-app-config-values"]="Missing App configuration values.",qA["create-installation-failed"]="Could not register Firebase Installation.",qA["generate-token-failed"]="Could not generate Auth Token.",qA["not-registered"]="Firebase Installation is not registered.",qA["installation-not-found"]="Firebase Installation not found.",qA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',qA["app-offline"]="Could not process request. Application offline.",qA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",qA),HA=new Ai("installations","Installations",QA);function GA(t){return t instanceof Ci&&t.code.includes("request-failed")}function zA(t){if(!t||!t.options)throw HA.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw HA.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function YA(t){var e=t.projectId;return WA+"/projects/"+e+"/installations"}function XA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function JA(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,HA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function $A(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function ZA(t,e){var n=e.refreshToken,r=$A(t);return r.append("Authorization",function(t){return jA+" "+t}(n)),r}function tk(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function ek(e){return new Promise(function(t){setTimeout(t,e)})}var nk=/^[cdef][\w-]{21}$/,rk="";function ik(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,hi(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return nk.test(e)?e:rk}catch(t){return rk}}var ok="firebase-installations-database",ak=1,sk="firebase-installations-store",uk=null;function ck(){return uk=uk||function(t,e,n){var r=AA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new FA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new UA(t)})}(ok,ak,function(t){switch(t.oldVersion){case 0:t.createObjectStore(sk)}})}function hk(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=pk(i),[4,ck()];case 1:return n=t.sent(),[4,(r=n.transaction(sk,"readwrite")).objectStore(sk).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function lk(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=pk(i),[4,ck()];case 1:return n=t.sent(),[4,(r=n.transaction(sk,"readwrite")).objectStore(sk).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function fk(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=pk(s),[4,ck()];case 1:return n=t.sent(),r=n.transaction(sk,"readwrite"),[4,(i=r.objectStore(sk)).get(e)];case 2:return o=t.sent(),(a=u(o))===o?[2,a]:void 0!==a?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function pk(t){return t.appName+"!"+t.appId}function dk(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,fk(i,function(t){var e=function(t){var e=t||{fid:ik(),registrationStatus:0};if(mk(e))return{fid:e.fid,registrationStatus:0};return e}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,yk(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,ek(100)];case 3:return t.sent(),[4,yk(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw HA.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(HA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=YA(s),n=$A(s),r={fid:u,authVersion:jA,appId:s.appId,sdkVersion:BA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,tk(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:XA(a.authToken)}];case 3:return[4,JA("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,hk(r,e)];case 2:return GA(n=t.sent())&&409===n.serverCode?[4,lk(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,hk(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==rk?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function yk(t){return fk(t,function(t){if(!t)throw HA.create("installation-not-found");return mk(t)?{fid:t.fid,registrationStatus:0}:t})}function mk(t){return 1===t.registrationStatus&&t.registrationTime+VA<Date.now()}function vk(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return YA(t)+"/"+n+"/authTokens:generate"}(s,u),n=ZA(s,u),r={installation:{sdkVersion:BA}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,tk(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,XA(a)];case 3:return[4,JA("Generate Auth Token",o)];case 4:throw t.sent()}})})}function gk(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,fk(i,function(t){if(!wk(t))throw HA.create("not-registered");var e=t.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+KA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,bk(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,ek(100)];case 3:return t.sent(),[4,bk(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw HA.create("generate-token-failed");return[2,n]}})})}(i),t;if(!navigator.onLine)throw HA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return oi({},t,{authToken:e})}(t);return r=function(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,vk(i,o)];case 1:return e=t.sent(),r=oi({},o,{authToken:e}),[4,hk(i,r)];case 2:return t.sent(),[2,e];case 3:return!GA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,lk(i)];case 4:return t.sent(),[3,7];case 5:return r=oi({},o,{authToken:{requestStatus:0}}),[4,hk(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function bk(t){return fk(t,function(t){if(!wk(t))throw HA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+VA<Date.now()}(t.authToken)?oi({},t,{authToken:{requestStatus:0}}):t})}function wk(t){return void 0!==t&&2===t.registrationStatus}function _k(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,dk(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw HA.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=zA(n))];case 1:return t.sent(),[2,gk(e)]}})})}function Ek(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return YA(t)+"/"+n}(o,a),n=ZA(o,a),r={method:"DELETE",headers:n},[4,tk(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,JA("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}il.INTERNAL.registerService("installations",function(t){return zA(t),{app:t,getId:function(){return function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,dk(e=zA(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&gk(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return _k(t)},delete:function(){return function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,fk(e=zA(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw HA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw HA.create("app-offline");case 3:return[4,Ek(e,n)];case 4:return t.sent(),[4,lk(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(t)}}});var Tk,Sk,Ik,Ck,Nk="0.2.15",Ak="FB-PERF-TRACE-MEASURE",kk="@firebase/performance/config",Dk="@firebase/performance/configexpire",Rk="Performance",Ok=((Tk={})["trace started"]="Trace {$traceName} was started before.",Tk["trace stopped"]="Trace {$traceName} is not running.",Tk["no window"]="Window is not available.",Tk["no app id"]="App id is not available.",Tk["no project id"]="Project id is not available.",Tk["no api key"]="Api key is not available.",Tk["invalid cc log"]="Attempted to queue invalid cc event",Tk["FB not default"]="Performance can only start when Firebase app instance is the default one.",Tk["RC response not ok"]="RC response is not ok",Tk),Pk=new Ai("performance",Rk,Ok),xk=(Mk.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},Mk.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},Mk.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},Mk.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},Mk.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},Mk.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},Mk.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},Mk.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},Mk.getInstance=function(){return void 0===Sk&&(Sk=new Mk(Ik)),Sk},Mk);function Mk(t){if(!t)throw Pk.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var Lk,Fk,Uk,qk=(Vk.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Pk.create("no app id");return t},Vk.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Pk.create("no project id");return t},Vk.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Pk.create("no api key");return t},Vk.getInstance=function(){return void 0===Ck&&(Ck=new Vk),Ck},Vk);function Vk(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function Bk(){return Lk}function jk(){switch(xk.getInstance().document.visibilityState){case"visible":return Fk.VISIBLE;case"hidden":return Fk.HIDDEN;case"prerender":return Fk.PRERENDER;default:return Fk.UNKNOWN}}(Uk=Fk=Fk||{})[Uk.UNKNOWN=0]="UNKNOWN",Uk[Uk.VISIBLE=1]="VISIBLE",Uk[Uk.HIDDEN=2]="HIDDEN",Uk[Uk.PRERENDER=3]="PRERENDER",Uk[Uk.UNLOADED=4]="UNLOADED";var Wk=new to(Rk);Wk.logLevel=Yi.INFO;var Kk="0.0.1",Qk={loggingEnabled:!0},Hk="FIREBASE_INSTALLATIONS_AUTH";function Gk(t){var e=function(){var t=xk.getInstance().localStorage,e=t.getItem(Dk);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(kk);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(Yk(e),Promise.resolve()):function(r){return function(){var t=qk.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+qk.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+qk.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:Hk+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:qk.getInstance().getAppId(),app_version:Nk,sdk_version:Kk})});return fetch(n).then(function(t){if(t.ok)return t.json();throw Pk.create("RC response not ok")})}).catch(function(){Wk.info(zk)})}(t).then(function(t){return Yk(t)}).then(function(t){return function(t){if(!t)return;var e=xk.getInstance().localStorage;e.setItem(kk,JSON.stringify(t)),e.setItem(Dk,String(Date.now()+60*qk.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var zk="Could not fetch config, will use default configs";function Yk(t){if(!t)return t;var e=qk.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=Qk.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Xk(e.tracesSamplingRate),e.logNetworkAfterSampling=Xk(e.networkRequestsSamplingRate),t}function Xk(t){return Math.random()<=t}var Jk,$k=1;function Zk(){return $k=2,Jk=Jk||function(){var n=xk.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=qk.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){Lk=t}),t}()}).then(function(t){return Gk(t)}).then(function(){return tD()},function(){return tD()})}function tD(){$k=3}var eD,nD=1e4,rD=3,iD=rD,oD=[];function aD(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw Pk.create("invalid cc log");oD=oD.concat([t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function sD(){if(eD)return eD;var t=aD(hD);return(eD=new to("@firebase/performance/cc")).logHandler=t,eD}function uD(t){var e=qk.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&xk.getInstance().requiredApisAvailable()&&(t.isAuto&&jk()!==Fk.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===$k?cD(t):Zk().then(function(){return cD(t)},function(){return cD(t)})))}function cD(t){Bk()&&setTimeout(function(){return sD().log(t,1)},0)}function hD(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:lD(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=fD(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=fD(n));var r={application_info:lD(),trace_metric:e};return JSON.stringify(r)}(t)}function lD(){return{google_app_id:qk.getInstance().getAppId(),app_instance_id:Bk(),web_app_info:{sdk_version:Nk,page_url:xk.getInstance().getUrl(),service_worker_status:function(){var t=xk.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:jk(),effective_connection_type:function(){var t=xk.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function fD(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==iD){if(!oD.length)return r(nD);var t=oD.slice();oD=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:qk.getInstance().logSource,log_event:e};fetch(qk.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||Wk.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?nD:Math.max(nD,e);iD=rD,r(n)}).catch(function(){oD=t.concat(oD),iD--,Wk.info("Tries left: "+iD+"."),r(nD)})}},t)}(5500);var pD=(dD.prototype.start=function(){if(1!==this.state)throw Pk.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},dD.prototype.stop=function(){if(2!==this.state)throw Pk.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),uD(this)},dD.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=oi({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}uD(this)},dD.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&(this.counters[t]=0),this.counters[t]+=e},dD.prototype.putMetric=function(t,e){this.counters[t]=e},dD.prototype.getMetric=function(t){return this.counters[t]||0},dD.prototype.putAttribute=function(t,e){this.customAttributes[t]=e},dD.prototype.getAttribute=function(t){return this.customAttributes[t]},dD.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},dD.prototype.getAttributes=function(){return oi({},this.customAttributes)},dD.prototype.setStartTime=function(t){this.startTimeUs=t},dD.prototype.setDuration=function(t){this.durationUs=t},dD.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},dD.createOobTrace=function(t,e,n){var r=xk.getInstance().getUrl();if(r){var i=new dD("_wt_"+r,!0),o=Math.floor(1e3*xk.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.incrementMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.incrementMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.incrementMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.incrementMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.incrementMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.incrementMetric("_fid",Math.floor(1e3*n))}uD(i)}},dD.createUserTimingTrace=function(t){uD(new dD(t,!1,t))},dD);function dD(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=xk.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||Ak+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function yD(t){var e=t;if(e&&void 0!==e.responseStart){var n=xk.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=qk.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return sD().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var mD=5e3;function vD(){Bk()&&(setTimeout(function(){return function(){var t=xk.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){pD.createOobTrace(e,n),r=void 0},mD);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),pD.createOobTrace(e,n,t))})}else pD.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=xk.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){yD(r[n])}t.setupObserver("resource",yD)}()},0),setTimeout(function(){return function(){for(var t=xk.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){gD(r[n])}t.setupObserver("measure",gD)}()},0))}function gD(t){var e=t.name;e.substring(0,Ak.length)!==Ak&&pD.createUserTimingTrace(e)}var bD=(wD.prototype.trace=function(t){return new pD(t)},Object.defineProperty(wD.prototype,"instrumentationEnabled",{get:function(){return qk.getInstance().instrumentationEnabled},set:function(t){qk.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(wD.prototype,"dataCollectionEnabled",{get:function(){return qk.getInstance().dataCollectionEnabled},set:function(t){qk.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),wD);function wD(t){this.app=t,xk.getInstance().requiredApisAvailable()?Zk().then(vD,vD):Wk.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return il.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw Pk.create("FB not default");if("undefined"==typeof window)throw Pk.create("no window");return function(t){Ik=t}(window),qk.getInstance().firebaseAppInstance=t,new bD(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),il});
//# sourceMappingURL=firebase.js.map
